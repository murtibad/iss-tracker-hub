var FE=Object.defineProperty;var OE=(a,n,o)=>n in a?FE(a,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[n]=o;var pn=(a,n,o)=>OE(a,typeof n!="symbol"?n+"":n,o);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))d(g);new MutationObserver(g=>{for(const w of g)if(w.type==="childList")for(const x of w.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&d(x)}).observe(document,{childList:!0,subtree:!0});function o(g){const w={};return g.integrity&&(w.integrity=g.integrity),g.referrerPolicy&&(w.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?w.credentials="include":g.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function d(g){if(g.ep)return;g.ep=!0;const w=o(g);fetch(g.href,w)}})();const In={VERSION:"v1.0.0-beta",MIN_ELEVATION:20,INTERVAL_PREDICTION_REFRESH:6e4,INTERVAL_WEATHER_REFRESH_MS:45e3,TERMINAL_TELEMETRY_LOG_INTERVAL_MS:1e4,FOLLOW_PAN_INTERVAL_MS:4e3};function NE(){const a={app:{version:In.VERSION,errors:[]},location:{status:"idle",permission:"unknown",mode:null,coords:null,accuracy:null,cityName:null,districtName:null,neighborhoodName:null},iss:{status:"loading",lastUpdatedAt:null,telemetry:null,lightText:null},pass:{next:null},ui:{follow:!0}},n=new Set;function o(){for(const R of n)R(d())}function d(){return a}function g(R){Object.keys(a).forEach(B=>delete a[B]),Object.assign(a,R),o()}function w(R){Object.assign(a,R),o()}function x(R){R(a),o()}function c(R){return n.add(R),R(d()),()=>n.delete(R)}return{getState:d,setState:g,patch:w,update:x,subscribe:c}}const VE="modulepreload",BE=function(a){return"/iss-tracker-hub/"+a},w0={},UE=function(n,o,d){let g=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const x=document.querySelector("meta[property=csp-nonce]"),c=(x==null?void 0:x.nonce)||(x==null?void 0:x.getAttribute("nonce"));g=Promise.allSettled(o.map(R=>{if(R=BE(R),R in w0)return;w0[R]=!0;const B=R.endsWith(".css"),W=B?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${R}"]${W}`))return;const ee=document.createElement("link");if(ee.rel=B?"stylesheet":VE,B||(ee.as="script"),ee.crossOrigin="",ee.href=R,c&&ee.setAttribute("nonce",c),document.head.appendChild(ee),B)return new Promise((ce,Ie)=>{ee.addEventListener("load",ce),ee.addEventListener("error",()=>Ie(new Error(`Unable to preload CSS for ${R}`)))})}))}function w(x){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=x,window.dispatchEvent(c),!c.defaultPrevented)throw x}return g.then(x=>{for(const c of x||[])c.status==="rejected"&&w(c.reason);return n().catch(w)})};var jE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qE(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var bb={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.15.0/LICENSE.txt
 */(function(a,n){(function(o,d){a.exports=d()})(jE,function(){var o={},d={};function g(x,c,R){if(d[x]=R,x==="index"){var B="var sharedModule = {}; ("+d.shared+")(sharedModule); ("+d.worker+")(sharedModule);",W={};return d.shared(W),d.index(o,W),typeof window<"u"&&o.setWorkerUrl(window.URL.createObjectURL(new Blob([B],{type:"text/javascript"}))),o}}g("shared",["exports"],function(x){function c(i,e,r,l){return new(r||(r=Promise))(function(h,f){function m(S){try{T(l.next(S))}catch(A){f(A)}}function v(S){try{T(l.throw(S))}catch(A){f(A)}}function T(S){var A;S.done?h(S.value):(A=S.value,A instanceof r?A:new r(function(M){M(A)})).then(m,v)}T((l=l.apply(i,e||[])).next())})}function R(i,e){this.x=i,this.y=e}function B(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var W,ee;typeof SuppressedError=="function"&&SuppressedError,R.prototype={clone(){return new R(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),r=Math.sin(i),l=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=l,this},_rotateAround(i,e){const r=Math.cos(i),l=Math.sin(i),h=e.y+l*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:R},R.convert=function(i){if(i instanceof R)return i;if(Array.isArray(i))return new R(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new R(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var ce=function(){if(ee)return W;function i(e,r,l,h){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=h}return ee=1,W=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,h=0;h<8;h++){var f=this.sampleCurveX(l)-e;if(Math.abs(f)<r)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=f/m}var v=0,T=1;for(l=e,h=0;h<20&&(f=this.sampleCurveX(l),!(Math.abs(f-e)<r));h++)e>f?v=l:T=l,l=.5*(T-v)+v;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},W}(),Ie=B(ce);let Ue,ke;function Q(){return Ue==null&&(Ue=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ue}function qe(){if(ke==null&&(ke=!1,Q())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<5*5;l++){const h=4*l;e.fillStyle=`rgb(${h},${h+1},${h+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&r[l]!==l){ke=!0;break}}}return ke||!1}var Ye=1e-6,Ge=typeof Float32Array<"u"?Float32Array:Array;function ht(){var i=new Ge(9);return Ge!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function ct(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ot(){var i=new Ge(3);return Ge!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function xe(i){var e=i[0],r=i[1],l=i[2];return Math.sqrt(e*e+r*r+l*l)}function se(i,e,r){var l=new Ge(3);return l[0]=i,l[1]=e,l[2]=r,l}function ue(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function Ee(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function be(i,e,r){var l=e[0],h=e[1],f=e[2],m=r[0],v=r[1],T=r[2];return i[0]=h*T-f*v,i[1]=f*m-l*T,i[2]=l*v-h*m,i}var fe,pe=xe;function Jt(i,e,r){var l=e[0],h=e[1],f=e[2],m=e[3];return i[0]=r[0]*l+r[4]*h+r[8]*f+r[12]*m,i[1]=r[1]*l+r[5]*h+r[9]*f+r[13]*m,i[2]=r[2]*l+r[6]*h+r[10]*f+r[14]*m,i[3]=r[3]*l+r[7]*h+r[11]*f+r[15]*m,i}function fn(){var i=new Ge(4);return Ge!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Ut(i,e,r,l){var h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",f=Math.PI/360;e*=f,l*=f,r*=f;var m=Math.sin(e),v=Math.cos(e),T=Math.sin(r),S=Math.cos(r),A=Math.sin(l),M=Math.cos(l);switch(h){case"xyz":i[0]=m*S*M+v*T*A,i[1]=v*T*M-m*S*A,i[2]=v*S*A+m*T*M,i[3]=v*S*M-m*T*A;break;case"xzy":i[0]=m*S*M-v*T*A,i[1]=v*T*M-m*S*A,i[2]=v*S*A+m*T*M,i[3]=v*S*M+m*T*A;break;case"yxz":i[0]=m*S*M+v*T*A,i[1]=v*T*M-m*S*A,i[2]=v*S*A-m*T*M,i[3]=v*S*M+m*T*A;break;case"yzx":i[0]=m*S*M+v*T*A,i[1]=v*T*M+m*S*A,i[2]=v*S*A-m*T*M,i[3]=v*S*M-m*T*A;break;case"zxy":i[0]=m*S*M-v*T*A,i[1]=v*T*M+m*S*A,i[2]=v*S*A+m*T*M,i[3]=v*S*M-m*T*A;break;case"zyx":i[0]=m*S*M-v*T*A,i[1]=v*T*M+m*S*A,i[2]=v*S*A-m*T*M,i[3]=v*S*M+m*T*A;break;default:throw new Error("Unknown angle order "+h)}return i}function $t(){var i=new Ge(2);return Ge!=Float32Array&&(i[0]=0,i[1]=0),i}function mn(i,e){var r=new Ge(2);return r[0]=i,r[1]=e,r}ot(),fe=new Ge(4),Ge!=Float32Array&&(fe[0]=0,fe[1]=0,fe[2]=0,fe[3]=0),ot(),se(1,0,0),se(0,1,0),fn(),fn(),ht(),$t();const Pt=8192;function zn(i,e,r){return e*(Pt/(i.tileSize*Math.pow(2,r-i.tileID.overscaledZ)))}function on(i,e){return(i%e+e)%e}function Ft(i,e,r){return i*(1-r)+e*r}function Gt(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function Mn(i,e,r,l){const h=new Ie(i,e,r,l);return f=>h.solve(f)}const wt=Mn(.25,.1,.25,1);function Et(i,e,r){return Math.min(r,Math.max(e,i))}function Cn(i,e,r){const l=r-e,h=((i-e)%l+l)%l+e;return h===e?r:h}function Wt(i,...e){for(const r of e)for(const l in r)i[l]=r[l];return i}let Sn=1;function Kt(i,e,r){const l={};for(const h in i)l[h]=e.call(this,i[h],h,i);return l}function or(i,e,r){const l={};for(const h in i)e.call(this,i[h],h,i)&&(l[h]=i[h]);return l}function Tn(i){return Array.isArray(i)?i.map(Tn):typeof i=="object"&&i?Kt(i,Tn):i}const Dn={};function Nt(i){Dn[i]||(typeof console<"u"&&console.warn(i),Dn[i]=!0)}function en(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Pn(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Lt=null;function jt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Mt(i,e,r,l,h){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(i,{timestamp:0});try{const m=f==null?void 0:f.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const v=m.startsWith("BGR"),T=new Uint8ClampedArray(l*h*4);if(yield f.copyTo(T,function(S,A,M,D,z){const V=4*Math.max(-A,0),U=(Math.max(0,M)-M)*D*4+V,$=4*D,X=Math.max(0,A),ae=Math.max(0,M);return{rect:{x:X,y:ae,width:Math.min(S.width,A+D)-X,height:Math.min(S.height,M+z)-ae},layout:[{offset:U,stride:$}]}}(i,e,r,l,h)),v)for(let S=0;S<T.length;S+=4){const A=T[S];T[S]=T[S+2],T[S+2]=A}return T}finally{f.close()}})}let rn,dn;function _n(i,e,r,l){return i.addEventListener(e,r,l),{unsubscribe:()=>{i.removeEventListener(e,r,l)}}}function Yt(i){return i*Math.PI/180}function Xt(i){return i/Math.PI*180}const Ae={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},H={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},G="AbortError";class K extends Error{constructor(e=G){super(e instanceof Error?e.message:e),this.name=G,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function de(i){return i.name===G}const ge={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function N(i){return ge.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Se="global-dispatcher";class we extends Error{constructor(e,r,l,h){super(`AJAXError: ${r} (${e}): ${l}`),this.status=e,this.statusText=r,this.url=l,this.body=h}}const Me=()=>Pn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,He=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=N(i.url);if(l)return l(i,e);if(Pn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Se},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Me())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,h){return c(this,void 0,void 0,function*(){const f=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:Me(),signal:h.signal});let m,v;l.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{m=yield fetch(f)}catch(S){throw de(S)?S:new we(0,S.message,l.url,new Blob)}if(!m.ok){const S=yield m.blob();throw new we(m.status,m.statusText,l.url,S)}v=l.type==="arrayBuffer"||l.type==="image"?m.arrayBuffer():l.type==="json"?m.json():m.text();const T=yield v;return h.signal.throwIfAborted(),{data:T,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(i,e);if(Pn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Se},e)}var r;return function(l,h){return new Promise((f,m)=>{var v;const T=new XMLHttpRequest;T.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(T.responseType="arraybuffer");for(const S in l.headers)T.setRequestHeader(S,l.headers[S]);l.type==="json"&&(T.responseType="text",!((v=l.headers)===null||v===void 0)&&v.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=l.credentials==="include",T.onerror=()=>{m(new Error(T.statusText))},T.onload=()=>{if(!h.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let S=T.response;if(l.type==="json")try{S=JSON.parse(T.response)}catch(A){return void m(A)}f({data:S,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const S=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});m(new we(T.status,T.statusText,l.url,S))}},h.signal.addEventListener("abort",()=>{T.abort(),m(new K(h.signal.reason))}),T.send(l.body)})}(i,e)};function Le(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function tt(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function gt(i,e,r){if(r&&r[i]){const l=r[i].indexOf(e);l!==-1&&r[i].splice(l,1)}}class It{constructor(e,r={}){Wt(this,r),this.type=e}}class Ht extends It{constructor(e,r={}){super("error",Wt({error:e},r))}}class zt{on(e,r){return this._listeners=this._listeners||{},tt(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return gt(e,r,this._listeners),gt(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},tt(e,r,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,r){typeof e=="string"&&(e=new It(e,r||{}));const l=e.type;if(this.listens(l)){e.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of h)v.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of f)gt(l,v,this._oneTimeListeners),v.call(this,e);const m=this._eventedParent;m&&(Wt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof Ht&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const tn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Rn(i,e){const r={};for(const l in i)l!=="ref"&&(r[l]=i[l]);return tn.forEach(l=>{l in e&&(r[l]=e[l])}),r}function Rt(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Rt(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Rt(i[r],e[r]))return!1;return!0}return i===e}function Re(i,e){i.push(e)}function rt(i,e,r){Re(r,{command:"addSource",args:[i,e[i]]})}function Tt(i,e,r){Re(e,{command:"removeSource",args:[i]}),r[i]=!0}function yt(i,e,r,l){Tt(i,r,l),rt(i,e,r)}function je(i,e,r){let l;for(l in i[r])if(Object.prototype.hasOwnProperty.call(i[r],l)&&l!=="data"&&!Rt(i[r][l],e[r][l]))return!1;for(l in e[r])if(Object.prototype.hasOwnProperty.call(e[r],l)&&l!=="data"&&!Rt(i[r][l],e[r][l]))return!1;return!0}function Qt(i,e,r,l,h,f){i=i||{},e=e||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(Rt(i[m],e[m])||r.push({command:f,args:[l,m,e[m],h]}));for(const m in e)Object.prototype.hasOwnProperty.call(e,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(Rt(i[m],e[m])||r.push({command:f,args:[l,m,e[m],h]}))}function Nn(i){return i.id}function cr(i,e){return i[e.id]=e,i}class We{constructor(e,r,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function xr(i,...e){for(const r of e)for(const l in r)i[l]=r[l];return i}class Yn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Zi{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[l,h]of r)this.bindings[l]=h}concat(e){return new Zi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const fr={kind:"null"},st={kind:"number"},At={kind:"string"},Bt={kind:"boolean"},Cr={kind:"color"},ki={kind:"projectionDefinition"},er={kind:"object"},Ct={kind:"value"},Kn={kind:"collator"},ci={kind:"formatted"},Di={kind:"padding"},Kr={kind:"colorArray"},Wi={kind:"numberArray"},os={kind:"resolvedImage"},Li={kind:"variableAnchorOffsetCollection"};function br(i,e){return{kind:"array",itemType:i,N:e}}function Ln(i){if(i.kind==="array"){const e=Ln(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const as=[fr,st,At,Bt,Cr,ki,ci,er,br(Ct),Di,Wi,Kr,os,Li];function Xr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Xr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of as)if(!Xr(r,e))return null}}return`Expected ${Ln(i)} but found ${Ln(e)} instead.`}function gi(i,e){return e.some(r=>r.kind===i.kind)}function zi(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Yr(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const _o=.96422,Ur=.82521,Mr=4/29,qn=6/29,ls=3*qn*qn,cs=qn*qn*qn,Fn=Math.PI/180,Ki=180/Math.PI;function us(i){return(i%=360)<0&&(i+=360),i}function hs([i,e,r,l]){let h,f;const m=vo((.2225045*(i=yo(i))+.7168786*(e=yo(e))+.0606169*(r=yo(r)))/1);i===e&&e===r?h=f=m:(h=vo((.4360747*i+.3850649*e+.1430804*r)/_o),f=vo((.0139322*i+.0971045*e+.7141733*r)/Ur));const v=116*m-16;return[v<0?0:v,500*(h-m),200*(m-f),l]}function yo(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function vo(i){return i>cs?Math.pow(i,1/3):i/ls+Mr}function Wo([i,e,r,l]){let h=(i+16)/116,f=isNaN(e)?h:h+e/500,m=isNaN(r)?h:h-r/200;return h=1*Xo(h),f=_o*Xo(f),m=Ur*Xo(m),[Ko(3.1338561*f-1.6168667*h-.4906146*m),Ko(-.9787684*f+1.9161415*h+.033454*m),Ko(.0719453*f-.2289914*h+1.4052427*m),l]}function Ko(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Xo(i){return i>qn?i*i*i:ls*(i-Mr)}const gl=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Xi(i,e){return gl(i,e)?i[e]:void 0}function Fi(i){return parseInt(i.padEnd(2,i),16)/255}function Yo(i,e){return Js(e?i/100:i,0,1)}function Js(i,e,r){return Math.min(Math.max(e,i),r)}function Aa(i){return!i.some(Number.isNaN)}const xo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function bs(i,e,r){return i+r*(e-i)}function Yi(i,e,r){return i.map((l,h)=>bs(l,e[h],r))}class gn{constructor(e,r,l,h=1,f=!0){this.r=e,this.g=r,this.b=l,this.a=h,f||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,r,l,h]))}static parse(e){if(e instanceof gn)return e;if(typeof e!="string")return;const r=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Xi(xo,l);if(h){const[m,v,T]=h;return[m/255,v/255,T/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const m=l.length<6?1:2;let v=1;return[Fi(l.slice(v,v+=m)),Fi(l.slice(v,v+=m)),Fi(l.slice(v,v+=m)),Fi(l.slice(v,v+m)||"ff")]}if(l.startsWith("rgb")){const m=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[v,T,S,A,M,D,z,V,U,$,X,ae]=m,Y=[A||" ",z||" ",$].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const J=[S,D,U].join(""),he=J==="%%%"?100:J===""?255:0;if(he){const ye=[Js(+T/he,0,1),Js(+M/he,0,1),Js(+V/he,0,1),X?Yo(+X,ae):1];if(Aa(ye))return ye}}return}}const f=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,v,T,S,A,M,D,z,V]=f,U=[T||" ",A||" ",D].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const $=[+v,Js(+S,0,100),Js(+M,0,100),z?Yo(+z,V):1];if(Aa($))return function([X,ae,Y,J]){function he(ye){const De=(ye+X/30)%12,Xe=ae*Math.min(Y,1-Y);return Y-Xe*Math.max(-1,Math.min(De-3,9-De,1))}return X=us(X),ae/=100,Y/=100,[he(0),he(8),he(4),J]}($)}}}(e);return r?new gn(...r,!1):void 0}get rgb(){const{r:e,g:r,b:l,a:h}=this,f=h||1/0;return this.overwriteGetter("rgb",[e/f,r/f,l/f,h])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,l,h,f]=hs(e),m=Math.sqrt(l*l+h*h);return[Math.round(1e4*m)?us(Math.atan2(h,l)*Ki):NaN,m,r,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",hs(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,l,h]=this.rgb;return`rgba(${[e,r,l].map(f=>Math.round(255*f)).join(",")},${h})`}static interpolate(e,r,l,h="rgb"){switch(h){case"rgb":{const[f,m,v,T]=Yi(e.rgb,r.rgb,l);return new gn(f,m,v,T,!1)}case"hcl":{const[f,m,v,T]=e.hcl,[S,A,M,D]=r.hcl;let z,V;if(isNaN(f)||isNaN(S))isNaN(f)?isNaN(S)?z=NaN:(z=S,v!==1&&v!==0||(V=A)):(z=f,M!==1&&M!==0||(V=m));else{let Y=S-f;S>f&&Y>180?Y-=360:S<f&&f-S>180&&(Y+=360),z=f+l*Y}const[U,$,X,ae]=function([Y,J,he,ye]){return Y=isNaN(Y)?0:Y*Fn,Wo([he,Math.cos(Y)*J,Math.sin(Y)*J,ye])}([z,V??bs(m,A,l),bs(v,M,l),bs(T,D,l)]);return new gn(U,$,X,ae,!1)}case"lab":{const[f,m,v,T]=Wo(Yi(e.lab,r.lab,l));return new gn(f,m,v,T,!1)}}}}gn.black=new gn(0,0,0,1),gn.white=new gn(1,1,1,1),gn.transparent=new gn(0,0,0,0),gn.red=new gn(1,0,0,1);class _l{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const $u=["bottom","center","top"];class ds{constructor(e,r,l,h,f,m){this.text=e,this.image=r,this.scale=l,this.fontStack=h,this.textColor=f,this.verticalAlign=m}}class _i{constructor(e){this.sections=e}static fromString(e){return new _i([new ds(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof _i?e:_i.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class jr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof jr)return e;if(typeof e=="number")return new jr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new jr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,l){return new jr(Yi(e.values,r.values,l))}}class Qn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Qn)return e;if(typeof e=="number")return new Qn([e]);if(Array.isArray(e)){for(const r of e)if(typeof r!="number")return;return new Qn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,l){return new Qn(Yi(e.values,r.values,l))}}class qt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof qt)return e;if(typeof e=="string"){const l=gn.parse(e);return l?new qt([l]):void 0}if(!Array.isArray(e))return;const r=[];for(const l of e){if(typeof l!="string")return;const h=gn.parse(l);if(!h)return;r.push(h)}return new qt(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,l,h="rgb"){const f=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let m=0;m<e.values.length;m++)f.push(gn.interpolate(e.values[m],r.values[m],l,h));return new qt(f)}}class Vn extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Oi=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Qr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const l=e[r],h=e[r+1];if(typeof l!="string"||!Oi.has(l)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Qr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,l){const h=e.values,f=r.values;if(h.length!==f.length)throw new Vn(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);const m=[];for(let v=0;v<h.length;v+=2){if(h[v]!==f[v])throw new Vn(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${h[v]}, to[${v}]: ${f[v]}`);m.push(h[v]);const[T,S]=h[v+1],[A,M]=f[v+1];m.push([bs(T,A,l),bs(S,M,l)])}return new Qr(m)}}class ui{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ui({name:e,available:!1}):null}}class kn{constructor(e,r,l){this.from=e,this.to=r,this.transition=l}static interpolate(e,r,l){return new kn(e,r,l)}static parse(e){return e instanceof kn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new kn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new kn(e.from,e.to,e.transition):typeof e=="string"?new kn(e,e,1):void 0}}function bo(i,e,r,l){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,e,r,l]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ns(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof kn||i instanceof gn||i instanceof _l||i instanceof _i||i instanceof jr||i instanceof Qn||i instanceof qt||i instanceof Qr||i instanceof ui)return!0;if(Array.isArray(i)){for(const e of i)if(!Ns(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ns(i[e]))return!1;return!0}return!1}function mr(i){if(i===null)return fr;if(typeof i=="string")return At;if(typeof i=="boolean")return Bt;if(typeof i=="number")return st;if(i instanceof gn)return Cr;if(i instanceof kn)return ki;if(i instanceof _l)return Kn;if(i instanceof _i)return ci;if(i instanceof jr)return Di;if(i instanceof Qn)return Wi;if(i instanceof qt)return Kr;if(i instanceof Qr)return Li;if(i instanceof ui)return os;if(Array.isArray(i)){const e=i.length;let r;for(const l of i){const h=mr(l);if(r){if(r===h)continue;r=Ct;break}r=h}return br(r||Ct,e)}return er}function Vs(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof gn||i instanceof kn||i instanceof _i||i instanceof jr||i instanceof Qn||i instanceof qt||i instanceof Qr||i instanceof ui?i.toString():JSON.stringify(i)}class Qi{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ns(e[1]))return r.error("invalid value");const l=e[1];let h=mr(l);const f=r.expectedType;return h.kind!=="array"||h.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(h=f),new Qi(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const eo={string:At,number:st,boolean:Bt,object:er};class Er{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,h=1;const f=e[0];if(f==="array"){let v,T;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in eo)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=eo[S],h++}else v=Ct;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);T=e[2],h++}l=br(v,T)}else{if(!eo[f])throw new Error(`Types doesn't contain name = ${f}`);l=eo[f]}const m=[];for(;h<e.length;h++){const v=r.parse(e[h],h,Ct);if(!v)return null;m.push(v)}return new Er(l,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(e);if(!Xr(this.type,mr(l)))return l;if(r===this.args.length-1)throw new Vn(`Expected value to be of type ${Ln(this.type)}, but found ${Ln(mr(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Bs={"to-boolean":Bt,"to-color":Cr,"to-number":st,"to-string":At};class ws{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[0];if(!Bs[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");const h=Bs[l],f=[];for(let m=1;m<e.length;m++){const v=r.parse(e[m],m,Ct);if(!v)return null;f.push(v)}return new ws(h,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,l;for(const h of this.args){if(r=h.evaluate(e),l=null,r instanceof gn)return r;if(typeof r=="string"){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:bo(r[0],r[1],r[2],r[3]),!l))return new gn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Vn(l||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const l of this.args){r=l.evaluate(e);const h=jr.parse(r);if(h)return h}throw new Vn(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const l of this.args){r=l.evaluate(e);const h=Qn.parse(r);if(h)return h}throw new Vn(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const l of this.args){r=l.evaluate(e);const h=qt.parse(r);if(h)return h}throw new Vn(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const l of this.args){r=l.evaluate(e);const h=Qr.parse(r);if(h)return h}throw new Vn(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const l of this.args){if(r=l.evaluate(e),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new Vn(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return _i.fromString(Vs(this.args[0].evaluate(e)));case"resolvedImage":return ui.fromString(Vs(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Vs(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const wo=["Unknown","Point","LineString","Polygon"];class Ca{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=gn.parse(e),this._parseColorCache.set(e,r)),r}}class Ts{constructor(e,r,l=[],h,f=new Zi,m=[]){this.registry=e,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=f,this.errors=m,this.expectedType=h,this._isConstant=r}parse(e,r,l,h,f={}){return r?this.concat(r,l,h)._parse(e,f):this._parse(e,f)}_parse(e,r){function l(h,f,m){return m==="assert"?new Er(f,[h]):m==="coerce"?new ws(f,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){const v=this.expectedType,T=m.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||T.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(T.kind)||v.kind==="colorArray"&&["value","string","array"].includes(T.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))m=l(m,v,r.typeAnnotation||"coerce");else if(this.checkSubtype(v,T))return null}else m=l(m,v,r.typeAnnotation||"assert")}if(!(m instanceof Qi)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const v=new Ca;try{m=new Qi(m.type,m.evaluate(v))}catch(T){return this.error(T.message),null}}return m}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l){const h=typeof e=="number"?this.path.concat(e):this.path,f=l?this.scope.concat(l):this.scope;return new Ts(this.registry,this._isConstant,h,r||null,f,this.errors)}error(e,...r){const l=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new Yn(l,e))}checkSubtype(e,r){const l=Xr(e,r);return l&&this.error(l),l}}class $n{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const v=r.parse(e[f+1],f+1);if(!v)return null;l.push([m,v])}const h=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return h?new $n(l,h):null}outputDefined(){return this.result.outputDefined()}}class to{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=e[1];return r.scope.has(l)?new to(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class vn{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,st),h=r.parse(e[2],2,br(r.expectedType||Ct));return l&&h?new vn(h.type.itemType,l,h):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new Vn(`Array index out of bounds: ${r} < 0.`);if(r>=l.length)throw new Vn(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r!==Math.floor(r))throw new Vn(`Array index must be an integer, but found ${r} instead.`);return l[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ln{constructor(e,r){this.type=Bt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Ct),h=r.parse(e[2],2,Ct);return l&&h?gi(l.type,[Bt,At,st,fr,Ct])?new ln(l,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(l.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!zi(r,["boolean","string","number","null"]))throw new Vn(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(mr(r))} instead.`);if(!zi(l,["string","array"]))throw new Vn(`Expected second argument to be of type array or string, but found ${Ln(mr(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class no{constructor(e,r,l){this.type=st,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Ct),h=r.parse(e[2],2,Ct);if(!l||!h)return null;if(!gi(l.type,[Bt,At,st,fr,Ct]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(l.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,st);return f?new no(l,h,f):null}return new no(l,h)}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!zi(r,["boolean","string","number","null"]))throw new Vn(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(mr(r))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(e)),zi(l,["string"])){const f=l.indexOf(r,h);return f===-1?-1:[...l.slice(0,f)].length}if(zi(l,["array"]))return l.indexOf(r,h);throw new Vn(`Expected second argument to be of type array or string, but found ${Ln(mr(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class xn{constructor(e,r,l,h,f,m){this.inputType=e,this.type=r,this.input=l,this.cases=h,this.outputs=f,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const f={},m=[];for(let S=2;S<e.length-1;S+=2){let A=e[S];const M=e[S+1];Array.isArray(A)||(A=[A]);const D=r.concat(S);if(A.length===0)return D.error("Expected at least one branch label.");for(const V of A){if(typeof V!="number"&&typeof V!="string")return D.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return D.error("Numeric branch labels must be integer values.");if(l){if(D.checkSubtype(l,mr(V)))return null}else l=mr(V);if(f[String(V)]!==void 0)return D.error("Branch labels must be unique.");f[String(V)]=m.length}const z=r.parse(M,S,h);if(!z)return null;h=h||z.type,m.push(z)}const v=r.parse(e[1],1,Ct);if(!v)return null;const T=r.parse(e[e.length-1],e.length-1,h);return T?v.type.kind!=="value"&&r.concat(1).checkSubtype(l,v.type)?null:new xn(l,h,v,f,m,T):null}evaluate(e){const r=this.input.evaluate(e);return(mr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class To{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const h=[];for(let m=1;m<e.length-1;m+=2){const v=r.parse(e[m],m,Bt);if(!v)return null;const T=r.parse(e[m+1],m+1,l);if(!T)return null;h.push([v,T]),l=l||T.type}const f=r.parse(e[e.length-1],e.length-1,l);if(!f)return null;if(!l)throw new Error("Can't infer output type");return new To(l,h,f)}evaluate(e){for(const[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Ii{constructor(e,r,l,h){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=h}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Ct),h=r.parse(e[2],2,st);if(!l||!h)return null;if(!gi(l.type,[br(Ct),At,Ct]))return r.error(`Expected first argument to be of type array or string, but found ${Ln(l.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,st);return f?new Ii(l.type,l,h,f):null}return new Ii(l.type,l,h)}evaluate(e){const r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let h;if(this.endIndex&&(h=this.endIndex.evaluate(e)),zi(r,["string"]))return[...r].slice(l,h).join("");if(zi(r,["array"]))return r.slice(l,h);throw new Vn(`Expected first argument to be of type array or string, but found ${Ln(mr(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Us(i,e){const r=i.length-1;let l,h,f=0,m=r,v=0;for(;f<=m;)if(v=Math.floor((f+m)/2),l=i[v],h=i[v+1],l<=e){if(v===r||e<h)return v;f=v+1}else{if(!(l>e))throw new Vn("Input is not a number.");m=v-1}return 0}class ps{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[h,f]of l)this.labels.push(h),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(e[1],1,st);if(!l)return null;const h=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let m=1;m<e.length;m+=2){const v=m===1?-1/0:e[m],T=e[m+1],S=m,A=m+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(h.length&&h[h.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const M=r.parse(T,A,f);if(!M)return null;f=f||M.type,h.push([v,M])}return new ps(f,l,h)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return l[0].evaluate(e);const f=r.length;return h>=r[f-1]?l[f-1].evaluate(e):l[Us(r,h)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function yl(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var js,Ma,bc=function(){if(Ma)return js;function i(e,r,l,h){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=h}return Ma=1,js=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,h=0;h<8;h++){var f=this.sampleCurveX(l)-e;if(Math.abs(f)<r)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=f/m}var v=0,T=1;for(l=e,h=0;h<20&&(f=this.sampleCurveX(l),!(Math.abs(f-e)<r));h++)e>f?v=l:T=l,l=.5*(T-v)+v;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},js}(),qs=yl(bc);class Jr{constructor(e,r,l,h,f){this.type=e,this.operator=r,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[m,v]of f)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(e,r,l,h){let f=0;if(e.name==="exponential")f=Ji(r,e.base,l,h);else if(e.name==="linear")f=Ji(r,1,l,h);else if(e.name==="cubic-bezier"){const m=e.controlPoints;f=new qs(m[0],m[1],m[2],m[3]).solve(Ji(r,1,l,h))}return f}static parse(e,r){let[l,h,f,...m]=e;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const S=h[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const S=h.slice(1);if(S.length!==4||S.some(A=>typeof A!="number"||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,st),!f)return null;const v=[];let T=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||r.expectedType==Kr?r.expectedType&&r.expectedType.kind!=="value"&&(T=r.expectedType):T=Cr;for(let S=0;S<m.length;S+=2){const A=m[S],M=m[S+1],D=S+3,z=S+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const V=r.parse(M,z,T);if(!V)return null;T=T||V.type,v.push([A,V])}return Yr(T,st)||Yr(T,ki)||Yr(T,Cr)||Yr(T,Di)||Yr(T,Wi)||Yr(T,Kr)||Yr(T,Li)||Yr(T,br(st))?new Jr(T,l,h,f,v):r.error(`Type ${Ln(T)} is not interpolatable.`)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return l[0].evaluate(e);const f=r.length;if(h>=r[f-1])return l[f-1].evaluate(e);const m=Us(r,h),v=Jr.interpolationFactor(this.interpolation,h,r[m],r[m+1]),T=l[m].evaluate(e),S=l[m+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return bs(T,S,v);case"color":return gn.interpolate(T,S,v);case"padding":return jr.interpolate(T,S,v);case"colorArray":return qt.interpolate(T,S,v);case"numberArray":return Qn.interpolate(T,S,v);case"variableAnchorOffsetCollection":return Qr.interpolate(T,S,v);case"array":return Yi(T,S,v);case"projectionDefinition":return kn.interpolate(T,S,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return gn.interpolate(T,S,v,"hcl");case"colorArray":return qt.interpolate(T,S,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return gn.interpolate(T,S,v,"lab");case"colorArray":return qt.interpolate(T,S,v,"lab")}}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ji(i,e,r,l){const h=l-r,f=i-r;return h===0?0:e===1?f/h:(Math.pow(e,f)-1)/(Math.pow(e,h)-1)}const tr={color:gn.interpolate,number:bs,padding:jr.interpolate,numberArray:Qn.interpolate,colorArray:qt.interpolate,variableAnchorOffsetCollection:Qr.interpolate,array:Yi};class $s{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l=null;const h=r.expectedType;h&&h.kind!=="value"&&(l=h);const f=[];for(const v of e.slice(1)){const T=r.parse(v,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!T)return null;l=l||T.type,f.push(T)}if(!l)throw new Error("No output type");const m=h&&f.some(v=>Xr(h,v.type));return new $s(m?Ct:l,f)}evaluate(e){let r,l=null,h=0;for(const f of this.args)if(h++,l=f.evaluate(e),l&&l instanceof ui&&!l.available&&(r||(r=l.name),l=null,h===this.args.length&&(l=r)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function Eo(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Gr(i,e,r,l){return l.compare(e,r)===0}function ur(i,e,r){const l=i!=="=="&&i!=="!=";return class wb{constructor(f,m,v){this.type=Bt,this.lhs=f,this.rhs=m,this.collator=v,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const v=f[0];let T=m.parse(f[1],1,Ct);if(!T)return null;if(!Eo(v,T.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Ln(T.type)}'.`);let S=m.parse(f[2],2,Ct);if(!S)return null;if(!Eo(v,S.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Ln(S.type)}'.`);if(T.type.kind!==S.type.kind&&T.type.kind!=="value"&&S.type.kind!=="value")return m.error(`Cannot compare types '${Ln(T.type)}' and '${Ln(S.type)}'.`);l&&(T.type.kind==="value"&&S.type.kind!=="value"?T=new Er(S.type,[T]):T.type.kind!=="value"&&S.type.kind==="value"&&(S=new Er(T.type,[S])));let A=null;if(f.length===4){if(T.type.kind!=="string"&&S.type.kind!=="string"&&T.type.kind!=="value"&&S.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(f[3],3,Kn),!A)return null}return new wb(T,S,A)}evaluate(f){const m=this.lhs.evaluate(f),v=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const T=mr(m),S=mr(v);if(T.kind!==S.kind||T.kind!=="string"&&T.kind!=="number")throw new Vn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const T=mr(m),S=mr(v);if(T.kind!=="string"||S.kind!=="string")return e(f,m,v)}return this.collator?r(f,m,v,this.collator.evaluate(f)):e(f,m,v)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const vl=ur("==",function(i,e,r){return e===r},Gr),Gs=ur("!=",function(i,e,r){return e!==r},function(i,e,r,l){return!Gr(0,e,r,l)}),E=ur("<",function(i,e,r){return e<r},function(i,e,r,l){return l.compare(e,r)<0}),L=ur(">",function(i,e,r){return e>r},function(i,e,r,l){return l.compare(e,r)>0}),j=ur("<=",function(i,e,r){return e<=r},function(i,e,r,l){return l.compare(e,r)<=0}),ne=ur(">=",function(i,e,r){return e>=r},function(i,e,r,l){return l.compare(e,r)>=0});class ze{constructor(e,r,l){this.type=Kn,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const h=r.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Bt);if(!h)return null;const f=r.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Bt);if(!f)return null;let m=null;return l.locale&&(m=r.parse(l.locale,1,At),!m)?null:new ze(h,f,m)}evaluate(e){return new _l(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Ze{constructor(e,r,l,h,f){this.type=At,this.number=e,this.locale=r,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const l=r.parse(e[1],1,st);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=r.parse(h.locale,1,At),!f))return null;let m=null;if(h.currency&&(m=r.parse(h.currency,1,At),!m))return null;let v=null;if(h["min-fraction-digits"]&&(v=r.parse(h["min-fraction-digits"],1,st),!v))return null;let T=null;return h["max-fraction-digits"]&&(T=r.parse(h["max-fraction-digits"],1,st),!T)?null:new Ze(l,f,m,v,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ft{constructor(e){this.type=ci,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const h=[];let f=!1;for(let m=1;m<=e.length-1;++m){const v=e[m];if(f&&typeof v=="object"&&!Array.isArray(v)){f=!1;let T=null;if(v["font-scale"]&&(T=r.parse(v["font-scale"],1,st),!T))return null;let S=null;if(v["text-font"]&&(S=r.parse(v["text-font"],1,br(At)),!S))return null;let A=null;if(v["text-color"]&&(A=r.parse(v["text-color"],1,Cr),!A))return null;let M=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!$u.includes(v["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(M=r.parse(v["vertical-align"],1,At),!M)return null}const D=h[h.length-1];D.scale=T,D.font=S,D.textColor=A,D.verticalAlign=M}else{const T=r.parse(e[m],1,Ct);if(!T)return null;const S=T.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ft(h)}evaluate(e){return new _i(this.sections.map(r=>{const l=r.content.evaluate(e);return mr(l)===os?new ds("",l,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new ds(Vs(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class cn{constructor(e){this.type=os,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const l=r.parse(e[1],1,At);return l?new cn(l):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),l=ui.fromString(r);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(r)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class hr{constructor(e){this.type=st,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ln(l.type)} instead.`):new hr(l):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Vn(`Expected value to be of type string or array, but found ${Ln(mr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const an=8192;function Fr(i,e){const r=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(r*h*an),Math.round(l*h*an)]}function hi(i,e){const r=Math.pow(2,e.z);return[(h=(i[0]/an+e.x)/r,360*h-180),(l=(i[1]/an+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,h}function es(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function yi(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Hs(i,e,r){const l=i[0]-e[0],h=i[1]-e[1],f=i[0]-r[0],m=i[1]-r[1];return l*m-f*h==0&&l*f<=0&&h*m<=0}function ro(i,e,r,l){return(h=[l[0]-r[0],l[1]-r[1]])[0]*(f=[e[0]-i[0],e[1]-i[1]])[1]-h[1]*f[0]!=0&&!(!Gu(i,e,r,l)||!Gu(r,l,i,e));var h,f}function xl(i,e,r){for(const l of r)for(let h=0;h<l.length-1;++h)if(ro(i,e,l[h],l[h+1]))return!0;return!1}function Ra(i,e,r=!1){let l=!1;for(const v of e)for(let T=0;T<v.length-1;T++){if(Hs(i,v[T],v[T+1]))return r;(f=v[T])[1]>(h=i)[1]!=(m=v[T+1])[1]>h[1]&&h[0]<(m[0]-f[0])*(h[1]-f[1])/(m[1]-f[1])+f[0]&&(l=!l)}var h,f,m;return l}function wc(i,e){for(const r of e)if(Ra(i,r))return!0;return!1}function Ad(i,e){for(const r of i)if(!Ra(r,e))return!1;for(let r=0;r<i.length-1;++r)if(xl(i[r],i[r+1],e))return!1;return!0}function Cd(i,e){for(const r of e)if(Ad(i,r))return!0;return!1}function Gu(i,e,r,l){const h=l[0]-r[0],f=l[1]-r[1],m=(i[0]-r[0])*f-h*(i[1]-r[1]),v=(e[0]-r[0])*f-h*(e[1]-r[1]);return m>0&&v<0||m<0&&v>0}function Hu(i,e,r){const l=[];for(let h=0;h<i.length;h++){const f=[];for(let m=0;m<i[h].length;m++){const v=Fr(i[h][m],r);es(e,v),f.push(v)}l.push(f)}return l}function Zu(i,e,r){const l=[];for(let h=0;h<i.length;h++){const f=Hu(i[h],e,r);l.push(f)}return l}function Md(i,e,r,l){if(i[0]<r[0]||i[0]>r[2]){const h=.5*l;let f=i[0]-r[0]>h?-l:r[0]-i[0]>h?l:0;f===0&&(f=i[0]-r[2]>h?-l:r[2]-i[0]>h?l:0),i[0]+=f}es(e,i)}function Rd(i,e,r,l){const h=Math.pow(2,l.z)*an,f=[l.x*an,l.y*an],m=[];for(const v of i)for(const T of v){const S=[T.x+f[0],T.y+f[1]];Md(S,e,r,h),m.push(S)}return m}function kd(i,e,r,l){const h=Math.pow(2,l.z)*an,f=[l.x*an,l.y*an],m=[];for(const T of i){const S=[];for(const A of T){const M=[A.x+f[0],A.y+f[1]];es(e,M),S.push(M)}m.push(S)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of m)for(const S of T)Md(S,e,r,h)}var v;return m}class Qo{constructor(e,r){this.type=Bt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ns(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const h=[];for(const f of l.features){const{type:m,coordinates:v}=f.geometry;m==="Polygon"&&h.push(v),m==="MultiPolygon"&&h.push(...v)}if(h.length)return new Qo(l,{type:"MultiPolygon",coordinates:h})}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Qo(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Qo(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(l.type==="Polygon"){const v=Hu(l.coordinates,f,m),T=Rd(r.geometry(),h,f,m);if(!yi(h,f))return!1;for(const S of T)if(!Ra(S,v))return!1}if(l.type==="MultiPolygon"){const v=Zu(l.coordinates,f,m),T=Rd(r.geometry(),h,f,m);if(!yi(h,f))return!1;for(const S of T)if(!wc(S,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(l.type==="Polygon"){const v=Hu(l.coordinates,f,m),T=kd(r.geometry(),h,f,m);if(!yi(h,f))return!1;for(const S of T)if(!Ad(S,v))return!1}if(l.type==="MultiPolygon"){const v=Zu(l.coordinates,f,m),T=kd(r.geometry(),h,f,m);if(!yi(h,f))return!1;for(const S of T)if(!Cd(S,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Dd=class{constructor(i=[],e=(r,l)=>r<l?-1:r>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:r}=this,l=e[i];for(;i>0;){const h=i-1>>1,f=e[h];if(r(l,f)>=0)break;e[i]=f,i=h}e[i]=l}_down(i){const{data:e,compare:r}=this,l=this.length>>1,h=e[i];for(;i<l;){let f=1+(i<<1);const m=f+1;if(m<this.length&&r(e[m],e[f])<0&&(f=m),r(e[f],h)>=0)break;e[i]=e[f],i=f}e[i]=h}};function Wu(i,e,r=0,l=i.length-1,h=Ld){for(;l>r;){if(l-r>600){const T=l-r+1,S=e-r+1,A=Math.log(T),M=.5*Math.exp(2*A/3),D=.5*Math.sqrt(A*M*(T-M)/T)*(S-T/2<0?-1:1);Wu(i,e,Math.max(r,Math.floor(e-S*M/T+D)),Math.min(l,Math.floor(e+(T-S)*M/T+D)),h)}const f=i[e];let m=r,v=l;for(ka(i,r,e),h(i[l],f)>0&&ka(i,r,l);m<v;){for(ka(i,m,v),m++,v--;h(i[m],f)<0;)m++;for(;h(i[v],f)>0;)v--}h(i[r],f)===0?ka(i,r,v):(v++,ka(i,v,l)),v<=e&&(r=v+1),e<=v&&(l=v-1)}}function ka(i,e,r){const l=i[e];i[e]=i[r],i[r]=l}function Ld(i,e){return i<e?-1:i>e?1:0}function Tc(i,e){if(i.length<=1)return[i];const r=[];let l,h;for(const f of i){const m=om(f);m!==0&&(f.area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(l&&r.push(l),l=[f]):l.push(f))}if(l&&r.push(l),e>1)for(let f=0;f<r.length;f++)r[f].length<=e||(Wu(r[f],e,1,r[f].length-1,sm),r[f]=r[f].slice(0,e));return r}function sm(i,e){return e.area-i.area}function om(i){let e=0;for(let r,l,h=0,f=i.length,m=f-1;h<f;m=h++)r=i[h],l=i[m],e+=(l.x-r.x)*(r.y+l.y);return e}const zd=1/298.257223563,bl=zd*(2-zd),Fd=Math.PI/180;class Ku{constructor(e){const r=6378.137*Fd*1e3,l=Math.cos(e*Fd),h=1/(1-bl*(1-l*l)),f=Math.sqrt(h);this.kx=r*f*l,this.ky=r*f*h*(1-bl)}distance(e,r){const l=this.wrap(e[0]-r[0])*this.kx,h=(e[1]-r[1])*this.ky;return Math.sqrt(l*l+h*h)}pointOnLine(e,r){let l,h,f,m,v=1/0;for(let T=0;T<e.length-1;T++){let S=e[T][0],A=e[T][1],M=this.wrap(e[T+1][0]-S)*this.kx,D=(e[T+1][1]-A)*this.ky,z=0;M===0&&D===0||(z=(this.wrap(r[0]-S)*this.kx*M+(r[1]-A)*this.ky*D)/(M*M+D*D),z>1?(S=e[T+1][0],A=e[T+1][1]):z>0&&(S+=M/this.kx*z,A+=D/this.ky*z)),M=this.wrap(r[0]-S)*this.kx,D=(r[1]-A)*this.ky;const V=M*M+D*D;V<v&&(v=V,l=S,h=A,f=T,m=z)}return{point:[l,h],index:f,t:Math.max(0,Math.min(1,m))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Od(i,e){return e[0]-i[0]}function Ec(i){return i[1]-i[0]+1}function Es(i,e){return i[1]>=i[0]&&i[1]<e}function Ic(i,e){if(i[0]>i[1])return[null,null];const r=Ec(i);if(e){if(r===2)return[i,null];const h=Math.floor(r/2);return[[i[0],i[0]+h],[i[0]+h,i[1]]]}if(r===1)return[i,null];const l=Math.floor(r/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function Xu(i,e){if(!Es(e,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)es(r,i[l]);return r}function Yu(i){const e=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const l of r)es(e,l);return e}function Qu(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Sc(i,e,r){if(!Qu(i)||!Qu(e))return NaN;let l=0,h=0;return i[2]<e[0]&&(l=e[0]-i[2]),i[0]>e[2]&&(l=i[0]-e[2]),i[1]>e[3]&&(h=i[1]-e[3]),i[3]<e[1]&&(h=e[1]-i[3]),r.distance([0,0],[l,h])}function Jo(i,e,r){const l=r.pointOnLine(e,i);return r.distance(i,l.point)}function Ju(i,e,r,l,h){const f=Math.min(Jo(i,[r,l],h),Jo(e,[r,l],h)),m=Math.min(Jo(r,[i,e],h),Jo(l,[i,e],h));return Math.min(f,m)}function am(i,e,r,l,h){if(!Es(e,i.length)||!Es(l,r.length))return 1/0;let f=1/0;for(let m=e[0];m<e[1];++m){const v=i[m],T=i[m+1];for(let S=l[0];S<l[1];++S){const A=r[S],M=r[S+1];if(ro(v,T,A,M))return 0;f=Math.min(f,Ju(v,T,A,M,h))}}return f}function Nd(i,e,r,l,h){if(!Es(e,i.length)||!Es(l,r.length))return NaN;let f=1/0;for(let m=e[0];m<=e[1];++m)for(let v=l[0];v<=l[1];++v)if(f=Math.min(f,h.distance(i[m],r[v])),f===0)return f;return f}function lm(i,e,r){if(Ra(i,e,!0))return 0;let l=1/0;for(const h of e){const f=h[0],m=h[h.length-1];if(f!==m&&(l=Math.min(l,Jo(i,[m,f],r)),l===0))return l;const v=r.pointOnLine(h,i);if(l=Math.min(l,r.distance(i,v.point)),l===0)return l}return l}function cm(i,e,r,l){if(!Es(e,i.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Ra(i[f],r,!0))return 0;let h=1/0;for(let f=e[0];f<e[1];++f){const m=i[f],v=i[f+1];for(const T of r)for(let S=0,A=T.length,M=A-1;S<A;M=S++){const D=T[M],z=T[S];if(ro(m,v,D,z))return 0;h=Math.min(h,Ju(m,v,D,z,l))}}return h}function Vd(i,e){for(const r of i)for(const l of r)if(Ra(l,e,!0))return!0;return!1}function um(i,e,r,l=1/0){const h=Yu(i),f=Yu(e);if(l!==1/0&&Sc(h,f,r)>=l)return l;if(yi(h,f)){if(Vd(i,e))return 0}else if(Vd(e,i))return 0;let m=1/0;for(const v of i)for(let T=0,S=v.length,A=S-1;T<S;A=T++){const M=v[A],D=v[T];for(const z of e)for(let V=0,U=z.length,$=U-1;V<U;$=V++){const X=z[$],ae=z[V];if(ro(M,D,X,ae))return 0;m=Math.min(m,Ju(M,D,X,ae,r))}}return m}function Gn(i,e,r,l,h,f){if(!f)return;const m=Sc(Xu(l,f),h,r);m<e&&i.push([m,f,[0,0]])}function Pc(i,e,r,l,h,f,m){if(!f||!m)return;const v=Sc(Xu(l,f),Xu(h,m),r);v<e&&i.push([v,f,m])}function Ac(i,e,r,l,h=1/0){let f=Math.min(l.distance(i[0],r[0][0]),h);if(f===0)return f;const m=new Dd([[0,[0,i.length-1],[0,0]]],Od),v=Yu(r);for(;m.length>0;){const T=m.pop();if(T[0]>=f)continue;const S=T[1],A=e?50:100;if(Ec(S)<=A){if(!Es(S,i.length))return NaN;if(e){const M=cm(i,S,r,l);if(isNaN(M)||M===0)return M;f=Math.min(f,M)}else for(let M=S[0];M<=S[1];++M){const D=lm(i[M],r,l);if(f=Math.min(f,D),f===0)return 0}}else{const M=Ic(S,e);Gn(m,f,l,i,v,M[0]),Gn(m,f,l,i,v,M[1])}}return f}function Cc(i,e,r,l,h,f=1/0){let m=Math.min(f,h.distance(i[0],r[0]));if(m===0)return m;const v=new Dd([[0,[0,i.length-1],[0,r.length-1]]],Od);for(;v.length>0;){const T=v.pop();if(T[0]>=m)continue;const S=T[1],A=T[2],M=e?50:100,D=l?50:100;if(Ec(S)<=M&&Ec(A)<=D){if(!Es(S,i.length)&&Es(A,r.length))return NaN;let z;if(e&&l)z=am(i,S,r,A,h),m=Math.min(m,z);else if(e&&!l){const V=i.slice(S[0],S[1]+1);for(let U=A[0];U<=A[1];++U)if(z=Jo(r[U],V,h),m=Math.min(m,z),m===0)return m}else if(!e&&l){const V=r.slice(A[0],A[1]+1);for(let U=S[0];U<=S[1];++U)if(z=Jo(i[U],V,h),m=Math.min(m,z),m===0)return m}else z=Nd(i,S,r,A,h),m=Math.min(m,z)}else{const z=Ic(S,e),V=Ic(A,l);Pc(v,m,h,i,r,z[0],V[0]),Pc(v,m,h,i,r,z[0],V[1]),Pc(v,m,h,i,r,z[1],V[0]),Pc(v,m,h,i,r,z[1],V[1])}}return m}function eh(i){return i.type==="MultiPolygon"?i.coordinates.map(e=>({type:"Polygon",coordinates:e})):i.type==="MultiLineString"?i.coordinates.map(e=>({type:"LineString",coordinates:e})):i.type==="MultiPoint"?i.coordinates.map(e=>({type:"Point",coordinates:e})):[i]}class ea{constructor(e,r){this.type=st,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ns(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new ea(l,l.features.map(h=>eh(h.geometry)).flat());if(l.type==="Feature")return new ea(l,eh(l.geometry));if("type"in l&&"coordinates"in l)return new ea(l,eh(l))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,l){const h=r.geometry(),f=h.flat().map(T=>hi([T.x,T.y],r.canonical));if(h.length===0)return NaN;const m=new Ku(f[0][1]);let v=1/0;for(const T of l){switch(T.type){case"Point":v=Math.min(v,Cc(f,!1,[T.coordinates],!1,m,v));break;case"LineString":v=Math.min(v,Cc(f,!1,T.coordinates,!0,m,v));break;case"Polygon":v=Math.min(v,Ac(f,!1,T.coordinates,m,v))}if(v===0)return v}return v}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,l){const h=r.geometry(),f=h.flat().map(T=>hi([T.x,T.y],r.canonical));if(h.length===0)return NaN;const m=new Ku(f[0][1]);let v=1/0;for(const T of l){switch(T.type){case"Point":v=Math.min(v,Cc(f,!0,[T.coordinates],!1,m,v));break;case"LineString":v=Math.min(v,Cc(f,!0,T.coordinates,!0,m,v));break;case"Polygon":v=Math.min(v,Ac(f,!0,T.coordinates,m,v))}if(v===0)return v}return v}(e,this.geometries);if(e.geometryType()==="Polygon")return function(r,l){const h=r.geometry();if(h.length===0||h[0].length===0)return NaN;const f=Tc(h,0).map(T=>T.map(S=>S.map(A=>hi([A.x,A.y],r.canonical)))),m=new Ku(f[0][0][0][1]);let v=1/0;for(const T of l)for(const S of f){switch(T.type){case"Point":v=Math.min(v,Ac([T.coordinates],!1,S,m,v));break;case"LineString":v=Math.min(v,Ac(T.coordinates,!0,S,m,v));break;case"Polygon":v=Math.min(v,um(S,T.coordinates,m,v))}if(v===0)return v}return v}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class wl{constructor(e){this.type=Ct,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=e[1];return l==null?r.error("Global state property must be defined."):typeof l!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new wl(l)}evaluate(e){var r;const l=(r=e.globals)===null||r===void 0?void 0:r.globalState;return l&&Object.keys(l).length!==0?Xi(l,this.key):null}eachChild(){}outputDefined(){return!1}}const Da={"==":vl,"!=":Gs,">":L,"<":E,">=":ne,"<=":j,array:Er,at:vn,boolean:Er,case:To,coalesce:$s,collator:ze,format:ft,image:cn,in:ln,"index-of":no,interpolate:Jr,"interpolate-hcl":Jr,"interpolate-lab":Jr,length:hr,let:$n,literal:Qi,match:xn,number:Er,"number-format":Ze,object:Er,slice:Ii,step:ps,string:Er,"to-boolean":ws,"to-color":ws,"to-number":ws,"to-string":ws,var:to,within:Qo,distance:ea,"global-state":wl};class fs{constructor(e,r,l,h){this.name=e,this.type=r,this._evaluate=l,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const l=e[0],h=fs.definitions[l];if(!h)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=m.filter(([S])=>!Array.isArray(S)||S.length===e.length-1);let T=null;for(const[S,A]of v){T=new Ts(r.registry,Mc,r.path,null,r.scope);const M=[];let D=!1;for(let z=1;z<e.length;z++){const V=e[z],U=Array.isArray(S)?S[z-1]:S.type,$=T.parse(V,1+M.length,U);if(!$){D=!0;break}M.push($)}if(!D)if(Array.isArray(S)&&S.length!==M.length)T.error(`Expected ${S.length} arguments, but found ${M.length} instead.`);else{for(let z=0;z<M.length;z++){const V=Array.isArray(S)?S[z]:S.type,U=M[z];T.concat(z+1).checkSubtype(V,U.type)}if(T.errors.length===0)return new fs(l,f,A,M)}}if(v.length===1)r.errors.push(...T.errors);else{const S=(v.length?v:m).map(([M])=>{return D=M,Array.isArray(D)?`(${D.map(Ln).join(", ")})`:`(${Ln(D.type)}...)`;var D}).join(" | "),A=[];for(let M=1;M<e.length;M++){const D=r.parse(e[M],1+A.length);if(!D)return null;A.push(Ln(D.type))}r.error(`Expected arguments of type ${S}, but found (${A.join(", ")}) instead.`)}return null}static register(e,r){fs.definitions=r;for(const l in r)e[l]=fs}}function Bd(i,[e,r,l,h]){e=e.evaluate(i),r=r.evaluate(i),l=l.evaluate(i);const f=h?h.evaluate(i):1,m=bo(e,r,l,f);if(m)throw new Vn(m);return new gn(e/255,r/255,l/255,f,!1)}function Ud(i,e){return i in e}function th(i,e){const r=e[i];return r===void 0?null:r}function ta(i){return{type:i}}function Mc(i){if(i instanceof to)return Mc(i.boundExpression);if(i instanceof fs&&i.name==="error"||i instanceof ze||i instanceof Qo||i instanceof ea||i instanceof wl)return!1;const e=i instanceof ws||i instanceof Er;let r=!0;return i.eachChild(l=>{r=e?r&&Mc(l):r&&l instanceof Qi}),!!r&&Rc(i)&&kc(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Rc(i){if(i instanceof fs&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Qo||i instanceof ea)return!1;let e=!0;return i.eachChild(r=>{e&&!Rc(r)&&(e=!1)}),e}function Tl(i){if(i instanceof fs&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Tl(r)&&(e=!1)}),e}function kc(i,e){if(i instanceof fs&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(l=>{r&&!kc(l,e)&&(r=!1)}),r}function jd(i){return{result:"success",value:i}}function La(i){return{result:"error",value:i}}function za(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function qd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function nh(i){return!!i.expression&&i.expression.interpolated}function bn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Dc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&mr(i)===er}function hm(i){return i}function $d(i,e){const r=i.stops&&typeof i.stops[0][0]=="object",l=r||!(r||i.property!==void 0),h=i.type||(nh(e)?"exponential":"interval"),f=function(A){switch(A.type){case"color":return gn.parse;case"padding":return jr.parse;case"numberArray":return Qn.parse;case"colorArray":return qt.parse;default:return null}}(e);if(f&&((i=xr({},i)).stops&&(i.stops=i.stops.map(A=>[A[0],f(A[1])])),i.default=f(i.default?i.default:e.default)),i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;const v=function(A){switch(A){case"exponential":return Gd;case"interval":return pm;case"categorical":return dm;case"identity":return fm;default:throw new Error(`Unknown function type "${A}"`)}}(h);let T,S;if(h==="categorical"){T=Object.create(null);for(const A of i.stops)T[A[0]]=A[1];S=typeof i.stops[0][0]}if(r){const A={},M=[];for(let V=0;V<i.stops.length;V++){const U=i.stops[V],$=U[0].zoom;A[$]===void 0&&(A[$]={zoom:$,type:i.type,property:i.property,default:i.default,stops:[]},M.push($)),A[$].stops.push([U[0].value,U[1]])}const D=[];for(const V of M)D.push([A[V].zoom,$d(A[V],e)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Jr.interpolationFactor.bind(void 0,z),zoomStops:D.map(V=>V[0]),evaluate:({zoom:V},U)=>Gd({stops:D,base:i.base},e,V).evaluate(V,U)}}if(l){const A=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Jr.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>v(i,e,M,T,S)}}return{kind:"source",evaluate(A,M){const D=M&&M.properties?M.properties[i.property]:void 0;return D===void 0?El(i.default,e.default):v(i,e,D,T,S)}}}function El(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function dm(i,e,r,l,h){return El(typeof r===h?l[r]:void 0,i.default,e.default)}function pm(i,e,r){if(bn(r)!=="number")return El(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const h=Us(i.stops.map(f=>f[0]),r);return i.stops[h][1]}function Gd(i,e,r){const l=i.base!==void 0?i.base:1;if(bn(r)!=="number")return El(i.default,e.default);const h=i.stops.length;if(h===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[h-1][0])return i.stops[h-1][1];const f=Us(i.stops.map(A=>A[0]),r),m=function(A,M,D,z){const V=z-D,U=A-D;return V===0?0:M===1?U/V:(Math.pow(M,U)-1)/(Math.pow(M,V)-1)}(r,l,i.stops[f][0],i.stops[f+1][0]),v=i.stops[f][1],T=i.stops[f+1][1],S=tr[e.type]||hm;return typeof v.evaluate=="function"?{evaluate(...A){const M=v.evaluate.apply(void 0,A),D=T.evaluate.apply(void 0,A);if(M!==void 0&&D!==void 0)return S(M,D,m,i.colorSpace)}}:S(v,T,m,i.colorSpace)}function fm(i,e,r){switch(e.type){case"color":r=gn.parse(r);break;case"formatted":r=_i.fromString(r.toString());break;case"resolvedImage":r=ui.fromString(r.toString());break;case"padding":r=jr.parse(r);break;case"colorArray":r=qt.parse(r);break;case"numberArray":r=Qn.parse(r);break;default:bn(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return El(r,i.default,e.default)}fs.register(Da,{error:[{kind:"error"},[At],(i,[e])=>{throw new Vn(e.evaluate(i))}],typeof:[At,[Ct],(i,[e])=>Ln(mr(e.evaluate(i)))],"to-rgba":[br(st,4),[Cr],(i,[e])=>{const[r,l,h,f]=e.evaluate(i).rgb;return[255*r,255*l,255*h,f]}],rgb:[Cr,[st,st,st],Bd],rgba:[Cr,[st,st,st,st],Bd],has:{type:Bt,overloads:[[[At],(i,[e])=>Ud(e.evaluate(i),i.properties())],[[At,er],(i,[e,r])=>Ud(e.evaluate(i),r.evaluate(i))]]},get:{type:Ct,overloads:[[[At],(i,[e])=>th(e.evaluate(i),i.properties())],[[At,er],(i,[e,r])=>th(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Ct,[At],(i,[e])=>th(e.evaluate(i),i.featureState||{})],properties:[er,[],i=>i.properties()],"geometry-type":[At,[],i=>i.geometryType()],id:[Ct,[],i=>i.id()],zoom:[st,[],i=>i.globals.zoom],"heatmap-density":[st,[],i=>i.globals.heatmapDensity||0],elevation:[st,[],i=>i.globals.elevation||0],"line-progress":[st,[],i=>i.globals.lineProgress||0],accumulated:[Ct,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[st,ta(st),(i,e)=>{let r=0;for(const l of e)r+=l.evaluate(i);return r}],"*":[st,ta(st),(i,e)=>{let r=1;for(const l of e)r*=l.evaluate(i);return r}],"-":{type:st,overloads:[[[st,st],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[st],(i,[e])=>-e.evaluate(i)]]},"/":[st,[st,st],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[st,[st,st],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[st,[st],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[st,[st],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[st,[st],(i,[e])=>Math.log(e.evaluate(i))],log2:[st,[st],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[st,[st],(i,[e])=>Math.sin(e.evaluate(i))],cos:[st,[st],(i,[e])=>Math.cos(e.evaluate(i))],tan:[st,[st],(i,[e])=>Math.tan(e.evaluate(i))],asin:[st,[st],(i,[e])=>Math.asin(e.evaluate(i))],acos:[st,[st],(i,[e])=>Math.acos(e.evaluate(i))],atan:[st,[st],(i,[e])=>Math.atan(e.evaluate(i))],min:[st,ta(st),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[st,ta(st),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[st,[st],(i,[e])=>Math.abs(e.evaluate(i))],round:[st,[st],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[st,[st],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[st,[st],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Bt,[At,Ct],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Bt,[Ct],(i,[e])=>i.id()===e.value],"filter-type-==":[Bt,[At],(i,[e])=>i.geometryType()===e.value],"filter-<":[Bt,[At,Ct],(i,[e,r])=>{const l=i.properties()[e.value],h=r.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Bt,[Ct],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[Bt,[At,Ct],(i,[e,r])=>{const l=i.properties()[e.value],h=r.value;return typeof l==typeof h&&l>h}],"filter-id->":[Bt,[Ct],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[Bt,[At,Ct],(i,[e,r])=>{const l=i.properties()[e.value],h=r.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Bt,[Ct],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[Bt,[At,Ct],(i,[e,r])=>{const l=i.properties()[e.value],h=r.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Bt,[Ct],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[Bt,[Ct],(i,[e])=>e.value in i.properties()],"filter-has-id":[Bt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Bt,[br(At)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Bt,[br(Ct)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Bt,[At,br(Ct)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Bt,[At,br(Ct)],(i,[e,r])=>function(l,h,f,m){for(;f<=m;){const v=f+m>>1;if(h[v]===l)return!0;h[v]>l?m=v-1:f=v+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Bt,overloads:[[[Bt,Bt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[ta(Bt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Bt,overloads:[[[Bt,Bt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[ta(Bt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Bt,[Bt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Bt,[At],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[At,[At],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[At,[At],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[At,ta(Ct),(i,e)=>e.map(r=>Vs(r.evaluate(i))).join("")],"resolved-locale":[At,[Kn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class rh{constructor(e,r,l){this.expression=e,this._warningHistory={},this._evaluator=new Ca,this._defaultValue=r?function(h){if(h.type==="color"&&Dc(h.default))return new gn(0,0,0,0);switch(h.type){case"color":return gn.parse(h.default)||null;case"padding":return jr.parse(h.default)||null;case"numberArray":return Qn.parse(h.default)||null;case"colorArray":return qt.parse(h.default)||null;case"variableAnchorOffsetCollection":return Qr.parse(h.default)||null;case"projectionDefinition":return kn.parse(h.default)||null;default:return h.default===void 0?null:h.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=l}evaluateWithoutErrorHandling(e,r,l,h,f,m){return this._globalState&&(e=na(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,h,f,m){this._globalState&&(e=na(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Vn(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Fa(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Da}function Il(i,e,r){const l=new Ts(Da,Mc,[],e?function(f){const m={color:Cr,string:At,number:st,enum:At,boolean:Bt,formatted:ci,padding:Di,numberArray:Wi,colorArray:Kr,projectionDefinition:ki,resolvedImage:os,variableAnchorOffsetCollection:Li};return f.type==="array"?br(m[f.value]||Ct,f.length):m[f.type]}(e):void 0),h=l.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?jd(new rh(h,e,r)):La(l.errors)}class Lc{constructor(e,r,l){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Tl(r.expression),this.globalStateRefs=Io(r.expression),this._globalState=l}evaluateWithoutErrorHandling(e,r,l,h,f,m){return this._globalState&&(e=na(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,l,h,f,m)}evaluate(e,r,l,h,f,m){return this._globalState&&(e=na(e,this._globalState)),this._styleExpression.evaluate(e,r,l,h,f,m)}}class ih{constructor(e,r,l,h,f){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Tl(r.expression),this.globalStateRefs=Io(r.expression),this.interpolationType=h,this._globalState=f}evaluateWithoutErrorHandling(e,r,l,h,f,m){return this._globalState&&(e=na(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,l,h,f,m)}evaluate(e,r,l,h,f,m){return this._globalState&&(e=na(e,this._globalState)),this._styleExpression.evaluate(e,r,l,h,f,m)}interpolationFactor(e,r,l){return this.interpolationType?Jr.interpolationFactor(this.interpolationType,e,r,l):0}}function sh(i,e,r){const l=Il(i,e,r);if(l.result==="error")return l;const h=l.value.expression,f=Rc(h);if(!f&&!za(e))return La([new Yn("","data expressions not supported")]);const m=kc(h,["zoom"]);if(!m&&!qd(e))return La([new Yn("","zoom expressions not supported")]);const v=Fc(h);return v||m?v instanceof Yn?La([v]):v instanceof Jr&&!nh(e)?La([new Yn("",'"interpolate" expressions cannot be used with this property')]):jd(v?new ih(f?"camera":"composite",l.value,v.labels,v instanceof Jr?v.interpolation:void 0,r):new Lc(f?"constant":"source",l.value,r)):La([new Yn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zc{constructor(e,r){this._parameters=e,this._specification=r,xr(this,$d(this._parameters,this._specification))}static deserialize(e){return new zc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Fc(i){let e=null;if(i instanceof $n)e=Fc(i.result);else if(i instanceof $s){for(const r of i.args)if(e=Fc(r),e)break}else(i instanceof ps||i instanceof Jr)&&i.input instanceof fs&&i.input.name==="zoom"&&(e=i);return e instanceof Yn||i.eachChild(r=>{const l=Fc(r);l instanceof Yn?e=l:!e&&l?e=new Yn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Yn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Io(i,e=new Set){return i instanceof wl&&e.add(i.key),i.eachChild(r=>{Io(r,e)}),e}function na(i,e){const{zoom:r,heatmapDensity:l,elevation:h,lineProgress:f,isSupportedScript:m,accumulated:v}=i??{};return{zoom:r,heatmapDensity:l,elevation:h,lineProgress:f,isSupportedScript:m,accumulated:v,globalState:e}}function oh(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!oh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const mm={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Sl(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};oh(i)||(i=Pl(i));const r=Il(i,mm,e);if(r.result==="error")throw new Error(r.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,h,f)=>r.value.evaluate(l,h,{},f),needGeometry:Hd(i),getGlobalStateRefs:()=>Io(r.value.expression)}}function gm(i,e){return i<e?-1:i>e?1:0}function Hd(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Hd(i[e]))return!0;return!1}function Pl(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Oc(i[1],i[2],"=="):e==="!="?Al(Oc(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Oc(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Pl))):e==="all"?["all"].concat(i.slice(1).map(Pl)):e==="none"?["all"].concat(i.slice(1).map(Pl).map(Al)):e==="in"?Zd(i[1],i.slice(2)):e==="!in"?Al(Zd(i[1],i.slice(2))):e==="has"?Wd(i[1]):e!=="!has"||Al(Wd(i[1]));var r}function Oc(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Zd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(gm)]]:["filter-in-small",i,["literal",e]]}}function Wd(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Al(i){return["!",i]}function Nc(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let h="[";for(const f of i)h+=`${Nc(f)},`;return`${h}]`}const r=Object.keys(i).sort();let l="{";for(let h=0;h<r.length;h++)l+=`${JSON.stringify(r[h])}:${Nc(i[r[h]])},`;return`${l}}`}function Kd(i){let e="";for(const r of tn)e+=`/${Nc(i[r])}`;return e}function Xd(i){const e=i.value;return e?[new We(i.key,e,"constants have been deprecated as of v8")]:[]}function Rr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ra(i){if(Array.isArray(i))return i.map(ra);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=ra(i[r]);return e}return Rr(i)}function ts(i){const e=i.key,r=i.value,l=i.valueSpec||{},h=i.objectElementValidators||{},f=i.style,m=i.styleSpec,v=i.validateSpec;let T=[];const S=bn(r);if(S!=="object")return[new We(e,r,`object expected, ${S} found`)];for(const A in r){const M=A.split(".")[0],D=Xi(l,M)||l["*"];let z;if(Xi(h,M))z=h[M];else if(Xi(l,M)){if(r[A]===void 0)continue;z=v}else if(h["*"])z=h["*"];else{if(!l["*"]){T.push(new We(e,r[A],`unknown property "${A}"`));continue}z=v}T=T.concat(z({key:(e&&`${e}.`)+A,value:r[A],valueSpec:D,style:f,styleSpec:m,object:r,objectKey:A,validateSpec:v},r))}for(const A in l)h[A]||l[A].required&&l[A].default===void 0&&r[A]===void 0&&T.push(new We(e,r,`missing required property "${A}"`));return T}function Vc(i){const e=i.value,r=i.valueSpec,l=i.style,h=i.styleSpec,f=i.key,m=i.arrayElementValidator||i.validateSpec;if(bn(e)!=="array")return[new We(f,e,`array expected, ${bn(e)} found`)];if(r.length&&e.length!==r.length)return[new We(f,e,`array length ${r.length} expected, length ${e.length} found`)];let v={type:r.value,values:r.values};h.$version<7&&(v.function=r.function),bn(r.value)==="object"&&(v=r.value);let T=[];for(let S=0;S<e.length;S++)T=T.concat(m({array:e,arrayIndex:S,value:e[S],valueSpec:v,validateSpec:i.validateSpec,style:l,styleSpec:h,key:`${f}[${S}]`}));return T}function Cl(i){const e=i.key,r=i.value,l=i.valueSpec;let h=bn(r);return h==="number"&&r!=r&&(h="NaN"),h!=="number"?[new We(e,r,`number expected, ${h} found`)]:"minimum"in l&&r<l.minimum?[new We(e,r,`${r} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&r>l.maximum?[new We(e,r,`${r} is greater than the maximum value ${l.maximum}`)]:[]}function Bc(i){const e=i.valueSpec,r=Rr(i.value.type);let l,h,f,m={};const v=r!=="categorical"&&i.value.property===void 0,T=!v,S=bn(i.value.stops)==="array"&&bn(i.value.stops[0])==="array"&&bn(i.value.stops[0][0])==="object",A=ts({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if(r==="identity")return[new We(z.key,z.value,'identity function may not have a "stops" property')];let V=[];const U=z.value;return V=V.concat(Vc({key:z.key,value:U,valueSpec:z.valueSpec,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:M})),bn(U)==="array"&&U.length===0&&V.push(new We(z.key,U,"array must have at least one stop")),V},default:function(z){return z.validateSpec({key:z.key,value:z.value,valueSpec:e,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec})}}});return r==="identity"&&v&&A.push(new We(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||A.push(new We(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!nh(i.valueSpec)&&A.push(new We(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!za(i.valueSpec)?A.push(new We(i.key,i.value,"property functions not supported")):v&&!qd(i.valueSpec)&&A.push(new We(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!S||i.value.property!==void 0||A.push(new We(i.key,i.value,'"property" property is required')),A;function M(z){let V=[];const U=z.value,$=z.key;if(bn(U)!=="array")return[new We($,U,`array expected, ${bn(U)} found`)];if(U.length!==2)return[new We($,U,`array length 2 expected, length ${U.length} found`)];if(S){if(bn(U[0])!=="object")return[new We($,U,`object expected, ${bn(U[0])} found`)];if(U[0].zoom===void 0)return[new We($,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new We($,U,"object stop key must have value")];if(f&&f>Rr(U[0].zoom))return[new We($,U[0].zoom,"stop zoom values must appear in ascending order")];Rr(U[0].zoom)!==f&&(f=Rr(U[0].zoom),h=void 0,m={}),V=V.concat(ts({key:`${$}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Cl,value:D}}))}else V=V.concat(D({key:`${$}[0]`,value:U[0],validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec},U));return Fa(ra(U[1]))?V.concat([new We(`${$}[1]`,U[1],"expressions are not allowed in function stops.")]):V.concat(z.validateSpec({key:`${$}[1]`,value:U[1],valueSpec:e,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec}))}function D(z,V){const U=bn(z.value),$=Rr(z.value),X=z.value!==null?z.value:V;if(l){if(U!==l)return[new We(z.key,X,`${U} stop domain type must match previous stop domain type ${l}`)]}else l=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new We(z.key,X,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&r!=="categorical"){let ae=`number expected, ${U} found`;return za(e)&&r===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(z.key,X,ae)]}return r!=="categorical"||U!=="number"||isFinite($)&&Math.floor($)===$?r!=="categorical"&&U==="number"&&h!==void 0&&$<h?[new We(z.key,X,"stop domain values must appear in ascending order")]:(h=$,r==="categorical"&&$ in m?[new We(z.key,X,"stop domain values must be unique")]:(m[$]=!0,[])):[new We(z.key,X,`integer expected, found ${$}`)]}}function So(i){const e=(i.expressionContext==="property"?sh:Il)(ra(i.value),i.valueSpec);if(e.result==="error")return e.value.map(l=>new We(`${i.key}${l.key}`,i.value,l.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new We(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Tl(r))return[new We(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Tl(r))return[new We(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!kc(r,["zoom","feature-state"]))return[new We(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Rc(r))return[new We(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ml(i){const e=i.key,r=i.value,l=bn(r);return l!=="string"?[new We(e,r,`color expected, ${l} found`)]:gn.parse(String(r))?[]:[new We(e,r,`color expected, "${r}" found`)]}function ia(i){const e=i.key,r=i.value,l=i.valueSpec,h=[];return Array.isArray(l.values)?l.values.indexOf(Rr(r))===-1&&h.push(new We(e,r,`expected one of [${l.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(l.values).indexOf(Rr(r))===-1&&h.push(new We(e,r,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function Oa(i){return oh(ra(i.value))?So(xr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Yd(i)}function Yd(i){const e=i.value,r=i.key;if(bn(e)!=="array")return[new We(r,e,`array expected, ${bn(e)} found`)];const l=i.styleSpec;let h,f=[];if(e.length<1)return[new We(r,e,"filter array must have at least 1 element")];switch(f=f.concat(ia({key:`${r}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Rr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Rr(e[1])==="$type"&&f.push(new We(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new We(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=bn(e[1]),h!=="string"&&f.push(new We(`${r}[1]`,e[1],`string expected, ${h} found`)));for(let m=2;m<e.length;m++)h=bn(e[m]),Rr(e[1])==="$type"?f=f.concat(ia({key:`${r}[${m}]`,value:e[m],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&f.push(new We(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(Yd({key:`${r}[${m}]`,value:e[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=bn(e[1]),e.length!==2?f.push(new We(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&f.push(new We(`${r}[1]`,e[1],`string expected, ${h} found`))}return f}function Qd(i,e){const r=i.key,l=i.validateSpec,h=i.style,f=i.styleSpec,m=i.value,v=i.objectKey,T=f[`${e}_${i.layerType}`];if(!T)return[];const S=v.match(/^(.*)-transition$/);if(e==="paint"&&S&&T[S[1]]&&T[S[1]].transition)return l({key:r,value:m,valueSpec:f.transition,style:h,styleSpec:f});const A=i.valueSpec||T[v];if(!A)return[new We(r,m,`unknown property "${v}"`)];let M;if(bn(m)==="string"&&za(A)&&!A.tokens&&(M=/^{([^}]+)}$/.exec(m)))return[new We(r,m,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&v==="text-font"&&Dc(ra(m))&&Rr(m.type)==="identity"&&D.push(new We(r,m,'"text-font" does not support identity functions')),D.concat(l({key:i.key,value:m,valueSpec:A,style:h,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:v}))}function Jd(i){return Qd(i,"paint")}function ep(i){return Qd(i,"layout")}function tp(i){let e=[];const r=i.value,l=i.key,h=i.style,f=i.styleSpec;if(bn(r)!=="object")return[new We(l,r,`object expected, ${bn(r)} found`)];r.type||r.ref||e.push(new We(l,r,'either "type" or "ref" is required'));let m=Rr(r.type);const v=Rr(r.ref);if(r.id){const T=Rr(r.id);for(let S=0;S<i.arrayIndex;S++){const A=h.layers[S];Rr(A.id)===T&&e.push(new We(l,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let T;["type","source","source-layer","filter","layout"].forEach(S=>{S in r&&e.push(new We(l,r[S],`"${S}" is prohibited for ref layers`))}),h.layers.forEach(S=>{Rr(S.id)===v&&(T=S)}),T?T.ref?e.push(new We(l,r.ref,"ref cannot reference another ref layer")):m=Rr(T.type):e.push(new We(l,r.ref,`ref layer "${v}" not found`))}else if(m!=="background")if(r.source){const T=h.sources&&h.sources[r.source],S=T&&Rr(T.type);T?S==="vector"&&m==="raster"?e.push(new We(l,r.source,`layer "${r.id}" requires a raster source`)):S!=="raster-dem"&&m==="hillshade"||S!=="raster-dem"&&m==="color-relief"?e.push(new We(l,r.source,`layer "${r.id}" requires a raster-dem source`)):S==="raster"&&m!=="raster"?e.push(new We(l,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&m!=="hillshade"&&m!=="color-relief"?e.push(new We(l,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||S==="geojson"&&T.lineMetrics||e.push(new We(l,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new We(l,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new We(l,r.source,`source "${r.source}" not found`))}else e.push(new We(l,r,'missing required property "source"'));return e=e.concat(ts({key:l,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Oa,layout:T=>ts({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":S=>ep(xr({layerType:m},S))}}),paint:T=>ts({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":S=>Jd(xr({layerType:m},S))}})}})),e}function Po(i){const e=i.value,r=i.key,l=bn(e);return l!=="string"?[new We(r,e,`string expected, ${l} found`)]:[]}const ah={promoteId:function({key:i,value:e}){if(bn(e)==="string")return Po({key:i,value:e});{const r=[];for(const l in e)r.push(...Po({key:`${i}.${l}`,value:e[l]}));return r}}};function lh(i){const e=i.value,r=i.key,l=i.styleSpec,h=i.style,f=i.validateSpec;if(!e.type)return[new We(r,e,'"type" is required')];const m=Rr(e.type);let v;switch(m){case"vector":case"raster":return v=ts({key:r,value:e,valueSpec:l[`source_${m.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:ah,validateSpec:f}),v;case"raster-dem":return v=function(T){var S;const A=(S=T.sourceName)!==null&&S!==void 0?S:"",M=T.value,D=T.styleSpec,z=D.source_raster_dem,V=T.style;let U=[];const $=bn(M);if(M===void 0)return U;if($!=="object")return U.push(new We("source_raster_dem",M,`object expected, ${$} found`)),U;const X=Rr(M.encoding)==="custom",ae=["redFactor","greenFactor","blueFactor","baseShift"],Y=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const J in M)!X&&ae.includes(J)?U.push(new We(J,M[J],`In "${A}": "${J}" is only valid when "encoding" is set to "custom". ${Y} encoding found`)):z[J]?U=U.concat(T.validateSpec({key:J,value:M[J],valueSpec:z[J],validateSpec:T.validateSpec,style:V,styleSpec:D})):U.push(new We(J,M[J],`unknown property "${J}"`));return U}({sourceName:r,value:e,style:i.style,styleSpec:l,validateSpec:f}),v;case"geojson":if(v=ts({key:r,value:e,valueSpec:l.source_geojson,style:h,styleSpec:l,validateSpec:f,objectElementValidators:ah}),e.cluster)for(const T in e.clusterProperties){const[S,A]=e.clusterProperties[T],M=typeof S=="string"?[S,["accumulated"],["get",T]]:S;v.push(...So({key:`${r}.${T}.map`,value:A,expressionContext:"cluster-map"})),v.push(...So({key:`${r}.${T}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return v;case"video":return ts({key:r,value:e,valueSpec:l.source_video,style:h,validateSpec:f,styleSpec:l});case"image":return ts({key:r,value:e,valueSpec:l.source_image,style:h,validateSpec:f,styleSpec:l});case"canvas":return[new We(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ia({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Rl(i){const e=i.value,r=i.styleSpec,l=r.light,h=i.style;let f=[];const m=bn(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new We("light",e,`object expected, ${m} found`)]),f;for(const v in e){const T=v.match(/^(.*)-transition$/);f=f.concat(T&&l[T[1]]&&l[T[1]].transition?i.validateSpec({key:v,value:e[v],valueSpec:r.transition,validateSpec:i.validateSpec,style:h,styleSpec:r}):l[v]?i.validateSpec({key:v,value:e[v],valueSpec:l[v],validateSpec:i.validateSpec,style:h,styleSpec:r}):[new We(v,e[v],`unknown property "${v}"`)])}return f}function np(i){const e=i.value,r=i.styleSpec,l=r.sky,h=i.style,f=bn(e);if(e===void 0)return[];if(f!=="object")return[new We("sky",e,`object expected, ${f} found`)];let m=[];for(const v in e)m=m.concat(l[v]?i.validateSpec({key:v,value:e[v],valueSpec:l[v],style:h,styleSpec:r}):[new We(v,e[v],`unknown property "${v}"`)]);return m}function ch(i){const e=i.value,r=i.styleSpec,l=r.terrain,h=i.style;let f=[];const m=bn(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new We("terrain",e,`object expected, ${m} found`)]),f;for(const v in e)f=f.concat(l[v]?i.validateSpec({key:v,value:e[v],valueSpec:l[v],validateSpec:i.validateSpec,style:h,styleSpec:r}):[new We(v,e[v],`unknown property "${v}"`)]);return f}function uh(i){let e=[];const r=i.value,l=i.key;if(Array.isArray(r)){const h=[],f=[];for(const m in r)r[m].id&&h.includes(r[m].id)&&e.push(new We(l,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),h.push(r[m].id),r[m].url&&f.includes(r[m].url)&&e.push(new We(l,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),f.push(r[m].url),e=e.concat(ts({key:`${l}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Po({key:l,value:r})}function rp(i){return!!i&&i.constructor===Object}function hh(i){return rp(i.value)?[]:[new We(i.key,i.value,`object expected, ${bn(i.value)} found`)]}const dh={"*":()=>[],array:Vc,boolean:function(i){const e=i.value,r=i.key,l=bn(e);return l!=="boolean"?[new We(r,e,`boolean expected, ${l} found`)]:[]},number:Cl,color:Ml,constants:Xd,enum:ia,filter:Oa,function:Bc,layer:tp,object:ts,source:lh,light:Rl,sky:np,terrain:ch,projection:function(i){const e=i.value,r=i.styleSpec,l=r.projection,h=i.style,f=bn(e);if(e===void 0)return[];if(f!=="object")return[new We("projection",e,`object expected, ${f} found`)];let m=[];for(const v in e)m=m.concat(l[v]?i.validateSpec({key:v,value:e[v],valueSpec:l[v],style:h,styleSpec:r}):[new We(v,e[v],`unknown property "${v}"`)]);return m},projectionDefinition:function(i){const e=i.key;let r=i.value;r=r instanceof String?r.valueOf():r;const l=bn(r);return l!=="array"||function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"}(r)||function(h){return!!["interpolate","step","literal"].includes(h[0])}(r)?["array","string"].includes(l)?[]:[new We(e,r,`projection expected, invalid type "${l}" found`)]:[new We(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Po,formatted:function(i){return Po(i).length===0?[]:So(i)},resolvedImage:function(i){return Po(i).length===0?[]:So(i)},padding:function(i){const e=i.key,r=i.value;if(bn(r)==="array"){if(r.length<1||r.length>4)return[new We(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const l={type:"number"};let h=[];for(let f=0;f<r.length;f++)h=h.concat(i.validateSpec({key:`${e}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:l}));return h}return Cl({key:e,value:r,valueSpec:{}})},numberArray:function(i){const e=i.key,r=i.value;if(bn(r)==="array"){const l={type:"number"};if(r.length<1)return[new We(e,r,"array length at least 1 expected, length 0 found")];let h=[];for(let f=0;f<r.length;f++)h=h.concat(i.validateSpec({key:`${e}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:l}));return h}return Cl({key:e,value:r,valueSpec:{}})},colorArray:function(i){const e=i.key,r=i.value;if(bn(r)==="array"){if(r.length<1)return[new We(e,r,"array length at least 1 expected, length 0 found")];let l=[];for(let h=0;h<r.length;h++)l=l.concat(Ml({key:`${e}[${h}]`,value:r[h]}));return l}return Ml({key:e,value:r})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,l=bn(r),h=i.styleSpec;if(l!=="array"||r.length<1||r.length%2!=0)return[new We(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<r.length;m+=2)f=f.concat(ia({key:`${e}[${m}]`,value:r[m],valueSpec:h.layout_symbol["text-anchor"]})),f=f.concat(Vc({key:`${e}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:h}));return f},sprite:uh,state:hh,fontFaces:function(i){const e=i.key,r=i.value,l=i.validateSpec,h=i.styleSpec,f=i.style;if(!rp(r))return[new We(e,r,`object expected, ${bn(r)} found`)];const m=[];for(const v in r){const T=r[v],S=bn(T);if(S==="string")m.push(...Po({key:`${e}.${v}`,value:T}));else if(S==="array"){const A={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[M,D]of T.entries())m.push(...ts({key:`${e}.${v}[${M}]`,value:D,valueSpec:A,styleSpec:h,style:f,validateSpec:l}))}else m.push(new We(`${e}.${v}`,T,`string or array expected, ${S} found`))}return m}};function Ao(i){const e=i.value,r=i.valueSpec,l=i.styleSpec;return i.validateSpec=Ao,r.expression&&Dc(Rr(e))?Bc(i):r.expression&&Fa(ra(e))?So(i):r.type&&dh[r.type]?dh[r.type](i):ts(xr({},i,{valueSpec:r.type?l[r.type]:r}))}function ip(i){const e=i.value,r=i.key,l=Po(i);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new We(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new We(r,e,'"glyphs" url must include a "{range}" token'))),l}function ms(i,e=Ce){let r=[];return r=r.concat(Ao({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Ao,objectElementValidators:{glyphs:ip,"*":()=>[]}})),i.constants&&(r=r.concat(Xd({key:"constants",value:i.constants}))),sp(r)}function Is(i){return function(e){return i(Object.assign({},e,{validateSpec:Ao}))}}function sp(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function Ss(i){return function(...e){return sp(i.apply(this,e))}}ms.source=Ss(Is(lh)),ms.sprite=Ss(Is(uh)),ms.glyphs=Ss(Is(ip)),ms.light=Ss(Is(Rl)),ms.sky=Ss(Is(np)),ms.terrain=Ss(Is(ch)),ms.state=Ss(Is(hh)),ms.layer=Ss(Is(tp)),ms.filter=Ss(Is(Oa)),ms.paintProperty=Ss(Is(Jd)),ms.layoutProperty=Ss(Is(ep));const _m={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class kl{constructor(e,r){this._globalState=r,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const r=Il(e,_m,this._globalState);if(r.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(r.value.map(l=>`${l.key}: ${l.message}`).join(", "));this._literalValue=void 0,this._compiledValue=r.value,this._globalStateRefs=Io(r.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Dl=Ce,ei=ms,Ll=ei.light,op=ei.sky,ym=ei.paintProperty,vm=ei.layoutProperty;function Na(i,e){let r=!1;if(e&&e.length)for(const l of e)i.fire(new Ht(new Error(l.message))),r=!0;return r}class Va{constructor(e,r,l){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const m=new Int32Array(this.arrayBuffer);e=m[0],this.d=(r=m[1])+2*(l=m[2]);for(let T=0;T<this.d*this.d;T++){const S=m[3+T],A=m[3+T+1];h.push(S===A?null:m.subarray(S,A))}const v=m[3+h.length+1];this.keys=m.subarray(m[3+h.length],v),this.bboxes=m.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*l;for(let m=0;m<this.d*this.d;m++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=l,this.scale=r/e,this.uid=0;const f=l/r*e;this.min=-f,this.max=e+f}insert(e,r,l,h,f){this._forEachCell(r,l,h,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,l,h,f,m){this.cells[f].push(m)}query(e,r,l,h,f){const m=this.min,v=this.max;if(e<=m&&r<=m&&v<=l&&v<=h&&!f)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,r,l,h,this._queryCell,T,{},f),T}}_queryCell(e,r,l,h,f,m,v,T){const S=this.cells[f];if(S!==null){const A=this.keys,M=this.bboxes;for(let D=0;D<S.length;D++){const z=S[D];if(v[z]===void 0){const V=4*z;(T?T(M[V+0],M[V+1],M[V+2],M[V+3]):e<=M[V+2]&&r<=M[V+3]&&l>=M[V+0]&&h>=M[V+1])?(v[z]=!0,m.push(A[z])):v[z]=!1}}}}_forEachCell(e,r,l,h,f,m,v,T){const S=this._convertToCellCoord(e),A=this._convertToCellCoord(r),M=this._convertToCellCoord(l),D=this._convertToCellCoord(h);for(let z=S;z<=M;z++)for(let V=A;V<=D;V++){const U=this.d*V+z;if((!T||T(this._convertFromCellCoord(z),this._convertFromCellCoord(V),this._convertFromCellCoord(z+1),this._convertFromCellCoord(V+1)))&&f.call(this,e,r,l,h,U,m,v,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let l=0;for(let m=0;m<this.cells.length;m++)l+=this.cells[m].length;const h=new Int32Array(r+l+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let f=r;for(let m=0;m<e.length;m++){const v=e[m];h[3+m]=f,h.set(v,f),f+=v.length}return h[3+e.length]=f,h.set(this.keys,f),f+=this.keys.length,h[3+e.length+1]=f,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer}static serialize(e,r){const l=e.toArrayBuffer();return r&&r.push(l),{buffer:l}}static deserialize(e){return new Va(e.buffer)}}const Ps={};function xt(i,e,r={}){if(Ps[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Ps[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}xt("Object",Object),xt("Set",Set),xt("TransferableGridIndex",Va),xt("Color",gn),xt("Error",Error),xt("AJAXError",we),xt("ResolvedImage",ui),xt("StylePropertyFunction",zc),xt("StyleExpression",rh,{omit:["_evaluator"]}),xt("ZoomDependentExpression",ih),xt("ZoomConstantExpression",Lc),xt("CompoundExpression",fs,{omit:["_evaluate"]});for(const i in Da)Da[i]._classRegistryKey||xt(`Expression_${i}`,Da[i]);function Uc(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ph(i){return i.$name||i.constructor._classRegistryKey}function Ba(i){return!function(e){if(e===null||typeof e!="object")return!1;const r=ph(e);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Uc(i)||jt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function zl(i,e){if(Ba(i))return(Uc(i)||jt(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const f=[];for(const m of i)f.push(zl(m,e));return f}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=ph(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Ps[r])throw new Error(`${r} is not registered.`);const{klass:l}=Ps[r],h=l.serialize?l.serialize(i,e):{};if(l.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||Ps[r].omit.indexOf(f)>=0)continue;const m=i[f];h[f]=Ps[r].shallow.indexOf(f)>=0?m:zl(m,e)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(h.$name=r),h}function Fl(i){if(Ba(i))return i;if(Array.isArray(i))return i.map(Fl);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=ph(i)||"Object";if(!Ps[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Ps[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const l=Object.create(r.prototype);for(const h of Object.keys(i)){if(h==="$name")continue;const f=i[h];l[h]=Ps[e].shallow.indexOf(h)>=0?f:Fl(f)}return l}class fh{constructor(){this.first=!0}update(e,r){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}function Ol(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function mh(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function ap(i){return/\s/u.test(String.fromCodePoint(i))}function Ua(i){for(const e of i)if(mh(e.codePointAt(0)))return!0;return!1}function xm(i){for(const e of i)if(!lp(e.codePointAt(0)))return!1;return!0}function jc(i){const e=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(e.join("|"),"u")}const qc=jc(["Arab","Dupl","Mong","Ougr","Syrc"]);function lp(i){return!qc.test(String.fromCodePoint(i))}function gh(i){return!(mh(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const cp=jc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function _h(i){return cp.test(String.fromCodePoint(i))}function yh(i,e){return!(!e&&_h(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function up(i){for(const e of i)if(_h(e.codePointAt(0)))return!0;return!1}const Co=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Co.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const r=i.pluginURL,l=new Promise(f=>{this.loadScriptResolve=f});e(r);const h=new Promise(f=>setTimeout(()=>f(),this.TIMEOUT));if(yield Promise.race([l,h]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:r};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class Jn{constructor(e,r){this.isSupportedScript=bm,this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new fh,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new fh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*r}}}function bm(i){return function(e,r){for(const l of e)if(!yh(l.codePointAt(0),r))return!1;return!0}(i,Co.getRTLTextPluginStatus()==="loaded")}const Nl="-transition";class $c{constructor(e,r,l){this.property=e,this.value=r,this.expression=function(h,f,m){if(Dc(h))return new zc(h,f);if(Fa(h)){const v=sh(h,f,m);if(v.result==="error")throw new Error(v.value.map(T=>`${T.key}: ${T.message}`).join(", "));return v.value}{let v=h;return f.type==="color"&&typeof h=="string"?v=gn.parse(h):f.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?f.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?f.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?v=Qr.parse(h):f.type==="projectionDefinition"&&typeof h=="string"&&(v=kn.parse(h)):v=qt.parse(h):v=Qn.parse(h):v=jr.parse(h),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>v}}}(r===void 0?e.specification.default:r,e.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,l){return this.property.possiblyEvaluate(this,e,r,l)}}class Gc{constructor(e,r){this.property=e,this.value=new $c(e,void 0,r)}transitioned(e,r){return new hp(this.property,this.value,r,Wt({},e.transition,this.transition),e.now)}untransitioned(){return new hp(this.property,this.value,null,{},0)}}class vh{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=r}getValue(e){return Tn(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Gc(this._values[e].property,this._globalState)),this._values[e].value=new $c(this._values[e].property,r===null?void 0:Tn(r),this._globalState)}getTransition(e){return Tn(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Gc(this._values[e].property,this._globalState)),this._values[e].transition=Tn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l);const h=this.getTransition(r);h!==void 0&&(e[`${r}${Nl}`]=h)}return e}transitioned(e,r){const l=new dp(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,r._values[h]);return l}untransitioned(){const e=new dp(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class hp{constructor(e,r,l,h,f){this.property=e,this.value=r,this.begin=f+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){const h=e.now||0,f=this.value.possiblyEvaluate(e,r,l),m=this.prior;if(m){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return m.possiblyEvaluate(e,r,l);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,l),f,Gt(v))}}return f}}class dp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){const h=new Vl(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,r,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class pp{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=r}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Tn(this._values[e].value)}setValue(e,r){this._values[e]=new $c(this._values[e].property,r===null?void 0:Tn(r),this._globalState)}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l){const h=new Vl(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,r,l);return h}}class As{constructor(e,r,l){this.property=e,this.value=r,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,h){return this.property.evaluate(this.value,this.parameters,e,r,l,h)}}class Vl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class St{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,l){const h=tr[this.specification.type];return h?h(e,r,l):e}}class Ot{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,h){return new As(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},l,h)}:e.expression,r)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new As(this,{kind:"constant",value:void 0},e.parameters);const h=tr[this.specification.type];if(h){const f=h(e.value.value,r.value.value,l);return new As(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,r,l,h,f,m){return e.kind==="constant"?e.value:e.evaluate(r,l,h,f,m)}}class Bl extends Ot{possiblyEvaluate(e,r,l,h){if(e.value===void 0)return new As(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},l,h),m=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,v=this._calculate(m,m,m,r);return new As(this,{kind:"constant",value:v},r)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new As(this,{kind:"constant",value:f},r)}return new As(this,e.expression,r)}evaluate(e,r,l,h,f,m){if(e.kind==="source"){const v=e.evaluate(r,l,h,f,m);return this._calculate(v,v,v,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},l,h),e.evaluate({zoom:Math.floor(r.zoom)},l,h),e.evaluate({zoom:Math.floor(r.zoom)+1},l,h),r):e.value}_calculate(e,r,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:l,to:r}}interpolate(e){return e}}class Hc{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},l,h);return this._calculate(f,f,f,r)}return this._calculate(e.expression.evaluate(new Jn(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Jn(Math.floor(r.zoom),r)),e.expression.evaluate(new Jn(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:l,to:r}}interpolate(e){return e}}class Zc{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,h){return!!e.expression.evaluate(r,null,{},l,h)}interpolate(){return!1}}class Si{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const l=e[r];l.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new $c(l,void 0,void 0),f=this.defaultTransitionablePropertyValues[r]=new Gc(l,void 0);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}xt("DataDrivenProperty",Ot),xt("DataConstantProperty",St),xt("CrossFadedDataDrivenProperty",Bl),xt("CrossFadedProperty",Hc),xt("ColorRampProperty",Zc);class gs extends zt{constructor(e,r,l){if(super(),this.id=e.id,this.type=e.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=function(h,f){return new kl(h,f)}(this.visibility,l),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Sl(e.filter,l)),r.layout&&(this._unevaluatedLayout=new pp(r.layout,l)),r.paint)){this._transitionablePaint=new vh(r.paint,l);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vl(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=Sl(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const r of this._visibilityExpression.getGlobalStateRefs())e.add(r);if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[r];for(const h of l.getGlobalStateRefs())e.add(h)}for(const r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}getPaintAffectingGlobalStateRefs(){var e;const r=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const h=this._transitionablePaint._values[l].value;for(const f of h.getGlobalStateRefs()){const m=(e=r.get(f))!==null&&e!==void 0?e:[];m.push({name:l,value:h.value}),r.set(f,m)}}return r}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,r,l={}){if(r==null||!this._validate(vm,`layers.${this.id}.layout.${e}`,e,r,l))return e==="visibility"?(this.visibility=r,this._visibilityExpression.setValue(r),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,r)}getPaintProperty(e){return e.endsWith(Nl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,l={}){if(r!=null&&this._validate(ym,`layers.${this.id}.paint.${e}`,e,r,l))return!1;if(e.endsWith(Nl))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const h=this._transitionablePaint._values[e],f=h.property.specification["property-type"]==="cross-faded-data-driven",m=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(e,v,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e=this.minzoom,r=!1){return!!(this.minzoom&&e<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),or(e,(r,l)=>!(r===void 0||l==="layout"&&!Object.keys(r).length||l==="paint"&&!Object.keys(r).length))}_validate(e,r,l,h,f={}){return(!f||f.validate!==!1)&&Na(this,e.call(ei,{key:r,layerType:this.type,objectKey:l,value:h,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof As&&za(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let xh;var fp={get paint(){return xh=xh||new Si({"raster-opacity":new St(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new St(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new St(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new St(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new St(Ce.paint_raster["raster-saturation"]),"raster-contrast":new St(Ce.paint_raster["raster-contrast"]),"raster-resampling":new St(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new St(Ce.paint_raster["raster-fade-duration"])})}};class wm extends gs{constructor(e,r){super(e,fp,r)}}const Tm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ul{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function kr(i,e=1){let r=0,l=0;return{members:i.map(h=>{const f=Tm[h.type].BYTES_PER_ELEMENT,m=r=sa(r,Math.max(e,f)),v=h.components||1;return l=Math.max(l,f),r+=f*v,{name:h.name,type:h.type,components:v,offset:m}}),size:sa(r,Math.max(l,e)),alignment:e}}function sa(i,e){return Math.ceil(i/e)*e}class jl extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const h=2*e;return this.int16[h+0]=r,this.int16[h+1]=l,e}}jl.prototype.bytesPerElement=4,xt("StructArrayLayout2i4",jl);class Wc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=l,this.int16[f+2]=h,e}}Wc.prototype.bytesPerElement=6,xt("StructArrayLayout3i6",Wc);class bh extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,h)}emplace(e,r,l,h,f){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=l,this.int16[m+2]=h,this.int16[m+3]=f,e}}bh.prototype.bytesPerElement=8,xt("StructArrayLayout4i8",bh);class Kc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,f,m)}emplace(e,r,l,h,f,m,v){const T=6*e;return this.int16[T+0]=r,this.int16[T+1]=l,this.int16[T+2]=h,this.int16[T+3]=f,this.int16[T+4]=m,this.int16[T+5]=v,e}}Kc.prototype.bytesPerElement=12,xt("StructArrayLayout2i4i12",Kc);class wh extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,f,m)}emplace(e,r,l,h,f,m,v){const T=4*e,S=8*e;return this.int16[T+0]=r,this.int16[T+1]=l,this.uint8[S+4]=h,this.uint8[S+5]=f,this.uint8[S+6]=m,this.uint8[S+7]=v,e}}wh.prototype.bytesPerElement=8,xt("StructArrayLayout2i4ub8",wh);class ql extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const h=2*e;return this.float32[h+0]=r,this.float32[h+1]=l,e}}ql.prototype.bytesPerElement=8,xt("StructArrayLayout2f8",ql);class io extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m,v,T,S,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,l,h,f,m,v,T,S,A)}emplace(e,r,l,h,f,m,v,T,S,A,M){const D=10*e;return this.uint16[D+0]=r,this.uint16[D+1]=l,this.uint16[D+2]=h,this.uint16[D+3]=f,this.uint16[D+4]=m,this.uint16[D+5]=v,this.uint16[D+6]=T,this.uint16[D+7]=S,this.uint16[D+8]=A,this.uint16[D+9]=M,e}}io.prototype.bytesPerElement=20,xt("StructArrayLayout10ui20",io);class Xc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m,v,T){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,l,h,f,m,v,T)}emplace(e,r,l,h,f,m,v,T,S){const A=8*e;return this.uint16[A+0]=r,this.uint16[A+1]=l,this.uint16[A+2]=h,this.uint16[A+3]=f,this.uint16[A+4]=m,this.uint16[A+5]=v,this.uint16[A+6]=T,this.uint16[A+7]=S,e}}Xc.prototype.bytesPerElement=16,xt("StructArrayLayout8ui16",Xc);class $l extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m,v,T,S,A,M,D){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,l,h,f,m,v,T,S,A,M,D)}emplace(e,r,l,h,f,m,v,T,S,A,M,D,z){const V=12*e;return this.int16[V+0]=r,this.int16[V+1]=l,this.int16[V+2]=h,this.int16[V+3]=f,this.uint16[V+4]=m,this.uint16[V+5]=v,this.uint16[V+6]=T,this.uint16[V+7]=S,this.int16[V+8]=A,this.int16[V+9]=M,this.int16[V+10]=D,this.int16[V+11]=z,e}}$l.prototype.bytesPerElement=24,xt("StructArrayLayout4i4ui4i24",$l);class Yc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=l,this.float32[f+2]=h,e}}Yc.prototype.bytesPerElement=12,xt("StructArrayLayout3f12",Yc);class Gl extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Gl.prototype.bytesPerElement=4,xt("StructArrayLayout1ul4",Gl);class Th extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m,v,T,S){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,l,h,f,m,v,T,S)}emplace(e,r,l,h,f,m,v,T,S,A){const M=10*e,D=5*e;return this.int16[M+0]=r,this.int16[M+1]=l,this.int16[M+2]=h,this.int16[M+3]=f,this.int16[M+4]=m,this.int16[M+5]=v,this.uint32[D+3]=T,this.uint16[M+8]=S,this.uint16[M+9]=A,e}}Th.prototype.bytesPerElement=20,xt("StructArrayLayout6i1ul2ui20",Th);class ja extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,f,m)}emplace(e,r,l,h,f,m,v){const T=6*e;return this.int16[T+0]=r,this.int16[T+1]=l,this.int16[T+2]=h,this.int16[T+3]=f,this.int16[T+4]=m,this.int16[T+5]=v,e}}ja.prototype.bytesPerElement=12,xt("StructArrayLayout2i2i2i12",ja);class oa extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,h,f)}emplace(e,r,l,h,f,m){const v=4*e,T=8*e;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=h,this.int16[T+6]=f,this.int16[T+7]=m,e}}oa.prototype.bytesPerElement=16,xt("StructArrayLayout2f1f2i16",oa);class Eh extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,h,f,m)}emplace(e,r,l,h,f,m,v){const T=16*e,S=4*e,A=8*e;return this.uint8[T+0]=r,this.uint8[T+1]=l,this.float32[S+1]=h,this.float32[S+2]=f,this.int16[A+6]=m,this.int16[A+7]=v,e}}Eh.prototype.bytesPerElement=16,xt("StructArrayLayout2ub2f2i16",Eh);class Hl extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=l,this.uint16[f+2]=h,e}}Hl.prototype.bytesPerElement=6,xt("StructArrayLayout3ui6",Hl);class aa extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m,v,T,S,A,M,D,z,V,U,$,X){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,r,l,h,f,m,v,T,S,A,M,D,z,V,U,$,X)}emplace(e,r,l,h,f,m,v,T,S,A,M,D,z,V,U,$,X,ae){const Y=24*e,J=12*e,he=48*e;return this.int16[Y+0]=r,this.int16[Y+1]=l,this.uint16[Y+2]=h,this.uint16[Y+3]=f,this.uint32[J+2]=m,this.uint32[J+3]=v,this.uint32[J+4]=T,this.uint16[Y+10]=S,this.uint16[Y+11]=A,this.uint16[Y+12]=M,this.float32[J+7]=D,this.float32[J+8]=z,this.uint8[he+36]=V,this.uint8[he+37]=U,this.uint8[he+38]=$,this.uint32[J+10]=X,this.int16[Y+22]=ae,e}}aa.prototype.bytesPerElement=48,xt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",aa);class Ih extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h,f,m,v,T,S,A,M,D,z,V,U,$,X,ae,Y,J,he,ye,De,Xe,$e,Qe,ut,et){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,r,l,h,f,m,v,T,S,A,M,D,z,V,U,$,X,ae,Y,J,he,ye,De,Xe,$e,Qe,ut,et)}emplace(e,r,l,h,f,m,v,T,S,A,M,D,z,V,U,$,X,ae,Y,J,he,ye,De,Xe,$e,Qe,ut,et,Ke){const Ve=32*e,vt=16*e;return this.int16[Ve+0]=r,this.int16[Ve+1]=l,this.int16[Ve+2]=h,this.int16[Ve+3]=f,this.int16[Ve+4]=m,this.int16[Ve+5]=v,this.int16[Ve+6]=T,this.int16[Ve+7]=S,this.uint16[Ve+8]=A,this.uint16[Ve+9]=M,this.uint16[Ve+10]=D,this.uint16[Ve+11]=z,this.uint16[Ve+12]=V,this.uint16[Ve+13]=U,this.uint16[Ve+14]=$,this.uint16[Ve+15]=X,this.uint16[Ve+16]=ae,this.uint16[Ve+17]=Y,this.uint16[Ve+18]=J,this.uint16[Ve+19]=he,this.uint16[Ve+20]=ye,this.uint16[Ve+21]=De,this.uint16[Ve+22]=Xe,this.uint32[vt+12]=$e,this.float32[vt+13]=Qe,this.float32[vt+14]=ut,this.uint16[Ve+30]=et,this.uint16[Ve+31]=Ke,e}}Ih.prototype.bytesPerElement=64,xt("StructArrayLayout8i15ui1ul2f2ui64",Ih);class Qc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Qc.prototype.bytesPerElement=4,xt("StructArrayLayout1f4",Qc);class Jc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const f=3*e;return this.uint16[6*e+0]=r,this.float32[f+1]=l,this.float32[f+2]=h,e}}Jc.prototype.bytesPerElement=12,xt("StructArrayLayout1ui2f12",Jc);class Sh extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,l)}emplace(e,r,l,h){const f=4*e;return this.uint32[2*e+0]=r,this.uint16[f+2]=l,this.uint16[f+3]=h,e}}Sh.prototype.bytesPerElement=8,xt("StructArrayLayout1ul2ui8",Sh);class _ extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const h=2*e;return this.uint16[h+0]=r,this.uint16[h+1]=l,e}}_.prototype.bytesPerElement=4,xt("StructArrayLayout2ui4",_);class t extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}t.prototype.bytesPerElement=2,xt("StructArrayLayout1ui2",t);class s extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,h)}emplace(e,r,l,h,f){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=l,this.float32[m+2]=h,this.float32[m+3]=f,e}}s.prototype.bytesPerElement=16,xt("StructArrayLayout4f16",s);class u extends Ul{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new R(this.anchorPointX,this.anchorPointY)}}u.prototype.size=20;class p extends Th{get(e){return new u(this,e)}}xt("CollisionBoxArray",p);class y extends Ul{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}y.prototype.size=48;class b extends aa{get(e){return new y(this,e)}}xt("PlacedSymbolArray",b);class I extends Ul{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}I.prototype.size=64;class P extends Ih{get(e){return new I(this,e)}}xt("SymbolInstanceArray",P);class C extends Qc{getoffsetX(e){return this.float32[1*e+0]}}xt("GlyphOffsetArray",C);class k extends Wc{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}xt("SymbolLineVertexArray",k);class O extends Ul{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}O.prototype.size=12;class F extends Jc{get(e){return new O(this,e)}}xt("TextAnchorOffsetArray",F);class q extends Ul{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}q.prototype.size=8;class Z extends Sh{get(e){return new q(this,e)}}xt("FeatureIndexArray",Z);class te extends jl{}class ie extends jl{}class re extends jl{}class le extends Kc{}class ve extends wh{}class oe extends ql{}class _e extends io{}class Te extends Xc{}class me extends $l{}class Pe extends Yc{}class Be extends Gl{}class Fe extends ja{}class Oe extends Eh{}class Ne extends Hl{}class it extends _{}const at=kr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Je}=at;class dt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,l,h){const f=this.segments[this.segments.length-1];return e>dt.MAX_VERTEX_ARRAY_LENGTH&&Nt(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${dt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+e>dt.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h?this.createNewSegment(r,l,h):f}createNewSegment(e,r,l){const h={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(h.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(e,r,l){return this.prepareSegment(0,e,r,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,h){return new dt([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function sn(i,e){return 256*(i=Et(Math.floor(i),0,255))+Et(Math.floor(e),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xt("SegmentVector",dt);const Xn=kr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),dr=kr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var nr,gr,rr,Ir={exports:{}},_r={exports:{}},ti={exports:{}},Or=function(){if(rr)return Ir.exports;rr=1;var i=(nr||(nr=1,_r.exports=function(r,l){var h,f,m,v,T,S,A,M;for(f=r.length-(h=3&r.length),m=l,T=3432918353,S=461845907,M=0;M<f;)A=255&r.charCodeAt(M)|(255&r.charCodeAt(++M))<<8|(255&r.charCodeAt(++M))<<16|(255&r.charCodeAt(++M))<<24,++M,m=27492+(65535&(v=5*(65535&(m=(m^=A=(65535&(A=(A=(65535&A)*T+(((A>>>16)*T&65535)<<16)&4294967295)<<15|A>>>17))*S+(((A>>>16)*S&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(A=0,h){case 3:A^=(255&r.charCodeAt(M+2))<<16;case 2:A^=(255&r.charCodeAt(M+1))<<8;case 1:m^=A=(65535&(A=(A=(65535&(A^=255&r.charCodeAt(M)))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<15|A>>>17))*S+(((A>>>16)*S&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),_r.exports),e=(gr||(gr=1,ti.exports=function(r,l){for(var h,f=r.length,m=l^f,v=0;f>=4;)h=1540483477*(65535&(h=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:m^=(255&r.charCodeAt(v+2))<<16;case 2:m^=(255&r.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),ti.exports);return Ir.exports=i,Ir.exports.murmur3=i,Ir.exports.murmur2=e,Ir.exports}(),Dr=B(Or);class di{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,l,h){this.ids.push(Mo(e)),this.positions.push(r,l,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Mo(e);let l=0,h=this.ids.length-1;for(;l<h;){const m=l+h>>1;this.ids[m]>=r?h=m:l=m+1}const f=[];for(;this.ids[l]===r;)f.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return f}static serialize(e,r){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return so(l,h,0,l.length-1),r&&r.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(e){const r=new di;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Mo(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Dr(String(i))}function so(i,e,r,l){for(;r<l;){const h=i[r+l>>1];let f=r-1,m=l+1;for(;;){do f++;while(i[f]<h);do m--;while(i[m]>h);if(f>=m)break;Zs(i,f,m),Zs(e,3*f,3*m),Zs(e,3*f+1,3*m+1),Zs(e,3*f+2,3*m+2)}m-r<l-m?(so(i,e,r,m),r=m+1):(so(i,e,m+1,l),l=m)}}function Zs(i,e,r){const l=i[e];i[e]=i[r],i[r]=l}xt("FeaturePositionMap",di);class Ni{constructor(e,r){this.gl=e.gl,this.location=r}}class la extends Ni{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Zl extends Ni{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ca extends Ni{constructor(e,r){super(e,r),this.current=gn.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const _s=new Float32Array(16);function Ws(i){return[sn(255*i.r,255*i.g),sn(255*i.b,255*i.a)]}class Cs{constructor(e,r,l){this.value=e,this.uniformNames=r.map(h=>`u_${h}`),this.type=l}setUniform(e,r,l){e.set(l.constantOr(this.value))}getBinding(e,r,l){return this.type==="color"?new ca(e,r):new la(e,r)}}class Ms{constructor(e,r){this.uniformNames=r.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,r){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(e,r,l,h){let f=null;h==="u_pattern_to"?f=this.patternTo:h==="u_pattern_from"?f=this.patternFrom:h==="u_dasharray_to"?f=this.dashTo:h==="u_dasharray_from"?f=this.dashFrom:h==="u_pixel_ratio_to"?f=this.pixelRatioTo:h==="u_pixel_ratio_from"&&(f=this.pixelRatioFrom),f!==null&&e.set(f)}getBinding(e,r,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new Zl(e,r):new la(e,r)}}class ar{constructor(e,r,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,l){const h=this.paintVertexArray.length,f=this.expression.evaluate(new Jn(0,l),r,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(h,e,f)}updatePaintArray(e,r,l,h,f){const m=this.expression.evaluate(new Jn(0,f),l,h);this._setPaintValue(e,r,m)}_setPaintValue(e,r,l){if(this.type==="color"){const h=Ws(l);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ir{constructor(e,r,l,h,f,m){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,l){const h=this.expression.evaluate(new Jn(this.zoom,l),r,{},l.canonical,[],l.formattedSection),f=this.expression.evaluate(new Jn(this.zoom+1,l),r,{},l.canonical,[],l.formattedSection),m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,h,f)}updatePaintArray(e,r,l,h,f){const m=this.expression.evaluate(new Jn(this.zoom,f),l,h),v=this.expression.evaluate(new Jn(this.zoom+1,f),l,h);this._setPaintValue(e,r,m,v)}_setPaintValue(e,r,l,h){if(this.type==="color"){const f=Ws(l),m=Ws(h);for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,f[0],f[1],m[0],m[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const l=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=Et(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,r,l){return new la(e,r)}}class Hr{constructor(e,r,l,h,f,m){this.expression=e,this.type=r,this.useIntegerZoom=l,this.zoom=h,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,r,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,this.getPositionIds(r),l)}updatePaintArray(e,r,l,h,f){this._setPaintValues(e,r,this.getPositionIds(l),f)}_setPaintValues(e,r,l,h){const f=this.getPositions(h);if(!f||!l)return;const m=f[l.min],v=f[l.mid],T=f[l.max];if(m&&v&&T)for(let S=e;S<r;S++)this.emplace(this.zoomInPaintVertexArray,S,v,m),this.emplace(this.zoomOutPaintVertexArray,S,v,T)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Zr extends Hr{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Xn.members}emplace(e,r,l,h){e.emplace(r,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],l.pixelRatio,h.pixelRatio)}}class mp extends Hr{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return dr.members}emplace(e,r,l,h){e.emplace(r,0,l.y,l.height,l.width,0,h.y,h.height,h.width)}}class gp{constructor(e,r,l){this.binders={},this._buffers=[];const h=[];for(const f in e.paint._values){if(!l(f))continue;const m=e.paint.get(f);if(!(m instanceof As&&za(m.property.specification)))continue;const v=Em(f,e.type),T=m.value,S=m.property.specification.type,A=m.property.useIntegerZoom,M=m.property.specification["property-type"],D=M==="cross-faded"||M==="cross-faded-data-driven";if(T.kind==="constant")this.binders[f]=D?new Ms(T.value,v):new Cs(T.value,v,S),h.push(`/u_${f}`);else if(T.kind==="source"||D){const z=_p(f,S,"source");this.binders[f]=D?f==="line-dasharray"?new mp(T,S,A,r,z,e.id):new Zr(T,S,A,r,z,e.id):new ar(T,v,S,z),h.push(`/a_${f}`)}else{const z=_p(f,S,"composite");this.binders[f]=new ir(T,v,S,A,r,z),h.push(`/z_${f}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof ar||r instanceof ir?r.maxValue:0}populatePaintArrays(e,r,l){for(const h in this.binders){const f=this.binders[h];(f instanceof ar||f instanceof ir||f instanceof Hr)&&f.populatePaintArray(e,r,l)}}setConstantPatternPositions(e,r){for(const l in this.binders){const h=this.binders[l];h instanceof Ms&&h.setConstantPatternPositions(e,r)}}setConstantDashPositions(e,r){for(const l in this.binders){const h=this.binders[l];h instanceof Ms&&h.setConstantDashPositions(e,r)}}updatePaintArrays(e,r,l,h,f){let m=!1;for(const v in e){const T=r.getPositions(v);for(const S of T){const A=l.feature(S.index);for(const M in this.binders){const D=this.binders[M];if((D instanceof ar||D instanceof ir||D instanceof Hr)&&D.expression.isStateDependent===!0){const z=h.paint.get(M);D.expression=z.value,D.updatePaintArray(S.start,S.end,A,e[v],f),m=!0}}}}return m}defines(){const e=[];for(const r in this.binders){const l=this.binders[r];(l instanceof Cs||l instanceof Ms)&&e.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof ar||l instanceof ir)for(let h=0;h<l.paintVertexAttributes.length;h++)e.push(l.paintVertexAttributes[h].name);else if(l instanceof Hr){const h=l.getVertexAttributes();for(const f of h)e.push(f.name)}}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof Cs||l instanceof Ms||l instanceof ir)for(const h of l.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const l=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Cs||f instanceof Ms||f instanceof ir){for(const m of f.uniformNames)if(r[m]){const v=f.getBinding(e,r[m],m);l.push({name:m,property:h,binding:v})}}}return l}setUniforms(e,r,l,h){for(const{name:f,property:m,binding:v}of r)this.binders[m].setUniform(v,h,l.get(m),f)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const l=this.binders[r];if(e&&l instanceof Hr){const h=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof ar||l instanceof ir)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const r in this.binders){const l=this.binders[r];(l instanceof ar||l instanceof ir||l instanceof Hr)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof ar||r instanceof ir||r instanceof Hr)&&r.destroy()}}}class ua{constructor(e,r,l=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new gp(h,r,l);this.needsUpload=!1,this._featureMap=new di,this._bufferOffset=0}populatePaintArrays(e,r,l,h){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,r,h);r.id!==void 0&&this._featureMap.add(r.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,h){for(const f of l)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,r,f,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Em(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function _p(i,e,r){const l={color:{source:ql,composite:s},number:{source:Qc,composite:ql}},h=function(f){return{"line-pattern":{source:_e,composite:_e},"fill-pattern":{source:_e,composite:_e},"fill-extrusion-pattern":{source:_e,composite:_e},"line-dasharray":{source:Te,composite:Te}}[f]}(i);return h&&h[r]||l[e][r]}xt("ConstantBinder",Cs),xt("CrossFadedConstantBinder",Ms),xt("SourceExpressionBinder",ar),xt("CrossFadedPatternBinder",Zr),xt("CrossFadedDasharrayBinder",mp),xt("CompositeExpressionBinder",ir),xt("ProgramConfiguration",gp,{omit:["_buffers"]}),xt("ProgramConfigurationSet",ua);const Ph=Math.pow(2,14)-1,Ro=-Ph-1;function ko(i){const e=Pt/i.extent,r=i.loadGeometry();for(let l=0;l<r.length;l++){const h=r[l];for(let f=0;f<h.length;f++){const m=h[f],v=Math.round(m.x*e),T=Math.round(m.y*e);m.x=Et(v,Ro,Ph),m.y=Et(T,Ro,Ph),(v<m.x||v>m.x+1||T<m.y||T>m.y+1)&&Nt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Do(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ko(i):[]}}const Ah=-32768;function Ch(i,e,r,l,h){i.emplaceBack(Ah+8*e+l,Ah+8*r+h)}class eu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ie,this.indexArray=new Ne,this.segments=new dt,this.programConfigurations=new ua(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){const h=this.layers[0],f=[];let m=null,v=!1,T=h.type==="heatmap";if(h.type==="circle"){const A=h;m=A.layout.get("circle-sort-key"),v=!m.isConstant(),T=T||A.paint.get("circle-pitch-alignment")==="map"}const S=T?r.subdivisionGranularity.circle:1;for(const{feature:A,id:M,index:D,sourceLayerIndex:z}of e){const V=this.layers[0]._featureFilter.needGeometry,U=Do(A,V);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),U,l))continue;const $=v?m.evaluate(U,{},l):void 0,X={id:M,properties:A.properties,type:A.type,sourceLayerIndex:z,index:D,geometry:V?U.geometry:ko(A),patterns:{},sortKey:$};f.push(X)}v&&f.sort((A,M)=>A.sortKey-M.sortKey);for(const A of f){const{geometry:M,index:D,sourceLayerIndex:z}=A,V=e[D].feature;this.addFeature(A,M,D,l,S),r.featureIndex.insert(V,M,D,z,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Je),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,h,f=1){let m;switch(f){case 1:m=[0,7];break;case 3:m=[0,2,5,7];break;case 5:m=[0,1,3,4,6,7];break;case 7:m=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const v=m.length;for(const T of r)for(const S of T){const A=S.x,M=S.y;if(A<0||A>=Pt||M<0||M>=Pt)continue;const D=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,e.sortKey),z=D.vertexLength;for(let V=0;V<v;V++)for(let U=0;U<v;U++)Ch(this.layoutVertexArray,A,M,m[U],m[V]);for(let V=0;V<v-1;V++)for(let U=0;U<v-1;U++){const $=z+V*v+U,X=z+(V+1)*v+U;this.indexArray.emplaceBack($,X+1,$+1),this.indexArray.emplaceBack($,X,X+1)}D.vertexLength+=v*v,D.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:{},canonical:h})}}function tu(i,e){for(let r=0;r<i.length;r++)if(nu(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(nu(i,e[r]))return!0;return!!Im(i,e)}function yp(i,e,r){return!!nu(i,e)||!!Sm(e,i,r)}function hy(i,e){if(i.length===1)return py(e,i[0]);for(let r=0;r<e.length;r++){const l=e[r];for(let h=0;h<l.length;h++)if(nu(i,l[h]))return!0}for(let r=0;r<i.length;r++)if(py(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Im(i,e[r]))return!0;return!1}function dT(i,e,r){if(i.length>1){if(Im(i,e))return!0;for(let l=0;l<e.length;l++)if(Sm(e[l],i,r))return!0}for(let l=0;l<i.length;l++)if(Sm(i[l],e,r))return!0;return!1}function Im(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const l=i[r],h=i[r+1];for(let f=0;f<e.length-1;f++)if(pT(l,h,e[f],e[f+1]))return!0}return!1}function pT(i,e,r,l){return en(i,r,l)!==en(e,r,l)&&en(i,e,r)!==en(i,e,l)}function Sm(i,e,r){const l=r*r;if(e.length===1)return i.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(dy(i,e[h-1],e[h])<l)return!0;return!1}function dy(i,e,r){const l=e.distSqr(r);if(l===0)return i.distSqr(e);const h=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/l;return i.distSqr(h<0?e:h>1?r:r.sub(e)._mult(h)._add(e))}function py(i,e){let r,l,h,f=!1;for(let m=0;m<i.length;m++){r=i[m];for(let v=0,T=r.length-1;v<r.length;T=v++)l=r[v],h=r[T],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(f=!f)}return f}function nu(i,e){let r=!1;for(let l=0,h=i.length-1;l<i.length;h=l++){const f=i[l],m=i[h];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(r=!r)}return r}function fT(i,e,r){const l=r[0],h=r[2];if(i.x<l.x&&e.x<l.x||i.x>h.x&&e.x>h.x||i.y<l.y&&e.y<l.y||i.y>h.y&&e.y>h.y)return!1;const f=en(i,e,r[0]);return f!==en(i,e,r[1])||f!==en(i,e,r[2])||f!==en(i,e,r[3])}function ru(i,e,r){const l=e.paint.get(i).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(i)}function vp(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function xp(i,e,r,l,h){if(!e[0]&&!e[1])return i;const f=R.convert(e)._mult(h);r==="viewport"&&f._rotate(-l);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(f));return m}function mT(i){const e=[];for(let r=0;r<i.length;r++){const l=i[r],h=e.at(-1);(r===0||h&&!l.equals(h))&&e.push(l)}return e}function gT({queryGeometry:i,size:e},r){return yp(i,r,e)}function _T({queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:h},f){return yp(i,f,e*(r.projectTileCoordinates(f.x,f.y,l,h).signedDistanceFromCamera/r.cameraToCenterDistance))}function yT({queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:h},f){const m=r.projectTileCoordinates(f.x,f.y,l,h).signedDistanceFromCamera,v=e*(r.cameraToCenterDistance/m);return yp(i,Pm(f,r,l,h),v)}function vT({queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:h},f){return yp(i,Pm(f,r,l,h),e)}function fy({queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:h,pitchAlignment:f="map",pitchScale:m="map"},v){const T=f==="map"?m==="map"?gT:_T:m==="map"?yT:vT,S={queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:h};for(const A of v)for(const M of A)if(T(S,M))return!0;return!1}function Pm(i,e,r,l){const h=e.projectTileCoordinates(i.x,i.y,r,l).point;return new R((.5*h.x+.5)*e.width,(.5*-h.y+.5)*e.height)}let my,gy;xt("CircleBucket",eu,{omit:["layers"]});var xT={get paint(){return gy=gy||new Si({"circle-radius":new Ot(Ce.paint_circle["circle-radius"]),"circle-color":new Ot(Ce.paint_circle["circle-color"]),"circle-blur":new Ot(Ce.paint_circle["circle-blur"]),"circle-opacity":new Ot(Ce.paint_circle["circle-opacity"]),"circle-translate":new St(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new St(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new St(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new St(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ot(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ot(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ot(Ce.paint_circle["circle-stroke-opacity"])})},get layout(){return my=my||new Si({"circle-sort-key":new Ot(Ce.layout_circle["circle-sort-key"])})}};class bT extends gs{constructor(e,r){super(e,xT,r)}createBucket(e){return new eu(e)}queryRadius(e){const r=e;return ru("circle-radius",this,r)+ru("circle-stroke-width",this,r)+vp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:l,geometry:h,transform:f,pixelsToTileUnits:m,unwrappedTileID:v,getElevation:T}){const S=xp(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,m),A=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l),M=this.paint.get("circle-pitch-scale"),D=this.paint.get("circle-pitch-alignment");let z,V;return D==="map"?(z=S,V=A*m):(z=function(U,$,X,ae){return U.map(Y=>Pm(Y,$,X,ae))}(S,f,v,T),V=A),fy({queryGeometry:z,size:V,transform:f,unwrappedTileID:v,getElevation:T,pitchAlignment:D,pitchScale:M},h)}}class _y extends eu{}let yy;xt("HeatmapBucket",_y,{omit:["layers"]});var wT={get paint(){return yy=yy||new Si({"heatmap-radius":new Ot(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ot(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new St(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zc(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new St(Ce.paint_heatmap["heatmap-opacity"])})}};function Am(i,{width:e,height:r},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*r*l)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*r*l}`)}else h=new Uint8Array(e*r*l);return i.width=e,i.height=r,i.data=h,i}function vy(i,{width:e,height:r},l){if(e===i.width&&r===i.height)return;const h=Am({},{width:e,height:r},l);Cm(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},l),i.width=e,i.height=r,i.data=h.data}function Cm(i,e,r,l,h,f){if(h.width===0||h.height===0)return e;if(h.width>i.width||h.height>i.height||r.x>i.width-h.width||r.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,v=e.data;if(m===v)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<h.height;T++){const S=((r.y+T)*i.width+r.x)*f,A=((l.y+T)*e.width+l.x)*f;for(let M=0;M<h.width*f;M++)v[A+M]=m[S+M]}return e}class Mh{constructor(e,r){Am(this,e,1,r)}resize(e){vy(this,e,1)}clone(){return new Mh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,h,f){Cm(e,r,l,h,f,1)}}class ns{constructor(e,r){Am(this,e,4,r)}resize(e){vy(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ns({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,h,f){Cm(e,r,l,h,f,4)}setPixel(e,r,l){const h=4*(e*this.width+r);this.data[h+0]=Math.round(255*l.r/l.a),this.data[h+1]=Math.round(255*l.g/l.a),this.data[h+2]=Math.round(255*l.b/l.a),this.data[h+3]=Math.round(255*l.a)}}function xy(i){const e={},r=i.resolution||256,l=i.clips?i.clips.length:1,h=i.image||new ns({width:r,height:l});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(m,v,T)=>{e[i.evaluationKey]=T;const S=i.expression.evaluate(e);h.setPixel(m/4/r,v/4,S)};if(i.clips)for(let m=0,v=0;m<l;++m,v+=4*r)for(let T=0,S=0;T<r;T++,S+=4){const A=T/(r-1),{start:M,end:D}=i.clips[m];f(v,S,M*(1-A)+D*A)}else for(let m=0,v=0;m<r;m++,v+=4)f(0,v,m/(r-1));return h}xt("AlphaImage",Mh),xt("RGBAImage",ns);const Mm="big-fb";class TT extends gs{createBucket(e){return new _y(e)}constructor(e,r){super(e,wT,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=xy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Mm)&&this.heatmapFbos.delete(Mm)}queryRadius(e){return ru("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:l,geometry:h,transform:f,pixelsToTileUnits:m,unwrappedTileID:v,getElevation:T}){return fy({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(r,l)*m,transform:f,unwrappedTileID:v,getElevation:T},h)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let by;var ET={get paint(){return by=by||new Si({"hillshade-illumination-direction":new St(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new St(Ce.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new St(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new St(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new St(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new St(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new St(Ce.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new St(Ce.paint_hillshade["hillshade-method"])})}};class IT extends gs{constructor(e,r){super(e,ET,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const f=Math.max(e.length,r.length,l.length,h.length);e=e.concat(Array(f-e.length).fill(e.at(-1))),r=r.concat(Array(f-r.length).fill(r.at(-1))),l=l.concat(Array(f-l.length).fill(l.at(-1))),h=h.concat(Array(f-h.length).fill(h.at(-1)));const m=r.map(Yt);return{directionRadians:e.map(Yt),altitudeRadians:m,shadowColor:h,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let wy;var ST={get paint(){return wy=wy||new Si({"color-relief-opacity":new St(Ce["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Zc(Ce["paint_color-relief"]["color-relief-color"])})}};class Rm{constructor(e,r,l,h){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(r,h)}update(e,r,l){const{width:h,height:f}=e,m=!(this.size&&this.size[0]===h&&this.size[1]===f||l),{context:v}=this,{gl:T}=v;if(this.useMipmap=!!(r&&r.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!r||r.premultiply!==!1)),m)this.size=[h,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||jt(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,h,f,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:S,y:A}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||jt(e)?T.texSubImage2D(T.TEXTURE_2D,0,S,A,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,S,A,h,f,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,l){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),l!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,l||e),this.filter=e),r!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Ty{constructor(e,r,l,h=1,f=1,m=1,v=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Nt(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const T=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=f,this.blueFactor=m,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<T;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(T,S)]=this.data[this._idx(T-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,T)]=this.data[this._idx(S,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<T;S++)for(let A=0;A<T;A++){const M=this.get(S,A);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(e,r){const l=new Uint8Array(this.data.buffer),h=4*this._idx(e,r);return this.unpack(l[h],l[h+1],l[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${r}, dim: ${this.dim}`);return(r+1)*this.stride+(e+1)}unpack(e,r,l){return e*this.redFactor+r*this.greenFactor+l*this.blueFactor-this.baseShift}pack(e){return Ey(e,this.getUnpackVector())}getPixels(){return new ns({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,f=r*this.dim+this.dim,m=l*this.dim,v=l*this.dim+this.dim;switch(r){case-1:h=f-1;break;case 1:f=h+1}switch(l){case-1:m=v-1;break;case 1:v=m+1}const T=-r*this.dim,S=-l*this.dim;for(let A=m;A<v;A++)for(let M=h;M<f;M++)this.data[this._idx(M,A)]=e.data[this._idx(M+T,A+S)]}}function Ey(i,e){const r=e[0],l=e[1],h=e[2],f=e[3],m=Math.min(r,l,h),v=Math.round((i+f)/m);return{r:Math.floor(v*m/r)%256,g:Math.floor(v*m/l)%256,b:Math.floor(v*m/h)%256}}xt("DEMData",Ty);class PT extends gs{constructor(e,r){super(e,ST,r)}_createColorRamp(e){const r={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof Lc&&l._styleExpression.expression instanceof Jr){this.colorRampExpression=l;const m=l._styleExpression.expression;r.elevationStops=m.labels,r.colorStops=[];for(const v of r.elevationStops)r.colorStops.push(m.evaluate({globals:{elevation:v}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[gn.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;const h={elevationStops:[],colorStops:[]},f=(r.elevationStops.length-1)/(e-1);for(let m=0;m<r.elevationStops.length-.5;m+=f)h.elevationStops.push(r.elevationStops[Math.round(m)]),h.colorStops.push(r.colorStops[Math.round(m)]);return Nt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${r.elevationStops.length}`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(r),f=new ns({width:h.colorStops.length,height:1}),m=new ns({width:h.colorStops.length,height:1});for(let v=0;v<h.elevationStops.length;v++){const T=Ey(h.elevationStops[v],l);m.setPixel(0,v,new gn(T.r/255,T.g/255,T.b/255,1)),f.setPixel(0,v,h.colorStops[v])}return this.colorRampTextures={elevationTexture:new Rm(e,m,e.gl.RGBA),colorTexture:new Rm(e,f,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const AT=kr([{name:"a_pos",components:2,type:"Int16"}],4),{members:CT}=AT;function bp(i,e,r){const l=r.patternDependencies;let h=!1;for(const f of e){const m=f.paint.get(`${i}-pattern`);m.isConstant()||(h=!0);const v=m.constantOr(null);v&&(h=!0,l[v.to]=!0,l[v.from]=!0)}return h}function km(i,e,r,l,h){const{zoom:f}=l,m=h.patternDependencies;for(const v of e){const T=v.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let S=T.evaluate({zoom:f-1},r,{},h.availableImages),A=T.evaluate({zoom:f},r,{},h.availableImages),M=T.evaluate({zoom:f+1},r,{},h.availableImages);S=S&&S.name?S.name:S,A=A&&A.name?A.name:A,M=M&&M.name?M.name:M,m[S]=!0,m[A]=!0,m[M]=!0,r.patterns[v.id]={min:S,mid:A,max:M}}}return r}function Iy(i,e,r,l,h){let f;if(h===function(m,v,T,S){let A=0;for(let M=v,D=T-S;M<T;M+=S)A+=(m[D]-m[M])*(m[M+1]+m[D+1]),D=M;return A}(i,e,r,l)>0)for(let m=e;m<r;m+=l)f=Cy(m/l|0,i[m],i[m+1],f);else for(let m=r-l;m>=e;m-=l)f=Cy(m/l|0,i[m],i[m+1],f);return f&&iu(f,f.next)&&(Lh(f),f=f.next),f}function Wl(i,e){if(!i)return i;e||(e=i);let r,l=i;do if(r=!1,l.steiner||!iu(l,l.next)&&Nr(l.prev,l,l.next)!==0)l=l.next;else{if(Lh(l),l=e=l.prev,l===l.next)break;r=!0}while(r||l!==e);return e}function Rh(i,e,r,l,h,f,m){if(!i)return;!m&&f&&function(T,S,A,M){let D=T;do D.z===0&&(D.z=Dm(D.x,D.y,S,A,M)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==T);D.prevZ.nextZ=null,D.prevZ=null,function(z){let V,U=1;do{let $,X=z;z=null;let ae=null;for(V=0;X;){V++;let Y=X,J=0;for(let ye=0;ye<U&&(J++,Y=Y.nextZ,Y);ye++);let he=U;for(;J>0||he>0&&Y;)J!==0&&(he===0||!Y||X.z<=Y.z)?($=X,X=X.nextZ,J--):($=Y,Y=Y.nextZ,he--),ae?ae.nextZ=$:z=$,$.prevZ=ae,ae=$;X=Y}ae.nextZ=null,U*=2}while(V>1)}(D)}(i,l,h,f);let v=i;for(;i.prev!==i.next;){const T=i.prev,S=i.next;if(f?RT(i,l,h,f):MT(i))e.push(T.i,i.i,S.i),Lh(i),i=S.next,v=S.next;else if((i=S)===v){m?m===1?Rh(i=kT(Wl(i),e),e,r,l,h,f,2):m===2&&DT(i,e,r,l,h,f):Rh(Wl(i),e,r,l,h,f,1);break}}}function MT(i){const e=i.prev,r=i,l=i.next;if(Nr(e,r,l)>=0)return!1;const h=e.x,f=r.x,m=l.x,v=e.y,T=r.y,S=l.y,A=Math.min(h,f,m),M=Math.min(v,T,S),D=Math.max(h,f,m),z=Math.max(v,T,S);let V=l.next;for(;V!==e;){if(V.x>=A&&V.x<=D&&V.y>=M&&V.y<=z&&kh(h,v,f,T,m,S,V.x,V.y)&&Nr(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function RT(i,e,r,l){const h=i.prev,f=i,m=i.next;if(Nr(h,f,m)>=0)return!1;const v=h.x,T=f.x,S=m.x,A=h.y,M=f.y,D=m.y,z=Math.min(v,T,S),V=Math.min(A,M,D),U=Math.max(v,T,S),$=Math.max(A,M,D),X=Dm(z,V,e,r,l),ae=Dm(U,$,e,r,l);let Y=i.prevZ,J=i.nextZ;for(;Y&&Y.z>=X&&J&&J.z<=ae;){if(Y.x>=z&&Y.x<=U&&Y.y>=V&&Y.y<=$&&Y!==h&&Y!==m&&kh(v,A,T,M,S,D,Y.x,Y.y)&&Nr(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,J.x>=z&&J.x<=U&&J.y>=V&&J.y<=$&&J!==h&&J!==m&&kh(v,A,T,M,S,D,J.x,J.y)&&Nr(J.prev,J,J.next)>=0))return!1;J=J.nextZ}for(;Y&&Y.z>=X;){if(Y.x>=z&&Y.x<=U&&Y.y>=V&&Y.y<=$&&Y!==h&&Y!==m&&kh(v,A,T,M,S,D,Y.x,Y.y)&&Nr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;J&&J.z<=ae;){if(J.x>=z&&J.x<=U&&J.y>=V&&J.y<=$&&J!==h&&J!==m&&kh(v,A,T,M,S,D,J.x,J.y)&&Nr(J.prev,J,J.next)>=0)return!1;J=J.nextZ}return!0}function kT(i,e){let r=i;do{const l=r.prev,h=r.next.next;!iu(l,h)&&Py(l,r,r.next,h)&&Dh(l,h)&&Dh(h,l)&&(e.push(l.i,r.i,h.i),Lh(r),Lh(r.next),r=i=h),r=r.next}while(r!==i);return Wl(r)}function DT(i,e,r,l,h,f){let m=i;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&NT(m,v)){let T=Ay(m,v);return m=Wl(m,m.next),T=Wl(T,T.next),Rh(m,e,r,l,h,f,0),void Rh(T,e,r,l,h,f,0)}v=v.next}m=m.next}while(m!==i)}function LT(i,e){let r=i.x-e.x;return r===0&&(r=i.y-e.y,r===0)&&(r=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function zT(i,e){const r=function(h,f){let m=f;const v=h.x,T=h.y;let S,A=-1/0;if(iu(h,m))return m;do{if(iu(h,m.next))return m.next;if(T<=m.y&&T>=m.next.y&&m.next.y!==m.y){const U=m.x+(T-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(U<=v&&U>A&&(A=U,S=m.x<m.next.x?m:m.next,U===v))return S}m=m.next}while(m!==f);if(!S)return null;const M=S,D=S.x,z=S.y;let V=1/0;m=S;do{if(v>=m.x&&m.x>=D&&v!==m.x&&Sy(T<z?v:A,T,D,z,T<z?A:v,T,m.x,m.y)){const U=Math.abs(T-m.y)/(v-m.x);Dh(m,h)&&(U<V||U===V&&(m.x>S.x||m.x===S.x&&FT(S,m)))&&(S=m,V=U)}m=m.next}while(m!==M);return S}(i,e);if(!r)return e;const l=Ay(r,i);return Wl(l,l.next),Wl(r,r.next)}function FT(i,e){return Nr(i.prev,i,e.prev)<0&&Nr(e.next,i,i.next)<0}function Dm(i,e,r,l,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function OT(i){let e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Sy(i,e,r,l,h,f,m,v){return(h-m)*(e-v)>=(i-m)*(f-v)&&(i-m)*(l-v)>=(r-m)*(e-v)&&(r-m)*(f-v)>=(h-m)*(l-v)}function kh(i,e,r,l,h,f,m,v){return!(i===m&&e===v)&&Sy(i,e,r,l,h,f,m,v)}function NT(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,l){let h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==l.i&&h.next.i!==l.i&&Py(h,h.next,r,l))return!0;h=h.next}while(h!==r);return!1}(i,e)&&(Dh(i,e)&&Dh(e,i)&&function(r,l){let h=r,f=!1;const m=(r.x+l.x)/2,v=(r.y+l.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&m<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next;while(h!==r);return f}(i,e)&&(Nr(i.prev,i,e.prev)||Nr(i,e.prev,e))||iu(i,e)&&Nr(i.prev,i,i.next)>0&&Nr(e.prev,e,e.next)>0)}function Nr(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function iu(i,e){return i.x===e.x&&i.y===e.y}function Py(i,e,r,l){const h=Tp(Nr(i,e,r)),f=Tp(Nr(i,e,l)),m=Tp(Nr(r,l,i)),v=Tp(Nr(r,l,e));return h!==f&&m!==v||!(h!==0||!wp(i,r,e))||!(f!==0||!wp(i,l,e))||!(m!==0||!wp(r,i,l))||!(v!==0||!wp(r,e,l))}function wp(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Tp(i){return i>0?1:i<0?-1:0}function Dh(i,e){return Nr(i.prev,i,i.next)<0?Nr(i,e,i.next)>=0&&Nr(i,i.prev,e)>=0:Nr(i,e,i.prev)<0||Nr(i,i.next,e)<0}function Ay(i,e){const r=Lm(i.i,i.x,i.y),l=Lm(e.i,e.x,e.y),h=i.next,f=e.prev;return i.next=e,e.prev=i,r.next=h,h.prev=r,l.next=r,r.prev=l,f.next=l,l.prev=f,l}function Cy(i,e,r,l){const h=Lm(i,e,r);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Lh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Lm(i,e,r){return{i,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class su{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Ep{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Ep.noSubdivision=new Ep({fill:new su(0,0),line:new su(0,0),tile:new su(0,0),stencil:new su(0,0),circle:1}),xt("SubdivisionGranularityExpression",su),xt("SubdivisionGranularitySetting",Ep);const ou=-32768,zh=32767;class VT{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Pt/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(e),h=0|Math.round(r),f=this._getKey(l,h);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const m=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,m),this._vertexBuffer.push(l,h),m}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(h,f){const m=[];for(let v=0;v<f.length;v+=3){const T=f[v],S=f[v+1],A=f[v+2],M=h[2*T],D=h[2*T+1];(h[2*S]-M)*(h[2*A+1]-D)-(h[2*S+1]-D)*(h[2*A]-M)>0?(m.push(T),m.push(A),m.push(S)):(m.push(T),m.push(S),m.push(A))}return m}(this._vertexBuffer,e);const r=[],l=e.length;for(let h=0;h<l;h+=3){const f=[e[h+0],e[h+1],e[h+2]],m=[this._vertexBuffer[2*e[h+0]+0],this._vertexBuffer[2*e[h+0]+1],this._vertexBuffer[2*e[h+1]+0],this._vertexBuffer[2*e[h+1]+1],this._vertexBuffer[2*e[h+2]+0],this._vertexBuffer[2*e[h+2]+1]];let v=1/0,T=1/0,S=-1/0,A=-1/0;for(let U=0;U<3;U++){const $=m[2*U],X=m[2*U+1];v=Math.min(v,$),S=Math.max(S,$),T=Math.min(T,X),A=Math.max(A,X)}if(v===S||T===A)continue;const M=Math.floor(v/this._granularityCellSize),D=Math.ceil(S/this._granularityCellSize),z=Math.floor(T/this._granularityCellSize),V=Math.ceil(A/this._granularityCellSize);if(M!==D||z!==V)for(let U=z;U<V;U++){const $=this._scanlineGenerateVertexRingForCellRow(U,m,f);BT(this._vertexBuffer,$,r)}else r.push(...f)}return r}_scanlineGenerateVertexRingForCellRow(e,r,l){const h=e*this._granularityCellSize,f=h+this._granularityCellSize,m=[];for(let v=0;v<3;v++){const T=r[2*v],S=r[2*v+1],A=r[2*(v+1)%6],M=r[(2*(v+1)+1)%6],D=r[2*(v+2)%6],z=r[(2*(v+2)+1)%6],V=A-T,U=M-S,$=V===0,X=U===0,ae=(h-S)/U,Y=(f-S)/U,J=Math.min(ae,Y),he=Math.max(ae,Y);if(!X&&(J>=1||he<=0)||X&&(S<h||S>f)){M>=h&&M<=f&&m.push(l[(v+1)%3]);continue}!X&&J>0&&m.push(this._vertexToIndex(T+V*J,S+U*J));const ye=T+V*Math.max(J,0),De=T+V*Math.min(he,1);$||this._generateIntraEdgeVertices(m,T,S,A,M,ye,De),!X&&he<1&&m.push(this._vertexToIndex(T+V*he,S+U*he)),(X||M>=h&&M<=f)&&m.push(l[(v+1)%3]),!X&&(M<=h||M>=f)&&this._generateInterEdgeVertices(m,T,S,A,M,D,z,De,h,f)}return m}_generateIntraEdgeVertices(e,r,l,h,f,m,v){const T=h-r,S=f-l,A=S===0,M=A?Math.min(r,h):Math.min(m,v),D=A?Math.max(r,h):Math.max(m,v),z=Math.floor(M/this._granularityCellSize)+1,V=Math.ceil(D/this._granularityCellSize)-1;if(A?r<h:m<v)for(let U=z;U<=V;U++){const $=U*this._granularityCellSize;e.push(this._vertexToIndex($,l+S*($-r)/T))}else for(let U=V;U>=z;U--){const $=U*this._granularityCellSize;e.push(this._vertexToIndex($,l+S*($-r)/T))}}_generateInterEdgeVertices(e,r,l,h,f,m,v,T,S,A){const M=f-l,D=m-h,z=v-f,V=(S-f)/z,U=(A-f)/z,$=Math.min(V,U),X=Math.max(V,U),ae=h+D*$;let Y=Math.floor(Math.min(ae,T)/this._granularityCellSize)+1,J=Math.ceil(Math.max(ae,T)/this._granularityCellSize)-1,he=T<ae;const ye=z===0;if(ye&&(v===S||v===A))return;if(ye||$>=1||X<=0){const Xe=l-v,$e=m+(r-m)*Math.min((S-v)/Xe,(A-v)/Xe);Y=Math.floor(Math.min($e,T)/this._granularityCellSize)+1,J=Math.ceil(Math.max($e,T)/this._granularityCellSize)-1,he=T<$e}const De=M>0?A:S;if(he)for(let Xe=Y;Xe<=J;Xe++)e.push(this._vertexToIndex(Xe*this._granularityCellSize,De));else for(let Xe=J;Xe>=Y;Xe--)e.push(this._vertexToIndex(Xe*this._granularityCellSize,De))}_generateOutline(e){const r=[];for(const l of e){const h=Kl(l,this._granularity,!0),f=this._pointArrayToIndices(h),m=[];for(let v=1;v<f.length;v++)m.push(f[v-1]),m.push(f[v]);r.push(m)}return r}_handlePoles(e){let r=!1,l=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(r||l)&&this._fillPoles(e,r,l)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){const l=e[r+1];l===ou&&(e[r+1]=-32767),l===zh&&(e[r+1]=32766)}}_generatePoleQuad(e,r,l,h,f,m){h>f!=(m===ou)?(e.push(r),e.push(l),e.push(this._vertexToIndex(h,m)),e.push(l),e.push(this._vertexToIndex(f,m)),e.push(this._vertexToIndex(h,m))):(e.push(l),e.push(r),e.push(this._vertexToIndex(h,m)),e.push(this._vertexToIndex(f,m)),e.push(l),e.push(this._vertexToIndex(h,m)))}_fillPoles(e,r,l){const h=this._vertexBuffer,f=Pt,m=e.length;for(let v=2;v<m;v+=3){const T=e[v-2],S=e[v-1],A=e[v],M=h[2*T],D=h[2*T+1],z=h[2*S],V=h[2*S+1],U=h[2*A],$=h[2*A+1];r&&(D===0&&V===0&&this._generatePoleQuad(e,T,S,M,z,ou),V===0&&$===0&&this._generatePoleQuad(e,S,A,z,U,ou),$===0&&D===0&&this._generatePoleQuad(e,A,T,U,M,ou)),l&&(D===f&&V===f&&this._generatePoleQuad(e,T,S,M,z,zh),V===f&&$===f&&this._generatePoleQuad(e,S,A,z,U,zh),$===f&&D===f&&this._generatePoleQuad(e,A,T,U,M,zh))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:h}=function(v){const T=[],S=[];for(const A of v)if(A.length!==0){A!==v[0]&&T.push(S.length/2);for(let M=0;M<A.length;M++)S.push(A[M].x),S.push(A[M].y)}return{flattened:S,holeIndices:T}}(e);let f;this._initializeVertices(l);try{const v=function(S,A,M=2){const D=A&&A.length,z=D?A[0]*M:S.length;let V=Iy(S,0,z,M,!0);const U=[];if(!V||V.next===V.prev)return U;let $,X,ae;if(D&&(V=function(Y,J,he,ye){const De=[];for(let Xe=0,$e=J.length;Xe<$e;Xe++){const Qe=Iy(Y,J[Xe]*ye,Xe<$e-1?J[Xe+1]*ye:Y.length,ye,!1);Qe===Qe.next&&(Qe.steiner=!0),De.push(OT(Qe))}De.sort(LT);for(let Xe=0;Xe<De.length;Xe++)he=zT(De[Xe],he);return he}(S,A,V,M)),S.length>80*M){$=S[0],X=S[1];let Y=$,J=X;for(let he=M;he<z;he+=M){const ye=S[he],De=S[he+1];ye<$&&($=ye),De<X&&(X=De),ye>Y&&(Y=ye),De>J&&(J=De)}ae=Math.max(Y-$,J-X),ae=ae!==0?32767/ae:0}return Rh(V,U,M,$,X,ae,0),U}(l,h),T=this._convertIndices(l,v);f=this._subdivideTrianglesScanline(T)}catch(v){console.error(v)}let m=[];return r&&(m=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:m}}_convertIndices(e,r){const l=[];for(let h=0;h<r.length;h++)l.push(this._vertexToIndex(e[2*r[h]],e[2*r[h]+1]));return l}_pointArrayToIndices(e){const r=[];for(let l=0;l<e.length;l++){const h=e[l];r.push(this._vertexToIndex(h.x,h.y))}return r}}function My(i,e,r,l=!0){return new VT(r,e).subdividePolygonInternal(i,l)}function Kl(i,e,r=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const l=i[0],h=i[i.length-1],f=r&&(l.x!==h.x||l.y!==h.y);if(e<2)return f?[...i,i[0]]:[...i];const m=Math.floor(Pt/e),v=[];v.push(new R(i[0].x,i[0].y));const T=i.length,S=f?T:T-1;for(let A=0;A<S;A++){const M=i[A],D=A<T-1?i[A+1]:i[0],z=M.x,V=M.y,U=D.x,$=D.y,X=z!==U,ae=V!==$;if(!X&&!ae)continue;const Y=U-z,J=$-V,he=Math.abs(Y),ye=Math.abs(J);let De=z,Xe=V;for(;;){const Qe=Y>0?(Math.floor(De/m)+1)*m:(Math.ceil(De/m)-1)*m,ut=J>0?(Math.floor(Xe/m)+1)*m:(Math.ceil(Xe/m)-1)*m,et=Math.abs(De-Qe),Ke=Math.abs(Xe-ut),Ve=Math.abs(De-U),vt=Math.abs(Xe-$),_t=X?et/he:Number.POSITIVE_INFINITY,bt=ae?Ke/ye:Number.POSITIVE_INFINITY;if((Ve<=et||!X)&&(vt<=Ke||!ae))break;if(_t<bt&&X||!ae){De=Qe,Xe+=J*_t;const pt=new R(De,Math.round(Xe));v[v.length-1].x===pt.x&&v[v.length-1].y===pt.y||v.push(pt)}else{De+=Y*bt,Xe=ut;const pt=new R(Math.round(De),Xe);v[v.length-1].x===pt.x&&v[v.length-1].y===pt.y||v.push(pt)}}const $e=new R(U,$);v[v.length-1].x===$e.x&&v[v.length-1].y===$e.y||v.push($e)}return v}function BT(i,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,h=i[2*e[0]];for(let T=1;T<e.length;T++){const S=i[2*e[T]];S<h&&(h=S,l=T)}const f=e.length;let m=l,v=(m+1)%f;for(;;){const T=m-1>=0?m-1:f-1,S=(v+1)%f,A=i[2*e[T]],M=i[2*e[S]],D=i[2*e[m]],z=i[2*e[m]+1],V=i[2*e[v]+1];let U=!1;if(A<M)U=!0;else if(A>M)U=!1;else{const $=V-z,X=-(i[2*e[v]]-D),ae=z<V?1:-1;((A-D)*$+(i[2*e[T]+1]-z)*X)*ae>((M-D)*$+(i[2*e[S]+1]-z)*X)*ae&&(U=!0)}if(U){const $=e[T],X=e[m],ae=e[v];$!==X&&$!==ae&&X!==ae&&r.push(ae,X,$),m--,m<0&&(m=f-1)}else{const $=e[S],X=e[m],ae=e[v];$!==X&&$!==ae&&X!==ae&&r.push(ae,X,$),v++,v>=f&&(v=0)}if(T===S)break}}function Ry(i,e,r,l,h,f,m,v,T){const S=h.length/2,A=m&&v&&T;if(S<dt.MAX_VERTEX_ARRAY_LENGTH){const M=e.prepareSegment(S,r,l),D=M.vertexLength;for(let U=0;U<f.length;U+=3)l.emplaceBack(D+f[U],D+f[U+1],D+f[U+2]);let z,V;M.vertexLength+=S,M.primitiveLength+=f.length/3,A&&(V=m.prepareSegment(S,r,v),z=V.vertexLength,V.vertexLength+=S);for(let U=0;U<h.length;U+=2)i(h[U],h[U+1]);if(A)for(let U=0;U<T.length;U++){const $=T[U];for(let X=1;X<$.length;X+=2)v.emplaceBack(z+$[X-1],z+$[X]);V.primitiveLength+=$.length/2}}else(function(M,D,z,V,U,$){const X=[];for(let ye=0;ye<V.length/2;ye++)X.push(-1);const ae={count:0};let Y=0,J=M.getOrCreateLatestSegment(D,z),he=J.vertexLength;for(let ye=2;ye<U.length;ye+=3){const De=U[ye-2],Xe=U[ye-1],$e=U[ye];let Qe=X[De]<Y,ut=X[Xe]<Y,et=X[$e]<Y;J.vertexLength+((Qe?1:0)+(ut?1:0)+(et?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(J=M.createNewSegment(D,z),Y=ae.count,Qe=!0,ut=!0,et=!0,he=0);const Ke=Fh(X,V,$,ae,De,Qe,J),Ve=Fh(X,V,$,ae,Xe,ut,J),vt=Fh(X,V,$,ae,$e,et,J);z.emplaceBack(he+Ke-Y,he+Ve-Y,he+vt-Y),J.primitiveLength++}})(e,r,l,h,f,i),A&&function(M,D,z,V,U,$){const X=[];for(let ye=0;ye<V.length/2;ye++)X.push(-1);const ae={count:0};let Y=0,J=M.getOrCreateLatestSegment(D,z),he=J.vertexLength;for(let ye=0;ye<U.length;ye++){const De=U[ye];for(let Xe=1;Xe<U[ye].length;Xe+=2){const $e=De[Xe-1],Qe=De[Xe];let ut=X[$e]<Y,et=X[Qe]<Y;J.vertexLength+((ut?1:0)+(et?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(J=M.createNewSegment(D,z),Y=ae.count,ut=!0,et=!0,he=0);const Ke=Fh(X,V,$,ae,$e,ut,J),Ve=Fh(X,V,$,ae,Qe,et,J);z.emplaceBack(he+Ke-Y,he+Ve-Y),J.primitiveLength++}}}(m,r,v,h,T,i),e.forceNewSegmentOnNextPrepare(),m==null||m.forceNewSegmentOnNextPrepare()}function Fh(i,e,r,l,h,f,m){if(f){const v=l.count;return r(e[2*h],e[2*h+1]),i[h]=l.count,l.count++,m.vertexLength++,v}return i[h]}class zm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new re,this.indexArray=new Ne,this.indexArray2=new it,this.programConfigurations=new ua(e.layers,e.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){this.hasDependencies=bp("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),f=!h.isConstant(),m=[];for(const{feature:v,id:T,index:S,sourceLayerIndex:A}of e){const M=this.layers[0]._featureFilter.needGeometry,D=Do(v,M);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),D,l))continue;const z=f?h.evaluate(D,{},l,r.availableImages):void 0,V={id:T,properties:v.properties,type:v.type,sourceLayerIndex:A,index:S,geometry:M?D.geometry:ko(v),patterns:{},sortKey:z};m.push(V)}f&&m.sort((v,T)=>v.sortKey-T.sortKey);for(const v of m){const{geometry:T,index:S,sourceLayerIndex:A}=v;if(this.hasDependencies){const M=km("fill",this.layers,v,{zoom:this.zoom},r);this.patternFeatures.push(M)}else this.addFeature(v,T,S,l,{},r.subdivisionGranularity);r.featureIndex.insert(e[S].feature,T,S,A,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:l})}addFeatures(e,r,l){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,l,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,CT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,l,h,f,m){for(const v of Tc(r,500)){const T=My(v,h,m.fill.getGranularityForZoomLevel(h.z)),S=this.layoutVertexArray;Ry((A,M)=>{S.emplaceBack(A,M)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:f,canonical:h})}}let ky,Dy;xt("FillBucket",zm,{omit:["layers","patternFeatures"]});var UT={get paint(){return Dy=Dy||new Si({"fill-antialias":new St(Ce.paint_fill["fill-antialias"]),"fill-opacity":new Ot(Ce.paint_fill["fill-opacity"]),"fill-color":new Ot(Ce.paint_fill["fill-color"]),"fill-outline-color":new Ot(Ce.paint_fill["fill-outline-color"]),"fill-translate":new St(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new St(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bl(Ce.paint_fill["fill-pattern"])})},get layout(){return ky=ky||new Si({"fill-sort-key":new Ot(Ce.layout_fill["fill-sort-key"])})}};class jT extends gs{constructor(e,r){super(e,UT,r)}recalculate(e,r){super.recalculate(e,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new zm(e)}queryRadius(){return vp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:l,pixelsToTileUnits:h}){return hy(xp(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,h),r)}isTileClipped(){return!0}}const qT=kr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),$T=kr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:GT}=qT;class Oh{constructor(e,r,l,h,f){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=f,e.readFields(HT,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,l=[];let h,f=1,m=0,v=0,T=0;for(;e.pos<r;){if(m<=0){const S=e.readVarint();f=7&S,m=S>>3}if(m--,f===1||f===2)v+=e.readSVarint(),T+=e.readSVarint(),f===1&&(h&&l.push(h),h=[]),h&&h.push(new R(v,T));else{if(f!==7)throw new Error(`unknown command ${f}`);h&&h.push(h[0].clone())}}return h&&l.push(h),l}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let l=1,h=0,f=0,m=0,v=1/0,T=-1/0,S=1/0,A=-1/0;for(;e.pos<r;){if(h<=0){const M=e.readVarint();l=7&M,h=M>>3}if(h--,l===1||l===2)f+=e.readSVarint(),m+=e.readSVarint(),f<v&&(v=f),f>T&&(T=f),m<S&&(S=m),m>A&&(A=m);else if(l!==7)throw new Error(`unknown command ${l}`)}return[v,S,T,A]}toGeoJSON(e,r,l){const h=this.extent*Math.pow(2,l),f=this.extent*e,m=this.extent*r,v=this.loadGeometry();function T(D){return[360*(D.x+f)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+m)/h)*Math.PI))-90]}function S(D){return D.map(T)}let A;if(this.type===1){const D=[];for(const V of v)D.push(V[0]);const z=S(D);A=D.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z}}else if(this.type===2){const D=v.map(S);A=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=Ly(v),z=[];for(const V of D)z.push(V.map(S));A=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z}}}const M={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(M.id=this.id),M}}function HT(i,e,r){i===1?e.id=r.readVarint():i===2?function(l,h){const f=l.readVarint()+l.pos;for(;l.pos<f;){const m=h._keys[l.readVarint()],v=h._values[l.readVarint()];h.properties[m]=v}}(r,e):i===3?e.type=r.readVarint():i===4&&(e._geometry=r.pos)}function Ly(i){const e=i.length;if(e<=1)return[i];const r=[];let l,h;for(let f=0;f<e;f++){const m=ZT(i[f]);m!==0&&(h===void 0&&(h=m<0),h===m<0?(l&&r.push(l),l=[i[f]]):l&&l.push(i[f]))}return l&&r.push(l),r}function ZT(i){let e=0;for(let r,l,h=0,f=i.length,m=f-1;h<f;m=h++)r=i[h],l=i[m],e+=(l.x-r.x)*(r.y+l.y);return e}Oh.types=["Unknown","Point","LineString","Polygon"];class WT{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(KT,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new Oh(this._pbf,r,this.extent,this._keys,this._values)}}function KT(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(l){let h=null;const f=l.readVarint()+l.pos;for(;l.pos<f;){const m=l.readVarint()>>3;h=m===1?l.readString():m===2?l.readFloat():m===3?l.readDouble():m===4?l.readVarint64():m===5?l.readVarint():m===6?l.readSVarint():m===7?l.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h}(r))}class zy{constructor(e,r){this.layers=e.readFields(XT,{},r)}}function XT(i,e,r){if(i===3){const l=new WT(r,r.readVarint()+r.pos);l.length&&(e[l.name]=l)}}const Fm=Math.pow(2,13);function Nh(i,e,r,l,h,f,m,v){i.emplaceBack(e,r,2*Math.floor(l*Fm)+m,h*Fm*2,f*Fm*2,Math.round(v))}class Om{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new le,this.centroidVertexArray=new te,this.indexArray=new Ne,this.programConfigurations=new ua(e.layers,e.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){this.features=[],this.hasDependencies=bp("fill-extrusion",this.layers,r);for(const{feature:h,id:f,index:m,sourceLayerIndex:v}of e){const T=this.layers[0]._featureFilter.needGeometry,S=Do(h,T);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),S,l))continue;const A={id:f,sourceLayerIndex:v,index:m,geometry:T?S.geometry:ko(h),properties:h.properties,type:h.type,patterns:{}};this.hasDependencies?this.features.push(km("fill-extrusion",this.layers,A,{zoom:this.zoom},r)):this.addFeature(A,A.geometry,m,l,{},r.subdivisionGranularity),r.featureIndex.insert(h,A.geometry,m,v,this.index,!0)}}addFeatures(e,r,l){for(const h of this.features){const{geometry:f}=h;this.addFeature(h,f,h.index,r,l,e.subdivisionGranularity)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,GT),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,$T.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,l,h,f,m){for(const v of Tc(r,500)){const T={x:0,y:0,sampleCount:0},S=this.layoutVertexArray.length;this.processPolygon(T,h,e,v,m);const A=this.layoutVertexArray.length-S,M=Math.floor(T.x/T.sampleCount),D=Math.floor(T.y/T.sampleCount);for(let z=0;z<A;z++)this.centroidVertexArray.emplaceBack(M,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:f,canonical:h})}processPolygon(e,r,l,h,f){if(h.length<1||Fy(h[0]))return;for(const M of h)M.length!==0&&YT(e,M);const m={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=f.fill.getGranularityForZoomLevel(r.z),T=Oh.types[l.type]==="Polygon";for(const M of h){if(M.length===0||Fy(M))continue;const D=Kl(M,v,T);this._generateSideFaces(D,m)}if(!T)return;const S=My(h,r,v,!1),A=this.layoutVertexArray;Ry((M,D)=>{Nh(A,M,D,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles)}_generateSideFaces(e,r){let l=0;for(let h=1;h<e.length;h++){const f=e[h],m=e[h-1];if(QT(f,m))continue;r.segment.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=f.sub(m)._perp()._unit(),T=m.dist(f);l+T>32768&&(l=0),Nh(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,0,l),Nh(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,1,l),l+=T,Nh(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,0,l),Nh(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,1,l);const S=r.segment.vertexLength;this.indexArray.emplaceBack(S,S+2,S+1),this.indexArray.emplaceBack(S+1,S+2,S+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function YT(i,e){for(let r=0;r<e.length;r++){const l=e[r];r===e.length-1&&e[0].x===l.x&&e[0].y===l.y||(i.x+=l.x,i.y+=l.y,i.sampleCount++)}}function QT(i,e){return i.x===e.x&&(i.x<0||i.x>Pt)||i.y===e.y&&(i.y<0||i.y>Pt)}function Fy(i){return i.every(e=>e.x<0)||i.every(e=>e.x>Pt)||i.every(e=>e.y<0)||i.every(e=>e.y>Pt)}let Oy;xt("FillExtrusionBucket",Om,{omit:["layers","features"]});var JT={get paint(){return Oy=Oy||new Si({"fill-extrusion-opacity":new St(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ot(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new St(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new St(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bl(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ot(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ot(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new St(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class e2 extends gs{constructor(e,r){super(e,JT,r)}createBucket(e){return new Om(e)}queryRadius(){return vp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:l,geometry:h,transform:f,pixelsToTileUnits:m,pixelPosMatrix:v}){const T=xp(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,m),S=this.paint.get("fill-extrusion-height").evaluate(r,l),A=this.paint.get("fill-extrusion-base").evaluate(r,l),M=function(z,V){const U=[];for(const $ of z){const X=[$.x,$.y,0,1];Jt(X,X,V),U.push(new R(X[0]/X[3],X[1]/X[3]))}return U}(T,v),D=function(z,V,U,$){const X=[],ae=[],Y=$[8]*V,J=$[9]*V,he=$[10]*V,ye=$[11]*V,De=$[8]*U,Xe=$[9]*U,$e=$[10]*U,Qe=$[11]*U;for(const ut of z){const et=[],Ke=[];for(const Ve of ut){const vt=Ve.x,_t=Ve.y,bt=$[0]*vt+$[4]*_t+$[12],pt=$[1]*vt+$[5]*_t+$[13],kt=$[2]*vt+$[6]*_t+$[14],On=$[3]*vt+$[7]*_t+$[15],En=kt+he,yr=On+ye,bi=bt+De,qr=pt+Xe,vr=kt+$e,pr=On+Qe,Hn=new R((bt+Y)/yr,(pt+J)/yr);Hn.z=En/yr,et.push(Hn);const Sr=new R(bi/pr,qr/pr);Sr.z=vr/pr,Ke.push(Sr)}X.push(et),ae.push(Ke)}return[X,ae]}(h,A,S,v);return function(z,V,U){let $=1/0;hy(U,V)&&($=Ny(U,V[0]));for(let X=0;X<V.length;X++){const ae=V[X],Y=z[X];for(let J=0;J<ae.length-1;J++){const he=ae[J],ye=[he,ae[J+1],Y[J+1],Y[J],he];tu(U,ye)&&($=Math.min($,Ny(U,ye)))}}return $!==1/0&&$}(D[0],D[1],M)}}function Vh(i,e){return i.x*e.x+i.y*e.y}function Ny(i,e){if(i.length===1){let r=0;const l=e[r++];let h;for(;!h||l.equals(h);)if(h=e[r++],!h)return 1/0;for(;r<e.length;r++){const f=e[r],m=i[0],v=h.sub(l),T=f.sub(l),S=m.sub(l),A=Vh(v,v),M=Vh(v,T),D=Vh(T,T),z=Vh(S,v),V=Vh(S,T),U=A*D-M*M,$=(D*z-M*V)/U,X=(A*V-M*z)/U,ae=l.z*(1-$-X)+h.z*$+f.z*X;if(isFinite(ae))return ae}return 1/0}{let r=1/0;for(const l of e)r=Math.min(r,l.z);return r}}const t2=kr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:n2}=t2,r2=kr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:i2}=r2,s2=Math.cos(Math.PI/180*37.5),Vy=Math.pow(2,14)/.5;class Nm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ve,this.layoutVertexArray2=new oe,this.indexArray=new Ne,this.programConfigurations=new ua(e.layers,e.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,l){this.hasDependencies=bp("line",this.layers,r)||this.hasLineDasharray(this.layers);const h=this.layers[0].layout.get("line-sort-key"),f=!h.isConstant(),m=[];for(const{feature:v,id:T,index:S,sourceLayerIndex:A}of e){const M=this.layers[0]._featureFilter.needGeometry,D=Do(v,M);if(!this.layers[0]._featureFilter.filter(new Jn(this.zoom),D,l))continue;const z=f?h.evaluate(D,{},l):void 0,V={id:T,properties:v.properties,type:v.type,sourceLayerIndex:A,index:S,geometry:M?D.geometry:ko(v),patterns:{},dashes:{},sortKey:z};m.push(V)}f&&m.sort((v,T)=>v.sortKey-T.sortKey);for(const v of m){const{geometry:T,index:S,sourceLayerIndex:A}=v;this.hasDependencies?(bp("line",this.layers,r)?km("line",this.layers,v,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,v,this.zoom,r),this.patternFeatures.push(v)):this.addFeature(v,T,S,l,{},{},r.subdivisionGranularity),r.featureIndex.insert(e[S].feature,T,S,A,this.index)}}update(e,r,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:l,dashPositions:h})}addFeatures(e,r,l,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,l,h,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,i2)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,n2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,l,h,f,m,v){const T=this.layers[0].layout,S=T.get("line-join").evaluate(e,{}),A=T.get("line-cap"),M=T.get("line-miter-limit"),D=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of r)this.addLine(z,e,S,A,M,D,h,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:f,dashPositions:m,canonical:h})}addLine(e,r,l,h,f,m,v,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Kl(e,v?T.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=Oh.types[r.type]==="Polygon";let A=e.length;for(;A>=2&&e[A-1].equals(e[A-2]);)A--;let M=0;for(;M<A-1&&e[M].equals(e[M+1]);)M++;if(A<(S?3:2))return;l==="bevel"&&(f=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let V,U,$,X,ae;this.e1=this.e2=-1,S&&(V=e[A-2],ae=e[M].sub(V)._unit()._perp());for(let Y=M;Y<A;Y++){if($=Y===A-1?S?e[M+1]:void 0:e[Y+1],$&&e[Y].equals($))continue;ae&&(X=ae),V&&(U=V),V=e[Y],ae=$?$.sub(V)._unit()._perp():X,X=X||ae;let J=X.add(ae);J.x===0&&J.y===0||J._unit();const he=X.x*ae.x+X.y*ae.y,ye=J.x*ae.x+J.y*ae.y,De=ye!==0?1/ye:1/0,Xe=2*Math.sqrt(2-2*ye),$e=ye<s2&&U&&$,Qe=X.x*ae.y-X.y*ae.x>0;if($e&&Y>M){const Ke=V.dist(U);if(Ke>2*D){const Ve=V.sub(V.sub(U)._mult(D/Ke)._round());this.updateDistance(U,Ve),this.addCurrentVertex(Ve,X,0,0,z),U=Ve}}const ut=U&&$;let et=ut?l:S?"butt":h;if(ut&&et==="round"&&(De<m?et="miter":De<=2&&(et="fakeround")),et==="miter"&&De>f&&(et="bevel"),et==="bevel"&&(De>2&&(et="flipbevel"),De<f&&(et="miter")),U&&this.updateDistance(U,V),et==="miter")J._mult(De),this.addCurrentVertex(V,J,0,0,z);else if(et==="flipbevel"){if(De>100)J=ae.mult(-1);else{const Ke=De*X.add(ae).mag()/X.sub(ae).mag();J._perp()._mult(Ke*(Qe?-1:1))}this.addCurrentVertex(V,J,0,0,z),this.addCurrentVertex(V,J.mult(-1),0,0,z)}else if(et==="bevel"||et==="fakeround"){const Ke=-Math.sqrt(De*De-1),Ve=Qe?Ke:0,vt=Qe?0:Ke;if(U&&this.addCurrentVertex(V,X,Ve,vt,z),et==="fakeround"){const _t=Math.round(180*Xe/Math.PI/20);for(let bt=1;bt<_t;bt++){let pt=bt/_t;if(pt!==.5){const On=pt-.5;pt+=pt*On*(pt-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*On*On+(.848013+he*(.215638*he-1.06021)))}const kt=ae.sub(X)._mult(pt)._add(X)._unit()._mult(Qe?-1:1);this.addHalfVertex(V,kt.x,kt.y,!1,Qe,0,z)}}$&&this.addCurrentVertex(V,ae,-Ve,-vt,z)}else if(et==="butt")this.addCurrentVertex(V,J,0,0,z);else if(et==="square"){const Ke=U?1:-1;this.addCurrentVertex(V,J,Ke,Ke,z)}else et==="round"&&(U&&(this.addCurrentVertex(V,X,0,0,z),this.addCurrentVertex(V,X,1,1,z,!0)),$&&(this.addCurrentVertex(V,ae,-1,-1,z,!0),this.addCurrentVertex(V,ae,0,0,z)));if($e&&Y<A-1){const Ke=V.dist($);if(Ke>2*D){const Ve=V.add($.sub(V)._mult(D/Ke)._round());this.updateDistance(V,Ve),this.addCurrentVertex(Ve,ae,0,0,z),V=Ve}}}}addCurrentVertex(e,r,l,h,f,m=!1){const v=r.y*h-r.x,T=-r.y-r.x*h;this.addHalfVertex(e,r.x+r.y*l,r.y-r.x*l,m,!1,l,f),this.addHalfVertex(e,v,T,m,!0,-h,f),this.distance>Vy/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,l,h,f,m))}addHalfVertex({x:e,y:r},l,h,f,m,v,T){const S=.5*(this.lineClips?this.scaledDistance*(Vy-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(m?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,A,this.e2),T.primitiveLength++),m?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}hasLineDasharray(e){for(const r of e){const l=r.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(e,r,l,h){for(const f of e){const m=f.paint.get("line-dasharray");if(!m||m.value.kind==="constant")continue;const v=f.layout.get("line-cap")==="round",T={dasharray:m.value.evaluate({zoom:l-1},r,{}),round:v},S={dasharray:m.value.evaluate({zoom:l},r,{}),round:v},A={dasharray:m.value.evaluate({zoom:l+1},r,{}),round:v},M=`${T.dasharray.join(",")},${T.round}`,D=`${S.dasharray.join(",")},${S.round}`,z=`${A.dasharray.join(",")},${A.round}`;h.dashDependencies[M]=T,h.dashDependencies[D]=S,h.dashDependencies[z]=A,r.dashes[f.id]={min:M,mid:D,max:z}}}}let By,Uy;xt("LineBucket",Nm,{omit:["layers","patternFeatures"]});var jy={get paint(){return Uy=Uy||new Si({"line-opacity":new Ot(Ce.paint_line["line-opacity"]),"line-color":new Ot(Ce.paint_line["line-color"]),"line-translate":new St(Ce.paint_line["line-translate"]),"line-translate-anchor":new St(Ce.paint_line["line-translate-anchor"]),"line-width":new Ot(Ce.paint_line["line-width"]),"line-gap-width":new Ot(Ce.paint_line["line-gap-width"]),"line-offset":new Ot(Ce.paint_line["line-offset"]),"line-blur":new Ot(Ce.paint_line["line-blur"]),"line-dasharray":new Bl(Ce.paint_line["line-dasharray"]),"line-pattern":new Bl(Ce.paint_line["line-pattern"]),"line-gradient":new Zc(Ce.paint_line["line-gradient"])})},get layout(){return By=By||new Si({"line-cap":new St(Ce.layout_line["line-cap"]),"line-join":new Ot(Ce.layout_line["line-join"]),"line-miter-limit":new St(Ce.layout_line["line-miter-limit"]),"line-round-limit":new St(Ce.layout_line["line-round-limit"]),"line-sort-key":new Ot(Ce.layout_line["line-sort-key"])})}};class o2 extends Ot{possiblyEvaluate(e,r){return r=new Jn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,h){return r=Wt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,h)}}let Ip;class a2 extends gs{constructor(e,r){super(e,jy,r),this.gradientVersion=0,Ip||(Ip=new o2(jy.paint.properties["line-width"].specification),Ip.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof ps,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Ip.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Nm(e)}queryRadius(e){const r=e,l=qy(ru("line-width",this,r),ru("line-gap-width",this,r)),h=ru("line-offset",this,r);return l/2+Math.abs(h)+vp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:l,geometry:h,transform:f,pixelsToTileUnits:m}){const v=xp(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,m),T=m/2*qy(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),S=this.paint.get("line-offset").evaluate(r,l);return S&&(h=function(A,M){const D=[];for(let z=0;z<A.length;z++){const V=mT(A[z]),U=[];for(let $=0;$<V.length;$++){const X=V[$],ae=V[$-1],Y=V[$+1],J=$===0?new R(0,0):X.sub(ae)._unit()._perp(),he=$===V.length-1?new R(0,0):Y.sub(X)._unit()._perp(),ye=J._add(he)._unit(),De=ye.x*he.x+ye.y*he.y;De!==0&&ye._mult(1/De),U.push(ye._mult(M)._add(X))}D.push(U)}return D}(h,S*m)),function(A,M,D){for(let z=0;z<M.length;z++){const V=M[z];if(A.length>=3){for(let U=0;U<V.length;U++)if(nu(A,V[U]))return!0}if(dT(A,V,D))return!0}return!1}(v,h,T)}isTileClipped(){return!0}}function qy(i,e){return e>0?e+2*i:i}const l2=kr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),c2=kr([{name:"a_projected_pos",components:3,type:"Float32"}],4);kr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const u2=kr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);kr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $y=kr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),h2=kr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function d2(i,e,r){return i.sections.forEach(l=>{l.text=function(h,f,m){const v=f.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),Co.applyArabicShaping&&(h=Co.applyArabicShaping(h)),h}(l.text,e,r)}),i}kr([{name:"triangle",components:3,type:"Uint16"}]),kr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),kr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),kr([{type:"Float32",name:"offsetX"}]),kr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),kr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var ni=24;const Bh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},p2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},f2={40:!0};function Gy(i,e,r,l,h,f){if("fontStack"in e){const m=r[e.fontStack],v=m&&m[i];return v?v.metrics.advance*e.scale+h:0}{const m=l[e.imageName];return m?m.displaySize[0]*e.scale*ni/f+h:0}}function Hy(i,e,r,l){const h=Math.pow(i-e,2);return l?i<e?h/2:2*h:h+Math.abs(r)*r}function m2(i,e,r){let l=0;return i===10&&(l-=1e4),r&&(l+=150),i!==40&&i!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function Zy(i,e,r,l,h,f){let m=null,v=Hy(e,r,h,f);for(const T of l){const S=Hy(e-T.x,r,h,f)+T.badness;S<=v&&(m=T,v=S)}return{index:i,x:e,priorBreak:m,badness:v}}function Wy(i){return i?Wy(i.priorBreak).concat(i.index):[]}class au{constructor(e="",r=[],l=[]){this.text=e,this.sections=r,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(e,r){const l=new au;for(let h=0;h<e.sections.length;h++){const f=e.sections[h];f.image?l.addImageSection(f):l.addTextSection(f,r)}return l}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=function(e){let r="",l={premature:!0,value:void 0};const h=e[Symbol.iterator]();let f=h.next();const m=e[Symbol.iterator]();m.next();let v=m.next();for(;!f.done;)r+=!v.done&&gh(v.value.codePointAt(0))&&!Bh[v.value]||!l.premature&&gh(l.value.codePointAt(0))&&!Bh[l.value]||!Bh[f.value]?f.value:Bh[f.value],l={value:f.value,premature:!1},f=h.next(),v=m.next();return r}(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),r=e?e[0].length:0,l=this.text.match(/\S\s*$/),h=l?l[0].length-1:0;this.text=this.text.substring(r,this.text.length-h),this.sectionIndex=this.sectionIndex.slice(r,this.sectionIndex.length-h)}substring(e,r){const l=[...this.text].slice(e,r).join(""),h=this.sectionIndex.slice(e,r);return new au(l,this.sections,h)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}getMaxImageSize(e){let r=0,l=0;for(let h=0;h<this.length();h++){const f=this.getSection(h);if("imageName"in f){const m=e[f.imageName];if(!m)continue;const v=m.displaySize;r=Math.max(r,v[0]),l=Math.max(l,v[1])}}return{maxImageWidth:r,maxImageHeight:l}}addTextSection(e,r){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||r});const l=this.sections.length-1;this.sectionIndex.push(...[...e.text].map(()=>l))}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Nt("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:r}),this.sectionIndex.push(this.sections.length-1)):Nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,r,l,h,f){const m=[],v=this.determineAverageLineWidth(e,r,l,h,f),T=this.hasZeroWidthSpaces();let S=0,A=0;const M=this.text[Symbol.iterator]();let D=M.next();const z=this.text[Symbol.iterator]();z.next();let V=z.next();const U=this.text[Symbol.iterator]();U.next(),U.next();let $=U.next();for(;!D.done;){const X=this.getSection(A),ae=D.value.codePointAt(0);if(ap(ae)||(S+=Gy(ae,X,l,h,e,f)),!V.done){const Y=Ol(ae),J=V.value.codePointAt(0);(p2[ae]||Y||"imageName"in X||!$.done&&f2[J])&&m.push(Zy(A+1,S,v,m,m2(ae,J,Y&&T),!1))}A++,D=M.next(),V=z.next(),$=U.next()}return Wy(Zy(this.length(),S,v,m,0,!0))}determineAverageLineWidth(e,r,l,h,f){let m=0,v=0;for(const T of this.text){const S=this.getSection(v);m+=Gy(T.codePointAt(0),S,l,h,e,f),v++}return m/Math.max(1,Math.ceil(m/r))}}const Vm=4294967296,Ky=1/Vm,Xy=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Sp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,r,l=this.length){for(;this.pos<l;){const h=this.readVarint(),f=h>>3,m=this.pos;this.type=7&h,e(f,r,this),this.pos===m&&this.skip(h)}return r}readMessage(e,r){return this.readFields(e,r,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Vm;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Vm;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const r=this.buf;let l,h;return h=r[this.pos++],l=127&h,h<128?l:(h=r[this.pos++],l|=(127&h)<<7,h<128?l:(h=r[this.pos++],l|=(127&h)<<14,h<128?l:(h=r[this.pos++],l|=(127&h)<<21,h<128?l:(h=r[this.pos],l|=(15&h)<<28,function(f,m,v){const T=v.buf;let S,A;if(A=T[v.pos++],S=(112&A)>>4,A<128||(A=T[v.pos++],S|=(127&A)<<3,A<128)||(A=T[v.pos++],S|=(127&A)<<10,A<128)||(A=T[v.pos++],S|=(127&A)<<17,A<128)||(A=T[v.pos++],S|=(127&A)<<24,A<128)||(A=T[v.pos++],S|=(1&A)<<31,A<128))return lu(f,S,m);throw new Error("Expected varint not more than 10 bytes")}(l,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&Xy?Xy.decode(this.buf.subarray(r,e)):function(l,h,f){let m="",v=h;for(;v<f;){const T=l[v];let S,A,M,D=null,z=T>239?4:T>223?3:T>191?2:1;if(v+z>f)break;z===1?T<128&&(D=T):z===2?(S=l[v+1],(192&S)==128&&(D=(31&T)<<6|63&S,D<=127&&(D=null))):z===3?(S=l[v+1],A=l[v+2],(192&S)==128&&(192&A)==128&&(D=(15&T)<<12|(63&S)<<6|63&A,(D<=2047||D>=55296&&D<=57343)&&(D=null))):z===4&&(S=l[v+1],A=l[v+2],M=l[v+3],(192&S)==128&&(192&A)==128&&(192&M)==128&&(D=(15&T)<<18|(63&S)<<12|(63&A)<<6|63&M,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,z=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),v+=z}return m}(this.buf,r,e)}readBytes(){const e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r}readPackedVarint(e=[],r){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readVarint(r));return e}readPackedSVarint(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const r=7&e;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(e,r){this.writeVarint(e<<3|r)}realloc(e){let r=this.length||16;for(;r<this.pos+e;)r*=2;if(r!==this.length){const l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ky),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Ky),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(r,l){let h,f;if(r>=0?(h=r%4294967296|0,f=r/4294967296|0):(h=~(-r%4294967296),f=~(-r/4294967296),4294967295^h?h=h+1|0:(h=0,f=f+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(m,v,T){T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,T.buf[T.pos]=127&(m>>>=7)}(h,0,l),function(m,v){const T=(7&m)<<4;v.buf[v.pos++]|=T|((m>>>=3)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m)))))}(f,l)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const r=this.pos;this.pos=function(h,f,m){for(let v,T,S=0;S<f.length;S++){if(v=f.charCodeAt(S),v>55295&&v<57344){if(!T){v>56319||S+1===f.length?(h[m++]=239,h[m++]=191,h[m++]=189):T=v;continue}if(v<56320){h[m++]=239,h[m++]=191,h[m++]=189,T=v;continue}v=T-55296<<10|v-56320|65536,T=null}else T&&(h[m++]=239,h[m++]=191,h[m++]=189,T=null);v<128?h[m++]=v:(v<2048?h[m++]=v>>6|192:(v<65536?h[m++]=v>>12|224:(h[m++]=v>>18|240,h[m++]=v>>12&63|128),h[m++]=v>>6&63|128),h[m++]=63&v|128)}return m}(this.buf,e,this.pos);const l=this.pos-r;l>=128&&Yy(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const r=e.length;this.writeVarint(r),this.realloc(r);for(let l=0;l<r;l++)this.buf[this.pos++]=e[l]}writeRawMessage(e,r){this.pos++;const l=this.pos;e(r,this);const h=this.pos-l;h>=128&&Yy(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h}writeMessage(e,r,l){this.writeTag(e,2),this.writeRawMessage(r,l)}writePackedVarint(e,r){r.length&&this.writeMessage(e,g2,r)}writePackedSVarint(e,r){r.length&&this.writeMessage(e,_2,r)}writePackedBoolean(e,r){r.length&&this.writeMessage(e,x2,r)}writePackedFloat(e,r){r.length&&this.writeMessage(e,y2,r)}writePackedDouble(e,r){r.length&&this.writeMessage(e,v2,r)}writePackedFixed32(e,r){r.length&&this.writeMessage(e,b2,r)}writePackedSFixed32(e,r){r.length&&this.writeMessage(e,w2,r)}writePackedFixed64(e,r){r.length&&this.writeMessage(e,T2,r)}writePackedSFixed64(e,r){r.length&&this.writeMessage(e,E2,r)}writeBytesField(e,r){this.writeTag(e,2),this.writeBytes(r)}writeFixed32Field(e,r){this.writeTag(e,5),this.writeFixed32(r)}writeSFixed32Field(e,r){this.writeTag(e,5),this.writeSFixed32(r)}writeFixed64Field(e,r){this.writeTag(e,1),this.writeFixed64(r)}writeSFixed64Field(e,r){this.writeTag(e,1),this.writeSFixed64(r)}writeVarintField(e,r){this.writeTag(e,0),this.writeVarint(r)}writeSVarintField(e,r){this.writeTag(e,0),this.writeSVarint(r)}writeStringField(e,r){this.writeTag(e,2),this.writeString(r)}writeFloatField(e,r){this.writeTag(e,5),this.writeFloat(r)}writeDoubleField(e,r){this.writeTag(e,1),this.writeDouble(r)}writeBooleanField(e,r){this.writeVarintField(e,+r)}}function lu(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Yy(i,e,r){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(l);for(let h=r.pos-1;h>=i;h--)r.buf[h+l]=r.buf[h]}function g2(i,e){for(let r=0;r<i.length;r++)e.writeVarint(i[r])}function _2(i,e){for(let r=0;r<i.length;r++)e.writeSVarint(i[r])}function y2(i,e){for(let r=0;r<i.length;r++)e.writeFloat(i[r])}function v2(i,e){for(let r=0;r<i.length;r++)e.writeDouble(i[r])}function x2(i,e){for(let r=0;r<i.length;r++)e.writeBoolean(i[r])}function b2(i,e){for(let r=0;r<i.length;r++)e.writeFixed32(i[r])}function w2(i,e){for(let r=0;r<i.length;r++)e.writeSFixed32(i[r])}function T2(i,e){for(let r=0;r<i.length;r++)e.writeFixed64(i[r])}function E2(i,e){for(let r=0;r<i.length;r++)e.writeSFixed64(i[r])}function I2(i,e,r){i===1&&r.readMessage(S2,e)}function S2(i,e,r){if(i===3){const{id:l,bitmap:h,width:f,height:m,left:v,top:T,advance:S}=r.readMessage(P2,{});e.push({id:l,bitmap:new Mh({width:f+6,height:m+6},h),metrics:{width:f,height:m,left:v,top:T,advance:S}})}}function P2(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Qy(i){let e=0,r=0;for(const m of i)e+=m.w*m.h,r=Math.max(r,m.w);i.sort((m,v)=>v.h-m.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let h=0,f=0;for(const m of i)for(let v=l.length-1;v>=0;v--){const T=l[v];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,f=Math.max(f,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===T.w&&m.h===T.h){const S=l.pop();S&&v<l.length&&(l[v]=S)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(l.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:h,h:f,fill:e/(h*f)||0}}class Bm{constructor(e,{pixelRatio:r,version:l,stretchX:h,stretchY:f,content:m,textFitWidth:v,textFitHeight:T}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=h,this.stretchY=f,this.content=m,this.version=l,this.textFitWidth=v,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Jy{constructor(e,r){const l={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,l,f),this.addImages(r,h,f);const{w:m,h:v}=Qy(f),T=new ns({width:m||1,height:v||1});for(const S in e){const A=e[S],M=l[S].paddedRect;ns.copy(A.data,T,{x:0,y:0},{x:M.x+1,y:M.y+1},A.data)}for(const S in r){const A=r[S],M=h[S].paddedRect,D=M.x+1,z=M.y+1,V=A.data.width,U=A.data.height;ns.copy(A.data,T,{x:0,y:0},{x:D,y:z},A.data),ns.copy(A.data,T,{x:0,y:U-1},{x:D,y:z-1},{width:V,height:1}),ns.copy(A.data,T,{x:0,y:0},{x:D,y:z+U},{width:V,height:1}),ns.copy(A.data,T,{x:V-1,y:0},{x:D-1,y:z},{width:1,height:U}),ns.copy(A.data,T,{x:0,y:0},{x:D+V,y:z},{width:1,height:U})}this.image=T,this.iconPositions=l,this.patternPositions=h}addImages(e,r,l){for(const h in e){const f=e[h],m={x:0,y:0,w:f.data.width+2,h:f.data.height+2};l.push(m),r[h]=new Bm(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),r),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),r)}patchUpdatedImage(e,r,l){if(!e||!r||e.version===r.version)return;e.version=r.version;const[h,f]=e.tl;l.update(r.data,void 0,{x:h,y:f})}}var qa;function Pp(i,e,r,l,h,f,m,v,T,S,A,M,D,z,V){const U=au.fromFeature(i,h);let $;M===x.az.vertical&&U.verticalizePunctuation();let X=U.determineLineBreaks(S,f,e,l,z);const{processBidirectionalText:ae,processStyledBidirectionalText:Y}=Co;if(ae&&U.sections.length===1){$=[],X=X.map(De=>U.toCodeUnitIndex(De));const ye=ae(U.toString(),X);for(const De of ye){const Xe=[...De].map(()=>0);$.push(new au(De,U.sections,Xe))}}else if(Y){$=[],X=X.map($e=>U.toCodeUnitIndex($e));let ye=0;const De=[];for(const $e of U.text)De.push(...Array($e.length).fill(U.sectionIndex[ye])),ye++;const Xe=Y(U.text,De,X);for(const $e of Xe){const Qe=[];let ut="";for(const et of $e[0])Qe.push($e[1][ut.length]),ut+=et;$.push(new au($e[0],U.sections,Qe))}}else $=function(ye,De){const Xe=[];let $e=0;for(const Qe of De)Xe.push(ye.substring($e,Qe)),$e=Qe;return $e<ye.length()&&Xe.push(ye.substring($e,ye.length())),Xe}(U,X);const J=[],he={positionedLines:J,text:U.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(ye,De,Xe,$e,Qe,ut,et,Ke,Ve,vt,_t,bt){let pt=0,kt=0,On=0,En=0;const yr=Ke==="right"?1:Ke==="left"?0:.5,bi=ni/bt;let qr=0;for(const Hn of Qe){Hn.trim();const Sr=Hn.getMaxScale(),Lr={positionedGlyphs:[],lineOffset:0};ye.positionedLines[qr]=Lr;const lr=Lr.positionedGlyphs;let rs=0;if(!Hn.length()){kt+=ut,++qr;continue}const wi=A2($e,Hn,bi);let is=0;for(const si of Hn.text){const Tr=Hn.getSection(is),$r=si.codePointAt(0),Pr=C2(Ve,_t,$r),oi={glyph:$r,imageName:null,x:pt,y:kt+-17,vertical:Pr,scale:1,fontStack:"",sectionIndex:Hn.getSectionIndex(is),metrics:null,rect:null};let pa;if("fontStack"in Tr){if(pa=M2(Tr,$r,Pr,wi,De,Xe),!pa)continue;oi.fontStack=Tr.fontStack}else{if(ye.iconsInText=!0,Tr.scale*=bi,pa=R2(Tr,Pr,Sr,wi,$e),!pa)continue;rs=Math.max(rs,pa.imageOffset),oi.imageName=Tr.imageName}const{rect:lo,metrics:Zh,baselineOffset:Wa}=pa;oi.y+=Wa,oi.scale=Tr.scale,oi.metrics=Zh,oi.rect=lo,lr.push(oi),Pr?(ye.verticalizable=!0,pt+=("imageName"in Tr?Zh.advance:ni)*Tr.scale+vt):pt+=Zh.advance*Tr.scale+vt,is++}lr.length!==0&&(On=Math.max(pt-vt,On),k2(lr,0,lr.length-1,yr)),pt=0,Lr.lineOffset=Math.max(rs,(Sr-1)*ni);const Ks=ut*Sr+rs;kt+=Ks,En=Math.max(Ks,En),++qr}const{horizontalAlign:vr,verticalAlign:pr}=Um(et);(function(Hn,Sr,Lr,lr,rs,wi,is,Ks,si){const Tr=(Sr-Lr)*rs;let $r=0;$r=wi!==is?-Ks*lr- -17:-lr*si*is+.5*is;for(const Pr of Hn)for(const oi of Pr.positionedGlyphs)oi.x+=Tr,oi.y+=$r})(ye.positionedLines,yr,vr,pr,On,En,ut,kt,Qe.length),ye.top+=-pr*kt,ye.bottom=ye.top+kt,ye.left+=-vr*On,ye.right=ye.left+On}(he,e,r,l,$,m,v,T,M,S,D,V),!function(ye){for(const De of ye)if(De.positionedGlyphs.length!==0)return!1;return!0}(J)&&he}function Um(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function A2(i,e,r){const l=e.getMaxScale()*ni,{maxImageWidth:h,maxImageHeight:f}=e.getMaxImageSize(i),m=Math.max(l,f*r);return{verticalLineContentWidth:Math.max(l,h*r),horizontalLineContentHeight:m}}function ev(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function C2(i,e,r){return!(i===x.az.horizontal||!e&&!mh(r)||e&&(ap(r)||(l=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function M2(i,e,r,l,h,f){const m=f[i.fontStack],v=function(S,A,M,D){if(S&&S.rect)return S;const z=A[M.fontStack],V=z&&z[D];return V?{rect:null,metrics:V.metrics}:null}(m&&m[e],h,i,e);if(v===null)return null;let T;if(r)T=l.verticalLineContentWidth-i.scale*ni;else{const S=ev(i.verticalAlign);T=(l.horizontalLineContentHeight-i.scale*ni)*S}return{rect:v.rect,metrics:v.metrics,baselineOffset:T}}function R2(i,e,r,l,h){const f=h[i.imageName];if(!f)return null;const m=f.paddedRect,v=f.displaySize,T={width:v[0],height:v[1],left:1,top:-3,advance:e?v[1]:v[0]};let S;if(e)S=l.verticalLineContentWidth-v[1]*i.scale;else{const A=ev(i.verticalAlign);S=(l.horizontalLineContentHeight-v[1]*i.scale)*A}return{rect:m,metrics:T,baselineOffset:S,imageOffset:(e?v[0]:v[1])*i.scale-ni*r}}function k2(i,e,r,l){if(l===0)return;const h=i[r],f=(i[r].x+h.metrics.advance*h.scale)*l;for(let m=e;m<=r;m++)i[m].x-=f}function D2(i,e,r){const{horizontalAlign:l,verticalAlign:h}=Um(r),f=e[0]-i.displaySize[0]*l,m=e[1]-i.displaySize[1]*h;return{image:i,top:m,bottom:m+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function tv(i){var e,r;let l=i.left,h=i.top,f=i.right-l,m=i.bottom-h;const v=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",T=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",S=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(T==="proportional"){if(v==="stretchOnly"&&f/m<S||v==="proportional"){const A=Math.ceil(m*S);l*=A/f,f=A}}else if(v==="proportional"&&T==="stretchOnly"&&S!==0&&f/m>S){const A=Math.ceil(f/S);h*=A/m,m=A}return{x1:l,y1:h,x2:l+f,y2:h+m}}function nv(i,e,r,l,h,f){const m=i.image;let v;if(m.content){const $=m.content,X=m.pixelRatio||1;v=[$[0]/X,$[1]/X,m.displaySize[0]-$[2]/X,m.displaySize[1]-$[3]/X]}const T=e.left*f,S=e.right*f;let A,M,D,z;r==="width"||r==="both"?(z=h[0]+T-l[3],M=h[0]+S+l[1]):(z=h[0]+(T+S-m.displaySize[0])/2,M=z+m.displaySize[0]);const V=e.top*f,U=e.bottom*f;return r==="height"||r==="both"?(A=h[1]+V-l[0],D=h[1]+U+l[2]):(A=h[1]+(V+U-m.displaySize[1])/2,D=A+m.displaySize[1]),{image:m,top:A,right:M,bottom:D,left:z,collisionPadding:v}}xt("ImagePosition",Bm),xt("ImageAtlas",Jy),x.az=void 0,(qa=x.az||(x.az={}))[qa.none=0]="none",qa[qa.horizontal=1]="horizontal",qa[qa.vertical=2]="vertical",qa[qa.horizontalOnly=3]="horizontalOnly";const ha=128,$a=32640;function rv(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Jn(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=r;let f=0;for(;f<l.length&&l[f]<=i;)f++;f=Math.max(0,f-1);let m=f;for(;m<l.length&&l[m]<i+1;)m++;m=Math.min(l.length-1,m);const v=l[f],T=l[m];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:T,minSize:r.evaluate(new Jn(v)),maxSize:r.evaluate(new Jn(T)),interpolationType:h}}}function jm(i,e,r){let l="never";const h=i.get(e);return h?l=h:i.get(r)&&(l="always"),l}const L2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ap(i,e,r,l,h,f,m,v,T,S,A,M,D){const z=v?Math.min($a,Math.round(v[0])):0,V=v?Math.min($a,Math.round(v[1])):0;i.emplaceBack(e,r,Math.round(32*l),Math.round(32*h),f,m,(z<<1)+(T?1:0),V,16*S,16*A,256*M,256*D)}function qm(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function z2(i){for(const e of i.sections)if(up(e.text))return!0;return!1}class $m{constructor(e){this.layoutVertexArray=new me,this.indexArray=new Ne,this.programConfigurations=e,this.segments=new dt,this.dynamicLayoutVertexArray=new Pe,this.opacityVertexArray=new Be,this.hasVisibleVertices=!1,this.placedSymbolArray=new b}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,l2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,c2.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,L2,!0),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}xt("SymbolBuffers",$m);class Gm{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new dt,this.collisionVertexArray=new Oe}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,u2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}xt("CollisionBuffers",Gm);class cu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rv(this.zoom,r["text-size"]),this.iconSizeData=rv(this.zoom,r["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=jm(l,"text-overlap","text-allow-overlap")!=="never"||jm(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(m=>x.az[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID}createArrays(){this.text=new $m(new ua(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new $m(new ua(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new C,this.lineVertexArray=new k,this.symbolInstances=new P,this.textAnchorOffsets=new F}calculateGlyphDependencies(e,r,l,h,f){for(const m of e)if(r[m.codePointAt(0)]=!0,(l||h)&&f){const v=Bh[m];v&&(r[v.codePointAt(0)]=!0)}}populate(e,r,l){const h=this.layers[0],f=h.layout,m=f.get("text-font"),v=f.get("text-field"),T=f.get("icon-image"),S=(v.value.kind!=="constant"||v.value.value instanceof _i&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),A=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,M=f.get("symbol-sort-key");if(this.features=[],!S&&!A)return;const D=r.iconDependencies,z=r.glyphDependencies,V=r.availableImages,U=new Jn(this.zoom);for(const{feature:$,id:X,index:ae,sourceLayerIndex:Y}of e){const J=h._featureFilter.needGeometry,he=Do($,J);if(!h._featureFilter.filter(U,he,l))continue;let ye,De;if(J||(he.geometry=ko($)),S){const $e=h.getValueAndResolveTokens("text-field",he,l,V),Qe=_i.factory($e),ut=this.hasRTLText=this.hasRTLText||z2(Qe);(!ut||Co.getRTLTextPluginStatus()==="unavailable"||ut&&Co.isParsed())&&(ye=d2(Qe,h,he))}if(A){const $e=h.getValueAndResolveTokens("icon-image",he,l,V);De=$e instanceof ui?$e:ui.fromString($e)}if(!ye&&!De)continue;const Xe=this.sortFeaturesByKey?M.evaluate(he,{},l):void 0;if(this.features.push({id:X,text:ye,icon:De,index:ae,sourceLayerIndex:Y,geometry:he.geometry,properties:$.properties,type:Oh.types[$.type],sortKey:Xe}),De&&(D[De.name]=!0),ye){const $e=m.evaluate(he,{},l).join(","),Qe=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.az.vertical)>=0;for(const ut of ye.sections)if(ut.image)D[ut.image.name]=!0;else{const et=Ua(ye.toString()),Ke=ut.fontStack||$e,Ve=z[Ke]=z[Ke]||{};this.calculateGlyphDependencies(ut.text,Ve,Qe,this.allowVerticalPlacement,et)}}}f.get("symbol-placement")==="line"&&(this.features=function($){const X={},ae={},Y=[];let J=0;function he($e){Y.push($[$e]),J++}function ye($e,Qe,ut){const et=ae[$e];return delete ae[$e],ae[Qe]=et,Y[et].geometry[0].pop(),Y[et].geometry[0]=Y[et].geometry[0].concat(ut[0]),et}function De($e,Qe,ut){const et=X[Qe];return delete X[Qe],X[$e]=et,Y[et].geometry[0].shift(),Y[et].geometry[0]=ut[0].concat(Y[et].geometry[0]),et}function Xe($e,Qe,ut){const et=ut?Qe[0][Qe[0].length-1]:Qe[0][0];return`${$e}:${et.x}:${et.y}`}for(let $e=0;$e<$.length;$e++){const Qe=$[$e],ut=Qe.geometry,et=Qe.text?Qe.text.toString():null;if(!et){he($e);continue}const Ke=Xe(et,ut),Ve=Xe(et,ut,!0);if(Ke in ae&&Ve in X&&ae[Ke]!==X[Ve]){const vt=De(Ke,Ve,ut),_t=ye(Ke,Ve,Y[vt].geometry);delete X[Ke],delete ae[Ve],ae[Xe(et,Y[_t].geometry,!0)]=_t,Y[vt].geometry=null}else Ke in ae?ye(Ke,Ve,ut):Ve in X?De(Ke,Ve,ut):(he($e),X[Ke]=J-1,ae[Ve]=J-1)}return Y.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($,X)=>$.sortKey-X.sortKey)}update(e,r,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const l=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(r[e.segment+1]),f=e.dist(r[e.segment]);const m={};for(let v=e.segment+1;v<r.length;v++)m[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:h},v<r.length-1&&(h+=r[v+1].dist(r[v]));for(let v=e.segment||0;v>=0;v--)m[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:f},v>0&&(f+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const T=m[v];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,h,f,m,v,T,S,A,M,D){const z=e.indexArray,V=e.layoutVertexArray,U=e.segments.prepareSegment(4*r.length,V,z,this.canOverlap?m.sortKey:void 0),$=this.glyphOffsetArray.length,X=U.vertexLength,ae=this.allowVerticalPlacement&&v===x.az.vertical?Math.PI/2:0,Y=m.text&&m.text.sections;for(let J=0;J<r.length;J++){const{tl:he,tr:ye,bl:De,br:Xe,tex:$e,pixelOffsetTL:Qe,pixelOffsetBR:ut,minFontScaleX:et,minFontScaleY:Ke,glyphOffset:Ve,isSDF:vt,sectionIndex:_t}=r[J],bt=U.vertexLength,pt=Ve[1];Ap(V,T.x,T.y,he.x,pt+he.y,$e.x,$e.y,l,vt,Qe.x,Qe.y,et,Ke),Ap(V,T.x,T.y,ye.x,pt+ye.y,$e.x+$e.w,$e.y,l,vt,ut.x,Qe.y,et,Ke),Ap(V,T.x,T.y,De.x,pt+De.y,$e.x,$e.y+$e.h,l,vt,Qe.x,ut.y,et,Ke),Ap(V,T.x,T.y,Xe.x,pt+Xe.y,$e.x+$e.w,$e.y+$e.h,l,vt,ut.x,ut.y,et,Ke),qm(e.dynamicLayoutVertexArray,T,ae),z.emplaceBack(bt,bt+2,bt+1),z.emplaceBack(bt+1,bt+2,bt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ve[0]),J!==r.length-1&&_t===r[J+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,m,m.index,{imagePositions:{},canonical:D,formattedSection:Y&&Y[_t]})}e.placedSymbolArray.emplaceBack(T.x,T.y,$,this.glyphOffsetArray.length-$,X,S,A,T.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],v,0,!1,0,M)}_addCollisionDebugVertex(e,r,l,h,f,m){return r.emplaceBack(0,0),e.emplaceBack(l.x,l.y,h,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(e,r,l,h,f,m,v){const T=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),S=T.vertexLength,A=f.layoutVertexArray,M=f.collisionVertexArray,D=v.anchorX,z=v.anchorY;this._addCollisionDebugVertex(A,M,m,D,z,new R(e,r)),this._addCollisionDebugVertex(A,M,m,D,z,new R(l,r)),this._addCollisionDebugVertex(A,M,m,D,z,new R(l,h)),this._addCollisionDebugVertex(A,M,m,D,z,new R(e,h)),T.vertexLength+=4;const V=f.indexArray;V.emplaceBack(S,S+1),V.emplaceBack(S+1,S+2),V.emplaceBack(S+2,S+3),V.emplaceBack(S+3,S),T.primitiveLength+=4}addDebugCollisionBoxes(e,r,l,h){for(let f=e;f<r;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,h?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gm(Fe,$y.members,it),this.iconCollisionBox=new Gm(Fe,$y.members,it);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,l,h,f,m,v,T,S){const A={};for(let M=r;M<l;M++){const D=e.get(M);A.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.textFeatureIndex=D.featureIndex;break}for(let M=h;M<f;M++){const D=e.get(M);A.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalTextFeatureIndex=D.featureIndex;break}for(let M=m;M<v;M++){const D=e.get(M);A.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.iconFeatureIndex=D.featureIndex;break}for(let M=T;M<S;M++){const D=e.get(M);A.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalIconFeatureIndex=D.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const l=e.placedSymbolArray.get(r),h=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<h;f+=4)e.indexArray.emplaceBack(f,f+2,f+1),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),l=Math.cos(e),h=[],f=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const T=this.symbolInstances.get(v);h.push(0|Math.round(r*T.anchorX+l*T.anchorY)),f.push(T.featureIndex)}return m.sort((v,T)=>h[v]-h[T]||f[T]-f[v]),m}addToSortKeyRanges(e,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((h,f,m)=>{h>=0&&m.indexOf(h)===f&&this.addIndicesForPlacedSymbol(this.text,h)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let iv,sv;xt("SymbolBucket",cu,{omit:["layers","collisionBoxArray","features","compareText"]}),cu.MAX_GLYPHS=65535,cu.addDynamicAttributes=qm;var Hm={get paint(){return sv=sv||new Si({"icon-opacity":new Ot(Ce.paint_symbol["icon-opacity"]),"icon-color":new Ot(Ce.paint_symbol["icon-color"]),"icon-halo-color":new Ot(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ot(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ot(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new St(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new St(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ot(Ce.paint_symbol["text-opacity"]),"text-color":new Ot(Ce.paint_symbol["text-color"],{runtimeType:Cr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ot(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new Ot(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Ot(Ce.paint_symbol["text-halo-blur"]),"text-translate":new St(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new St(Ce.paint_symbol["text-translate-anchor"])})},get layout(){return iv=iv||new Si({"symbol-placement":new St(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new St(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new St(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ot(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new St(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new St(Ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new St(Ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new St(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new St(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new St(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ot(Ce.layout_symbol["icon-size"]),"icon-text-fit":new St(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ot(Ce.layout_symbol["icon-image"]),"icon-rotate":new Ot(Ce.layout_symbol["icon-rotate"]),"icon-padding":new Ot(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new St(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Ot(Ce.layout_symbol["icon-offset"]),"icon-anchor":new Ot(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new St(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new St(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new St(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new Ot(Ce.layout_symbol["text-field"]),"text-font":new Ot(Ce.layout_symbol["text-font"]),"text-size":new Ot(Ce.layout_symbol["text-size"]),"text-max-width":new Ot(Ce.layout_symbol["text-max-width"]),"text-line-height":new St(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Ot(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new Ot(Ce.layout_symbol["text-justify"]),"text-radial-offset":new Ot(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new St(Ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ot(Ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ot(Ce.layout_symbol["text-anchor"]),"text-max-angle":new St(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new St(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new Ot(Ce.layout_symbol["text-rotate"]),"text-padding":new St(Ce.layout_symbol["text-padding"]),"text-keep-upright":new St(Ce.layout_symbol["text-keep-upright"]),"text-transform":new Ot(Ce.layout_symbol["text-transform"]),"text-offset":new Ot(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new St(Ce.layout_symbol["text-allow-overlap"]),"text-overlap":new St(Ce.layout_symbol["text-overlap"]),"text-ignore-placement":new St(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new St(Ce.layout_symbol["text-optional"])})}};class ov{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:fr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xt("FormatSectionOverride",ov,{omit:["defaultValue"]});class Cp extends gs{constructor(e,r){super(e,Hm,r)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const f of l)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,l,h){const f=this.layout.get(e).evaluate(r,{},l,h),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Fa(m.value)||!f?f:function(v,T){return T.replace(/{([^{}]+)}/g,(S,A)=>v&&A in v?String(v[A]):"")}(r.properties,f)}createBucket(e){return new cu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Hm.paint.overridableProperties){if(!Cp.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),l=new ov(r),h=new rh(l,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new Lc("source",h):new ih("composite",h,r.value.zoomStops),this.paint._values[e]=new As(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&Cp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const l=e.get("text-field"),h=Hm.paint.properties[r];let f=!1;const m=v=>{for(const T of v)if(h.overrides&&h.overrides.hasOverride(T))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof _i)m(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const v=S=>{f||(S instanceof Qi&&mr(S.value)===ci?m(S.value.sections):S instanceof ft?m(S.sections):S.eachChild(v))},T=l.value;T._styleExpression&&v(T._styleExpression.expression)}return f}}let av;var F2={get paint(){return av=av||new Si({"background-color":new St(Ce.paint_background["background-color"]),"background-pattern":new Hc(Ce.paint_background["background-pattern"]),"background-opacity":new St(Ce.paint_background["background-opacity"])})}};class O2 extends gs{constructor(e,r){super(e,F2,r)}}class N2 extends gs{constructor(e,r){super(e,{},r),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class V2{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const B2={once:!0},Zm=63710088e-1;class Ga{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ga(Cn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,l=this.lat*r,h=e.lat*r,f=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*r);return Zm*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof Ga)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ga(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ga(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lv=2*Math.PI*Zm;function cv(i){return lv*Math.cos(i*Math.PI/180)}function uv(i){return(180+i)/360}function hv(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function dv(i,e){return i/cv(e)}function pv(i){return 360*i-180}function Mp(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function fv(i,e){return i*cv(Mp(e))}class Uh{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){const l=Ga.convert(e);return new Uh(uv(l.lng),hv(l.lat),dv(r,l.lat))}toLngLat(){return new Ga(pv(this.x),Mp(this.y))}toAltitude(){return fv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/lv*(e=Mp(this.y),1/Math.cos(e*Math.PI/180));var e}}function mv(i,e,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class Wm{constructor(e,r,l){if(!function(h,f,m){return!(h<0||h>25||m<0||m>=Math.pow(2,h)||f<0||f>=Math.pow(2,h))}(e,r,l))throw new Error(`x=${r}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=l,this.key=uu(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,l){const h=function(m,v,T){var S=mv(256*m,256*(v=Math.pow(2,T)-v-1),T),A=mv(256*(m+1),256*(v+1),T);return S[0]+","+S[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),f=function(m,v,T){let S,A="";for(let M=m;M>0;M--)S=1<<M-1,A+=(v&S?1:0)+(T&S?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,f).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new R((e.x*r-this.x)*Pt,(e.y*r-this.y)*Pt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gv{constructor(e,r){this.wrap=e,this.canonical=r,this.key=uu(e,r.z,r.z,r.x,r.y)}}class Rs{constructor(e,r,l,h,f){if(this.terrainRttPosMatrix32f=null,e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Wm(l,+h,+f),this.key=uu(r,e,l,h,f)}clone(){return new Rs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Rs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rs(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?uu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):uu(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-e.canonical.z;return!(r<0)&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Rs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new Rs(r,this.wrap,r,l,h),new Rs(r,this.wrap,r,l+1,h),new Rs(r,this.wrap,r,l,h+1),new Rs(r,this.wrap,r,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Rs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Rs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Uh(e.x-this.wrap,e.y))}}function uu(i,e,r,l,h){(i*=2)<0&&(i=-1*i-1);const f=1<<r;return(f*f*i+f*h+l).toString(36)+r.toString(36)+e.toString(36)}function Km(i,e){return e?i.properties[e]:i.id}function U2(i,e){const r={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const l of e.removeProperties){const h=i.addOrUpdateProperties.findIndex(f=>f.key===l);h>-1&&i.addOrUpdateProperties.splice(h,1)}return(i.removeAllProperties||e.removeAllProperties)&&(r.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(r.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(r.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(r.newGeometry=e.newGeometry||i.newGeometry),r}function _v(i){var e,r;if(!i)return{};const l={};return l.removeAll=i.removeAll,l.remove=new Set(i.remove||[]),l.add=new Map((e=i.add)===null||e===void 0?void 0:e.map(h=>[h.id,h])),l.update=new Map((r=i.update)===null||r===void 0?void 0:r.map(h=>[h.id,h])),l}xt("CanonicalTileID",Wm),xt("OverscaledTileID",Rs,{omit:["terrainRttPosMatrix32f"]});class Xl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const r=new Xl;return r.extend(e(new R(this.minX,this.minY))),r.extend(e(new R(this.maxX,this.minY))),r.extend(e(new R(this.minX,this.maxY))),r.extend(e(new R(this.maxX,this.maxY))),r}static fromPoints(e){const r=new Xl;for(const l of e)r.extend(l);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class yv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class vv{constructor(e,r,l,h,f){this.type="Feature",this._vectorTileFeature=e,this._x=l,this._y=h,this._z=r,this.properties=e.properties,this.id=f}projectPoint(e,r,l,h){return[360*(e.x+r)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+l)/h)*Math.PI))-90]}projectLine(e,r,l,h){return e.map(f=>this.projectPoint(f,r,l,h))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,r=e.extent*Math.pow(2,this._z),l=e.extent*this._x,h=e.extent*this._y,f=e.loadGeometry();switch(e.type){case 1:{const m=[];for(const T of f)m.push(T[0]);const v=this.projectLine(m,l,h,r);this._geometry=m.length===1?{type:"Point",coordinates:v[0]}:{type:"MultiPoint",coordinates:v};break}case 2:{const m=f.map(v=>this.projectLine(v,l,h,r));this._geometry=m.length===1?{type:"LineString",coordinates:m[0]}:{type:"MultiLineString",coordinates:m};break}case 3:{const m=Ly(f),v=[];for(const T of m)v.push(T.map(S=>this.projectLine(S,l,h,r)));this._geometry=v.length===1?{type:"Polygon",coordinates:v[0]}:{type:"MultiPolygon",coordinates:v};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&r!=="_x"&&r!=="_y"&&r!=="_z"&&(e[r]=this[r]);return e}}class hu{constructor(e,r,l){pn(this,"_name");pn(this,"dataBuffer");pn(this,"nullabilityBuffer");pn(this,"_size");this._name=e,this.dataBuffer=r,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Rp extends hu{}class Xm extends Rp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Ym extends Rp{getValueFromBuffer(e){return this.dataBuffer[e]}}class xv extends hu{constructor(r,l,h,f){super(r,l,f);pn(this,"delta");this.delta=h}}class Qm extends xv{constructor(e,r,l,h){super(e,Int32Array.of(r),l,h)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Jm extends hu{constructor(e,r,l){super(e,Int32Array.of(r),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}class j2{constructor(e,r,l,h,f=4096){pn(this,"_name");pn(this,"_geometryVector");pn(this,"_idVector");pn(this,"_propertyVectors");pn(this,"_extent");pn(this,"propertyVectorsMap");this._name=e,this._geometryVector=r,this._idVector=l,this._propertyVectors=h,this._extent=f}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(r=>[r.name,r]))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let r=0;for(;r<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(r)):this.idVector.getValue(r));const h=e==null?void 0:e.next().value,f={};for(const m of this.propertyVectors){if(!m)continue;const v=m.name,T=m.getValue(r);T!==null&&(f[v]=T)}r++,yield{id:l,geometry:h,properties:f}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],r=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let h;this.idVector&&(h=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const f={coordinates:r[l],type:this.geometryVector.geometryType(l)},m={};for(const v of this.propertyVectors){if(!v)continue;const T=v.name,S=v.getValue(l);S!==null&&(m[T]=S)}e.push({id:h,geometry:f,properties:m})}return e}containsMaxSaveIntegerValues(e){return e instanceof Xm||e instanceof Jm&&e instanceof Qm||e instanceof Ym}}class q2{constructor(e){pn(this,"value");this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var An,da,vi,oo,Yl,ys,ri,ii,bv,ks;function pi(i,e,r){const l=new Int32Array(r);let h=0,f=e.get();for(let m=0;m<l.length;m++){let v=i[f++],T=127&v;v<128||(v=i[f++],T|=(127&v)<<7,v<128||(v=i[f++],T|=(127&v)<<14,v<128||(v=i[f++],T|=(127&v)<<21,v<128||(v=i[f++],T|=(15&v)<<28)))),l[h++]=T}return e.set(f),l}function kp(i,e,r){const l=new BigInt64Array(r);for(let h=0;h<l.length;h++)l[h]=G2(i,e);return l}function $2(i,e){let r,l;return l=i[e.get()],e.increment(),r=127&l,l<128?r:(l=i[e.get()],e.increment(),r|=(127&l)<<7,l<128?r:(l=i[e.get()],e.increment(),r|=(127&l)<<14,l<128?r:(l=i[e.get()],e.increment(),r|=(127&l)<<21,l<128?r:(l=i[e.get()],r|=(15&l)<<28,function(h,f,m){let v,T;if(T=f[m.get()],m.increment(),v=(112&T)>>4,T<128||(T=f[m.get()],m.increment(),v|=(127&T)<<3,T<128)||(T=f[m.get()],m.increment(),v|=(127&T)<<10,T<128)||(T=f[m.get()],m.increment(),v|=(127&T)<<17,T<128)||(T=f[m.get()],m.increment(),v|=(127&T)<<24,T<128)||(T=f[m.get()],m.increment(),v|=(1&T)<<31,T<128))return 4294967296*v+(h>>>0);throw new Error("Expected varint not more than 10 bytes")}(r,i,e)))))}function wv(i,e,r,l){throw new Error("FastPFor is not implemented yet.")}function Ql(i){return i>>>1^-(1&i)}function du(i){return i>>1n^-(1n&i)}function G2(i,e){let r=0n,l=0,h=e.get();for(;h<i.length;){const f=i[h++];if(r|=BigInt(127&f)<<BigInt(l),!(128&f))break;if(l+=7,l>=64)throw new Error("Varint too long")}return e.set(h),r}function Tv(i,e,r){const l=new Int32Array(r);let h=0;for(let f=0;f<e;f++){const m=i[f];l.fill(i[f+e],h,h+m),h+=m}return l}function Ev(i,e,r){const l=new BigInt64Array(r);let h=0;for(let f=0;f<e;f++){const m=Number(i[f]);l.fill(i[f+e],h,h+m),h+=m}return l}function Iv(i,e,r){const l=new Float64Array(r);let h=0;for(let f=0;f<e;f++){const m=i[f];l.fill(i[f+e],h,h+m),h+=m}return l}function eg(i){const e=i.length/4*4;let r=1;if(e>=4)for(let l=i[0];r<e-4;r+=4)l=i[r]+=l,l=i[r+1]+=l,l=i[r+2]+=l,l=i[r+3]+=l;for(;r!=i.length;)i[r]+=i[r-1],++r}function Sv(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let r=2;if(e>=4)for(;r<e-4;r+=4){const l=i[r],h=i[r+1],f=i[r+2],m=i[r+3];i[r]=(l>>>1^-(1&l))+i[r-2],i[r+1]=(h>>>1^-(1&h))+i[r-1],i[r+2]=(f>>>1^-(1&f))+i[r],i[r+3]=(m>>>1^-(1&m))+i[r+1]}for(;r!=i.length;r+=2)i[r]=(i[r]>>>1^-(1&i[r]))+i[r-2],i[r+1]=(i[r+1]>>>1^-(1&i[r+1]))+i[r-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(An||(An={})),function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"}(da||(da={})),function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"}(vi||(vi={}));class tg{constructor(e,r,l){pn(this,"_dictionaryType");pn(this,"_offsetType");pn(this,"_lengthType");this._dictionaryType=e,this._offsetType=r,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Vi(i,e){const r=function(l,h){const f=l[h.get()],m=Object.values(vi)[f>>4];let v=null;switch(m){case vi.DATA:v=new tg(Object.values(oo)[15&f]);break;case vi.OFFSET:v=new tg(null,Object.values(Yl)[15&f]);break;case vi.LENGTH:v=new tg(null,null,Object.values(ys)[15&f])}h.increment();const T=l[h.get()],S=Object.values(An)[T>>5],A=Object.values(An)[T>>2&7],M=Object.values(da)[3&T];h.increment();const D=pi(l,h,2),z=D[0];return{physicalStreamType:m,logicalStreamType:v,logicalLevelTechnique1:S,logicalLevelTechnique2:A,physicalLevelTechnique:M,numValues:z,byteLength:D[1],decompressedCount:z}}(i,e);return r.logicalLevelTechnique1===An.MORTON?function(l,h,f){const m=pi(h,f,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:m[0],coordinateShift:m[1]}}(r,i,e):An.RLE!==r.logicalLevelTechnique1&&An.RLE!==r.logicalLevelTechnique2||da.NONE===r.physicalLevelTechnique?r:function(l,h,f){const m=pi(h,f,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:m[1],runs:m[0],numRleValues:m[1]}}(r,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(oo||(oo={})),function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"}(Yl||(Yl={})),function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"}(ys||(ys={})),function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"}(ri||(ri={}));class ao{constructor(e,r){pn(this,"values");pn(this,"_size");this.values=e,this._size=r}get(e){const r=Math.floor(e/8);return(this.values[r]>>e%8&1)==1}set(e,r){const l=Math.floor(e/8);this.values[l]=this.values[l]|(r?1:0)<<e%8}getInt(e){const r=Math.floor(e/8);return this.values[r]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Bi(i,e,r,l,h){return function(f,m,v){switch(m.logicalLevelTechnique1){case An.DELTA:return m.logicalLevelTechnique2===An.RLE?function(T,S,A){const M=new Int32Array(A);let D=0,z=0;for(let V=0;V<S;V++){const U=T[V],$=Ql(T[V+S]);for(let X=0;X<U;X++)z+=$,M[D++]=z}return M}(f,m.runs,m.numRleValues):(function(T){T[0]=T[0]>>>1^-(1&T[0]);const S=T.length/4*4;let A=1;if(S>=4)for(;A<S-4;A+=4){const M=T[A],D=T[A+1],z=T[A+2],V=T[A+3];T[A]=(M>>>1^-(1&M))+T[A-1],T[A+1]=(D>>>1^-(1&D))+T[A],T[A+2]=(z>>>1^-(1&z))+T[A+1],T[A+3]=(V>>>1^-(1&V))+T[A+2]}for(;A!=T.length;++A)T[A]=(T[A]>>>1^-(1&T[A]))+T[A-1]}(f),f);case An.RLE:return function(T,S,A){return A?function(M,D,z){const V=new Int32Array(z);let U=0;for(let $=0;$<D;$++){const X=M[$];let ae=M[$+D];ae=ae>>>1^-(1&ae),V.fill(ae,U,U+X),U+=X}return V}(T,S.runs,S.numRleValues):Tv(T,S.runs,S.numRleValues)}(f,m,v);case An.MORTON:return eg(f),f;case An.COMPONENTWISE_DELTA:return Sv(f),f;case An.NONE:return v&&function(T){for(let S=0;S<T.length;S++){const A=T[S];T[S]=A>>>1^-(1&A)}}(f),f;default:throw new Error(`The specified Logical level technique is not supported: ${m.logicalLevelTechnique1}`)}}(Dp(i,e,r),r,l)}function Ha(i,e,r){return function(l,h){if(h.logicalLevelTechnique1===An.DELTA&&h.logicalLevelTechnique2===An.NONE)return function(m){const v=new Int32Array(m.length+1);v[0]=0,v[1]=Ql(m[0]);let T=v[1],S=2;for(;S!=v.length;++S){const A=m[S-1];T+=A>>>1^-(1&A),v[S]=v[S-1]+T}return v}(l);if(h.logicalLevelTechnique1===An.RLE&&h.logicalLevelTechnique2===An.NONE)return function(m,v,T){const S=new Int32Array(T+1);S[0]=0;let A=1,M=S[0];for(let D=0;D<v;D++){const z=m[D],V=m[D+v];for(let U=A;U<A+z;U++)S[U]=V+M,M=S[U];A+=z}return S}(l,h.runs,h.numRleValues);if(h.logicalLevelTechnique1===An.NONE&&h.logicalLevelTechnique2===An.NONE){(function(m){let v=0;for(let T=0;T<m.length;T++)m[T]+=v,v=m[T]})(l);const f=new Int32Array(h.numValues+1);return f[0]=0,f.set(l,1),f}if(h.logicalLevelTechnique1===An.DELTA&&h.logicalLevelTechnique2===An.RLE){const f=function(m,v,T){const S=new Int32Array(T+1);S[0]=0;let A=1,M=S[0];for(let D=0;D<v;D++){const z=m[D];let V=m[D+v];V=V>>>1^-(1&V);for(let U=A;U<A+z;U++)S[U]=V+M,M=S[U];A+=z}return S}(l,h.runs,h.numRleValues);return eg(f),f}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}(Dp(i,e,r),r)}function Dp(i,e,r){const l=r.physicalLevelTechnique;if(l===da.FAST_PFOR)return wv();if(l===da.VARINT)return pi(i,e,r.numValues);if(l===da.NONE){const h=e.get();e.add(r.byteLength);const f=i.subarray(h,e.get());return new Int32Array(f)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function ng(i,e,r,l){const h=Dp(i,e,r);if(h.length===1){const f=h[0];return l?Ql(f):f}return l?function(f){return Ql(f[1])}(h):function(f){return f[1]}(h)}function Pv(i,e,r){return function(l){if(l.length==2){const h=Ql(l[1]);return[h,h]}return[Ql(l[2]),Ql(l[3])]}(Dp(i,e,r))}function Av(i,e,r){return function(l){if(l.length==2){const h=du(l[1]);return[h,h]}return[du(l[2]),du(l[3])]}(kp(i,e,r.numValues))}function Cv(i,e,r,l){return function(h,f,m){switch(f.logicalLevelTechnique1){case An.DELTA:return f.logicalLevelTechnique2===An.RLE?function(v,T,S){const A=new BigInt64Array(S);let M=0,D=0n;for(let z=0;z<T;z++){const V=Number(v[z]),U=du(v[z+T]);for(let $=0;$<V;$++)D+=U,A[M++]=D}return A}(h,f.runs,f.numRleValues):(function(v){v[0]=v[0]>>1n^-(1n&v[0]);const T=v.length/4*4;let S=1;if(T>=4)for(;S<T-4;S+=4){const A=v[S],M=v[S+1],D=v[S+2],z=v[S+3];v[S]=(A>>1n^-(1n&A))+v[S-1],v[S+1]=(M>>1n^-(1n&M))+v[S],v[S+2]=(D>>1n^-(1n&D))+v[S+1],v[S+3]=(z>>1n^-(1n&z))+v[S+2]}for(;S!=v.length;++S)v[S]=(v[S]>>1n^-(1n&v[S]))+v[S-1]}(h),h);case An.RLE:return function(v,T,S){return S?function(A,M,D){const z=new BigInt64Array(D);let V=0;for(let U=0;U<M;U++){const $=Number(A[U]);let X=A[U+M];X=X>>1n^-(1n&X),z.fill(X,V,V+$),V+=$}return z}(v,T.runs,T.numRleValues):Ev(v,T.runs,T.numRleValues)}(h,f,m);case An.NONE:return m&&function(v){for(let T=0;T<v.length;T++){const S=v[T];v[T]=S>>1n^-(1n&S)}}(h),h;default:throw new Error(`The specified Logical level technique is not supported: ${f.logicalLevelTechnique1}`)}}(kp(i,e,r.numValues),r,l)}function Mv(i,e,r,l){const h=kp(i,e,r.numValues);if(h.length===1){const f=h[0];return l?du(f):f}return l?function(f){return du(f[1])}(h):function(f){return f[1]}(h)}function rg(i,e,r,l,h){return function(f,m,v,T){switch(m.logicalLevelTechnique1){case An.DELTA:return m.logicalLevelTechnique2===An.RLE&&(f=Tv(f,m.runs,m.numRleValues)),function(S,A){const M=new Int32Array(S.size());let D=0;S.get(0)?(M[0]=S.get(0)?A[0]>>>1^-(1&A[0]):0,D=1):M[0]=0;let z=1;for(;z!=M.length;++z)M[z]=S.get(z)?M[z-1]+(A[D]>>>1^-(1&A[D++])):M[z-1];return M}(T,f);case An.RLE:return function(S,A,M,D){const z=A;return M?function(V,U,$){const X=new Int32Array(V.size());let ae=0;for(let Y=0;Y<$;Y++){const J=U[Y];let he=U[Y+$];he=he>>>1^-(1&he);for(let ye=ae;ye<ae+J;ye++)V.get(ye)?X[ye]=he:(X[ye]=0,ae++);ae+=J}return X}(D,S,z.runs):function(V,U,$){const X=new Int32Array(V.size());let ae=0;for(let Y=0;Y<$;Y++){const J=U[Y],he=U[Y+$];for(let ye=ae;ye<ae+J;ye++)V.get(ye)?X[ye]=he:(X[ye]=0,ae++);ae+=J}return X}(D,S,z.runs)}(f,m,v,T);case An.MORTON:return eg(f),f;case An.COMPONENTWISE_DELTA:return Sv(f),f;case An.NONE:return f=v?function(S,A){const M=new Int32Array(S.size());let D=0,z=0;for(;z!=M.length;++z)if(S.get(z)){const V=A[D++];M[z]=V>>>1^-(1&V)}else M[z]=0;return M}(T,f):function(S,A){const M=new Int32Array(S.size());let D=0,z=0;for(;z!=M.length;++z)M[z]=S.get(z)?A[D++]:0;return M}(T,f),f;default:throw new Error("The specified Logical level technique is not supported")}}(r.physicalLevelTechnique===da.FAST_PFOR?wv():pi(i,e,r.numValues),r,l,h)}function Lp(i,e,r,l){const h=i.logicalLevelTechnique1;if(h===An.RLE)return i.runs===1?ri.CONST:ri.FLAT;const f=e instanceof ao?e.size():e;if(h===An.DELTA&&i.logicalLevelTechnique2===An.RLE){const m=i.runs,v=2;if(i.numRleValues!==f)return ri.FLAT;if(m===1)return ri.SEQUENCE;if(m===2){const T=l.get();let S;if(i.physicalLevelTechnique===da.VARINT)S=pi(r,l,4);else{const A=l.get();S=new Int32Array(r.buffer,r.byteOffset+A,4)}if(l.set(T),S[2]===v&&S[3]===v)return ri.SEQUENCE}}return i.numValues===1?ri.CONST:ri.FLAT}class Rv extends Rp{getValueFromBuffer(e){return this.dataBuffer[e]}}class kv extends xv{constructor(e,r,l,h){super(e,BigInt64Array.of(r),l,h)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class pu{constructor(e,r,l){pn(this,"_geometryOffsets");pn(this,"_partOffsets");pn(this,"_ringOffsets");this._geometryOffsets=e,this._partOffsets=r,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function ig(i,e,r){return{x:Dv(i,e)-r,y:Dv(i>>1,e)-r}}function Dv(i,e){let r=0;for(let l=0;l<e;l++)r|=(i&1<<2*l)>>l;return r}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(ii||(ii={})),function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"}(bv||(bv={})),function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"}(ks||(ks={}));class H2{createPoint(e){return[[e]]}createMultiPoint(e){return e.map(r=>[r])}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,r){return[e].concat(r)}createMultiPolygon(e){return e.flat()}}function Lv(i){const e=new Array(i.numGeometries);let r=1,l=1,h=1,f=0;const m=new H2;let v=0,T=0;const S=i.mortonSettings,A=i.topologyVector,M=A.geometryOffsets,D=A.partOffsets,z=A.ringOffsets,V=i.vertexOffsets,U=i.containsPolygonGeometry(),$=i.vertexBuffer;for(let X=0;X<i.numGeometries;X++){const ae=i.geometryType(X);if(ae===ii.POINT){if(V&&V.length!==0)if(i.vertexBufferType===ks.VEC_2){const Y=2*V[T++],J=new R($[Y],$[Y+1]);e[f++]=m.createPoint(J)}else{const Y=ig($[V[T++]],S.numBits,S.coordinateShift),J=new R(Y.x,Y.y);e[f++]=m.createPoint(J)}else{const Y=new R($[v++],$[v++]);e[f++]=m.createPoint(Y)}M&&h++,D&&r++,z&&l++}else if(ae===ii.MULTIPOINT){const Y=M[h]-M[h-1];h++;const J=new Array(Y);if(V&&V.length!==0){for(let he=0;he<Y;he++){const ye=2*V[T++];J[he]=new R($[ye],$[ye+1])}e[f++]=m.createMultiPoint(J)}else{for(let he=0;he<Y;he++){const ye=$[v++],De=$[v++];J[he]=new R(ye,De)}e[f++]=m.createMultiPoint(J)}}else if(ae===ii.LINESTRING){let Y,J=0;U?(J=z[l]-z[l-1],l++):J=D[r]-D[r-1],r++,V&&V.length!==0?(Y=i.vertexBufferType===ks.VEC_2?og($,V,T,J,!1):ag($,V,T,J,!1,S),T+=J):(Y=sg($,v,J,!1),v+=2*J),e[f++]=m.createLineString(Y),M&&h++}else if(ae===ii.POLYGON){const Y=D[r]-D[r-1];r++;const J=new Array(Y-1);let he=z[l]-z[l-1];if(l++,V&&V.length!==0){const ye=i.vertexBufferType===ks.VEC_2?Fp($,V,T,he):Op($,V,T,he,0,S);T+=he;for(let De=0;De<J.length;De++)he=z[l]-z[l-1],l++,J[De]=i.vertexBufferType===ks.VEC_2?Fp($,V,T,he):Op($,V,T,he,0,S),T+=he;e[f++]=m.createPolygon(ye,J)}else{const ye=zp($,v,he);v+=2*he;for(let De=0;De<J.length;De++)he=z[l]-z[l-1],l++,J[De]=zp($,v,he),v+=2*he;e[f++]=m.createPolygon(ye,J)}M&&h++}else if(ae===ii.MULTILINESTRING){const Y=M[h]-M[h-1];h++;const J=new Array(Y);if(V&&V.length!==0){for(let he=0;he<Y;he++){let ye=0;U?(ye=z[l]-z[l-1],l++):ye=D[r]-D[r-1],r++;const De=i.vertexBufferType===ks.VEC_2?og($,V,T,ye,!1):ag($,V,T,ye,!1,S);J[he]=De,T+=ye}e[f++]=m.createMultiLineString(J)}else{for(let he=0;he<Y;he++){let ye=0;U?(ye=z[l]-z[l-1],l++):ye=D[r]-D[r-1],r++,J[he]=sg($,v,ye,!1),v+=2*ye}e[f++]=m.createMultiLineString(J)}}else{if(ae!==ii.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const Y=M[h]-M[h-1];h++;const J=new Array(Y);let he=0;if(V&&V.length!==0){for(let ye=0;ye<Y;ye++){const De=D[r]-D[r-1];r++;const Xe=new Array(De-1);he=z[l]-z[l-1],l++;const $e=i.vertexBufferType===ks.VEC_2?Fp($,V,T,he):Op($,V,T,he,0,S);T+=he;for(let Qe=0;Qe<Xe.length;Qe++)he=z[l]-z[l-1],l++,Xe[Qe]=i.vertexBufferType===ks.VEC_2?Fp($,V,T,he):Op($,V,T,he,0,S),T+=he;J[ye]=m.createPolygon($e,Xe)}e[f++]=m.createMultiPolygon(J)}else{for(let ye=0;ye<Y;ye++){const De=D[r]-D[r-1];r++;const Xe=new Array(De-1);he=z[l]-z[l-1],l++;const $e=zp($,v,he);v+=2*he;for(let Qe=0;Qe<Xe.length;Qe++){const ut=z[l]-z[l-1];l++,Xe[Qe]=zp($,v,ut),v+=2*ut}J[ye]=m.createPolygon($e,Xe)}e[f++]=m.createMultiPolygon(J)}}}}return e}function zp(i,e,r){return sg(i,e,r,!0)}function Fp(i,e,r,l){return og(i,e,r,l,!0)}function Op(i,e,r,l,h,f){return ag(i,e,r,l,!0,f)}function sg(i,e,r,l){const h=new Array(l?r+1:r);for(let f=0;f<2*r;f+=2)h[f/2]=new R(i[e+f],i[e+f+1]);return l&&(h[h.length-1]=h[0]),h}function og(i,e,r,l,h){const f=new Array(h?l+1:l);for(let m=0;m<2*l;m+=2){const v=2*e[r+m/2];f[m/2]=new R(i[v],i[v+1])}return h&&(f[f.length-1]=f[0]),f}function ag(i,e,r,l,h,f){const m=new Array(h?l+1:l);for(let v=0;v<l;v++){const T=ig(i[e[r+v]],f.numBits,f.coordinateShift);m[v]=new R(T.x,T.y)}return h&&(m[m.length-1]=m[0]),m}class zv{constructor(e,r,l,h,f){pn(this,"_vertexBufferType");pn(this,"_topologyVector");pn(this,"_vertexOffsets");pn(this,"_vertexBuffer");pn(this,"_mortonSettings");this._vertexBufferType=e,this._topologyVector=r,this._vertexOffsets=l,this._vertexBuffer=h,this._mortonSettings=f}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Lv(this);let r=0;for(;r<this.numGeometries;)yield{coordinates:e[r],type:this.geometryType(r)},r++}getSimpleEncodedVertex(e){const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=ig(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getGeometries(){return Lv(this)}get mortonSettings(){return this._mortonSettings}}class Fv extends zv{constructor(r,l,h,f,m,v,T){super(h,f,m,v,T);pn(this,"_numGeometries");pn(this,"_geometryType");this._numGeometries=r,this._geometryType=l}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ii.POLYGON||this._geometryType===ii.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Ov extends zv{constructor(r,l,h,f,m,v){super(r,h,f,m,v);pn(this,"_geometryTypes");this._geometryTypes=l}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let r=0;r<this.numGeometries;r++)if(this.geometryType(r)===ii.POLYGON||this.geometryType(r)===ii.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Nv{constructor(e,r,l,h){pn(this,"_triangleOffsets");pn(this,"_indexBuffer");pn(this,"_vertexBuffer");pn(this,"_topologyVector");this._triangleOffsets=e,this._indexBuffer=r,this._vertexBuffer=l,this._topologyVector=h}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),r=this._topologyVector,l=r.partOffsets,h=r.ringOffsets,f=r.geometryOffsets;let m=0,v=1,T=1,S=1;for(let A=0;A<this.numGeometries;A++)switch(this.geometryType(A)){case ii.POLYGON:{const M=l[v]-l[v-1];v++;const D=[];for(let z=0;z<M;z++){const V=h[T]-h[T-1];T++;const U=[];for(let $=0;$<V;$++){const X=this._vertexBuffer[m++],ae=this._vertexBuffer[m++];U.push(new R(X,ae))}U.length>0&&U.push(U[0]),D.push(U)}e[A]=D,f&&S++}break;case ii.MULTIPOLYGON:{const M=f[S]-f[S-1];S++;const D=[];for(let z=0;z<M;z++){const V=l[v]-l[v-1];v++;for(let U=0;U<V;U++){const $=h[T]-h[T-1];T++;const X=[];for(let ae=0;ae<$;ae++){const Y=this._vertexBuffer[m++],J=this._vertexBuffer[m++];X.push(new R(Y,J))}X.length>0&&X.push(X[0]),D.push(X)}}e[A]=D}}return e}[Symbol.iterator](){return null}}function Vv(i,e,r,l,h,f){return new Z2(i,e,r,l,h,f)}class Z2 extends Nv{constructor(r,l,h,f,m,v){super(h,f,m,v);pn(this,"_numGeometries");pn(this,"_geometryType");this._numGeometries=r,this._geometryType=l}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Bv(i,e,r,l,h){return new W2(i,e,r,l,h)}class W2 extends Nv{constructor(r,l,h,f,m){super(l,h,f,m);pn(this,"_geometryTypes");this._geometryTypes=r}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function K2(i,e,r,l,h){const f=Vi(i,r);let m=null,v=null,T=null,S=null,A=null,M=null,D=null,z=null;if(Lp(f,l,i,r)===ri.CONST){const U=ng(i,r,f,!1);for(let $=0;$<e-1;$++){const X=Vi(i,r);switch(X.physicalStreamType){case vi.LENGTH:switch(X.logicalStreamType.lengthType){case ys.GEOMETRIES:m=Ha(i,r,X);break;case ys.PARTS:v=Ha(i,r,X);break;case ys.RINGS:T=Ha(i,r,X);break;case ys.TRIANGLES:D=Ha(i,r,X)}break;case vi.OFFSET:switch(X.logicalStreamType.offsetType){case Yl.VERTEX:S=Bi(i,r,X,!1);break;case Yl.INDEX:z=Bi(i,r,X,!1)}break;case vi.DATA:oo.VERTEX===X.logicalStreamType.dictionaryType?A=Bi(i,r,X,!0):(M={numBits:X.numBits,coordinateShift:X.coordinateShift},A=Bi(i,r,X,!1))}}return z!==null?m!=null||v!=null?Vv(l,U,D,z,A,new pu(m,v,T)):Vv(l,U,D,z,A):M===null?function($,X,ae,Y,J){return new Fv($,X,ks.VEC_2,ae,Y,J)}(l,U,new pu(m,v,T),S,A):function($,X,ae,Y,J,he){return new Fv($,X,ks.MORTON,ae,Y,J,he)}(l,U,new pu(m,v,T),S,A,M)}const V=Bi(i,r,f,!1);for(let U=0;U<e-1;U++){const $=Vi(i,r);switch($.physicalStreamType){case vi.LENGTH:switch($.logicalStreamType.lengthType){case ys.GEOMETRIES:m=Bi(i,r,$,!1);break;case ys.PARTS:v=Bi(i,r,$,!1);break;case ys.RINGS:T=Bi(i,r,$,!1);break;case ys.TRIANGLES:D=Ha(i,r,$)}break;case vi.OFFSET:switch($.logicalStreamType.offsetType){case Yl.VERTEX:S=Bi(i,r,$,!1);break;case Yl.INDEX:z=Bi(i,r,$,!1)}break;case vi.DATA:oo.VERTEX===$.logicalStreamType.dictionaryType?A=Bi(i,r,$,!0):(M={numBits:$.numBits,coordinateShift:$.coordinateShift},A=Bi(i,r,$,!1))}}return z!==null&&v===null?Bv(V,D,z,A):(m!==null?(m=lg(V,m,2),v!==null&&T!==null?(v=Uv(V,m,v,!1),T=function(U,$,X,ae){const Y=new Int32Array(X[X.length-1]+1);let J=0;Y[0]=J;let he=1,ye=1,De=0;for(let Xe=0;Xe<U.length;Xe++){const $e=U[Xe],Qe=$[Xe+1]-$[Xe];if($e!==0&&$e!==3)for(let ut=0;ut<Qe;ut++){const et=X[he]-X[he-1];he++;for(let Ke=0;Ke<et;Ke++)J=Y[ye++]=J+ae[De++]}else for(let ut=0;ut<Qe;ut++)Y[ye++]=++J,he++}return Y}(V,m,v,T)):v!==null&&(v=function(U,$,X){const ae=new Int32Array($[$.length-1]+1);let Y=0;ae[0]=Y;let J=1,he=0;for(let ye=0;ye<U.length;ye++){const De=U[ye],Xe=$[ye+1]-$[ye];if(De===4||De===1)for(let $e=0;$e<Xe;$e++)Y=ae[J++]=Y+X[he++];else for(let $e=0;$e<Xe;$e++)ae[J++]=++Y}return ae}(V,m,v))):v!==null&&T!==null?(v=lg(V,v,1),T=Uv(V,v,T,!0)):v!==null&&(v=lg(V,v,0)),z!==null?Bv(V,D,z,A,new pu(m,v,T)):M===null?function(U,$,X,ae){return new Ov(ks.VEC_2,U,$,X,ae)}(V,new pu(m,v,T),S,A):function(U,$,X,ae,Y){return new Ov(ks.MORTON,U,$,X,ae,Y)}(V,new pu(m,v,T),S,A,M))}function lg(i,e,r){const l=new Int32Array(i.length+1);let h=0;l[0]=h;let f=0;for(let m=0;m<i.length;m++)h=l[m+1]=h+(i[m]>r?e[f++]:1);return l}function Uv(i,e,r,l){const h=new Int32Array(e[e.length-1]+1);let f=0;h[0]=f;let m=1,v=0;for(let T=0;T<i.length;T++){const S=i[T],A=e[T+1]-e[T];if(S===5||S===2||l&&(S===4||S===1))for(let M=0;M<A;M++)f=h[m++]=f+r[v++];else for(let M=0;M<A;M++)h[m++]=++f}return h}class X2 extends hu{constructor(r,l,h){super(r,l.getBuffer(),h);pn(this,"dataVector");this.dataVector=l}getValueFromBuffer(r){return this.dataVector.get(r)}}class Y2 extends Rp{getValueFromBuffer(e){return this.dataBuffer[e]}}class jv extends hu{constructor(e,r,l){super(e,BigInt64Array.of(r),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}function jh(i,e,r){return qv(i,Math.ceil(e/8),r)}function qv(i,e,r){const l=new Uint8Array(e);let h=0;for(;h<e;){const f=i[r.increment()];if(f<=127){const m=f+3,v=i[r.increment()],T=h+m;l.fill(v,h,T),h=T}else{const m=256-f;for(let v=0;v<m;v++)l[h++]=i[r.increment()]}}return l}const Q2=new TextDecoder;function cg(i,e,r){return r-e>=12?Q2.decode(i.subarray(e,r)):function(l,h,f){let m="",v=h;for(;v<f;){const T=l[v];let S,A,M,D=null,z=T>239?4:T>223?3:T>191?2:1;if(v+z>f)break;z===1?T<128&&(D=T):z===2?(S=l[v+1],(192&S)==128&&(D=(31&T)<<6|63&S,D<=127&&(D=null))):z===3?(S=l[v+1],A=l[v+2],(192&S)==128&&(192&A)==128&&(D=(15&T)<<12|(63&S)<<6|63&A,(D<=2047||D>=55296&&D<=57343)&&(D=null))):z===4&&(S=l[v+1],A=l[v+2],M=l[v+3],(192&S)==128&&(192&A)==128&&(192&M)==128&&(D=(15&T)<<18|(63&S)<<12|(63&A)<<6|63&M,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,z=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),v+=z}return m}(i,e,r)}class ug extends hu{constructor(r,l,h,f){super(r,h,f);pn(this,"offsetBuffer");this.offsetBuffer=l}}class $v extends ug{constructor(r,l,h,f){super(r,l,h,f??l.length-1);pn(this,"textEncoder");this.textEncoder=new TextEncoder}getValueFromBuffer(r){return cg(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class fu extends ug{constructor(r,l,h,f,m){super(r,h,f,m??l.length);pn(this,"indexBuffer");pn(this,"textEncoder");this.indexBuffer=l,this.indexBuffer=l,this.textEncoder=new TextEncoder}getValueFromBuffer(r){const l=this.indexBuffer[r];return cg(this.dataBuffer,this.offsetBuffer[l],this.offsetBuffer[l+1])}}class Gv extends ug{constructor(r,l,h,f,m,v,T){super(r,h,f,T);pn(this,"indexBuffer");pn(this,"symbolOffsetBuffer");pn(this,"symbolTableBuffer");pn(this,"textEncoder");pn(this,"symbolLengthBuffer");pn(this,"lengthBuffer");pn(this,"decodedDictionary");this.indexBuffer=l,this.symbolOffsetBuffer=m,this.symbolTableBuffer=v,this.textEncoder=new TextEncoder}getValueFromBuffer(r){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=function(h,f,m){const v=[],T=new Array(f.length).fill(0);for(let S=1;S<f.length;S++)T[S]=T[S-1]+f[S-1];for(let S=0;S<m.length;S++)if(m[S]===255)v.push(m[++S]);else{const A=f[m[S]],M=T[m[S]];for(let D=0;D<A;D++)v.push(h[M+D])}return new Uint8Array(v)}(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const l=this.indexBuffer[r];return cg(this.decodedDictionary,this.offsetBuffer[l],this.offsetBuffer[l+1])}offsetToLengthBuffer(r){const l=new Uint32Array(r.length-1);let h=r[0];for(let f=1;f<r.length;f++){const m=r[f];l[f-1]=m-h,h=m}return l}}function J2(i,e,r,l,h,f){return r.type==="scalarType"?function(m,v,T,S,A,M){let D=null,z=0;if(m===0)return null;if(M.nullable){const U=Vi(v,T);z=U.numValues;const $=T.get(),X=jh(v,z,T);T.set($+U.byteLength),D=new ao(X,U.numValues)}const V=D??S;switch(A.physicalType){case 4:case 3:return function(U,$,X,ae,Y){const J=Vi(U,$),he=Lp(J,Y,U,$),ye=ae.physicalType===3;if(he===ri.FLAT){const De=qh(Y)?rg(U,$,J,ye,Y):Bi(U,$,J,ye);return new Xm(X.name,De,Y)}if(he===ri.SEQUENCE){const De=Pv(U,$,J);return new Qm(X.name,De[0],De[1],J.numRleValues)}{const De=ng(U,$,J,ye);return new Jm(X.name,De,Y)}}(v,T,M,A,V);case 9:return function(U,$,X,ae,Y){let J=null,he=null,ye=null,De=null,Xe=null,$e=null,Qe=null,ut=null;for(let et=0;et<ae;et++){const Ke=Vi($,X);if(Ke.byteLength!==0)switch(Ke.physicalStreamType){case vi.PRESENT:{const Ve=jh($,Ke.numValues,X);$e=new ao(Ve,Ke.numValues);break}case vi.OFFSET:he=Y!=null||$e!=null?rg($,X,Ke,!1,Y??$e):Bi($,X,Ke,!1);break;case vi.LENGTH:{const Ve=Ha($,X,Ke);ys.DICTIONARY===Ke.logicalStreamType.lengthType?J=Ve:ys.SYMBOL===Ke.logicalStreamType.lengthType?De=Ve:Qe=Ve;break}case vi.DATA:{const Ve=$.subarray(X.get(),X.get()+Ke.byteLength);X.add(Ke.byteLength);const vt=Ke.logicalStreamType.dictionaryType;oo.FSST===vt?Xe=Ve:oo.SINGLE===vt||oo.SHARED===vt?ye=Ve:oo.NONE===vt&&(ut=Ve);break}}}return function(et,Ke,Ve,vt,_t,bt,pt){return Ke?new Gv(et,Ve,vt,_t,bt,Ke,pt):null}(U,Xe,he,J,ye,De,Y??$e)??function(et,Ke,Ve,vt,_t){return Ke?_t?new fu(et,Ve,vt,Ke,_t):new fu(et,Ve,vt,Ke):null}(U,ye,he,J,Y??$e)??function(et,Ke,Ve,vt,_t){if(!Ke||!Ve)return null;if(vt)return _t?new fu(et,vt,Ke,Ve,_t):new fu(et,vt,Ke,Ve);if(_t&&_t.size()!==Ke.length-1){const bt=new Int32Array(_t.size());let pt=0;for(let kt=0;kt<_t.size();kt++)bt[kt]=_t.get(kt)?pt++:0;return new fu(et,bt,Ke,Ve,_t)}return _t?new $v(et,Ke,Ve,_t):new $v(et,Ke,Ve)}(U,Qe,ut,he,Y??$e)}(M.name,v,T,M.nullable?m-1:m,D);case 0:return function(U,$,X,ae,Y){const J=Vi(U,$),he=J.numValues,ye=$.get(),De=qh(Y)?function($e,Qe,ut,et){const Ke=qv($e,Math.ceil(Qe/8),ut),Ve=new ao(Ke,Qe),vt=et.size(),_t=new ao(new Uint8Array(vt),vt);let bt=0;for(let pt=0;pt<et.size();pt++){const kt=!!et.get(pt)&&Ve.get(bt++);_t.set(pt,kt)}return _t.getBuffer()}(U,he,$,Y):jh(U,he,$);$.set(ye+J.byteLength);const Xe=new ao(De,he);return new X2(X.name,Xe,Y)}(v,T,M,0,V);case 6:case 5:return function(U,$,X,ae,Y){const J=Vi(U,$),he=Lp(J,ae,U,$),ye=Y.physicalType===5;if(he===ri.FLAT){const De=qh(ae)?function(Xe,$e,Qe,ut,et){return function(Ke,Ve,vt,_t){switch(Ve.logicalLevelTechnique1){case An.DELTA:return Ve.logicalLevelTechnique2===An.RLE&&(Ke=Ev(Ke,Ve.runs,Ve.numRleValues)),function(bt,pt){const kt=new BigInt64Array(bt.size());let On=0;bt.get(0)?(kt[0]=bt.get(0)?pt[0]>>1n^-(1n&pt[0]):0n,On=1):kt[0]=0n;let En=1;for(;En!=kt.length;++En)kt[En]=bt.get(En)?kt[En-1]+(pt[On]>>1n^-(1n&pt[On++])):kt[En-1];return kt}(_t,Ke);case An.RLE:return function(bt,pt,kt,On){const En=pt;return kt?function(yr,bi,qr){const vr=new BigInt64Array(yr.size());let pr=0;for(let Hn=0;Hn<qr;Hn++){const Sr=Number(bi[Hn]);let Lr=bi[Hn+qr];Lr=Lr>>1n^-(1n&Lr);for(let lr=pr;lr<pr+Sr;lr++)yr.get(lr)?vr[lr]=Lr:(vr[lr]=0n,pr++);pr+=Sr}return vr}(On,bt,En.runs):function(yr,bi,qr){const vr=new BigInt64Array(yr.size());let pr=0;for(let Hn=0;Hn<qr;Hn++){const Sr=Number(bi[Hn]),Lr=bi[Hn+qr];for(let lr=pr;lr<pr+Sr;lr++)yr.get(lr)?vr[lr]=Lr:(vr[lr]=0n,pr++);pr+=Sr}return vr}(On,bt,En.runs)}(Ke,Ve,vt,_t);case An.NONE:return Ke=vt?function(bt,pt){const kt=new BigInt64Array(bt.size());let On=0,En=0;for(;En!=kt.length;++En)if(bt.get(En)){const yr=pt[On++];kt[En]=yr>>1n^-(1n&yr)}else kt[En]=0n;return kt}(_t,Ke):function(bt,pt){const kt=new BigInt64Array(bt.size());let On=0,En=0;for(;En!=kt.length;++En)kt[En]=bt.get(En)?pt[On++]:0n;return kt}(_t,Ke),Ke;default:throw new Error("The specified Logical level technique is not supported")}}(kp(Xe,$e,Qe.numValues),Qe,ut,et)}(U,$,J,ye,ae):Cv(U,$,J,ye);return new Rv(X.name,De,ae)}if(he===ri.SEQUENCE){const De=Av(U,$,J);return new kv(X.name,De[0],De[1],J.numRleValues)}{const De=Mv(U,$,J,ye);return new jv(X.name,De,ae)}}(v,T,M,V,A);case 7:return function(U,$,X,ae){const Y=Vi(U,$),J=qh(ae)?function(he,ye,De,Xe){const $e=ye.get(),Qe=$e+Xe*Float32Array.BYTES_PER_ELEMENT,ut=new Uint8Array(he.subarray($e,Qe)).buffer,et=new Float32Array(ut);ye.set(Qe);const Ke=De.size(),Ve=new Float32Array(Ke);let vt=0;for(let _t=0;_t<Ke;_t++)Ve[_t]=De.get(_t)?et[vt++]:0;return Ve}(U,$,ae,Y.numValues):function(he,ye,De){const Xe=ye.get(),$e=Xe+De*Float32Array.BYTES_PER_ELEMENT,Qe=new Uint8Array(he.subarray(Xe,$e)).buffer,ut=new Float32Array(Qe);return ye.set($e),ut}(U,$,Y.numValues);return new Y2(X.name,J,ae)}(v,T,M,V);case 8:return function(U,$,X,ae){const Y=Vi(U,$),J=qh(ae)?function(he,ye,De,Xe){const $e=ye.get(),Qe=$e+Xe*Float64Array.BYTES_PER_ELEMENT,ut=new Uint8Array(he.subarray($e,Qe)).buffer,et=new Float64Array(ut);ye.set(Qe);const Ke=De.size(),Ve=new Float64Array(Ke);let vt=0;for(let _t=0;_t<Ke;_t++)Ve[_t]=De.get(_t)?et[vt++]:0;return Ve}(U,$,ae,Y.numValues):function(he,ye,De){const Xe=ye.get(),$e=Xe+De*Float64Array.BYTES_PER_ELEMENT,Qe=new Uint8Array(he.subarray(Xe,$e)).buffer,ut=new Float64Array(Qe);return ye.set($e),ut}(U,$,Y.numValues);return new Ym(X.name,J,ae)}(v,T,M,V);default:throw new Error(`The specified data type for the field is currently not supported: ${A}`)}}(l,i,e,h,r.scalarType,r):l!=1?null:function(m,v,T,S){let A=null,M=null,D=null,z=null,V=!1;for(;!V;){const ae=Vi(m,v);switch(ae.physicalStreamType){case vi.LENGTH:ys.DICTIONARY===ae.logicalStreamType.lengthType?A=Ha(m,v,ae):D=Ha(m,v,ae);break;case vi.DATA:oo.SINGLE===ae.logicalStreamType.dictionaryType||oo.SHARED===ae.logicalStreamType.dictionaryType?(M=m.subarray(v.get(),v.get()+ae.byteLength),V=!0):z=m.subarray(v.get(),v.get()+ae.byteLength),v.add(ae.byteLength)}}const U=T.complexType.children,$=[];let X=0;for(const ae of U){const Y=pi(m,v,1)[0];if(Y==0)continue;const J=`${T.name}${ae.name==="default"?"":":"+ae.name}`;if(Y!==2||ae.type!=="scalarField"||ae.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const he=Vi(m,v),ye=jh(m,he.numValues,v),De=Vi(m,v),Xe=De.decompressedCount!==S?rg(m,v,De,!1,new ao(ye,he.numValues)):Bi(m,v,De,!1);$[X++]=z?new Gv(J,Xe,A,M,D,z,new ao(ye,he.numValues)):new fu(J,Xe,A,M,new ao(ye,he.numValues))}return $}(i,e,r,h)}function qh(i){return i instanceof ao}function eE(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const tE=new TextDecoder;function Hv(i,e){const r=pi(i,e,1)[0];if(r===0)return"";const l=e.get(),h=i.subarray(l,l+r);return e.add(r),tE.decode(h)}function Zv(i,e){const r=pi(i,e,1)[0]>>>0,l=!!(4&r),h=!!(2&r),f=pi(i,e,1)[0]>>>0,m={};if(1&r&&(m.nullable=!0),h){const v={};if(l?(v.type="logicalType",v.logicalType=f):(v.type="physicalType",v.physicalType=f),8&r){const T=pi(i,e,1)[0]>>>0;v.children=new Array(T);for(let S=0;S<T;S++)v.children[S]=Zv(i,e)}m.type="complexField",m.complexField=v}else{const v={};l?(v.type="logicalType",v.logicalType=f):(v.type="physicalType",v.physicalType=f),m.type="scalarField",m.scalarField=v}return m}function nE(i,e){const r=pi(i,e,1)[0]>>>0,l=function(h){switch(h){case 0:case 1:case 2:case 3:{const f={};f.nullable=!!(1&h),f.columnScope=0;const m={};return m.physicalType=h>1?6:4,m.type="physicalType",f.scalarType=m,f.type="scalarType",f}case 4:{const f={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:0};return f.type="complexType",f.complexType=m,f}case 30:{const f={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:1};return f.type="complexType",f.complexType=m,f}default:return function(f){let m=null;switch(f){case 10:case 11:m=0;break;case 12:case 13:m=1;break;case 14:case 15:m=2;break;case 16:case 17:m=3;break;case 18:case 19:m=4;break;case 20:case 21:m=5;break;case 22:case 23:m=6;break;case 24:case 25:m=7;break;case 26:case 27:m=8;break;case 28:case 29:m=9;break;default:return null}const v={};v.nullable=!!(1&f),v.columnScope=0;const T={type:"physicalType"};return T.physicalType=m,v.type="scalarType",v.scalarType=T,v}(h)}}(r);if(!l)throw new Error(`Unsupported column type code: ${r}`);if(function(h){return h>=10}(r)?l.name=Hv(i,e):r>=0&&r<=3?l.name="id":r===4&&(l.name="geometry"),function(h){return h===30}(r)){const h=pi(i,e,1)[0]>>>0,f=l.complexType;f.children=new Array(h);for(let m=0;m<h;m++)f.children[m]=Zv(i,e)}return l}function rE(i,e){const r={featureTables:[]},l={};l.name=Hv(i,e);const h=pi(i,e,1)[0]>>>0,f=pi(i,e,1)[0]>>>0;l.columns=new Array(f);for(let m=0;m<f;m++)l.columns[m]=nE(i,e);return r.featureTables.push(l),[r,h]}function iE(i,e,r,l,h,f,m=!1){const v=e.scalarType.physicalType,T=Lp(h,f,i,r);if(v===4)switch(T){case ri.FLAT:{const S=Bi(i,r,h,!1);return new Xm(l,S,f)}case ri.SEQUENCE:{const S=Pv(i,r,h);return new Qm(l,S[0],S[1],h.numRleValues)}case ri.CONST:{const S=ng(i,r,h,!1);return new Jm(l,S,f)}}else switch(T){case ri.FLAT:{if(m){const A=function(M,D,z,V){const U=function($,X,ae){const Y=new Float64Array(X);for(let J=0;J<X;J++)Y[J]=$2($,ae);return Y}(M,z.numValues,D);return function($,X,ae){switch(X.logicalLevelTechnique1){case An.DELTA:return X.logicalLevelTechnique2===An.RLE&&($=Iv($,X.runs,X.numRleValues)),function(Y){Y[0]=Y[0]%2==1?(Y[0]+1)/-2:Y[0]/2;const J=Y.length/4*4;let he=1;if(J>=4)for(;he<J-4;he+=4){const ye=Y[he],De=Y[he+1],Xe=Y[he+2],$e=Y[he+3];Y[he]=(ye%2==1?(ye+1)/-2:ye/2)+Y[he-1],Y[he+1]=(De%2==1?(De+1)/-2:De/2)+Y[he],Y[he+2]=(Xe%2==1?(Xe+1)/-2:Xe/2)+Y[he+1],Y[he+3]=($e%2==1?($e+1)/-2:$e/2)+Y[he+2]}for(;he!=Y.length;++he)Y[he]=(Y[he]%2==1?(Y[he]+1)/-2:Y[he]/2)+Y[he-1]}($),$;case An.RLE:return function(Y,J,he){return Iv(Y,J.runs,J.numRleValues)}($,X);case An.NONE:return $;default:throw new Error(`The specified Logical level technique is not supported: ${X.logicalLevelTechnique1}`)}}(U,z)}(i,r,h);return new Ym(l,A,f)}const S=Cv(i,r,h,!1);return new Rv(l,S,f)}case ri.SEQUENCE:{const S=Av(i,r,h);return new kv(l,S[0],S[1],h.numRleValues)}case ri.CONST:{const S=Mv(i,r,h,!1);return new jv(l,S,f)}}throw new Error("Vector type not supported for id column.")}class sE{constructor(e,r){var l;switch(this._featureData=e,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case ii.POINT:case ii.MULTIPOINT:this.type=1;break;case ii.LINESTRING:case ii.MULTILINESTRING:this.type=2;break;case ii.POLYGON:case ii.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=r,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const r of this._featureData.geometry.coordinates){const l=[];for(const h of r)l.push(new R(h.x,h.y));e.push(l)}return e}}class oE{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new sE(this.features[e],this.extent)}}class Wv{constructor(e){this.layers={};const r=function(l,h,f=!0){const m=new q2(0),v=[];for(;m.get()<l.length;){const T=pi(l,m,1)[0]>>>0,S=m.get()+T;if(S>l.length)throw new Error(`Block overruns tile: ${S} > ${l.length}`);if(pi(l,m,1)[0]>>>0!=1){m.set(S);continue}const A=rE(l,m),M=A[1],D=A[0].featureTables[0];let z=null,V=null;const U=[];let $=0;for(const ae of D.columns){const Y=ae.name;if(Y==="id"){let J=null;if(ae.nullable){const ye=Vi(l,m),De=m.get(),Xe=jh(l,ye.numValues,m);m.set(De+ye.byteLength),J=new ao(Xe,ye.numValues)}const he=Vi(l,m);$=he.decompressedCount,z=iE(l,ae,m,Y,he,J??$,f)}else if(Y==="geometry"){const J=pi(l,m,1)[0];if($===0){const he=m.get();$=Vi(l,m).decompressedCount,m.set(he)}V=K2(l,J,m,$)}else{const J=eE(ae)?pi(l,m,1)[0]:1;if(J===0&&ae.type==="scalarType")continue;const he=J2(l,m,ae,J,$);if(he)if(Array.isArray(he))for(const ye of he)U.push(ye);else U.push(he)}}const X=new j2(D.name,V,z,U,M);v.push(X),m.set(S)}return v}(new Uint8Array(e));this.layers=r.reduce((l,h)=>Object.assign(Object.assign({},l),{[h.name]:new oE(h)}),{})}}class aE{constructor(e,r){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=r,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],r=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of r){const h=[];for(const f of l)h.push(new R(f[0],f[1]));e.push(h)}return e}}const $h="_geojsonTileLayer";function lE(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const r={keys:[],values:[],keycache:{},valuecache:{}};for(let f=0;f<i.length;f++)r.feature=i.feature(f),e.writeMessage(2,cE,r);const l=r.keys;for(const f of l)e.writeStringField(3,f);const h=r.values;for(const f of h)e.writeMessage(4,dE,f)}function cE(i,e){if(!i.feature)return;const r=i.feature;r.id!==void 0&&e.writeVarintField(1,r.id),e.writeMessage(2,uE,i),e.writeVarintField(3,r.type),e.writeMessage(4,hE,r)}function uE(i,e){var r;for(const l in(r=i.feature)==null?void 0:r.properties){let h=i.feature.properties[l],f=i.keycache[l];if(h==null)continue;f===void 0&&(i.keys.push(l),f=i.keys.length-1,i.keycache[l]=f),e.writeVarint(f),typeof h!="string"&&typeof h!="boolean"&&typeof h!="number"&&(h=JSON.stringify(h));const m=typeof h+":"+h;let v=i.valuecache[m];v===void 0&&(i.values.push(h),v=i.values.length-1,i.valuecache[m]=v),e.writeVarint(v)}}function hg(i,e){return(e<<3)+(7&i)}function Kv(i){return i<<1^i>>31}function hE(i,e){const r=i.loadGeometry(),l=i.type;let h=0,f=0;for(const m of r){let v=1;l===1&&(v=m.length),e.writeVarint(hg(1,v));const T=l===3?m.length-1:m.length;for(let S=0;S<T;S++){S===1&&l!==1&&e.writeVarint(hg(2,T-1));const A=m[S].x-h,M=m[S].y-f;e.writeVarint(Kv(A)),e.writeVarint(Kv(M)),h+=A,f+=M}i.type===3&&e.writeVarint(hg(7,1))}}function dE(i,e){const r=typeof i;r==="string"?e.writeStringField(1,i):r==="boolean"?e.writeBooleanField(7,i):r==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class Xv{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Va(Pt,16,0),this.grid3D=new Va(Pt,16,0),this.featureIndexArray=new Z,this.promoteId=r}insert(e,r,l,h,f,m){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,f);const T=m?this.grid3D:this.grid;for(let S=0;S<r.length;S++){const A=r[S],M=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const z=A[D];M[0]=Math.min(M[0],z.x),M[1]=Math.min(M[1],z.y),M[2]=Math.max(M[2],z.x),M[3]=Math.max(M[3],z.y)}M[0]<Pt&&M[1]<Pt&&M[2]>=0&&M[3]>=0&&T.insert(v,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new zy(new Sp(this.rawTileData)).layers:new Wv(this.rawTileData).layers,this.sourceLayerCoder=new yv(this.vtLayers?Object.keys(this.vtLayers).sort():[$h])),this.vtLayers}query(e,r,l,h){this.loadVTLayers();const f=e.params,m=Pt/e.tileSize/e.scale,v=Sl(f.filter,f.globalState),T=e.queryGeometry,S=e.queryPadding*m,A=Xl.fromPoints(T),M=this.grid.query(A.minX-S,A.minY-S,A.maxX+S,A.maxY+S),D=Xl.fromPoints(e.cameraQueryGeometry).expandBy(S),z=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,($,X,ae,Y)=>function(J,he,ye,De,Xe){for(const Qe of J)if(he<=Qe.x&&ye<=Qe.y&&De>=Qe.x&&Xe>=Qe.y)return!0;const $e=[new R(he,ye),new R(he,Xe),new R(De,Xe),new R(De,ye)];if(J.length>2){for(const Qe of $e)if(nu(J,Qe))return!0}for(let Qe=0;Qe<J.length-1;Qe++)if(fT(J[Qe],J[Qe+1],$e))return!0;return!1}(e.cameraQueryGeometry,$-S,X-S,ae+S,Y+S));for(const $ of z)M.push($);M.sort(pE);const V={};let U;for(let $=0;$<M.length;$++){const X=M[$];if(X===U)continue;U=X;const ae=this.featureIndexArray.get(X);let Y=null;this.loadMatchingFeature(V,ae.bucketIndex,ae.sourceLayerIndex,ae.featureIndex,v,f.layers,f.availableImages,r,l,h,(J,he,ye)=>(Y||(Y=ko(J)),he.queryIntersectsFeature({queryGeometry:T,feature:J,featureState:ye,geometry:Y,zoom:this.z,transform:e.transform,pixelsToTileUnits:m,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation})))}return V}loadMatchingFeature(e,r,l,h,f,m,v,T,S,A,M){const D=this.bucketLayerIDs[r];if(m&&!D.some($=>m.has($)))return;const z=this.sourceLayerCoder.decode(l),V=this.vtLayers[z].feature(h);if(f.needGeometry){const $=Do(V,!0);if(!f.filter(new Jn(this.tileID.overscaledZ),$,this.tileID.canonical))return}else if(!f.filter(new Jn(this.tileID.overscaledZ),V))return;const U=this.getId(V,z);for(let $=0;$<D.length;$++){const X=D[$];if(m&&!m.has(X))continue;const ae=T[X];if(!ae)continue;let Y={};U&&A&&(Y=A.getState(ae.sourceLayer||$h,U));const J=Wt({},S[X]);J.paint=Yv(J.paint,ae.paint,V,Y,v),J.layout=Yv(J.layout,ae.layout,V,Y,v);const he=!M||M(V,ae,Y);if(!he)continue;const ye=new vv(V,this.z,this.x,this.y,U);ye.layer=J;let De=e[X];De===void 0&&(De=e[X]=[]),De.push({featureIndex:h,feature:ye,intersectionZ:he})}}lookupSymbolFeatures(e,r,l,h,f,m,v,T){const S={};this.loadVTLayers();const A=Sl(f.filterSpec,f.globalState);for(const M of e)this.loadMatchingFeature(S,l,h,M,A,m,v,T,r);return S}hasLayer(e){for(const r of this.bucketLayerIDs)for(const l of r)if(e===l)return!0;return!1}getId(e,r){var l;let h=e.id;return this.promoteId&&(h=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((l=e.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(h=Number(e.properties.cluster_id))),h}}function Yv(i,e,r,l,h){return Kt(i,(f,m)=>{const v=e instanceof Vl?e.get(m):null;return v&&v.evaluate?v.evaluate(r,l,h):v})}function pE(i,e){return e-i}function Qv(i,e,r,l,h){const f=[];for(let m=0;m<i.length;m++){const v=i[m];let T;for(let S=0;S<v.length-1;S++){let A=v[S],M=v[S+1];A.x<e&&M.x<e||(A.x<e?A=new R(e,A.y+(e-A.x)/(M.x-A.x)*(M.y-A.y))._round():M.x<e&&(M=new R(e,A.y+(e-A.x)/(M.x-A.x)*(M.y-A.y))._round()),A.y<r&&M.y<r||(A.y<r?A=new R(A.x+(r-A.y)/(M.y-A.y)*(M.x-A.x),r)._round():M.y<r&&(M=new R(A.x+(r-A.y)/(M.y-A.y)*(M.x-A.x),r)._round()),A.x>=l&&M.x>=l||(A.x>=l?A=new R(l,A.y+(l-A.x)/(M.x-A.x)*(M.y-A.y))._round():M.x>=l&&(M=new R(l,A.y+(l-A.x)/(M.x-A.x)*(M.y-A.y))._round()),A.y>=h&&M.y>=h||(A.y>=h?A=new R(A.x+(h-A.y)/(M.y-A.y)*(M.x-A.x),h)._round():M.y>=h&&(M=new R(A.x+(h-A.y)/(M.y-A.y)*(M.x-A.x),h)._round()),T&&A.equals(T[T.length-1])||(T=[A],f.push(T)),T.push(M)))))}}return f}function Jv(i,e,r,l,h){switch(e){case 1:return function(f,m,v,T){const S=[];for(const A of f)for(const M of A){const D=T===0?M.x:M.y;D>=m&&D<=v&&S.push([M])}return S}(i,r,l,h);case 2:return e0(i,r,l,h,!1);case 3:return e0(i,r,l,h,!0)}return[]}function fE(i,e,r,l,h){const f=l===0?mE:gE;let m=[];const v=[];for(let A=0;A<i.length-1;A++){const M=i[A],D=i[A+1],z=l===0?M.x:M.y,V=l===0?D.x:D.y;let U=!1;z<e?V>e&&m.push(f(M,D,e)):z>r?V<r&&m.push(f(M,D,r)):m.push(M),V<e&&z>=e&&(m.push(f(M,D,e)),U=!0),V>r&&z<=r&&(m.push(f(M,D,r)),U=!0),!h&&U&&(v.push(m),m=[])}const T=i.length-1,S=l===0?i[T].x:i[T].y;return S>=e&&S<=r&&m.push(i[T]),h&&m.length>0&&!m[0].equals(m[m.length-1])&&m.push(new R(m[0].x,m[0].y)),m.length>0&&v.push(m),v}function e0(i,e,r,l,h){const f=[];for(const m of i){const v=fE(m,e,r,l,h);v.length>0&&f.push(...v)}return f}function mE(i,e,r){return new R(r,i.y+(r-i.x)/(e.x-i.x)*(e.y-i.y))}function gE(i,e,r){return new R(i.x+(r-i.y)/(e.y-i.y)*(e.x-i.x),r)}xt("FeatureIndex",Xv,{omit:["rawTileData","sourceLayerCoder"]});class Za extends R{constructor(e,r,l,h){super(e,r),this.angle=l,h!==void 0&&(this.segment=h)}clone(){return new Za(this.x,this.y,this.angle,this.segment)}}function t0(i,e,r,l,h){if(e.segment===void 0||r===0)return!0;let f=e,m=e.segment+1,v=0;for(;v>-r/2;){if(m--,m<0)return!1;v-=i[m].dist(f),f=i[m]}v+=i[m].dist(i[m+1]),m++;const T=[];let S=0;for(;v<r/2;){const A=i[m],M=i[m+1];if(!M)return!1;let D=i[m-1].angleTo(A)-A.angleTo(M);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:D}),S+=D;v-T[0].distance>l;)S-=T.shift().angleDelta;if(S>h)return!1;m++,v+=A.dist(M)}return!0}function n0(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function r0(i,e,r){return i?.6*e*r:0}function i0(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function _E(i,e,r,l,h,f){const m=r0(r,h,f),v=i0(r,l)*f;let T=0;const S=n0(i)/2;for(let A=0;A<i.length-1;A++){const M=i[A],D=i[A+1],z=M.dist(D);if(T+z>S){const V=(S-T)/z,U=tr.number(M.x,D.x,V),$=tr.number(M.y,D.y,V),X=new Za(U,$,D.angleTo(M),A);return X._round(),!m||t0(i,X,v,m,e)?X:void 0}T+=z}}function yE(i,e,r,l,h,f,m,v,T){const S=r0(l,f,m),A=i0(l,h),M=A*m,D=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-M<e/4&&(e=M+e/4),s0(i,D?e/2*v%e:(A/2+2*f)*m*v%e,e,S,r,M,D,!1,T)}function s0(i,e,r,l,h,f,m,v,T){const S=f/2,A=n0(i);let M=0,D=e-r,z=[];for(let V=0;V<i.length-1;V++){const U=i[V],$=i[V+1],X=U.dist($),ae=$.angleTo(U);for(;D+r<M+X;){D+=r;const Y=(D-M)/X,J=tr.number(U.x,$.x,Y),he=tr.number(U.y,$.y,Y);if(J>=0&&J<T&&he>=0&&he<T&&D-S>=0&&D+S<=A){const ye=new Za(J,he,ae,V);ye._round(),l&&!t0(i,ye,f,l,h)||z.push(ye)}}M+=X}return v||z.length||m||(z=s0(i,M/2,r,l,h,f,m,!0,T)),z}function o0(i,e,r,l){const h=[],f=i.image,m=f.pixelRatio,v=f.paddedRect.w-2,T=f.paddedRect.h-2;let S={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const A=f.stretchX||[[0,v]],M=f.stretchY||[[0,T]],D=(Ve,vt)=>Ve+vt[1]-vt[0],z=A.reduce(D,0),V=M.reduce(D,0),U=v-z,$=T-V;let X=0,ae=z,Y=0,J=V,he=0,ye=U,De=0,Xe=$;if(f.content&&l){const Ve=f.content,vt=Ve[2]-Ve[0],_t=Ve[3]-Ve[1];(f.textFitWidth||f.textFitHeight)&&(S=tv(i)),X=Np(A,0,Ve[0]),Y=Np(M,0,Ve[1]),ae=Np(A,Ve[0],Ve[2]),J=Np(M,Ve[1],Ve[3]),he=Ve[0]-X,De=Ve[1]-Y,ye=vt-ae,Xe=_t-J}const $e=S.x1,Qe=S.y1,ut=S.x2-$e,et=S.y2-Qe,Ke=(Ve,vt,_t,bt)=>{const pt=Vp(Ve.stretch-X,ae,ut,$e),kt=Bp(Ve.fixed-he,ye,Ve.stretch,z),On=Vp(vt.stretch-Y,J,et,Qe),En=Bp(vt.fixed-De,Xe,vt.stretch,V),yr=Vp(_t.stretch-X,ae,ut,$e),bi=Bp(_t.fixed-he,ye,_t.stretch,z),qr=Vp(bt.stretch-Y,J,et,Qe),vr=Bp(bt.fixed-De,Xe,bt.stretch,V),pr=new R(pt,On),Hn=new R(yr,On),Sr=new R(yr,qr),Lr=new R(pt,qr),lr=new R(kt/m,En/m),rs=new R(bi/m,vr/m),wi=e*Math.PI/180;if(wi){const si=Math.sin(wi),Tr=Math.cos(wi),$r=[Tr,-si,si,Tr];pr._matMult($r),Hn._matMult($r),Lr._matMult($r),Sr._matMult($r)}const is=Ve.stretch+Ve.fixed,Ks=vt.stretch+vt.fixed;return{tl:pr,tr:Hn,bl:Lr,br:Sr,tex:{x:f.paddedRect.x+1+is,y:f.paddedRect.y+1+Ks,w:_t.stretch+_t.fixed-is,h:bt.stretch+bt.fixed-Ks},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:rs,minFontScaleX:ye/m/ut,minFontScaleY:Xe/m/et,isSDF:r}};if(l&&(f.stretchX||f.stretchY)){const Ve=a0(A,U,z),vt=a0(M,$,V);for(let _t=0;_t<Ve.length-1;_t++){const bt=Ve[_t],pt=Ve[_t+1];for(let kt=0;kt<vt.length-1;kt++)h.push(Ke(bt,vt[kt],pt,vt[kt+1]))}}else h.push(Ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:T+1}));return h}function Np(i,e,r){let l=0;for(const h of i)l+=Math.max(e,Math.min(r,h[1]))-Math.max(e,Math.min(r,h[0]));return l}function a0(i,e,r){const l=[{fixed:-1,stretch:0}];for(const[h,f]of i){const m=l[l.length-1];l.push({fixed:h-m.stretch,stretch:m.stretch}),l.push({fixed:h-m.stretch,stretch:m.stretch+(f-h)})}return l.push({fixed:e+1,stretch:r}),l}function Vp(i,e,r,l){return i/e*r+l}function Bp(i,e,r,l){return i-e*r/l}xt("Anchor",Za);class Up{constructor(e,r,l,h,f,m,v,T,S,A){var M;if(this.boxStartIndex=e.length,S){let D=m.top,z=m.bottom;const V=m.collisionPadding;V&&(D-=V[1],z+=V[3]);let U=z-D;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{const D=!((M=m.image)===null||M===void 0)&&M.content&&(m.image.textFitWidth||m.image.textFitHeight)?tv(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*v-T[0],D.y2=D.y2*v+T[2],D.x1=D.x1*v-T[3],D.x2=D.x2*v+T[1];const z=m.collisionPadding;if(z&&(D.x1-=z[0]*v,D.y1-=z[1]*v,D.x2+=z[2]*v,D.y2+=z[3]*v),A){const V=new R(D.x1,D.y1),U=new R(D.x2,D.y1),$=new R(D.x1,D.y2),X=new R(D.x2,D.y2),ae=A*Math.PI/180;V._rotate(ae),U._rotate(ae),$._rotate(ae),X._rotate(ae),D.x1=Math.min(V.x,U.x,$.x,X.x),D.x2=Math.max(V.x,U.x,$.x,X.x),D.y1=Math.min(V.y,U.y,$.y,X.y),D.y2=Math.max(V.y,U.y,$.y,X.y)}e.emplaceBack(r.x,r.y,D.x1,D.y1,D.x2,D.y2,l,h,f)}this.boxEndIndex=e.length}}class vE{constructor(e=[],r=(l,h)=>l<h?-1:l>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:l}=this,h=r[e];for(;e>0;){const f=e-1>>1,m=r[f];if(l(h,m)>=0)break;r[e]=m,e=f}r[e]=h}_down(e){const{data:r,compare:l}=this,h=this.length>>1,f=r[e];for(;e<h;){let m=1+(e<<1);const v=m+1;if(v<this.length&&l(r[v],r[m])<0&&(m=v),l(r[m],f)>=0)break;r[e]=r[m],e=m}r[e]=f}}function xE(i,e=1,r=!1){const l=Xl.fromPoints(i[0]),h=Math.min(l.width(),l.height());let f=h/2;const m=new vE([],bE),{minX:v,minY:T,maxX:S,maxY:A}=l;if(h===0)return new R(v,T);for(let z=v;z<S;z+=h)for(let V=T;V<A;V+=h)m.push(new mu(z+f,V+f,f,i));let M=function(z){let V=0,U=0,$=0;const X=z[0];for(let ae=0,Y=X.length,J=Y-1;ae<Y;J=ae++){const he=X[ae],ye=X[J],De=he.x*ye.y-ye.x*he.y;U+=(he.x+ye.x)*De,$+=(he.y+ye.y)*De,V+=3*De}return new mu(U/V,$/V,0,z)}(i),D=m.length;for(;m.length;){const z=m.pop();(z.d>M.d||!M.d)&&(M=z,r&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,D)),z.max-M.d<=e||(f=z.h/2,m.push(new mu(z.p.x-f,z.p.y-f,f,i)),m.push(new mu(z.p.x+f,z.p.y-f,f,i)),m.push(new mu(z.p.x-f,z.p.y+f,f,i)),m.push(new mu(z.p.x+f,z.p.y+f,f,i)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${M.d}`)),M.p}function bE(i,e){return e.max-i.max}function mu(i,e,r,l){this.p=new R(i,e),this.h=r,this.d=function(h,f){let m=!1,v=1/0;for(let T=0;T<f.length;T++){const S=f[T];for(let A=0,M=S.length,D=M-1;A<M;D=A++){const z=S[A],V=S[D];z.y>h.y!=V.y>h.y&&h.x<(V.x-z.x)*(h.y-z.y)/(V.y-z.y)+z.x&&(m=!m),v=Math.min(v,dy(h,z,V))}}return(m?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var xi;x.aP=void 0,(xi=x.aP||(x.aP={}))[xi.center=1]="center",xi[xi.left=2]="left",xi[xi.right=3]="right",xi[xi.top=4]="top",xi[xi.bottom=5]="bottom",xi[xi["top-left"]=6]="top-left",xi[xi["top-right"]=7]="top-right",xi[xi["bottom-left"]=8]="bottom-left",xi[xi["bottom-right"]=9]="bottom-right";const dg=Number.POSITIVE_INFINITY;function l0(i,e){return e[1]!==dg?function(r,l,h){let f=0,m=0;switch(l=Math.abs(l),h=Math.abs(h),r){case"top-right":case"top-left":case"top":m=h-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-h}switch(r){case"top-right":case"bottom-right":case"right":f=-l;break;case"top-left":case"bottom-left":case"left":f=l}return[f,m]}(i,e[0],e[1]):function(r,l){let h=0,f=0;l<0&&(l=0);const m=l/Math.SQRT2;switch(r){case"top-right":case"top-left":f=m-7;break;case"bottom-right":case"bottom-left":f=7-m;break;case"bottom":f=7-l;break;case"top":f=l-7}switch(r){case"top-right":case"bottom-right":h=-m;break;case"top-left":case"bottom-left":h=m;break;case"left":h=l;break;case"right":h=-l}return[h,f]}(i,e[0])}function c0(i,e,r){var l;const h=i.layout,f=(l=h.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},r);if(f){const v=f.values,T=[];for(let S=0;S<v.length;S+=2){const A=T[S]=v[S],M=v[S+1].map(D=>D*ni);A.startsWith("top")?M[1]-=7:A.startsWith("bottom")&&(M[1]+=7),T[S+1]=M}return new Qr(T)}const m=h.get("text-variable-anchor");if(m){let v;v=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},r)*ni,dg]:h.get("text-offset").evaluate(e,{},r).map(S=>S*ni);const T=[];for(const S of m)T.push(S,l0(S,v));return new Qr(T)}return null}function pg(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wE(i,e,r,l,h,f,m,v,T,S,A,M){let D=f.textMaxSize.evaluate(e,{});D===void 0&&(D=m);const z=i.layers[0].layout,V=z.get("icon-offset").evaluate(e,{},A),U=h0(r.horizontal),$=m/24,X=i.tilePixelRatio*$,ae=i.tilePixelRatio*D/24,Y=i.tilePixelRatio*v,J=i.tilePixelRatio*z.get("symbol-spacing"),he=z.get("text-padding")*i.tilePixelRatio,ye=function(_t,bt,pt,kt=1){const On=_t.get("icon-padding").evaluate(bt,{},pt),En=On&&On.values;return[En[0]*kt,En[1]*kt,En[2]*kt,En[3]*kt]}(z,e,A,i.tilePixelRatio),De=z.get("text-max-angle")/180*Math.PI,Xe=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",$e=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Qe=z.get("symbol-placement"),ut=J/2,et=z.get("icon-text-fit");let Ke;l&&et!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ke=nv(l,r.vertical,et,z.get("icon-text-fit-padding"),V,$)),U&&(l=nv(l,U,et,z.get("icon-text-fit-padding"),V,$)));const Ve=A?M.line.getGranularityForZoomLevel(A.z):1,vt=(_t,bt)=>{bt.x<0||bt.x>=Pt||bt.y<0||bt.y>=Pt||function(pt,kt,On,En,yr,bi,qr,vr,pr,Hn,Sr,Lr,lr,rs,wi,is,Ks,si,Tr,$r,Pr,oi,pa,lo,Zh){const Wa=pt.addToLineVertexArray(kt,On);let Jl,gu,_u,yu,m0=0,g0=0,_0=0,y0=0,bg=-1,wg=-1;const fa={};let v0=Dr("");if(pt.allowVerticalPlacement&&En.vertical){const Pi=vr.layout.get("text-rotate").evaluate(Pr,{},lo)+90;_u=new Up(pr,kt,Hn,Sr,Lr,En.vertical,lr,rs,wi,Pi),qr&&(yu=new Up(pr,kt,Hn,Sr,Lr,qr,Ks,si,wi,Pi))}if(yr){const Pi=vr.layout.get("icon-rotate").evaluate(Pr,{}),Ds=vr.layout.get("icon-text-fit")!=="none",ec=o0(yr,Pi,pa,Ds),uo=qr?o0(qr,Pi,pa,Ds):void 0;gu=new Up(pr,kt,Hn,Sr,Lr,yr,Ks,si,!1,Pi),m0=4*ec.length;const tc=pt.iconSizeData;let Lo=null;tc.kind==="source"?(Lo=[ha*vr.layout.get("icon-size").evaluate(Pr,{})],Lo[0]>$a&&Nt(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):tc.kind==="composite"&&(Lo=[ha*oi.compositeIconSizes[0].evaluate(Pr,{},lo),ha*oi.compositeIconSizes[1].evaluate(Pr,{},lo)],(Lo[0]>$a||Lo[1]>$a)&&Nt(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,ec,Lo,$r,Tr,Pr,x.az.none,kt,Wa.lineStartIndex,Wa.lineLength,-1,lo),bg=pt.icon.placedSymbolArray.length-1,uo&&(g0=4*uo.length,pt.addSymbols(pt.icon,uo,Lo,$r,Tr,Pr,x.az.vertical,kt,Wa.lineStartIndex,Wa.lineLength,-1,lo),wg=pt.icon.placedSymbolArray.length-1)}const x0=Object.keys(En.horizontal);for(const Pi of x0){const Ds=En.horizontal[Pi];if(!Jl){v0=Dr(Ds.text);const uo=vr.layout.get("text-rotate").evaluate(Pr,{},lo);Jl=new Up(pr,kt,Hn,Sr,Lr,Ds,lr,rs,wi,uo)}const ec=Ds.positionedLines.length===1;if(_0+=u0(pt,kt,Ds,bi,vr,wi,Pr,is,Wa,En.vertical?x.az.horizontal:x.az.horizontalOnly,ec?x0:[Pi],fa,bg,oi,lo),ec)break}En.vertical&&(y0+=u0(pt,kt,En.vertical,bi,vr,wi,Pr,is,Wa,x.az.vertical,["vertical"],fa,wg,oi,lo));const IE=Jl?Jl.boxStartIndex:pt.collisionBoxArray.length,SE=Jl?Jl.boxEndIndex:pt.collisionBoxArray.length,PE=_u?_u.boxStartIndex:pt.collisionBoxArray.length,AE=_u?_u.boxEndIndex:pt.collisionBoxArray.length,CE=gu?gu.boxStartIndex:pt.collisionBoxArray.length,ME=gu?gu.boxEndIndex:pt.collisionBoxArray.length,RE=yu?yu.boxStartIndex:pt.collisionBoxArray.length,kE=yu?yu.boxEndIndex:pt.collisionBoxArray.length;let co=-1;const qp=(Pi,Ds)=>Pi&&Pi.circleDiameter?Math.max(Pi.circleDiameter,Ds):Ds;co=qp(Jl,co),co=qp(_u,co),co=qp(gu,co),co=qp(yu,co);const b0=co>-1?1:0;b0&&(co*=Zh/ni),pt.glyphOffsetArray.length>=cu.MAX_GLYPHS&&Nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pr.sortKey!==void 0&&pt.addToSortKeyRanges(pt.symbolInstances.length,Pr.sortKey);const DE=c0(vr,Pr,lo),[LE,zE]=function(Pi,Ds){const ec=Pi.length,uo=Ds==null?void 0:Ds.values;if((uo==null?void 0:uo.length)>0)for(let tc=0;tc<uo.length;tc+=2){const Lo=uo[tc+1];Pi.emplaceBack(x.aP[uo[tc]],Lo[0],Lo[1])}return[ec,Pi.length]}(pt.textAnchorOffsets,DE);pt.symbolInstances.emplaceBack(kt.x,kt.y,fa.right>=0?fa.right:-1,fa.center>=0?fa.center:-1,fa.left>=0?fa.left:-1,fa.vertical||-1,bg,wg,v0,IE,SE,PE,AE,CE,ME,RE,kE,Hn,_0,y0,m0,g0,b0,0,lr,co,LE,zE)}(i,bt,_t,r,l,h,Ke,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,X,[he,he,he,he],Xe,T,Y,ye,$e,V,e,f,S,A,m)};if(Qe==="line")for(const _t of Qv(e.geometry,0,0,Pt,Pt)){const bt=Kl(_t,Ve),pt=yE(bt,J,De,r.vertical||U,l,24,ae,i.overscaling,Pt);for(const kt of pt)U&&TE(i,U.text,ut,kt)||vt(bt,kt)}else if(Qe==="line-center"){for(const _t of e.geometry)if(_t.length>1){const bt=Kl(_t,Ve),pt=_E(bt,De,r.vertical||U,l,24,ae);pt&&vt(bt,pt)}}else if(e.type==="Polygon")for(const _t of Tc(e.geometry,0)){const bt=xE(_t,16);vt(Kl(_t[0],Ve,!0),new Za(bt.x,bt.y,0))}else if(e.type==="LineString")for(const _t of e.geometry){const bt=Kl(_t,Ve);vt(bt,new Za(bt[0].x,bt[0].y,0))}else if(e.type==="Point")for(const _t of e.geometry)for(const bt of _t)vt([bt],new Za(bt.x,bt.y,0))}function u0(i,e,r,l,h,f,m,v,T,S,A,M,D,z,V){const U=function(ae,Y,J,he,ye,De,Xe,$e){const Qe=he.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,ut=[];for(const et of Y.positionedLines)for(const Ke of et.positionedGlyphs){if(!Ke.rect)continue;const Ve=Ke.rect||{};let vt=4,_t=!0,bt=1,pt=0;const kt=(ye||$e)&&Ke.vertical,On=Ke.metrics.advance*Ke.scale/2;if($e&&Y.verticalizable&&(pt=et.lineOffset/2-(Ke.imageName?-(ni-Ke.metrics.width*Ke.scale)/2:(Ke.scale-1)*ni)),Ke.imageName){const si=Xe[Ke.imageName];_t=si.sdf,bt=si.pixelRatio,vt=1/bt}const En=ye?[Ke.x+On,Ke.y]:[0,0];let yr=ye?[0,0]:[Ke.x+On+J[0],Ke.y+J[1]-pt],bi=[0,0];kt&&(bi=yr,yr=[0,0]);const qr=Ke.metrics.isDoubleResolution?2:1,vr=(Ke.metrics.left-vt)*Ke.scale-On+yr[0],pr=(-Ke.metrics.top-vt)*Ke.scale+yr[1],Hn=vr+Ve.w/qr*Ke.scale/bt,Sr=pr+Ve.h/qr*Ke.scale/bt,Lr=new R(vr,pr),lr=new R(Hn,pr),rs=new R(vr,Sr),wi=new R(Hn,Sr);if(kt){const si=new R(-On,On- -17),Tr=-Math.PI/2,$r=12-On,Pr=new R(22-$r,-(Ke.imageName?$r:0)),oi=new R(...bi);Lr._rotateAround(Tr,si)._add(Pr)._add(oi),lr._rotateAround(Tr,si)._add(Pr)._add(oi),rs._rotateAround(Tr,si)._add(Pr)._add(oi),wi._rotateAround(Tr,si)._add(Pr)._add(oi)}if(Qe){const si=Math.sin(Qe),Tr=Math.cos(Qe),$r=[Tr,-si,si,Tr];Lr._matMult($r),lr._matMult($r),rs._matMult($r),wi._matMult($r)}const is=new R(0,0),Ks=new R(0,0);ut.push({tl:Lr,tr:lr,bl:rs,br:wi,tex:Ve,writingMode:Y.writingMode,glyphOffset:En,sectionIndex:Ke.sectionIndex,isSDF:_t,pixelOffsetTL:is,pixelOffsetBR:Ks,minFontScaleX:0,minFontScaleY:0})}return ut}(0,r,v,h,f,m,l,i.allowVerticalPlacement),$=i.textSizeData;let X=null;$.kind==="source"?(X=[ha*h.layout.get("text-size").evaluate(m,{})],X[0]>$a&&Nt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):$.kind==="composite"&&(X=[ha*z.compositeTextSizes[0].evaluate(m,{},V),ha*z.compositeTextSizes[1].evaluate(m,{},V)],(X[0]>$a||X[1]>$a)&&Nt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,U,X,v,f,m,S,e,T.lineStartIndex,T.lineLength,D,V);for(const ae of A)M[ae]=i.text.placedSymbolArray.length-1;return 4*U.length}function h0(i){for(const e in i)return i[e];return null}function TE(i,e,r,l){const h=i.compareText;if(e in h){const f=h[e];for(let m=f.length-1;m>=0;m--)if(l.dist(f[m])<r)return!0}else h[e]=[];return h[e].push(l),!1}const d0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class fg{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const f=d0[15&l];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new fg(v,m,f,e)}constructor(e,r=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=d0.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return mg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:v}=this,T=[0,f.length-1,0],S=[];for(;T.length;){const A=T.pop()||0,M=T.pop()||0,D=T.pop()||0;if(M-D<=v){for(let $=D;$<=M;$++){const X=m[2*$],ae=m[2*$+1];X>=e&&X<=l&&ae>=r&&ae<=h&&S.push(f[$])}continue}const z=D+M>>1,V=m[2*z],U=m[2*z+1];V>=e&&V<=l&&U>=r&&U<=h&&S.push(f[z]),(A===0?e<=V:r<=U)&&(T.push(D),T.push(z-1),T.push(1-A)),(A===0?l>=V:h>=U)&&(T.push(z+1),T.push(M),T.push(1-A))}return S}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:m}=this,v=[0,h.length-1,0],T=[],S=l*l;for(;v.length;){const A=v.pop()||0,M=v.pop()||0,D=v.pop()||0;if(M-D<=m){for(let $=D;$<=M;$++)f0(f[2*$],f[2*$+1],e,r)<=S&&T.push(h[$]);continue}const z=D+M>>1,V=f[2*z],U=f[2*z+1];f0(V,U,e,r)<=S&&T.push(h[z]),(A===0?e-l<=V:r-l<=U)&&(v.push(D),v.push(z-1),v.push(1-A)),(A===0?e+l>=V:r+l>=U)&&(v.push(z+1),v.push(M),v.push(1-A))}return T}}function mg(i,e,r,l,h,f){if(h-l<=r)return;const m=l+h>>1;p0(i,e,m,l,h,f),mg(i,e,r,l,m-1,1-f),mg(i,e,r,m+1,h,1-f)}function p0(i,e,r,l,h,f){for(;h>l;){if(h-l>600){const S=h-l+1,A=r-l+1,M=Math.log(S),D=.5*Math.exp(2*M/3),z=.5*Math.sqrt(M*D*(S-D)/S)*(A-S/2<0?-1:1);p0(i,e,r,Math.max(l,Math.floor(r-A*D/S+z)),Math.min(h,Math.floor(r+(S-A)*D/S+z)),f)}const m=e[2*r+f];let v=l,T=h;for(Gh(i,e,l,r),e[2*h+f]>m&&Gh(i,e,l,h);v<T;){for(Gh(i,e,v,T),v++,T--;e[2*v+f]<m;)v++;for(;e[2*T+f]>m;)T--}e[2*l+f]===m?Gh(i,e,l,T):(T++,Gh(i,e,T,h)),T<=r&&(l=T+1),r<=T&&(h=T-1)}}function Gh(i,e,r,l){gg(i,r,l),gg(e,2*r,2*l),gg(e,2*r+1,2*l+1)}function gg(i,e,r){const l=i[e];i[e]=i[r],i[r]=l}function f0(i,e,r,l){const h=i-r,f=e-l;return h*h+f*f}var _g;x.cH=void 0,(_g=x.cH||(x.cH={})).create="create",_g.load="load",_g.fullLoad="fullLoad";let jp=null,Hh=[];const yg=1e3/60,vg="loadTime",xg="fullLoadTime",EE={mark(i){performance.mark(i)},frame(i){const e=i;jp!=null&&Hh.push(e-jp),jp=e},clearMetrics(){jp=null,Hh=[],performance.clearMeasures(vg),performance.clearMeasures(xg);for(const i in x.cH)performance.clearMarks(x.cH[i])},getPerformanceMetrics(){performance.measure(vg,x.cH.create,x.cH.load),performance.measure(xg,x.cH.create,x.cH.fullLoad);const i=performance.getEntriesByName(vg)[0].duration,e=performance.getEntriesByName(xg)[0].duration,r=Hh.length,l=1/(Hh.reduce((f,m)=>f+m,0)/r/1e3),h=Hh.filter(f=>f>yg).reduce((f,m)=>f+(m-yg)/yg,0);return{loadTime:i,fullLoadTime:e,fps:l,percentDroppedFrames:h/(r+h)*100,totalFrames:r}}};x.$=Q,x.A=Ge,x.B=Na,x.C=ei,x.D=St,x.E=zt,x.F=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},x.G=tr,x.H=Jn,x.I=Bm,x.J=op,x.K=function(i){if(Lt==null){const e=i.navigator?i.navigator.userAgent:null;Lt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Lt},x.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new V2(()=>this.process()),this.subscription=_n(this.target,"message",r=>this.receive(r),!1),this.globalScope=Pn(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise((r,l)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=e?_n(e.signal,"abort",()=>{f==null||f.unsubscribe(),delete this.resolveRejects[h];const T={id:h,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},B2):null;this.resolveRejects[h]={resolve:T=>{f==null||f.unsubscribe(),r(T)},reject:T=>{f==null||f.unsubscribe(),l(T)}};const m=[],v=Object.assign(Object.assign({},i),{id:h,sourceMapId:this.mapId,origin:location.origin,data:zl(i.data,m)});this.target.postMessage(v,{transfer:m})})}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const l=this.abortControllers[r];return delete this.abortControllers[r],void(l&&l.abort())}if(Pn(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return c(this,void 0,void 0,function*(){if(e.type==="<response>"){const h=this.resolveRejects[i];return delete this.resolveRejects[i],h?void(e.error?h.reject(Fl(e.error)):h.resolve(Fl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Fl(e.data),l=new AbortController;this.abortControllers[i]=l;try{const h=yield this.messageHandlers[e.type](e.sourceMapId,r,l);this.completeTask(i,null,h)}catch(h){this.completeTask(i,h)}})}completeTask(i,e,r){const l=[];delete this.abortControllers[i];const h={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?zl(e):null,data:zl(r,l)};this.target.postMessage(h,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.M=Se,x.N=function(){var i=new Ge(16);return Ge!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},x.O=function(i,e,r){var l,h,f,m,v,T,S,A,M,D,z,V,U=r[0],$=r[1],X=r[2];return e===i?(i[12]=e[0]*U+e[4]*$+e[8]*X+e[12],i[13]=e[1]*U+e[5]*$+e[9]*X+e[13],i[14]=e[2]*U+e[6]*$+e[10]*X+e[14],i[15]=e[3]*U+e[7]*$+e[11]*X+e[15]):(h=e[1],f=e[2],m=e[3],v=e[4],T=e[5],S=e[6],A=e[7],M=e[8],D=e[9],z=e[10],V=e[11],i[0]=l=e[0],i[1]=h,i[2]=f,i[3]=m,i[4]=v,i[5]=T,i[6]=S,i[7]=A,i[8]=M,i[9]=D,i[10]=z,i[11]=V,i[12]=l*U+v*$+M*X+e[12],i[13]=h*U+T*$+D*X+e[13],i[14]=f*U+S*$+z*X+e[14],i[15]=m*U+A*$+V*X+e[15]),i},x.P=R,x.Q=function(i,e,r){var l=r[0],h=r[1],f=r[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=e[7]*h,i[8]=e[8]*f,i[9]=e[9]*f,i[10]=e[10]*f,i[11]=e[11]*f,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.R=ns,x.S=function(i,e,r){var l=e[0],h=e[1],f=e[2],m=e[3],v=e[4],T=e[5],S=e[6],A=e[7],M=e[8],D=e[9],z=e[10],V=e[11],U=e[12],$=e[13],X=e[14],ae=e[15],Y=r[0],J=r[1],he=r[2],ye=r[3];return i[0]=Y*l+J*v+he*M+ye*U,i[1]=Y*h+J*T+he*D+ye*$,i[2]=Y*f+J*S+he*z+ye*X,i[3]=Y*m+J*A+he*V+ye*ae,i[4]=(Y=r[4])*l+(J=r[5])*v+(he=r[6])*M+(ye=r[7])*U,i[5]=Y*h+J*T+he*D+ye*$,i[6]=Y*f+J*S+he*z+ye*X,i[7]=Y*m+J*A+he*V+ye*ae,i[8]=(Y=r[8])*l+(J=r[9])*v+(he=r[10])*M+(ye=r[11])*U,i[9]=Y*h+J*T+he*D+ye*$,i[10]=Y*f+J*S+he*z+ye*X,i[11]=Y*m+J*A+he*V+ye*ae,i[12]=(Y=r[12])*l+(J=r[13])*v+(he=r[14])*M+(ye=r[15])*U,i[13]=Y*h+J*T+he*D+ye*$,i[14]=Y*f+J*S+he*z+ye*X,i[15]=Y*m+J*A+he*V+ye*ae,i},x.T=Rm,x.U=function(i,e){const r={};for(let l=0;l<e.length;l++){const h=e[l];h in i&&(r[h]=i[h])}return r},x.V=Ga,x.W=Cn,x.X=hv,x.Y=uv,x.Z=de,x._=c,x.a=K,x.a$=Ee,x.a0=qe,x.a1=Mt,x.a2=Rs,x.a3=pv,x.a4=Mp,x.a5=Pt,x.a6=function(i,e,r){if(!i)return e||{};if(!e)return i||{};const l=_v(i),h=_v(e);(function(m,v){v.removeAll&&(m.add.clear(),m.update.clear(),m.remove.clear(),v.remove.clear());for(const T of v.remove)m.add.delete(T),m.update.delete(T);for(const[T,S]of v.update){const A=m.update.get(T);A&&(v.update.set(T,U2(A,S)),m.update.delete(T))}})(l,h);const f={};if((l.removeAll||h.removeAll)&&(f.removeAll=!0),f.remove=new Set([...l.remove,...h.remove]),f.add=new Map([...l.add,...h.add]),f.update=new Map([...l.update,...h.update]),f.remove.size&&f.add.size)for(const m of f.add.keys())f.remove.delete(m);return function(m){const v={};return m.removeAll&&(v.removeAll=m.removeAll),m.remove&&(v.remove=Array.from(m.remove)),m.add&&(v.add=Array.from(m.add.values())),m.update&&(v.update=Array.from(m.update.values())),v}(f)},x.a7=function(i,e){const r=new Map;if(i==null||i.type==null)return r;if(i.type==="Feature"){const l=Km(i,e);return l==null?void 0:(r.set(l,i),r)}if(i.type==="FeatureCollection"){const l=new Set;for(const h of i.features){const f=Km(h,e);if(f==null||l.has(f))return;l.add(f),r.set(f,h)}return r}},x.a8=function(i,e,r){var l,h;const f=[];if(e.removeAll)i.clear();else if(e.remove)for(const m of e.remove){const v=i.get(m);v&&(f.push(v.geometry),i.delete(m))}if(e.add)for(const m of e.add){const v=Km(m,r);if(v==null)continue;const T=i.get(v);T&&f.push(T.geometry),f.push(m.geometry),i.set(v,m)}if(e.update)for(const m of e.update){const v=i.get(m.id);if(!v)continue;const T=!!m.newGeometry,S=m.removeAllProperties||((l=m.removeProperties)===null||l===void 0?void 0:l.length)>0||((h=m.addOrUpdateProperties)===null||h===void 0?void 0:h.length)>0;if(!T&&!S)continue;f.push(v.geometry);const A=Object.assign({},v);if(i.set(m.id,A),T&&(f.push(m.newGeometry),A.geometry=m.newGeometry),S){if(A.properties=m.removeAllProperties?{}:Object.assign({},A.properties||{}),m.removeProperties)for(const M of m.removeProperties)delete A.properties[M];if(m.addOrUpdateProperties)for(const{key:M,value:D}of m.addOrUpdateProperties)A.properties[M]=D}}return f},x.a9=Uh,x.aA=function(i,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:h}){return i.kind==="source"?l/ha:i.kind==="composite"?tr.number(l/ha,h/ha,r):e},x.aB=function(i,e){var r=e[0],l=e[1],h=e[2],f=e[3],m=e[4],v=e[5],T=e[6],S=e[7],A=e[8],M=e[9],D=e[10],z=e[11],V=e[12],U=e[13],$=e[14],X=e[15],ae=r*v-l*m,Y=r*T-h*m,J=r*S-f*m,he=l*T-h*v,ye=l*S-f*v,De=h*S-f*T,Xe=A*U-M*V,$e=A*$-D*V,Qe=A*X-z*V,ut=M*$-D*U,et=M*X-z*U,Ke=D*X-z*$,Ve=ae*Ke-Y*et+J*ut+he*Qe-ye*$e+De*Xe;return Ve?(i[0]=(v*Ke-T*et+S*ut)*(Ve=1/Ve),i[1]=(h*et-l*Ke-f*ut)*Ve,i[2]=(U*De-$*ye+X*he)*Ve,i[3]=(D*ye-M*De-z*he)*Ve,i[4]=(T*Qe-m*Ke-S*$e)*Ve,i[5]=(r*Ke-h*Qe+f*$e)*Ve,i[6]=($*J-V*De-X*Y)*Ve,i[7]=(A*De-D*J+z*Y)*Ve,i[8]=(m*et-v*Qe+S*Xe)*Ve,i[9]=(l*Qe-r*et-f*Xe)*Ve,i[10]=(V*ye-U*J+X*ae)*Ve,i[11]=(M*J-A*ye-z*ae)*Ve,i[12]=(v*$e-m*ut-T*Xe)*Ve,i[13]=(r*ut-l*$e+h*Xe)*Ve,i[14]=(U*Y-V*he-$*ae)*Ve,i[15]=(A*he-M*Y+D*ae)*Ve,i):null},x.aC=$t,x.aD=function(i){var e=i[0],r=i[1];return Math.sqrt(e*e+r*r)},x.aE=function(i){return i[0]=0,i[1]=0,i},x.aF=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i},x.aG=qm,x.aH=Jt,x.aI=function(i,e,r,l){const h=e.y-i.y,f=e.x-i.x,m=l.y-r.y,v=l.x-r.x,T=m*f-v*h;if(T===0)return null;const S=(v*(i.y-r.y)-m*(i.x-r.x))/T;return new R(i.x+S*f,i.y+S*h)},x.aJ=Qv,x.aK=tu,x.aL=function(i){let e=1/0,r=1/0,l=-1/0,h=-1/0;for(const f of i)e=Math.min(e,f.x),r=Math.min(r,f.y),l=Math.max(l,f.x),h=Math.max(h,f.y);return[e,r,l,h]},x.aM=ni,x.aN=zn,x.aO=function(i,e,r,l,h=!1){if(!r[0]&&!r[1])return[0,0];const f=h?l==="map"?-i.bearingInRadians:0:l==="viewport"?i.bearingInRadians:0;if(f){const m=Math.sin(f),v=Math.cos(f);r=[r[0]*v-r[1]*m,r[0]*m+r[1]*v]}return[h?r[0]:zn(e,r[0],i.zoom),h?r[1]:zn(e,r[1],i.zoom)]},x.aQ=jm,x.aR=pg,x.aS=Um,x.aT=fg,x.aU=kr,x.aV=Ep,x.aW=te,x.aX=dt,x.aY=Ne,x.aZ=Xt,x.a_=fv,x.aa=Xl,x.ab=25,x.ac=Wm,x.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const l of i){const h=window.document.createElement("source");Le(l)||(e.crossOrigin="Anonymous"),h.src=l,e.appendChild(h)}})},x.ae=We,x.af=function(){return Sn++},x.ag=p,x.ah=cu,x.ai=$h,x.aj=Sl,x.ak=Do,x.al=vv,x.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,l,h,f)=>{const m=h||f;return e[l]=!m||m.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},x.an=Et,x.ao=85.051129,x.ap=Yt,x.aq=function(i){return Math.pow(2,i)},x.ar=ct,x.as=dv,x.at=function(i){return Math.log(i)/Math.LN2},x.au=function(i){var e=i[0],r=i[1];return e*e+r*r},x.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map(T=>T.canonical.z));let r=1/0,l=-1/0,h=1/0,f=-1/0;const m=[];for(const T of i){const{x:S,y:A,z:M}=T.canonical,D=Math.pow(2,e-M),z=S*D,V=A*D;m.push({id:T,x:z,y:V}),z<r&&(r=z),z>l&&(l=z),V<h&&(h=V),V>f&&(f=V)}const v=new Set;for(const T of m)T.x!==r&&T.x!==l&&T.y!==h&&T.y!==f||v.add(T.id);return v},x.aw=function(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},x.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,r){const l=i.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:e,timeout:void 0};if(r!==void 0&&(h.timeout=setTimeout(()=>{this.remove(i,h)},r)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const r=i.wrapped().key,l=e===void 0?0:this.data[r].indexOf(e),h=this.data[r][l];return this.data[r].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(h.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const r in this.data)for(const l of this.data[r])i(l.value)||e.push(l);for(const r of e)this.remove(r.value.tileID,r)}},x.ay=function(i,e){let r=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:f,maxZoom:m}=i,v=h?Et(Jr.interpolationFactor(h,e,f,m),0,1):0;i.kind==="camera"?l=tr.number(i.minSize,i.maxSize,v):r=v}return{uSizeT:r,uSize:l}},x.b=jt,x.b$=ca,x.b0=ue,x.b1=function(i){var e=new Ge(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},x.b2=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},x.b3=function(i,e){var r=e[0],l=e[1],h=e[2],f=r*r+l*l+h*h;return f>0&&(f=1/Math.sqrt(f)),i[0]=e[0]*f,i[1]=e[1]*f,i[2]=e[2]*f,i},x.b4=be,x.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},x.b6=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},x.b7=xe,x.b8=function(i,e,r){const l=e[0]*r[0]+e[1]*r[1]+e[2]*r[2];return l===0?null:(-(i[0]*r[0]+i[1]*r[1]+i[2]*r[2])-r[3])/l},x.b9=pe,x.bA=function(i,e,r,l){return i[0]=e[0]+r[0]*l,i[1]=e[1]+r[1]*l,i[2]=e[2]+r[2]*l,i},x.bB=Ut,x.bC=function(i,e,r){var l=r[0],h=r[1],f=r[2],m=r[3],v=e[0],T=e[1],S=e[2],A=h*S-f*T,M=f*v-l*S,D=l*T-h*v;return i[0]=v+m*(A+=A)+h*(D+=D)-f*(M+=M),i[1]=T+m*M+f*A-l*D,i[2]=S+m*D+l*M-h*A,i},x.bD=function(i,e,r){const l=function(T){var S=T[3],A=T[4],M=T[5],D=T[6],z=T[7],V=T[8];return T[0]*(V*A-M*z)+T[1]*(-V*S+M*D)+T[2]*(z*S-A*D)}([i[0],i[1],i[2],e[0],e[1],e[2],r[0],r[1],r[2]]);if(l===0)return null;const h=be([],[e[0],e[1],e[2]],[r[0],r[1],r[2]]),f=be([],[r[0],r[1],r[2]],[i[0],i[1],i[2]]),m=be([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),v=Ee([],h,-i[3]);return ue(v,v,Ee([],f,-e[3])),ue(v,v,Ee([],m,-r[3])),Ee(v,v,1/l),v},x.bE=Zm,x.bF=function(){return new Float64Array(4)},x.bG=function(i,e,r,l){var h=[],f=[];return h[0]=e[0]-r[0],h[1]=e[1]-r[1],h[2]=e[2]-r[2],f[0]=h[0]*Math.cos(l)-h[1]*Math.sin(l),f[1]=h[0]*Math.sin(l)+h[1]*Math.cos(l),f[2]=h[2],i[0]=f[0]+r[0],i[1]=f[1]+r[1],i[2]=f[2]+r[2],i},x.bH=function(i,e,r,l){var h=[],f=[];return h[0]=e[0]-r[0],h[1]=e[1]-r[1],h[2]=e[2]-r[2],f[0]=h[0],f[1]=h[1]*Math.cos(l)-h[2]*Math.sin(l),f[2]=h[1]*Math.sin(l)+h[2]*Math.cos(l),i[0]=f[0]+r[0],i[1]=f[1]+r[1],i[2]=f[2]+r[2],i},x.bI=function(i,e,r,l){var h=[],f=[];return h[0]=e[0]-r[0],h[1]=e[1]-r[1],h[2]=e[2]-r[2],f[0]=h[2]*Math.sin(l)+h[0]*Math.cos(l),f[1]=h[1],f[2]=h[2]*Math.cos(l)-h[0]*Math.sin(l),i[0]=f[0]+r[0],i[1]=f[1]+r[1],i[2]=f[2]+r[2],i},x.bJ=function(i,e,r){var l=Math.sin(r),h=Math.cos(r),f=e[0],m=e[1],v=e[2],T=e[3],S=e[8],A=e[9],M=e[10],D=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=f*h-S*l,i[1]=m*h-A*l,i[2]=v*h-M*l,i[3]=T*h-D*l,i[8]=f*l+S*h,i[9]=m*l+A*h,i[10]=v*l+M*h,i[11]=T*l+D*h,i},x.bK=function(i,e){const r=on(i,360),l=on(e,360),h=l-r,f=l>r?h-360:h+360;return Math.abs(h)<Math.abs(f)?h:f},x.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},x.bM=function(i,e,r,l){const h=Math.sqrt(i*i+e*e),f=Math.sqrt(r*r+l*l);i/=h,e/=h,r/=f,l/=f;const m=Math.acos(i*r+e*l);return-e*r+i*l>0?m:-m},x.bN=function(i,e){const r=on(i,2*Math.PI),l=on(e,2*Math.PI);return Math.min(Math.abs(r-l),Math.abs(r-l+2*Math.PI),Math.abs(r-l-2*Math.PI))},x.bO=function(){const i={},e=Ce.$version;for(const r in Ce.$root){const l=Ce.$root[r];if(l.required){let h=null;h=r==="version"?e:l.type==="array"?[]:{},h!=null&&(i[r]=h)}}return i},x.bP=Me,x.bQ=fh,x.bR=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let l=0;l<e.length;l++)if(!i(e[l],r[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const l in e)if(!i(e[l],r[l]))return!1;return!0}return e===r},x.bS=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Rn(i[r],e[i[r].ref]));return i},x.bT=function(i,e){if(i.type==="custom")return new N2(i,e);switch(i.type){case"background":return new O2(i,e);case"circle":return new bT(i,e);case"color-relief":return new PT(i,e);case"fill":return new jT(i,e);case"fill-extrusion":return new e2(i,e);case"heatmap":return new TT(i,e);case"hillshade":return new IT(i,e);case"line":return new a2(i,e);case"raster":return new wm(i,e);case"symbol":return new Cp(i,e)}},x.bU=i=>i.type==="raster",x.bV=Tn,x.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!Rt(i.version,e.version))return[{command:"setStyle",args:[e]}];Rt(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),Rt(i.state,e.state)||r.push({command:"setGlobalState",args:[e.state]}),Rt(i.centerAltitude,e.centerAltitude)||r.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Rt(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),Rt(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),Rt(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),Rt(i.roll,e.roll)||r.push({command:"setRoll",args:[e.roll]}),Rt(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),Rt(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),Rt(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),Rt(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),Rt(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),Rt(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),Rt(i.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const l={},h=[];(function(m,v,T,S){let A;for(A in v=v||{},m=m||{})Object.prototype.hasOwnProperty.call(m,A)&&(Object.prototype.hasOwnProperty.call(v,A)||Tt(A,T,S));for(A in v)Object.prototype.hasOwnProperty.call(v,A)&&(Object.prototype.hasOwnProperty.call(m,A)?Rt(m[A],v[A])||(m[A].type==="geojson"&&v[A].type==="geojson"&&je(m,v,A)?Re(T,{command:"setGeoJSONSourceData",args:[A,v[A].data]}):yt(A,v,T,S)):rt(A,v,T))})(i.sources,e.sources,h,l);const f=[];i.layers&&i.layers.forEach(m=>{"source"in m&&l[m.source]?r.push({command:"removeLayer",args:[m.id]}):f.push(m)}),r=r.concat(h),function(m,v,T){v=v||[];const S=(m=m||[]).map(Nn),A=v.map(Nn),M=m.reduce(cr,{}),D=v.reduce(cr,{}),z=S.slice(),V=Object.create(null);let U,$,X,ae,Y;for(let J=0,he=0;J<S.length;J++)U=S[J],Object.prototype.hasOwnProperty.call(D,U)?he++:(Re(T,{command:"removeLayer",args:[U]}),z.splice(z.indexOf(U,he),1));for(let J=0,he=0;J<A.length;J++)U=A[A.length-1-J],z[z.length-1-J]!==U&&(Object.prototype.hasOwnProperty.call(M,U)?(Re(T,{command:"removeLayer",args:[U]}),z.splice(z.lastIndexOf(U,z.length-he),1)):he++,ae=z[z.length-J],Re(T,{command:"addLayer",args:[D[U],ae]}),z.splice(z.length-J,0,U),V[U]=!0);for(let J=0;J<A.length;J++)if(U=A[J],$=M[U],X=D[U],!V[U]&&!Rt($,X))if(Rt($.source,X.source)&&Rt($["source-layer"],X["source-layer"])&&Rt($.type,X.type)){for(Y in Qt($.layout,X.layout,T,U,null,"setLayoutProperty"),Qt($.paint,X.paint,T,U,null,"setPaintProperty"),Rt($.filter,X.filter)||Re(T,{command:"setFilter",args:[U,X.filter]}),Rt($.minzoom,X.minzoom)&&Rt($.maxzoom,X.maxzoom)||Re(T,{command:"setLayerZoomRange",args:[U,X.minzoom,X.maxzoom]}),$)Object.prototype.hasOwnProperty.call($,Y)&&Y!=="layout"&&Y!=="paint"&&Y!=="filter"&&Y!=="metadata"&&Y!=="minzoom"&&Y!=="maxzoom"&&(Y.indexOf("paint.")===0?Qt($[Y],X[Y],T,U,Y.slice(6),"setPaintProperty"):Rt($[Y],X[Y])||Re(T,{command:"setLayerProperty",args:[U,Y,X[Y]]}));for(Y in X)Object.prototype.hasOwnProperty.call(X,Y)&&!Object.prototype.hasOwnProperty.call($,Y)&&Y!=="layout"&&Y!=="paint"&&Y!=="filter"&&Y!=="metadata"&&Y!=="minzoom"&&Y!=="maxzoom"&&(Y.indexOf("paint.")===0?Qt($[Y],X[Y],T,U,Y.slice(6),"setPaintProperty"):Rt($[Y],X[Y])||Re(T,{command:"setLayerProperty",args:[U,Y,X[Y]]}))}else Re(T,{command:"removeLayer",args:[U]}),ae=z[z.lastIndexOf(U)+1],Re(T,{command:"addLayer",args:[X,ae]})}(f,e.layers,r)}catch(l){console.warn("Unable to compute style diff:",l),r=[{command:"setStyle",args:[e]}]}return r},x.bX=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},x.bY=Kt,x.bZ=or,x.b_=class extends Ni{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},x.ba=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},x.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},x.bc=gv,x.bd=uu,x.be=function(i,e,r,l,h){var f=1/Math.tan(e/2);if(i[0]=f/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0){var m=1/(l-h);i[10]=(h+l)*m,i[14]=2*h*l*m}else i[10]=-1,i[14]=-2*l;return i},x.bf=function(i){var e=new Ge(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},x.bg=function(i,e,r){var l=Math.sin(r),h=Math.cos(r),f=e[0],m=e[1],v=e[2],T=e[3],S=e[4],A=e[5],M=e[6],D=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=f*h+S*l,i[1]=m*h+A*l,i[2]=v*h+M*l,i[3]=T*h+D*l,i[4]=S*h-f*l,i[5]=A*h-m*l,i[6]=M*h-v*l,i[7]=D*h-T*l,i},x.bh=function(i,e,r){var l=Math.sin(r),h=Math.cos(r),f=e[4],m=e[5],v=e[6],T=e[7],S=e[8],A=e[9],M=e[10],D=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=f*h+S*l,i[5]=m*h+A*l,i[6]=v*h+M*l,i[7]=T*h+D*l,i[8]=S*h-f*l,i[9]=A*h-m*l,i[10]=M*h-v*l,i[11]=D*h-T*l,i},x.bi=function(){const i=new Float32Array(16);return ct(i),i},x.bj=function(){const i=new Float64Array(16);return ct(i),i},x.bk=function(){return new Float64Array(16)},x.bl=function(i,e,r){const l=new Float64Array(4);return Ut(l,i,e-90,r),l},x.bm=function(i,e,r,l){var h,f,m,v,T,S=e[0],A=e[1],M=e[2],D=e[3],z=r[0],V=r[1],U=r[2],$=r[3];return(f=S*z+A*V+M*U+D*$)<0&&(f=-f,z=-z,V=-V,U=-U,$=-$),1-f>Ye?(h=Math.acos(f),m=Math.sin(h),v=Math.sin((1-l)*h)/m,T=Math.sin(l*h)/m):(v=1-l,T=l),i[0]=v*S+T*z,i[1]=v*A+T*V,i[2]=v*M+T*U,i[3]=v*D+T*$,i},x.bn=function(i){const e=new Float64Array(9);(function(f,m){var v=m[0],T=m[1],S=m[2],A=m[3],M=v+v,D=T+T,z=S+S,V=v*M,U=T*M,$=T*D,X=S*M,ae=S*D,Y=S*z,J=A*M,he=A*D,ye=A*z;f[0]=1-$-Y,f[3]=U-ye,f[6]=X+he,f[1]=U+ye,f[4]=1-V-Y,f[7]=ae-J,f[2]=X-he,f[5]=ae+J,f[8]=1-V-$})(e,i);const r=Xt(-Math.asin(Et(e[2],-1,1)));let l,h;return Math.hypot(e[5],e[8])<.001?(l=0,h=-Xt(Math.atan2(e[3],e[4]))):(l=Xt(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),h=Xt(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:l,pitch:r+90,bearing:h}},x.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},x.bp=gn,x.bq=la,x.br=ou,x.bs=zh,x.bt=su,x.bu=Ft,x.bv=Gt,x.bw=kn,x.bx=function(i,e,r,l,h){return Ft(l,h,Et((i-e)/(r-e),0,1))},x.by=on,x.bz=function(){return new Float64Array(3)},x.c=ge,x.c$=function(i,e,r,l,h){return c(this,void 0,void 0,function*(){if(qe())try{return yield Mt(i,e,r,l,h)}catch{}return function(f,m,v,T,S){const A=f.width,M=f.height;rn&&dn||(rn=new OffscreenCanvas(A,M),dn=rn.getContext("2d",{willReadFrequently:!0})),rn.width=A,rn.height=M,dn.drawImage(f,0,0,A,M);const D=dn.getImageData(m,v,T,S);return dn.clearRect(0,0,A,M),D.data}(i,e,r,l,h)})},x.c0=class extends Ni{constructor(i,e){super(i,e),this.current=_s}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},x.c1=Zl,x.c2=class extends Ni{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},x.c3=class extends Ni{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},x.c4=ht,x.c5=function(i,e){var r=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=r,i[2]=0,i[3]=-r,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},x.c6=function(i,e,r){var l=e[0],h=e[1],f=e[2];return i[0]=l*r[0]+h*r[3]+f*r[6],i[1]=l*r[1]+h*r[4]+f*r[7],i[2]=l*r[2]+h*r[5]+f*r[8],i},x.c7=function(i,e,r,l,h,f,m){var v=1/(e-r),T=1/(l-h),S=1/(f-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*S,i[11]=0,i[12]=(e+r)*v,i[13]=(h+l)*T,i[14]=(m+f)*S,i[15]=1,i},x.c8=class extends Ni{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let r=0;r<i.length;r++)e[4*r]=i[r].r,e[4*r+1]=i[r].g,e[4*r+2]=i[r].b,e[4*r+3]=i[r].a;this.gl.uniform4fv(this.location,e)}}},x.c9=class extends Ni{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},x.cA=function(i,e){return Ae[e]&&"touches"in i},x.cB=function(i){return Ae[i]||H[i]},x.cC=function(i,e,r){var l=e[0],h=e[1];return i[0]=r[0]*l+r[4]*h+r[12],i[1]=r[1]*l+r[5]*h+r[13],i},x.cD=function(i,e){const{x:r,y:l}=Uh.fromLngLat(e);return!(i<0||i>25||l<0||l>=1||r<0||r>=1)},x.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},x.cF=class extends Wc{},x.cG=EE,x.cI=we,x.cJ=function(i,e){ge.REGISTERED_PROTOCOLS[i]=e},x.cK=function(i){delete ge.REGISTERED_PROTOCOLS[i]},x.cL=function(i,e){const r={};for(let h=0;h<i.length;h++){const f=e&&e[i[h].id]||Kd(i[h]);e&&(e[i[h].id]=f);let m=r[f];m||(m=r[f]=[]),m.push(i[h])}const l=[];for(const h in r)l.push(r[h]);return l},x.cM=xt,x.cN=yv,x.cO=Xv,x.cP=Jy,x.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Pt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,l=e._unevaluatedLayout._values,h={layoutIconSize:l["icon-size"].possiblyEvaluate(new Jn(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Jn(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Jn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:A}=i.bucket.textSizeData;h.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Jn(S),i.canonical),l["text-size"].possiblyEvaluate(new Jn(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:A}=i.bucket.iconSizeData;h.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Jn(S),i.canonical),l["icon-size"].possiblyEvaluate(new Jn(A),i.canonical)]}const f=r.get("text-line-height")*ni,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",v=r.get("text-keep-upright"),T=r.get("text-size");for(const S of i.bucket.features){const A=r.get("text-font").evaluate(S,{},i.canonical).join(","),M=T.evaluate(S,{},i.canonical),D=h.layoutTextSize.evaluate(S,{},i.canonical),z=h.layoutIconSize.evaluate(S,{},i.canonical),V={horizontal:{},vertical:void 0},U=S.text;let $,X=[0,0];if(U){const J=U.toString(),he=r.get("text-letter-spacing").evaluate(S,{},i.canonical)*ni,ye=xm(J)?he:0,De=r.get("text-anchor").evaluate(S,{},i.canonical),Xe=c0(e,S,i.canonical);if(!Xe){const et=r.get("text-radial-offset").evaluate(S,{},i.canonical);X=et?l0(De,[et*ni,dg]):r.get("text-offset").evaluate(S,{},i.canonical).map(Ke=>Ke*ni)}let $e=m?"center":r.get("text-justify").evaluate(S,{},i.canonical);const Qe=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(S,{},i.canonical)*ni:1/0,ut=()=>{i.bucket.allowVerticalPlacement&&Ua(J)&&(V.vertical=Pp(U,i.glyphMap,i.glyphPositions,i.imagePositions,A,Qe,f,De,"left",ye,X,x.az.vertical,!0,D,M))};if(!m&&Xe){const et=new Set;if($e==="auto")for(let Ve=0;Ve<Xe.values.length;Ve+=2)et.add(pg(Xe.values[Ve]));else et.add($e);let Ke=!1;for(const Ve of et)if(!V.horizontal[Ve])if(Ke)V.horizontal[Ve]=V.horizontal[0];else{const vt=Pp(U,i.glyphMap,i.glyphPositions,i.imagePositions,A,Qe,f,"center",Ve,ye,X,x.az.horizontal,!1,D,M);vt&&(V.horizontal[Ve]=vt,Ke=vt.positionedLines.length===1)}ut()}else{$e==="auto"&&($e=pg(De));const et=Pp(U,i.glyphMap,i.glyphPositions,i.imagePositions,A,Qe,f,De,$e,ye,X,x.az.horizontal,!1,D,M);et&&(V.horizontal[$e]=et),ut(),Ua(J)&&m&&v&&(V.vertical=Pp(U,i.glyphMap,i.glyphPositions,i.imagePositions,A,Qe,f,De,$e,ye,X,x.az.vertical,!1,D,M))}}let ae=!1;if(S.icon&&S.icon.name){const J=i.imageMap[S.icon.name];J&&($=D2(i.imagePositions[S.icon.name],r.get("icon-offset").evaluate(S,{},i.canonical),r.get("icon-anchor").evaluate(S,{},i.canonical)),ae=!!J.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ae:i.bucket.sdfIcons!==ae&&Nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(J.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Y=h0(V.horizontal)||V.vertical;i.bucket.iconsInText=!!Y&&Y.iconsInText,(Y||$)&&wE(i.bucket,S,V,$,i.imageMap,h,D,z,X,ae,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},x.cR=zm,x.cS=Om,x.cT=Nm,x.cU=function(i){const e=new Sp;return function(r,l){for(const h in r.layers)l.writeMessage(3,lE,r.layers[h])}(i,e),e.finish()},x.cV=function(i,e,r,l,h,f){let m=Jv(i,e,r,h,0);return m=Jv(m,e,l,f,1),m},x.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const r=this.map.keys().next().value;this.map.delete(r)}this.map.set(i,e)}clear(){this.map.clear()}},x.cX=zy,x.cY=Sp,x.cZ=Wv,x.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},x.ca=class extends oa{},x.cb=h2,x.cc=class extends Hl{},x.cd=Mm,x.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},x.cf=xy,x.cg=function(i,e,r){var l=e[0],h=e[1],f=e[2],m=r[3]*l+r[7]*h+r[11]*f+r[15];return i[0]=(r[0]*l+r[4]*h+r[8]*f+r[12])/(m=m||1),i[1]=(r[1]*l+r[5]*h+r[9]*f+r[13])/m,i[2]=(r[2]*l+r[6]*h+r[10]*f+r[14])/m,i},x.ch=class extends bh{},x.ci=class extends t{},x.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},x.ck=function(i,e){var r=i[0],l=i[1],h=i[2],f=i[3],m=i[4],v=i[5],T=i[6],S=i[7],A=i[8],M=i[9],D=i[10],z=i[11],V=i[12],U=i[13],$=i[14],X=i[15],ae=e[0],Y=e[1],J=e[2],he=e[3],ye=e[4],De=e[5],Xe=e[6],$e=e[7],Qe=e[8],ut=e[9],et=e[10],Ke=e[11],Ve=e[12],vt=e[13],_t=e[14],bt=e[15];return Math.abs(r-ae)<=Ye*Math.max(1,Math.abs(r),Math.abs(ae))&&Math.abs(l-Y)<=Ye*Math.max(1,Math.abs(l),Math.abs(Y))&&Math.abs(h-J)<=Ye*Math.max(1,Math.abs(h),Math.abs(J))&&Math.abs(f-he)<=Ye*Math.max(1,Math.abs(f),Math.abs(he))&&Math.abs(m-ye)<=Ye*Math.max(1,Math.abs(m),Math.abs(ye))&&Math.abs(v-De)<=Ye*Math.max(1,Math.abs(v),Math.abs(De))&&Math.abs(T-Xe)<=Ye*Math.max(1,Math.abs(T),Math.abs(Xe))&&Math.abs(S-$e)<=Ye*Math.max(1,Math.abs(S),Math.abs($e))&&Math.abs(A-Qe)<=Ye*Math.max(1,Math.abs(A),Math.abs(Qe))&&Math.abs(M-ut)<=Ye*Math.max(1,Math.abs(M),Math.abs(ut))&&Math.abs(D-et)<=Ye*Math.max(1,Math.abs(D),Math.abs(et))&&Math.abs(z-Ke)<=Ye*Math.max(1,Math.abs(z),Math.abs(Ke))&&Math.abs(V-Ve)<=Ye*Math.max(1,Math.abs(V),Math.abs(Ve))&&Math.abs(U-vt)<=Ye*Math.max(1,Math.abs(U),Math.abs(vt))&&Math.abs($-_t)<=Ye*Math.max(1,Math.abs($),Math.abs(_t))&&Math.abs(X-bt)<=Ye*Math.max(1,Math.abs(X),Math.abs(bt))},x.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.cm=i=>i.type==="symbol",x.cn=i=>i.type==="circle",x.co=i=>i.type==="heatmap",x.cp=i=>i.type==="line",x.cq=i=>i.type==="fill",x.cr=i=>i.type==="fill-extrusion",x.cs=i=>i.type==="hillshade",x.ct=i=>i.type==="color-relief",x.cu=i=>i.type==="background",x.cv=i=>i.type==="custom",x.cw=Mn,x.cx=function(i,e,r){const l=mn(e.x-r.x,e.y-r.y),h=mn(i.x-r.x,i.y-r.y),f=Math.atan2(l[0]*h[1]-l[1]*h[0],function(m,v){return m[0]*v[0]+m[1]*v[1]}(l,h));return Xt(f)},x.cy=wt,x.cz=function(i,e){return H[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},x.d=Le,x.d0=Ty,x.d1=B,x.d2=class{constructor(i,e){this.layers={[$h]:this},this.name=$h,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new aE(this.features[i],this.extent)}},x.d3=Il,x.d4=Co,x.e=Wt,x.f=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),x.g=N,x.h=i=>new Promise((e,r)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=Vt})},l.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(h):Vt}),x.i=Pn,x.j=(i,e)=>He(Wt(i,{type:"json"}),e),x.k=Ht,x.l=It,x.m=He,x.n=(i,e)=>He(Wt(i,{type:"arrayBuffer"}),e),x.o=function(i){return new Sp(i).readFields(I2,[])},x.p=Qy,x.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},x.r=Mh,x.s=_n,x.t=Si,x.u=Ce,x.v=Dl,x.w=Nt,x.x=vh,x.y=Ll,x.z=Nl}),g("worker",["./shared"],function(x){class c{constructor(H,G){this.keyCache={},H&&this.replace(H,G)}replace(H,G){this._layerConfigs={},this._layers={},this.update(H,[],G)}update(H,G,K){for(const ge of H){this._layerConfigs[ge.id]=ge;const N=this._layers[ge.id]=x.bT(ge,K);N._featureFilter=x.aj(N.filter,K),this.keyCache[ge.id]&&delete this.keyCache[ge.id]}for(const ge of G)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const de=x.cL(Object.values(this._layerConfigs),this.keyCache);for(const ge of de){const N=ge.map(tt=>this._layers[tt.id]),Se=N[0];if(Se.isHidden())continue;const we=Se.source||"";let Me=this.familiesBySource[we];Me||(Me=this.familiesBySource[we]={});const He=Se.sourceLayer||x.ai;let Le=Me[He];Le||(Le=Me[He]=[]),Le.push(N)}}}class R{constructor(H){const G={},K=[];for(const Se in H){const we=H[Se],Me=G[Se]={};for(const He in we){const Le=we[+He];if(!Le||Le.bitmap.width===0||Le.bitmap.height===0)continue;const tt={x:0,y:0,w:Le.bitmap.width+2,h:Le.bitmap.height+2};K.push(tt),Me[He]={rect:tt,metrics:Le.metrics}}}const{w:de,h:ge}=x.p(K),N=new x.r({width:de||1,height:ge||1});for(const Se in H){const we=H[Se];for(const Me in we){const He=we[+Me];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const Le=G[Se][Me].rect;x.r.copy(He.bitmap,N,{x:0,y:0},{x:Le.x+1,y:Le.y+1},He.bitmap)}}this.image=N,this.positions=G}}x.cM("GlyphAtlas",R);class B{constructor(H){this.tileID=new x.a2(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[]}parse(H,G,K,de,ge){return x._(this,void 0,void 0,function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new x.ag;const N=new x.cN(Object.keys(H.layers).sort()),Se=new x.cO(this.tileID,this.promoteId);Se.bucketLayerIDs=[];const we={},Me={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:K,subdivisionGranularity:ge},He=G.familiesBySource[this.source];for(const je in He){const Qt=H.layers[je];if(!Qt)continue;Qt.version===1&&x.w(`Vector tile source "${this.source}" layer "${je}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Nn=N.encode(je),cr=[];for(let We=0;We<Qt.length;We++){const xr=Qt.feature(We),Yn=Se.getId(xr,je);cr.push({feature:xr,id:Yn,index:We,sourceLayerIndex:Nn})}for(const We of He[je]){const xr=We[0];xr.source!==this.source&&x.w(`layer.source = ${xr.source} does not equal this.source = ${this.source}`),xr.isHidden(this.zoom,!0)||(W(We,this.zoom,K),(we[xr.id]=xr.createBucket({index:Se.bucketLayerIDs.length,layers:We,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Nn,sourceID:this.source})).populate(cr,Me,this.tileID.canonical),Se.bucketLayerIDs.push(We.map(Yn=>Yn.id)))}}const Le=x.bY(Me.glyphDependencies,je=>Object.keys(je).map(Number));this.inFlightDependencies.forEach(je=>je==null?void 0:je.abort()),this.inFlightDependencies=[];let tt=Promise.resolve({});if(Object.keys(Le).length){const je=new AbortController;this.inFlightDependencies.push(je),tt=de.sendAsync({type:"GG",data:{stacks:Le,source:this.source,tileID:this.tileID,type:"glyphs"}},je)}const gt=Object.keys(Me.iconDependencies);let It=Promise.resolve({});if(gt.length){const je=new AbortController;this.inFlightDependencies.push(je),It=de.sendAsync({type:"GI",data:{icons:gt,source:this.source,tileID:this.tileID,type:"icons"}},je)}const Ht=Object.keys(Me.patternDependencies);let zt=Promise.resolve({});if(Ht.length){const je=new AbortController;this.inFlightDependencies.push(je),zt=de.sendAsync({type:"GI",data:{icons:Ht,source:this.source,tileID:this.tileID,type:"patterns"}},je)}const Ce=Me.dashDependencies;let tn=Promise.resolve({});if(Object.keys(Ce).length){const je=new AbortController;this.inFlightDependencies.push(je),tn=de.sendAsync({type:"GDA",data:{dashes:Ce}},je)}const[Rn,Rt,Re,rt]=yield Promise.all([tt,It,zt,tn]),Tt=new R(Rn),yt=new x.cP(Rt,Re);for(const je in we){const Qt=we[je];Qt instanceof x.ah?(W(Qt.layers,this.zoom,K),x.cQ({bucket:Qt,glyphMap:Rn,glyphPositions:Tt.positions,imageMap:Rt,imagePositions:yt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Me.subdivisionGranularity})):Qt.hasDependencies&&(Qt instanceof x.cR||Qt instanceof x.cS||Qt instanceof x.cT)&&(W(Qt.layers,this.zoom,K),Qt.addFeatures(Me,this.tileID.canonical,yt.patternPositions,rt))}return this.status="done",{buckets:Object.values(we).filter(je=>!je.isEmpty()),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Tt.image,imageAtlas:yt,dashPositions:rt,glyphMap:this.returnDependencies?Rn:null,iconMap:this.returnDependencies?Rt:null,glyphPositions:this.returnDependencies?Tt.positions:null}})}}function W(Ae,H,G){const K=new x.H(H);for(const de of Ae)de.recalculate(K,G)}class ee{constructor(H,G,K,de,ge){this.type=H,this.properties=K||{},this.extent=ge,this.pointsArray=G,this.id=de}loadGeometry(){return this.pointsArray.map(H=>H.map(G=>new x.P(G.x,G.y)))}}class ce{constructor(H,G,K){this.version=2,this._myFeatures=H,this.name=G,this.length=H.length,this.extent=K}feature(H){return this._myFeatures[H]}}class Ie{constructor(){this.layers={}}addLayer(H){this.layers[H.name]=H}}function Ue(Ae){let H=x.cU(Ae);return H.byteOffset===0&&H.byteLength===H.buffer.byteLength||(H=new Uint8Array(H)),{vectorTile:Ae,rawData:H.buffer}}function ke(Ae,H,G){const{extent:K}=Ae,de=Math.pow(2,G.z-H.z),ge=(G.x-H.x*de)*K,N=(G.y-H.y*de)*K,Se=[];for(let we=0;we<Ae.length;we++){const Me=Ae.feature(we);let He=Me.loadGeometry();for(const tt of He)for(const gt of tt)gt.x=gt.x*de-ge,gt.y=gt.y*de-N;const Le=128;He=x.cV(He,Me.type,-Le,-Le,K+Le,K+Le),He.length!==0&&Se.push(new ee(Me.type,He,Me.properties,Me.id,K))}return new ce(Se,Ae.name,K)}class Q{constructor(H,G,K){this.actor=H,this.layerIndex=G,this.availableImages=K,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new x.cW(1e3)}loadVectorTile(H,G){return x._(this,void 0,void 0,function*(){const K=yield x.n(H.request,G);try{return{vectorTile:H.encoding!=="mlt"?new x.cX(new x.cY(K.data)):new x.cZ(K.data),rawData:K.data,cacheControl:K.cacheControl,expires:K.expires}}catch(de){const ge=new Uint8Array(K.data);let N=`Unable to parse the tile at ${H.request.url}, `;throw N+=ge[0]===31&&ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.message}`,new Error(N)}})}loadTile(H){return x._(this,void 0,void 0,function*(){const{uid:G,overzoomParameters:K}=H;K&&(H.request=K.overzoomRequest);const de=!!(H&&H.request&&H.request.collectResourceTiming)&&new x.c_(H.request),ge=new B(H);this.loading[G]=ge;const N=new AbortController;ge.abort=N;try{const Se=yield this.loadVectorTile(H,N);if(delete this.loading[G],!Se)return null;if(K){const tt=this._getOverzoomTile(H,Se.vectorTile);Se.rawData=tt.rawData,Se.vectorTile=tt.vectorTile}const we=Se.rawData,Me={};Se.expires&&(Me.expires=Se.expires),Se.cacheControl&&(Me.cacheControl=Se.cacheControl);const He={};if(de){const tt=de.finish();tt&&(He.resourceTiming=JSON.parse(JSON.stringify(tt)))}ge.vectorTile=Se.vectorTile;const Le=ge.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);this.loaded[G]=ge,this.fetching[G]={rawTileData:we,cacheControl:Me,resourceTiming:He};try{const tt=yield Le;return x.e({rawTileData:we.slice(0),encoding:H.encoding},tt,Me,He)}finally{delete this.fetching[G]}}catch(Se){throw delete this.loading[G],ge.status="done",this.loaded[G]=ge,Se}})}_getOverzoomTile(H,G){const{tileID:K,source:de,overzoomParameters:ge}=H,{maxZoomTileID:N}=ge,Se=`${N.key}_${K.key}`,we=this.overzoomedTileResultCache.get(Se);if(we)return we;const Me=new Ie,He=this.layerIndex.familiesBySource[de];for(const tt in He){const gt=G.layers[tt];if(!gt)continue;const It=ke(gt,N,K.canonical);It.length>0&&Me.addLayer(It)}const Le=Ue(Me);return this.overzoomedTileResultCache.set(Se,Le),Le}reloadTile(H){return x._(this,void 0,void 0,function*(){const G=H.uid;if(!this.loaded||!this.loaded[G])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const K=this.loaded[G];if(K.showCollisionBoxes=H.showCollisionBoxes,K.status==="parsing"){const de=yield K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);let ge;if(this.fetching[G]){const{rawTileData:N,cacheControl:Se,resourceTiming:we}=this.fetching[G];delete this.fetching[G],ge=x.e({rawTileData:N.slice(0),encoding:H.encoding},de,Se,we)}else ge=de;return ge}if(K.status==="done"&&K.vectorTile)return K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity)})}abortTile(H){return x._(this,void 0,void 0,function*(){const G=this.loading,K=H.uid;G&&G[K]&&G[K].abort&&(G[K].abort.abort(),delete G[K])})}removeTile(H){return x._(this,void 0,void 0,function*(){this.loaded&&this.loaded[H.uid]&&delete this.loaded[H.uid]})}}class qe{constructor(){this.loaded={}}loadTile(H){return x._(this,void 0,void 0,function*(){const{uid:G,encoding:K,rawImageData:de,redFactor:ge,greenFactor:N,blueFactor:Se,baseShift:we}=H,Me=de.width+2,He=de.height+2,Le=x.b(de)?new x.R({width:Me,height:He},yield x.c$(de,-1,-1,Me,He)):de,tt=new x.d0(G,Le,K,ge,N,Se,we);return this.loaded=this.loaded||{},this.loaded[G]=tt,tt})}removeTile(H){const G=this.loaded,K=H.uid;G&&G[K]&&delete G[K]}}var Ye,Ge,ht=function(){if(Ge)return Ye;function Ae(G,K){if(G.length!==0){H(G[0],K);for(var de=1;de<G.length;de++)H(G[de],!K)}}function H(G,K){for(var de=0,ge=0,N=0,Se=G.length,we=Se-1;N<Se;we=N++){var Me=(G[N][0]-G[we][0])*(G[we][1]+G[N][1]),He=de+Me;ge+=Math.abs(de)>=Math.abs(Me)?de-He+Me:Me-He+de,de=He}de+ge>=0!=!!K&&G.reverse()}return Ge=1,Ye=function G(K,de){var ge,N=K&&K.type;if(N==="FeatureCollection")for(ge=0;ge<K.features.length;ge++)G(K.features[ge],de);else if(N==="GeometryCollection")for(ge=0;ge<K.geometries.length;ge++)G(K.geometries[ge],de);else if(N==="Feature")G(K.geometry,de);else if(N==="Polygon")Ae(K.coordinates,de);else if(N==="MultiPolygon")for(ge=0;ge<K.coordinates.length;ge++)Ae(K.coordinates[ge],de);return K}}(),ct=x.d1(ht);const ot={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},xe=Math.fround||(se=new Float32Array(1),Ae=>(se[0]=+Ae,se[0]));var se;class ue{constructor(H){this.options=Object.assign(Object.create(ot),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:G,minZoom:K,maxZoom:de}=this.options;G&&console.time("total time");const ge=`prepare ${H.length} points`;G&&console.time(ge),this.points=H;const N=[];for(let we=0;we<H.length;we++){const Me=H[we];if(!Me.geometry)continue;const[He,Le]=Me.geometry.coordinates,tt=xe(fe(He)),gt=xe(pe(Le));N.push(tt,gt,1/0,we,-1,1),this.options.reduce&&N.push(0)}let Se=this.trees[de+1]=this._createTree(N);G&&console.timeEnd(ge);for(let we=de;we>=K;we--){const Me=+Date.now();Se=this.trees[we]=this._createTree(this._cluster(Se,we)),G&&console.log("z%d: %d clusters in %dms",we,Se.numItems,+Date.now()-Me)}return G&&console.timeEnd("total time"),this}getClusters(H,G){let K=((H[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,H[1]));let ge=H[2]===180?180:((H[2]+180)%360+360)%360-180;const N=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)K=-180,ge=180;else if(K>ge){const Le=this.getClusters([K,de,180,N],G),tt=this.getClusters([-180,de,ge,N],G);return Le.concat(tt)}const Se=this.trees[this._limitZoom(G)],we=Se.range(fe(K),pe(N),fe(ge),pe(de)),Me=Se.data,He=[];for(const Le of we){const tt=this.stride*Le;He.push(Me[tt+5]>1?Ee(Me,tt,this.clusterProps):this.points[Me[tt+3]])}return He}getChildren(H){const G=this._getOriginId(H),K=this._getOriginZoom(H),de="No cluster with the specified id.",ge=this.trees[K];if(!ge)throw new Error(de);const N=ge.data;if(G*this.stride>=N.length)throw new Error(de);const Se=this.options.radius/(this.options.extent*Math.pow(2,K-1)),we=ge.within(N[G*this.stride],N[G*this.stride+1],Se),Me=[];for(const He of we){const Le=He*this.stride;N[Le+4]===H&&Me.push(N[Le+5]>1?Ee(N,Le,this.clusterProps):this.points[N[Le+3]])}if(Me.length===0)throw new Error(de);return Me}getLeaves(H,G,K){const de=[];return this._appendLeaves(de,H,G=G||10,K=K||0,0),de}getTile(H,G,K){const de=this.trees[this._limitZoom(H)],ge=Math.pow(2,H),{extent:N,radius:Se}=this.options,we=Se/N,Me=(K-we)/ge,He=(K+1+we)/ge,Le={features:[]};return this._addTileFeatures(de.range((G-we)/ge,Me,(G+1+we)/ge,He),de.data,G,K,ge,Le),G===0&&this._addTileFeatures(de.range(1-we/ge,Me,1,He),de.data,ge,K,ge,Le),G===ge-1&&this._addTileFeatures(de.range(0,Me,we/ge,He),de.data,-1,K,ge,Le),Le.features.length?Le:null}getClusterExpansionZoom(H){let G=this._getOriginZoom(H)-1;for(;G<=this.options.maxZoom;){const K=this.getChildren(H);if(G++,K.length!==1)break;H=K[0].properties.cluster_id}return G}_appendLeaves(H,G,K,de,ge){const N=this.getChildren(G);for(const Se of N){const we=Se.properties;if(we&&we.cluster?ge+we.point_count<=de?ge+=we.point_count:ge=this._appendLeaves(H,we.cluster_id,K,de,ge):ge<de?ge++:H.push(Se),H.length===K)break}return ge}_createTree(H){const G=new x.aT(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<H.length;K+=this.stride)G.add(H[K],H[K+1]);return G.finish(),G.data=H,G}_addTileFeatures(H,G,K,de,ge,N){for(const Se of H){const we=Se*this.stride,Me=G[we+5]>1;let He,Le,tt;if(Me)He=be(G,we,this.clusterProps),Le=G[we],tt=G[we+1];else{const Ht=this.points[G[we+3]];He=Ht.properties;const[zt,Ce]=Ht.geometry.coordinates;Le=fe(zt),tt=pe(Ce)}const gt={type:1,geometry:[[Math.round(this.options.extent*(Le*ge-K)),Math.round(this.options.extent*(tt*ge-de))]],tags:He};let It;It=Me||this.options.generateId?G[we+3]:this.points[G[we+3]].id,It!==void 0&&(gt.id=It),N.features.push(gt)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,G){const{radius:K,extent:de,reduce:ge,minPoints:N}=this.options,Se=K/(de*Math.pow(2,G)),we=H.data,Me=[],He=this.stride;for(let Le=0;Le<we.length;Le+=He){if(we[Le+2]<=G)continue;we[Le+2]=G;const tt=we[Le],gt=we[Le+1],It=H.within(we[Le],we[Le+1],Se),Ht=we[Le+5];let zt=Ht;for(const Ce of It){const tn=Ce*He;we[tn+2]>G&&(zt+=we[tn+5])}if(zt>Ht&&zt>=N){let Ce,tn=tt*Ht,Rn=gt*Ht,Rt=-1;const Re=(Le/He<<5)+(G+1)+this.points.length;for(const rt of It){const Tt=rt*He;if(we[Tt+2]<=G)continue;we[Tt+2]=G;const yt=we[Tt+5];tn+=we[Tt]*yt,Rn+=we[Tt+1]*yt,we[Tt+4]=Re,ge&&(Ce||(Ce=this._map(we,Le,!0),Rt=this.clusterProps.length,this.clusterProps.push(Ce)),ge(Ce,this._map(we,Tt)))}we[Le+4]=Re,Me.push(tn/zt,Rn/zt,1/0,Re,-1,zt),ge&&Me.push(Rt)}else{for(let Ce=0;Ce<He;Ce++)Me.push(we[Le+Ce]);if(zt>1)for(const Ce of It){const tn=Ce*He;if(!(we[tn+2]<=G)){we[tn+2]=G;for(let Rn=0;Rn<He;Rn++)Me.push(we[tn+Rn])}}}}return Me}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,G,K){if(H[G+5]>1){const N=this.clusterProps[H[G+6]];return K?Object.assign({},N):N}const de=this.points[H[G+3]].properties,ge=this.options.map(de);return K&&ge===de?Object.assign({},ge):ge}}function Ee(Ae,H,G){return{type:"Feature",id:Ae[H+3],properties:be(Ae,H,G),geometry:{type:"Point",coordinates:[(K=Ae[H],360*(K-.5)),Jt(Ae[H+1])]}};var K}function be(Ae,H,G){const K=Ae[H+5],de=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,ge=Ae[H+6],N=ge===-1?{}:Object.assign({},G[ge]);return Object.assign(N,{cluster:!0,cluster_id:Ae[H+3],point_count:K,point_count_abbreviated:de})}function fe(Ae){return Ae/360+.5}function pe(Ae){const H=Math.sin(Ae*Math.PI/180),G=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return G<0?0:G>1?1:G}function Jt(Ae){const H=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function fn(Ae,H,G,K){let de=K;const ge=H+(G-H>>1);let N,Se=G-H;const we=Ae[H],Me=Ae[H+1],He=Ae[G],Le=Ae[G+1];for(let tt=H+3;tt<G;tt+=3){const gt=Ut(Ae[tt],Ae[tt+1],we,Me,He,Le);if(gt>de)N=tt,de=gt;else if(gt===de){const It=Math.abs(tt-ge);It<Se&&(N=tt,Se=It)}}de>K&&(N-H>3&&fn(Ae,H,N,K),Ae[N+2]=de,G-N>3&&fn(Ae,N,G,K))}function Ut(Ae,H,G,K,de,ge){let N=de-G,Se=ge-K;if(N!==0||Se!==0){const we=((Ae-G)*N+(H-K)*Se)/(N*N+Se*Se);we>1?(G=de,K=ge):we>0&&(G+=N*we,K+=Se*we)}return N=Ae-G,Se=H-K,N*N+Se*Se}function $t(Ae,H,G,K){const de={id:Ae??null,type:H,geometry:G,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")mn(de,G);else if(H==="Polygon")mn(de,G[0]);else if(H==="MultiLineString")for(const ge of G)mn(de,ge);else if(H==="MultiPolygon")for(const ge of G)mn(de,ge[0]);return de}function mn(Ae,H){for(let G=0;G<H.length;G+=3)Ae.minX=Math.min(Ae.minX,H[G]),Ae.minY=Math.min(Ae.minY,H[G+1]),Ae.maxX=Math.max(Ae.maxX,H[G]),Ae.maxY=Math.max(Ae.maxY,H[G+1])}function Pt(Ae,H,G,K){if(!H.geometry)return;const de=H.geometry.coordinates;if(de&&de.length===0)return;const ge=H.geometry.type,N=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2);let Se=[],we=H.id;if(G.promoteId?we=H.properties[G.promoteId]:G.generateId&&(we=K||0),ge==="Point")zn(de,Se);else if(ge==="MultiPoint")for(const Me of de)zn(Me,Se);else if(ge==="LineString")on(de,Se,N,!1);else if(ge==="MultiLineString"){if(G.lineMetrics){for(const Me of de)Se=[],on(Me,Se,N,!1),Ae.push($t(we,"LineString",Se,H.properties));return}Ft(de,Se,N,!1)}else if(ge==="Polygon")Ft(de,Se,N,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(const Me of H.geometry.geometries)Pt(Ae,{id:we,geometry:Me,properties:H.properties},G,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Me of de){const He=[];Ft(Me,He,N,!0),Se.push(He)}}Ae.push($t(we,ge,Se,H.properties))}function zn(Ae,H){H.push(Gt(Ae[0]),Mn(Ae[1]),0)}function on(Ae,H,G,K){let de,ge,N=0;for(let we=0;we<Ae.length;we++){const Me=Gt(Ae[we][0]),He=Mn(Ae[we][1]);H.push(Me,He,0),we>0&&(N+=K?(de*He-Me*ge)/2:Math.sqrt(Math.pow(Me-de,2)+Math.pow(He-ge,2))),de=Me,ge=He}const Se=H.length-3;H[2]=1,fn(H,0,Se,G),H[Se+2]=1,H.size=Math.abs(N),H.start=0,H.end=H.size}function Ft(Ae,H,G,K){for(let de=0;de<Ae.length;de++){const ge=[];on(Ae[de],ge,G,K),H.push(ge)}}function Gt(Ae){return Ae/360+.5}function Mn(Ae){const H=Math.sin(Ae*Math.PI/180),G=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return G<0?0:G>1?1:G}function wt(Ae,H,G,K,de,ge,N,Se){if(K/=H,ge>=(G/=H)&&N<K)return Ae;if(N<G||ge>=K)return null;const we=[];for(const Me of Ae){const He=Me.geometry;let Le=Me.type;const tt=de===0?Me.minX:Me.minY,gt=de===0?Me.maxX:Me.maxY;if(tt>=G&&gt<K){we.push(Me);continue}if(gt<G||tt>=K)continue;let It=[];if(Le==="Point"||Le==="MultiPoint")Et(He,It,G,K,de);else if(Le==="LineString")Cn(He,It,G,K,de,!1,Se.lineMetrics);else if(Le==="MultiLineString")Sn(He,It,G,K,de,!1);else if(Le==="Polygon")Sn(He,It,G,K,de,!0);else if(Le==="MultiPolygon")for(const Ht of He){const zt=[];Sn(Ht,zt,G,K,de,!0),zt.length&&It.push(zt)}if(It.length){if(Se.lineMetrics&&Le==="LineString"){for(const Ht of It)we.push($t(Me.id,Le,Ht,Me.tags));continue}Le!=="LineString"&&Le!=="MultiLineString"||(It.length===1?(Le="LineString",It=It[0]):Le="MultiLineString"),Le!=="Point"&&Le!=="MultiPoint"||(Le=It.length===3?"Point":"MultiPoint"),we.push($t(Me.id,Le,It,Me.tags))}}return we.length?we:null}function Et(Ae,H,G,K,de){for(let ge=0;ge<Ae.length;ge+=3){const N=Ae[ge+de];N>=G&&N<=K&&Kt(H,Ae[ge],Ae[ge+1],Ae[ge+2])}}function Cn(Ae,H,G,K,de,ge,N){let Se=Wt(Ae);const we=de===0?or:Tn;let Me,He,Le=Ae.start;for(let zt=0;zt<Ae.length-3;zt+=3){const Ce=Ae[zt],tn=Ae[zt+1],Rn=Ae[zt+2],Rt=Ae[zt+3],Re=Ae[zt+4],rt=de===0?Ce:tn,Tt=de===0?Rt:Re;let yt=!1;N&&(Me=Math.sqrt(Math.pow(Ce-Rt,2)+Math.pow(tn-Re,2))),rt<G?Tt>G&&(He=we(Se,Ce,tn,Rt,Re,G),N&&(Se.start=Le+Me*He)):rt>K?Tt<K&&(He=we(Se,Ce,tn,Rt,Re,K),N&&(Se.start=Le+Me*He)):Kt(Se,Ce,tn,Rn),Tt<G&&rt>=G&&(He=we(Se,Ce,tn,Rt,Re,G),yt=!0),Tt>K&&rt<=K&&(He=we(Se,Ce,tn,Rt,Re,K),yt=!0),!ge&&yt&&(N&&(Se.end=Le+Me*He),H.push(Se),Se=Wt(Ae)),N&&(Le+=Me)}let tt=Ae.length-3;const gt=Ae[tt],It=Ae[tt+1],Ht=de===0?gt:It;Ht>=G&&Ht<=K&&Kt(Se,gt,It,Ae[tt+2]),tt=Se.length-3,ge&&tt>=3&&(Se[tt]!==Se[0]||Se[tt+1]!==Se[1])&&Kt(Se,Se[0],Se[1],Se[2]),Se.length&&H.push(Se)}function Wt(Ae){const H=[];return H.size=Ae.size,H.start=Ae.start,H.end=Ae.end,H}function Sn(Ae,H,G,K,de,ge){for(const N of Ae)Cn(N,H,G,K,de,ge,!1)}function Kt(Ae,H,G,K){Ae.push(H,G,K)}function or(Ae,H,G,K,de,ge){const N=(ge-H)/(K-H);return Kt(Ae,ge,G+(de-G)*N,1),N}function Tn(Ae,H,G,K,de,ge){const N=(ge-G)/(de-G);return Kt(Ae,H+(K-H)*N,ge,1),N}function Dn(Ae,H){const G=[];for(let K=0;K<Ae.length;K++){const de=Ae[K],ge=de.type;let N;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")N=Nt(de.geometry,H);else if(ge==="MultiLineString"||ge==="Polygon"){N=[];for(const Se of de.geometry)N.push(Nt(Se,H))}else if(ge==="MultiPolygon"){N=[];for(const Se of de.geometry){const we=[];for(const Me of Se)we.push(Nt(Me,H));N.push(we)}}G.push($t(de.id,ge,N,de.tags))}return G}function Nt(Ae,H){const G=[];G.size=Ae.size,Ae.start!==void 0&&(G.start=Ae.start,G.end=Ae.end);for(let K=0;K<Ae.length;K+=3)G.push(Ae[K]+H,Ae[K+1],Ae[K+2]);return G}function en(Ae,H){if(Ae.transformed)return Ae;const G=1<<Ae.z,K=Ae.x,de=Ae.y;for(const ge of Ae.features){const N=ge.geometry,Se=ge.type;if(ge.geometry=[],Se===1)for(let we=0;we<N.length;we+=2)ge.geometry.push(Pn(N[we],N[we+1],H,G,K,de));else for(let we=0;we<N.length;we++){const Me=[];for(let He=0;He<N[we].length;He+=2)Me.push(Pn(N[we][He],N[we][He+1],H,G,K,de));ge.geometry.push(Me)}}return Ae.transformed=!0,Ae}function Pn(Ae,H,G,K,de,ge){return[Math.round(G*(Ae*K-de)),Math.round(G*(H*K-ge))]}function Lt(Ae,H,G,K,de){const ge=H===de.maxZoom?0:de.tolerance/((1<<H)*de.extent),N={features:[],numPoints:0,numSimplified:0,numFeatures:Ae.length,source:null,x:G,y:K,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Se of Ae)jt(N,Se,ge,de);return N}function jt(Ae,H,G,K){const de=H.geometry,ge=H.type,N=[];if(Ae.minX=Math.min(Ae.minX,H.minX),Ae.minY=Math.min(Ae.minY,H.minY),Ae.maxX=Math.max(Ae.maxX,H.maxX),Ae.maxY=Math.max(Ae.maxY,H.maxY),ge==="Point"||ge==="MultiPoint")for(let Se=0;Se<de.length;Se+=3)N.push(de[Se],de[Se+1]),Ae.numPoints++,Ae.numSimplified++;else if(ge==="LineString")Vt(N,de,Ae,G,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(let Se=0;Se<de.length;Se++)Vt(N,de[Se],Ae,G,ge==="Polygon",Se===0);else if(ge==="MultiPolygon")for(let Se=0;Se<de.length;Se++){const we=de[Se];for(let Me=0;Me<we.length;Me++)Vt(N,we[Me],Ae,G,!0,Me===0)}if(N.length){let Se=H.tags||null;if(ge==="LineString"&&K.lineMetrics){Se={};for(const Me in H.tags)Se[Me]=H.tags[Me];Se.mapbox_clip_start=de.start/de.size,Se.mapbox_clip_end=de.end/de.size}const we={geometry:N,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:Se};H.id!==null&&(we.id=H.id),Ae.features.push(we)}}function Vt(Ae,H,G,K,de,ge){const N=K*K;if(K>0&&H.size<(de?N:K))return void(G.numPoints+=H.length/3);const Se=[];for(let we=0;we<H.length;we+=3)(K===0||H[we+2]>N)&&(G.numSimplified++,Se.push(H[we],H[we+1])),G.numPoints++;de&&function(we,Me){let He=0;for(let Le=0,tt=we.length,gt=tt-2;Le<tt;gt=Le,Le+=2)He+=(we[Le]-we[gt])*(we[Le+1]+we[gt+1]);if(He>0===Me)for(let Le=0,tt=we.length;Le<tt/2;Le+=2){const gt=we[Le],It=we[Le+1];we[Le]=we[tt-2-Le],we[Le+1]=we[tt-1-Le],we[tt-2-Le]=gt,we[tt-1-Le]=It}}(Se,ge),Ae.push(Se)}const Mt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class rn{constructor(H,G){const K=(G=this.options=function(ge,N){for(const Se in N)ge[Se]=N[Se];return ge}(Object.create(Mt),G)).debug;if(K&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let de=function(ge,N){const Se=[];if(ge.type==="FeatureCollection")for(let we=0;we<ge.features.length;we++)Pt(Se,ge.features[we],N,we);else Pt(Se,ge.type==="Feature"?ge:{geometry:ge},N);return Se}(H,G);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),de=function(ge,N){const Se=N.buffer/N.extent;let we=ge;const Me=wt(ge,1,-1-Se,Se,0,-1,2,N),He=wt(ge,1,1-Se,2+Se,0,-1,2,N);return(Me||He)&&(we=wt(ge,1,-Se,1+Se,0,-1,2,N)||[],Me&&(we=Dn(Me,1).concat(we)),He&&(we=we.concat(Dn(He,-1)))),we}(de,G),de.length&&this.splitTile(de,0,0,0),K&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,G,K,de,ge,N,Se){const we=[H,G,K,de],Me=this.options,He=Me.debug;for(;we.length;){de=we.pop(),K=we.pop(),G=we.pop(),H=we.pop();const Le=1<<G,tt=dn(G,K,de);let gt=this.tiles[tt];if(!gt&&(He>1&&console.time("creation"),gt=this.tiles[tt]=Lt(H,G,K,de,Me),this.tileCoords.push({z:G,x:K,y:de}),He)){He>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,K,de,gt.numFeatures,gt.numPoints,gt.numSimplified),console.timeEnd("creation"));const yt=`z${G}`;this.stats[yt]=(this.stats[yt]||0)+1,this.total++}if(gt.source=H,ge==null){if(G===Me.indexMaxZoom||gt.numPoints<=Me.indexMaxPoints)continue}else{if(G===Me.maxZoom||G===ge)continue;if(ge!=null){const yt=ge-G;if(K!==N>>yt||de!==Se>>yt)continue}}if(gt.source=null,H.length===0)continue;He>1&&console.time("clipping");const It=.5*Me.buffer/Me.extent,Ht=.5-It,zt=.5+It,Ce=1+It;let tn=null,Rn=null,Rt=null,Re=null,rt=wt(H,Le,K-It,K+zt,0,gt.minX,gt.maxX,Me),Tt=wt(H,Le,K+Ht,K+Ce,0,gt.minX,gt.maxX,Me);H=null,rt&&(tn=wt(rt,Le,de-It,de+zt,1,gt.minY,gt.maxY,Me),Rn=wt(rt,Le,de+Ht,de+Ce,1,gt.minY,gt.maxY,Me),rt=null),Tt&&(Rt=wt(Tt,Le,de-It,de+zt,1,gt.minY,gt.maxY,Me),Re=wt(Tt,Le,de+Ht,de+Ce,1,gt.minY,gt.maxY,Me),Tt=null),He>1&&console.timeEnd("clipping"),we.push(tn||[],G+1,2*K,2*de),we.push(Rn||[],G+1,2*K,2*de+1),we.push(Rt||[],G+1,2*K+1,2*de),we.push(Re||[],G+1,2*K+1,2*de+1)}}getTile(H,G,K){H=+H,G=+G,K=+K;const de=this.options,{extent:ge,debug:N}=de;if(H<0||H>24)return null;const Se=1<<H,we=dn(H,G=G+Se&Se-1,K);if(this.tiles[we])return en(this.tiles[we],ge);N>1&&console.log("drilling down to z%d-%d-%d",H,G,K);let Me,He=H,Le=G,tt=K;for(;!Me&&He>0;)He--,Le>>=1,tt>>=1,Me=this.tiles[dn(He,Le,tt)];return Me&&Me.source?(N>1&&(console.log("found parent tile z%d-%d-%d",He,Le,tt),console.time("drilling down")),this.splitTile(Me.source,He,Le,tt,H,G,K),N>1&&console.timeEnd("drilling down"),this.tiles[we]?en(this.tiles[we],ge):null):null}}function dn(Ae,H,G){return 32*((1<<Ae)*G+H)+Ae}class _n extends Q{constructor(H,G,K,de=Yt){super(H,G,K),this._dataUpdateable=new Map,this._createGeoJSONIndex=de}loadVectorTile(H,G){return x._(this,void 0,void 0,function*(){const K=H.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(K.z,K.x,K.y);return de?Ue(new x.d2(de.features,{version:2,extent:x.a5})):null})}loadData(H){return x._(this,void 0,void 0,function*(){var G;(G=this._pendingRequest)===null||G===void 0||G.abort();const K=this._startPerformance(H);this._pendingRequest=new AbortController;try{(!this._pendingData||H.request||H.data||H.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(H,this._pendingRequest));const de=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(de,H),this.loaded={};const ge={};return H.request&&(ge.data=de),this._finishPerformance(K,H,ge),ge}catch(de){if(delete this._pendingRequest,x.Z(de))return{abandoned:!0};throw de}})}_startPerformance(H){var G;if(!((G=H==null?void 0:H.request)===null||G===void 0)&&G.collectResourceTiming)return new x.c_(H.request)}_finishPerformance(H,G,K){if(!H)return;const de=H.finish();de&&(K.resourceTiming={},K.resourceTiming[G.source]=JSON.parse(JSON.stringify(de)))}getData(){return x._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(H){const G=this.loaded;return G&&G[H.uid]?super.reloadTile(H):this.loadTile(H)}loadAndProcessGeoJSON(H,G){return x._(this,void 0,void 0,function*(){let K;if(H.request?K=yield this.loadGeoJSONFromUrl(H.request,H.promoteId,G):H.data?K=this._loadGeoJSONFromObject(H.data,H.promoteId):H.dataDiff&&(K=this._loadGeoJSONFromDiff(H.dataDiff,H.promoteId,H.source)),delete this._pendingRequest,typeof K!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);return ct(K,!0),H.filter&&(K=this._filterGeoJSON(K,H.filter)),K})}loadGeoJSONFromUrl(H,G,K){return x._(this,void 0,void 0,function*(){const de=yield x.j(H,K);return this._dataUpdateable=x.a7(de.data,G),de.data})}_loadGeoJSONFromObject(H,G){return this._dataUpdateable=x.a7(H,G),H}_loadGeoJSONFromDiff(H,G,K){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K}`);x.a8(this._dataUpdateable,H,G);const de=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(de)}_filterGeoJSON(H,G){const K=x.d3(G,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(K.result==="error")throw new Error(K.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));const de=H.features.filter(ge=>K.value.evaluate({zoom:0},ge));return this._toFeatureCollection(de)}_toFeatureCollection(H){return{type:"FeatureCollection",features:H}}removeSource(H){return x._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}function Yt(Ae,H){return H.cluster?new ue(function({superclusterOptions:G,clusterProperties:K}){if(!K||!G)return G;const de={},ge={},N={accumulated:null,zoom:0},Se={properties:null},we=Object.keys(K);for(const Me of we){const[He,Le]=K[Me],tt=x.d3(Le),gt=x.d3(typeof He=="string"?[He,["accumulated"],["get",Me]]:He);de[Me]=tt.value,ge[Me]=gt.value}return G.map=Me=>{Se.properties=Me;const He={};for(const Le of we)He[Le]=de[Le].evaluate(N,Se);return He},G.reduce=(Me,He)=>{Se.properties=He;for(const Le of we)N.accumulated=Me[Le],Me[Le]=ge[Le].evaluate(N,Se)},G}(H)).load(Ae.features):function(G,K){return new rn(G,K)}(Ae,H.geojsonVtOptions)}class Xt{constructor(H){this.self=H,this.actor=new x.L(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(G,K)=>{if(this.externalWorkerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.externalWorkerSourceTypes[G]=K},this.self.addProtocol=x.cJ,this.self.removeProtocol=x.cK,this.self.registerRTLTextPlugin=G=>{x.d4.setMethods(G)},this.actor.registerMessageHandler("LDT",(G,K)=>this._getDEMWorkerSource(G,K.source).loadTile(K)),this.actor.registerMessageHandler("RDT",(G,K)=>x._(this,void 0,void 0,function*(){this._getDEMWorkerSource(G,K.source).removeTile(K)})),this.actor.registerMessageHandler("GCEZ",(G,K)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(G,K.type,K.source).getClusterExpansionZoom(K)})),this.actor.registerMessageHandler("GCC",(G,K)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(G,K.type,K.source).getClusterChildren(K)})),this.actor.registerMessageHandler("GCL",(G,K)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(G,K.type,K.source).getClusterLeaves(K)})),this.actor.registerMessageHandler("LD",(G,K)=>this._getWorkerSource(G,K.type,K.source).loadData(K)),this.actor.registerMessageHandler("GD",(G,K)=>this._getWorkerSource(G,K.type,K.source).getData()),this.actor.registerMessageHandler("LT",(G,K)=>this._getWorkerSource(G,K.type,K.source).loadTile(K)),this.actor.registerMessageHandler("RT",(G,K)=>this._getWorkerSource(G,K.type,K.source).reloadTile(K)),this.actor.registerMessageHandler("AT",(G,K)=>this._getWorkerSource(G,K.type,K.source).abortTile(K)),this.actor.registerMessageHandler("RMT",(G,K)=>this._getWorkerSource(G,K.type,K.source).removeTile(K)),this.actor.registerMessageHandler("RS",(G,K)=>x._(this,void 0,void 0,function*(){if(!this.workerSources[G]||!this.workerSources[G][K.type]||!this.workerSources[G][K.type][K.source])return;const de=this.workerSources[G][K.type][K.source];delete this.workerSources[G][K.type][K.source],de.removeSource!==void 0&&de.removeSource(K)})),this.actor.registerMessageHandler("RM",G=>x._(this,void 0,void 0,function*(){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],this.globalStates.delete(G)})),this.actor.registerMessageHandler("SR",(G,K)=>x._(this,void 0,void 0,function*(){this.referrer=K})),this.actor.registerMessageHandler("SRPS",(G,K)=>this._syncRTLPluginState(G,K)),this.actor.registerMessageHandler("IS",(G,K)=>x._(this,void 0,void 0,function*(){this.self.importScripts(K)})),this.actor.registerMessageHandler("SI",(G,K)=>this._setImages(G,K)),this.actor.registerMessageHandler("UL",(G,K)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(G).update(K.layers,K.removedIds,this._getGlobalState(G))})),this.actor.registerMessageHandler("UGS",(G,K)=>x._(this,void 0,void 0,function*(){const de=this._getGlobalState(G);for(const ge in K)de[ge]=K[ge]})),this.actor.registerMessageHandler("SL",(G,K)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(G).replace(K,this._getGlobalState(G))}))}_getGlobalState(H){let G=this.globalStates.get(H);return G||(G={},this.globalStates.set(H,G)),G}_setImages(H,G){return x._(this,void 0,void 0,function*(){this.availableImages[H]=G;for(const K in this.workerSources[H]){const de=this.workerSources[H][K];for(const ge in de)de[ge].availableImages=G}})}_syncRTLPluginState(H,G){return x._(this,void 0,void 0,function*(){return yield x.d4.syncState(G,this.self.importScripts)})}_getAvailableImages(H){let G=this.availableImages[H];return G||(G=[]),G}_getLayerIndex(H){let G=this.layerIndexes[H];return G||(G=this.layerIndexes[H]=new c),G}_getWorkerSource(H,G,K){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][G]||(this.workerSources[H][G]={}),!this.workerSources[H][G][K]){const de={sendAsync:(ge,N)=>(ge.targetMapId=H,this.actor.sendAsync(ge,N))};switch(G){case"vector":this.workerSources[H][G][K]=new Q(de,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][G][K]=new _n(de,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][G][K]=new this.externalWorkerSourceTypes[G](de,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][G][K]}_getDEMWorkerSource(H,G){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][G]||(this.demWorkerSources[H][G]=new qe),this.demWorkerSources[H][G]}}return x.i(self)&&(self.worker=new Xt(self)),Xt}),g("index",["exports","./shared"],function(x,c){var R="5.15.0";function B(){var _=new c.A(4);return c.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}let W,ee,ce;const Ie={frame(_,t,s){const u=requestAnimationFrame(y=>{p(),t(y)}),{unsubscribe:p}=c.s(_.signal,"abort",()=>{p(),cancelAnimationFrame(u),s(new c.a(_.signal.reason))},!1)},frameAsync(_){return new Promise((t,s)=>{this.frame(_,t,s)})},getImageData(_,t=0){return this.getImageCanvasContext(_).getImageData(-t,-t,_.width+2*t,_.height+2*t)},getImageCanvasContext(_){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=_.width,t.height=_.height,s.drawImage(_,0,0,_.width,_.height),s},resolveURL:_=>(W||(W=document.createElement("a")),W.href=_,W.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return ce!==void 0?ce:!!matchMedia&&(ee==null&&(ee=matchMedia("(prefers-reduced-motion: reduce)")),ee.matches)},set prefersReducedMotion(_){ce=_}},Ue=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(_){this._frozenAt=_}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function ke(){return Ue.getCurrentTime()}class Q{static testProp(t){if(!Q.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in Q.docStyle)return t[s];return t[0]}static create(t,s,u){const p=window.document.createElement(t);return s!==void 0&&(p.className=s),u&&u.appendChild(p),p}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){Q.docStyle&&Q.selectProp&&(Q.userSelect=Q.docStyle[Q.selectProp],Q.docStyle[Q.selectProp]="none")}static enableDrag(){Q.docStyle&&Q.selectProp&&(Q.docStyle[Q.selectProp]=Q.userSelect)}static setTransform(t,s){t.style[Q.transformProp]=s}static addEventListener(t,s,u,p={}){t.addEventListener(s,u,"passive"in p?p:p.capture)}static removeEventListener(t,s,u,p={}){t.removeEventListener(s,u,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Q.suppressClickInternal,!0)},0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,u){const p=s.boundingClientRect;return new c.P((u.clientX-p.left)/s.x-t.clientLeft,(u.clientY-p.top)/s.y-t.clientTop)}static mousePos(t,s){const u=Q.getScale(t);return Q.getPoint(t,u,s)}static touchPos(t,s){const u=[],p=Q.getScale(t);for(let y=0;y<s.length;y++)u.push(Q.getPoint(t,p,s[y]));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const s=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),u=s.querySelectorAll("script");for(const p of u)p.remove();return Q.clean(s),s.innerHTML}static isPossiblyDangerous(t,s){const u=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!u.includes("javascript:")&&!u.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const s=t.children;for(const u of s)Q.removeAttributes(u),Q.clean(u)}static removeAttributes(t){for(const{name:s,value:u}of t.attributes)Q.isPossiblyDangerous(s,u)&&t.removeAttribute(s)}}Q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Q.selectProp=Q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Q.transformProp=Q.testProp(["transform","WebkitTransform"]);const qe={supported:!1,testSupport:function(_){!ht&&Ge&&(ct?ot(_):Ye=_)}};let Ye,Ge,ht=!1,ct=!1;function ot(_){const t=_.createTexture();_.bindTexture(_.TEXTURE_2D,t);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,Ge),_.isContextLost())return;qe.supported=!0}catch{}_.deleteTexture(t),ht=!0}var xe;typeof document<"u"&&(Ge=document.createElement("img"),Ge.onload=()=>{Ye&&ot(Ye),Ye=null,ct=!0},Ge.onerror=()=>{ht=!0,Ye=null},Ge.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let t,s,u,p;_.resetRequestQueue=()=>{t=[],s=0,u=0,p={}},_.addThrottleControl=P=>{const C=u++;return p[C]=P,C},_.removeThrottleControl=P=>{delete p[P],b()},_.getImage=(P,C,k=!0)=>new Promise((O,F)=>{qe.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),c.e(P,{type:"image"}),t.push({abortController:C,requestParameters:P,supportImageRefresh:k,state:"queued",onError:q=>{F(q)},onSuccess:q=>{O(q)}}),b()});const y=P=>c._(this,void 0,void 0,function*(){P.state="running";const{requestParameters:C,supportImageRefresh:k,onError:O,onSuccess:F,abortController:q}=P,Z=k===!1&&!c.i(self)&&!c.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((re,le)=>re&&le==="accept",!0));s++;const te=Z?I(C,q):c.m(C,q);try{const re=yield te;delete P.abortController,P.state="completed",re.data instanceof HTMLImageElement||c.b(re.data)?F(re):re.data&&F({data:yield(ie=re.data,typeof createImageBitmap=="function"?c.f(ie):c.h(ie)),cacheControl:re.cacheControl,expires:re.expires})}catch(re){delete P.abortController,O(re)}finally{s--,b()}var ie}),b=()=>{const P=(()=>{for(const C of Object.keys(p))if(p[C]())return!0;return!1})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=s;C<P&&t.length>0;C++){const k=t.shift();k.abortController.signal.aborted?C--:y(k)}},I=(P,C)=>new Promise((k,O)=>{const F=new Image,q=P.url,Z=P.credentials;Z&&Z==="include"?F.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!c.d(q))&&(F.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{F.src="",O(new c.a(C.signal.reason))}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,k({data:F})},F.onerror=()=>{F.onerror=F.onload=null,C.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=q})}(xe||(xe={})),xe.resetRequestQueue();class se{constructor(t){this._transformRequestFn=t??null}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ue(_){const t=[];if(typeof _=="string")t.push({id:"default",url:_});else if(_&&_.length>0){const s=[];for(const{id:u,url:p}of _){const y=`${u}${p}`;s.indexOf(y)===-1&&(s.push(y),t.push({id:u,url:p}))}}return t}function Ee(_,t,s){try{const u=new URL(_);return u.pathname+=`${t}${s}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${_}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function be(_){const{userImage:t}=_;return!!(t&&t.render&&t.render())&&(_.data.replace(new Uint8Array(t.data.buffer)),!0)}class fe extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:u}of this.requestors)u(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const u=s.spriteData;s.data=new c.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let u=!0;const p=s.data||s.spriteData;return this._validateStretch(s.stretchX,p&&p.width)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,p&&p.height)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,s){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||s<p[1])return!1;u=p[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const u=s.spriteData,p=u&&u.width||s.data.width,y=u&&u.height||s.data.height;return!(t[0]<0||p<t[0]||t[1]<0||y<t[1]||t[2]<0||p<t[2]||t[3]<0||y<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,u=!0){const p=this.getImage(t);if(u&&(p.data.width!==s.data.width||p.data.height!==s.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=p.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((s,u)=>{let p=!0;if(!this.isLoaded())for(const y of t)this.images[y]||(p=!1);this.isLoaded()||p?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})})}_getImagesForIds(t){const s={};for(const u of t){let p=this.getImage(u);p||(this.fire(new c.l("styleimagemissing",{id:u})),p=this.getImage(u)),p?s[u]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:c.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],u=this.getImage(t);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},y=new c.I(p,u);this.patterns[t]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const y in this.patterns)t.push(this.patterns[y].bin);const{w:s,h:u}=c.p(t),p=this.atlasImage;p.resize({width:s||1,height:u||1});for(const y in this.patterns){const{bin:b}=this.patterns[y],I=b.x+1,P=b.y+1,C=this.getImage(y).data,k=C.width,O=C.height;c.R.copy(C,p,{x:0,y:0},{x:I,y:P},{width:k,height:O}),c.R.copy(C,p,{x:0,y:O-1},{x:I,y:P-1},{width:k,height:1}),c.R.copy(C,p,{x:0,y:0},{x:I,y:P+O},{width:k,height:1}),c.R.copy(C,p,{x:k-1,y:0},{x:I-1,y:P},{width:1,height:O}),c.R.copy(C,p,{x:0,y:0},{x:I+k,y:P},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.getImage(s);u||c.w(`Image with ID: "${s}" was not found`),be(u)&&this.updateImage(s,u)}}cloneImages(){const t={};for(const s in this.images){const u=this.images[s];t[s]=Object.assign(Object.assign({},u),{data:u.data?u.data.clone():null})}return t}}const pe=1e20;function Jt(_,t,s,u,p,y,b,I,P){for(let C=t;C<t+u;C++)fn(_,s*y+C,y,p,b,I,P);for(let C=s;C<s+p;C++)fn(_,C*y+t,1,u,b,I,P)}function fn(_,t,s,u,p,y,b){y[0]=0,b[0]=-pe,b[1]=pe,p[0]=_[t];for(let I=1,P=0,C=0;I<u;I++){p[I]=_[t+I*s];const k=I*I;do{const O=y[P];C=(p[I]-p[O]+k-O*O)/(I-O)/2}while(C<=b[P]&&--P>-1);P++,y[P]=I,b[P]=C,b[P+1]=pe}for(let I=0,P=0;I<u;I++){for(;b[P+1]<I;)P++;const C=y[P],k=I-C;_[t+I*s]=p[C]+k*k}}const Ut=c.v.layout_symbol["text-font"].default.join(",");class $t{constructor(t,s,u){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={},this.lang=u}setURL(t){this.url=t}getGlyphs(t){return c._(this,void 0,void 0,function*(){const s=[];for(const y in t)for(const b of t[y])s.push(this._getAndCacheGlyphsPromise(y,b));const u=yield Promise.all(s),p={};for(const{stack:y,id:b,glyph:I}of u)p[y]||(p[y]={}),p[y][b]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return p})}_getAndCacheGlyphsPromise(t,s){return c._(this,void 0,void 0,function*(){let u=this.entries[t];u||(u=this.entries[t]={glyphs:{},requests:{},ranges:{}});let p=u.glyphs[s];return p!==void 0?{stack:t,id:s,glyph:p}:!this.url||this._charUsesLocalIdeographFontFamily(s)?(p=u.glyphs[s]=this._drawGlyph(u,t,s),{stack:t,id:s,glyph:p}):yield this._downloadAndCacheRangePromise(t,s)})}_downloadAndCacheRangePromise(t,s){return c._(this,void 0,void 0,function*(){const u=this.entries[t],p=Math.floor(s/256);if(u.ranges[p])return{stack:t,id:s,glyph:null};if(!u.requests[p]){const y=$t.loadGlyphRange(t,p,this.url,this.requestManager);u.requests[p]=y}try{const y=yield u.requests[p];for(const b in y)u.glyphs[+b]=y[+b];return u.ranges[p]=!0,{stack:t,id:s,glyph:y[s]||null}}catch(y){const b=u.glyphs[s]=this._drawGlyph(u,t,s);return this._warnOnMissingGlyphRange(b,p,s,y),{stack:t,id:s,glyph:b}}})}_warnOnMissingGlyphRange(t,s,u,p){const y=256*s,b=y+255,I=u.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${s}, ${y}-${b}. Rendering codepoint U+${I} locally instead. ${p}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&c.q(t)}_drawGlyph(t,s,u){const p=s===Ut&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(u),y=p?"ideographTinySDF":"tinySDF";t[y]||(t[y]=this._createTinySDF(p?this.localIdeographFontFamily:s));const b=t[y].draw(String.fromCodePoint(u));return{id:u,bitmap:new c.r({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const s=t?t.split(","):[];s.push("sans-serif");const u=s.map(p=>/[-\w]+/.test(p)?p:`'${CSS.escape(p)}'`).join(",");return new $t.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:this._fontWeight(s[0]),fontStyle:this._fontStyle(s[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const s={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let u;for(const[p,y]of Object.entries(s))new RegExp(`\\b${p}\\b`,"i").test(t)&&(u=`${y}`);return u}destroy(){for(const t in this.entries){const s=this.entries[t];s.tinySDF&&(s.tinySDF=null),s.ideographTinySDF&&(s.ideographTinySDF=null),s.glyphs={},s.requests={},s.ranges={}}this.entries={}}}$t.loadGlyphRange=function(_,t,s,u){return c._(this,void 0,void 0,function*(){const p=256*t,y=p+255,b=u.transformRequest(s.replace("{fontstack}",_).replace("{range}",`${p}-${y}`),"Glyphs"),I=yield c.n(b,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${t}, ${p}-${y}`);const P={};for(const C of c.o(I.data))P[C.id]=C;return P})},$t.TinySDF=class{constructor({fontSize:_=24,buffer:t=3,radius:s=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:b="normal",lang:I=null}={}){this.buffer=t,this.cutoff=u,this.radius=s,this.lang=I;const P=this.size=_+4*t,C=this._createCanvas(P),k=this.ctx=C.getContext("2d",{willReadFrequently:!0});k.font=`${b} ${y} ${_}px ${p}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(_){const t=document.createElement("canvas");return t.width=t.height=_,t}draw(_){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(_),b=Math.ceil(s),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),P=Math.min(this.size-this.buffer,b+Math.ceil(u)),C=I+2*this.buffer,k=P+2*this.buffer,O=Math.max(C*k,0),F=new Uint8ClampedArray(O),q={data:F,width:C,height:k,glyphWidth:I,glyphHeight:P,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(I===0||P===0)return q;const{ctx:Z,buffer:te,gridInner:ie,gridOuter:re}=this;this.lang&&(Z.lang=this.lang),Z.clearRect(te,te,I,P),Z.fillText(_,te,te+b);const le=Z.getImageData(te,te,I,P);re.fill(pe,0,O),ie.fill(0,0,O);for(let ve=0;ve<P;ve++)for(let oe=0;oe<I;oe++){const _e=le.data[4*(ve*I+oe)+3]/255;if(_e===0)continue;const Te=(ve+te)*C+oe+te;if(_e===1)re[Te]=0,ie[Te]=pe;else{const me=.5-_e;re[Te]=me>0?me*me:0,ie[Te]=me<0?me*me:0}}Jt(re,0,0,C,k,C,this.f,this.v,this.z),Jt(ie,te,te,I,P,C,this.f,this.v,this.z);for(let ve=0;ve<O;ve++){const oe=Math.sqrt(re[ve])-Math.sqrt(ie[ve]);F[ve]=Math.round(255-255*(oe/this.radius+this.cutoff))}return q}};class mn{constructor(){this.specification=c.u.light.position}possiblyEvaluate(t,s){return c.F(t.expression.evaluate(s))}interpolate(t,s,u){return{x:c.G.number(t.x,s.x,u),y:c.G.number(t.y,s.y,u),z:c.G.number(t.z,s.z,u)}}}let Pt;class zn extends c.E{constructor(t){super(),Pt=Pt||new c.t({anchor:new c.D(c.u.light.anchor),position:new mn,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(Pt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(c.y,t,s))for(const u in t){const p=t[u];u.endsWith(c.z)?this._transitionable.setTransition(u.slice(0,-c.z.length),p):this._transitionable.setValue(u,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,u){return(!u||u.validate!==!1)&&c.B(this,t.call(c.C,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const on=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class Ft extends c.E{constructor(t){super(),this._transitionable=new c.x(on,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0))}setSky(t,s={}){if(!this._validate(c.J,t,s)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in t){const p=t[u];u.endsWith(c.z)?this._transitionable.setTransition(u.slice(0,-c.z.length),p):this._transitionable.setValue(u,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,u={}){return(u==null?void 0:u.validate)!==!1&&c.B(this,t.call(c.C,c.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Gt{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const u=t.join(",")+String(s);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,s)),this.dashEntry[u]}getDashRanges(t,s,u){const p=[];let y=t.length%2==1?-t[t.length-1]*u:0,b=t[0]*u,I=!0;p.push({left:y,right:b,isDash:I,zeroLength:t[0]===0});let P=t[0];for(let C=1;C<t.length;C++){I=!I;const k=t[C];y=P*u,P+=k,b=P*u,p.push({left:y,right:b,isDash:I,zeroLength:k===0})}return p}addRoundDash(t,s,u){const p=s/2;for(let y=-u;y<=u;y++){const b=this.width*(this.nextRow+u+y);let I=0,P=t[I];for(let C=0;C<this.width;C++){C/P.right>1&&(P=t[++I]);const k=Math.abs(C-P.left),O=Math.abs(C-P.right),F=Math.min(k,O);let q;const Z=y/u*(p+1);if(P.isDash){const te=p-Math.abs(Z);q=Math.sqrt(F*F+te*te)}else q=p-Math.sqrt(F*F+Z*Z);this.data[b+C]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(t){for(let I=t.length-1;I>=0;--I){const P=t[I],C=t[I+1];P.zeroLength?t.splice(I,1):C&&C.isDash===P.isDash&&(C.left=P.left,t.splice(I,1))}const s=t[0],u=t[t.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const p=this.width*this.nextRow;let y=0,b=t[y];for(let I=0;I<this.width;I++){I/b.right>1&&(b=t[++y]);const P=Math.abs(I-b.left),C=Math.abs(I-b.right),k=Math.min(P,C);this.data[p+I]=Math.max(0,Math.min(255,(b.isDash?k:-k)+128))}}addDash(t,s){const u=s?7:0,p=2*u+1;if(this.nextRow+p>this.height)return c.w("LineAtlas out of space"),null;let y=0;for(let I=0;I<t.length;I++)y+=t[I];if(y!==0){const I=this.width/y,P=this.getDashRanges(t,this.width,I);s?this.addRoundDash(P,I,u):this.addRegularDash(P)}const b={y:this.nextRow+u,height:2*u,width:y};return this.nextRow+=p,this.dirty=!0,b}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Mn="maplibre_preloaded_worker_pool";class wt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<wt.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mn]}numActive(){return Object.keys(this.active).length}}const Et=Math.floor(Ie.hardwareConcurrency/2);let Cn,Wt;function Sn(){return Cn||(Cn=new wt),Cn}wt.workerCount=c.K(globalThis)?Math.max(Math.min(Et,3),1):1;class Kt{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const u=this.workerPool.acquire(s);for(let p=0;p<u.length;p++){const y=new c.L(u[p],s);y.name=`Worker ${p}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const u=[];for(const p of this.actors)u.push(p.sendAsync({type:t,data:s}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const u of this.actors)u.registerMessageHandler(t,s)}unregisterMessageHandler(t){for(const s of this.actors)s.unregisterMessageHandler(t)}}function or(){return Wt||(Wt=new Kt(Sn(),c.M),Wt.registerMessageHandler("GR",(_,t,s)=>c.m(t,s))),Wt}function Tn(_,t){const s=c.N();return c.O(s,s,[1,1,0]),c.Q(s,s,[.5*_.width,.5*_.height,1]),_.calculatePosMatrix?c.S(s,s,_.calculatePosMatrix(t.toUnwrapped())):s}function Dn(_,t,s,u,p,y,b){var I;const P=function(F,q,Z){if(F)for(const te of F){const ie=q[te];if(ie&&ie.source===Z&&ie.type==="fill-extrusion")return!0}else for(const te in q){const ie=q[te];if(ie.source===Z&&ie.type==="fill-extrusion")return!0}return!1}((I=p==null?void 0:p.layers)!==null&&I!==void 0?I:null,t,_.id),C=y.maxPitchScaleFactor(),k=_.tilesIn(u,C,P);k.sort(Nt);const O=[];for(const F of k)O.push({wrappedTileID:F.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(t,s,_.getState(),F.queryGeometry,F.cameraQueryGeometry,F.scale,p,y,C,Tn(y,F.tileID),b?(q,Z)=>b(F.tileID,q,Z):void 0)});return function(F,q){for(const Z in F)for(const te of F[Z])en(te,q);return F}(function(F){const q={},Z={};for(const te of F){const ie=te.queryResults,re=te.wrappedTileID,le=Z[re]=Z[re]||{};for(const ve in ie){const oe=ie[ve],_e=le[ve]=le[ve]||{},Te=q[ve]=q[ve]||[];for(const me of oe)_e[me.featureIndex]||(_e[me.featureIndex]=!0,Te.push(me))}}return q}(O),_)}function Nt(_,t){const s=_.tileID,u=t.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function en(_,t){const s=_.feature,u=t.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=u}function Pn(_,t,s){return c._(this,void 0,void 0,function*(){let u=_;if(_.url?u=(yield c.j(t.transformRequest(_.url,"Source"),s)).data:yield Ie.frameAsync(s),!u)return null;const p=c.U(c.e(u,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(p.vectorLayerIds=u.vector_layers.map(y=>y.id)),p})}class Lt{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}extend(t){const s=this._sw,u=this._ne;let p,y;if(t instanceof c.V)p=t,y=t;else{if(!(t instanceof Lt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Lt.convert(t)):this.extend(c.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(c.V.convert(t)):this;if(p=t._sw,y=t._ne,!p||!y)return this}return s||u?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new c.V(p.lng,p.lat),this._ne=new c.V(y.lng,y.lat)),this}getCenter(){return new c.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.V(this.getWest(),this.getNorth())}getSouthEast(){return new c.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:u}=c.V.convert(t);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}intersects(t){if(!((t=Lt.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const s=Math.abs(this.getEast()-this.getWest()),u=Math.abs(t.getEast()-t.getWest());if(s>=360||u>=360)return!0;const p=c.W(this.getWest(),-180,180),y=c.W(this.getEast(),-180,180),b=c.W(t.getWest(),-180,180),I=c.W(t.getEast(),-180,180),P=p>=y,C=b>=I;return!(!P||!C)||(P?I>=p||b<=y:C?y>=b||p<=I:b<=y&&I>=p)}static convert(t){return t instanceof Lt?t:t&&new Lt(t)}static fromLngLat(t,s=0){const u=360*s/40075017,p=u/Math.cos(Math.PI/180*t.lat);return new Lt(new c.V(t.lng-p,t.lat-u),new c.V(t.lng+p,t.lat+u))}adjustAntiMeridian(){const t=new c.V(this._sw.lng,this._sw.lat),s=new c.V(this._ne.lng,this._ne.lat);return new Lt(t,t.lng>s.lng?new c.V(s.lng+360,s.lat):s)}}class jt{constructor(t,s,u){this.bounds=Lt.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),u=Math.floor(c.Y(this.bounds.getWest())*s),p=Math.floor(c.X(this.bounds.getNorth())*s),y=Math.ceil(c.Y(this.bounds.getEast())*s),b=Math.ceil(c.X(this.bounds.getSouth())*s);return t.x>=u&&t.x<y&&t.y>=p&&t.y<b}}class Vt extends c.E{constructor(t,s,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.U(s,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Pn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(c.e(this,t),t.bounds&&(this.tileBounds=new jt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,c.Z(t)||this.fire(new c.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(t){return c._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};u.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((y,b)=>{t.reloadPromise={resolve:y,reject:b}})}else t.actor=this.dispatcher.getActor(),p="LT";t.abortController=new AbortController;try{const y=yield t.actor.sendAsync({type:p,data:u},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,y)}catch(y){if(delete t.abortController,t.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(t,null)}})}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const s=t.tileID.scaledTo(this.maxzoom).canonical,u=s.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:s,overzoomRequest:this.map._requestManager.transformRequest(u,"Tile")}}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const u=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(u.resolve).catch(u.reject)}}abortTile(t){return c._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return c._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Mt extends c.E{constructor(t,s,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},s),c.e(this,c.U(s,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Pn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(c.e(this,s),s.bounds&&(this.tileBounds=new jt(s.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(s){this._tileJSONRequest=null,this._loaded=!0,c.Z(s)||this.fire(new c.k(s))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return c.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return c._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const u=yield xe.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&t.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const p=this.map.painter.context,y=p.gl,b=u.data;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new c.T(p,b,y.RGBA,{useMipmap:!0}),t.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(u){if(delete t.abortController,t.aborted)t.state="unloaded";else if(u)throw t.state="errored",u}})}abortTile(t){return c._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return c._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class rn extends Mt{constructor(t,s,u,p){super(t,s,u,p),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return c._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const p=yield xe.getImage(u,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){const y=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const b=c.b(y)&&c.$()?y:yield this.readImageNow(y),I={type:this.type,uid:t.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const P=yield t.actor.sendAsync({type:"LDT",data:I});t.dem=P,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}})}readImageNow(t){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.a0()){const s=t.width+2,u=t.height+2;try{return new c.R({width:s,height:u},yield c.a1(t,-1,-1,s,u))}catch{}}return Ie.getImageData(t,1)})}_getNeighboringTiles(t){const s=t.canonical,u=Math.pow(2,s.z),p=(s.x-1+u)%u,y=s.x===0?t.wrap-1:t.wrap,b=(s.x+1+u)%u,I=s.x+1===u?t.wrap+1:t.wrap,P={};return P[new c.a2(t.overscaledZ,y,s.z,p,s.y).key]={backfilled:!1},P[new c.a2(t.overscaledZ,I,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(P[new c.a2(t.overscaledZ,y,s.z,p,s.y-1).key]={backfilled:!1},P[new c.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},P[new c.a2(t.overscaledZ,I,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<u&&(P[new c.a2(t.overscaledZ,y,s.z,p,s.y+1).key]={backfilled:!1},P[new c.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},P[new c.a2(t.overscaledZ,I,s.z,b,s.y+1).key]={backfilled:!1}),P}unloadTile(t){return c._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}function dn(_){return _.type==="GeometryCollection"?_.geometries.map(t=>t.coordinates).flat(1/0):_.coordinates.flat(1/0)}function _n(_){const t=new Lt;let s;switch(_.type){case"FeatureCollection":s=_.features.map(u=>dn(u.geometry)).flat(1/0);break;case"Feature":s=dn(_.geometry);break;default:s=dn(_)}if(s.length==0)return t;for(let u=0;u<s.length-1;u+=2)t.extend([s[u],s[u+1]]);return t}class Yt extends c.E{constructor(t,s,u,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:s.data},this.actor=u.getActor(),this.setEventedParent(p),this._data=typeof s.data=="string"?{url:s.data}:{geojson:s.data},this._options=c.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:c.a5,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(s.clusterMaxZoom),minPoints:Math.max(2,s.clusterMinPoints||2),extent:c.a5,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(c.a5/this.tileSize)}_getClusterMaxZoom(t){const s=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${s}"`),s}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t,s){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const u=this._updateWorkerData();return s?u:this}updateData(t,s){this._pendingWorkerUpdate.diff=c.a6(this._pendingWorkerUpdate.diff,t);const u=this._updateWorkerData();return s?u:this}getData(){return c._(this,void 0,void 0,function*(){const t=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getBounds(){return c._(this,void 0,void 0,function*(){return _n(yield this.getData())})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:u}})}_updateWorkerData(){return c._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:s}=this._pendingWorkerUpdate,u=c.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(u.request=this.map._requestManager.transformRequest(Ie.resolveURL(t),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=t,this._pendingWorkerUpdate.data=void 0):s&&(u.dataDiff=s,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:u});if(this._isUpdatingWorker=!1,this._removed||p.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));p.data&&(this._data={geojson:p.data});const y=this._applyDiffToSource(s),b=this._getShouldReloadTileOptions(y);let I=null;p.resourceTiming&&p.resourceTiming[this.id]&&(I=p.resourceTiming[this.id].slice(0));const P={dataType:"source"};this._collectResourceTiming&&I&&I.length>0&&c.e(P,{resourceTiming:I}),this.fire(new c.l("data",Object.assign(Object.assign({},P),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},P),{sourceDataType:"content",shouldReloadTileOptions:b})))}catch(p){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(p))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_applyDiffToSource(t){if(!t)return;const s=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const p=c.a7(this._data.geojson,s);if(!p)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:p}}if(!this._data.updateable)return;const u=c.a8(this._data.updateable,t,s);return t.removeAll||this._options.cluster?void 0:u}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map(s=>_n(s))}}shouldReloadTile(t,{affectedBounds:s}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:u,extent:p}=this.workerOptions.geojsonVtOptions,y=function({x:b,y:I,z:P},C=0){const k=c.a3((b-C)/Math.pow(2,P)),O=c.a4((I+1+C)/Math.pow(2,P)),F=c.a3((b+1+C)/Math.pow(2,P)),q=c.a4((I-C)/Math.pow(2,P));return new Lt([k,O],[F,q])}(t.tileID.canonical,u/p);for(const b of s)if(y.intersects(b))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return c._(this,void 0,void 0,function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const p=yield this.actor.sendAsync({type:s,data:u},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(p,this.map.painter,s==="RT")})}abortTile(t){return c._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return c._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Xt extends c.E{constructor(t,s,u,p){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s}load(t){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield xe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,c.Z(s)||this.fire(new c.k(s))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(c.a9.fromLngLat);var u;return this.tileID=function(p){const y=c.aa.fromPoints(p),b=y.width(),I=y.height(),P=Math.max(b,I),C=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),k=Math.pow(2,C);return new c.ac(C,Math.floor((y.minX+y.maxX)/2*k),Math.floor((y.minY+y.maxY)/2*k))}(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map(p=>this.tileID.getTilePoint(p)._round()),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.texture||(this.texture=new c.T(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:s,minY:u,maxX:p,maxY:y}=c.aa.fromPoints(t),b={};for(let I=0;I<=c.ab;I++){const P=Math.pow(2,I),C=Math.floor(s*P),k=Math.floor(u*P),O=Math.floor(p*P),F=Math.floor(y*P);b[I]={minTileX:C,minTileY:k,maxTileX:O,maxTileY:F}}return b}}class Ae extends Xt{constructor(t,s,u,p){super(t,s,u,p),this.roundZoom=!0,this.type="video",this.options=s}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield c.ad(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new c.k(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new c.k(new c.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class H extends Xt{constructor(t,s,u,p){super(t,s,u,p),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new c.k(new c.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,u=s.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new c.T(s,this.canvas,u.RGBA,{premultiply:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const y in this.tiles){const b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const G={},K=_=>{switch(_){case"geojson":return Yt;case"image":return Xt;case"raster":return Mt;case"raster-dem":return rn;case"vector":return Vt;case"video":return Ae;case"canvas":return H}return G[_]},de="RTLPluginLoaded";class ge extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=or()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return c._(this,arguments,void 0,function*(s,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Ie.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(de))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let N=null;function Se(){return N||(N=new ge),N}var we,Me;(function(_){_[_.Base=0]="Base",_[_.Parent=1]="Parent"})(we||(we={})),function(_){_[_.Departing=0]="Departing",_[_.Incoming=1]="Incoming"}(Me||(Me={}));class He{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=c.af(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:s,fadingParentID:u,fadeEndTime:p}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=s,this.fadingParentID=u,this.fadeEndTime=p}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=ke(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,y){const b={};if(!y)return b;for(const I of p){const P=I.layerIds.map(C=>y.getLayer(C)).filter(Boolean);if(P.length!==0){I.layers=P,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(C=>P.filter(k=>k.id===C)[0]));for(const C of P)b[C.id]=I}}return b}(t.buckets,s==null?void 0:s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof c.ah){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof c.ah&&y.hasRTLText){this.hasRTLText=!0,Se().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(y))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new c.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,u,p,y,b,I,P,C,k,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:k,transform:P,params:I,queryPadding:this.queryPadding*C,getElevation:O},t,s,u):{}}querySourceFeatures(t,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),y=s&&s.sourceLayer?s.sourceLayer:"",b=p[c.ai]||p[y];if(!b)return;const I=c.aj(s==null?void 0:s.filter,s==null?void 0:s.globalState),{z:P,x:C,y:k}=this.tileID.canonical,O={z:P,x:C,y:k};for(let F=0;F<b.length;F++){const q=b.feature(F);if(I.needGeometry){const ie=c.ak(q,!0);if(!I.filter(new c.H(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!I.filter(new c.H(this.tileID.overscaledZ),q))continue;const Z=u.getId(q,y),te=new c.al(q,P,C,k,Z);te.tile=O,t.push(te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const u=c.am(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const y=this.expirationTime-s;y?this.expirationTime=u+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const y=this.buckets[p],b=y.layers[0].sourceLayer||c.ai,I=u[b],P=t[b];if(!I||!P||Object.keys(P).length===0)continue;y.update(P,I,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const C=s&&s.style&&s.style.getLayer(p);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(y)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ke()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=ke()+t}setDependencies(t,s){const u={};for(const p of s)u[p]=!0;this.dependencies[t]=u}hasDependency(t,s){for(const u of t){const p=this.dependencies[u];if(p){for(const y of s)if(p[y])return!0}}return!1}}class Le{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,u){const p=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},c.e(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==p&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const y in this.state[t][p])u[y]||(this.deletedStates[t][p][y]=null)}else for(const y in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][y]===null&&delete this.deletedStates[t][p][y]}removeFeatureState(t,s,u){if(this.deletedStates[t]===null)return;const p=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&s!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,s){const u=String(s),p=c.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const y=this.deletedStates[t][s];if(y===null)return{};for(const b in y)delete p[b]}return p}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),c.e(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];u[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const b in this.state[p])y[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(this.deletedStates[p][b]===null)this.state[p][b]={};else for(const I of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][I];y[b]=this.state[p][b]}u[p]=u[p]||{},c.e(u[p],y)}this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0&&t.setFeatureState(u,s)}}const tt=89.25;function gt(_,t){const s=c.an(t.lat,-c.ao,c.ao);return new c.P(c.Y(t.lng)*_,c.X(s)*_)}function It(_,t){return new c.a9(t.x/_,t.y/_).toLngLat()}function Ht(_){return _.cameraToCenterDistance*Math.min(.85*Math.tan(c.ap(90-_.pitch)),Math.tan(c.ap(tt-_.pitch)))}function zt(_,t){const s=_.canonical,u=t/c.aq(s.z),p=s.x+Math.pow(2,s.z)*_.wrap,y=c.ar(new Float64Array(16));return c.O(y,y,[p*u,s.y*u,0]),c.Q(y,y,[u/c.a5,u/c.a5,1]),y}function Ce(_,t,s,u,p){const y=c.a9.fromLngLat(_,t),b=p*c.as(1,_.lat),{x:I,y:P,z:C}=tn(s,u);return new c.a9(y.x+b*-I,y.y+b*-P,y.z+b*-C)}function tn(_,t){const s=c.ap(_),u=c.ap(t),p=Math.cos(-s),y=Math.sin(s);return{x:y*Math.sin(u),y:-y*Math.cos(u),z:p}}function Rn(_,t,s){const u=t.intersectsFrustum(_);if(!s||u===0)return u;const p=t.intersectsPlane(s);return p===0?0:u===2&&p===2?2:1}function Rt(_,t,s){let u=0;const p=(s-t)/10;for(let y=0;y<10;y++)u+=p*Math.pow(Math.cos(t+(y+.5)/10*(s-t)),_);return u}function Re(_,t){return function(s,u,p,y,b){const I=2*((_-1)/c.at(Math.cos(c.ap(tt-b))/Math.cos(c.ap(tt)))-1),P=Math.acos(p/y),C=2*Rt(I-1,0,c.ap(b/2)),k=Math.min(c.ap(tt),P+c.ap(b/2)),O=Rt(I-1,Math.min(k,P-c.ap(b/2)),k),F=Math.atan(u/p),q=Math.hypot(u,p);let Z=s;return Z+=c.at(y/q/Math.max(.5,Math.cos(c.ap(b/2)))),Z+=I*c.at(Math.cos(F))/2,Z-=c.at(Math.max(1,O/C/t))/2,Z}}const rt=Re(9.314,3);function Tt(_,t){const s=(t.roundZoom?Math.round:Math.floor)(_.zoom+c.at(_.tileSize/t.tileSize));return Math.max(0,s)}function yt(_,t){const s=_.getCameraFrustum(),u=_.getClippingPlane(),p=_.screenPointToMercatorCoordinate(_.getCameraPoint()),y=c.a9.fromLngLat(_.center,_.elevation);p.z=y.z+Math.cos(_.pitchInRadians)*_.cameraToCenterDistance/_.worldSize;const b=_.getCoveringTilesDetailsProvider(),I=b.allowVariableZoom(_,t),P=Tt(_,t),C=t.minzoom||0,k=t.maxzoom!==void 0?t.maxzoom:_.maxZoom,O=Math.min(Math.max(0,P),k),F=Math.pow(2,O),q=[F*p.x,F*p.y,0],Z=[F*y.x,F*y.y,0],te=Math.hypot(y.x-p.x,y.y-p.y),ie=Math.abs(y.z-p.z),re=Math.hypot(te,ie),le=_e=>({zoom:0,x:0,y:0,wrap:_e,fullyVisible:!1}),ve=[],oe=[];if(_.renderWorldCopies&&b.allowWorldCopies())for(let _e=1;_e<=3;_e++)ve.push(le(-_e)),ve.push(le(_e));for(ve.push(le(0));ve.length>0;){const _e=ve.pop(),Te=_e.x,me=_e.y;let Pe=_e.fullyVisible;const Be={x:Te,y:me,z:_e.zoom},Fe=b.getTileBoundingVolume(Be,_e.wrap,_.elevation,t);if(!Pe){const at=Rn(s,Fe,u);if(at===0)continue;Pe=at===2}const Oe=b.distanceToTile2d(p.x,p.y,Be,Fe);let Ne=P;I&&(Ne=(t.calculateTileZoom||rt)(_.zoom+c.at(_.tileSize/t.tileSize),Oe,ie,re,_.fov)),Ne=(t.roundZoom?Math.round:Math.floor)(Ne),Ne=Math.max(0,Ne);const it=Math.min(Ne,k);if(_e.wrap=b.getWrap(y,Be,_e.wrap),_e.zoom>=it){if(_e.zoom<C)continue;const at=O-_e.zoom,Je=q[0]-.5-(Te<<at),dt=q[1]-.5-(me<<at),sn=t.reparseOverscaled?Math.max(_e.zoom,Ne):_e.zoom;oe.push({tileID:new c.a2(_e.zoom===k?sn:_e.zoom,_e.wrap,_e.zoom,Te,me),distanceSq:c.au([Z[0]-.5-Te,Z[1]-.5-me]),tileDistanceToCamera:Math.sqrt(Je*Je+dt*dt)})}else for(let at=0;at<4;at++)ve.push({zoom:_e.zoom+1,x:(Te<<1)+at%2,y:(me<<1)+(at>>1),wrap:_e.wrap,fullyVisible:Pe})}return oe.sort((_e,Te)=>_e.distanceSq-Te.distanceSq).map(_e=>_e.tileID)}const je=c.aa.fromPoints([new c.P(0,0),new c.P(c.a5,c.a5)]);function Qt(_){return _==="raster"||_==="image"||_==="video"}function Nn(_,t,s,u,p,y,b){if(!t.hasData())return!1;const{tileID:I,fadingRole:P,fadingDirection:C,fadingParentID:k}=t;if(P===we.Base&&C===Me.Incoming&&k)return s[k.key]=k,!0;const O=Math.max(I.overscaledZ-p,y);for(let F=I.overscaledZ-1;F>=O;F--){const q=I.scaledTo(F),Z=_.getLoadedTile(q);if(Z)return t.setCrossFadeLogic({fadingRole:we.Base,fadingDirection:Me.Incoming,fadingParentID:Z.tileID,fadeEndTime:u+b}),Z.setCrossFadeLogic({fadingRole:we.Parent,fadingDirection:Me.Departing,fadeEndTime:u+b}),s[q.key]=q,!0}return!1}function cr(_,t,s,u,p,y){if(!t.hasData())return!1;const b=t.tileID.children(p);let I=We(_,t,b,s,u,p,y);if(I)return!0;for(const P of b)We(_,t,P.children(p),s,u,p,y)&&(I=!0);return I}function We(_,t,s,u,p,y,b){if(s[0].overscaledZ>=y)return!1;let I=!1;for(const P of s){const C=_.getLoadedTile(P);if(!C)continue;const{fadingRole:k,fadingDirection:O,fadingParentID:F}=C;k===we.Base&&O===Me.Departing&&F||(C.setCrossFadeLogic({fadingRole:we.Base,fadingDirection:Me.Departing,fadingParentID:t.tileID,fadeEndTime:p+b}),t.setCrossFadeLogic({fadingRole:we.Parent,fadingDirection:Me.Incoming,fadeEndTime:p+b})),u[P.key]=P,I=!0}return I}function xr(_,t,s,u){const p=_.tileID;return!!_.selfFading||!_.hasData()&&!!t.has(p)&&(_.setSelfFadeLogic(s+u),!0)}function Yn(_,t){var s;_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let u=t.tileID.canonical.x-_.tileID.canonical.x;const p=t.tileID.canonical.y-_.tileID.canonical.y,y=Math.pow(2,_.tileID.canonical.z),b=t.tileID.key;u===0&&p===0||Math.abs(p)>1||(Math.abs(u)>1&&(Math.abs(u+y)===1?u+=y:Math.abs(u-y)===1&&(u-=y)),t.dem&&_.dem&&(_.dem.backfillBorder(t.dem,u,p),!((s=_.neighboringTiles)===null||s===void 0)&&s[b]&&(_.neighboringTiles[b].backfilled=!0)))}class Zi{constructor(){this._tiles={}}handleWrapJump(t){const s={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+t),s[p.tileID.key]=p}this._tiles=s}setFeatureState(t,s){for(const u in this._tiles)this._tiles[u].setFeatureState(t,s)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map(s=>s.tileID).sort(c.aw).map(s=>s.key):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,s){this._tiles[t]=s}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const s=this.getTileById(t.key);return s!=null&&s.hasData()?s:null}isIdRenderable(t,s=!1){var u;return(u=this.getTileById(t))===null||u===void 0?void 0:u.isRenderable(s)}getRenderableIds(t=0,s){const u=[];for(const p of this.getAllIds())this.isIdRenderable(p,s)&&u.push(this.getTileById(p));return s?u.sort((p,y)=>{const b=p.tileID,I=y.tileID,P=new c.P(b.canonical.x,b.canonical.y)._rotate(-t),C=new c.P(I.canonical.x,I.canonical.y)._rotate(-t);return b.overscaledZ-I.overscaledZ||C.y-P.y||C.x-P.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(c.aw).map(p=>p.key)}}class fr extends c.E{constructor(t,s,u){super(),this.id=t,this.dispatcher=u,this.on("data",p=>this._dataHandler(p)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,y,b,I)=>{const P=new(K(y.type))(p,y,b,I);if(P.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${P.id}`);return P})(t,s,u,this),this._inViewTiles=new Zi,this._outOfViewCache=new c.ax(0,p=>this._unloadTile(p)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Le,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const s of this._inViewTiles.getAllTiles())s.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Zi}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,u){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,u)}catch(p){t.state="errored",p.status!==404?this._source.fire(new c.k(p,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new c.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const s of this._inViewTiles.getAllTiles())s.upload(t),s.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var s;return this._inViewTiles.getRenderableIds((s=this.transform)===null||s===void 0?void 0:s.bearingInRadians,t)}hasRenderableParent(t){const s=t.overscaledZ-1;if(s>=this._source.minzoom){const u=this.getLoadedTile(t.scaledTo(s));if(u)return this._inViewTiles.isIdRenderable(u.tileID.key)}return!1}reload(t,s=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const u of this._inViewTiles.getAllIds()){const p=this._inViewTiles.getTileById(u);s&&!this._source.shouldReloadTile(p,s)||(t?this._reloadTile(u,"expired"):p.state!=="errored"&&this._reloadTile(u,"reloading"))}}}_reloadTile(t,s){return c._(this,void 0,void 0,function*(){const u=this._inViewTiles.getTileById(t);u&&(u.state!=="loading"&&(u.state=s),yield this._loadTile(u,t,s))})}_tileLoaded(t,s,u){t.timeAdded=ke(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&function(p,y){var b,I;const P=y.getRenderableIds();for(const C of P){if(!p.neighboringTiles||!p.neighboringTiles[C])continue;const k=y.getTileById(C);p.neighboringTiles[C].backfilled||Yn(p,k),!((I=(b=k.neighboringTiles)===null||b===void 0?void 0:b[p.tileID.key])===null||I===void 0)&&I.backfilled||Yn(k,p)}}(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,s){const u=this._getLoadedDescendents(s),p=new Set;for(const y of s){const b=u[y.key];if(!(b!=null&&b.length)){p.add(y);continue}const I=y.overscaledZ+fr.maxOverzooming,P=b.filter(O=>O.tileID.overscaledZ<=I);if(!P.length){p.add(y);continue}const C=Math.min(...P.map(O=>O.tileID.overscaledZ)),k=P.filter(O=>O.tileID.overscaledZ===C).map(O=>O.tileID);for(const O of k)t[O.key]=O;this._areDescendentsComplete(k,C,y.overscaledZ)||p.add(y)}return p}_getLoadedDescendents(t){var s;const u={};for(const p of this._inViewTiles.getAllTiles().filter(y=>y.hasData()))for(const y of t)p.tileID.isChildOf(y)&&(u[s=y.key]||(u[s]=[])).push(p);return u}_areDescendentsComplete(t,s,u){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===s:Math.pow(4,s-u)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(s*u*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._outOfViewCache.setMaxSize(y)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,s&&(this._inViewTiles.handleWrapJump(s),this._resetTileReloadTimers())}update(t,s){if(!this._sourceLoaded||this._paused)return;let u;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new c.a2(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(u=yt(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter(P=>this._source.hasTile(P)))):u=[],this.usedForTerrain&&(u=this._addTerrainIdealTiles(u));const p=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,p&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const y=Tt(t,this._source),b=this._updateRetainedTiles(u,y),I=Qt(this._source.type);I&&this._rasterFadeDuration>0&&!s&&function(P,C,k,O,F,q,Z){const te=ke(),ie=c.av(C);for(const re of C){const le=P.getTileById(re.key);le.fadingDirection!==Me.Departing&&le.fadeOpacity!==0||le.resetFadeLogic(),Nn(P,le,k,te,O,F,Z)||cr(P,le,k,te,q,Z)||xr(le,ie,te,Z)||le.resetFadeLogic()}}(this._inViewTiles,u,b,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),I?this._cleanUpRasterTiles(b):this._cleanUpVectorTiles(b)}_cleanUpRasterTiles(t){for(const s of this._inViewTiles.getAllIds())t[s]||this._removeTile(s)}_cleanUpVectorTiles(t){for(const s of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(s);t[s]?u.clearSymbolFadeHold():u.hasSymbolBuckets?u.holdingForSymbolFade()?u.symbolFadeFinished()&&this._removeTile(s):u.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(s)}}_addTerrainIdealTiles(t){const s=[];for(const u of t)if(u.canonical.z>this._source.minzoom){const p=u.scaledTo(u.canonical.z-1);s.push(p);const y=u.scaledTo(Math.max(this._source.minzoom,Math.min(u.canonical.z,5)));s.push(y)}return t.concat(s)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var u;const p=new Set;for(const C of t)this._addTile(C).hasData()||p.add(C);const y=t.reduce((C,k)=>(C[k.key]=k,C),{}),b=this._retainLoadedChildren(y,p),I={},P=Math.max(s-fr.maxUnderzooming,this._source.minzoom);for(const C of b){let k=this._inViewTiles.getTileById(C.key),O=k==null?void 0:k.wasRequested();for(let F=C.overscaledZ-1;F>=P;--F){const q=C.scaledTo(F);if(I[q.key])break;if(I[q.key]=!0,k=this.getTile(q),!k&&O&&(k=this._addTile(q)),k){const Z=k.hasData();if((Z||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||O)&&(y[q.key]=q),O=k.wasRequested(),Z)break}}}return y}_addTile(t){let s=this._inViewTiles.getTileById(t.key);if(s)return s;s=this._outOfViewCache.getAndRemove(t),s&&(s.resetFadeLogic(),this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null));const u=s;return s||(s=new He(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._inViewTiles.setTile(t.key,s),u||this._source.fire(new c.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){this._clearTileReloadTimer(t);const u=s.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_clearTileReloadTimer(t){const s=this._timers[t];s&&(clearTimeout(s),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const s=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,s)}}refreshTiles(t){for(const s of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(s);(this._inViewTiles.isIdRenderable(s)||u.state=="errored")&&t.some(p=>p.equals(u.tileID.canonical))&&this._reloadTile(s,"expired")}}_removeTile(t){const s=this._inViewTiles.getTileById(t);s&&(s.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._outOfViewCache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,s,u){const p=[],y=this.transform;if(!y)return p;const b=y.getCoveringTilesDetailsProvider().allowWorldCopies(),I=u?y.getCameraQueryGeometry(t):t,P=q=>y.screenPointToMercatorCoordinate(q,this.terrain),C=this.transformBbox(t,P,!b),k=this.transformBbox(I,P,!b),O=this.getIds(),F=c.aa.fromPoints(k);for(let q=0;q<O.length;q++){const Z=this._inViewTiles.getTileById(O[q]);if(Z.holdingForSymbolFade())continue;const te=b?[Z.tileID]:[Z.tileID.unwrapTo(-1),Z.tileID.unwrapTo(0)],ie=Math.pow(2,y.zoom-Z.tileID.overscaledZ),re=s*Z.queryPadding*c.a5/Z.tileSize/ie;for(const le of te){const ve=F.map(oe=>le.getTilePoint(new c.a9(oe.x,oe.y)));if(ve.expandBy(re),ve.intersects(je)){const oe=C.map(Te=>le.getTilePoint(Te)),_e=k.map(Te=>le.getTilePoint(Te));p.push({tile:Z,tileID:b?le:le.unwrapTo(0),queryGeometry:oe,cameraQueryGeometry:_e,scale:ie})}}}return p}transformBbox(t,s,u){let p=t.map(s);if(u){const y=c.aa.fromPoints(t);y.shrinkBy(.001*Math.min(y.width(),y.height()));const b=y.map(s);c.aa.fromPoints(p).covers(b)||(p=p.map(I=>I.x>.5?new c.a9(I.x-1,I.y,I.z):I))}return p}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(u=>this._inViewTiles.getTileById(u).tileID);return this.transform&&this.transform.populateCache(s),s}hasTransition(){return!!this._source.hasTransition()||!(!Qt(this._source.type)||!function(t,s){if(s<=0)return!1;const u=ke();for(const p of t.getAllTiles())if(p.fadeEndTime>=u)return!0;return!1}(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,s,u){this._state.updateState(t=t||c.ai,s,u)}removeFeatureState(t,s,u){this._state.removeFeatureState(t=t||c.ai,s,u)}getFeatureState(t,s){return this._state.getState(t=t||c.ai,s)}setDependencies(t,s,u){const p=this._inViewTiles.getTileById(t);p&&p.setDependencies(s,u)}reloadTilesForDependencies(t,s){for(const u of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(u).hasDependency(t,s)&&this._reloadTile(u,"reloading");this._outOfViewCache.filter(u=>!u.hasDependency(t,s))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}fr.maxUnderzooming=10,fr.maxOverzooming=3;class st{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=c.an(t,0,1);let s=1,u=this._distances[s];const p=t*this.paddedLength+this.padding;for(;u<p&&s<this._distances.length;)u=this._distances[++s];const y=s-1,b=this._distances[y],I=u-b,P=I>0?(p-b)/I:0;return this.points[y].mult(1-P).add(this.points[s].mult(P))}}function At(_,t){let s=!0;return _==="always"||_!=="never"&&t!=="never"||(s=!1),s}class Bt{constructor(t,s,u){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(s/u);for(let b=0;b<this.xCellCount*this.yCellCount;b++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,u,p,y){this._forEachCell(s,u,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(t,s,u,p){this._forEachCell(s-p,u-p,s+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,s,u,p,y,b){this.boxCells[y].push(b)}_insertCircleCell(t,s,u,p,y,b){this.circleCells[y].push(b)}_query(t,s,u,p,y,b,I){if(u<0||t>this.width||p<0||s>this.height)return[];const P=[];if(t<=0&&s<=0&&this.width<=u&&this.height<=p){if(y)return[{key:null,x1:t,y1:s,x2:u,y2:p}];for(let C=0;C<this.boxKeys.length;C++)P.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const k=this.circles[3*C],O=this.circles[3*C+1],F=this.circles[3*C+2];P.push({key:this.circleKeys[C],x1:k-F,y1:O-F,x2:k+F,y2:O+F})}}else this._forEachCell(t,s,u,p,this._queryCell,P,{hitTest:y,overlapMode:b,seenUids:{box:{},circle:{}}},I);return P}query(t,s,u,p){return this._query(t,s,u,p,!1,null)}hitTest(t,s,u,p,y,b){return this._query(t,s,u,p,!0,y,b).length>0}hitTestCircle(t,s,u,p,y){const b=t-u,I=t+u,P=s-u,C=s+u;if(I<0||b>this.width||C<0||P>this.height)return!1;const k=[];return this._forEachCell(b,P,I,C,this._queryCellCircle,k,{hitTest:!0,overlapMode:p,circle:{x:t,y:s,radius:u},seenUids:{box:{},circle:{}}},y),k.length>0}_queryCell(t,s,u,p,y,b,I,P){const{seenUids:C,hitTest:k,overlapMode:O}=I,F=this.boxCells[y];if(F!==null){const Z=this.bboxes;for(const te of F)if(!C.box[te]){C.box[te]=!0;const ie=4*te,re=this.boxKeys[te];if(t<=Z[ie+2]&&s<=Z[ie+3]&&u>=Z[ie+0]&&p>=Z[ie+1]&&(!P||P(re))&&(!k||!At(O,re.overlapMode))&&(b.push({key:re,x1:Z[ie],y1:Z[ie+1],x2:Z[ie+2],y2:Z[ie+3]}),k))return!0}}const q=this.circleCells[y];if(q!==null){const Z=this.circles;for(const te of q)if(!C.circle[te]){C.circle[te]=!0;const ie=3*te,re=this.circleKeys[te];if(this._circleAndRectCollide(Z[ie],Z[ie+1],Z[ie+2],t,s,u,p)&&(!P||P(re))&&(!k||!At(O,re.overlapMode))){const le=Z[ie],ve=Z[ie+1],oe=Z[ie+2];if(b.push({key:re,x1:le-oe,y1:ve-oe,x2:le+oe,y2:ve+oe}),k)return!0}}}return!1}_queryCellCircle(t,s,u,p,y,b,I,P){const{circle:C,seenUids:k,overlapMode:O}=I,F=this.boxCells[y];if(F!==null){const Z=this.bboxes;for(const te of F)if(!k.box[te]){k.box[te]=!0;const ie=4*te,re=this.boxKeys[te];if(this._circleAndRectCollide(C.x,C.y,C.radius,Z[ie+0],Z[ie+1],Z[ie+2],Z[ie+3])&&(!P||P(re))&&!At(O,re.overlapMode))return b.push(!0),!0}}const q=this.circleCells[y];if(q!==null){const Z=this.circles;for(const te of q)if(!k.circle[te]){k.circle[te]=!0;const ie=3*te,re=this.circleKeys[te];if(this._circlesCollide(Z[ie],Z[ie+1],Z[ie+2],C.x,C.y,C.radius)&&(!P||P(re))&&!At(O,re.overlapMode))return b.push(!0),!0}}}_forEachCell(t,s,u,p,y,b,I,P){const C=this._convertToXCellCoord(t),k=this._convertToYCellCoord(s),O=this._convertToXCellCoord(u),F=this._convertToYCellCoord(p);for(let q=C;q<=O;q++)for(let Z=k;Z<=F;Z++)if(y.call(this,t,s,u,p,this.xCellCount*Z+q,b,I,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,u,p,y,b){const I=p-t,P=y-s,C=u+b;return C*C>I*I+P*P}_circleAndRectCollide(t,s,u,p,y,b,I){const P=(b-p)/2,C=Math.abs(t-(p+P));if(C>P+u)return!1;const k=(I-y)/2,O=Math.abs(s-(y+k));if(O>k+u)return!1;if(C<=P||O<=k)return!0;const F=C-P,q=O-k;return F*F+q*q<=u*u}}function Cr(_,t,s){const u=c.N();if(!_){const{vecSouth:O,vecEast:F}=er(t),q=B();q[0]=F[0],q[1]=F[1],q[2]=O[0],q[3]=O[1],p=q,(k=(b=(y=q)[0])*(C=y[3])-(P=y[2])*(I=y[1]))&&(p[0]=C*(k=1/k),p[1]=-I*k,p[2]=-P*k,p[3]=b*k),u[0]=q[0],u[1]=q[1],u[4]=q[2],u[5]=q[3]}var p,y,b,I,P,C,k;return c.Q(u,u,[1/s,1/s,1]),u}function ki(_,t,s,u){if(_){const p=c.N();if(!t){const{vecSouth:y,vecEast:b}=er(s);p[0]=b[0],p[1]=b[1],p[4]=y[0],p[5]=y[1]}return c.Q(p,p,[u,u,1]),p}return s.pixelsToClipSpaceMatrix}function er(_){const t=Math.cos(_.rollInRadians),s=Math.sin(_.rollInRadians),u=Math.cos(_.pitchInRadians),p=Math.cos(_.bearingInRadians),y=Math.sin(_.bearingInRadians),b=c.aC();b[0]=-p*u*s-y*t,b[1]=-y*u*s+p*t;const I=c.aD(b);I<1e-9?c.aE(b):c.aF(b,b,1/I);const P=c.aC();P[0]=p*u*t-y*s,P[1]=y*u*t+p*s;const C=c.aD(P);return C<1e-9?c.aE(P):c.aF(P,P,1/C),{vecEast:P,vecSouth:b}}function Ct(_,t,s,u){let p;u?(p=[_,t,u(_,t),1],c.aH(p,p,s)):(p=[_,t,0,1],Mr(p,p,s));const y=p[3];return{point:new c.P(p[0]/y,p[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function Kn(_,t){return .5+_/t*.5}function ci(_,t){return _.x>=-t[0]&&_.x<=t[0]&&_.y>=-t[1]&&_.y<=t[1]}function Di(_,t,s,u,p,y,b,I,P,C,k,O,F){const q=s?_.textSizeData:_.iconSizeData,Z=c.ay(q,t.transform.zoom),te=[256/t.width*2+1,256/t.height*2+1],ie=s?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ie.clear();const re=_.lineVertexArray,le=s?_.text.placedSymbolArray:_.icon.placedSymbolArray,ve=t.transform.width/t.transform.height;let oe=!1;for(let _e=0;_e<le.length;_e++){const Te=le.get(_e);if(Te.hidden||Te.writingMode===c.az.vertical&&!oe){Ur(Te.numGlyphs,ie);continue}oe=!1;const me=new c.P(Te.anchorX,Te.anchorY),Pe={getElevation:F,pitchedLabelPlaneMatrix:u,lineVertexArray:re,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:me,unwrappedTileID:P,width:C,height:k,translation:O},Be=Xr(Te.anchorX,Te.anchorY,Pe);if(!ci(Be.point,te)){Ur(Te.numGlyphs,ie);continue}const Fe=Kn(t.transform.cameraToCenterDistance,Be.signedDistanceFromCamera),Oe=c.aA(q,Z,Te),Ne=y?Oe*t.transform.getPitchedTextCorrection(Te.anchorX,Te.anchorY,P)/Fe:Oe*Fe,it=os({projectionContext:Pe,pitchedLabelPlaneMatrixInverse:p,symbol:Te,fontSize:Ne,flip:!1,keepUpright:b,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ie,aspectRatio:ve,rotateToLine:I});oe=it.useVertical,(it.notEnoughRoom||oe||it.needsFlipping&&os({projectionContext:Pe,pitchedLabelPlaneMatrixInverse:p,symbol:Te,fontSize:Ne,flip:!0,keepUpright:b,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ie,aspectRatio:ve,rotateToLine:I}).notEnoughRoom)&&Ur(Te.numGlyphs,ie)}s?_.text.dynamicLayoutVertexBuffer.updateData(ie):_.icon.dynamicLayoutVertexBuffer.updateData(ie)}function Kr(_,t,s,u,p,y,b,I){const P=y.glyphStartIndex+y.numGlyphs,C=y.lineStartIndex,k=y.lineStartIndex+y.lineLength,O=t.getoffsetX(y.glyphStartIndex),F=t.getoffsetX(P-1),q=Yr(_*O,s,u,p,y.segment,C,k,I,b);if(!q)return null;const Z=Yr(_*F,s,u,p,y.segment,C,k,I,b);return Z?I.projectionCache.anyProjectionOccluded?null:{first:q,last:Z}:null}function Wi(_,t,s,u){return _===c.az.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*u?{useVertical:!0}:(_===c.az.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function os(_){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:s,symbol:u,fontSize:p,flip:y,keepUpright:b,glyphOffsetArray:I,dynamicLayoutVertexArray:P,aspectRatio:C,rotateToLine:k}=_,O=p/24,F=u.lineOffsetX*O,q=u.lineOffsetY*O;let Z;if(u.numGlyphs>1){const te=u.glyphStartIndex+u.numGlyphs,ie=u.lineStartIndex,re=u.lineStartIndex+u.lineLength,le=Kr(O,I,F,q,y,u,k,t);if(!le)return{notEnoughRoom:!0};const ve=as(le.first.point.x,le.first.point.y,t,s),oe=as(le.last.point.x,le.last.point.y,t,s);if(b&&!y){const _e=Wi(u.writingMode,ve,oe,C);if(_e)return _e}Z=[le.first];for(let _e=u.glyphStartIndex+1;_e<te-1;_e++){const Te=Yr(O*I.getoffsetX(_e),F,q,y,u.segment,ie,re,t,k);if(!Te)return{notEnoughRoom:!0};Z.push(Te)}Z.push(le.last)}else{if(b&&!y){const ie=Ln(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,re=u.lineStartIndex+u.segment+1,le=new c.P(t.lineVertexArray.getx(re),t.lineVertexArray.gety(re)),ve=Ln(le.x,le.y,t),oe=ve.signedDistanceFromCamera>0?ve.point:Li(t.tileAnchorPoint,le,ie,1,t),_e=as(ie.x,ie.y,t,s),Te=as(oe.x,oe.y,t,s),me=Wi(u.writingMode,_e,Te,C);if(me)return me}const te=Yr(O*I.getoffsetX(u.glyphStartIndex),F,q,y,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,t,k);if(!te||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[te]}for(const te of Z)c.aG(P,te.point,te.angle);return{}}function Li(_,t,s,u,p){const y=_.add(_.sub(t)._unit()),b=Ln(y.x,y.y,p).point,I=s.sub(b);return s.add(I._mult(u/I.mag()))}function br(_,t,s){const u=t.projectionCache;if(u.projections[_])return u.projections[_];const p=new c.P(t.lineVertexArray.getx(_),t.lineVertexArray.gety(_)),y=Ln(p.x,p.y,t);if(y.signedDistanceFromCamera>0)return u.projections[_]=y.point,u.anyProjectionOccluded=u.anyProjectionOccluded||y.isOccluded,y.point;const b=_-s.direction;return Li(s.distanceFromAnchor===0?t.tileAnchorPoint:new c.P(t.lineVertexArray.getx(b),t.lineVertexArray.gety(b)),p,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function Ln(_,t,s){const u=_+s.translation[0],p=t+s.translation[1];let y;return s.pitchWithMap?(y=Ct(u,p,s.pitchedLabelPlaneMatrix,s.getElevation),y.isOccluded=!1):(y=s.transform.projectTileCoordinates(u,p,s.unwrappedTileID,s.getElevation),y.point.x=(.5*y.point.x+.5)*s.width,y.point.y=(.5*-y.point.y+.5)*s.height),y}function as(_,t,s,u){if(s.pitchWithMap){const p=[_,t,0,1];return c.aH(p,p,u),s.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],s.unwrappedTileID,s.getElevation).point}return{x:_/s.width*2-1,y:1-t/s.height*2}}function Xr(_,t,s){return s.transform.projectTileCoordinates(_,t,s.unwrappedTileID,s.getElevation)}function gi(_,t,s){return _._unit()._perp()._mult(t*s)}function zi(_,t,s,u,p,y,b,I,P){if(I.projectionCache.offsets[_])return I.projectionCache.offsets[_];const C=s.add(t);if(_+P.direction<u||_+P.direction>=p)return I.projectionCache.offsets[_]=C,C;const k=br(_+P.direction,I,P),O=gi(k.sub(s),b,P.direction),F=s.add(O),q=k.add(O);return I.projectionCache.offsets[_]=c.aI(y,C,F,q)||C,I.projectionCache.offsets[_]}function Yr(_,t,s,u,p,y,b,I,P){const C=u?_-t:_+t;let k=C>0?1:-1,O=0;u&&(k*=-1,O=Math.PI),k<0&&(O+=Math.PI);let F,q=k>0?y+p:y+p+1;I.projectionCache.cachedAnchorPoint?F=I.projectionCache.cachedAnchorPoint:(F=Ln(I.tileAnchorPoint.x,I.tileAnchorPoint.y,I).point,I.projectionCache.cachedAnchorPoint=F);let Z,te,ie=F,re=F,le=0,ve=0;const oe=Math.abs(C),_e=[];let Te;for(;le+ve<=oe;){if(q+=k,q<y||q>=b)return null;le+=ve,re=ie,te=Z;const Be={absOffsetX:oe,direction:k,distanceFromAnchor:le,previousVertex:re};if(ie=br(q,I,Be),s===0)_e.push(re),Te=ie.sub(re);else{let Fe;const Oe=ie.sub(re);Fe=Oe.mag()===0?gi(br(q+k,I,Be).sub(ie),s,k):gi(Oe,s,k),te||(te=re.add(Fe)),Z=zi(q,Fe,ie,y,b,te,s,I,Be),_e.push(te),Te=Z.sub(te)}ve=Te.mag()}const me=Te._mult((oe-le)/ve)._add(te||re),Pe=O+Math.atan2(ie.y-re.y,ie.x-re.x);return _e.push(me),{point:me,angle:P?Pe:0,path:_e}}const _o=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ur(_,t){for(let s=0;s<_;s++){const u=t.length;t.resize(u+4),t.float32.set(_o,3*u)}}function Mr(_,t,s){const u=t[0],p=t[1];return _[0]=s[0]*u+s[4]*p+s[12],_[1]=s[1]*u+s[5]*p+s[13],_[3]=s[3]*u+s[7]*p+s[15],_}const qn=100;class ls{constructor(t,s=new Bt(t.width+200,t.height+200,25),u=new Bt(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=u,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+qn,this.screenBottomBoundary=t.height+qn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,u,p,y,b,I,P,C,k,O,F){const q=this.projectAndGetPerspectiveRatio(t.anchorPointX+P[0],t.anchorPointY+P[1],y,k,F),Z=u*q.perspectiveRatio;let te;if(b||I)te=this._projectCollisionBox(t,Z,p,y,b,I,P,q,k,O,F);else{const Te=q.x+(O?O.x*Z:0),me=q.y+(O?O.y*Z:0);te={allPointsOccluded:!1,box:[Te+t.x1*Z,me+t.y1*Z,Te+t.x2*Z,me+t.y2*Z]}}const[ie,re,le,ve]=te.box,oe=b?te.allPointsOccluded:q.isOccluded;let _e=oe;return _e||(_e=q.perspectiveRatio<this.perspectiveRatioCutoff),_e||(_e=!this.isInsideGrid(ie,re,le,ve)),_e||s!=="always"&&this.grid.hitTest(ie,re,le,ve,s,C)?{box:[ie,re,le,ve],placeable:!1,offscreen:!1,occluded:oe}:{box:[ie,re,le,ve],placeable:!0,offscreen:this.isOffscreen(ie,re,le,ve),occluded:oe}}placeCollisionCircles(t,s,u,p,y,b,I,P,C,k,O,F,q,Z){const te=[],ie=new c.P(s.anchorX,s.anchorY),re=this.getPerspectiveRatio(ie.x,ie.y,b,Z),le=(C?y*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,b)/re:y*re)/c.aM,ve={getElevation:Z,pitchedLabelPlaneMatrix:I,lineVertexArray:u,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ie,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:q},oe=Kr(le,p,s.lineOffsetX*le,s.lineOffsetY*le,!1,s,!1,ve);let _e=!1,Te=!1,me=!0;if(oe){const Pe=.5*O*re+F,Be=new c.P(-100,-100),Fe=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Oe=new st,Ne=oe.first,it=oe.last;let at=[];for(let sn=Ne.path.length-1;sn>=1;sn--)at.push(Ne.path[sn]);for(let sn=1;sn<it.path.length;sn++)at.push(it.path[sn]);const Je=2.5*Pe;if(C){const sn=this.projectPathToScreenSpace(at,ve);at=sn.some(Xn=>Xn.signedDistanceFromCamera<=0)?[]:sn.map(Xn=>Xn.point)}let dt=[];if(at.length>0){const sn=at[0].clone(),Xn=at[0].clone();for(let dr=1;dr<at.length;dr++)sn.x=Math.min(sn.x,at[dr].x),sn.y=Math.min(sn.y,at[dr].y),Xn.x=Math.max(Xn.x,at[dr].x),Xn.y=Math.max(Xn.y,at[dr].y);dt=sn.x>=Be.x&&Xn.x<=Fe.x&&sn.y>=Be.y&&Xn.y<=Fe.y?[at]:Xn.x<Be.x||sn.x>Fe.x||Xn.y<Be.y||sn.y>Fe.y?[]:c.aJ([at],Be.x,Be.y,Fe.x,Fe.y)}for(const sn of dt){Oe.reset(sn,.25*Pe);let Xn=0;Xn=Oe.length<=.5*Pe?1:Math.ceil(Oe.paddedLength/Je)+1;for(let dr=0;dr<Xn;dr++){const nr=dr/Math.max(Xn-1,1),gr=Oe.lerp(nr),rr=gr.x+qn,Ir=gr.y+qn;te.push(rr,Ir,Pe,0);const _r=rr-Pe,ti=Ir-Pe,Or=rr+Pe,Dr=Ir+Pe;if(me=me&&this.isOffscreen(_r,ti,Or,Dr),Te=Te||this.isInsideGrid(_r,ti,Or,Dr),t!=="always"&&this.grid.hitTestCircle(rr,Ir,Pe,t,k)&&(_e=!0,!P))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!P&&_e||!Te||re<this.perspectiveRatioCutoff?[]:te,offscreen:me,collisionDetected:_e}}projectPathToScreenSpace(t,s){const u=function(p,y){const b=c.N();return c.aB(b,y.pitchedLabelPlaneMatrix),p.map(I=>{const P=Ct(I.x,I.y,b,y.getElevation),C=y.transform.projectTileCoordinates(P.point.x,P.point.y,y.unwrappedTileID,y.getElevation);return C.point.x=(.5*C.point.x+.5)*y.width,C.point.y=(.5*-C.point.y+.5)*y.height,C})}(t,s);return function(p){let y=0,b=0,I=0,P=0;for(let C=0;C<p.length;C++)p[C].isOccluded?(I=C+1,P=0):(P++,P>b&&(b=P,y=I));return p.slice(y,y+b)}(u)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[],u=new c.aa;for(const O of t){const F=new c.P(O.x+qn,O.y+qn);u.extend(F),s.push(F)}const{minX:p,minY:y,maxX:b,maxY:I}=u,P=this.grid.query(p,y,b,I).concat(this.ignoredGrid.query(p,y,b,I)),C={},k={};for(const O of P){const F=O.key;if(C[F.bucketInstanceId]===void 0&&(C[F.bucketInstanceId]={}),C[F.bucketInstanceId][F.featureIndex])continue;const q=[new c.P(O.x1,O.y1),new c.P(O.x2,O.y1),new c.P(O.x2,O.y2),new c.P(O.x1,O.y2)];c.aK(s,q)&&(C[F.bucketInstanceId][F.featureIndex]=!0,k[F.bucketInstanceId]===void 0&&(k[F.bucketInstanceId]=[]),k[F.bucketInstanceId].push(F.featureIndex))}return k}insertCollisionBox(t,s,u,p,y,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:b,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,u,p,y,b){const I=u?this.ignoredGrid:this.grid,P={bucketInstanceId:p,featureIndex:y,collisionGroupID:b,overlapMode:s};for(let C=0;C<t.length;C+=4)I.insertCircle(P,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,s,u,p,y){if(y){let b;p?(b=[t,s,p(t,s),1],c.aH(b,b,y)):(b=[t,s,0,1],Mr(b,b,y));const I=b[3];return{x:(b[0]/I+1)/2*this.transform.width+qn,y:(-b[1]/I+1)/2*this.transform.height+qn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I*.5,isOccluded:!1,signedDistanceFromCamera:I}}{const b=this.transform.projectTileCoordinates(t,s,u,p);return{x:(b.point.x+1)/2*this.transform.width+qn,y:(1-b.point.y)/2*this.transform.height+qn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5,isOccluded:b.isOccluded,signedDistanceFromCamera:b.signedDistanceFromCamera}}}getPerspectiveRatio(t,s,u,p){const y=this.transform.projectTileCoordinates(t,s,u,p);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(t,s,u,p){return u<qn||t>=this.screenRightBoundary||p<qn||s>this.screenBottomBoundary}isInsideGrid(t,s,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=c.ar([]);return c.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,u,p,y,b,I,P,C,k,O){let F=1,q=0,Z=0,te=1;const ie=t.anchorPointX+I[0],re=t.anchorPointY+I[1];if(b&&!y){const at=this.projectAndGetPerspectiveRatio(ie+1,re,p,C,O),Je=at.x-P.x,dt=Math.atan((at.y-P.y)/Je)+(Je<0?Math.PI:0),sn=Math.sin(dt),Xn=Math.cos(dt);F=Xn,q=sn,Z=-sn,te=Xn}else if(!b&&y){const at=er(this.transform);F=at.vecEast[0],q=at.vecEast[1],Z=at.vecSouth[0],te=at.vecSouth[1]}let le=P.x,ve=P.y,oe=s;y&&(le=ie,ve=re,oe=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),oe*=this.transform.getPitchedTextCorrection(ie,re,p),k||(oe*=c.an(.5+P.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),k&&(le+=F*k.x*oe+Z*k.y*oe,ve+=q*k.x*oe+te*k.y*oe);const _e=t.x1*oe,Te=t.x2*oe,me=(_e+Te)/2,Pe=t.y1*oe,Be=t.y2*oe,Fe=(Pe+Be)/2,Oe=[{offsetX:_e,offsetY:Pe},{offsetX:me,offsetY:Pe},{offsetX:Te,offsetY:Pe},{offsetX:Te,offsetY:Fe},{offsetX:Te,offsetY:Be},{offsetX:me,offsetY:Be},{offsetX:_e,offsetY:Be},{offsetX:_e,offsetY:Fe}];let Ne=[];for(const{offsetX:at,offsetY:Je}of Oe)Ne.push(new c.P(le+F*at+Z*Je,ve+q*at+te*Je));let it=!1;if(y){const at=Ne.map(Je=>this.projectAndGetPerspectiveRatio(Je.x,Je.y,p,C,O));it=at.some(Je=>!Je.isOccluded),Ne=at.map(Je=>new c.P(Je.x,Je.y))}else it=!0;return{box:c.aL(Ne),allPointsOccluded:!it}}}class cs{constructor(t,s,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Fn{constructor(t,s,u,p,y){this.text=new cs(t?t.text:null,s,u,y),this.icon=new cs(t?t.icon:null,s,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ki{constructor(t,s,u){this.text=t,this.icon=s,this.skipFade=u}}class us{constructor(t,s,u,p,y){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=y}}class hs{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[t]}}function yo(_,t,s,u,p){const{horizontalAlign:y,verticalAlign:b}=c.aS(_);return new c.P(-(y-.5)*t+u[0]*p,-(b-.5)*s+u[1]*p)}class vo{constructor(t,s,u,p,y){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new ls(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new hs(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(u,p)=>s.getElevation(t,u,p):null}getBucketParts(t,s,u,p){const y=u.getBucket(s),b=u.latestFeatureIndex;if(!y||!b||s.id!==y.layerIds[0])return;const I=u.collisionBoxArray,P=y.layers[0].layout,C=y.layers[0].paint,k=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),O=u.tileSize/c.a5,F=u.tileID.toUnwrapped(),q=P.get("text-rotation-alignment")==="map",Z=c.aN(u,1,this.transform.zoom),te=c.aO(this.collisionIndex.transform,u,C.get("text-translate"),C.get("text-translate-anchor")),ie=c.aO(this.collisionIndex.transform,u,C.get("icon-translate"),C.get("icon-translate-anchor")),re=Cr(q,this.transform,Z);this.retainedQueryData[y.bucketInstanceId]=new us(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,u.tileID);const le={bucket:y,layout:P,translationText:te,translationIcon:ie,unwrappedTileID:F,pitchedLabelPlaneMatrix:re,scale:k,textPixelRatio:O,holdingForFade:u.holdingForSymbolFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:c.ay(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const ve of y.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:_e,symbolInstanceEnd:Te}=ve;t.push({sortKey:oe,symbolInstanceStart:_e,symbolInstanceEnd:Te,parameters:le})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:le})}attemptAnchorPlacement(t,s,u,p,y,b,I,P,C,k,O,F,q,Z,te,ie,re,le,ve,oe){const _e=c.aP[t.textAnchor],Te=[t.textOffset0,t.textOffset1],me=yo(_e,u,p,Te,y),Pe=this.collisionIndex.placeCollisionBox(s,F,P,C,k,I,b,ie,O.predicate,ve,me,oe);if((!le||this.collisionIndex.placeCollisionBox(le,F,P,C,k,I,b,re,O.predicate,ve,me,oe).placeable)&&Pe.placeable){let Be;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(Be=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Te,width:u,height:p,anchor:_e,textBoxScale:y,prevAnchor:Be},this.markUsedJustification(Z,_e,q,te),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,te,q),this.placedOrientations[q.crossTileID]=te),{shift:me,placedGlyphBoxes:Pe}}}placeLayerBucketPart(t,s,u){const{bucket:p,layout:y,translationText:b,translationIcon:I,unwrappedTileID:P,pitchedLabelPlaneMatrix:C,textPixelRatio:k,holdingForFade:O,collisionBoxArray:F,partiallyEvaluatedTextSize:q,collisionGroup:Z}=t.parameters,te=y.get("text-optional"),ie=y.get("icon-optional"),re=c.aQ(y,"text-overlap","text-allow-overlap"),le=re==="always",ve=c.aQ(y,"icon-overlap","icon-allow-overlap"),oe=ve==="always",_e=y.get("text-rotation-alignment")==="map",Te=y.get("text-pitch-alignment")==="map",me=y.get("icon-text-fit")!=="none",Pe=y.get("symbol-z-order")==="viewport-y",Be=le&&(oe||!p.hasIconData()||ie),Fe=oe&&(le||!p.hasTextData()||te);!p.collisionArrays&&F&&p.deserializeCollisionBoxes(F);const Oe=this.retainedQueryData[p.bucketInstanceId].tileID,Ne=this._getTerrainElevationFunc(Oe),it=this.transform.getFastPathSimpleProjectionMatrix(Oe),at=(Je,dt,sn)=>{var Xn,dr;if(s[Je.crossTileID])return;if(O)return void(this.placements[Je.crossTileID]=new Ki(!1,!1,!1));let nr=!1,gr=!1,rr=!0,Ir=null,_r={box:null,placeable:!1,offscreen:null,occluded:!1},ti={placeable:!1},Or=null,Dr=null,di=null,Mo=0,so=0,Zs=0;dt.textFeatureIndex?Mo=dt.textFeatureIndex:Je.useRuntimeCollisionCircles&&(Mo=Je.featureIndex),dt.verticalTextFeatureIndex&&(so=dt.verticalTextFeatureIndex);const Ni=dt.textBox;if(Ni){const _s=ar=>{let ir=c.az.horizontal;if(p.allowVerticalPlacement&&!ar&&this.prevPlacement){const Hr=this.prevPlacement.placedOrientations[Je.crossTileID];Hr&&(this.placedOrientations[Je.crossTileID]=Hr,ir=Hr,this.markUsedOrientation(p,ir,Je))}return ir},Ws=(ar,ir)=>{if(p.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&dt.verticalTextBox){for(const Hr of p.writingModes)if(Hr===c.az.vertical?(_r=ir(),ti=_r):_r=ar(),_r&&_r.placeable)break}else _r=ar()},Cs=Je.textAnchorOffsetStartIndex,Ms=Je.textAnchorOffsetEndIndex;if(Ms===Cs){const ar=(ir,Hr)=>{const Zr=this.collisionIndex.placeCollisionBox(ir,re,k,Oe,P,Te,_e,b,Z.predicate,Ne,void 0,it);return Zr&&Zr.placeable&&(this.markUsedOrientation(p,Hr,Je),this.placedOrientations[Je.crossTileID]=Hr),Zr};Ws(()=>ar(Ni,c.az.horizontal),()=>{const ir=dt.verticalTextBox;return p.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&ir?ar(ir,c.az.vertical):{box:null,offscreen:null}}),_s(_r&&_r.placeable)}else{let ar=c.aP[(dr=(Xn=this.prevPlacement)===null||Xn===void 0?void 0:Xn.variableOffsets[Je.crossTileID])===null||dr===void 0?void 0:dr.anchor];const ir=(Zr,mp,gp)=>{const ua=Zr.x2-Zr.x1,Em=Zr.y2-Zr.y1,_p=Je.textBoxScale,Ph=me&&ve==="never"?mp:null;let Ro=null,ko=re==="never"?1:2,Do="never";ar&&ko++;for(let Ah=0;Ah<ko;Ah++){for(let Ch=Cs;Ch<Ms;Ch++){const eu=p.textAnchorOffsets.get(Ch);if(ar&&eu.textAnchor!==ar)continue;const tu=this.attemptAnchorPlacement(eu,Zr,ua,Em,_p,_e,Te,k,Oe,P,Z,Do,Je,p,gp,b,I,Ph,Ne);if(tu&&(Ro=tu.placedGlyphBoxes,Ro&&Ro.placeable))return nr=!0,Ir=tu.shift,Ro}ar?ar=null:Do=re}return u&&!Ro&&(Ro={box:this.collisionIndex.placeCollisionBox(Ni,"always",k,Oe,P,Te,_e,b,Z.predicate,Ne,void 0,it).box,offscreen:!1,placeable:!1,occluded:!1}),Ro};Ws(()=>ir(Ni,dt.iconBox,c.az.horizontal),()=>{const Zr=dt.verticalTextBox;return p.allowVerticalPlacement&&(!_r||!_r.placeable)&&Je.numVerticalGlyphVertices>0&&Zr?ir(Zr,dt.verticalIconBox,c.az.vertical):{box:null,occluded:!0,offscreen:null}}),_r&&(nr=_r.placeable,rr=_r.offscreen);const Hr=_s(_r&&_r.placeable);if(!nr&&this.prevPlacement){const Zr=this.prevPlacement.variableOffsets[Je.crossTileID];Zr&&(this.variableOffsets[Je.crossTileID]=Zr,this.markUsedJustification(p,Zr.anchor,Je,Hr))}}}if(Or=_r,nr=Or&&Or.placeable,rr=Or&&Or.offscreen,Je.useRuntimeCollisionCircles&&Je.centerJustifiedTextSymbolIndex>=0){const _s=p.text.placedSymbolArray.get(Je.centerJustifiedTextSymbolIndex),Ws=c.aA(p.textSizeData,q,_s),Cs=y.get("text-padding");Dr=this.collisionIndex.placeCollisionCircles(re,_s,p.lineVertexArray,p.glyphOffsetArray,Ws,P,C,u,Te,Z.predicate,Je.collisionCircleDiameter,Cs,b,Ne),Dr.circles.length&&Dr.collisionDetected&&!u&&c.w("Collisions detected, but collision boxes are not shown"),nr=le||Dr.circles.length>0&&!Dr.collisionDetected,rr=rr&&Dr.offscreen}if(dt.iconFeatureIndex&&(Zs=dt.iconFeatureIndex),dt.iconBox){const _s=Ws=>this.collisionIndex.placeCollisionBox(Ws,ve,k,Oe,P,Te,_e,I,Z.predicate,Ne,me&&Ir?Ir:void 0,it);ti&&ti.placeable&&dt.verticalIconBox?(di=_s(dt.verticalIconBox),gr=di.placeable):(di=_s(dt.iconBox),gr=di.placeable),rr=rr&&di.offscreen}const la=te||Je.numHorizontalGlyphVertices===0&&Je.numVerticalGlyphVertices===0,Zl=ie||Je.numIconVertices===0;la||Zl?Zl?la||(gr=gr&&nr):nr=gr&&nr:gr=nr=gr&&nr;const ca=gr&&di.placeable;if(nr&&Or.placeable&&this.collisionIndex.insertCollisionBox(Or.box,re,y.get("text-ignore-placement"),p.bucketInstanceId,ti&&ti.placeable&&so?so:Mo,Z.ID),ca&&this.collisionIndex.insertCollisionBox(di.box,ve,y.get("icon-ignore-placement"),p.bucketInstanceId,Zs,Z.ID),Dr&&nr&&this.collisionIndex.insertCollisionCircles(Dr.circles,re,y.get("text-ignore-placement"),p.bucketInstanceId,Mo,Z.ID),u&&this.storeCollisionData(p.bucketInstanceId,sn,dt,Or,di,Dr),Je.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Je.crossTileID]=new Ki((nr||Be)&&!(Or!=null&&Or.occluded),(gr||Fe)&&!(di!=null&&di.occluded),rr||p.justReloaded),s[Je.crossTileID]=!0};if(Pe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Je=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let dt=Je.length-1;dt>=0;--dt){const sn=Je[dt];at(p.symbolInstances.get(sn),p.collisionArrays[sn],sn)}}else for(let Je=t.symbolInstanceStart;Je<t.symbolInstanceEnd;Je++)at(p.symbolInstances.get(Je),p.collisionArrays[Je],Je);p.justReloaded=!1}storeCollisionData(t,s,u,p,y,b){if(u.textBox||u.iconBox){let I,P;this.collisionBoxArrays.has(t)?I=this.collisionBoxArrays.get(t):(I=new Map,this.collisionBoxArrays.set(t,I)),I.has(s)?P=I.get(s):(P={text:null,icon:null},I.set(s,P)),u.textBox&&(P.text=p.box),u.iconBox&&(P.icon=y.box)}if(b){let I=this.collisionCircleArrays[t];I===void 0&&(I=this.collisionCircleArrays[t]=[]);for(let P=0;P<b.circles.length;P+=4)I.push(b.circles[P+0]-qn),I.push(b.circles[P+1]-qn),I.push(b.circles[P+2]),I.push(b.collisionDetected?1:0)}}markUsedJustification(t,s,u,p){let y;y=p===c.az.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[c.aR(s)];const b=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const I of b)I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=y>=0&&I!==y?0:u.crossTileID)}markUsedOrientation(t,s,u){const p=s===c.az.horizontal||s===c.az.horizontalOnly?s:0,y=s===c.az.vertical?s:0,b=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const I of b)t.text.placedSymbolArray.get(I).placedOrientation=p;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(t):1,y=s?s.opacities:{},b=s?s.variableOffsets:{},I=s?s.placedOrientations:{};for(const P in this.placements){const C=this.placements[P],k=y[P];k?(this.opacities[P]=new Fn(k,p,C.text,C.icon),u=u||C.text!==k.text.placed||C.icon!==k.icon.placed):(this.opacities[P]=new Fn(null,p,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const P in y){const C=y[P];if(!this.opacities[P]){const k=new Fn(C,p,!1,!1);k.isHidden()||(this.opacities[P]=k,u=u||C.text.placed||C.icon.placed)}}for(const P in b)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=b[P]);for(const P in I)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=I[P]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const u={};for(const p of s){const y=p.getBucket(t);y&&p.latestFeatureIndex&&t.id===y.layerIds[0]&&this.updateBucketOpacities(y,p.tileID,u,p.collisionBoxArray)}}updateBucketOpacities(t,s,u,p){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const y=t.layers[0],b=y.layout,I=new Fn(null,0,!1,!1,!0),P=b.get("text-allow-overlap"),C=b.get("icon-allow-overlap"),k=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),O=b.get("text-rotation-alignment")==="map",F=b.get("text-pitch-alignment")==="map",q=b.get("icon-text-fit")!=="none",Z=new Fn(null,0,P&&(C||!t.hasIconData()||b.get("icon-optional")),C&&(P||!t.hasTextData()||b.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const te=(re,le,ve)=>{for(let oe=0;oe<le/4;oe++)re.opacityVertexArray.emplaceBack(ve);re.hasVisibleVertices=re.hasVisibleVertices||ve!==xo},ie=this.collisionBoxArrays.get(t.bucketInstanceId);for(let re=0;re<t.symbolInstances.length;re++){const le=t.symbolInstances.get(re),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:oe,crossTileID:_e}=le;let Te=this.opacities[_e];u[_e]?Te=I:Te||(Te=Z,this.opacities[_e]=Te),u[_e]=!0;const me=le.numIconVertices>0,Pe=this.placedOrientations[le.crossTileID],Be=Pe===c.az.vertical,Fe=Pe===c.az.horizontal||Pe===c.az.horizontalOnly;if(ve>0||oe>0){const Ne=Aa(Te.text);te(t.text,ve,Be?xo:Ne),te(t.text,oe,Fe?xo:Ne);const it=Te.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(dt=>{dt>=0&&(t.text.placedSymbolArray.get(dt).hidden=it||Be?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=it||Fe?1:0);const at=this.variableOffsets[le.crossTileID];at&&this.markUsedJustification(t,at.anchor,le,Pe);const Je=this.placedOrientations[le.crossTileID];Je&&(this.markUsedJustification(t,"left",le,Je),this.markUsedOrientation(t,Je,le))}if(me){const Ne=Aa(Te.icon),it=!(q&&le.verticalPlacedIconSymbolIndex&&Be);le.placedIconSymbolIndex>=0&&(te(t.icon,le.numIconVertices,it?Ne:xo),t.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=Te.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&(te(t.icon,le.numVerticalIconVertices,it?xo:Ne),t.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=Te.icon.isHidden())}const Oe=ie&&ie.has(re)?ie.get(re):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ne=t.collisionArrays[re];if(Ne){let it=new c.P(0,0);if(Ne.textBox||Ne.verticalTextBox){let at=!0;if(k){const Je=this.variableOffsets[_e];Je?(it=yo(Je.anchor,Je.width,Je.height,Je.textOffset,Je.textBoxScale),O&&it._rotate(F?-this.transform.bearingInRadians:this.transform.bearingInRadians)):at=!1}if(Ne.textBox||Ne.verticalTextBox){let Je;Ne.textBox&&(Je=Be),Ne.verticalTextBox&&(Je=Fe),Wo(t.textCollisionBox.collisionVertexArray,Te.text.placed,!at||Je,Oe.text,it.x,it.y)}}if(Ne.iconBox||Ne.verticalIconBox){const at=!!(!Fe&&Ne.verticalIconBox);let Je;Ne.iconBox&&(Je=at),Ne.verticalIconBox&&(Je=!at),Wo(t.iconCollisionBox.collisionVertexArray,Te.icon.placed,Je,Oe.icon,q?it.x:0,q?it.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function Wo(_,t,s,u,p,y){u&&u.length!==0||(u=[0,0,0,0]);const b=u[0]-qn,I=u[1]-qn,P=u[2]-qn,C=u[3]-qn;_.emplaceBack(t?1:0,s?1:0,p||0,y||0,b,I),_.emplaceBack(t?1:0,s?1:0,p||0,y||0,P,I),_.emplaceBack(t?1:0,s?1:0,p||0,y||0,P,C),_.emplaceBack(t?1:0,s?1:0,p||0,y||0,b,C)}const Ko=Math.pow(2,25),Xo=Math.pow(2,24),gl=Math.pow(2,17),Xi=Math.pow(2,16),Fi=Math.pow(2,9),Yo=Math.pow(2,8),Js=Math.pow(2,1);function Aa(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const t=_.placed?1:0,s=Math.floor(127*_.opacity);return s*Ko+t*Xo+s*gl+t*Xi+s*Fi+t*Yo+s*Js+t}const xo=0;class bs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,u,p,y){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(b,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((I,P)=>I.sortKey-P.sortKey));this._currentPartIndex<b.length;)if(s.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,y())return!0;return!1}}class Yi{constructor(t,s,u,p,y,b,I,P){this.placement=new vo(t,s,b,I,P),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,s,u){const p=ke(),y=()=>!this._forceFullPlacement&&ke()-p>2;for(;this._currentPlacementIndex>=0;){const b=s[t[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=I)&&(!b.maxzoom||b.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new bs(b)),this._inProgressLayer.continuePlacement(u[b.source],this.placement,this._showCollisionBoxes,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const gn=512/c.a5/2;class _l{constructor(t,s,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const p=new Map;for(let y=0;y<s.length;y++){const b=s.get(y),I=b.key,P=p.get(I);P?P.push(b):p.set(I,[b])}for(const[y,b]of p){const I={positions:b.map(P=>({x:Math.floor(P.anchorX*gn),y:Math.floor(P.anchorY*gn)})),crossTileIDs:b.map(P=>P.crossTileID)};if(I.positions.length>128){const P=new c.aT(I.positions.length,16,Uint16Array);for(const{x:C,y:k}of I.positions)P.add(C,k);P.finish(),delete I.positions,I.index=P}this._symbolsByKey[y]=I}}getScaledCoordinates(t,s){const{x:u,y:p,z:y}=this.tileID.canonical,{x:b,y:I,z:P}=s.canonical,C=gn/Math.pow(2,P-y),k=(I*c.a5+t.anchorY)*C,O=p*c.a5*gn;return{x:Math.floor((b*c.a5+t.anchorX)*C-u*c.a5*gn),y:Math.floor(k-O)}}findMatches(t,s,u){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let y=0;y<t.length;y++){const b=t.get(y);if(b.crossTileID)continue;const I=this._symbolsByKey[b.key];if(!I)continue;const P=this.getScaledCoordinates(b,s);if(I.index){const C=I.index.range(P.x-p,P.y-p,P.x+p,P.y+p).sort();for(const k of C){const O=I.crossTileIDs[k];if(!u[O]){u[O]=!0,b.crossTileID=O;break}}}else if(I.positions)for(let C=0;C<I.positions.length;C++){const k=I.positions[C],O=I.crossTileIDs[C];if(Math.abs(k.x-P.x)<=p&&Math.abs(k.y-P.y)<=p&&!u[O]){u[O]=!0,b.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class $u{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ds{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const u in this.indexes){const p=this.indexes[u],y={};for(const b in p){const I=p[b];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+s),y[I.tileID.key]=I}this.indexes[u]=y}this.lng=t}addBucket(t,s,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>t.overscaledZ)for(const I in b){const P=b[I];P.tileID.isChildOf(t)&&P.findMatches(s.symbolInstances,t,p)}else{const I=b[t.scaledTo(Number(y)).key];I&&I.findMatches(s.symbolInstances,t,p)}}for(let y=0;y<s.symbolInstances.length;y++){const b=s.symbolInstances.get(y);b.crossTileID||(b.crossTileID=u.generate(),p[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new _l(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const u of s.getCrossTileIDsLists())for(const p of u)delete this.usedCrossTileIDs[t][p]}removeStaleBuckets(t){let s=!1;for(const u in this.indexes){const p=this.indexes[u];for(const y in p)t[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[y]),delete p[y],s=!0)}return s}}class _i{constructor(){this.layerIndexes={},this.crossTileIDs=new $u,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,u){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new ds);let y=!1;const b={};p.handleWrapJump(u);for(const I of s){const P=I.getBucket(t);P&&t.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(I.tileID,P,this.crossTileIDs)&&(y=!0),b[P.bucketInstanceId]=!0)}return p.removeStaleBuckets(b)&&(y=!0),y}pruneUnusedLayers(t){const s={};t.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}var jr="void main() {fragColor=vec4(1.0);}";const Qn={prelude:qt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:qt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:qt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:qt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:qt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qt(jr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:qt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:qt(jr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:qt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:qt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:qt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:qt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:qt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:qt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:qt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:qt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:qt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function qt(_,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/in ([\w]+) ([\w]+)/g),p=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=y?y.concat(p):p,I={};return{fragmentSource:_=_.replace(s,(P,C,k,O,F)=>(I[F]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${k} ${O} ${F};
#else
uniform ${k} ${O} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${k} ${O} ${F} = u_${F};
#endif
`)),vertexSource:t=t.replace(s,(P,C,k,O,F)=>{const q=O==="float"?"vec2":"vec4",Z=F.match(/color/)?"color":q;return I[F]?C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${k} ${q} a_${F};
out ${k} ${O} ${F};
#else
uniform ${k} ${O} u_${F};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${k} ${O} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${Z}(a_${F}, u_${F}_t);
#else
    ${k} ${O} ${F} = u_${F};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${k} ${q} a_${F};
#else
uniform ${k} ${O} u_${F};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${O} ${F} = a_${F};
#else
    ${k} ${O} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${O} ${F} = unpack_mix_${Z}(a_${F}, u_${F}_t);
#else
    ${k} ${O} ${F} = u_${F};
#endif
`}),staticAttributes:u,staticUniforms:b}}class Vn{constructor(t,s,u){this.vertexBuffer=t,this.indexBuffer=s,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Oi=c.aU([{name:"a_pos",type:"Int16",components:2}]);const Qr="#define PROJECTION_MERCATOR",ui="mercator";class kn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ui}get shaderDefine(){return Qr}get shaderPreludeCode(){return Qn.projectionMercator}get vertexShaderPreludeCode(){return Qn.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,s,u,p,y){if(this._cachedMesh)return this._cachedMesh;const b=new c.aW;b.emplaceBack(0,0),b.emplaceBack(c.a5,0),b.emplaceBack(0,c.a5),b.emplaceBack(c.a5,c.a5);const I=t.createVertexBuffer(b,Oi.members),P=c.aX.simpleSegment(0,0,4,2),C=new c.aY;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3);const k=t.createIndexBuffer(C);return this._cachedMesh=new Vn(I,k,P),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class bo{constructor(t=0,s=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=u,this.right=p}interpolate(t,s,u){return s.top!=null&&t.top!=null&&(this.top=c.G.number(t.top,s.top,u)),s.bottom!=null&&t.bottom!=null&&(this.bottom=c.G.number(t.bottom,s.bottom,u)),s.left!=null&&t.left!=null&&(this.left=c.G.number(t.left,s.left,u)),s.right!=null&&t.right!=null&&(this.right=c.G.number(t.right,s.right,u)),this}getCenter(t,s){const u=c.an((this.left+t-this.right)/2,0,t),p=c.an((this.top+s-this.bottom)/2,0,s);return new c.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new bo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ns(_,t){if(!_.renderWorldCopies||_.lngRange)return;const s=t.lng-_.center.lng;t.lng+=s>180?-360:s<-180?360:0}function mr(_){return Math.max(0,Math.floor(_))}class Vs{constructor(t,s){var u;this.applyConstrain=(p,y)=>this._constrainOverride!==null?this._constrainOverride(p,y):this._callbacks.defaultConstrain(p,y),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=(s==null?void 0:s.renderWorldCopies)===void 0||!!(s!=null&&s.renderWorldCopies),this._minZoom=(s==null?void 0:s.minZoom)||0,this._maxZoom=(s==null?void 0:s.maxZoom)||22,this._minPitch=(s==null?void 0:s.minPitch)==null?0:s==null?void 0:s.minPitch,this._maxPitch=(s==null?void 0:s.maxPitch)==null?60:s==null?void 0:s.maxPitch,this._constrainOverride=(u=s==null?void 0:s.constrainOverride)!==null&&u!==void 0?u:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=mr(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new bo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,s,u){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=mr(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new bo(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!u&&t.autoCalculateNearFarZ,s&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const s=c.W(t,-180,180)*Math.PI/180;var u,p,y,b,I,P,C,k,O;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=B(),u=this._rotationMatrix,y=-this._bearingInRadians,b=(p=this._rotationMatrix)[0],I=p[1],P=p[2],C=p[3],k=Math.sin(y),O=Math.cos(y),u[0]=b*O+P*k,u[1]=I*O+C*k,u[2]=b*-k+P*O,u[3]=I*-k+C*O)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const s=c.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const s=t/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aZ(this._fovInRadians)}setFov(t){t=c.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=c.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const s=this.applyConstrain(this._center,t).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=c.aq(s),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,s){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,u){this._unmodified=!1,this._edgeInsets.interpolate(t,s,u),this.constrainInternal(),this._calcMatrices()}resize(t,s,u=!0){this._width=t,this._height=s,u&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Lt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.ao,c.ao])}getCameraQueryGeometry(t,s){if(s.length===1)return[s[0],t];{const{minX:u,minY:p,maxX:y,maxY:b}=c.aa.fromPoints(s).extend(t);return[new c.P(u,p),new c.P(y,p),new c.P(y,b),new c.P(u,b),new c.P(u,p)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:u}=this.applyConstrain(this.center,this.zoom);this.setCenter(s),this.setZoom(u),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=c.ar(new Float64Array(16));c.Q(t,t,[this._width/2,-this._height/2,1]),c.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=c.ar(new Float64Array(16)),c.Q(t,t,[1,-1,1]),c.O(t,t,[-1,-1,0]),c.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,s,u,p){const y=u!==void 0?u:this.bearing,b=p=p!==void 0?p:this.pitch,{distanceToCenter:I,clampedElevation:P}=this._distanceToCenterFromAltElevationPitch(s,this.elevation,b),{x:C,y:k}=tn(b,y),O=c.a9.fromLngLat(t,s);let F,q,Z=c.a_(1,O.y),te=0;do{if(te+=1,te>10)break;q=I/Z,F=new c.a9(O.x+C*q,O.y+k*q),Z=1/F.meterInMercatorCoordinateUnits()}while(Math.abs(I-q*Z)>1e-12);return{center:F.toLngLat(),elevation:P,zoom:c.at(this.height/2/Math.tan(this.fovInRadians/2)/q/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const s=1/this.worldSize,u=c.as(1,this.center.lat)*this.worldSize,p=c.a9.fromLngLat(this.center,this.elevation),y=p.x/s,b=p.y/s,I=p.z/s,P=this.pitch,C=this.bearing,{x:k,y:O,z:F}=tn(P,C),q=this.cameraToCenterDistance,Z=y+q*-k,te=b+q*-O,ie=I+q*F,{distanceToCenter:re,clampedElevation:le}=this._distanceToCenterFromAltElevationPitch(ie/u,t,P),ve=re*u,oe=new c.a9((Z+k*ve)*s,(te+O*ve)*s,0).toLngLat(),_e=c.as(1,oe.lat),Te=c.at(this.height/2/Math.tan(this.fovInRadians/2)/re/_e/this.tileSize);this._elevation=le,this._center=oe,this.setZoom(Te)}_distanceToCenterFromAltElevationPitch(t,s,u){const p=-Math.cos(c.ap(u)),y=t-s;let b,I=s;return p*y>=0||Math.abs(p)<.1?(b=1e4,I=t+b*p):b=-y/p,{distanceToCenter:b,clampedElevation:I}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const s=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/s,t.canonical.y/s,1/s/c.a5,1/s/c.a5]}}class Qi{constructor(t,s){this.min=t,this.max=s,this.center=c.a$([],c.b0([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],u=c.b1(this.min),p=c.b1(this.max);for(let y=0;y<s.length;y++)u[y]=s[y]?this.min[y]:this.center[y],p[y]=s[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new Qi(u,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let s=!0;for(let u=0;u<t.planes.length;u++){const p=this.intersectsPlane(t.planes[u]);if(p===0)return 0;p===1&&(s=!1)}return s?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let s=t[3],u=t[3];for(let p=0;p<3;p++)t[p]>0?(s+=t[p]*this.min[p],u+=t[p]*this.max[p]):(u+=t[p]*this.min[p],s+=t[p]*this.max[p]);return s>=0?2:u<0?0:1}}class eo{distanceToTile2d(t,s,u,p){const y=p.distanceX([t,s]),b=p.distanceY([t,s]);return Math.hypot(y,b)}getWrap(t,s,u){return u}getTileBoundingVolume(t,s,u,p){var y,b;let I=0,P=0;if(p!=null&&p.terrain){const k=new c.a2(t.z,s,t.z,t.x,t.y),O=p.terrain.getMinMaxElevation(k);I=(y=O.minElevation)!==null&&y!==void 0?y:Math.min(0,u),P=(b=O.maxElevation)!==null&&b!==void 0?b:Math.max(0,u)}const C=1<<t.z;return new Qi([s+t.x/C,t.y/C,I],[s+(t.x+1)/C,(t.y+1)/C,P])}allowVariableZoom(t,s){const u=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,p=c.an(78.5-u/2,0,60);return!!s.terrain||t.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class Er{constructor(t,s,u){this.points=t,this.planes=s,this.aabb=u}static fromInvProjectionMatrix(t,s=1,u=0,p,y){const b=y?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],I=Math.pow(2,u),P=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(F=>function(q,Z,te,ie){const re=c.aH([],q,Z),le=1/re[3]/te*ie;return c.b6(re,re,[le,le,1/re[3],le])}(F,t,s,I));p&&function(F,q,Z,te){const ie=te?4:0,re=te?0:4;let le=0;const ve=[],oe=[];for(let me=0;me<4;me++){const Pe=c.b2([],F[me+re],F[me+ie]),Be=c.b7(Pe);c.a$(Pe,Pe,1/Be),ve.push(Be),oe.push(Pe)}for(let me=0;me<4;me++){const Pe=c.b8(F[me+ie],oe[me],Z);le=Pe!==null&&Pe>=0?Math.max(le,Pe):Math.max(le,ve[me])}const _e=function(me,Pe){const Be=c.b2([],me[Pe[0]],me[Pe[1]]),Fe=c.b2([],me[Pe[2]],me[Pe[1]]),Oe=[0,0,0,0];return c.b3(Oe,c.b4([],Be,Fe)),Oe[3]=-c.b5(Oe,me[Pe[0]]),Oe}(F,q),Te=function(me,Pe){const Be=c.b9(me),Fe=c.ba([],me,1/Be),Oe=c.b2([],Pe,c.a$([],Fe,c.b5(Pe,Fe))),Ne=c.b9(Oe);if(Ne>0){const it=Math.sqrt(1-Fe[3]*Fe[3]),at=c.a$([],Fe,-Fe[3]),Je=c.b0([],at,c.a$([],Oe,it/Ne));return c.bb(Pe,Je)}return null}(Z,_e);if(Te!==null){const me=Te/c.b5(oe[0],_e);le=Math.min(le,me)}for(let me=0;me<4;me++){const Pe=Math.min(le,ve[me]);F[me+re]=[F[me+ie][0]+oe[me][0]*Pe,F[me+ie][1]+oe[me][1]*Pe,F[me+ie][2]+oe[me][2]*Pe,1]}}(P,b[0],p,y);const C=b.map(F=>{const q=c.b2([],P[F[0]],P[F[1]]),Z=c.b2([],P[F[2]],P[F[1]]),te=c.b3([],c.b4([],q,Z)),ie=-c.b5(te,P[F[1]]);return te.concat(ie)}),k=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],O=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const F of P)for(let q=0;q<3;q++)k[q]=Math.min(k[q],F[q]),O[q]=Math.max(O[q],F[q]);return new Er(P,C,new Qi(k,O))}}class Bs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,u){return this._helper.interpolatePadding(t,s,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,u=!0){this._helper.resize(t,s,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,s){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(s,u)=>{u=c.an(+u,this.minZoom,this.maxZoom);const p={center:new c.V(s.lng,s.lat),zoom:u};let y=this._helper._lngRange;if(!this._helper._renderWorldCopies&&y===null){const oe=179.9999999999;y=[-oe,oe]}const b=this.tileSize*c.aq(p.zoom);let I=0,P=b,C=0,k=b,O=0,F=0;const{x:q,y:Z}=this.size;if(this._helper._latRange){const oe=this._helper._latRange;I=c.X(oe[1])*b,P=c.X(oe[0])*b,P-I<Z&&(O=Z/(P-I))}y&&(C=c.W(c.Y(y[0])*b,0,b),k=c.W(c.Y(y[1])*b,0,b),k<C&&(k+=b),k-C<q&&(F=q/(k-C)));const{x:te,y:ie}=gt(b,s);let re,le;const ve=Math.max(F||0,O||0);if(ve){const oe=new c.P(F?(k+C)/2:te,O?(P+I)/2:ie);return p.center=It(b,oe).wrap(),p.zoom+=c.at(ve),p}if(this._helper._latRange){const oe=Z/2;ie-oe<I&&(le=I+oe),ie+oe>P&&(le=P-oe)}if(y){const oe=(C+k)/2;let _e=te;this._helper._renderWorldCopies&&(_e=c.W(te,oe-b/2,oe+b/2));const Te=q/2;_e-Te<C&&(re=C+Te),_e+Te>k&&(re=k-Te)}if(re!==void 0||le!==void 0){const oe=new c.P(re??te,le??ie);p.center=It(b,oe).wrap()}return p},this.applyConstrain=(s,u)=>this._helper.applyConstrain(s,u),this._helper=new Vs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,u)=>this.defaultConstrain(s,u)},t),this._coveringTilesDetailsProvider=new eo}clone(){const t=new Bs;return t.apply(this),t}apply(t,s,u){this._helper.apply(t,s,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const s=[new c.bc(0,t)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new c.P(0,0)),p=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),b=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),I=Math.floor(Math.min(u.x,p.x,y.x,b.x)),P=Math.floor(Math.max(u.x,p.x,y.x,b.x)),C=1;for(let k=I-C;k<=P+C;k++)k!==0&&s.push(new c.bc(k,t))}return s}getCameraFrustum(){return Er.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const s=this.screenPointToLocation(this.centerPoint,t),u=t?t.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(t,s){const u=c.as(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(s,u),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),b=c.a9.fromLngLat(t),I=new c.a9(b.x-(p.x-y.x),b.y-(p.y-y.y));this.setCenter(I==null?void 0:I.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,s){return s?this.coordinatePoint(c.a9.fromLngLat(t),s.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(c.a9.fromLngLat(t))}screenPointToLocation(t,s){var u;return(u=this.screenPointToMercatorCoordinate(t,s))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(t,s){if(s){const u=s.pointCoordinate(t);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,s){const u=s||0,p=[t.x,t.y,0,1],y=[t.x,t.y,1,1];c.aH(p,p,this._pixelMatrixInverse),c.aH(y,y,this._pixelMatrixInverse);const b=p[3],I=y[3],P=p[1]/b,C=y[1]/I,k=p[2]/b,O=y[2]/I,F=k===O?0:(u-k)/(O-k);return new c.a9(c.G.number(p[0]/b,y[0]/I,F)/this.worldSize,c.G.number(P,C,F)/this.worldSize,u)}coordinatePoint(t,s=0,u=this._pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,s,1];return c.aH(p,p,u),new c.P(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Ht(this));return new Lt().extend(this.screenPointToLocation(new c.P(0,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(t,s){return s?s.pointCoordinate(t)!=null:t.y>this.height/2-Ht(this)}calculatePosMatrix(t,s=!1,u){var p;const y=(p=t.key)!==null&&p!==void 0?p:c.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),b=s?this._alignedPosMatrixCache:this._posMatrixCache;if(b.has(y)){const C=b.get(y);return u?C.f32:C.f64}const I=zt(t,this.worldSize);c.S(I,s?this._alignedProjMatrix:this._viewProjMatrix,I);const P={f64:I,f32:new Float32Array(I)};return b.set(y,P),u?P.f32:P.f64}calculateFogMatrix(t){const s=t.key,u=this._fogMatrixCacheF32;if(u.has(s))return u.get(s);const p=zt(t,this.worldSize);return c.S(p,this._fogMatrix,p),u.set(s,new Float32Array(p)),u.get(s)}calculateCenterFromCameraLngLatAlt(t,s,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,u,p)}_calculateNearFarZIfNeeded(t,s,u){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=t-p*this._helper._pixelPerMeter/Math.cos(s),b=p<0?y:t,I=Math.PI/2+this.pitchInRadians,P=c.ap(this.fov)*(Math.abs(Math.cos(c.ap(this.roll)))*this.height+Math.abs(Math.sin(c.ap(this.roll)))*this.width)/this.height*(.5+u.y/this.height),C=Math.sin(P)*b/Math.sin(c.an(Math.PI-I-P,.01,Math.PI-.01)),k=Ht(this),O=Math.atan(k/this._helper.cameraToCenterDistance),F=c.ap(.75),q=O>F?2*O*(.5+u.y/(2*k)):F,Z=Math.sin(q)*b/Math.sin(c.an(Math.PI-I-q,.01,Math.PI-.01)),te=Math.min(C,Z);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*te+b),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,s=gt(this.worldSize,this.center),u=s.x,p=s.y;this._helper._pixelPerMeter=c.as(1,this.center.lat)*this.worldSize;const y=c.ap(Math.min(this.pitch,tt)),b=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let I;this._calculateNearFarZIfNeeded(b,y,t),I=new Float64Array(16),c.be(I,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aB(this._invProjMatrix,I),I[8]=2*-t.x/this._helper._width,I[9]=2*t.y/this._helper._height,this._projectionMatrix=c.bf(I),c.Q(I,I,[1,-1,1]),c.O(I,I,[0,0,-this._helper.cameraToCenterDistance]),c.bg(I,I,-this.rollInRadians),c.bh(I,I,this.pitchInRadians),c.bg(I,I,-this.bearingInRadians),c.O(I,I,[-u,-p,0]),this._mercatorMatrix=c.Q([],I,[this.worldSize,this.worldSize,this.worldSize]),c.Q(I,I,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,I),c.O(I,I,[0,0,-this.elevation]),this._viewProjMatrix=I,this._invViewProjMatrix=c.aB([],I);const P=[0,0,-1,1];c.aH(P,P,this._invViewProjMatrix),this._cameraPosition=[P[0]/P[3],P[1]/P[3],P[2]/P[3]],this._fogMatrix=new Float64Array(16),c.be(this._fogMatrix,this.fovInRadians,this.width/this.height,b,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,c.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.O(this._fogMatrix,this._fogMatrix,[-u,-p,0]),c.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,I);const C=this._helper._width%2/2,k=this._helper._height%2/2,O=Math.cos(this.bearingInRadians),F=Math.sin(-this.bearingInRadians),q=u-Math.round(u)+O*C+F*k,Z=p-Math.round(p)+O*k+F*C,te=new Float64Array(I);if(c.O(te,te,[q>.5?q-1:q,Z>.5?Z-1:Z,0]),this._alignedProjMatrix=te,I=c.aB(new Float64Array(16),this._pixelMatrix),!I)throw new Error("failed to invert matrix");this._pixelMatrixInverse=I,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new c.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return c.aH(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,s){const u=c.a9.fromLngLat(t),p=[u.x*this.worldSize,u.y*this.worldSize,s,1];return c.aH(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(t){const{overscaledTileID:s,aligned:u,applyTerrainMatrix:p}=t,y=this._helper.getMercatorTileCoordinates(s),b=s?this.calculatePosMatrix(s,u,!0):null;let I;return I=s&&s.terrainRttPosMatrix32f&&p?s.terrainRttPosMatrix32f:b||c.bi(),{mainMatrix:I,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:I}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,s,u){return 1}transformLightDirection(t){return c.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,s,u,p){const y=this.calculatePosMatrix(u);let b;p?(b=[t,s,p(t,s),1],c.aH(b,b,y)):(b=[t,s,0,1],Mr(b,b,y));const I=b[3];return{point:new c.P(b[0]/I,b[1]/I),signedDistanceFromCamera:I,isOccluded:!1}}populateCache(t){for(const s of t)this.calculatePosMatrix(s)}getMatrixForModel(t,s){const u=c.a9.fromLngLat(t,s),p=u.meterInMercatorCoordinateUnits(),y=c.bj();return c.O(y,y,[u.x,u.y,u.z]),c.bg(y,y,Math.PI),c.bh(y,y,Math.PI/2),c.Q(y,y,[-p,p,p]),y}getProjectionDataForCustomLayer(t=!0){const s=new c.a2(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:t}),p=zt(s,this.worldSize);c.S(p,this._viewProjMatrix,p),u.tileMercatorCoords=[0,0,1,1];const y=[c.a5,c.a5,this.worldSize/this._helper.pixelsPerMeter],b=c.bk();return c.Q(b,p,y),u.fallbackMatrix=b,u.mainMatrix=b,u}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function ws(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function wo(_){if(_.useSlerp)if(_.k<1){const t=c.bl(_.startEulerAngles.roll,_.startEulerAngles.pitch,_.startEulerAngles.bearing),s=c.bl(_.endEulerAngles.roll,_.endEulerAngles.pitch,_.endEulerAngles.bearing),u=new Float64Array(4);c.bm(u,t,s,_.k);const p=c.bn(u);_.tr.setRoll(p.roll),_.tr.setPitch(p.pitch),_.tr.setBearing(p.bearing)}else _.tr.setRoll(_.endEulerAngles.roll),_.tr.setPitch(_.endEulerAngles.pitch),_.tr.setBearing(_.endEulerAngles.bearing);else _.tr.setRoll(c.G.number(_.startEulerAngles.roll,_.endEulerAngles.roll,_.k)),_.tr.setPitch(c.G.number(_.startEulerAngles.pitch,_.endEulerAngles.pitch,_.k)),_.tr.setBearing(c.G.number(_.startEulerAngles.bearing,_.endEulerAngles.bearing,_.k))}function Ca(_,t,s,u,p){const y=p.padding,b=gt(p.worldSize,s.getNorthWest()),I=gt(p.worldSize,s.getNorthEast()),P=gt(p.worldSize,s.getSouthEast()),C=gt(p.worldSize,s.getSouthWest()),k=c.ap(-u),O=b.rotate(k),F=I.rotate(k),q=P.rotate(k),Z=C.rotate(k),te=new c.P(Math.max(O.x,F.x,Z.x,q.x),Math.max(O.y,F.y,Z.y,q.y)),ie=new c.P(Math.min(O.x,F.x,Z.x,q.x),Math.min(O.y,F.y,Z.y,q.y)),re=te.sub(ie),le=(p.width-(y.left+y.right+t.left+t.right))/re.x,ve=(p.height-(y.top+y.bottom+t.top+t.bottom))/re.y;if(ve<0||le<0)return void ws();const oe=Math.min(c.at(p.scale*Math.min(le,ve)),_.maxZoom),_e=c.P.convert(_.offset),Te=new c.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(c.ap(u)),me=_e.add(Te).mult(p.scale/c.aq(oe));return{center:It(p.worldSize,b.add(P).div(2).sub(me)),zoom:oe,bearing:u}}class Ts{get useGlobeControls(){return!1}handlePanInertia(t,s){const u=t.mag(),p=Math.abs(Ht(s));return{easingOffset:t.mult(Math.min(.75*p/u,1)),easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(t,s){t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta),t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta)}handleMapControlsPan(t,s,u){t.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(u,t.around)}cameraForBoxAndBearing(t,s,u,p,y){return Ca(t,s,u,p,y)}handleJumpToCenterZoom(t,s){t.zoom!==(s.zoom!==void 0?+s.zoom:t.zoom)&&t.setZoom(+s.zoom),s.center!==void 0&&t.setCenter(c.V.convert(s.center))}handleEaseTo(t,s){const u=t.zoom,p=t.padding,y={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},I=s.zoom!==void 0,P=!t.isPaddingEqual(s.padding);let C=!1;const k=I?+s.zoom:t.zoom;let O=t.centerPoint.add(s.offsetAsPoint);const F=t.screenPointToLocation(O),{center:q,zoom:Z}=t.applyConstrain(c.V.convert(s.center||F),k??u);Ns(t,q);const te=gt(t.worldSize,F),ie=gt(t.worldSize,q).sub(te),re=c.aq(Z-u);return C=Z!==u,{easeFunc:le=>{if(C&&t.setZoom(c.G.number(u,Z,le)),c.bo(y,b)||wo({startEulerAngles:y,endEulerAngles:b,tr:t,k:le,useSlerp:y.roll!=b.roll}),P&&(t.interpolatePadding(p,s.padding,le),O=t.centerPoint.add(s.offsetAsPoint)),s.around)t.setLocationAtPoint(s.around,s.aroundPoint);else{const ve=c.aq(t.zoom-u),oe=Z>u?Math.min(2,re):Math.max(.5,re),_e=Math.pow(oe,1-le),Te=It(t.worldSize,te.add(ie.mult(le*_e)).mult(ve));t.setLocationAtPoint(t.renderWorldCopies?Te.wrap():Te,O)}},isZooming:C,elevationCenter:q}}handleFlyTo(t,s){const u=s.zoom!==void 0,p=t.zoom,y=t.applyConstrain(c.V.convert(s.center||s.locationAtOffset),u?+s.zoom:p),b=y.center,I=y.zoom;Ns(t,b);const P=gt(t.worldSize,s.locationAtOffset),C=gt(t.worldSize,b).sub(P),k=C.mag(),O=c.aq(I-p);let F;if(s.minZoom!==void 0){const q=Math.min(+s.minZoom,p,I),Z=t.applyConstrain(b,q).zoom;F=c.aq(Z-p)}return{easeFunc:(q,Z,te,ie)=>{t.setZoom(q===1?I:p+c.at(Z));const re=q===1?b:It(t.worldSize,P.add(C.mult(te)).mult(Z));t.setLocationAtPoint(t.renderWorldCopies?re.wrap():re,ie)},scaleOfZoom:O,targetCenter:b,scaleOfMinZoom:F,pixelPathLength:k}}}class $n{constructor(t,s,u){this.blendFunction=t,this.blendColor=s,this.mask=u}}$n.Replace=[1,0],$n.disabled=new $n($n.Replace,c.bp.transparent,[!1,!1,!1,!1]),$n.unblended=new $n($n.Replace,c.bp.transparent,[!0,!0,!0,!0]),$n.alphaBlended=new $n([1,771],c.bp.transparent,[!0,!0,!0,!0]);const to=2305;class vn{constructor(t,s,u){this.enable=t,this.mode=s,this.frontFace=u}}vn.disabled=new vn(!1,1029,to),vn.backCCW=new vn(!0,1029,to),vn.frontCCW=new vn(!0,1028,to);class ln{constructor(t,s,u){this.func=t,this.mask=s,this.range=u}}ln.ReadOnly=!1,ln.ReadWrite=!0,ln.disabled=new ln(519,ln.ReadOnly,[0,1]);const no=7680;class xn{constructor(t,s,u,p,y,b){this.test=t,this.ref=s,this.mask=u,this.fail=p,this.depthFail=y,this.pass=b}}xn.disabled=new xn({func:519,mask:0},0,0,no,no,no);const To=new WeakMap;function Ii(_){var t;if(To.has(_))return To.get(_);{const s=(t=_.getParameter(_.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return To.set(_,s),s}}class Us{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const s=t.context,u=s.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const p=new c.aW;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const y=new c.aY;y.emplaceBack(0,1,2),this._fullscreenTriangle=new Vn(s.createVertexBuffer(p,Oi.members),s.createIndexBuffer(y),c.aX.simpleSegment(0,0,p.length,y.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(u.TEXTURE1);const b=u.createTexture();u.bindTexture(u.TEXTURE_2D,b),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(b),Ii(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,s){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,s=t.gl;t.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,s){const u=this._cachedRenderContext.context,p=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:c.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,p.TRIANGLES,ln.disabled,xn.disabled,$n.unblended,vn.disabled,((y,b)=>({u_input:y,u_output_expected:b}))(t,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ii(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const y=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ii(t)){const s=t.clientWaitSync(this._readbackQueue.sync,0,0);if(s===t.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Us._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let s=0;return s+=t[0]/256,s+=t[1]/65536,s+=t[2]/16777216,t[3]<127&&(s=-s),s/128}}const ps=c.a5/128;function yl(_,t){const s=_.granularity!==void 0?Math.max(_.granularity,1):1,u=s+(_.generateBorders?2:0),p=s+(_.extendToNorthPole||_.generateBorders?1:0)+(_.extendToSouthPole||_.generateBorders?1:0),y=u+1,b=p+1,I=_.generateBorders?-1:0,P=_.generateBorders||_.extendToNorthPole?-1:0,C=s+(_.generateBorders?1:0),k=s+(_.generateBorders||_.extendToSouthPole?1:0),O=y*b,F=u*p*6,q=y*b>65536;if(q&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Z=q||t==="32bit",te=new Int16Array(2*O);let ie=0;for(let ve=P;ve<=k;ve++)for(let oe=I;oe<=C;oe++){let _e=oe/s*c.a5;oe===-1&&(_e=-ps),oe===s+1&&(_e=c.a5+ps);let Te=ve/s*c.a5;ve===-1&&(Te=_.extendToNorthPole?c.br:-ps),ve===s+1&&(Te=_.extendToSouthPole?c.bs:c.a5+ps),te[ie++]=_e,te[ie++]=Te}const re=Z?new Uint32Array(F):new Uint16Array(F);let le=0;for(let ve=0;ve<p;ve++)for(let oe=0;oe<u;oe++){const _e=oe+1+ve*y,Te=oe+(ve+1)*y,me=oe+1+(ve+1)*y;re[le++]=oe+ve*y,re[le++]=Te,re[le++]=_e,re[le++]=_e,re[le++]=Te,re[le++]=me}return{vertices:te.buffer.slice(0),indices:re.buffer.slice(0),uses32bitIndices:Z}}const js=new c.aV({fill:new c.bt(128,2),line:new c.bt(512,0),tile:new c.bt(128,32),stencil:new c.bt(128,1),circle:3});class Ma{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Qn.projectionGlobe}get vertexShaderPreludeCode(){return Qn.projectionMercator.vertexSource}get subdivisionGranularity(){return js}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Us(t));const s=c.X(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(s,u),y=ke();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=y);const b=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bv(b))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,s,u,p,y){const b=(y==="stencil"?js.stencil:js.tile).getGranularityForZoomLevel(s.z);return this._getMesh(t,{granularity:b,generateBorders:u,extendToNorthPole:s.y===0&&p,extendToSouthPole:s.y===(1<<s.z)-1&&p})}_getMesh(t,s){const u=this._getMeshKey(s);if(u in this._tileMeshCache)return this._tileMeshCache[u];const p=function(y,b){const I=yl(b,"16bit"),P=c.aW.deserialize({arrayBuffer:I.vertices,length:I.vertices.byteLength/2/2}),C=c.aY.deserialize({arrayBuffer:I.indices,length:I.indices.byteLength/2/3});return new Vn(y.createVertexBuffer(P,Oi.members),y.createIndexBuffer(C),c.aX.simpleSegment(0,0,P.length,C.length))}(t,s);return this._tileMeshCache[u]=p,p}recalculate(t){}hasTransition(){const t=ke();let s=!1;return s=s||(t-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const bc=new c.t({type:new c.D(c.u.projection.type)});class qs extends c.E{constructor(t){super(),this._transitionable=new c.x(bc,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0)),this._mercatorProjection=new kn,this._verticalPerspectiveProjection=new Ma}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof c.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,s,u,p,y){return this.currentProjection.getMeshFromTileID(t,s,u,p,y)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Jr(_){const t=$s(_.worldSize,_.center.lat);return 2*Math.PI*t}function Ji(_,t,s,u,p){const y=1/(1<<p),b=t/c.a5*y+u*y,I=c.by((_/c.a5*y+s*y)*Math.PI*2+Math.PI,2*Math.PI),P=2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI,C=Math.cos(P),k=new Float64Array(3);return k[0]=Math.sin(I)*C,k[1]=Math.sin(P),k[2]=Math.cos(I)*C,k}function tr(_){return function(t,s){const u=Math.cos(s),p=new Float64Array(3);return p[0]=Math.sin(t)*u,p[1]=Math.sin(s),p[2]=Math.cos(t)*u,p}(_.lng*Math.PI/180,_.lat*Math.PI/180)}function $s(_,t){return _/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Eo(_){const t=Math.asin(_[1])/Math.PI*180,s=Math.sqrt(_[0]*_[0]+_[2]*_[2]);if(s>1e-6){const u=_[0]/s,p=Math.acos(_[2]/s),y=(u>0?p:-p)/Math.PI*180;return new c.V(c.W(y,-180,180),t)}return new c.V(0,t)}function Gr(_){return Math.cos(_*Math.PI/180)}function ur(_,t){const s=Gr(_),u=Gr(t);return c.at(u/s)}function vl(_,t){const s=_.rotate(t.bearingInRadians),u=t.zoom+ur(t.center.lat,0),p=c.bu(1/Gr(t.center.lat),1/Gr(Math.min(Math.abs(t.center.lat),60)),c.bx(u,7,3,0,1)),y=360/Jr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new c.V(t.center.lng-s.x*y*p,c.an(t.center.lat+s.y*y,-c.ao,c.ao))}function Gs(_){const t=.5*_,s=Math.sin(t),u=Math.cos(t);return Math.log(s+u)-Math.log(u-s)}function E(_,t,s,u){const p=_.lat+s*u;if(Math.abs(s)>1){const y=(Math.sign(_.lat+s)!==Math.sign(_.lat)?-Math.abs(_.lat):Math.abs(_.lat))*Math.PI/180,b=Math.abs(_.lat+s)*Math.PI/180,I=Gs(y+u*(b-y)),P=Gs(y),C=Gs(b);return new c.V(_.lng+t*((I-P)/(C-P)),p)}return new c.V(_.lng+t*u,p)}class L{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,s,u,p){const y=`${t.z}_${t.x}_${t.y}_${p!=null&&p.terrain?"t":""}`,b=this._cache.get(y);if(b)return b;const I=this._cachePrevious.get(y);if(I)return this._cache.set(y,I),I;const P=this._boundingVolumeFactory(t,s,u,p);return this._cache.set(y,P),this._hadAnyChanges=!0,P}}class j{constructor(t,s,u,p){this.min=u,this.max=p,this.points=t,this.planes=s}static fromAabb(t,s){const u=[];for(let p=0;p<8;p++)u.push([1&~p?t[0]:s[0],(p>>1&1)==1?s[1]:t[1],(p>>2&1)==1?s[2]:t[2]]);return new j(u,[[-1,0,0,s[0]],[1,0,0,-t[0]],[0,-1,0,s[1]],[0,1,0,-t[1]],[0,0,-1,s[2]],[0,0,1,-t[2]]],t,s)}static fromCenterSizeAngles(t,s,u){const p=c.bB([],u[0],u[1],u[2]),y=c.bC([],[s[0],0,0],p),b=c.bC([],[0,s[1],0],p),I=c.bC([],[0,0,s[2]],p),P=[...t],C=[...t];for(let O=0;O<8;O++)for(let F=0;F<3;F++){const q=t[F]+y[F]*(1&~O?-1:1)+b[F]*((O>>1&1)==1?1:-1)+I[F]*((O>>2&1)==1?1:-1);P[F]=Math.min(P[F],q),C[F]=Math.max(C[F],q)}const k=[];for(let O=0;O<8;O++){const F=[...t];c.b0(F,F,c.a$([],y,1&~O?-1:1)),c.b0(F,F,c.a$([],b,(O>>1&1)==1?1:-1)),c.b0(F,F,c.a$([],I,(O>>2&1)==1?1:-1)),k.push(F)}return new j(k,[[...y,-c.b5(y,k[0])],[...b,-c.b5(b,k[0])],[...I,-c.b5(I,k[0])],[-y[0],-y[1],-y[2],-c.b5(y,k[7])],[-b[0],-b[1],-b[2],-c.b5(b,k[7])],[-I[0],-I[1],-I[2],-c.b5(I,k[7])]],P,C)}intersectsFrustum(t){let s=!0;const u=this.points.length,p=this.planes.length,y=t.planes.length,b=t.points.length;for(let I=0;I<y;I++){const P=t.planes[I];let C=0;for(let k=0;k<u;k++){const O=this.points[k];P[0]*O[0]+P[1]*O[1]+P[2]*O[2]+P[3]>=0&&C++}if(C===0)return 0;C<u&&(s=!1)}if(s)return 2;for(let I=0;I<p;I++){const P=this.planes[I];let C=0;for(let k=0;k<b;k++){const O=t.points[k];P[0]*O[0]+P[1]*O[1]+P[2]*O[2]+P[3]>=0&&C++}if(C===0)return 0}return 1}intersectsPlane(t){const s=this.points.length;let u=0;for(let p=0;p<s;p++){const y=this.points[p];t[0]*y[0]+t[1]*y[1]+t[2]*y[2]+t[3]>=0&&u++}return u===s?2:u===0?0:1}}function ne(_,t,s){const u=_-t;return u<0?-u:Math.max(0,u-s)}function ze(_,t,s,u,p){const y=_-s;let b;return b=y<0?Math.min(-y,1+y-p):y>1?Math.min(Math.max(y-p,0),1-y):0,Math.max(b,ne(t,u,p))}class Ze{constructor(){this._boundingVolumeCache=new L(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,s,u,p){const y=1<<u.z,b=1/y,I=u.x/y,P=u.y/y;let C=2;return C=Math.min(C,ze(t,s,I,P,b)),C=Math.min(C,ze(t,s,I+.5,-P-b,b)),C=Math.min(C,ze(t,s,I+.5,2-P-b,b)),C}getWrap(t,s,u){const p=1<<s.z,y=1/p,b=s.x/p,I=ne(t.x,b,y),P=ne(t.x,b-1,y),C=ne(t.x,b+1,y),k=Math.min(I,P,C);return k===C?1:k===P?-1:0}allowVariableZoom(t,s){return Tt(t,s)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,s,u,p){return this._boundingVolumeCache.getTileBoundingVolume(t,s,u,p)}_computeTileBoundingVolume(t,s,u,p){var y,b;let I=0,P=0;if(p!=null&&p.terrain){const C=new c.a2(t.z,s,t.z,t.x,t.y),k=p.terrain.getMinMaxElevation(C);I=(y=k.minElevation)!==null&&y!==void 0?y:Math.min(0,u),P=(b=k.maxElevation)!==null&&b!==void 0?b:Math.max(0,u)}if(I/=c.bE,P/=c.bE,I+=1,P+=1,t.z<=0)return j.fromAabb([-P,-P,-P],[P,P,P]);if(t.z===1)return j.fromAabb([t.x===0?-P:0,t.y===0?0:-P,-P],[t.x===0?0:P,t.y===0?P:0,P]);{const C=[Ji(0,0,t.x,t.y,t.z),Ji(c.a5,0,t.x,t.y,t.z),Ji(c.a5,c.a5,t.x,t.y,t.z),Ji(0,c.a5,t.x,t.y,t.z)],k=[];for(const Oe of C)k.push(c.a$([],Oe,P));if(P!==I)for(const Oe of C)k.push(c.a$([],Oe,I));t.y===0&&k.push([0,1,0]),t.y===(1<<t.z)-1&&k.push([0,-1,0]);const O=[1,1,1],F=[-1,-1,-1];for(const Oe of k)for(let Ne=0;Ne<3;Ne++)O[Ne]=Math.min(O[Ne],Oe[Ne]),F[Ne]=Math.max(F[Ne],Oe[Ne]);const q=Ji(c.a5/2,c.a5/2,t.x,t.y,t.z),Z=c.b4([],[0,1,0],q);c.b3(Z,Z);const te=c.b4([],q,Z);c.b3(te,te);const ie=c.b4([],C[2],C[1]);c.b3(ie,ie);const re=c.b4([],C[0],C[3]);c.b3(re,re),k.push(c.a$([],q,P)),t.y>=(1<<t.z)/2&&k.push(c.a$([],Ji(c.a5/2,0,t.x,t.y,t.z),P)),t.y<(1<<t.z)/2&&k.push(c.a$([],Ji(c.a5/2,c.a5,t.x,t.y,t.z),P));const le=ft(q,k),ve=ft(te,k),oe=[-q[0],-q[1],-q[2],le.max],_e=[q[0],q[1],q[2],-le.min],Te=[-te[0],-te[1],-te[2],ve.max],me=[te[0],te[1],te[2],-ve.min],Pe=[...ie,0],Be=[...re,0],Fe=[];return t.y===0?Fe.push(c.bD(Be,Pe,oe),c.bD(Be,Pe,_e)):Fe.push(c.bD(Te,Pe,oe),c.bD(Te,Pe,_e),c.bD(Te,Be,oe),c.bD(Te,Be,_e)),t.y===(1<<t.z)-1?Fe.push(c.bD(Be,Pe,oe),c.bD(Be,Pe,_e)):Fe.push(c.bD(me,Pe,oe),c.bD(me,Pe,_e),c.bD(me,Be,oe),c.bD(me,Be,_e)),new j(Fe,[oe,_e,Te,me,Pe,Be],O,F)}}}function ft(_,t){let s=1/0,u=-1/0;for(const p of t){const y=c.b5(_,p);s=Math.min(s,y),u=Math.max(u,y)}return{min:s,max:u}}class cn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,u){return this._helper.interpolatePadding(t,s,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s){this._helper.resize(t,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=c.bF(),this._projectionMatrix=c.bj(),this._globeViewProjMatrix32f=c.bi(),this._globeViewProjMatrixNoCorrection=c.bj(),this._globeViewProjMatrixNoCorrectionInverted=c.bj(),this._globeProjMatrixInverted=c.bj(),this._cameraPosition=c.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(s,u)=>{const p=c.an(s.lat,-c.ao,c.ao),y=c.an(+u,this.minZoom+ur(0,p),this.maxZoom);return{center:new c.V(s.lng,p),zoom:y}},this.applyConstrain=(s,u)=>this._helper.applyConstrain(s,u),this._helper=new Vs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,u)=>this.defaultConstrain(s,u)},t),this._coveringTilesDetailsProvider=new Ze}clone(){const t=new cn;return t.apply(this),t}apply(t,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=c.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:s,applyGlobeMatrix:u}=t,p=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const s=this.pitchInRadians,u=this.cameraToCenterDistance/t,p=Math.sin(s)*u,y=Math.cos(s)*u+1,b=1/Math.sqrt(p*p+y*y)*1;let I=-p,P=y;const C=Math.sqrt(I*I+P*P);I/=C,P/=C;const k=[0,I,P];c.bG(k,k,[0,0,0],-this.bearingInRadians),c.bH(k,k,[0,0,0],-1*this.center.lat*Math.PI/180),c.bI(k,k,[0,0,0],this.center.lng*Math.PI/180);const O=1/c.b7(k);return c.a$(k,k,O),[...k,-b*O]}isLocationOccluded(t){return!this.isSurfacePointVisible(tr(t))}transformLightDirection(t){const s=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,p=Math.cos(u),y=[Math.sin(s)*p,Math.sin(u),Math.cos(s)*p],b=[y[2],0,-y[0]],I=[0,0,0];c.b4(I,b,y),c.b3(b,b),c.b3(I,I);const P=[0,0,0];return c.b3(P,[b[0]*t[0]+I[0]*t[1]+y[0]*t[2],b[1]*t[0]+I[1]*t[1]+y[1]*t[2],b[2]*t[0]+I[2]*t[1]+y[2]*t[2]]),P}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,s,u){const p=function(I,P,C){const k=1/(1<<C.z);return new c.a9(I/c.a5*k+C.x*k,P/c.a5*k+C.y*k)}(t,s,u.canonical),y=(b=p.y,[c.by(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI]);var b;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(t,s,u,p){const y=u.canonical,b=Ji(t,s,y.x,y.y,y.z),I=1+(p?p(t,s):0)/c.bE,P=[b[0]*I,b[1]*I,b[2]*I,1];c.aH(P,P,this._globeViewProjMatrixNoCorrection);const C=this._cachedClippingPlane,k=C[0]*b[0]+C[1]*b[1]+C[2]*b[2]+C[3]<0;return{point:new c.P(P[0]/P[3],P[1]/P[3]),signedDistanceFromCamera:P[3],isOccluded:k}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=$s(this.worldSize,this.center.lat),s=c.bk(),u=c.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),c.be(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;s[8]=2*-p.x/this._helper._width,s[9]=2*p.y/this._helper._height,this._projectionMatrix=c.bf(s),this._globeProjMatrixInverted=c.bk(),c.aB(this._globeProjMatrixInverted,s),c.O(s,s,[0,0,-this.cameraToCenterDistance]),c.bg(s,s,this.rollInRadians),c.bh(s,s,-this.pitchInRadians),c.bg(s,s,this.bearingInRadians),c.O(s,s,[0,0,-t]);const y=c.bz();y[0]=t,y[1]=t,y[2]=t,c.bh(u,s,this.center.lat*Math.PI/180),c.bJ(u,u,-this.center.lng*Math.PI/180),c.Q(u,u,y),this._globeViewProjMatrixNoCorrection=u,c.bh(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bJ(s,s,-this.center.lng*Math.PI/180),c.Q(s,s,y),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=c.bk(),c.aB(this._globeViewProjMatrixNoCorrectionInverted,u);const b=c.bz();this._cameraPosition=c.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,c.bG(this._cameraPosition,this._cameraPosition,b,-this.rollInRadians),c.bH(this._cameraPosition,this._cameraPosition,b,this.pitchInRadians),c.bG(this._cameraPosition,this._cameraPosition,b,-this.bearingInRadians),c.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bH(this._cameraPosition,this._cameraPosition,b,-this.center.lat*Math.PI/180),c.bI(this._cameraPosition,this._cameraPosition,b,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const I=c.bf(this._globeViewProjMatrixNoCorrectionInverted);c.Q(I,I,[1,1,-1]),this._cachedFrustum=Er.fromInvProjectionMatrix(I,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){c.w("calculateFogMatrix is not supported on globe projection.");const s=c.bk();return c.ar(s),s}getVisibleUnwrappedCoordinates(t){return[new c.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=tr(t);c.a$(u,u,1+s/c.bE);const p=c.bF();return c.aH(p,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(t){}getBounds(){const t=.5*this.width,s=.5*this.height,u=[new c.P(0,0),new c.P(t,0),new c.P(this.width,0),new c.P(this.width,s),new c.P(this.width,this.height),new c.P(t,this.height),new c.P(0,this.height),new c.P(0,s)],p=[];for(const O of u)p.push(this.unprojectScreenPoint(O));let y=0,b=0,I=0,P=0;const C=this.center;for(const O of p){const F=c.bK(C.lng,O.lng),q=c.bK(C.lat,O.lat);F<b&&(b=F),F>y&&(y=F),q<P&&(P=q),q>I&&(I=q)}const k=[C.lng+b,C.lat+P,C.lng+y,C.lat+I];return this.isSurfacePointOnScreen([0,1,0])&&(k[3]=90,k[0]=-180,k[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(k[1]=-90,k[0]=-180,k[2]=180),new Lt(k)}calculateCenterFromCameraLngLatAlt(t,s,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,u,p)}setLocationAtPoint(t,s){const u=tr(this.unprojectScreenPoint(s)),p=tr(t),y=c.bz();c.bL(y);const b=c.bz();c.bI(b,u,y,-this.center.lng*Math.PI/180),c.bH(b,b,y,this.center.lat*Math.PI/180);const I=p[0]*p[0]+p[2]*p[2],P=b[0]*b[0];if(I<P)return;const C=Math.sqrt(I-P),k=-C,O=c.bM(p[0],p[2],b[0],C),F=c.bM(p[0],p[2],b[0],k),q=c.bz();c.bI(q,p,y,-O);const Z=c.bM(q[1],q[2],b[1],b[2]),te=c.bz();c.bI(te,p,y,-F);const ie=c.bM(te[1],te[2],b[1],b[2]),re=.5*Math.PI,le=Z>=-re&&Z<=re,ve=ie>=-re&&ie<=re;let oe,_e;if(le&&ve){const Be=this.center.lng*Math.PI/180,Fe=this.center.lat*Math.PI/180;c.bN(O,Be)+c.bN(Z,Fe)<c.bN(F,Be)+c.bN(ie,Fe)?(oe=O,_e=Z):(oe=F,_e=ie)}else if(le)oe=O,_e=Z;else{if(!ve)return;oe=F,_e=ie}const Te=oe/Math.PI*180,me=_e/Math.PI*180,Pe=this.center.lat;this.setCenter(new c.V(Te,c.an(me,-90,90))),this.setZoom(this.zoom+ur(Pe,this.center.lat))}locationToScreenPoint(t,s){const u=tr(t);if(s){const p=s.getElevationForLngLatZoom(t,this._helper._tileZoom);c.a$(u,u,1+p/c.bE)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(t){const s=c.bF();return c.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new c.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,s){if(s){const u=s.pointCoordinate(t);if(u)return u}return c.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,s){var u;return(u=this.screenPointToMercatorCoordinate(t,s))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(t,s){const u=this._cameraPosition,p=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(u,p)}getRayDirectionFromPixel(t){const s=c.bF();s[0]=t.x/this.width*2-1,s[1]=-1*(t.y/this.height*2-1),s[2]=1,s[3]=1,c.aH(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const u=c.bz();u[0]=s[0]-this._cameraPosition[0],u[1]=s[1]-this._cameraPosition[1],u[2]=s[2]-this._cameraPosition[2];const p=c.bz();return c.b3(p,u),p}isSurfacePointVisible(t){const s=this._cachedClippingPlane;return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const s=c.bF();return c.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(t,s){const u=c.b5(t,s),p=c.bz(),y=c.bz();c.a$(y,s,u),c.b2(p,t,y);const b=1-c.b5(p,p);if(b<0)return null;const I=c.b5(t,t)-1,P=-u+(u<0?1:-1)*Math.sqrt(b),C=I/P,k=P;return{tMin:Math.min(C,k),tMax:Math.max(C,k)}}unprojectScreenPoint(t){const s=this._cameraPosition,u=this.getRayDirectionFromPixel(t),p=this.rayPlanetIntersection(s,u);if(p){const k=c.bz();c.b0(k,s,[u[0]*p.tMin,u[1]*p.tMin,u[2]*p.tMin]);const O=c.bz();return c.b3(O,k),Eo(O)}const y=this._cachedClippingPlane,b=y[0]*u[0]+y[1]*u[1]+y[2]*u[2],I=-c.bb(y,s)/b,P=c.bz();if(I>0)c.b0(P,s,[u[0]*I,u[1]*I,u[2]*I]);else{const k=c.bz();c.b0(k,s,[2*u[0],2*u[1],2*u[2]]);const O=c.bb(this._cachedClippingPlane,k);c.b2(P,k,[this._cachedClippingPlane[0]*O,this._cachedClippingPlane[1]*O,this._cachedClippingPlane[2]*O])}const C=function(k){const O=c.bz();return O[0]=k[0]*-k[3],O[1]=k[1]*-k[3],O[2]=k[2]*-k[3],{center:O,radius:Math.sqrt(1-k[3]*k[3])}}(y);return Eo(function(k,O,F){const q=c.bz();c.b2(q,F,k);const Z=c.bz();return c.bA(Z,k,q,O/c.b9(q)),Z}(C.center,C.radius,P))}getMatrixForModel(t,s){const u=c.V.convert(t),p=1/c.bE,y=c.bj();return c.bJ(y,y,u.lng/180*Math.PI),c.bh(y,y,-u.lat/180*Math.PI),c.O(y,y,[0,0,1+s/c.bE]),c.bh(y,y,.5*Math.PI),c.Q(y,y,[p,p,p]),y}getProjectionDataForCustomLayer(t=!0){const s=this.getProjectionData({overscaledTileID:new c.a2(0,0,0,0,0),applyGlobeMatrix:t});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(t){}}class hr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,u){return this._helper.interpolatePadding(t,s,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,u=!0){this._helper.resize(t,s,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,s){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(s,u)=>this.currentTransform.defaultConstrain(s,u),this.applyConstrain=(s,u)=>this._helper.applyConstrain(s,u),this._helper=new Vs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,u)=>this.defaultConstrain(s,u)},t),this._globeness=1,this._mercatorTransform=new Bs,this._verticalPerspectiveTransform=new cn}clone(){const t=new hr;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const s=this._mercatorTransform.getProjectionData(t),u=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:s.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return c.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,s,u){const p=this._mercatorTransform.getPitchedTextCorrection(t,s,u),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,s,u);return c.bu(p,y,this._globeness)}projectTileCoordinates(t,s,u,p){return this.currentTransform.projectTileCoordinates(t,s,u,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){return this.currentTransform.lngLatToCameraDepth(t,s)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,s,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,u,p)}setLocationAtPoint(t,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,s){return this.currentTransform.locationToScreenPoint(t,s)}screenPointToMercatorCoordinate(t,s){return this.currentTransform.screenPointToMercatorCoordinate(t,s)}screenPointToLocation(t,s){return this.currentTransform.screenPointToLocation(t,s)}isPointOnMapSurface(t,s){return this.currentTransform.isPointOnMapSurface(t,s)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,s){return this.currentTransform.getMatrixForModel(t,s)}getProjectionDataForCustomLayer(t=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return s;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return u.fallbackMatrix=s.mainMatrix,u}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class an{get useGlobeControls(){return!0}handlePanInertia(t,s){const u=vl(t,s);return Math.abs(u.lng-s.center.lng)>180&&(u.lng=s.center.lng+179.5*Math.sign(u.lng-s.center.lng)),{easingCenter:u,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,s){const u=t.around,p=s.screenPointToLocation(u);t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta);const y=s.zoom;t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta);const b=s.zoom-y;if(b===0)return;const I=c.bK(s.center.lng,p.lng),P=I/(Math.abs(I/180)+1),C=c.bK(s.center.lat,p.lat),k=s.getRayDirectionFromPixel(u),O=s.cameraPosition,F=-1*c.b5(O,k),q=c.bz();c.b0(q,O,[k[0]*F,k[1]*F,k[2]*F]);const Z=c.b7(q)-1,te=Math.exp(.5*-Math.max(Z-.3,0)),ie=$s(s.worldSize,s.center.lat)/Math.min(s.width,s.height),re=c.bx(ie,.9,.5,1,.25),le=(1-c.aq(-b))*Math.min(te,re),ve=s.center.lat,oe=s.zoom,_e=new c.V(s.center.lng+P*le,c.an(s.center.lat+C*le,-c.ao,c.ao));s.setLocationAtPoint(p,u);const Te=s.center,me=c.bx(Math.abs(I),45,85,0,1),Pe=c.bx(ie,.75,.35,0,1),Be=Math.pow(Math.max(me,Pe),.25),Fe=c.bK(Te.lng,_e.lng),Oe=c.bK(Te.lat,_e.lat);s.setCenter(new c.V(Te.lng+Fe*Be,Te.lat+Oe*Be).wrap()),s.setZoom(oe+ur(ve,s.center.lat))}handleMapControlsPan(t,s,u){if(!t.panDelta)return;const p=s.center.lat,y=s.zoom;s.setCenter(vl(t.panDelta,s).wrap()),s.setZoom(y+ur(p,s.center.lat))}cameraForBoxAndBearing(t,s,u,p,y){const b=Ca(t,s,u,p,y),I=s.left/y.width*2-1,P=(y.width-s.right)/y.width*2-1,C=s.top/y.height*-2+1,k=(y.height-s.bottom)/y.height*-2+1,O=c.bK(u.getWest(),u.getEast())<0,F=O?u.getEast():u.getWest(),q=O?u.getWest():u.getEast(),Z=Math.max(u.getNorth(),u.getSouth()),te=Math.min(u.getNorth(),u.getSouth()),ie=F+.5*c.bK(F,q),re=Z+.5*c.bK(Z,te),le=y.clone();le.setCenter(b.center),le.setBearing(b.bearing),le.setPitch(0),le.setRoll(0),le.setZoom(b.zoom);const ve=le.modelViewProjectionMatrix,oe=[tr(u.getNorthWest()),tr(u.getNorthEast()),tr(u.getSouthWest()),tr(u.getSouthEast()),tr(new c.V(q,re)),tr(new c.V(F,re)),tr(new c.V(ie,Z)),tr(new c.V(ie,te))],_e=tr(b.center);let Te=Number.POSITIVE_INFINITY;for(const me of oe)I<0&&(Te=an.getLesserNonNegativeNonNull(Te,an.solveVectorScale(me,_e,ve,"x",I))),P>0&&(Te=an.getLesserNonNegativeNonNull(Te,an.solveVectorScale(me,_e,ve,"x",P))),C>0&&(Te=an.getLesserNonNegativeNonNull(Te,an.solveVectorScale(me,_e,ve,"y",C))),k<0&&(Te=an.getLesserNonNegativeNonNull(Te,an.solveVectorScale(me,_e,ve,"y",k)));if(Number.isFinite(Te)&&Te!==0)return b.zoom=le.zoom+c.at(Te),b;ws()}handleJumpToCenterZoom(t,s){const u=t.center.lat,p=t.applyConstrain(s.center?c.V.convert(s.center):t.center,t.zoom).center;t.setCenter(p.wrap());const y=s.zoom!==void 0?+s.zoom:t.zoom+ur(u,p.lat);t.zoom!==y&&t.setZoom(y)}handleEaseTo(t,s){const u=t.zoom,p=t.center,y=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},I={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},P=s.zoom!==void 0,C=!t.isPaddingEqual(s.padding);let k=!1;const O=s.center?c.V.convert(s.center):p,F=t.applyConstrain(O,u).center;Ns(t,F);const q=t.clone();q.setCenter(F),q.setZoom(P?+s.zoom:u+ur(p.lat,O.lat)),q.setBearing(s.bearing);const Z=new c.P(c.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));q.setLocationAtPoint(F,Z);const te=(s.offset&&s.offsetAsPoint.mag())>0?q.center:F,ie=P?+s.zoom:u+ur(p.lat,te.lat),re=u+ur(p.lat,0),le=ie+ur(te.lat,0),ve=c.bK(p.lng,te.lng),oe=c.bK(p.lat,te.lat),_e=c.aq(le-re);return k=ie!==u,{easeFunc:Te=>{if(c.bo(b,I)||wo({startEulerAngles:b,endEulerAngles:I,tr:t,k:Te,useSlerp:b.roll!=I.roll}),C&&t.interpolatePadding(y,s.padding,Te),s.around)c.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(s.around,s.aroundPoint);else{const me=le>re?Math.min(2,_e):Math.max(.5,_e),Pe=Math.pow(me,1-Te),Be=E(p,ve,oe,Te*Pe);t.setCenter(Be.wrap())}if(k){const me=c.G.number(re,le,Te)+ur(0,t.center.lat);t.setZoom(me)}},isZooming:k,elevationCenter:te}}handleFlyTo(t,s){const u=s.zoom!==void 0,p=t.center,y=t.zoom,b=t.padding,I=!t.isPaddingEqual(s.padding),P=t.applyConstrain(c.V.convert(s.center||s.locationAtOffset),y).center,C=u?+s.zoom:t.zoom+ur(t.center.lat,P.lat),k=t.clone();k.setCenter(P),k.setZoom(C),k.setBearing(s.bearing);const O=new c.P(c.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));k.setLocationAtPoint(P,O);const F=k.center;Ns(t,F);const q=function(oe,_e,Te){const me=tr(_e),Pe=tr(Te),Be=c.b5(me,Pe),Fe=Math.acos(Be),Oe=Jr(oe);return Fe/(2*Math.PI)*Oe}(t,p,F),Z=y+ur(p.lat,0),te=C+ur(F.lat,0),ie=c.aq(te-Z);let re;if(typeof s.minZoom=="number"){const oe=+s.minZoom+ur(F.lat,0),_e=Math.min(oe,Z,te)+ur(0,F.lat),Te=t.applyConstrain(F,_e).zoom+ur(F.lat,0);re=c.aq(Te-Z)}const le=c.bK(p.lng,F.lng),ve=c.bK(p.lat,F.lat);return{easeFunc:(oe,_e,Te,me)=>{const Pe=E(p,le,ve,Te);I&&t.interpolatePadding(b,s.padding,oe);const Be=oe===1?F:Pe;t.setCenter(Be.wrap());const Fe=Z+c.at(_e);t.setZoom(oe===1?C:Fe+ur(0,Be.lat))},scaleOfZoom:ie,targetCenter:F,scaleOfMinZoom:re,pixelPathLength:q}}static solveVectorScale(t,s,u,p,y){const b=p==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],I=[u[3],u[7],u[11],u[15]],P=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],C=t[0]*I[0]+t[1]*I[1]+t[2]*I[2],k=s[0]*b[0]+s[1]*b[1]+s[2]*b[2],O=s[0]*I[0]+s[1]*I[1]+s[2]*I[2];return k+y*C===P+y*O||I[3]*(P-k)+b[3]*(O-C)+P*O==k*C?null:(k+b[3]-y*O-y*I[3])/(k-P-y*O+y*C)}static getLesserNonNegativeNonNull(t,s){return s!==null&&s>=0&&s<t?s:t}}class Fr{constructor(t){this._globe=t,this._mercatorCameraHelper=new Ts,this._verticalPerspectiveCameraHelper=new an}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,s){return this.currentHelper.handlePanInertia(t,s)}handleMapControlsRollPitchBearingZoom(t,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,s)}handleMapControlsPan(t,s,u){this.currentHelper.handleMapControlsPan(t,s,u)}cameraForBoxAndBearing(t,s,u,p,y){return this.currentHelper.cameraForBoxAndBearing(t,s,u,p,y)}handleJumpToCenterZoom(t,s){this.currentHelper.handleJumpToCenterZoom(t,s)}handleEaseTo(t,s){return this.currentHelper.handleEaseTo(t,s)}handleFlyTo(t,s){return this.currentHelper.handleFlyTo(t,s)}}const hi=(_,t)=>c.B(_,t&&t.filter(s=>s.identifier!=="source.canvas")),es=c.bO();class yi extends c.E{constructor(t,s={}){var u,p;super(),this._rtlPluginLoaded=()=>{for(const b in this.tileManagers){const I=this.tileManagers[b].getSource().type;I!=="vector"&&I!=="geojson"||this.tileManagers[b].reload()}},this.map=t,this.dispatcher=new Kt(Sn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(b,I)=>this.getGlyphs(b,I)),this.dispatcher.registerMessageHandler("GI",(b,I)=>this.getImages(b,I)),this.dispatcher.registerMessageHandler("GDA",(b,I)=>this.getDashes(b,I)),this.imageManager=new fe,this.imageManager.setEventedParent(this);const y=((u=t._container)===null||u===void 0?void 0:u.lang)||typeof document<"u"&&((p=document.documentElement)===null||p===void 0?void 0:p.lang)||void 0;this.glyphManager=new $t(t._requestManager,s.localIdeographFontFamily,y),this.lineAtlas=new Gt(256,512),this.crossTileSymbolIndex=new _i,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bP()),Se().on(de,this._rtlPluginLoaded),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const I=this.tileManagers[b.sourceId];if(!I)return;const P=I.getSource();if(P&&P.vectorLayerIds)for(const C in this._layers){const k=this._layers[C];k.source===P.id&&this._validateLayer(k)}})}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,s){var u,p,y;this._checkLoaded();const b=s===null?(y=(p=(u=this.stylesheet.state)===null||u===void 0?void 0:u[t])===null||p===void 0?void 0:p.default)!==null&&y!==void 0?y:null:s;if(c.bR(b,this._globalState[t]))return this;this._globalState[t]=b,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const s=[];for(const u in t)!c.bR(this._globalState[u],t[u].default)&&(s.push(u),this._globalState[u]=t[u].default);this._applyGlobalStateChanges(s)}_applyGlobalStateChanges(t){if(t.length===0)return;const s=new Set,u={};for(const p of t){u[p]=this._globalState[p];for(const y in this._layers){const b=this._layers[y],I=b.getLayoutAffectingGlobalStateRefs(),P=b.getPaintAffectingGlobalStateRefs(),C=b.getVisibilityAffectingGlobalStateRefs();if(I.has(p)&&s.add(b.source),P.has(p))for(const{name:k,value:O}of P.get(p))this._updatePaintProperty(b,k,O);C!=null&&C.has(p)&&(b.recalculateVisibility(),this._updateLayer(b))}}this.dispatcher.broadcast("UGS",u);for(const p in this.tileManagers)s.has(p)&&(this._reloadSource(p),this._changed=!0)}loadURL(t,s={},u){this.fire(new c.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const p=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;c.j(p,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,s,u)}).catch(b=>{this._loadStyleRequest=null,b&&!y.signal.aborted&&this.fire(new c.k(b))})}loadJSON(t,s={},u){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Ie.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,u)}).catch(()=>{})}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(es,{validate:!1})}_load(t,s,u){var p,y;let b=s.transformStyle?s.transformStyle(u,t):t;if(!s.validate||!hi(this,c.C(b))){b=Object.assign({},b),this._loaded=!0,this.stylesheet=b;for(const I in b.sources)this.addSource(I,b.sources[I],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new zn(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new Ft(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var t,s,u;const p=c.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",p),this._order=p.map(y=>y.id),this._layers={},this._serializedLayers=null;for(const y of p){const b=c.bT(y,this._globalState);if(b.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=b,c.bU(b)&&this.tileManagers[b.source]){const I=(u=(s=y.paint)===null||s===void 0?void 0:s["raster-fade-duration"])!==null&&u!==void 0?u:b.paint.get("raster-fade-duration");this.tileManagers[b.source].setRasterFadeDuration(I)}}}_loadSprite(t,s=!1,u=void 0){this.imageManager.setLoaded(!1);const p=new AbortController;let y;this._spriteRequest=p,function(b,I,P,C){return c._(this,void 0,void 0,function*(){const k=ue(b),O=P>1?"@2x":"",F={},q={};for(const{id:Z,url:te}of k){const ie=I.transformRequest(Ee(te,O,".json"),"SpriteJSON");F[Z]=c.j(ie,C);const re=I.transformRequest(Ee(te,O,".png"),"SpriteImage");q[Z]=xe.getImage(re,C)}return yield Promise.all([...Object.values(F),...Object.values(q)]),function(Z,te){return c._(this,void 0,void 0,function*(){const ie={};for(const re in Z){ie[re]={};const le=Ie.getImageCanvasContext((yield te[re]).data),ve=(yield Z[re]).data;for(const oe in ve){const{width:_e,height:Te,x:me,y:Pe,sdf:Be,pixelRatio:Fe,stretchX:Oe,stretchY:Ne,content:it,textFitWidth:at,textFitHeight:Je}=ve[oe];ie[re][oe]={data:null,pixelRatio:Fe,sdf:Be,stretchX:Oe,stretchY:Ne,content:it,textFitWidth:at,textFitHeight:Je,spriteData:{width:_e,height:Te,x:me,y:Pe,context:le}}}}return ie})}(F,q)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const I in b){this._spritesImagesIds[I]=[];const P=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(C=>!(C in b)):[];for(const C of P)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in b[I]){const k=I==="default"?C:`${I}:${C}`;this._spritesImagesIds[I].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,b[I][C],!1):this.imageManager.addImage(k,b[I][C]),s&&(this._changedImages[k]=!0)}}}).catch(b=>{this._spriteRequest=null,y=b,p.signal.aborted||this.fire(new c.k(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),u&&u(y)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(t){const s=this.tileManagers[t.source];if(!s)return;const u=t.sourceLayer;if(!u)return;const p=s.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(u)===-1)&&this.fire(new c.k(new Error(`Source layer "${u}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,s=!1){const u=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s?c.bV(u):u);const p=[];for(const y of t)if(u[y]){const b=s?c.bV(u[y]):u[y];p.push(b)}return p}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const u of s){const p=this._layers[u];p.type!=="custom"&&(t[u]=p.serialize())}return t}hasTransitions(){var t,s,u;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const p in this.tileManagers)if(this.tileManagers[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const b in this._updatedSources){const I=this._updatedSources[b];if(I==="reload")this._reloadSource(b);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const u={};for(const p in this.tileManagers){const y=this.tileManagers[p];u[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(t,this._availableImages),!y.isHidden(t.zoom)&&y.source&&(this.tileManagers[y.source].used=!0)}for(const p in u){const y=this.tileManagers[p];!!u[p]!=!!y.used&&y.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,s&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.tileManagers)this.tileManagers[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var u;this._checkLoaded();const p=this.serialize();if(t=s.transformStyle?s.transformStyle(p,t):t,((u=s.validate)===null||u===void 0||u)&&hi(this,c.C(t)))return!1;(t=c.bV(t)).layers=c.bS(t.layers);const y=c.bW(p,t),b=this._getOperationsToPerform(y);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const I of b.operations)I();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],u=[];for(const p of t)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,p.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,p.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,p.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,p.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,p.args));break;case"addSource":s.push(()=>this.addSource.apply(this,p.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,p.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,p.args));break;case"setLight":s.push(()=>this.setLight.apply(this,p.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,p.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,p.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,p.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,p.args));break;case"setSky":s.push(()=>this.setSky.apply(this,p.args));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":s.push(()=>this.setGlobalState.apply(this,p.args));break;case"setTransition":s.push(()=>{});break;default:u.push(p.command)}return{operations:s,unimplemented:u}}addImage(t,s){if(this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,u={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(c.C.source,`sources.${t}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=this.tileManagers[t]=new fr(t,s,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:t})),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new c.k(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const s=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],s.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.tileManagers[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(s),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,s,u={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new c.k(new Error(`Layer "${p}" already exists on this map.`)));let y;if(t.type==="custom"){if(hi(this,c.bX(t)))return;y=c.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(p,t.source),t=c.bV(t),t=c.e(t,{source:p})),this._validate(c.C.layer,`layers.${p}`,t,{arrayIndex:-1},u))return;y=c.bT(t,this._globalState),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)this.fire(new c.k(new Error(`Cannot add layer "${p}" before non-existing layer "${s}".`)));else{if(this._order.splice(b,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const I=this._removedLayers[p];delete this._removedLayers[p],I.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.tileManagers[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const u=this._order.indexOf(t);this._order.splice(u,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new c.k(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,u){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===s&&p.maxzoom===u||(s!=null&&(p.minzoom=s),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,u={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!c.bR(p.filter,s))return s==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(c.C.filter,`layers.${p.id}.filter`,s,null,u)||(p.setFilter(c.bV(s)),this._updateLayer(p)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return c.bV(this.getLayer(t).filter)}setLayoutProperty(t,s,u,p={}){this._checkLoaded();const y=this.getLayer(t);y?c.bR(y.getLayoutProperty(s),u)||(y.setLayoutProperty(s,u,p),this._updateLayer(y)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const u=this.getLayer(t);if(u)return u.getLayoutProperty(s);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,u,p={}){this._checkLoaded();const y=this.getLayer(t);y?c.bR(y.getPaintProperty(s),u)||this._updatePaintProperty(y,s,u,p):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,s,u,p={}){t.setPaintProperty(s,u,p)&&this._updateLayer(t),c.bU(t)&&s==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(u),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const u=t.source,p=t.sourceLayer,y=this.tileManagers[u];if(y===void 0)return void this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)));const b=y.getSource().type;b==="geojson"&&p?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||p?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,t.id,s)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const u=t.source,p=this.tileManagers[u];if(p===void 0)return void this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)));const y=p.getSource().type,b=y==="vector"?t.sourceLayer:void 0;y!=="vector"||b?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(b,t.id,s):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,u=t.sourceLayer,p=this.tileManagers[s];if(p!==void 0)return p.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(u,t.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=c.bY(this.tileManagers,y=>y.serialize()),s=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,p=this.stylesheet;return c.bZ({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:t,layers:s,terrain:u},y=>y!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=b=>this._layers[b].type==="fill-extrusion",u={},p=[];for(let b=this._order.length-1;b>=0;b--){const I=this._order[b];if(s(I)){u[I]=b;for(const P of t){const C=P[I];if(C)for(const k of C)p.push(k)}}}p.sort((b,I)=>I.intersectionZ-b.intersectionZ);const y=[];for(let b=this._order.length-1;b>=0;b--){const I=this._order[b];if(s(I))for(let P=p.length-1;P>=0;P--){const C=p[P].feature;if(u[C.layer.id]<b)break;y.push(C),p.pop()}else for(const P of t){const C=P[I];if(C)for(const k of C)y.push(k.feature)}}return y}queryRenderedFeatures(t,s,u){s&&s.filter&&this._validate(c.C.filter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const C of s.layers){const k=this._layers[C];if(!k)return this.fire(new c.k(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];p[k.source]=!0}}const y=[];s.availableImages=this._availableImages;const b=this._serializedAllLayers(),I=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,P=Object.assign(Object.assign({},s),{layers:I,globalState:this._globalState});for(const C in this.tileManagers)s.layers&&!p[C]||y.push(Dn(this.tileManagers[C],this._layers,b,t,P,u,this.map.terrain?(k,O,F)=>this.map.terrain.getElevation(k,O,F):void 0));return this.placement&&y.push(function(C,k,O,F,q,Z,te){const ie={},re=Z.queryRenderedSymbols(F),le=[];for(const ve of Object.keys(re).map(Number))le.push(te[ve]);le.sort(Nt);for(const ve of le){const oe=ve.featureIndex.lookupSymbolFeatures(re[ve.bucketInstanceId],k,ve.bucketIndex,ve.sourceLayerIndex,{filterSpec:q.filter,globalState:q.globalState},q.layers,q.availableImages,C);for(const _e in oe){const Te=ie[_e]=ie[_e]||[],me=oe[_e];me.sort((Pe,Be)=>{const Fe=ve.featureSortOrder;if(Fe){const Oe=Fe.indexOf(Pe.featureIndex);return Fe.indexOf(Be.featureIndex)-Oe}return Be.featureIndex-Pe.featureIndex});for(const Pe of me)Te.push(Pe)}}return function(ve,oe,_e){for(const Te in ve)for(const me of ve[Te])en(me,_e[oe[Te].source]);return ve}(ie,C,O)}(this._layers,b,this.tileManagers,t,P,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(t,s){s!=null&&s.filter&&this._validate(c.C.filter,"querySourceFeatures.filter",s.filter,null,s);const u=this.tileManagers[t];return u?function(p,y){const b=p.getRenderableIds().map(C=>p.getTileByID(C)),I=[],P={};for(let C=0;C<b.length;C++){const k=b[C],O=k.tileID.canonical.key;P[O]||(P[O]=!0,k.querySourceFeatures(I,y))}return I}(u,s?Object.assign(Object.assign({},s),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const b in t)if(!c.bR(t[b],u[b])){p=!0;break}if(!p)return;const y={now:ke(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(y)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,s={}){this._checkLoaded();const u=this.getSky();let p=!1;if(!t&&!u)return;if(t&&!u)p=!0;else if(!t&&u)p=!0;else for(const b in t)if(!c.bR(t[b],u[b])){p=!0;break}if(!p)return;const y={now:ke(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,s),this.sky.updateTransitions(y)}_setProjectionInternal(t){const s=function(u,p){const y={constrainOverride:p};if(Array.isArray(u)){const b=new qs({type:u});return{projection:b,transform:new hr(y),cameraHelper:new Fr(b)}}switch(u){case"mercator":return{projection:new kn,transform:new Bs(y),cameraHelper:new Ts};case"globe":{const b=new qs({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:b,transform:new hr(y),cameraHelper:new Fr(b)}}case"vertical-perspective":return{projection:new Ma,transform:new cn(y),cameraHelper:new an};default:return c.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new kn,transform:new Bs(y),cameraHelper:new Ts}}}(t,this.map.transformConstrain);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const u in this.tileManagers)this.tileManagers[u].reload()}_validate(t,s,u,p,y={}){return(!y||y.validate!==!1)&&hi(this,t.call(c.C,c.e({key:s,style:this.serialize(),value:u,styleSpec:c.u},p)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Se().off(de,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.tileManagers){const u=this.tileManagers[s];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const s in this.tileManagers)this.tileManagers[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,s,u,p,y=!1){let b=!1,I=!1;const P={};for(const C of this._order){const k=this._layers[C];if(k.type!=="symbol")continue;if(!P[k.source]){const F=this.tileManagers[k.source];P[k.source]=F.getRenderableIds(!0).map(q=>F.getTileByID(q)).sort((q,Z)=>Z.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(Z.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(k,P[k.source],t.center.lng);b=b||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ke(),t.zoom))&&(this.pauseablePlacement=new Yi(t,this.map.terrain,this._order,y,s,u,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ke()),I=!0),b&&this.pauseablePlacement.placement.setStale()),I||b)for(const C of this._order){const k=this._layers[C];k.type==="symbol"&&this.placement.updateLayerOpacities(k,P[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ke())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,s){return c._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const p=this.tileManagers[s.source];return p&&p.setDependencies(s.tileID.key,s.type,s.icons),u})}getGlyphs(t,s){return c._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(s.stacks),p=this.tileManagers[s.source];return p&&p.setDependencies(s.tileID.key,s.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(c.C.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,s){return c._(this,void 0,void 0,function*(){const u={};for(const[p,y]of Object.entries(s.dashes))u[p]=this.lineAtlas.getDash(y.dasharray,y.round);return u})}addSprite(t,s,u={},p){this._checkLoaded();const y=[{id:t,url:s}],b=[...ue(this.stylesheet.sprite),...y];this._validate(c.C.sprite,"sprite",b,null,u)||(this.stylesheet.sprite=b,this._loadSprite(y,!0,p))}removeSprite(t){this._checkLoaded();const s=ue(this.stylesheet.sprite);if(s.find(u=>u.id===t)){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;s.splice(s.findIndex(u=>u.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ue(this.stylesheet.sprite)}setSprite(t,s={},u){this._checkLoaded(),t&&this._validate(c.C.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const s=this.tileManagers[t];s.setEventedParent(null),s.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const s=this._layers[t];s.setEventedParent(null),s.onRemove&&s.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Hs=c.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ro{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,u,p,y,b,I,P,C){this.context=t;let k=this.boundPaintVertexBuffers.length!==p.length;for(let O=0;!k&&O<p.length;O++)this.boundPaintVertexBuffers[O]!==p[O]&&(k=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||k||this.boundIndexBuffer!==y||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==C?this.freshBind(s,u,p,y,b,I,P,C):(t.bindVertexArray.set(this.vao),I&&I.bind(),y&&y.dynamicDraw&&y.bind(),P&&P.bind(),C&&C.bind())}freshBind(t,s,u,p,y,b,I,P){const C=t.numAttributes,k=this.context,O=k.gl;this.vao&&this.destroy(),this.vao=k.createVertexArray(),k.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=P,s.enableAttributes(O,t);for(const F of u)F.enableAttributes(O,t);b&&b.enableAttributes(O,t),I&&I.enableAttributes(O,t),P&&P.enableAttributes(O,t),s.bind(),s.setVertexAttribPointers(O,t,y);for(const F of u)F.bind(),F.setVertexAttribPointers(O,t,y);b&&(b.bind(),b.setVertexAttribPointers(O,t,y)),p&&p.bind(),I&&(I.bind(),I.setVertexAttribPointers(O,t,y)),P&&(P.bind(),P.setVertexAttribPointers(O,t,y)),k.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const xl=(_,t,s,u,p)=>({u_texture:0,u_ele_delta:_,u_fog_matrix:t,u_fog_color:s?s.properties.get("fog-color"):c.bp.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:s?s.calculateFogBlendOpacity(u):0,u_horizon_color:s?s.properties.get("horizon-color"):c.bp.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),Ra={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function wc(_){const t=[];for(let s=0;s<_.length;s++){if(_[s]===null)continue;const u=_[s].split(" ");t.push(u.pop())}return t}class Ad{constructor(t,s,u,p,y,b,I,P,C=[]){const k=t.gl;this.program=k.createProgram();const O=wc(s.staticAttributes),F=u?u.getBinderAttributes():[],q=O.concat(F),Z=Qn.prelude.staticUniforms?wc(Qn.prelude.staticUniforms):[],te=I.staticUniforms?wc(I.staticUniforms):[],ie=s.staticUniforms?wc(s.staticUniforms):[],re=u?u.getBinderUniforms():[],le=Z.concat(te).concat(ie).concat(re),ve=[];for(const Fe of le)ve.indexOf(Fe)<0&&ve.push(Fe);const oe=u?u.defines():[];Ii(k)&&oe.unshift("#version 300 es"),y&&oe.push("#define OVERDRAW_INSPECTOR;"),b&&oe.push("#define TERRAIN3D;"),P&&oe.push(P),C&&oe.push(...C);let _e=oe.concat(Qn.prelude.fragmentSource,I.fragmentSource,s.fragmentSource).join(`
`),Te=oe.concat(Qn.prelude.vertexSource,I.vertexSource,s.vertexSource).join(`
`);Ii(k)||(_e=function(Fe){return Fe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(_e),Te=function(Fe){return Fe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Te));const me=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(me,_e),k.compileShader(me),!k.getShaderParameter(me,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(me)}`);k.attachShader(this.program,me);const Pe=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(Pe,Te),k.compileShader(Pe),!k.getShaderParameter(Pe,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(Pe)}`);k.attachShader(this.program,Pe),this.attributes={};const Be={};this.numAttributes=q.length;for(let Fe=0;Fe<this.numAttributes;Fe++)q[Fe]&&(k.bindAttribLocation(this.program,Fe,q[Fe]),this.attributes[q[Fe]]=Fe);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(Pe),k.deleteShader(me);for(let Fe=0;Fe<ve.length;Fe++){const Oe=ve[Fe];if(Oe&&!Be[Oe]){const Ne=k.getUniformLocation(this.program,Oe);Ne&&(Be[Oe]=Ne)}}this.fixedUniforms=p(t,Be),this.terrainUniforms=((Fe,Oe)=>({u_depth:new c.b_(Fe,Oe.u_depth),u_terrain:new c.b_(Fe,Oe.u_terrain),u_terrain_dim:new c.bq(Fe,Oe.u_terrain_dim),u_terrain_matrix:new c.c0(Fe,Oe.u_terrain_matrix),u_terrain_unpack:new c.c1(Fe,Oe.u_terrain_unpack),u_terrain_exaggeration:new c.bq(Fe,Oe.u_terrain_exaggeration)}))(t,Be),this.projectionUniforms=((Fe,Oe)=>({u_projection_matrix:new c.c0(Fe,Oe.u_projection_matrix),u_projection_tile_mercator_coords:new c.c1(Fe,Oe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.c1(Fe,Oe.u_projection_clipping_plane),u_projection_transition:new c.bq(Fe,Oe.u_projection_transition),u_projection_fallback_matrix:new c.c0(Fe,Oe.u_projection_fallback_matrix)}))(t,Be),this.binderUniforms=u?u.getUniforms(t,Be):[]}draw(t,s,u,p,y,b,I,P,C,k,O,F,q,Z,te,ie,re,le,ve){const oe=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(p),t.setColorMode(y),t.setCullFace(b),P){t.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,P.depthTexture),t.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,P.texture);for(const Te in this.terrainUniforms)this.terrainUniforms[Te].set(P[Te])}if(C)for(const Te in C)this.projectionUniforms[Ra[Te]].set(C[Te]);if(I)for(const Te in this.fixedUniforms)this.fixedUniforms[Te].set(I[Te]);ie&&ie.setUniforms(t,this.binderUniforms,Z,{zoom:te});let _e=0;switch(s){case oe.LINES:_e=2;break;case oe.TRIANGLES:_e=3;break;case oe.LINE_STRIP:_e=1}for(const Te of q.get()){const me=Te.vaos||(Te.vaos={});(me[k]||(me[k]=new ro)).bind(t,this,O,ie?ie.getPaintVertexBuffers():[],F,Te.vertexOffset,re,le,ve),oe.drawElements(s,Te.primitiveLength*_e,oe.UNSIGNED_SHORT,Te.primitiveOffset*_e*2)}}}function Cd(_,t,s){const u=1/c.aN(s,1,t.transform.tileZoom),p=Math.pow(2,s.tileID.overscaledZ),y=s.tileSize*Math.pow(2,t.transform.tileZoom)/p,b=y*(s.tileID.canonical.x+s.tileID.wrap*p),I=y*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[b>>16,I>>16],u_pixel_coord_lower:[65535&b,65535&I]}}const Gu=(_,t,s,u)=>{const p=_.style.light,y=p.properties.get("position"),b=[y.x,y.y,y.z],I=c.c4();p.properties.get("anchor")==="viewport"&&c.c5(I,_.transform.bearingInRadians),c.c6(b,b,I);const P=_.transform.transformLightDirection(b),C=p.properties.get("color");return{u_lightpos:b,u_lightpos_globe:P,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+t,u_opacity:s,u_fill_translate:u}},Hu=(_,t,s,u,p,y,b)=>c.e(Gu(_,t,s,u),Cd(y,_,b),{u_height_factor:-Math.pow(2,p.overscaledZ)/b.tileSize/8}),Zu=(_,t,s,u)=>c.e(Cd(t,_,s),{u_fill_translate:u}),Md=(_,t)=>({u_world:_,u_fill_translate:t}),Rd=(_,t,s,u,p)=>c.e(Zu(_,t,s,p),{u_world:u}),kd=(_,t,s,u,p)=>{const y=_.transform;let b,I,P=0;if(s.paint.get("circle-pitch-alignment")==="map"){const C=c.aN(t,1,y.zoom);b=!0,I=[C,C],P=C/(c.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*p}else b=!1,I=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+b,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:I,u_globe_extrude_scale:P,u_translate:u}},Qo=_=>({u_pixel_extrude_scale:[1/_.width,1/_.height]}),Dd=_=>({u_viewport_size:[_.width,_.height]}),Wu=(_,t=1)=>({u_color:_,u_overlay:0,u_overlay_scale:t}),ka=(_,t,s,u)=>{const p=c.aN(_,1,t)/(c.a5*Math.pow(2,_.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:c.aN(_,1,t),u_intensity:s,u_globe_extrude_scale:p}},Ld=(_,t,s,u)=>{const p=c.N();c.c7(p,0,_.width,_.height,0,0,1);const y=_.context.gl;return{u_matrix:p,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:s,u_color_ramp:u,u_opacity:t.paint.get("heatmap-opacity")}},Tc=(_,t,s)=>{const u=s.paint.get("hillshade-accent-color");let p;switch(s.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const y=s.getIlluminationProperties();for(let b=0;b<y.directionRadians.length;b++)s.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[b]+=_.transform.bearingInRadians);return{u_image:0,u_latrange:om(0,t.tileID),u_exaggeration:s.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:u,u_method:p,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},sm=(_,t)=>{const s=t.stride,u=c.N();return c.c7(u,0,c.a5,-c.a5,0,0,1),c.O(u,u,[0,-c.a5,0]),{u_matrix:u,u_image:1,u_dimension:[s,s],u_zoom:_.overscaledZ,u_unpack:t.getUnpackVector()}};function om(_,t){const s=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new c.a9(0,u/s).toLngLat().lat,new c.a9(0,(u+1)/s).toLngLat().lat]}const zd=(_,t,s=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:s,u_opacity:_.paint.get("color-relief-opacity")}),bl=(_,t,s,u)=>{const p=_.transform;return{u_translation:Ic(_,t,s),u_ratio:u/c.aN(t,1,p.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Fd=(_,t,s,u,p)=>c.e(bl(_,t,s,u),{u_image:0,u_image_height:p}),Ku=(_,t,s,u,p)=>{const y=_.transform,b=Es(t,y);return{u_translation:Ic(_,t,s),u_texsize:t.imageAtlasTexture.size,u_ratio:u/c.aN(t,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[b,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Od=(_,t,s,u,p)=>{const y=Es(t,_.transform);return c.e(bl(_,t,s,u),{u_tileratio:y,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image:0,u_mix:p.t,u_lineatlas_width:_.lineAtlas.width,u_lineatlas_height:_.lineAtlas.height})},Ec=(_,t,s,u,p,y)=>{const b=Es(t,_.transform);return c.e(bl(_,t,s,u),{u_image:0,u_image_height:y,u_tileratio:b,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image_dash:1,u_mix:p.t,u_lineatlas_width:_.lineAtlas.width,u_lineatlas_height:_.lineAtlas.height})};function Es(_,t){return 1/c.aN(_,1,t.tileZoom)}function Ic(_,t,s){return c.aO(_.transform,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Xu=(_,t,s,u,p)=>{return{u_tl_parent:_,u_scale_parent:t,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(b=u.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(y=u.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Yu(u.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var y,b};function Yu(_){_*=Math.PI/180;const t=Math.sin(_),s=Math.cos(_);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Qu=(_,t,s,u,p,y,b,I,P,C,k,O,F)=>{const q=b.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:q.width/q.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_label_plane_matrix:I,u_coord_matrix:P,u_is_text:+k,u_pitch_with_map:+u,u_is_along_line:p,u_is_variable_anchor:y,u_texsize:O,u_texture:0,u_translation:C,u_pitched_scale:F}},Sc=(_,t,s,u,p,y,b,I,P,C,k,O,F,q)=>{const Z=b.transform;return c.e(Qu(_,t,s,u,p,y,b,I,P,C,k,O,q),{u_gamma_scale:u?Math.cos(Z.pitch*Math.PI/180)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:1})},Jo=(_,t,s,u,p,y,b,I,P,C,k,O,F)=>c.e(Sc(_,t,s,u,p,y,b,I,P,C,!0,k,0,F),{u_texsize_icon:O,u_texture_icon:1}),Ju=(_,t)=>({u_opacity:_,u_color:t}),am=(_,t,s,u,p)=>c.e(function(y,b,I,P){const C=I.imageManager.getPattern(y.from.toString()),k=I.imageManager.getPattern(y.to.toString()),{width:O,height:F}=I.imageManager.getPixelSize(),q=Math.pow(2,P.tileID.overscaledZ),Z=P.tileSize*Math.pow(2,I.transform.tileZoom)/q,te=Z*(P.tileID.canonical.x+P.tileID.wrap*q),ie=Z*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[O,F],u_mix:b.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/c.aN(P,1,I.transform.tileZoom),u_pixel_coord_upper:[te>>16,ie>>16],u_pixel_coord_lower:[65535&te,65535&ie]}}(s,p,t,u),{u_opacity:_}),Nd=(_,t)=>{},lm={fillExtrusion:(_,t)=>({u_lightpos:new c.c2(_,t.u_lightpos),u_lightpos_globe:new c.c2(_,t.u_lightpos_globe),u_lightintensity:new c.bq(_,t.u_lightintensity),u_lightcolor:new c.c2(_,t.u_lightcolor),u_vertical_gradient:new c.bq(_,t.u_vertical_gradient),u_opacity:new c.bq(_,t.u_opacity),u_fill_translate:new c.c3(_,t.u_fill_translate)}),fillExtrusionPattern:(_,t)=>({u_lightpos:new c.c2(_,t.u_lightpos),u_lightpos_globe:new c.c2(_,t.u_lightpos_globe),u_lightintensity:new c.bq(_,t.u_lightintensity),u_lightcolor:new c.c2(_,t.u_lightcolor),u_vertical_gradient:new c.bq(_,t.u_vertical_gradient),u_height_factor:new c.bq(_,t.u_height_factor),u_opacity:new c.bq(_,t.u_opacity),u_fill_translate:new c.c3(_,t.u_fill_translate),u_image:new c.b_(_,t.u_image),u_texsize:new c.c3(_,t.u_texsize),u_pixel_coord_upper:new c.c3(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(_,t.u_pixel_coord_lower),u_scale:new c.c2(_,t.u_scale),u_fade:new c.bq(_,t.u_fade)}),fill:(_,t)=>({u_fill_translate:new c.c3(_,t.u_fill_translate)}),fillPattern:(_,t)=>({u_image:new c.b_(_,t.u_image),u_texsize:new c.c3(_,t.u_texsize),u_pixel_coord_upper:new c.c3(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(_,t.u_pixel_coord_lower),u_scale:new c.c2(_,t.u_scale),u_fade:new c.bq(_,t.u_fade),u_fill_translate:new c.c3(_,t.u_fill_translate)}),fillOutline:(_,t)=>({u_world:new c.c3(_,t.u_world),u_fill_translate:new c.c3(_,t.u_fill_translate)}),fillOutlinePattern:(_,t)=>({u_world:new c.c3(_,t.u_world),u_image:new c.b_(_,t.u_image),u_texsize:new c.c3(_,t.u_texsize),u_pixel_coord_upper:new c.c3(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(_,t.u_pixel_coord_lower),u_scale:new c.c2(_,t.u_scale),u_fade:new c.bq(_,t.u_fade),u_fill_translate:new c.c3(_,t.u_fill_translate)}),circle:(_,t)=>({u_camera_to_center_distance:new c.bq(_,t.u_camera_to_center_distance),u_scale_with_map:new c.b_(_,t.u_scale_with_map),u_pitch_with_map:new c.b_(_,t.u_pitch_with_map),u_extrude_scale:new c.c3(_,t.u_extrude_scale),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_globe_extrude_scale:new c.bq(_,t.u_globe_extrude_scale),u_translate:new c.c3(_,t.u_translate)}),collisionBox:(_,t)=>({u_pixel_extrude_scale:new c.c3(_,t.u_pixel_extrude_scale)}),collisionCircle:(_,t)=>({u_viewport_size:new c.c3(_,t.u_viewport_size)}),debug:(_,t)=>({u_color:new c.b$(_,t.u_color),u_overlay:new c.b_(_,t.u_overlay),u_overlay_scale:new c.bq(_,t.u_overlay_scale)}),depth:Nd,clippingMask:Nd,heatmap:(_,t)=>({u_extrude_scale:new c.bq(_,t.u_extrude_scale),u_intensity:new c.bq(_,t.u_intensity),u_globe_extrude_scale:new c.bq(_,t.u_globe_extrude_scale)}),heatmapTexture:(_,t)=>({u_matrix:new c.c0(_,t.u_matrix),u_world:new c.c3(_,t.u_world),u_image:new c.b_(_,t.u_image),u_color_ramp:new c.b_(_,t.u_color_ramp),u_opacity:new c.bq(_,t.u_opacity)}),hillshade:(_,t)=>({u_image:new c.b_(_,t.u_image),u_latrange:new c.c3(_,t.u_latrange),u_exaggeration:new c.bq(_,t.u_exaggeration),u_altitudes:new c.c9(_,t.u_altitudes),u_azimuths:new c.c9(_,t.u_azimuths),u_accent:new c.b$(_,t.u_accent),u_method:new c.b_(_,t.u_method),u_shadows:new c.c8(_,t.u_shadows),u_highlights:new c.c8(_,t.u_highlights)}),hillshadePrepare:(_,t)=>({u_matrix:new c.c0(_,t.u_matrix),u_image:new c.b_(_,t.u_image),u_dimension:new c.c3(_,t.u_dimension),u_zoom:new c.bq(_,t.u_zoom),u_unpack:new c.c1(_,t.u_unpack)}),colorRelief:(_,t)=>({u_image:new c.b_(_,t.u_image),u_unpack:new c.c1(_,t.u_unpack),u_dimension:new c.c3(_,t.u_dimension),u_elevation_stops:new c.b_(_,t.u_elevation_stops),u_color_stops:new c.b_(_,t.u_color_stops),u_color_ramp_size:new c.b_(_,t.u_color_ramp_size),u_opacity:new c.bq(_,t.u_opacity)}),line:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels)}),lineGradient:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels),u_image:new c.b_(_,t.u_image),u_image_height:new c.bq(_,t.u_image_height)}),linePattern:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_texsize:new c.c3(_,t.u_texsize),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_image:new c.b_(_,t.u_image),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels),u_scale:new c.c2(_,t.u_scale),u_fade:new c.bq(_,t.u_fade)}),lineSDF:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels),u_image:new c.b_(_,t.u_image),u_mix:new c.bq(_,t.u_mix),u_tileratio:new c.bq(_,t.u_tileratio),u_crossfade_from:new c.bq(_,t.u_crossfade_from),u_crossfade_to:new c.bq(_,t.u_crossfade_to),u_lineatlas_width:new c.bq(_,t.u_lineatlas_width),u_lineatlas_height:new c.bq(_,t.u_lineatlas_height)}),lineGradientSDF:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels),u_image:new c.b_(_,t.u_image),u_image_height:new c.bq(_,t.u_image_height),u_tileratio:new c.bq(_,t.u_tileratio),u_crossfade_from:new c.bq(_,t.u_crossfade_from),u_crossfade_to:new c.bq(_,t.u_crossfade_to),u_image_dash:new c.b_(_,t.u_image_dash),u_mix:new c.bq(_,t.u_mix),u_lineatlas_width:new c.bq(_,t.u_lineatlas_width),u_lineatlas_height:new c.bq(_,t.u_lineatlas_height)}),raster:(_,t)=>({u_tl_parent:new c.c3(_,t.u_tl_parent),u_scale_parent:new c.bq(_,t.u_scale_parent),u_buffer_scale:new c.bq(_,t.u_buffer_scale),u_fade_t:new c.bq(_,t.u_fade_t),u_opacity:new c.bq(_,t.u_opacity),u_image0:new c.b_(_,t.u_image0),u_image1:new c.b_(_,t.u_image1),u_brightness_low:new c.bq(_,t.u_brightness_low),u_brightness_high:new c.bq(_,t.u_brightness_high),u_saturation_factor:new c.bq(_,t.u_saturation_factor),u_contrast_factor:new c.bq(_,t.u_contrast_factor),u_spin_weights:new c.c2(_,t.u_spin_weights),u_coords_top:new c.c1(_,t.u_coords_top),u_coords_bottom:new c.c1(_,t.u_coords_bottom)}),symbolIcon:(_,t)=>({u_is_size_zoom_constant:new c.b_(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(_,t.u_is_size_feature_constant),u_size_t:new c.bq(_,t.u_size_t),u_size:new c.bq(_,t.u_size),u_camera_to_center_distance:new c.bq(_,t.u_camera_to_center_distance),u_pitch:new c.bq(_,t.u_pitch),u_rotate_symbol:new c.b_(_,t.u_rotate_symbol),u_aspect_ratio:new c.bq(_,t.u_aspect_ratio),u_fade_change:new c.bq(_,t.u_fade_change),u_label_plane_matrix:new c.c0(_,t.u_label_plane_matrix),u_coord_matrix:new c.c0(_,t.u_coord_matrix),u_is_text:new c.b_(_,t.u_is_text),u_pitch_with_map:new c.b_(_,t.u_pitch_with_map),u_is_along_line:new c.b_(_,t.u_is_along_line),u_is_variable_anchor:new c.b_(_,t.u_is_variable_anchor),u_texsize:new c.c3(_,t.u_texsize),u_texture:new c.b_(_,t.u_texture),u_translation:new c.c3(_,t.u_translation),u_pitched_scale:new c.bq(_,t.u_pitched_scale)}),symbolSDF:(_,t)=>({u_is_size_zoom_constant:new c.b_(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(_,t.u_is_size_feature_constant),u_size_t:new c.bq(_,t.u_size_t),u_size:new c.bq(_,t.u_size),u_camera_to_center_distance:new c.bq(_,t.u_camera_to_center_distance),u_pitch:new c.bq(_,t.u_pitch),u_rotate_symbol:new c.b_(_,t.u_rotate_symbol),u_aspect_ratio:new c.bq(_,t.u_aspect_ratio),u_fade_change:new c.bq(_,t.u_fade_change),u_label_plane_matrix:new c.c0(_,t.u_label_plane_matrix),u_coord_matrix:new c.c0(_,t.u_coord_matrix),u_is_text:new c.b_(_,t.u_is_text),u_pitch_with_map:new c.b_(_,t.u_pitch_with_map),u_is_along_line:new c.b_(_,t.u_is_along_line),u_is_variable_anchor:new c.b_(_,t.u_is_variable_anchor),u_texsize:new c.c3(_,t.u_texsize),u_texture:new c.b_(_,t.u_texture),u_gamma_scale:new c.bq(_,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_is_halo:new c.b_(_,t.u_is_halo),u_translation:new c.c3(_,t.u_translation),u_pitched_scale:new c.bq(_,t.u_pitched_scale)}),symbolTextAndIcon:(_,t)=>({u_is_size_zoom_constant:new c.b_(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(_,t.u_is_size_feature_constant),u_size_t:new c.bq(_,t.u_size_t),u_size:new c.bq(_,t.u_size),u_camera_to_center_distance:new c.bq(_,t.u_camera_to_center_distance),u_pitch:new c.bq(_,t.u_pitch),u_rotate_symbol:new c.b_(_,t.u_rotate_symbol),u_aspect_ratio:new c.bq(_,t.u_aspect_ratio),u_fade_change:new c.bq(_,t.u_fade_change),u_label_plane_matrix:new c.c0(_,t.u_label_plane_matrix),u_coord_matrix:new c.c0(_,t.u_coord_matrix),u_is_text:new c.b_(_,t.u_is_text),u_pitch_with_map:new c.b_(_,t.u_pitch_with_map),u_is_along_line:new c.b_(_,t.u_is_along_line),u_is_variable_anchor:new c.b_(_,t.u_is_variable_anchor),u_texsize:new c.c3(_,t.u_texsize),u_texsize_icon:new c.c3(_,t.u_texsize_icon),u_texture:new c.b_(_,t.u_texture),u_texture_icon:new c.b_(_,t.u_texture_icon),u_gamma_scale:new c.bq(_,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_is_halo:new c.b_(_,t.u_is_halo),u_translation:new c.c3(_,t.u_translation),u_pitched_scale:new c.bq(_,t.u_pitched_scale)}),background:(_,t)=>({u_opacity:new c.bq(_,t.u_opacity),u_color:new c.b$(_,t.u_color)}),backgroundPattern:(_,t)=>({u_opacity:new c.bq(_,t.u_opacity),u_image:new c.b_(_,t.u_image),u_pattern_tl_a:new c.c3(_,t.u_pattern_tl_a),u_pattern_br_a:new c.c3(_,t.u_pattern_br_a),u_pattern_tl_b:new c.c3(_,t.u_pattern_tl_b),u_pattern_br_b:new c.c3(_,t.u_pattern_br_b),u_texsize:new c.c3(_,t.u_texsize),u_mix:new c.bq(_,t.u_mix),u_pattern_size_a:new c.c3(_,t.u_pattern_size_a),u_pattern_size_b:new c.c3(_,t.u_pattern_size_b),u_scale_a:new c.bq(_,t.u_scale_a),u_scale_b:new c.bq(_,t.u_scale_b),u_pixel_coord_upper:new c.c3(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(_,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bq(_,t.u_tile_units_to_pixels)}),terrain:(_,t)=>({u_texture:new c.b_(_,t.u_texture),u_ele_delta:new c.bq(_,t.u_ele_delta),u_fog_matrix:new c.c0(_,t.u_fog_matrix),u_fog_color:new c.b$(_,t.u_fog_color),u_fog_ground_blend:new c.bq(_,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bq(_,t.u_fog_ground_blend_opacity),u_horizon_color:new c.b$(_,t.u_horizon_color),u_horizon_fog_blend:new c.bq(_,t.u_horizon_fog_blend),u_is_globe_mode:new c.bq(_,t.u_is_globe_mode)}),terrainDepth:(_,t)=>({u_ele_delta:new c.bq(_,t.u_ele_delta)}),terrainCoords:(_,t)=>({u_texture:new c.b_(_,t.u_texture),u_terrain_coords_id:new c.bq(_,t.u_terrain_coords_id),u_ele_delta:new c.bq(_,t.u_ele_delta)}),projectionErrorMeasurement:(_,t)=>({u_input:new c.bq(_,t.u_input),u_output_expected:new c.bq(_,t.u_output_expected)}),atmosphere:(_,t)=>({u_sun_pos:new c.c2(_,t.u_sun_pos),u_atmosphere_blend:new c.bq(_,t.u_atmosphere_blend),u_globe_position:new c.c2(_,t.u_globe_position),u_globe_radius:new c.bq(_,t.u_globe_radius),u_inv_proj_matrix:new c.c0(_,t.u_inv_proj_matrix)}),sky:(_,t)=>({u_sky_color:new c.b$(_,t.u_sky_color),u_horizon_color:new c.b$(_,t.u_horizon_color),u_horizon:new c.c3(_,t.u_horizon),u_horizon_normal:new c.c3(_,t.u_horizon_normal),u_sky_horizon_blend:new c.bq(_,t.u_sky_horizon_blend),u_sky_blend:new c.bq(_,t.u_sky_blend)})};class cm{constructor(t,s,u){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class um{constructor(t,s,u,p){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),t.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let u=0;u<this.attributes.length;u++){const p=s.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,s,u){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],b=s.attributes[y.name];b!==void 0&&t.vertexAttribPointer(b,y.components,t[Vd[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Gn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pc extends Gn{getDefault(){return c.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ac extends Gn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Cc extends Gn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class eh extends Gn{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ea extends Gn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class wl extends Gn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Da extends Gn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class fs extends Gn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Bd extends Gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ud extends Gn{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class th extends Gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class ta extends Gn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Mc extends Gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Rc extends Gn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Tl extends Gn{getDefault(){return c.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class kc extends Gn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class jd extends Gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class La extends Gn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class za extends Gn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class qd extends Gn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class nh extends Gn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class bn extends Gn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Dc extends Gn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class hm extends Gn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $d extends Gn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class El extends Gn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class dm extends Gn{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class pm extends Gn{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const u=this.gl;Ii(u)?u.bindVertexArray(t):(s=u.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Gd extends Gn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class fm extends Gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class rh extends Gn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Fa extends Gn{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Il extends Fa{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Lc extends Fa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ih extends Fa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const sh="Framebuffer is not complete";class zc{constructor(t,s,u,p,y){this.context=t,this.width=s,this.height=u;const b=t.gl,I=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new Il(t,I),p)this.depthAttachment=y?new ih(t,I):new Lc(t,I);else if(y)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error(sh)}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class Fc{constructor(t){var s,u;if(this.gl=t,this.clearColor=new Pc(this),this.clearDepth=new Ac(this),this.clearStencil=new Cc(this),this.colorMask=new eh(this),this.depthMask=new ea(this),this.stencilMask=new wl(this),this.stencilFunc=new Da(this),this.stencilOp=new fs(this),this.stencilTest=new Bd(this),this.depthRange=new Ud(this),this.depthTest=new th(this),this.depthFunc=new ta(this),this.blend=new Mc(this),this.blendFunc=new Rc(this),this.blendColor=new Tl(this),this.blendEquation=new kc(this),this.cullFace=new jd(this),this.cullFaceSide=new La(this),this.frontFace=new za(this),this.program=new qd(this),this.activeTexture=new nh(this),this.viewport=new bn(this),this.bindFramebuffer=new Dc(this),this.bindRenderbuffer=new hm(this),this.bindTexture=new $d(this),this.bindVertexBuffer=new El(this),this.bindElementBuffer=new dm(this),this.bindVertexArray=new pm(this),this.pixelStoreUnpack=new Gd(this),this.pixelStoreUnpackPremultiplyAlpha=new fm(this),this.pixelStoreUnpackFlipY=new rh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ii(t)){this.HALF_FLOAT=t.HALF_FLOAT;const p=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:p==null?void 0:p.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:p==null?void 0:p.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const p=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=p==null?void 0:p.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new cm(this,t,s)}createVertexBuffer(t,s,u){return new um(this,t,s,u)}createRenderbuffer(t,s,u){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,t,s,u),this.bindRenderbuffer.set(null),y}createFramebuffer(t,s,u,p){return new zc(this,t,s,u,p)}clear({color:t,depth:s,stencil:u}){const p=this.gl;let y=0;t&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){c.bR(t.blendFunction,$n.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ii(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return Ii(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Io;function na(_,t,s,u,p){const y=_.context,b=_.transform,I=y.gl,P=_.useProgram("collisionBox"),C=[];let k=0,O=0;for(let re=0;re<u.length;re++){const le=u[re],ve=t.getTile(le).getBucket(s);if(!ve)continue;const oe=p?ve.textCollisionBox:ve.iconCollisionBox,_e=ve.collisionCircleArray;_e.length>0&&(C.push({circleArray:_e,circleOffset:O,coord:le}),k+=_e.length/4,O=k),oe&&P.draw(y,I.LINES,ln.disabled,xn.disabled,_.colorModeForRenderPass(),vn.disabled,Qo(_.transform),_.style.map.terrain&&_.style.map.terrain.getTerrainData(le),b.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,_.transform.zoom,null,null,oe.collisionVertexBuffer)}if(!p||!C.length)return;const F=_.useProgram("collisionCircle"),q=new c.ca;q.resize(4*k),q._trim();let Z=0;for(const re of C)for(let le=0;le<re.circleArray.length/4;le++){const ve=4*le,oe=re.circleArray[ve+0],_e=re.circleArray[ve+1],Te=re.circleArray[ve+2],me=re.circleArray[ve+3];q.emplace(Z++,oe,_e,Te,me,0),q.emplace(Z++,oe,_e,Te,me,1),q.emplace(Z++,oe,_e,Te,me,2),q.emplace(Z++,oe,_e,Te,me,3)}(!Io||Io.length<2*k)&&(Io=function(re){const le=2*re,ve=new c.cc;ve.resize(le),ve._trim();for(let oe=0;oe<le;oe++){const _e=6*oe;ve.uint16[_e+0]=4*oe+0,ve.uint16[_e+1]=4*oe+1,ve.uint16[_e+2]=4*oe+2,ve.uint16[_e+3]=4*oe+2,ve.uint16[_e+4]=4*oe+3,ve.uint16[_e+5]=4*oe+0}return ve}(k));const te=y.createIndexBuffer(Io,!0),ie=y.createVertexBuffer(q,c.cb.members,!0);for(const re of C){const le=Dd(_.transform);F.draw(y,I.TRIANGLES,ln.disabled,xn.disabled,_.colorModeForRenderPass(),vn.disabled,le,_.style.map.terrain&&_.style.map.terrain.getTerrainData(re.coord),null,s.id,ie,te,c.aX.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,_.transform.zoom,null,null,null)}ie.destroy(),te.destroy()}const oh=c.ar(new Float32Array(16));function mm(_,t,s,u,p,y){const{horizontalAlign:b,verticalAlign:I}=c.aS(_);return new c.P((-(b-.5)*t/p+u[0])*y,(-(I-.5)*s/p+u[1])*y)}function Sl(_,t,s,u,p,y){const b=t.tileAnchorPoint.add(new c.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let I=u.mult(y);s||(I=I.rotate(-p));const P=b.add(I);return Ct(P.x,P.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(s){const I=Ln(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(_),P=Math.atan(I.y/I.x)+(I.x<0?Math.PI:0);return _.add(u.rotate(P))}return _.add(u)}function gm(_,t,s,u,p,y,b,I,P,C,k,O){const F=_.text.placedSymbolArray,q=_.text.dynamicLayoutVertexArray,Z=_.icon.dynamicLayoutVertexArray,te={};q.clear();for(let ie=0;ie<F.length;ie++){const re=F.get(ie),le=re.hidden||!re.crossTileID||_.allowVerticalPlacement&&!re.placedOrientation?null:u[re.crossTileID];if(le){const ve=new c.P(re.anchorX,re.anchorY),oe={getElevation:O,width:p.width,height:p.height,pitchedLabelPlaneMatrix:y,pitchWithMap:s,transform:p,tileAnchorPoint:ve,translation:C,unwrappedTileID:k},_e=s?Xr(ve.x,ve.y,oe):Ln(ve.x,ve.y,oe),Te=Kn(p.cameraToCenterDistance,_e.signedDistanceFromCamera);let me=c.aA(_.textSizeData,I,re)*Te/c.aM;s&&(me*=_.tilePixelRatio/b);const{width:Pe,height:Be,anchor:Fe,textOffset:Oe,textBoxScale:Ne}=le,it=mm(Fe,Pe,Be,Oe,Ne,me),at=p.getPitchedTextCorrection(ve.x+C[0],ve.y+C[1],k),Je=Sl(_e.point,oe,t,it,-p.bearingInRadians,at),dt=_.allowVerticalPlacement&&re.placedOrientation===c.az.vertical?Math.PI/2:0;for(let sn=0;sn<re.numGlyphs;sn++)c.aG(q,Je,dt);P&&re.associatedIconIndex>=0&&(te[re.associatedIconIndex]={shiftedAnchor:Je,angle:dt})}else Ur(re.numGlyphs,q)}if(P){Z.clear();const ie=_.icon.placedSymbolArray;for(let re=0;re<ie.length;re++){const le=ie.get(re);if(le.hidden)Ur(le.numGlyphs,Z);else{const ve=te[re];if(ve)for(let oe=0;oe<le.numGlyphs;oe++)c.aG(Z,ve.shiftedAnchor,ve.angle);else Ur(le.numGlyphs,Z)}}_.icon.dynamicLayoutVertexBuffer.updateData(Z)}_.text.dynamicLayoutVertexBuffer.updateData(q)}function Hd(_,t,s){return s.iconsInText&&t?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Pl(_,t,s,u,p,y,b,I,P,C,k,O,F){const q=_.context,Z=q.gl,te=_.transform,ie=I==="map",re=P==="map",le=I!=="viewport"&&s.layout.get("symbol-placement")!=="point",ve=ie&&!re&&!le,oe=!s.layout.get("symbol-sort-key").isConstant();let _e=!1;const Te=_.getDepthModeForSublayer(0,ln.ReadOnly),me=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Pe=[],Be=te.getCircleRadiusCorrection();for(const Fe of u){const Oe=t.getTile(Fe),Ne=Oe.getBucket(s);if(!Ne)continue;const it=p?Ne.text:Ne.icon;if(!it||!it.segments.get().length||!it.hasVisibleVertices)continue;const at=it.programConfigurations.get(s.id),Je=p||Ne.sdfIcons,dt=p?Ne.textSizeData:Ne.iconSizeData,sn=re||te.pitch!==0,Xn=_.useProgram(Hd(Je,p,Ne),at),dr=c.ay(dt,te.zoom),nr=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Fe);let gr,rr,Ir,_r,ti=[0,0],Or=null;if(p)rr=Oe.glyphAtlasTexture,Ir=Z.LINEAR,gr=Oe.glyphAtlasTexture.size,Ne.iconsInText&&(ti=Oe.imageAtlasTexture.size,Or=Oe.imageAtlasTexture,_r=sn||_.options.rotating||_.options.zooming||dt.kind==="composite"||dt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const ar=s.layout.get("icon-size").constantOr(0)!==1||Ne.iconsNeedLinear;rr=Oe.imageAtlasTexture,Ir=Je||_.options.rotating||_.options.zooming||ar||sn?Z.LINEAR:Z.NEAREST,gr=Oe.imageAtlasTexture.size}const Dr=c.aN(Oe,1,_.transform.zoom),di=Cr(ie,_.transform,Dr),Mo=c.N();c.aB(Mo,di);const so=ki(re,ie,_.transform,Dr),Zs=c.aO(te,Oe,y,b),Ni=te.getProjectionData({overscaledTileID:Fe,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),la=me&&Ne.hasTextData(),Zl=s.layout.get("icon-text-fit")!=="none"&&la&&Ne.hasIconData();if(le){const ar=_.style.map.terrain?(Hr,Zr)=>_.style.map.terrain.getElevation(Fe,Hr,Zr):null,ir=s.layout.get("text-rotation-alignment")==="map";Di(Ne,_,p,di,Mo,re,C,ir,Fe.toUnwrapped(),te.width,te.height,Zs,ar)}const ca=p&&me||Zl,_s=le||ca?oh:re?di:_.transform.clipSpaceToPixelsMatrix,Ws=Je&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cs;Cs=Je?Ne.iconsInText?Jo(dt.kind,dr,ve,re,le,ca,_,_s,so,Zs,gr,ti,Be):Sc(dt.kind,dr,ve,re,le,ca,_,_s,so,Zs,p,gr,0,Be):Qu(dt.kind,dr,ve,re,le,ca,_,_s,so,Zs,p,gr,Be);const Ms={program:Xn,buffers:it,uniformValues:Cs,projectionData:Ni,atlasTexture:rr,atlasTextureIcon:Or,atlasInterpolation:Ir,atlasInterpolationIcon:_r,isSDF:Je,hasHalo:Ws};if(oe&&Ne.canOverlap){_e=!0;const ar=it.segments.get();for(const ir of ar)Pe.push({segments:new c.aX([ir]),sortKey:ir.sortKey,state:Ms,terrainData:nr})}else Pe.push({segments:it.segments,sortKey:0,state:Ms,terrainData:nr})}_e&&Pe.sort((Fe,Oe)=>Fe.sortKey-Oe.sortKey);for(const Fe of Pe){const Oe=Fe.state;if(q.activeTexture.set(Z.TEXTURE0),Oe.atlasTexture.bind(Oe.atlasInterpolation,Z.CLAMP_TO_EDGE),Oe.atlasTextureIcon&&(q.activeTexture.set(Z.TEXTURE1),Oe.atlasTextureIcon&&Oe.atlasTextureIcon.bind(Oe.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Oe.isSDF){const Ne=Oe.uniformValues;Oe.hasHalo&&(Ne.u_is_halo=1,Oc(Oe.buffers,Fe.segments,s,_,Oe.program,Te,k,O,Ne,Oe.projectionData,Fe.terrainData)),Ne.u_is_halo=0}Oc(Oe.buffers,Fe.segments,s,_,Oe.program,Te,k,O,Oe.uniformValues,Oe.projectionData,Fe.terrainData)}}function Oc(_,t,s,u,p,y,b,I,P,C,k){const O=u.context;p.draw(O,O.gl.TRIANGLES,y,b,I,vn.backCCW,P,k,C,s.id,_.layoutVertexBuffer,_.indexBuffer,t,s.paint,u.transform.zoom,_.programConfigurations.get(s.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Zd(_,t,s,u,p){const y=_.context,b=y.gl,I=xn.disabled,P=new $n([b.ONE,b.ONE],c.bp.transparent,[!0,!0,!0,!0]),C=t.getBucket(s);if(!C)return;const k=u.key;let O=s.heatmapFbos.get(k);O||(O=Al(y,t.tileSize,t.tileSize),s.heatmapFbos.set(k,O)),y.bindFramebuffer.set(O.framebuffer),y.viewport.set([0,0,t.tileSize,t.tileSize]),y.clear({color:c.bp.transparent});const F=C.programConfigurations.get(s.id),q=_.useProgram("heatmap",F,!p),Z=_.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),te=_.style.map.terrain.getTerrainData(u);q.draw(y,b.TRIANGLES,ln.disabled,I,P,vn.disabled,ka(t,_.transform.zoom,s.paint.get("heatmap-intensity"),1),te,Z,s.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,s.paint,_.transform.zoom,F)}function Wd(_,t,s,u,p){const y=_.context,b=y.gl,I=_.transform;y.setColorMode(_.colorModeForRenderPass());const P=Nc(y,t),C=s.key,k=t.heatmapFbos.get(C);if(!k)return;y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,k.colorAttachment.get()),y.activeTexture.set(b.TEXTURE1),P.bind(b.LINEAR,b.CLAMP_TO_EDGE);const O=I.getProjectionData({overscaledTileID:s,applyTerrainMatrix:p,applyGlobeMatrix:!u});_.useProgram("heatmapTexture").draw(y,b.TRIANGLES,ln.disabled,xn.disabled,_.colorModeForRenderPass(),vn.disabled,Ld(_,t,0,1),null,O,t.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,t.paint,I.zoom),k.destroy(),t.heatmapFbos.delete(C)}function Al(_,t,s){var u,p;const y=_.gl,b=y.createTexture();y.bindTexture(y.TEXTURE_2D,b),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const I=(u=_.HALF_FLOAT)!==null&&u!==void 0?u:y.UNSIGNED_BYTE,P=(p=_.RGBA16F)!==null&&p!==void 0?p:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,P,t,s,0,y.RGBA,I,null);const C=_.createFramebuffer(t,s,!1,!1);return C.colorAttachment.set(b),C}function Nc(_,t){return t.colorRampTexture||(t.colorRampTexture=new c.T(_,t.colorRamp,_.gl.RGBA)),t.colorRampTexture}function Kd(_,t,s,u,p,y,b,I){let P=256;if(p.stepInterpolant){const C=t.getSource().maxzoom,k=b.canonical.z===C?Math.ceil(1<<_.transform.maxZoom-b.canonical.z):1;P=c.an(c.ce(y.maxLineLength/c.a5*1024*k),256,s.maxTextureSize)}return I.gradient=c.cf({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:P,image:I.gradient||void 0,clips:y.lineClipsArray}),I.texture?I.texture.update(I.gradient):I.texture=new c.T(s,I.gradient,u.RGBA),I.version=p.gradientVersion,I.texture}function Xd(_,t,s,u,p){_.activeTexture.set(t.TEXTURE0),s.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),u.updatePaintBuffers(p)}function Rr(_,t,s,u,p,y){(p||_.lineAtlas.dirty)&&(t.activeTexture.set(s.TEXTURE0),_.lineAtlas.bind(t)),u.updatePaintBuffers(y)}function ra(_,t,s,u,p,y,b){const I=y.gradients[p.id];let P=I.texture;p.gradientVersion!==I.version&&(P=Kd(_,t,s,u,p,y,b,I)),s.activeTexture.set(u.TEXTURE0),P.bind(p.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE)}function ts(_,t,s,u,p,y,b,I,P){const C=y.gradients[p.id];let k=C.texture;p.gradientVersion!==C.version&&(k=Kd(_,t,s,u,p,y,b,C)),s.activeTexture.set(u.TEXTURE0),k.bind(p.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE),s.activeTexture.set(u.TEXTURE1),_.lineAtlas.bind(s),I.updatePaintBuffers(P)}function Vc(_,t,s,u,p){if(!s||!u||!u.imageAtlas)return;const y=u.imageAtlas.patternPositions;let b=y[s.to.toString()],I=y[s.from.toString()];if(!b&&I&&(b=I),!I&&b&&(I=b),!b||!I){const P=p.getPaintProperty(t);b=y[P],I=y[P]}b&&I&&_.setConstantPatternPositions(b,I)}function Cl(_,t,s,u,p,y,b,I){const P=_.context.gl,C="fill-pattern",k=s.paint.get(C),O=k&&k.constantOr(1),F=s.getCrossfadeParameters();let q,Z,te,ie,re;const le=_.transform,ve=s.paint.get("fill-translate"),oe=s.paint.get("fill-translate-anchor");b?(Z=O&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=P.LINES):(Z=O?"fillPattern":"fill",q=P.TRIANGLES);const _e=k.constantOr(null);for(const Te of u){const me=t.getTile(Te);if(O&&!me.patternsLoaded())continue;const Pe=me.getBucket(s);if(!Pe)continue;const Be=Pe.programConfigurations.get(s.id),Fe=_.useProgram(Z,Be),Oe=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Te);O&&(_.context.activeTexture.set(P.TEXTURE0),me.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Be.updatePaintBuffers(F)),Vc(Be,C,_e,me,s);const Ne=le.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),it=c.aO(le,me,ve,oe);if(b){ie=Pe.indexBuffer2,re=Pe.segments2;const Je=[P.drawingBufferWidth,P.drawingBufferHeight];te=Z==="fillOutlinePattern"&&O?Rd(_,F,me,Je,it):Md(Je,it)}else ie=Pe.indexBuffer,re=Pe.segments,te=O?Zu(_,F,me,it):{u_fill_translate:it};const at=_.stencilModeForClipping(Te);Fe.draw(_.context,q,p,at,y,vn.backCCW,te,Oe,Ne,s.id,Pe.layoutVertexBuffer,ie,re,s.paint,_.transform.zoom,Be)}}function Bc(_,t,s,u,p,y,b,I){const P=_.context,C=P.gl,k="fill-extrusion-pattern",O=s.paint.get(k),F=O.constantOr(1),q=s.getCrossfadeParameters(),Z=s.paint.get("fill-extrusion-opacity"),te=O.constantOr(null),ie=_.transform;for(const re of u){const le=t.getTile(re),ve=le.getBucket(s);if(!ve)continue;const oe=_.style.map.terrain&&_.style.map.terrain.getTerrainData(re),_e=ve.programConfigurations.get(s.id),Te=_.useProgram(F?"fillExtrusionPattern":"fillExtrusion",_e);F&&(_.context.activeTexture.set(C.TEXTURE0),le.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),_e.updatePaintBuffers(q));const me=ie.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!I,applyTerrainMatrix:!0});Vc(_e,k,te,le,s);const Pe=c.aO(ie,le,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Be=s.paint.get("fill-extrusion-vertical-gradient"),Fe=F?Hu(_,Be,Z,Pe,re,q,le):Gu(_,Be,Z,Pe);Te.draw(P,P.gl.TRIANGLES,p,y,b,vn.backCCW,Fe,oe,me,s.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,s.paint,_.transform.zoom,_e,_.style.map.terrain&&ve.centroidVertexBuffer)}}function So(_,t,s,u,p,y,b,I,P){var C;const k=_.style.projection,O=_.context,F=_.transform,q=O.gl,Z=[`#define NUM_ILLUMINATION_SOURCES ${s.paint.get("hillshade-highlight-color").values.length}`],te=_.useProgram("hillshade",null,!1,Z),ie=!_.options.moving;for(const re of u){const le=t.getTile(re),ve=le.fbo;if(!ve)continue;const oe=k.getMeshFromTileID(O,re.canonical,I,!0,"raster"),_e=(C=_.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(re);O.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,ve.colorAttachment.get());const Te=F.getProjectionData({overscaledTileID:re,aligned:ie,applyGlobeMatrix:!P,applyTerrainMatrix:!0});te.draw(O,q.TRIANGLES,y,p[re.overscaledZ],b,vn.backCCW,Tc(_,le,s),_e,Te,s.id,oe.vertexBuffer,oe.indexBuffer,oe.segments)}}function Ml(_,t,s,u,p,y,b,I,P){var C;const k=_.style.projection,O=_.context,F=_.transform,q=O.gl,Z=_.useProgram("colorRelief"),te=!_.options.moving;let ie=!0,re=0;for(const le of u){const ve=t.getTile(le),oe=ve.dem;if(ie){const Fe=q.getParameter(q.MAX_TEXTURE_SIZE),{elevationTexture:Oe,colorTexture:Ne}=s.getColorRampTextures(O,Fe,oe.getUnpackVector());O.activeTexture.set(q.TEXTURE1),Oe.bind(q.NEAREST,q.CLAMP_TO_EDGE),O.activeTexture.set(q.TEXTURE4),Ne.bind(q.LINEAR,q.CLAMP_TO_EDGE),ie=!1,re=Oe.size[0]}if(!oe||!oe.data)continue;const _e=oe.stride,Te=oe.getPixels();if(O.activeTexture.set(q.TEXTURE0),O.pixelStoreUnpackPremultiplyAlpha.set(!1),ve.demTexture=ve.demTexture||_.getTileTexture(_e),ve.demTexture){const Fe=ve.demTexture;Fe.update(Te,{premultiply:!1}),Fe.bind(q.LINEAR,q.CLAMP_TO_EDGE)}else ve.demTexture=new c.T(O,Te,q.RGBA,{premultiply:!1}),ve.demTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const me=k.getMeshFromTileID(O,le.canonical,I,!0,"raster"),Pe=(C=_.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(le),Be=F.getProjectionData({overscaledTileID:le,aligned:te,applyGlobeMatrix:!P,applyTerrainMatrix:!0});Z.draw(O,q.TRIANGLES,y,p[le.overscaledZ],b,vn.backCCW,zd(s,ve.dem,re),Pe,Be,s.id,me.vertexBuffer,me.indexBuffer,me.segments)}}const ia=[new c.P(0,0),new c.P(c.a5,0),new c.P(c.a5,c.a5),new c.P(0,c.a5)];function Oa(_,t,s,u,p,y,b,I,P=!1,C=!1){const k=u[u.length-1].overscaledZ,O=_.context,F=O.gl,q=_.useProgram("raster"),Z=_.transform,te=_.style.projection,ie=_.colorModeForRenderPass(),re=!_.options.moving,le=s.paint.get("raster-opacity"),ve=s.paint.get("raster-resampling"),oe=s.paint.get("raster-fade-duration"),_e=!!_.style.map.terrain;for(const Te of u){const me=_.getDepthModeForSublayer(Te.overscaledZ-k,le===1?ln.ReadWrite:ln.ReadOnly,F.LESS),Pe=t.getTile(Te),Be=ve==="nearest"?F.NEAREST:F.LINEAR;O.activeTexture.set(F.TEXTURE0),Pe.texture.bind(Be,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),O.activeTexture.set(F.TEXTURE1);const{parentTile:Fe,parentScaleBy:Oe,parentTopLeft:Ne,fadeValues:it}=Yd(Pe,t,oe,_e);Pe.fadeOpacity=it.tileOpacity,Fe?(Fe.fadeOpacity=it.parentTileOpacity,Fe.texture.bind(Be,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST)):Pe.texture.bind(Be,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Pe.texture.useMipmap&&O.extTextureFilterAnisotropic&&_.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const at=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Te),Je=Z.getProjectionData({overscaledTileID:Te,aligned:re,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),dt=Xu(Ne,Oe,it.fadeMix,s,I),sn=te.getMeshFromTileID(O,Te.canonical,y,b,"raster");q.draw(O,F.TRIANGLES,me,p?p[Te.overscaledZ]:xn.disabled,ie,P?vn.frontCCW:vn.backCCW,dt,at,Je,s.id,sn.vertexBuffer,sn.indexBuffer,sn.segments)}}function Yd(_,t,s,u){const p={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(s===0||u)return p;if(_.fadingParentID){const y=t.getLoadedTile(_.fadingParentID);if(!y)return p;const b=Math.pow(2,y.tileID.overscaledZ-_.tileID.overscaledZ),I=[_.tileID.canonical.x*b%1,_.tileID.canonical.y*b%1],P=function(C,k,O){const F=ke(),q=(F-k.timeAdded)/O,Z=C.fadingDirection===Me.Incoming,te=c.an((F-C.timeAdded)/O,0,1),ie=c.an(1-q,0,1),re=Z?te:ie;return{tileOpacity:re,parentTileOpacity:Z?ie:te,fadeMix:{opacity:1,mix:1-re}}}(_,y,s);return{parentTile:y,parentScaleBy:b,parentTopLeft:I,fadeValues:P}}if(_.selfFading){const y=function(b,I){const P=(ke()-b.timeAdded)/I,C=c.an(P,0,1);return{tileOpacity:C,fadeMix:{opacity:C,mix:0}}}(_,s);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:y}}return p}const Qd=new c.bp(1,0,0,1),Jd=new c.bp(0,1,0,1),ep=new c.bp(0,0,1,1),tp=new c.bp(1,0,1,1),Po=new c.bp(0,1,1,1);function ah(_,t,s,u){Rl(_,0,t+s/2,_.transform.width,s,u)}function lh(_,t,s,u){Rl(_,t-s/2,0,s,_.transform.height,u)}function Rl(_,t,s,u,p,y){const b=_.context,I=b.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*_.pixelRatio,s*_.pixelRatio,u*_.pixelRatio,p*_.pixelRatio),b.clear({color:y}),I.disable(I.SCISSOR_TEST)}function np(_,t,s){const u=_.context,p=u.gl,y=_.useProgram("debug"),b=ln.disabled,I=xn.disabled,P=_.colorModeForRenderPass(),C="$debug",k=_.style.map.terrain&&_.style.map.terrain.getTerrainData(s);u.activeTexture.set(p.TEXTURE0);const O=t.getTileByID(s.key).latestRawTileData,F=Math.floor((O&&O.byteLength||0)/1024),q=t.getTile(s).tileSize,Z=512/Math.min(q,512)*(s.overscaledZ/_.transform.zoom)*.5;let te=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(te+=` => ${s.overscaledZ}`),function(re,le){re.initDebugOverlayCanvas();const ve=re.debugOverlayCanvas,oe=re.context.gl,_e=re.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,ve.width,ve.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(le,5,5),_e.strokeText(le,5,5),re.debugOverlayTexture.update(ve),re.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(_,`${te} ${F}kB`);const ie=_.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(u,p.TRIANGLES,b,I,$n.alphaBlended,vn.disabled,Wu(c.bp.transparent,Z),null,ie,C,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),y.draw(u,p.LINE_STRIP,b,I,P,vn.disabled,Wu(c.bp.red),k,ie,C,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function ch(_,t,s,u){const{isRenderingGlobe:p}=u,y=_.context,b=y.gl,I=_.transform,P=_.colorModeForRenderPass(),C=_.getDepthModeFor3D(),k=_.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,_.width,_.height]);for(const O of s){const F=t.getTerrainMesh(O.tileID),q=_.renderToTexture.getTexture(O),Z=t.getTerrainData(O.tileID);y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,q.texture);const te=t.getMeshFrameDelta(I.zoom),ie=I.calculateFogMatrix(O.tileID.toUnwrapped()),re=xl(te,ie,_.style.sky,I.pitch,p),le=I.getProjectionData({overscaledTileID:O.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});k.draw(y,b.TRIANGLES,C,xn.disabled,P,vn.backCCW,re,Z,le,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}}function uh(_,t){if(!t.mesh){const s=new c.aW;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const u=new c.aY;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),t.mesh=new Vn(_.createVertexBuffer(s,Oi.members),_.createIndexBuffer(u),c.aX.simpleSegment(0,0,s.length,u.length))}return t.mesh}class rp{constructor(t,s){this.context=new Fc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=fr.maxOverzooming+fr.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _i}resize(t,s,u){if(this.width=Math.floor(t*u),this.height=Math.floor(s*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,s=new c.aW;s.emplaceBack(0,0),s.emplaceBack(c.a5,0),s.emplaceBack(0,c.a5),s.emplaceBack(c.a5,c.a5),this.tileExtentBuffer=t.createVertexBuffer(s,Oi.members),this.tileExtentSegments=c.aX.simpleSegment(0,0,4,2);const u=new c.aW;u.emplaceBack(0,0),u.emplaceBack(c.a5,0),u.emplaceBack(0,c.a5),u.emplaceBack(c.a5,c.a5),this.debugBuffer=t.createVertexBuffer(u,Oi.members),this.debugSegments=c.aX.simpleSegment(0,0,4,5);const p=new c.ch;p.emplaceBack(0,0,0,0),p.emplaceBack(c.a5,0,c.a5,0),p.emplaceBack(0,c.a5,0,c.a5),p.emplaceBack(c.a5,c.a5,c.a5,c.a5),this.rasterBoundsBuffer=t.createVertexBuffer(p,Hs.members),this.rasterBoundsSegments=c.aX.simpleSegment(0,0,4,2);const y=new c.aW;y.emplaceBack(0,0),y.emplaceBack(c.a5,0),y.emplaceBack(0,c.a5),y.emplaceBack(c.a5,c.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(y,Oi.members),this.rasterBoundsSegmentsPosOnly=c.aX.simpleSegment(0,0,4,5);const b=new c.aW;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,Oi.members),this.viewportSegments=c.aX.simpleSegment(0,0,4,2);const I=new c.ci;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(I);const P=new c.aY;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(P);const C=this.context.gl;this.stencilClearMode=new xn({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.tileExtentMesh=new Vn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=c.N();c.c7(u,0,this.width,this.height,0,0,1),c.Q(u,u,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const p={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(t,s.TRIANGLES,ln.disabled,this.stencilClearMode,$n.disabled,vn.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,u){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source,this.nextStencilID+s.length>256&&this.clearStencil();const p=this.context;p.setColorMode($n.disabled),p.setDepthMode(ln.disabled);const y={};for(const b of s)y[b.key]=this.nextStencilID++;this._renderTileMasks(y,s,u,!0),this._renderTileMasks(y,s,u,!1),this._tileClippingMaskIDs=y}_renderTileMasks(t,s,u,p){const y=this.context,b=y.gl,I=this.style.projection,P=this.transform,C=this.useProgram("clippingMask");for(const k of s){const O=t[k.key],F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),q=I.getMeshFromTileID(this.context,k.canonical,p,!0,"stencil"),Z=P.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!u,applyTerrainMatrix:!0});C.draw(y,b.TRIANGLES,ln.disabled,new xn({func:b.ALWAYS,mask:0},O,255,b.KEEP,b.KEEP,b.REPLACE),$n.disabled,u?vn.disabled:vn.backCCW,null,F,Z,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}_renderTilesDepthBuffer(){const t=this.context,s=t.gl,u=this.style.projection,p=this.transform,y=this.useProgram("depth"),b=this.getDepthModeFor3D(),I=yt(p,{tileSize:p.tileSize});for(const P of I){const C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P),k=u.getMeshFromTileID(this.context,P.canonical,!0,!0,"raster"),O=p.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(t,s.TRIANGLES,b,xn.disabled,$n.disabled,vn.backCCW,null,C,O,"$clipping",k.vertexBuffer,k.indexBuffer,k.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new xn({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new xn({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const s=this.context.gl,u=t.sort((b,I)=>I.overscaledZ-b.overscaledZ),p=u[u.length-1].overscaledZ,y=u[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let I=0;I<y;I++)b[I+p]=new xn({func:s.GEQUAL,mask:255},I+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[b,u]}return[{[p]:xn.disabled},u]}stencilConfigForOverlapTwoPass(t){const s=this.context.gl,u=t.sort((b,I)=>I.overscaledZ-b.overscaledZ),p=u[u.length-1].overscaledZ,y=u[0].overscaledZ-p+1;if(this.clearStencil(),y>1){const b={},I={};for(let P=0;P<y;P++)b[P+p]=new xn({func:s.GREATER,mask:255},y+1+P,255,s.KEEP,s.KEEP,s.REPLACE),I[P+p]=new xn({func:s.GREATER,mask:255},1+P,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*y+1,[b,I,u]}return this.nextStencilID=3,[{[p]:new xn({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[p]:new xn({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new $n([t.CONSTANT_COLOR,t.ONE],new c.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$n.unblended:$n.alphaBlended}getDepthModeForSublayer(t,s,u){if(!this.opaquePassEnabledForLayer())return ln.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ln(u||this.context.gl.LEQUAL,s,[p,p])}getDepthModeFor3D(){return new ln(this.context.gl.LEQUAL,ln.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){var u,p;this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(ke()),this.imageManager.beginFrame();const y=this.style._order,b=this.style.tileManagers,I={},P={},C={},k={isRenderingToTexture:!1,isRenderingGlobe:((u=t.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const F in b){const q=b[F];q.used&&q.prepare(this.context),I[F]=q.getVisibleCoordinates(!1),P[F]=I[F].slice().reverse(),C[F]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<y.length;F++)if(this.style._layers[y[F]].is3D()){this.opaquePassCutoff=F;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const F of y){const q=this.style._layers[F];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const Z=P[q.source];(q.type==="custom"||Z.length)&&this.renderLayer(this,b[q.source],q,Z,k)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:F=>this.useProgram(F)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?c.bp.black:c.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(F,q){const Z=F.context,te=Z.gl,ie=((Te,me,Pe)=>{const Be=Math.cos(me.rollInRadians),Fe=Math.sin(me.rollInRadians),Oe=Ht(me),Ne=me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Te.properties.get("sky-color"),u_horizon_color:Te.properties.get("horizon-color"),u_horizon:[(me.width/2-Oe*Fe)*Pe,(me.height/2+Oe*Be)*Pe],u_horizon_normal:[-Fe,Be],u_sky_horizon_blend:Te.properties.get("sky-horizon-blend")*me.height/2*Pe,u_sky_blend:Ne}})(q,F.style.map.transform,F.pixelRatio),re=new ln(te.LEQUAL,ln.ReadWrite,[0,1]),le=xn.disabled,ve=F.colorModeForRenderPass(),oe=F.useProgram("sky"),_e=uh(Z,q);oe.draw(Z,te.TRIANGLES,re,le,ve,vn.disabled,ie,null,void 0,"sky",_e.vertexBuffer,_e.indexBuffer,_e.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[y[this.currentLayer]],q=b[F.source],Z=I[F.source];this._renderTileClippingMasks(F,Z,!1),this.renderLayer(this,q,F,Z,k)}this.renderPass="translucent";let O=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const F=this.style._layers[y[this.currentLayer]],q=b[F.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(F,k))continue;this.opaquePassEnabledForLayer()||O||(O=!0,k.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Z=(F.type==="symbol"?C:P)[F.source];this._renderTileClippingMasks(F,I[F.source],!!this.renderToTexture),this.renderLayer(this,q,F,Z,k)}if(k.isRenderingGlobe&&function(F,q,Z){const te=F.context,ie=te.gl,re=F.useProgram("atmosphere"),le=new ln(ie.LEQUAL,ln.ReadOnly,[0,1]),ve=F.transform,oe=function(Ne,it){const at=Ne.properties.get("position"),Je=[-at.x,-at.y,-at.z],dt=c.ar(new Float64Array(16));return Ne.properties.get("anchor")==="map"&&(c.bg(dt,dt,it.rollInRadians),c.bh(dt,dt,-it.pitchInRadians),c.bg(dt,dt,it.bearingInRadians),c.bh(dt,dt,it.center.lat*Math.PI/180),c.bJ(dt,dt,-it.center.lng*Math.PI/180)),c.cg(Je,Je,dt),Je}(Z,F.transform),_e=ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Te=q.properties.get("atmosphere-blend")*_e.projectionTransition;if(Te===0)return;const me=$s(ve.worldSize,ve.center.lat),Pe=ve.inverseProjectionMatrix,Be=new Float64Array(4);Be[3]=1,c.aH(Be,Be,ve.modelViewProjectionMatrix),Be[0]/=Be[3],Be[1]/=Be[3],Be[2]/=Be[3],Be[3]=1,c.aH(Be,Be,Pe),Be[0]/=Be[3],Be[1]/=Be[3],Be[2]/=Be[3],Be[3]=1;const Fe=((Ne,it,at,Je,dt)=>({u_sun_pos:Ne,u_atmosphere_blend:it,u_globe_position:at,u_globe_radius:Je,u_inv_proj_matrix:dt}))(oe,Te,[Be[0],Be[1],Be[2]],me,Pe),Oe=uh(te,q);re.draw(te,ie.TRIANGLES,le,xn.disabled,$n.alphaBlended,vn.disabled,Fe,null,null,"atmosphere",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const F=function(q,Z){let te=null;const ie=Object.values(q._layers).flatMap(oe=>oe.source&&!oe.isHidden(Z)?[q.tileManagers[oe.source]]:[]),re=ie.filter(oe=>oe.getSource().type==="vector"),le=ie.filter(oe=>oe.getSource().type!=="vector"),ve=oe=>{(!te||te.getSource().maxzoom<oe.getSource().maxzoom)&&(te=oe)};return re.forEach(oe=>ve(oe)),te||le.forEach(oe=>ve(oe)),te}(this.style,this.transform.zoom);F&&function(q,Z,te){for(let ie=0;ie<te.length;ie++)np(q,Z,te[ie])}(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const q=F.transform.padding;ah(F,F.transform.height-(q.top||0),3,Qd),ah(F,q.bottom||0,3,Jd),lh(F,q.left||0,3,ep),lh(F,F.transform.width-(q.right||0),3,tp);const Z=F.transform.centerPoint;(function(te,ie,re,le){Rl(te,ie-1,re-10,2,20,le),Rl(te,ie-10,re-1,20,2,le)})(F,Z.x,F.transform.height-Z.y,Po)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=t?!c.cj(s,u):!c.ck(s,u)),p||(p=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(c.cl(s,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,b){const I=y.context,P=I.gl,C=y.transform,k=$n.unblended,O=new ln(P.LEQUAL,ln.ReadWrite,[0,1]),F=b.tileManager.getRenderableTiles(),q=y.useProgram("terrainDepth");I.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),I.clear({color:c.bp.transparent,depth:1});for(const Z of F){const te=b.getTerrainMesh(Z.tileID),ie=b.getTerrainData(Z.tileID),re=C.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),le={u_ele_delta:b.getMeshFrameDelta(C.zoom)};q.draw(I,P.TRIANGLES,O,xn.disabled,k,vn.backCCW,le,ie,re,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,b){const I=y.context,P=I.gl,C=y.transform,k=$n.unblended,O=new ln(P.LEQUAL,ln.ReadWrite,[0,1]),F=b.getCoordsTexture(),q=b.tileManager.getRenderableTiles(),Z=y.useProgram("terrainCoords");I.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),I.clear({color:c.bp.transparent,depth:1}),b.coordsIndex=[];for(const te of q){const ie=b.getTerrainMesh(te.tileID),re=b.getTerrainData(te.tileID);I.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,F.texture);const le={u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(C.zoom)},ve=C.getProjectionData({overscaledTileID:te.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(I,P.TRIANGLES,O,xn.disabled,k,vn.backCCW,le,re,ve,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments),b.coordsIndex.push(te.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(t,s,u,p,y){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(p||[]).length)&&(this.id=u.id,c.cm(u)?function(b,I,P,C,k,O){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:F}=O,q=xn.disabled,Z=b.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(te,ie,re,le,ve,oe,_e,Te,me){const Pe=ie.transform,Be=ie.style.map.terrain,Fe=ve==="map",Oe=oe==="map";for(const Ne of te){const it=le.getTile(Ne),at=it.getBucket(re);if(!at||!at.text||!at.text.segments.get().length)continue;const Je=c.ay(at.textSizeData,Pe.zoom),dt=c.aN(it,1,ie.transform.zoom),sn=Cr(Fe,ie.transform,dt),Xn=re.layout.get("icon-text-fit")!=="none"&&at.hasIconData();if(Je){const dr=Math.pow(2,Pe.zoom-it.tileID.overscaledZ),nr=Be?(gr,rr)=>Be.getElevation(Ne,gr,rr):null;gm(at,Fe,Oe,me,Pe,sn,dr,Je,Xn,c.aO(Pe,it,_e,Te),Ne.toUnwrapped(),nr)}}}(C,b,P,I,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),k),P.paint.get("icon-opacity").constantOr(1)!==0&&Pl(b,I,P,C,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),q,Z,F),P.paint.get("text-opacity").constantOr(1)!==0&&Pl(b,I,P,C,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),q,Z,F),I.map.showCollisionBoxes&&(na(b,I,P,C,!0),na(b,I,P,C,!1))}(t,s,u,p,this.style.placement.variableOffsets,y):c.cn(u)?function(b,I,P,C,k){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:O}=k,F=P.paint.get("circle-opacity"),q=P.paint.get("circle-stroke-width"),Z=P.paint.get("circle-stroke-opacity"),te=!P.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(q.constantOr(1)===0||Z.constantOr(1)===0))return;const ie=b.context,re=ie.gl,le=b.transform,ve=b.getDepthModeForSublayer(0,ln.ReadOnly),oe=xn.disabled,_e=b.colorModeForRenderPass(),Te=[],me=le.getCircleRadiusCorrection();for(let Pe=0;Pe<C.length;Pe++){const Be=C[Pe],Fe=I.getTile(Be),Oe=Fe.getBucket(P);if(!Oe)continue;const Ne=P.paint.get("circle-translate"),it=P.paint.get("circle-translate-anchor"),at=c.aO(le,Fe,Ne,it),Je=Oe.programConfigurations.get(P.id),dt=b.useProgram("circle",Je),sn=Oe.layoutVertexBuffer,Xn=Oe.indexBuffer,dr=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Be),nr={programConfiguration:Je,program:dt,layoutVertexBuffer:sn,indexBuffer:Xn,uniformValues:kd(b,Fe,P,at,me),terrainData:dr,projectionData:le.getProjectionData({overscaledTileID:Be,applyGlobeMatrix:!O,applyTerrainMatrix:!0})};if(te){const gr=Oe.segments.get();for(const rr of gr)Te.push({segments:new c.aX([rr]),sortKey:rr.sortKey,state:nr})}else Te.push({segments:Oe.segments,sortKey:0,state:nr})}te&&Te.sort((Pe,Be)=>Pe.sortKey-Be.sortKey);for(const Pe of Te){const{programConfiguration:Be,program:Fe,layoutVertexBuffer:Oe,indexBuffer:Ne,uniformValues:it,terrainData:at,projectionData:Je}=Pe.state;Fe.draw(ie,re.TRIANGLES,ve,oe,_e,vn.backCCW,it,at,Je,P.id,Oe,Ne,Pe.segments,P.paint,b.transform.zoom,Be)}}(t,s,u,p,y):c.co(u)?function(b,I,P,C,k){if(P.paint.get("heatmap-opacity")===0)return;const O=b.context,{isRenderingToTexture:F,isRenderingGlobe:q}=k;if(b.style.map.terrain){for(const Z of C){const te=I.getTile(Z);I.hasRenderableParent(Z)||(b.renderPass==="offscreen"?Zd(b,te,P,Z,q):b.renderPass==="translucent"&&Wd(b,P,Z,F,q))}O.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?function(Z,te,ie,re){const le=Z.context,ve=le.gl,oe=Z.transform,_e=xn.disabled,Te=new $n([ve.ONE,ve.ONE],c.bp.transparent,[!0,!0,!0,!0]);(function(me,Pe,Be){const Fe=me.gl;me.activeTexture.set(Fe.TEXTURE1),me.viewport.set([0,0,Pe.width/4,Pe.height/4]);let Oe=Be.heatmapFbos.get(c.cd);Oe?(Fe.bindTexture(Fe.TEXTURE_2D,Oe.colorAttachment.get()),me.bindFramebuffer.set(Oe.framebuffer)):(Oe=Al(me,Pe.width/4,Pe.height/4),Be.heatmapFbos.set(c.cd,Oe))})(le,Z,ie),le.clear({color:c.bp.transparent});for(let me=0;me<re.length;me++){const Pe=re[me];if(te.hasRenderableParent(Pe))continue;const Be=te.getTile(Pe),Fe=Be.getBucket(ie);if(!Fe)continue;const Oe=Fe.programConfigurations.get(ie.id),Ne=Z.useProgram("heatmap",Oe),it=oe.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),at=oe.getCircleRadiusCorrection();Ne.draw(le,ve.TRIANGLES,ln.disabled,_e,Te,vn.backCCW,ka(Be,oe.zoom,ie.paint.get("heatmap-intensity"),at),null,it,ie.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,ie.paint,oe.zoom,Oe)}le.viewport.set([0,0,Z.width,Z.height])}(b,I,P,C):b.renderPass==="translucent"&&function(Z,te){const ie=Z.context,re=ie.gl;ie.setColorMode(Z.colorModeForRenderPass());const le=te.heatmapFbos.get(c.cd);le&&(ie.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,le.colorAttachment.get()),ie.activeTexture.set(re.TEXTURE1),Nc(ie,te).bind(re.LINEAR,re.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(ie,re.TRIANGLES,ln.disabled,xn.disabled,Z.colorModeForRenderPass(),vn.disabled,Ld(Z,te,0,1),null,null,te.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,te.paint,Z.transform.zoom))}(b,P)}(t,s,u,p,y):c.cp(u)?function(b,I,P,C,k){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:O}=k,F=P.paint.get("line-opacity"),q=P.paint.get("line-width");if(F.constantOr(1)===0||q.constantOr(1)===0)return;const Z=b.getDepthModeForSublayer(0,ln.ReadOnly),te=b.colorModeForRenderPass(),ie=P.paint.get("line-dasharray"),re=ie.constantOr(1),le=P.paint.get("line-pattern"),ve=le.constantOr(1),oe=P.paint.get("line-gradient"),_e=P.getCrossfadeParameters();let Te;Te=ve?"linePattern":re&&oe?"lineGradientSDF":re?"lineSDF":oe?"lineGradient":"line";const me=b.context,Pe=me.gl,Be=b.transform;let Fe=!0;for(const Oe of C){const Ne=I.getTile(Oe);if(ve&&!Ne.patternsLoaded())continue;const it=Ne.getBucket(P);if(!it)continue;const at=it.programConfigurations.get(P.id),Je=b.context.program.get(),dt=b.useProgram(Te,at),sn=Fe||dt.program!==Je,Xn=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Oe),dr=le.constantOr(null),nr=ie&&ie.constantOr(null);if(dr&&Ne.imageAtlas){const ti=Ne.imageAtlas,Or=ti.patternPositions[dr.to.toString()],Dr=ti.patternPositions[dr.from.toString()];Or&&Dr&&at.setConstantPatternPositions(Or,Dr)}else if(nr){const ti=P.layout.get("line-cap")==="round",Or=b.lineAtlas.getDash(nr.to,ti),Dr=b.lineAtlas.getDash(nr.from,ti);at.setConstantDashPositions(Or,Dr)}const gr=Be.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),rr=Be.getPixelScale();let Ir;ve?(Ir=Ku(b,Ne,P,rr,_e),Xd(me,Pe,Ne,at,_e)):re&&oe?(Ir=Ec(b,Ne,P,rr,_e,it.lineClipsArray.length),ts(b,I,me,Pe,P,it,Oe,at,_e)):re?(Ir=Od(b,Ne,P,rr,_e),Rr(b,me,Pe,at,sn,_e)):oe?(Ir=Fd(b,Ne,P,rr,it.lineClipsArray.length),ra(b,I,me,Pe,P,it,Oe)):Ir=bl(b,Ne,P,rr);const _r=b.stencilModeForClipping(Oe);dt.draw(me,Pe.TRIANGLES,Z,_r,te,vn.disabled,Ir,Xn,gr,P.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,P.paint,b.transform.zoom,at,it.layoutVertexBuffer2),Fe=!1}}(t,s,u,p,y):c.cq(u)?function(b,I,P,C,k){const O=P.paint.get("fill-color"),F=P.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const{isRenderingToTexture:q}=k,Z=b.colorModeForRenderPass(),te=P.paint.get("fill-pattern"),ie=b.opaquePassEnabledForLayer()&&!te.constantOr(1)&&O.constantOr(c.bp.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===ie){const re=b.getDepthModeForSublayer(1,b.renderPass==="opaque"?ln.ReadWrite:ln.ReadOnly);Cl(b,I,P,C,re,Z,!1,q)}if(b.renderPass==="translucent"&&P.paint.get("fill-antialias")){const re=b.getDepthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,ln.ReadOnly);Cl(b,I,P,C,re,Z,!0,q)}}(t,s,u,p,y):c.cr(u)?function(b,I,P,C,k){const O=P.paint.get("fill-extrusion-opacity");if(O===0)return;const{isRenderingToTexture:F}=k;if(b.renderPass==="translucent"){const q=new ln(b.context.gl.LEQUAL,ln.ReadWrite,b.depthRangeFor3D);if(O!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Bc(b,I,P,C,q,xn.disabled,$n.disabled,F),Bc(b,I,P,C,q,b.stencilModeFor3D(),b.colorModeForRenderPass(),F);else{const Z=b.colorModeForRenderPass();Bc(b,I,P,C,q,xn.disabled,Z,F)}}}(t,s,u,p,y):c.cs(u)?function(b,I,P,C,k){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const{isRenderingToTexture:O}=k,F=b.context,q=b.style.projection.useSubdivision,Z=b.getDepthModeForSublayer(0,ln.ReadOnly),te=b.colorModeForRenderPass();if(b.renderPass==="offscreen")(function(ie,re,le,ve,oe,_e,Te){const me=ie.context,Pe=me.gl;for(const Be of le){const Fe=re.getTile(Be),Oe=Fe.dem;if(!Oe||!Oe.data||!Fe.needsHillshadePrepare)continue;const Ne=Oe.dim,it=Oe.stride,at=Oe.getPixels();if(me.activeTexture.set(Pe.TEXTURE1),me.pixelStoreUnpackPremultiplyAlpha.set(!1),Fe.demTexture=Fe.demTexture||ie.getTileTexture(it),Fe.demTexture){const dt=Fe.demTexture;dt.update(at,{premultiply:!1}),dt.bind(Pe.NEAREST,Pe.CLAMP_TO_EDGE)}else Fe.demTexture=new c.T(me,at,Pe.RGBA,{premultiply:!1}),Fe.demTexture.bind(Pe.NEAREST,Pe.CLAMP_TO_EDGE);me.activeTexture.set(Pe.TEXTURE0);let Je=Fe.fbo;if(!Je){const dt=new c.T(me,{width:Ne,height:Ne,data:null},Pe.RGBA);dt.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),Je=Fe.fbo=me.createFramebuffer(Ne,Ne,!0,!1),Je.colorAttachment.set(dt.texture)}me.bindFramebuffer.set(Je.framebuffer),me.viewport.set([0,0,Ne,Ne]),ie.useProgram("hillshadePrepare").draw(me,Pe.TRIANGLES,oe,_e,Te,vn.disabled,sm(Fe.tileID,Oe),null,null,ve.id,ie.rasterBoundsBuffer,ie.quadTriangleIndexBuffer,ie.rasterBoundsSegments),Fe.needsHillshadePrepare=!1}})(b,I,C,P,Z,xn.disabled,te),F.viewport.set([0,0,b.width,b.height]);else if(b.renderPass==="translucent")if(q){const[ie,re,le]=b.stencilConfigForOverlapTwoPass(C);So(b,I,P,le,ie,Z,te,!1,O),So(b,I,P,le,re,Z,te,!0,O)}else{const[ie,re]=b.getStencilConfigForOverlapAndUpdateStencilID(C);So(b,I,P,re,ie,Z,te,!1,O)}}(t,s,u,p,y):c.ct(u)?function(b,I,P,C,k){if(b.renderPass!=="translucent"||!C.length)return;const{isRenderingToTexture:O}=k,F=b.style.projection.useSubdivision,q=b.getDepthModeForSublayer(0,ln.ReadOnly),Z=b.colorModeForRenderPass();if(F){const[te,ie,re]=b.stencilConfigForOverlapTwoPass(C);Ml(b,I,P,re,te,q,Z,!1,O),Ml(b,I,P,re,ie,q,Z,!0,O)}else{const[te,ie]=b.getStencilConfigForOverlapAndUpdateStencilID(C);Ml(b,I,P,ie,te,q,Z,!1,O)}}(t,s,u,p,y):c.bU(u)?function(b,I,P,C,k){if(b.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!C.length)return;const{isRenderingToTexture:O}=k,F=I.getSource(),q=b.style.projection.useSubdivision;if(F instanceof Xt)Oa(b,I,P,C,null,!1,!1,F.tileCoords,F.flippedWindingOrder,O);else if(q){const[Z,te,ie]=b.stencilConfigForOverlapTwoPass(C);Oa(b,I,P,ie,Z,!1,!0,ia,!1,O),Oa(b,I,P,ie,te,!0,!0,ia,!1,O)}else{const[Z,te]=b.getStencilConfigForOverlapAndUpdateStencilID(C);Oa(b,I,P,te,Z,!1,!0,ia,!1,O)}}(t,s,u,p,y):c.cu(u)?function(b,I,P,C,k){const O=P.paint.get("background-color"),F=P.paint.get("background-opacity");if(F===0)return;const{isRenderingToTexture:q}=k,Z=b.context,te=Z.gl,ie=b.style.projection,re=b.transform,le=re.tileSize,ve=P.paint.get("background-pattern");if(b.isPatternMissing(ve))return;const oe=!ve&&O.a===1&&F===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==oe)return;const _e=xn.disabled,Te=b.getDepthModeForSublayer(0,oe==="opaque"?ln.ReadWrite:ln.ReadOnly),me=b.colorModeForRenderPass(),Pe=b.useProgram(ve?"backgroundPattern":"background"),Be=C||yt(re,{tileSize:le,terrain:b.style.map.terrain});ve&&(Z.activeTexture.set(te.TEXTURE0),b.imageManager.bind(b.context));const Fe=P.getCrossfadeParameters();for(const Oe of Be){const Ne=re.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),it=ve?am(F,b,ve,{tileID:Oe,tileSize:le},Fe):Ju(F,O),at=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Oe),Je=ie.getMeshFromTileID(Z,Oe.canonical,!1,!0,"raster");Pe.draw(Z,te.TRIANGLES,Te,_e,me,vn.backCCW,it,at,Ne,P.id,Je.vertexBuffer,Je.indexBuffer,Je.segments)}}(t,0,u,p,y):c.cv(u)&&function(b,I,P,C){const{isRenderingGlobe:k}=C,O=b.context,F=P.implementation,q=b.style.projection,Z=b.transform,te=Z.getProjectionDataForCustomLayer(k),ie={farZ:Z.farZ,nearZ:Z.nearZ,fov:Z.fov*Math.PI/180,modelViewProjectionMatrix:Z.modelViewProjectionMatrix,projectionMatrix:Z.projectionMatrix,shaderData:{variantName:q.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${q.shaderPreludeCode.vertexSource}`,define:q.shaderDefine},defaultProjectionData:te},re=F.renderingMode?F.renderingMode:"2d";if(b.renderPass==="offscreen"){const le=F.prerender;le&&(b.setCustomLayerDefaults(),O.setColorMode(b.colorModeForRenderPass()),le.call(F,O.gl,ie),O.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),O.setColorMode(b.colorModeForRenderPass()),O.setStencilMode(xn.disabled);const le=re==="3d"?b.getDepthModeFor3D():b.getDepthModeForSublayer(0,ln.ReadOnly);O.setDepthMode(le),F.render(O.gl,ie),O.setDirty(),b.setBaseState(),O.bindFramebuffer.set(null)}}(t,0,u,y))}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!s||!u}useProgram(t,s,u=!1,p=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,b=this.style.projection,I=u?Qn.projectionMercator:b.shaderPreludeCode,P=u?Qr:b.shaderDefine,C=t+(s?s.cacheKey:"")+`/${u?ui:b.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[C]||(this.cache[C]=new Ad(this.context,Qn[t],s,lm[t],this._showOverdrawInspector,y,I,P,p)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,s;if(this._tileTextures){for(const u in this._tileTextures){const p=this._tileTextures[u];if(p)for(const y of p)y.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((s=this.tileExtentMesh.indexBuffer)===null||s===void 0||s.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const u in this.cache){const p=this.cache[u];p&&p.program&&this.context.gl.deleteProgram(p.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}function hh(_,t){let s,u=!1,p=null,y=null;const b=()=>{p=null,u&&(_.apply(y,s),p=setTimeout(b,t),u=!1)};return(...I)=>(u=!0,y=this,s=I,p||b(),p)}class dh{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(u=p)}),(u&&u[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const u=s.join("/");let p=u;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${u}`);let y=window.location.hash.replace(p,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let b=window.location.href.replace(/(#.+)?$/,y);b=b.replace("&&","&"),window.history.replaceState(window.history.state,null,b)},this._updateHash=hh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const s=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),b=Math.round(s.lng*y)/y,I=Math.round(s.lat*y)/y,P=this._map.getBearing(),C=this._map.getPitch();let k="";if(k+=t?`/${b}/${I}/${u}`:`${u}/${I}/${b}`,(P||C)&&(k+="/"+Math.round(10*P)/10),C&&(k+=`/${Math.round(C)}`),this._hashName){const O=this._hashName;let F=!1;const q=window.location.hash.slice(1).split("&").map(Z=>{const te=Z.split("=")[0];return te===O?(F=!0,`${te}=${k}`):Z}).filter(Z=>Z);return F||q.push(`${O}=${k}`),`#${q.join("&")}`}return`#${k}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new c.V(+t[2],+t[1])}catch{return!1}const s=+t[0],u=+(t[3]||0),p=+(t[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&u>=-180&&u<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const Ao={linearity:.3,easing:c.cw(0,0,.3,1)},ip=c.e({deceleration:2500,maxSpeed:1400},Ao),ms=c.e({deceleration:20,maxSpeed:1400},Ao),Is=c.e({deceleration:1e3,maxSpeed:360},Ao),sp=c.e({deceleration:1e3,maxSpeed:90},Ao),Ss=c.e({deceleration:1e3,maxSpeed:360},Ao);class _m{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ke(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=ke();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,s.roll+=y.rollDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const y=Dl(s.pan.mag(),u,c.e({},ip,t||{})),b=s.pan.mult(y.amount/s.pan.mag()),I=this._map.cameraHelper.handlePanInertia(b,this._map.transform);p.center=I.easingCenter,p.offset=I.easingOffset,kl(p,y)}if(s.zoom){const y=Dl(s.zoom,u,ms);p.zoom=this._map.transform.zoom+y.amount,kl(p,y)}if(s.bearing){const y=Dl(s.bearing,u,Is);p.bearing=this._map.transform.bearing+c.an(y.amount,-179,179),kl(p,y)}if(s.pitch){const y=Dl(s.pitch,u,sp);p.pitch=this._map.transform.pitch+y.amount,kl(p,y)}if(s.roll){const y=Dl(s.roll,u,Ss);p.roll=this._map.transform.roll+c.an(y.amount,-179,179),kl(p,y)}if(p.zoom||p.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),c.e(p,{noMoveStart:!0})}}function kl(_,t){(!_.duration||_.duration<t.duration)&&(_.duration=t.duration,_.easing=t.easing)}function Dl(_,t,s){const{maxSpeed:u,linearity:p,deceleration:y}=s,b=c.an(_*p/(t/1e3),-u,u),I=Math.abs(b)/(y*p);return{easing:s.easing,duration:1e3*I,amount:b*(I/2)}}class ei extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u,p={}){u=u instanceof MouseEvent?u:new MouseEvent(t,u);const y=Q.mousePos(s.getCanvas(),u),b=s.unproject(y);super(t,c.e({point:y,lngLat:b,originalEvent:u},p)),this._defaultPrevented=!1,this.target=s}}class Ll extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u){const p=t==="touchend"?u.changedTouches:u.touches,y=Q.touchPos(s.getCanvasContainer(),p),b=y.map(P=>s.unproject(P)),I=y.reduce((P,C,k,O)=>P.add(C.div(O.length)),new c.P(0,0));super(t,{points:y,point:I,lngLats:b,lngLat:s.unproject(I),originalEvent:u}),this._defaultPrevented=!1}}class op extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class ym{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new op(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new ei(t.type,this._map,t))}mouseup(t){this._map.fire(new ei(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new ei(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ei(t.type,this._map,t))}mouseover(t){this._map.fire(new ei(t.type,this._map,t))}mouseout(t){this._map.fire(new ei(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ll(t.type,this._map,t))}touchmove(t){this._map.fire(new Ll(t.type,this._map,t))}touchend(t){this._map.fire(new Ll(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ll(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vm{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ei(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ei("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new ei(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Na{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(c.P.convert(t),this._map.terrain)}}class Va{constructor(t,s){this._map=t,this._tr=new Na(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(Q.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const u=s;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=u,this._box||(this._box=Q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(p.x,u.x),b=Math.max(p.x,u.x),I=Math.min(p.y,u.y),P=Math.max(p.y,u.y);Q.setTransform(this._box,`translate(${y}px,${I}px)`),this._box.style.width=b-y+"px",this._box.style.height=P-I+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const u=this._startPos,p=s;if(this.reset(),Q.suppressClick(),u.x!==p.x||u.y!==p.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(u,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Q.remove(this._box),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new c.l(t,{originalEvent:s}))}}function Ps(_,t){if(_.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${t.length}`);const s={};for(let u=0;u<_.length;u++)s[_[u].identifier]=t[u];return s}class xt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const y=new c.P(0,0);for(const b of p)y._add(b);return y.div(p.length)}(s),this.touches=Ps(u,s)))}touchmove(t,s,u){if(this.aborted||!this.centroid)return;const p=Ps(u,s);for(const y in this.touches){const b=p[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,s,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Uc{constructor(t){this.singleTap=new xt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,u){this.singleTap.touchstart(t,s,u)}touchmove(t,s,u){this.singleTap.touchmove(t,s,u)}touchend(t,s,u){const p=this.singleTap.touchend(t,s,u);if(p){const y=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(p)<30;if(y&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class ph{constructor(t){this._tr=new Na(t),this._zoomIn=new Uc({numTouches:1,numTaps:2}),this._zoomOut=new Uc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,u){this._zoomIn.touchstart(t,s,u),this._zoomOut.touchstart(t,s,u)}touchmove(t,s,u){this._zoomIn.touchmove(t,s,u),this._zoomOut.touchmove(t,s,u)}touchend(t,s,u){const p=this._zoomIn.touchend(t,s,u),y=this._zoomOut.touchend(t,s,u),b=this._tr;return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(p)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ba{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const p=Array.isArray(s)?s[0]:s;return!this._moved&&p.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(u,p))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Q.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const zl=0,Fl=2,fh={[zl]:1,[Fl]:2};class Ol{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=Q.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,u){const p=fh[u];return s.buttons===void 0||(s.buttons&p)!==p}(t,this._eventButton)}isValidEndEvent(t){return Q.mouseButton(t)===this._eventButton}}class mh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class ap{constructor(t=new Ol({checkCorrectEvent:()=>!0}),s=new mh){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(t,s,u){return t instanceof MouseEvent?s(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?u(t):void 0}startMove(t){this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.startMove(s),s=>this.oneFingerTouchMoveStateManager.startMove(s))}endMove(t){this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.endMove(s),s=>this.oneFingerTouchMoveStateManager.endMove(s))}isValidStartEvent(t){return this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.isValidStartEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s))}isValidMoveEvent(t){return this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.isValidMoveEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s))}isValidEndEvent(t){return this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.isValidEndEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s))}}const Ua=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=t=>{t.preventDefault()}};class xm{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,s,u){return this._calculateTransform(t,s,u)}touchmove(t,s,u){if(this._active){if(!this._shouldBePrevented(u.length))return t.preventDefault(),this._calculateTransform(t,s,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,s,u){this._calculateTransform(t,s,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,u){u.length>0&&(this._active=!0);const p=Ps(u,s),y=new c.P(0,0),b=new c.P(0,0);let I=0;for(const C in p){const k=p[C],O=this._touches[C];O&&(y._add(k),b._add(k.sub(O)),I++,p[C]=k)}if(this._touches=p,this._shouldBePrevented(I)||!b.mag())return;const P=b.div(I);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(I),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,u){if(!this._firstTwoTouches)return;t.preventDefault();const[p,y]=this._firstTwoTouches,b=qc(u,s,p),I=qc(u,s,y);if(!b||!I)return;const P=this._aroundCenter?null:b.add(I).div(2);return this._move([b,I],P,t)}touchend(t,s,u){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,b=qc(u,s,p),I=qc(u,s,y);b&&I||(this._active&&Q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function qc(_,t,s){for(let u=0;u<_.length;u++)if(_[u].identifier===s)return t[u]}function lp(_,t){return Math.log(_/t)/Math.LN2}class gh extends jc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(lp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lp(this._distance,u),pinchAround:s}}}function cp(_,t){return 180*_.angleWith(t)/Math.PI}class _h extends jc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,u){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cp(this._vector,p),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,u=cp(t,this._startVector);return Math.abs(u)<s}}function yh(_){return Math.abs(_.y)>Math.abs(_.x)}class up extends jc{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,u){super.touchstart(t,s,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,yh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),y=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,y=s.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const b=t.y>0==s.y>0;return yh(t)&&yh(s)&&b}}const Co={panStep:100,bearingStep:15,pitchStep:10};class Jn{constructor(t){this._tr=new Na(t);const s=Co;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,u=0,p=0,y=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:I=>{const P=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:bm,zoom:s?Math.round(P.zoom)+s*(t.shiftKey?2:1):P.zoom,bearing:P.bearing+u*this._bearingStep,pitch:P.pitch+p*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:P.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bm(_){return _*(2-_)}const Nl=4.000244140625,$c=1/450;class Gc{constructor(t,s){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new Na(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=$c}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=ke(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%Nl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Q.mousePos(this._map.getCanvas(),t),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(c.V.convert(u.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const I=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=I),typeof this._targetZoom=="number"&&(this._targetZoom+=I)}if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Nl?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&P!==0&&(P=1/P);const C=typeof this._targetZoom!="number"?t.scale:c.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),c.at(C*P)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,u=this._startZoom,p=this._easing;let y,b=!1;if(this._type==="wheel"&&u&&p){const I=ke()-this._lastWheelEventTime,P=Math.min((I+5)/200,1),C=p(P);y=c.G.number(u,s,C),P<1?this._frameId||(this._frameId=!0):b=!0}else y=s,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!b,zoomDelta:y-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=c.cy;if(this._prevEase){const u=this._prevEase,p=(ke()-u.start)/u.duration,y=u.easing(p+.01)-u.easing(p),b=.27/Math.sqrt(y*y+1e-4)*.01,I=Math.sqrt(.0729-b*b);s=c.cw(b,I,.25,1)}return this._prevEase={start:ke(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class vh{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hp{constructor(t){this._tr=new Na(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dp{constructor(){this._tap=new Uc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,u){if(!this._swipePoint)if(this._tapTime){const p=s[0],y=t.timeStamp-this._tapTime<500,b=this._tapPoint.dist(p)<30;y&&b?u.length>0&&(this._swipePoint=p,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,s,u)}touchmove(t,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=s[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,s,u)}touchend(t,s,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const p=this._tap.touchend(t,s,u);p&&(this._tapTime=t.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pp{constructor(t,s,u){this._el=t,this._mousePan=s,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class As{constructor(t,s,u,p){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=s,this._mousePitch=u,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Vl{constructor(t,s,u,p){this._el=t,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class St{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Q.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=s,this._container.appendChild(p);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=u,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,s){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:t,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ot=_=>_.zoom||_.drag||_.roll||_.pitch||_.rotate;class Bl extends c.l{}function Hc(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta||_.rollDelta}class Zc{constructor(t,s){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=p.type==="renderFrame"?void 0:p,I={needsRenderFrame:!1},P={},C={};for(const{handlerName:F,handler:q,allowed:Z}of this._handlers){if(!q.isEnabled())continue;let te;if(this._blockedByActive(C,Z,F))q.reset();else if(q[y||p.type]){if(c.cz(p,y||p.type)){const ie=Q.mousePos(this._map.getCanvas(),p);te=q[y||p.type](p,ie)}else if(c.cA(p,y||p.type)){const ie=this._getMapTouches(p.touches),re=Q.touchPos(this._map.getCanvas(),ie);te=q[y||p.type](p,re,ie)}else c.cB(y||p.type)||(te=q[y||p.type](p));this.mergeHandlerResult(I,P,te,F,b),te&&te.needsRenderFrame&&this._triggerRenderFrame()}(te||q.isActive())&&(C[F]=q)}const k={};for(const F in this._previousActiveHandlers)C[F]||(k[F]=b);this._previousActiveHandlers=C,(Object.keys(k).length||Hc(I))&&(this._changes.push([I,P,k]),this._triggerRenderFrame()),(Object.keys(C).length||Hc(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=I;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _m(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,b]of this._listeners)Q.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,s,u]of this._listeners)Q.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new ym(s,t));const p=s.boxZoom=new Va(s,t);this._add("boxZoom",p),t.interactive&&t.boxZoom&&p.enable();const y=s.cooperativeGestures=new St(s,t.cooperativeGestures);this._add("cooperativeGestures",y),t.cooperativeGestures&&y.enable();const b=new ph(s),I=new hp(s);s.doubleClickZoom=new vh(I,b),this._add("tapZoom",b),this._add("clickZoom",I),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const P=new dp;this._add("tapDragZoom",P);const C=s.touchPitch=new up(s);this._add("touchPitch",C),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const k=()=>s.project(s.getCenter()),O=function({enable:oe,clickTolerance:_e,aroundCenter:Te=!0,minPixelCenterThreshold:me=100,rotateDegreesPerPixelMoved:Pe=.8},Be){const Fe=new Ol({checkCorrectEvent:Oe=>Q.mouseButton(Oe)===0&&Oe.ctrlKey||Q.mouseButton(Oe)===2&&!Oe.ctrlKey});return new Ba({clickTolerance:_e,move:(Oe,Ne)=>{const it=Be();if(Te&&Math.abs(it.y-Oe.y)>me)return{bearingDelta:c.cx(new c.P(Oe.x,Ne.y),Ne,it)};let at=(Ne.x-Oe.x)*Pe;return Te&&Ne.y<it.y&&(at=-at),{bearingDelta:at}},moveStateManager:Fe,enable:oe,assignEvents:Ua})}(t,k),F=function({enable:oe,clickTolerance:_e,pitchDegreesPerPixelMoved:Te=-.5}){const me=new Ol({checkCorrectEvent:Pe=>Q.mouseButton(Pe)===0&&Pe.ctrlKey||Q.mouseButton(Pe)===2});return new Ba({clickTolerance:_e,move:(Pe,Be)=>({pitchDelta:(Be.y-Pe.y)*Te}),moveStateManager:me,enable:oe,assignEvents:Ua})}(t),q=function({enable:oe,clickTolerance:_e,rollDegreesPerPixelMoved:Te=.3},me){const Pe=new Ol({checkCorrectEvent:Be=>Q.mouseButton(Be)===2&&Be.ctrlKey});return new Ba({clickTolerance:_e,move:(Be,Fe)=>{const Oe=me();let Ne=(Fe.x-Be.x)*Te;return Fe.y<Oe.y&&(Ne=-Ne),{rollDelta:Ne}},moveStateManager:Pe,enable:oe,assignEvents:Ua})}(t,k);s.dragRotate=new As(t,O,F,q),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",F,["mouseRotate","mouseRoll"]),this._add("mouseRoll",q,["mousePitch"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const Z=function({enable:oe,clickTolerance:_e}){const Te=new Ol({checkCorrectEvent:me=>Q.mouseButton(me)===0&&!me.ctrlKey});return new Ba({clickTolerance:_e,move:(me,Pe)=>({around:Pe,panDelta:Pe.sub(me)}),activateOnStart:!0,moveStateManager:Te,enable:oe,assignEvents:Ua})}(t),te=new xm(t,s);s.dragPan=new pp(u,Z,te),this._add("mousePan",Z),this._add("touchPan",te,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const ie=new _h,re=new gh;s.touchZoomRotate=new Vl(u,re,ie,P),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new vm(s));const le=s.scrollZoom=new Gc(s,()=>this._triggerRenderFrame());this._add("scrollZoom",le,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const ve=s.keyboard=new Jn(s);this._add("keyboard",ve),t.interactive&&t.keyboard&&s.keyboard.enable()}_add(t,s,u){this._handlers.push({handlerName:t,handler:s,allowed:u}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ot(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,u){for(const p in t)if(p!==u&&(!s||s.indexOf(p)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const u of t)this._el.contains(u.target)&&s.push(u);return s}mergeHandlerResult(t,s,u,p,y){if(!u)return;c.e(t,u);const b={handlerName:p,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(s.zoom=b),u.panDelta!==void 0&&(s.drag=b),u.rollDelta!==void 0&&(s.roll=b),u.pitchDelta!==void 0&&(s.pitch=b),u.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const t={},s={},u={};for(const[p,y,b]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new c.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(t.rollDelta=(t.rollDelta||0)+p.rollDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),c.e(s,y),c.e(u,b);this._updateMapTransform(t,s,u),this._changes=[]}_updateMapTransform(t,s,u){const p=this._map,y=p._getTransformForUpdate(),b=p.terrain;if(!(Hc(t)||b&&this._terrainMovement))return this._fireEvents(s,u,!0);p._stop(!0);let{panDelta:I,zoomDelta:P,bearingDelta:C,pitchDelta:k,rollDelta:O,around:F,pinchAround:q}=t;q!==void 0&&(F=q),F=F||p.transform.centerPoint,b&&!y.isPointOnMapSurface(F)&&(F=y.centerPoint);const Z={panDelta:I,zoomDelta:P,rollDelta:O,pitchDelta:k,bearingDelta:C,around:F};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(F)&&(F=y.centerPoint);const te=F.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(I?F.sub(I):F);this._handleMapControls({terrain:b,tr:y,deltasForHelper:Z,preZoomAroundLoc:te,combinedEventsInProgress:s,panDelta:I}),p._applyUpdatedTransform(y),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,u,!0)}_handleMapControls({terrain:t,tr:s,deltasForHelper:u,preZoomAroundLoc:p,combinedEventsInProgress:y,panDelta:b}){const I=this._map.cameraHelper;if(I.handleMapControlsRollPitchBearingZoom(u,s),t)return I.useGlobeControls?(this._terrainMovement||!y.drag&&!y.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void I.handleMapControlsPan(u,s,p)):this._terrainMovement||!y.drag&&!y.zoom?void(y.drag&&this._terrainMovement&&b?s.setCenter(s.screenPointToLocation(s.centerPoint.sub(b))):I.handleMapControlsPan(u,s,p)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void I.handleMapControlsPan(u,s,p));I.handleMapControlsPan(u,s,p)}_fireEvents(t,s,u){const p=Ot(this._eventsInProgress),y=Ot(t),b={};for(const O in t){const{originalEvent:F}=t[O];this._eventsInProgress[O]||(b[`${O}start`]=F),this._eventsInProgress[O]=t[O]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const O in b)this._fireEvent(O,b[O]);y&&this._fireEvent("move",y.originalEvent);for(const O in t){const{originalEvent:F}=t[O];this._fireEvent(O,F)}const I={};let P;for(const O in this._eventsInProgress){const{handlerName:F,originalEvent:q}=this._eventsInProgress[O];this._handlersById[F].isActive()||(delete this._eventsInProgress[O],P=s[F]||q,I[`${O}end`]=P)}for(const O in I)this._fireEvent(O,I[O]);const C=Ot(this._eventsInProgress),k=(p||y)&&!C;if(k&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const O=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&O.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(O)}if(u&&k){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!O||!O.essential&&Ie.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:P})),F(this._map.getBearing())&&this._map.resetNorth()):(F(O.bearing||this._map.getBearing())&&(O.bearing=0),O.freezeElevation=!0,this._map.easeTo(O,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new c.l(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Bl("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Si extends c.E{constructor(t,s,u){super(),this._renderFrameCallback=()=>{const p=Math.min((ke()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=u.bearingSnap,this.cameraHelper=s,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,s){t.apply(this.transform),this.transform=t,this.cameraHelper=s}getCenter(){return new c.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,s){return this.jumpTo({elevation:t},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,s,u){return t=c.P.convert(t).mult(-1),this.panTo(this.transform.center,c.e({offset:t},s),u)}panTo(t,s,u){return this.easeTo(c.e({center:t},s),u)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,u){return this.easeTo(c.e({zoom:t},s),u)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,s){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new c.l("movestart",s)).fire(new c.l("move",s)).fire(new c.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,u){return this.easeTo(c.e({bearing:t},s),u)}resetNorth(t,s){return this.rotateTo(0,c.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}getRoll(){return this.transform.roll}setRoll(t,s){return this.jumpTo({roll:t},s),this}cameraForBounds(t,s){t=Lt.convert(t).adjustAntiMeridian();const u=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,s)}_cameraForBoxAndBearing(t,s,u,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=c.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const C=p.padding;p.padding={top:C,bottom:C,right:C,left:C}}const b=c.e(y,p.padding);p.padding=b;const I=this.transform,P=new Lt(t,s);return this.cameraHelper.cameraForBoxAndBearing(p,b,P,u,I)}fitBounds(t,s,u){return this._fitInternal(this.cameraForBounds(t,s),s,u)}fitScreenCoordinates(t,s,u,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(t)),this.transform.screenPointToLocation(c.P.convert(s)),u,p),p,y)}_fitInternal(t,s,u){return t?(delete(s=c.e(t,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(t,s){this.stop();const u=this._getTransformForUpdate();let p=!1,y=!1,b=!1;const I=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,t);const P=u.zoom!==I;return"elevation"in t&&u.elevation!==+t.elevation&&u.setElevation(+t.elevation),"bearing"in t&&u.bearing!==+t.bearing&&(p=!0,u.setBearing(+t.bearing)),"pitch"in t&&u.pitch!==+t.pitch&&(y=!0,u.setPitch(+t.pitch)),"roll"in t&&u.roll!==+t.roll&&(b=!0,u.setRoll(+t.roll)),t.padding==null||u.isPaddingEqual(t.padding)||u.setPadding(t.padding),this._applyUpdatedTransform(u),this.fire(new c.l("movestart",s)).fire(new c.l("move",s)),P&&this.fire(new c.l("zoomstart",s)).fire(new c.l("zoom",s)).fire(new c.l("zoomend",s)),p&&this.fire(new c.l("rotatestart",s)).fire(new c.l("rotate",s)).fire(new c.l("rotateend",s)),y&&this.fire(new c.l("pitchstart",s)).fire(new c.l("pitch",s)).fire(new c.l("pitchend",s)),b&&this.fire(new c.l("rollstart",s)).fire(new c.l("roll",s)).fire(new c.l("rollend",s)),this.fire(new c.l("moveend",s))}calculateCameraOptionsFromTo(t,s,u,p=0){const y=c.a9.fromLngLat(t,s),b=c.a9.fromLngLat(u,p),I=b.x-y.x,P=b.y-y.y,C=b.z-y.z,k=Math.hypot(I,P,C);if(k===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(I,P),F=c.at(this.transform.cameraToCenterDistance/k/this.transform.tileSize),q=180*Math.atan2(I,-P)/Math.PI;let Z=180*Math.acos(O/k)/Math.PI;return Z=C<0?90-Z:90+Z,{center:b.toLngLat(),elevation:p,zoom:F,pitch:Z,bearing:q}}calculateCameraOptionsFromCameraLngLatAltRotation(t,s,u,p,y){const b=this.transform.calculateCenterFromCameraLngLatAlt(t,s,u,p);return{center:b.center,elevation:b.elevation,zoom:b.zoom,bearing:u,pitch:p,roll:y}}easeTo(t,s){this._stop(!1,t.easeId),((t=c.e({offset:[0,0],duration:500,easing:c.cy},t)).animate===!1||!t.essential&&Ie.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),p=this.getBearing(),y=u.pitch,b=u.roll,I="bearing"in t?this._normalizeBearing(t.bearing,p):p,P="pitch"in t?+t.pitch:y,C="roll"in t?this._normalizeBearing(t.roll,b):b,k="padding"in t?t.padding:u.padding,O=c.P.convert(t.offset);let F,q;t.around&&(F=c.V.convert(t.around),q=u.locationToScreenPoint(F));const Z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},te=this.cameraHelper.handleEaseTo(u,{bearing:I,pitch:P,roll:C,padding:k,around:F,aroundPoint:q,offsetAsPoint:O,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||p!==I,this._pitching=this._pitching||P!==y,this._rolling=this._rolling||C!==b,this._padding=!u.isPaddingEqual(k),this._zooming=this._zooming||te.isZooming,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Z),this.terrain&&this._prepareElevation(te.elevationCenter),this._ease(ie=>{te.easeFunc(ie),this.terrain&&!t.freezeElevation&&this._updateElevation(ie),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},ie=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,ie)},t),this}_prepareEase(t,s,u={}){this._moving=!0,s||u.moving||this.fire(new c.l("movestart",t)),this._zooming&&!u.zooming&&this.fire(new c.l("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new c.l("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new c.l("pitchstart",t)),this._rolling&&!u.rolling&&this.fire(new c.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(s-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.setElevation(c.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const s=t.getCameraLngLat(),u=t.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(s,t.zoom):0;if(u<p){const y=this.calculateCameraOptionsFromTo(s,p,t.center,t.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(t){const s=[];if(s.push(p=>this._elevateCameraIfInsideTerrain(p)),this.transformCameraUpdate&&s.push(p=>this.transformCameraUpdate(p)),!s.length)return;const u=t.clone();for(const p of s){const y=u.clone(),{center:b,zoom:I,roll:P,pitch:C,bearing:k,elevation:O}=p(y);b&&y.setCenter(b),O!==void 0&&y.setElevation(O),I!==void 0&&y.setZoom(I),P!==void 0&&y.setRoll(P),C!==void 0&&y.setPitch(C),k!==void 0&&y.setBearing(k),u.apply(y)}this.transform.apply(u)}_fireMoveEvents(t){this.fire(new c.l("move",t)),this._zooming&&this.fire(new c.l("zoom",t)),this._rotating&&this.fire(new c.l("rotate",t)),this._pitching&&this.fire(new c.l("pitch",t)),this._rolling&&this.fire(new c.l("roll",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const u=this._zooming,p=this._rotating,y=this._pitching,b=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new c.l("zoomend",t)),p&&this.fire(new c.l("rotateend",t)),y&&this.fire(new c.l("pitchend",t)),b&&this.fire(new c.l("rollend",t)),this.fire(new c.l("moveend",t))}flyTo(t,s){if(!t.essential&&Ie.prefersReducedMotion){const Ne=c.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ne,s)}this.stop(),t=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cy},t);const u=this._getTransformForUpdate(),p=u.bearing,y=u.pitch,b=u.roll,I=u.padding,P="bearing"in t?this._normalizeBearing(t.bearing,p):p,C="pitch"in t?+t.pitch:y,k="roll"in t?this._normalizeBearing(t.roll,b):b,O="padding"in t?t.padding:u.padding,F=c.P.convert(t.offset);let q=u.centerPoint.add(F);const Z=u.screenPointToLocation(q),te=this.cameraHelper.handleFlyTo(u,{bearing:P,pitch:C,roll:k,padding:O,locationAtOffset:Z,offsetAsPoint:F,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ie=t.curve;const re=Math.max(u.width,u.height),le=re/te.scaleOfZoom,ve=te.pixelPathLength;typeof te.scaleOfMinZoom=="number"&&(ie=Math.sqrt(re/te.scaleOfMinZoom/ve*2));const oe=ie*ie;function _e(Ne){const it=(le*le-re*re+(Ne?-1:1)*oe*oe*ve*ve)/(2*(Ne?le:re)*oe*ve);return Math.log(Math.sqrt(it*it+1)-it)}function Te(Ne){return(Math.exp(Ne)-Math.exp(-Ne))/2}function me(Ne){return(Math.exp(Ne)+Math.exp(-Ne))/2}const Pe=_e(!1);let Be=function(Ne){return me(Pe)/me(Pe+ie*Ne)},Fe=function(Ne){return re*((me(Pe)*(Te(it=Pe+ie*Ne)/me(it))-Te(Pe))/oe)/ve;var it},Oe=(_e(!0)-Pe)/ie;if(Math.abs(ve)<2e-6||!isFinite(Oe)){if(Math.abs(re-le)<1e-6)return this.easeTo(t,s);const Ne=le<re?-1:1;Oe=Math.abs(Math.log(le/re))/ie,Fe=()=>0,Be=it=>Math.exp(Ne*ie*it)}return t.duration="duration"in t?+t.duration:1e3*Oe/("screenSpeed"in t?+t.screenSpeed/ie:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==P,this._pitching=C!==y,this._rolling=k!==b,this._padding=!u.isPaddingEqual(O),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(te.targetCenter),this._ease(Ne=>{const it=Ne*Oe,at=1/Be(it),Je=Fe(it);this._rotating&&u.setBearing(c.G.number(p,P,Ne)),this._pitching&&u.setPitch(c.G.number(y,C,Ne)),this._rolling&&u.setRoll(c.G.number(b,k,Ne)),this._padding&&(u.interpolatePadding(I,O,Ne),q=u.centerPoint.add(F)),te.easeFunc(Ne,at,Je,q),this.terrain&&!t.freezeElevation&&this._updateElevation(Ne),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,s)}return t||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(t,s,u){u.animate===!1||u.duration===0?(t(1),s()):(this._easeStart=ke(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=c.W(t,-180,180);const u=Math.abs(t-s);return Math.abs(t-360-s)<u&&(t-=360),Math.abs(t+360-s)<u&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(c.V.convert(t),this.transform):null}}const gs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xh{constructor(t=gs){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const u=this._map._getUIString(`AttributionControl.${s}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style.tileManagers;for(const p in s){const y=s[p];if(y.used||y.usedForTerrain){const b=y.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t=t.filter(p=>String(p).trim()),t.sort((p,y)=>p.length-y.length),t=t.filter((p,y)=>{for(let b=y+1;b<t.length;b++)if(t[b].indexOf(p)>=0)return!1;return!0});const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=Q.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class fp{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Q.create("div","maplibregl-ctrl");const s=Q.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class wm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Tm=c.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Ul extends c.E{constructor(t){super(),this._lastTilesetChange=ke(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,s){this.tileManager.update(t,s),this._renderableTilesKeys=[];const u={};for(const p of yt(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.tileManager._source.calculateTileZoom}))u[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),c.c7(p.terrainRttPosMatrix32f,0,c.a5,c.a5,0,0,1),this._tiles[p.key]=new He(p,this.tileSize),this._lastTilesetChange=ke());for(const p in this._tiles)u[p]||delete this._tiles[p]}freeRtt(t){for(const s in this._tiles){const u=this._tiles[s];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,s){return s?this._getTerrainCoordsForTileRanges(t,s):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const s={};for(const u of this._renderableTilesKeys){const p=this._tiles[u].tileID,y=t.clone(),b=c.bk();if(p.canonical.equals(t.canonical))c.c7(b,0,c.a5,c.a5,0,0,1);else if(p.canonical.isChildOf(t.canonical)){const I=p.canonical.z-t.canonical.z,P=p.canonical.x-(p.canonical.x>>I<<I),C=p.canonical.y-(p.canonical.y>>I<<I),k=c.a5>>I;c.c7(b,0,k,k,0,0,1),c.O(b,b,[-P*k,-C*k,0])}else{if(!t.canonical.isChildOf(p.canonical))continue;{const I=t.canonical.z-p.canonical.z,P=t.canonical.x-(t.canonical.x>>I<<I),C=t.canonical.y-(t.canonical.y>>I<<I),k=c.a5>>I;c.c7(b,0,c.a5,c.a5,0,0,1),c.O(b,b,[P*k,C*k,0]),c.Q(b,b,[1/2**I,1/2**I,0])}}y.terrainRttPosMatrix32f=new Float32Array(b),s[u]=y}return s}_getTerrainCoordsForTileRanges(t,s){const u={};for(const p of this._renderableTilesKeys){const y=this._tiles[p].tileID;if(!this._isWithinTileRanges(y,s))continue;const b=t.clone(),I=c.bk();if(y.canonical.z===t.canonical.z){const P=t.canonical.x-y.canonical.x,C=t.canonical.y-y.canonical.y;c.c7(I,0,c.a5,c.a5,0,0,1),c.O(I,I,[P*c.a5,C*c.a5,0])}else if(y.canonical.z>t.canonical.z){const P=y.canonical.z-t.canonical.z,C=y.canonical.x-(y.canonical.x>>P<<P),k=y.canonical.y-(y.canonical.y>>P<<P),O=t.canonical.x-(y.canonical.x>>P),F=t.canonical.y-(y.canonical.y>>P),q=c.a5>>P;c.c7(I,0,q,q,0,0,1),c.O(I,I,[-C*q+O*c.a5,-k*q+F*c.a5,0])}else{const P=t.canonical.z-y.canonical.z,C=t.canonical.x-(t.canonical.x>>P<<P),k=t.canonical.y-(t.canonical.y>>P<<P),O=(t.canonical.x>>P)-y.canonical.x,F=(t.canonical.y>>P)-y.canonical.y,q=c.a5<<P;c.c7(I,0,q,q,0,0,1),c.O(I,I,[C*c.a5+O*q,k*c.a5+F*q,0])}b.terrainRttPosMatrix32f=new Float32Array(I),u[p]=b}return u}getSourceTile(t,s){const u=this.tileManager._source;let p=t.overscaledZ-this.deltaZoom;if(p>u.maxzoom&&(p=u.maxzoom),p<u.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let y=this.findTileInCaches(this._sourceTileCache[t.key]);if(!(y!=null&&y.dem)&&s)for(;p>=u.minzoom&&!(y!=null&&y.dem);)y=this.findTileInCaches(t.scaledTo(p--).key);return y}findTileInCaches(t){let s=this.tileManager.getTileByID(t);return s||(s=this.tileManager._outOfViewCache.getByKey(t),s)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,s){return s[t.canonical.z]&&t.canonical.x>=s[t.canonical.z].minTileX&&t.canonical.x<=s[t.canonical.z].maxTileX&&t.canonical.y>=s[t.canonical.z].minTileY&&t.canonical.y<=s[t.canonical.z].maxTileY}}class wr{constructor(t,s,u){this._meshCache={},this.painter=t,this.tileManager=new Ul(s),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,u,p=c.a5){var y;if(!(s>=0&&s<p&&u>=0&&u<p))return 0;const b=this.getTerrainData(t),I=(y=b.tile)===null||y===void 0?void 0:y.dem;if(!I)return 0;const P=c.cC([],[s/p*c.a5,u/p*c.a5],b.u_terrain_matrix),C=[P[0]*I.dim,P[1]*I.dim],k=Math.floor(C[0]),O=Math.floor(C[1]),F=C[0]-k,q=C[1]-O;return I.get(k,O)*(1-F)*(1-q)+I.get(k+1,O)*F*(1-q)+I.get(k,O+1)*(1-F)*q+I.get(k+1,O+1)*F*q}getElevationForLngLatZoom(t,s){if(!c.cD(s,t.wrap()))return 0;const{tileID:u,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(u,p%c.a5,y%c.a5,c.a5)}getElevationForLngLat(t,s){const u=yt(s,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let p=0;for(const y of u)y.canonical.z>p&&(p=Math.min(y.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,p)}getElevation(t,s,u,p=c.a5){return this.getDEMElevation(t,s,u,p)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.painter.context,y=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(p,new c.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ar([])}const s=this.tileManager.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const p=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new c.T(p,s.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),s.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const u=s&&s.toString()+s.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const p=this.tileManager.getSource().maxzoom;let y=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?y=t.canonical.z-p:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=t.canonical.x-(t.canonical.x>>y<<y),I=t.canonical.y-(t.canonical.y>>y<<y),P=c.cE(new Float64Array(16),[1/(c.a5<<y),1/(c.a5<<y),0]);c.O(P,P,[b*c.a5,I*c.a5,0]),this._demMatrixCache[t.key]={matrix:P,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,u=s.width/devicePixelRatio,p=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(s.context,{width:u,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(s.context,{width:u,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(u,p,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,b=0;y<this._coordsTextureSize;y++)for(let I=0;I<this._coordsTextureSize;I++,b+=4)s[b+0]=255&I,s[b+1]=255&y,s[b+2]=I>>8<<4|y>>8,s[b+3]=0;const u=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),p=new c.T(t,u,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),u=this.painter.context,p=u.gl,y=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),I=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(y,I-b-1,1,1,p.RGBA,p.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null);const P=s[0]+(s[2]>>4<<8),C=s[1]+((15&s[2])<<8),k=this.coordsIndex[255-s[3]],O=k&&this.tileManager.getTileByID(k);if(!O)return null;const F=this._coordsTextureSize,q=(1<<O.tileID.canonical.z)*F;return new c.a9((O.tileID.canonical.x*F+P)/q+O.tileID.wrap,(O.tileID.canonical.y*F+C)/q,this.getElevation(O.tileID,P,C,F))}depthAtPoint(t){const s=new Uint8Array(4),u=this.painter.context,p=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(t){var s;const u=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,p=u&&t.canonical.y===0,y=u&&t.canonical.y===(1<<t.canonical.z)-1,b=`m_${p?"n":""}_${y?"s":""}`;if(this._meshCache[b])return this._meshCache[b];const I=this.painter.context,P=new c.cF,C=new c.aY,k=this.meshSize,O=c.a5/k,F=k*k;for(let me=0;me<=k;me++)for(let Pe=0;Pe<=k;Pe++)P.emplaceBack(Pe*O,me*O,0);for(let me=0;me<F;me+=k+1)for(let Pe=0;Pe<k;Pe++)C.emplaceBack(Pe+me,k+Pe+me+1,k+Pe+me+2),C.emplaceBack(Pe+me,k+Pe+me+2,Pe+me+1);const q=P.length,Z=q+(k+1),te=(k+1)*k,ie=p?c.br:0,re=p?0:1,le=y?c.bs:c.a5,ve=y?0:1;for(let me=0;me<=k;me++)P.emplaceBack(me*O,ie,re);for(let me=0;me<=k;me++)P.emplaceBack(me*O,le,ve);for(let me=0;me<k;me++)C.emplaceBack(te+me,Z+me,Z+me+1),C.emplaceBack(te+me,Z+me+1,te+me+1),C.emplaceBack(0+me,q+me+1,q+me),C.emplaceBack(0+me,0+me+1,q+me+1);const oe=P.length,_e=oe+2*(k+1);for(const me of[0,1])for(let Pe=0;Pe<=k;Pe++)for(const Be of[0,1])P.emplaceBack(me*c.a5,Pe*O,Be);for(let me=0;me<2*k;me+=2)C.emplaceBack(oe+me,oe+me+1,oe+me+3),C.emplaceBack(oe+me,oe+me+3,oe+me+2),C.emplaceBack(_e+me,_e+me+3,_e+me+1),C.emplaceBack(_e+me,_e+me+2,_e+me+3);const Te=new Vn(I.createVertexBuffer(P,Tm.members),I.createIndexBuffer(C),c.aX.simpleSegment(0,0,P.length,C.length));return this._meshCache[b]=Te,Te}getMeshFrameDelta(t){return 2*Math.PI*c.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,s){var u;if(!c.cD(s,t.wrap()))return 0;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(u=this.getMinMaxElevation(p).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return s&&s.dem&&(u.minElevation=s.dem.min*this.exaggeration,u.maxElevation=s.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,s){const u=c.a9.fromLngLat(t.wrap()),p=(1<<s)*c.a5,y=u.x*p,b=u.y*p,I=Math.floor(y/c.a5),P=Math.floor(b/c.a5);return{tileID:new c.a2(s,0,s,I,P),mercatorX:y,mercatorY:b}}}class kr{constructor(t,s,u){this._context=t,this._size=s,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(u.texture),{id:t,fbo:s,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const sa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class jl{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new kr(t.context,30,s.tileManager.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter(u=>!t._layers[u].isHidden(s)),this._coordsAscending={};for(const u in t.tileManagers){this._coordsAscending[u]={};const p=t.tileManagers[u].getVisibleCoordinates(),y=t.tileManagers[u].getSource(),b=y instanceof Xt?y.terrainTileRanges:null;for(const I of p){const P=this.terrain.tileManager.getTerrainCoords(I,b);for(const C in P)this._coordsAscending[u][C]||(this._coordsAscending[u][C]=[]),this._coordsAscending[u][C].push(P[C])}}this._coordsAscendingStr={};for(const u of t._order){const p=t._layers[u],y=p.source;if(sa[p.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const b in this._coordsAscending[y])this._coordsAscendingStr[y][b]=this._coordsAscending[y][b].map(I=>I.key).sort().join()}}for(const u of this._renderableTiles)for(const p in this._coordsAscendingStr){const y=this._coordsAscendingStr[p][u.tileID.key];y&&y!==u.rttCoords[p]&&(u.rtt=[])}}renderLayer(t,s){if(t.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),p=t.type,y=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(sa[p]&&(this._prevType&&sa[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(t.id),!b))return!0;if(sa[this._prevType]||sa[p]&&b){this._prevType=p;const I=this._stacks.length-1,P=this._stacks[I]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(ch(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[I]){const O=this.pool.getObjectForId(C.rtt[I].id);if(O.stamp===C.rtt[I].stamp){this.pool.useObject(O);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),C.rtt[I]={id:k.id,stamp:k.stamp},y.context.bindFramebuffer.set(k.fbo.framebuffer),y.context.clear({color:c.bp.transparent,stencil:0}),y.currentStencilSource=void 0;for(let O=0;O<P.length;O++){const F=y.style._layers[P[O]],q=F.source?this._coordsAscending[F.source][C.tileID.key]:[C.tileID];y.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),y._renderTileClippingMasks(F,q,!0),y.renderLayer(y,y.style.tileManagers[F.source],F,q,u),F.source&&(C.rttCoords[F.source]=this._coordsAscendingStr[F.source][C.tileID.key])}}return ch(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),sa[p]}return!1}}const Wc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},bh=R,Kc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:gs,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},wh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ql{constructor(t,s,u=!1){this.mousedown=y=>{this.startMove(y,Q.mousePos(this.element,y)),Q.addEventListener(window,"mousemove",this.mousemove),Q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,Q.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHandler.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),Q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=Q.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const p=new ap;this._rotatePitchHandler=new Ba({clickTolerance:3,move:(y,b)=>{const I=s.getBoundingClientRect(),P=new c.P((I.bottom-I.top)/2,(I.right-I.left)/2);return{bearingDelta:c.cx(new c.P(y.x,b.y),b,P),pitchDelta:u?-.5*(b.y-y.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=t,Q.addEventListener(s,"mousedown",this.mousedown),Q.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),Q.addEventListener(s,"touchcancel",this.reset)}startMove(t,s){this._rotatePitchHandler.dragStart(t,s),Q.disableDrag()}move(t,s){const u=this.map,{bearingDelta:p,pitchDelta:y}=this._rotatePitchHandler.dragMove(t,s)||{};p&&u.setBearing(u.getBearing()+p),y&&u.setPitch(u.getPitch()+y)}off(){const t=this.element;Q.removeEventListener(t,"mousedown",this.mousedown),Q.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend),Q.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Q.enableDrag(),Q.removeEventListener(window,"mousemove",this.mousemove),Q.removeEventListener(window,"mouseup",this.mouseup),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend)}}let io;function Xc(_,t,s,u=!1){if(u||!s.getCoveringTilesDetailsProvider().allowWorldCopies())return _==null?void 0:_.wrap();const p=new c.V(_.lng,_.lat);if(_=new c.V(_.lng,_.lat),t){const y=new c.V(_.lng-360,_.lat),b=new c.V(_.lng+360,_.lat),I=s.locationToScreenPoint(_).distSqr(t);s.locationToScreenPoint(y).distSqr(t)<I?_=y:s.locationToScreenPoint(b).distSqr(t)<I&&(_=b)}for(;Math.abs(_.lng-s.center.lng)>180;){const y=s.locationToScreenPoint(_);if(y.x>=0&&y.y>=0&&y.x<=s.width&&y.y<=s.height)break;_.lng>s.center.lng?_.lng-=360:_.lng+=360}return _.lng!==p.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(_))?_:p}const $l={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Yc(_,t,s){const u=_.classList;for(const p in $l)u.remove(`maplibregl-${s}-anchor-${p}`);u.add(`maplibregl-${s}-anchor-${t}`)}class Gl extends c.E{constructor(t){if(super(),this._onKeyPress=s=>{const u=s.code,p=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=s=>{const u=s.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=Xc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),Q.setTransform(this._element,`${$l[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${p}`),Ie.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=c.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div");const s=Q.createNS("http://www.w3.org/2000/svg","svg"),u=41,p=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${u}px`),s.setAttributeNS(null,"width",`${p}px`),s.setAttributeNS(null,"viewBox",`0 0 ${p} ${u}`);const y=Q.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const b=Q.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const I=Q.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of P){const le=Q.createNS("http://www.w3.org/2000/svg","ellipse");le.setAttributeNS(null,"opacity","0.04"),le.setAttributeNS(null,"cx","10.5"),le.setAttributeNS(null,"cy","5.80029008"),le.setAttributeNS(null,"rx",re.rx),le.setAttributeNS(null,"ry",re.ry),I.appendChild(le)}const C=Q.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const k=Q.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(k);const O=Q.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const F=Q.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(F);const q=Q.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const Z=Q.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const te=Q.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#000000"),te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962");const ie=Q.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),Z.appendChild(te),Z.appendChild(ie),b.appendChild(I),b.appendChild(C),b.appendChild(O),b.appendChild(q),b.appendChild(Z),s.appendChild(b),s.setAttributeNS(null,"height",u*this._scale+"px"),s.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(s),this._offset=c.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Yc(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,u;const p=(s=this._map)===null||s===void 0?void 0:s.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!p||y){const q=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==q&&(this._element.style.opacity=q))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,I=b.terrain.depthAtPoint(this._pos),P=b.terrain.getElevationForLngLat(this._lngLat,b.transform);if(b.transform.lngLatToCameraDepth(this._lngLat,P)-I<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/b.transform.pixelsPerMeter,k=Math.sin(b.getPitch()*Math.PI/180)*C,O=b.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),F=b.transform.lngLatToCameraDepth(this._lngLat,P+k)-O>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=c.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return(this._opacity===void 0||t===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Th={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ja=0,oa=!1;const Eh={maxWidth:100,unit:"metric"};function Hl(_,t,s){const u=s&&s.maxWidth||100,p=_._container.clientHeight/2,y=_._container.clientWidth/2,b=_.unproject([y-u/2,p]),I=_.unproject([y+u/2,p]),P=Math.round(_.project(I).x-_.project(b).x),C=Math.min(u,P,_._container.clientWidth),k=b.distanceTo(I);if(s&&s.unit==="imperial"){const O=3.2808*k;O>5280?aa(t,C,O/5280,_._getUIString("ScaleControl.Miles")):aa(t,C,O,_._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?aa(t,C,k/1852,_._getUIString("ScaleControl.NauticalMiles")):k>=1e3?aa(t,C,k/1e3,_._getUIString("ScaleControl.Kilometers")):aa(t,C,k,_._getUIString("ScaleControl.Meters"))}function aa(_,t,s,u){const p=function(y){const b=Math.pow(10,`${Math.floor(y)}`.length-1);let I=y/b;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(P){const C=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*C)/C}(I),b*I}(s);_.style.width=t*(p/s)+"px",_.innerHTML=`${p}&nbsp;${u}`}const Ih={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Qc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jc(_){if(_){if(typeof _=="number"){const t=Math.round(Math.abs(_)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,_),"top-left":new c.P(t,t),"top-right":new c.P(-t,t),bottom:new c.P(0,-_),"bottom-left":new c.P(t,-t),"bottom-right":new c.P(-t,-t),left:new c.P(_,0),right:new c.P(-_,0)}}if(_ instanceof c.P||Array.isArray(_)){const t=c.P.convert(_);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:c.P.convert(_.center||[0,0]),top:c.P.convert(_.top||[0,0]),"top-left":c.P.convert(_["top-left"]||[0,0]),"top-right":c.P.convert(_["top-right"]||[0,0]),bottom:c.P.convert(_.bottom||[0,0]),"bottom-left":c.P.convert(_["bottom-left"]||[0,0]),"bottom-right":c.P.convert(_["bottom-right"]||[0,0]),left:c.P.convert(_.left||[0,0]),right:c.P.convert(_.right||[0,0])}}return Jc(new c.P(0,0))}const Sh=R;x.AJAXError=c.cI,x.Event=c.l,x.Evented=c.E,x.LngLat=c.V,x.MercatorCoordinate=c.a9,x.Point=c.P,x.addProtocol=c.cJ,x.config=c.c,x.removeProtocol=c.cK,x.AttributionControl=xh,x.BoxZoomHandler=Va,x.CanvasSource=H,x.CooperativeGesturesHandler=St,x.DoubleClickZoomHandler=vh,x.DragPanHandler=pp,x.DragRotateHandler=As,x.EdgeInsets=bo,x.FullscreenControl=class extends c.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s==null?void 0:s.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=Q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Q.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=Yt,x.GeolocateControl=class extends c.E{constructor(_){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new c.V(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,p=this._map.getBearing(),y=c.e({bearing:p},this.options.fitBoundsOptions),b=Lt.fromLngLat(s,u);this._map.fitBounds(b,y,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new c.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&oa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Q.create("button","maplibregl-ctrl-geolocate",this._container),Q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gl({element:this._dotElement}),this._circleElement=Q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{const u=(s==null?void 0:s[0])instanceof ResizeObserverEntry;s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))})}},this.options=c.e({},Th,_)}onAdd(_){return this._map=_,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(t=!1){if(io!==void 0&&!t)return io;if(window.navigator.permissions===void 0)return io=!!window.navigator.geolocation,io;try{io=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{io=!!window.navigator.geolocation}return io})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Q.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,ja=0,oa=!1}_isOutOfMapMaxBounds(_){const t=this._map.getMaxBounds(),s=_.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const _=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&_))return;const t=this._map.project(_),s=this._map.unproject([t.x+100,t.y]),u=_.distanceTo(s)/100,p=2*this._accuracy/u;this._circleElement.style.width=`${p.toFixed(2)}px`,this._circleElement.style.height=`${p.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ja--,oa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ja++,ja>1?(_={maximumAge:6e5,timeout:0},oa=!0):(_=this.options.positionOptions,oa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.GlobeControl=class{constructor(){this._toggleProjection=()=>{var _;const t=(_=this._map.getProjection())===null||_===void 0?void 0:_.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var _;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((_=this._map.getProjection())===null||_===void 0?void 0:_.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(_){return this._map=_,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Q.create("button","maplibregl-ctrl-globe",this._container),Q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},x.Hash=dh,x.ImageSource=Xt,x.KeyboardHandler=Jn,x.LngLatBounds=Lt,x.LogoControl=fp,x.Map=class extends Si{constructor(_){var t,s;c.cG.mark(c.cH.create);const u=Object.assign(Object.assign(Object.assign({},Kc),_),{canvasContextAttributes:Object.assign(Object.assign({},Kc.canvasContextAttributes),_.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new Bs,y=new Ts;if(u.minZoom!==void 0&&p.setMinZoom(u.minZoom),u.maxZoom!==void 0&&p.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&p.setMinPitch(u.minPitch),u.maxPitch!==void 0&&p.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&p.setRenderWorldCopies(u.renderWorldCopies),u.transformConstrain!==null&&p.setConstrainOverride(u.transformConstrain),super(p,y,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new wm,this._controls=[],this._mapId=c.af(),this._lostContextStyle={style:null,images:null},this._contextLost=I=>{I.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const P of Object.values(this.style._layers))if(P.type==="custom"&&console.warn(`Custom layer with id '${P.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),P._listeners)for(const[C]of Object.entries(P._listeners))console.warn(`Custom layer with id '${P.id}' had event listeners for event '${C}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:I}))},this._contextRestored=I=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:I}))},this._onMapScroll=I=>{if(I.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Wc),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this._zoomLevelsToOverscale=u.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=u.transformCameraUpdate,this.transformConstrain=u.transformConstrain,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,u.reduceMotion!==void 0&&(Ie.prefersReducedMotion=u.reduceMotion),this._imageQueueHandle=xe.addThrottleControl(()=>this.isMoving()),this._requestManager=new se(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let I=!1;const P=hh(C=>{this._trackResize&&!this._removed&&(this.resize(C),this.redraw())},50);this._resizeObserver=new ResizeObserver(C=>{I?P(C):I=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Zc(this,u),this._hash=u.hash&&new dh(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,c.e({},u.fitBoundsOptions,{duration:0}))));const b=typeof u.style=="string"||((s=(t=u.style)===null||t===void 0?void 0:t.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,b),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new xh(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new fp,u.logoPosition),this.on("style.load",()=>{if(b||this._resizeTransform(),this.transform.unmodified){const I=c.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(I)}}),this.on("data",I=>{this._update(I.dataType==="style"),this.fire(new c.l(`${I.dataType}data`,I))}),this.on("dataloading",I=>{this.fire(new c.l(`${I.dataType}dataloading`,I))}),this.on("dataabort",I=>{this.fire(new c.l("sourcedataabort",I))})}_getMapId(){return this._mapId}setGlobalStateProperty(_,t){return this.style.setGlobalStateProperty(_,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(_,t){if(t===void 0&&(t=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=_.onAdd(this);this._controls.push(_);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(_);return t>-1&&this._controls.splice(t,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}coveringTiles(_){return yt(this.transform,_)}calculateCameraOptionsFromTo(_,t,s,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLat(s,this.transform)),super.calculateCameraOptionsFromTo(_,t,s,u)}resize(_,t=!0){const[s,u]=this._containerDimensions(),p=this._getClampedPixelRatio(s,u);if(this._resizeCanvas(s,u,p),this.painter.resize(s,u,p),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const I=this._getClampedPixelRatio(s,u);this._resizeCanvas(s,u,I),this.painter.resize(s,u,I)}this._resizeTransform(t);const y=!this._moving;return y&&(this.stop(),this.fire(new c.l("movestart",_)).fire(new c.l("move",_))),this.fire(new c.l("resize",_)),y&&this.fire(new c.l("moveend",_)),this}_resizeTransform(_=!0){var t;const[s,u]=this._containerDimensions();this.transform.resize(s,u,_),(t=this._requestedCameraState)===null||t===void 0||t.resize(s,u,_)}_getClampedPixelRatio(_,t){const{0:s,1:u}=this._maxCanvasSize,p=this.getPixelRatio(),y=_*p,b=t*p;return Math.min(y>s?s/y:1,b>u?u/b:1)*p}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(Lt.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(_),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(_),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.setMinPitch(_),this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(_>=this.transform.minPitch)return this.transform.setMaxPitch(_),this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.setRenderWorldCopies(_),this._update()}setTransformConstrain(_){return this.transform.setConstrainOverride(_),this._update()}project(_){return this.transform.locationToScreenPoint(c.V.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.screenPointToLocation(c.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,t,s){if(_==="mouseenter"||_==="mouseover"){let u=!1;return{layers:t,listener:s,delegates:{mousemove:y=>{const b=t.filter(P=>this.getLayer(P)),I=b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[];I.length?u||(u=!0,s.call(this,new ei(_,this,y.originalEvent,{features:I}))):u=!1},mouseout:()=>{u=!1}}}}if(_==="mouseleave"||_==="mouseout"){let u=!1;return{layers:t,listener:s,delegates:{mousemove:b=>{const I=t.filter(P=>this.getLayer(P));(I.length!==0?this.queryRenderedFeatures(b.point,{layers:I}):[]).length?u=!0:u&&(u=!1,s.call(this,new ei(_,this,b.originalEvent)))},mouseout:b=>{u&&(u=!1,s.call(this,new ei(_,this,b.originalEvent)))}}}}{const u=p=>{const y=t.filter(I=>this.getLayer(I)),b=y.length!==0?this.queryRenderedFeatures(p.point,{layers:y}):[];b.length&&(p.features=b,s.call(this,p),delete p.features)};return{layers:t,listener:s,delegates:{[_]:u}}}}_saveDelegatedListener(_,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(t)}_removeDelegatedListener(_,t,s){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const u=this._delegatedListeners[_];for(let p=0;p<u.length;p++){const y=u[p];if(y.listener===s&&y.layers.length===t.length&&y.layers.every(b=>t.includes(b))){for(const b in y.delegates)this.off(b,y.delegates[b]);return void u.splice(p,1)}}}on(_,t,s){if(s===void 0)return super.on(_,t);const u=typeof t=="string"?[t]:t,p=this._createDelegatedListener(_,u,s);this._saveDelegatedListener(_,p);for(const y in p.delegates)this.on(y,p.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(_,u,s)}}}once(_,t,s){if(s===void 0)return super.once(_,t);const u=typeof t=="string"?[t]:t,p=this._createDelegatedListener(_,u,s);for(const y in p.delegates){const b=p.delegates[y];p.delegates[y]=(...I)=>{this._removeDelegatedListener(_,u,s),b(...I)}}this._saveDelegatedListener(_,p);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(_,t,s){return s===void 0?super.off(_,t):(this._removeDelegatedListener(_,typeof t=="string"?[t]:t,s),this)}queryRenderedFeatures(_,t){if(!this.style)return[];let s;const u=_ instanceof c.P||Array.isArray(_),p=u?_:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:_)||{},p instanceof c.P||typeof p[0]=="number")s=[c.P.convert(p)];else{const y=c.P.convert(p[0]),b=c.P.convert(p[1]);s=[y,new c.P(b.x,y.y),b,new c.P(y.x,b.y),y]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(_,t){return this.style.querySourceFeatures(_,t)}setStyle(_,t){return(t=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(_,t))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const t=this._locale[_];if(t==null)throw new Error(`Missing UI string '${_}'`);return t}_updateStyle(_,t){var s,u;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,t));const p=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new yi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,t,p):this.style.loadJSON(_,t,p),this):((u=(s=this.style)===null||s===void 0?void 0:s.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new yi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,t){if(typeof _=="string"){const s=this._requestManager.transformRequest(_,"Style");c.j(s,new AbortController).then(u=>{this._updateDiff(u.data,t)}).catch(u=>{u&&this.fire(new c.k(u))})}else typeof _=="object"&&this._updateDiff(_,t)}_updateDiff(_,t){try{this.style.setState(_,t)&&this._update(!0)}catch(s){c.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(_,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(_,t){return this._lazyInitEmptyStyle(),this.style.addSource(_,t),this._update(!0)}isSourceLoaded(_){const t=this.style&&this.style.tileManagers[_];if(t!==void 0)return t.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const t=this.style.tileManagers[_.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const u=this.style._layers[s];u.type==="hillshade"&&u.source===_.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===_.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new wr(this.painter,t,_),this.painter.renderToTexture=new jl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var u;s.dataType==="style"?this.terrain.tileManager.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==_.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=s.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:_})),this}getTerrain(){var _,t;return(t=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const _=this.style&&this.style.tileManagers;for(const t of Object.values(_))if(!t.areTilesLoaded())return!1;return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}setSourceTileLodParams(_,t,s){if(s){const u=this.getSource(s);if(!u)throw new Error(`There is no source with ID "${s}", cannot set LOD parameters`);u.calculateTileZoom=Re(Math.max(1,_),Math.max(1,t))}else for(const u in this.style.tileManagers)this.style.tileManagers[u].getSource().calculateTileZoom=Re(Math.max(1,_),Math.max(1,t));return this._update(!0),this}refreshTiles(_,t){const s=this.style.tileManagers[_];if(!s)throw new Error(`There is no tile manager with ID "${_}", cannot refresh tile`);t===void 0?s.reload(!0):s.refreshTiles(t.map(u=>new c.ac(u.z,u.x,u.y)))}addImage(_,t,s={}){const{pixelRatio:u=1,sdf:p=!1,stretchX:y,stretchY:b,content:I,textFitWidth:P,textFitHeight:C}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||c.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:O,data:F}=t,q=t;return this.style.addImage(_,{data:new c.R({width:k,height:O},new Uint8Array(F)),pixelRatio:u,stretchX:y,stretchY:b,content:I,textFitWidth:P,textFitHeight:C,sdf:p,version:0,userImage:q}),q.onAdd&&q.onAdd(this,_),this}}{const{width:k,height:O,data:F}=Ie.getImageData(t);this.style.addImage(_,{data:new c.R({width:k,height:O},F),pixelRatio:u,stretchX:y,stretchY:b,content:I,textFitWidth:P,textFitHeight:C,sdf:p,version:0})}}updateImage(_,t){const s=this.style.getImage(_);if(!s)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||c.b(t)?Ie.getImageData(t):t,{width:p,height:y,data:b}=u;if(p===void 0||y===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||y!==s.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(t instanceof HTMLImageElement||c.b(t));return s.data.replace(b,I),this.style.updateImage(_,s),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return xe.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,t){return this._lazyInitEmptyStyle(),this.style.addLayer(_,t),this._update(!0)}moveLayer(_,t){return this.style.moveLayer(_,t),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,t,s){return this.style.setLayerZoomRange(_,t,s),this._update(!0)}setFilter(_,t,s={}){return this.style.setFilter(_,t,s),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,t,s,u={}){return this.style.setPaintProperty(_,t,s,u),this._update(!0)}getPaintProperty(_,t){return this.style.getPaintProperty(_,t)}setLayoutProperty(_,t,s,u={}){return this.style.setLayoutProperty(_,t,s,u),this._update(!0)}getLayoutProperty(_,t){return this.style.getLayoutProperty(_,t)}setGlyphs(_,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,t,s,u=>{u||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,t,s=>{s||this._update(!0)}),this}setLight(_,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(_,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(_,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,t){return this.style.setFeatureState(_,t),this._update()}removeFeatureState(_,t){return this.style.removeFeatureState(_,t),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,t=0;return this._container&&(_=this._container.clientWidth||400,t=this._container.clientHeight||300),[_,t]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const t=this._canvasContainer=Q.create("div","maplibregl-canvas-container",_);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Q.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),u=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],u);const p=this._controlContainer=Q.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=Q.create("div",`maplibregl-ctrl-${b} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,t,s){this._canvas.width=Math.floor(s*_),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const _=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{t={requestedAttributes:_},u&&(t.statusMessage=u.statusMessage,t.type=u.type)},{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,_):this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_),!s){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new rp(s,this.transform),qe.testSupport(s)}migrateProjection(_,t){super.migrateProjection(_,t),this.painter.transform=_,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){var t,s,u,p,y;const b=this._idleTriggered?this._fadeDuration:0,I=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let P=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,F=ke();this.style.zoomHistory.update(O,F);const q=new c.H(O,{now:F,fadeDuration:b,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Z=q.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(P=!0,this._crossFadingFactor=Z),this.style.update(q)}const C=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==I;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||C)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,C),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cG.mark(c.cH.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||P)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const k=this._sourcesDirty||this._styleDirty||this._placementDirty;return k||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,c.cG.mark(c.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),xe.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Q.remove(this._canvasContainer),Q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cG.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Ie.frame(this._frameRequest,_=>{c.cG.frame(_),this._frameRequest=null;try{this._render(_)}catch(t){if(!c.Z(t)&&!function(s){return s.message===sh}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return bh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),this.style.setProjection(_),this._update(!0)}},x.MapMouseEvent=ei,x.MapTouchEvent=Ll,x.MapWheelEvent=op,x.Marker=Gl,x.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,s)=>{const u=this._map._getUIString(`NavigationControl.${s}`);t.title=u,t.setAttribute("aria-label",u)},this.options=c.e({},wh,_),this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),Q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),Q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=Q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ql(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,t){const s=Q.create("button",_,this._container);return s.type="button",s.addEventListener("click",t),s}},x.Popup=class extends c.E{constructor(_){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Q.remove(this._content),this._container&&(Q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Xc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const s=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const p=Jc(this.options.offset);if(!u){const b=this._container.offsetWidth,I=this._container.offsetHeight;let P;P=s.y+p.bottom.y<I?["top"]:s.y>this._map.transform.height-I?["bottom"]:[],s.x<b/2?P.push("left"):s.x>this._map.transform.width-b/2&&P.push("right"),u=P.length===0?"bottom":P.join("-")}let y=s.add(p[u]);this.options.subpixelPositioning||(y=y.round()),Q.setTransform(this._container,`${$l[u]} translate(${y.x}px,${y.y}px)`),Yc(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ih),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=c.V.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const t=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=_;u=s.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=Q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Qc);_&&_.focus()}},x.RasterDEMTileSource=rn,x.RasterTileSource=Mt,x.ScaleControl=class{constructor(_){this._onMove=()=>{Hl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Hl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Eh),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=Gc,x.Style=yi,x.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Q.create("button","maplibregl-ctrl-terrain",this._container),Q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=up,x.TwoFingersTouchRotateHandler=_h,x.TwoFingersTouchZoomHandler=gh,x.TwoFingersTouchZoomRotateHandler=Vl,x.VectorTileSource=Vt,x.VideoSource=Ae,x.addSourceType=(_,t)=>c._(void 0,void 0,void 0,function*(){if(K(_))throw new Error(`A source type called "${_}" already exists.`);((s,u)=>{G[s]=u})(_,t)}),x.clearPrewarmedResources=function(){const _=Cn;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Mn),Cn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.createTileMesh=yl,x.getMaxParallelImageRequests=function(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return Se().getRTLTextPluginStatus()},x.getVersion=function(){return Sh},x.getWorkerCount=function(){return wt.workerCount},x.getWorkerUrl=function(){return c.c.WORKER_URL},x.importScriptInWorkers=function(_){return or().broadcast("IS",_)},x.isTimeFrozen=function(){return Ue.isFrozen()},x.now=ke,x.prewarm=function(){Sn().acquire(Mn)},x.restoreNow=function(){Ue.restoreNow()},x.setMaxParallelImageRequests=function(_){c.c.MAX_PARALLEL_IMAGE_REQUESTS=_},x.setNow=function(_){Ue.setNow(_)},x.setRTLTextPlugin=function(_,t){return Se().setRTLTextPlugin(_,t)},x.setWorkerCount=function(_){wt.workerCount=_},x.setWorkerUrl=function(_){c.c.WORKER_URL=_}});var w=o;return w})})(bb);var $E=bb.exports;const vu=qE($E);function GE(a,n={}){const{center:o=[0,0],zoom:d=2}=n;console.log("[MapLibre]  Initialization started"),console.log("[MapLibre] Container:",a),console.log("[MapLibre] Options:",{center:o,zoom:d});const g="RxBvcEtOzt1XOYbUqQ4i";console.log("[MapLibre] API Key loaded:",`${g.substring(0,8)}...`);const w=`https://api.maptiler.com/maps/darkmatter/style.json?key=${g}`;console.log("[MapLibre] Style URL:",w),console.log("[MapLibre] Creating Map instance...");const x=new vu.Map({container:a,style:w,center:o,zoom:d,pitch:0,bearing:0,antialias:!0,attributionControl:!0});console.log("[MapLibre] Map instance created:",x);let c=!1;x.on("load",()=>{console.log("[MapLibre]  Map loaded successfully!");const Q=x.getStyle().layers;let qe;for(const Ye of Q)if(Ye.type==="symbol"){qe=Ye.id;break}console.log("[MapLibre] Placing trajectory below layer:",qe),x.addSource("trajectory-past",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x.addLayer({id:"trajectory-past-glow",type:"line",source:"trajectory-past",paint:{"line-color":"#00d4ff","line-width":10,"line-opacity":.5,"line-blur":6}}),x.addLayer({id:"trajectory-past-line",type:"line",source:"trajectory-past",paint:{"line-color":"#00d4ff","line-width":4,"line-opacity":1}}),x.addSource("trajectory-future",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),x.addLayer({id:"trajectory-future-line",type:"line",source:"trajectory-future",paint:{"line-color":"#ffa500","line-width":4,"line-opacity":.9,"line-dasharray":[4,4]}}),c=!0,console.log("[MapLibre]  Trajectory layers initialized")}),x.on("error",Q=>{console.error("[MapLibre]  Map error:",Q)}),x.addControl(new vu.AttributionControl({compact:!0}),"bottom-right"),x.addControl(new vu.NavigationControl({showCompass:!0,showZoom:!0,visualizePitch:!1}),"top-right");const R=`
    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M14 18H26V22H14V18Z" fill="#00D4FF"/>
        <path d="M12 16H8V24H12V16Z" fill="#66E0FF"/>
        <path d="M28 16H32V24H28V16Z" fill="#66E0FF"/>
        <path d="M18 14V10H22V14H18Z" fill="#0099CC"/>
        <path d="M18 26V30H22V26H18Z" fill="#0099CC"/>
        <path d="M4 14H8V26H4V14Z" fill="#AACCFF"/> 
        <path d="M32 14H36V26H32V14Z" fill="#AACCFF"/>
        <rect x="0" y="14" width="4" height="12" fill="#003366"/>
        <rect x="36" y="14" width="4" height="12" fill="#003366"/>
        <rect x="19" y="8" width="2" height="2" fill="white"/> <!-- Antenna tip -->
    </svg>
    `,B=document.createElement("div");B.className="iss-marker",B.style.width="40px",B.style.height="40px",B.innerHTML=R,B.style.cursor="pointer",B.style.filter="drop-shadow(0 0 5px rgba(0,212,255,0.8))",B.style.transition="transform 0.3s ease",B.addEventListener("mouseenter",()=>B.style.transform="scale(1.2)"),B.addEventListener("mouseleave",()=>B.style.transform="scale(1)");const W=new vu.Marker({element:B,anchor:"center"}).setLngLat([0,0]).addTo(x);let ee=null;function ce(Q,qe){if(ee)ee.setLngLat([qe,Q]);else{const Ye=document.createElement("div");Ye.innerHTML=`
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9.5L12 2.5L21 9.5V20.5C21 21.0523 20.5523 21.5 20 21.5H15V15.5H9V21.5H4C3.44772 21.5 3 21.0523 3 20.5V9.5Z" fill="#FF00FF" stroke="white" stroke-width="2"/>
            </svg>`,Ye.className="home-marker",Ye.style.filter="drop-shadow(0 0 5px #ff00ff)",ee=new vu.Marker({element:Ye,anchor:"bottom"}).setLngLat([qe,Q]).addTo(x)}}const Ie=new vu.Popup({closeButton:!1,closeOnClick:!1,offset:25});B.addEventListener("click",()=>{const[Q,qe]=W.getLngLat().toArray();Ie.setLngLat([Q,qe]).setHTML(`
        <div style="
          background: var(--card);
          color: var(--text);
          padding: 8px 12px;
          border-radius: 8px;
          font-size: 12px;
          font-weight: 700;
        ">
          <strong> ISS Position</strong><br>
          Lat: ${qe.toFixed(4)}<br>
          Lng: ${Q.toFixed(4)}
        </div>
      `).addTo(x)});let Ue={lat:0,lng:0},ke=!1;return x.on("render",()=>{ke&&(W.setLngLat([Ue.lng,Ue.lat]),ke=!1)}),{map:x,issMarker:W,popup:Ie,updateHomeMarker:ce,updateISSPosition(Q,qe){Ue.lat=Q,Ue.lng=qe,ke=!0,x.triggerRepaint()},panTo(Q,qe,Ye=4){x.flyTo({center:[qe,Q],zoom:Ye,duration:1500,essential:!0})},setViewMode(Q){Q==="tilted"?x.easeTo({pitch:60,duration:1e3}):x.easeTo({pitch:0,duration:1e3})},updateTrajectory(Q,qe){if(!c){console.warn("[MapLibre] Trajectory layers not ready yet"),x.once("load",()=>{this.updateTrajectory(Q,qe)});return}try{const Ye=x.getSource("trajectory-past"),Ge=x.getSource("trajectory-future");Ye&&Q&&Ye.setData(Q),Ge&&qe&&Ge.setData(qe),console.log("[MapLibre]  Trajectory updated")}catch(Ye){console.error("[MapLibre] Trajectory update error:",Ye)}},isTrajectoryReady(){return c},destroy(){Ie.remove(),W.remove(),x.remove()}}}const HE=[{id:1,name:"Adana",lat:37,lon:35.3213333},{id:2,name:"Adyaman",lat:37.7641667,lon:38.2761667},{id:3,name:"Afyonkarahisar",lat:38.76376,lon:30.54034},{id:4,name:"Ar",lat:39.7216667,lon:43.0566667},{id:5,name:"Amasya",lat:40.65,lon:35.8333333},{id:6,name:"Ankara",lat:39.92077,lon:32.85411},{id:7,name:"Antalya",lat:36.88414,lon:30.70563},{id:8,name:"Artvin",lat:41.1833333,lon:41.8166667},{id:9,name:"Aydn",lat:37.8444,lon:27.8458},{id:10,name:"Balkesir",lat:39.648369,lon:27.88261},{id:11,name:"Bilecik",lat:40.150131,lon:29.983061},{id:12,name:"Bingl",lat:38.885349,lon:40.498291},{id:13,name:"Bitlis",lat:38.4,lon:42.1166667},{id:14,name:"Bolu",lat:40.739479,lon:31.611561},{id:15,name:"Burdur",lat:37.726909,lon:30.288876},{id:16,name:"Bursa",lat:40.18257,lon:29.06687},{id:17,name:"anakkale",lat:40.155312,lon:26.41416},{id:18,name:"ankr",lat:40.6,lon:33.6166667},{id:19,name:"orum",lat:40.5505556,lon:34.9555556},{id:20,name:"Denizli",lat:37.77652,lon:29.08639},{id:21,name:"Diyarbakr",lat:37.91441,lon:40.230629},{id:22,name:"Edirne",lat:41.6666667,lon:26.5666667},{id:23,name:"Elaz",lat:38.680969,lon:39.226398},{id:24,name:"Erzincan",lat:39.75,lon:39.5},{id:25,name:"Erzurum",lat:39.9043189,lon:41.2678853},{id:26,name:"Eskiehir",lat:39.784302,lon:30.51922},{id:27,name:"Gaziantep",lat:37.06622,lon:37.38332},{id:28,name:"Giresun",lat:40.912811,lon:38.38953},{id:29,name:"Gmhane",lat:40.4602778,lon:39.4813889},{id:30,name:"Hakkari",lat:37.5833333,lon:43.7333333},{id:31,name:"Hatay",lat:36.4018488,lon:36.3498097},{id:32,name:"Isparta",lat:37.7666667,lon:30.55},{id:33,name:"Mersin",lat:36.8,lon:34.6333333},{id:34,name:"Istanbul",lat:41.00527,lon:28.97696},{id:35,name:"Izmir",lat:38.41885,lon:27.12872},{id:36,name:"Kars",lat:40.59267,lon:43.077831},{id:37,name:"Kastamonu",lat:41.38871,lon:33.78273},{id:38,name:"Kayseri",lat:38.7333333,lon:35.4833333},{id:39,name:"Krklareli",lat:41.7333333,lon:27.2166667},{id:40,name:"Krehir",lat:39.15,lon:34.1666667},{id:41,name:"Kocaeli",lat:40.8532704,lon:29.8815203},{id:42,name:"Konya",lat:37.8666667,lon:32.4833333},{id:43,name:"Ktahya",lat:39.4166667,lon:29.9833333},{id:44,name:"Malatya",lat:38.35519,lon:38.30946},{id:45,name:"Manisa",lat:38.619099,lon:27.428921},{id:46,name:"Kahramanmara",lat:37.5833333,lon:36.9333333},{id:47,name:"Mardin",lat:37.3122361,lon:40.735112},{id:48,name:"Mula",lat:37.2152778,lon:28.3636111},{id:49,name:"Mu",lat:38.7432926,lon:41.5064823},{id:50,name:"Nevehir",lat:38.62442,lon:34.723969},{id:51,name:"Nide",lat:37.9666667,lon:34.6833333},{id:52,name:"Ordu",lat:40.9833333,lon:37.8833333},{id:53,name:"Rize",lat:41.02005,lon:40.523449},{id:54,name:"Sakarya",lat:40.7568793,lon:30.378138},{id:55,name:"Samsun",lat:41.292782,lon:36.33128},{id:56,name:"Siirt",lat:37.94429,lon:41.93288},{id:57,name:"Sinop",lat:42.0264222,lon:35.1550745},{id:58,name:"Sivas",lat:39.747662,lon:37.017879},{id:59,name:"Tekirda",lat:40.9833333,lon:27.5166667},{id:60,name:"Tokat",lat:40.3166667,lon:36.55},{id:61,name:"Trabzon",lat:41,lon:39.7333333},{id:62,name:"Tunceli",lat:39.1079868,lon:39.5401672},{id:63,name:"anlurfa",lat:37.15,lon:38.8},{id:64,name:"Uak",lat:38.682301,lon:29.40819},{id:65,name:"Van",lat:38.4941667,lon:43.38},{id:66,name:"Yozgat",lat:39.82,lon:34.8044444},{id:67,name:"Zonguldak",lat:41.456409,lon:31.798731},{id:68,name:"Aksaray",lat:38.36869,lon:34.03698},{id:69,name:"Bayburt",lat:40.255169,lon:40.22488},{id:70,name:"Karaman",lat:37.17593,lon:33.228748},{id:71,name:"Krkkale",lat:39.846821,lon:33.515251},{id:72,name:"Batman",lat:37.881168,lon:41.13509},{id:73,name:"rnak",lat:37.5163889,lon:42.4611111},{id:74,name:"Bartn",lat:41.6344444,lon:32.3375},{id:75,name:"Ardahan",lat:41.110481,lon:42.702171},{id:76,name:"Idr",lat:39.9166667,lon:44.0333333},{id:77,name:"Yalova",lat:40.65,lon:29.2666667},{id:78,name:"Karabk",lat:41.2,lon:32.6333333},{id:79,name:"Kilis",lat:36.718399,lon:37.12122},{id:80,name:"Osmaniye",lat:37.06805,lon:36.261589},{id:81,name:"Dzce",lat:40.843849,lon:31.15654}];var Mi=Math.PI,zr=Mi*2,Iu=Mi/180,ZE=180/Mi,WE=1440,KE=398600.8,zs=6378.135,_a=60/Math.sqrt(zs*zs*zs/KE),Tg=zs*_a/60,XE=1/_a,rc=.001082616,YE=-253881e-11,QE=-165597e-11,ic=YE/rc,od=2/3,JE=1440/(2*Mi);function eI(a,n){for(var o=[31,a%4===0?29:28,31,30,31,30,31,31,30,31,30,31],d=Math.floor(n),g=1,w=0;d>w+o[g-1]&&g<12;)w+=o[g-1],g+=1;var x=g,c=d-w,R=(n-d)*24,B=Math.floor(R);R=(R-B)*60;var W=Math.floor(R),ee=(R-W)*60;return{mon:x,day:c,hr:B,minute:W,sec:ee}}function T0(a,n,o,d,g,w){var x=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;return 367*a-Math.floor(7*(a+Math.floor((n+9)/12))*.25)+Math.floor(275*n/9)+o+17210135e-1+((x/6e4+w/60+g)/60+d)/24}function m_(a,n,o,d,g,w){var x=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(a instanceof Date){var c=a;return T0(c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds())}return T0(a,n,o,d,g,w,x)}function Tb(a,n){var o=a.e3,d=a.ee2,g=a.peo,w=a.pgho,x=a.pho,c=a.pinco,R=a.plo,B=a.se2,W=a.se3,ee=a.sgh2,ce=a.sgh3,Ie=a.sgh4,Ue=a.sh2,ke=a.sh3,Q=a.si2,qe=a.si3,Ye=a.sl2,Ge=a.sl3,ht=a.sl4,ct=a.t,ot=a.xgh2,xe=a.xgh3,se=a.xgh4,ue=a.xh2,Ee=a.xh3,be=a.xi2,fe=a.xi3,pe=a.xl2,Jt=a.xl3,fn=a.xl4,Ut=a.zmol,$t=a.zmos,mn=n.init,Pt=n.opsmode,zn=n.ep,on=n.inclp,Ft=n.nodep,Gt=n.argpp,Mn=n.mp,wt,Et,Cn,Wt,Sn,Kt,or,Tn,Dn,Nt,en,Pn,Lt,jt,Vt,Mt,rn,dn,_n,Yt,Xt,Ae=119459e-10,H=.01675,G=.00015835218,K=.0549;Xt=$t+Ae*ct,mn==="y"&&(Xt=$t),Yt=Xt+2*H*Math.sin(Xt),rn=Math.sin(Yt),Nt=.5*rn*rn-.25,en=-.5*rn*Math.cos(Yt);var de=B*Nt+W*en,ge=Q*Nt+qe*en,N=Ye*Nt+Ge*en+ht*rn,Se=ee*Nt+ce*en+Ie*rn,we=Ue*Nt+ke*en;Xt=Ut+G*ct,mn==="y"&&(Xt=Ut),Yt=Xt+2*K*Math.sin(Xt),rn=Math.sin(Yt),Nt=.5*rn*rn-.25,en=-.5*rn*Math.cos(Yt);var Me=d*Nt+o*en,He=be*Nt+fe*en,Le=pe*Nt+Jt*en+fn*rn,tt=ot*Nt+xe*en+se*rn,gt=ue*Nt+Ee*en;return Pn=de+Me,Vt=ge+He,Mt=N+Le,Lt=Se+tt,jt=we+gt,mn==="n"&&(Pn-=g,Vt-=c,Mt-=R,Lt-=w,jt-=x,on+=Vt,zn+=Pn,Wt=Math.sin(on),Cn=Math.cos(on),on>=.2?(jt/=Wt,Lt-=Cn*jt,Gt+=Lt,Ft+=jt,Mn+=Mt):(Kt=Math.sin(Ft),Sn=Math.cos(Ft),wt=Wt*Kt,Et=Wt*Sn,or=jt*Sn+Vt*Cn*Kt,Tn=-jt*Kt+Vt*Cn*Sn,wt+=or,Et+=Tn,Ft%=zr,Ft<0&&Pt==="a"&&(Ft+=zr),dn=Mn+Gt+Cn*Ft,Dn=Mt+Lt-Vt*Ft*Wt,dn+=Dn,_n=Ft,Ft=Math.atan2(wt,Et),Ft<0&&Pt==="a"&&(Ft+=zr),Math.abs(_n-Ft)>Mi&&(Ft<_n?Ft+=zr:Ft-=zr),Mn+=Mt,Gt=dn-Mn-Cn*Ft)),{ep:zn,inclp:on,nodep:Ft,argpp:Gt,mp:Mn}}function tI(a){var n=a.epoch,o=a.ep,d=a.argpp,g=a.tc,w=a.inclp,x=a.nodep,c=a.np,R,B,W,ee,ce,Ie,Ue,ke,Q,qe,Ye,Ge,ht,ct,ot,xe,se,ue,Ee,be,fe,pe,Jt,fn,Ut,$t,mn,Pt,zn,on,Ft,Gt,Mn,wt,Et,Cn,Wt,Sn,Kt,or,Tn,Dn,Nt,en,Pn,Lt,jt,Vt,Mt,rn,dn,_n,Yt,Xt,Ae,H,G,K,de,ge,N,Se,we,Me=.01675,He=.0549,Le=29864797e-13,tt=47968065e-14,gt=.39785416,It=.91744867,Ht=.1945905,zt=-.98088458,Ce=c,tn=o,Rn=Math.sin(x),Rt=Math.cos(x),Re=Math.sin(d),rt=Math.cos(d),Tt=Math.sin(w),yt=Math.cos(w),je=tn*tn,Qt=1-je,Nn=Math.sqrt(Qt),cr=0,We=0,xr=0,Yn=0,Zi=0,fr=n+18261.5+g/1440,st=(4.523602-.00092422029*fr)%zr,At=Math.sin(st),Bt=Math.cos(st),Cr=.91375164-.03568096*Bt,ki=Math.sqrt(1-Cr*Cr),er=.089683511*At/ki,Ct=Math.sqrt(1-er*er),Kn=5.8351514+.001944368*fr,ci=.39785416*At/ki,Di=Ct*Bt+.91744867*er*At;ci=Math.atan2(ci,Di),ci+=Kn-st;var Kr=Math.cos(ci),Wi=Math.sin(ci);be=Ht,fe=zt,fn=It,Ut=gt,pe=Rt,Jt=Rn,Ye=Le;for(var os=1/Ce,Li=0;Li<2;)Li+=1,R=be*pe+fe*fn*Jt,W=-fe*pe+be*fn*Jt,Ue=-be*Jt+fe*fn*pe,ke=fe*Ut,Q=fe*Jt+be*fn*pe,qe=be*Ut,B=yt*Ue+Tt*ke,ee=yt*Q+Tt*qe,ce=-Tt*Ue+yt*ke,Ie=-Tt*Q+yt*qe,Ge=R*rt+B*Re,ht=W*rt+ee*Re,ct=-R*Re+B*rt,ot=-W*Re+ee*rt,xe=ce*Re,se=Ie*Re,ue=ce*rt,Ee=Ie*rt,N=12*Ge*Ge-3*ct*ct,Se=24*Ge*ht-6*ct*ot,we=12*ht*ht-3*ot*ot,_n=3*(R*R+B*B)+N*je,Yt=6*(R*W+B*ee)+Se*je,Xt=3*(W*W+ee*ee)+we*je,Ae=-6*R*ce+je*(-24*Ge*ue-6*ct*xe),H=-6*(R*Ie+W*ce)+je*(-24*(ht*ue+Ge*Ee)+-6*(ct*se+ot*xe)),G=-6*W*Ie+je*(-24*ht*Ee-6*ot*se),K=6*B*ce+je*(24*Ge*xe-6*ct*ue),de=6*(ee*ce+B*Ie)+je*(24*(ht*xe+Ge*se)-6*(ot*ue+ct*Ee)),ge=6*ee*Ie+je*(24*ht*se-6*ot*Ee),_n=_n+_n+Qt*N,Yt=Yt+Yt+Qt*Se,Xt=Xt+Xt+Qt*we,jt=Ye*os,Lt=-.5*jt/Nn,Vt=jt*Nn,Pn=-15*tn*Vt,Mt=Ge*ct+ht*ot,rn=ht*ct+Ge*ot,dn=ht*ot-Ge*ct,Li===1&&($t=Pn,mn=Lt,Pt=jt,zn=Vt,on=Mt,Ft=rn,Gt=dn,Mn=_n,wt=Yt,Et=Xt,Cn=Ae,Wt=H,Sn=G,Kt=K,or=de,Tn=ge,Dn=N,Nt=Se,en=we,be=Kr,fe=Wi,fn=Cr,Ut=ki,pe=Ct*Rt+er*Rn,Jt=Rn*Ct-Rt*er,Ye=tt);var br=(4.7199672+(.2299715*fr-Kn))%zr,Ln=(6.2565837+.017201977*fr)%zr,as=2*$t*Ft,Xr=2*$t*Gt,gi=2*mn*Wt,zi=2*mn*(Sn-Cn),Yr=-2*Pt*wt,_o=-2*Pt*(Et-Mn),Ur=-2*Pt*(-21-9*je)*Me,Mr=2*zn*Nt,qn=2*zn*(en-Dn),ls=-18*zn*Me,cs=-2*mn*or,Fn=-2*mn*(Tn-Kt),Ki=2*Pn*rn,us=2*Pn*dn,hs=2*Lt*H,yo=2*Lt*(G-Ae),vo=-2*jt*Yt,Wo=-2*jt*(Xt-_n),Ko=-2*jt*(-21-9*je)*He,Xo=2*Vt*Se,gl=2*Vt*(we-N),Xi=-18*Vt*He,Fi=-2*Lt*de,Yo=-2*Lt*(ge-K);return{snodm:Rn,cnodm:Rt,sinim:Tt,cosim:yt,sinomm:Re,cosomm:rt,day:fr,e3:us,ee2:Ki,em:tn,emsq:je,gam:Kn,peo:cr,pgho:Yn,pho:Zi,pinco:We,plo:xr,rtemsq:Nn,se2:as,se3:Xr,sgh2:Mr,sgh3:qn,sgh4:ls,sh2:cs,sh3:Fn,si2:gi,si3:zi,sl2:Yr,sl3:_o,sl4:Ur,s1:Pn,s2:Lt,s3:jt,s4:Vt,s5:Mt,s6:rn,s7:dn,ss1:$t,ss2:mn,ss3:Pt,ss4:zn,ss5:on,ss6:Ft,ss7:Gt,sz1:Mn,sz2:wt,sz3:Et,sz11:Cn,sz12:Wt,sz13:Sn,sz21:Kt,sz22:or,sz23:Tn,sz31:Dn,sz32:Nt,sz33:en,xgh2:Xo,xgh3:gl,xgh4:Xi,xh2:Fi,xh3:Yo,xi2:hs,xi3:yo,xl2:vo,xl3:Wo,xl4:Ko,nm:Ce,z1:_n,z2:Yt,z3:Xt,z11:Ae,z12:H,z13:G,z21:K,z22:de,z23:ge,z31:N,z32:Se,z33:we,zmol:br,zmos:Ln}}function nI(a){var n=a.cosim,o=a.argpo,d=a.s1,g=a.s2,w=a.s3,x=a.s4,c=a.s5,R=a.sinim,B=a.ss1,W=a.ss2,ee=a.ss3,ce=a.ss4,Ie=a.ss5,Ue=a.sz1,ke=a.sz3,Q=a.sz11,qe=a.sz13,Ye=a.sz21,Ge=a.sz23,ht=a.sz31,ct=a.sz33,ot=a.t,xe=a.tc,se=a.gsto,ue=a.mo,Ee=a.mdot,be=a.no,fe=a.nodeo,pe=a.nodedot,Jt=a.xpidot,fn=a.z1,Ut=a.z3,$t=a.z11,mn=a.z13,Pt=a.z21,zn=a.z23,on=a.z31,Ft=a.z33,Gt=a.ecco,Mn=a.eccsq,wt=a.emsq,Et=a.em,Cn=a.argpm,Wt=a.inclm,Sn=a.mm,Kt=a.nm,or=a.nodem,Tn=a.irez,Dn=a.atime,Nt=a.d2201,en=a.d2211,Pn=a.d3210,Lt=a.d3222,jt=a.d4410,Vt=a.d4422,Mt=a.d5220,rn=a.d5232,dn=a.d5421,_n=a.d5433,Yt=a.dedt,Xt=a.didt,Ae=a.dmdt,H=a.dnodt,G=a.domdt,K=a.del1,de=a.del2,ge=a.del3,N=a.xfact,Se=a.xlamo,we=a.xli,Me=a.xni,He,Le,tt,gt,It,Ht,zt,Ce,tn,Rn,Rt,Re,rt,Tt,yt,je,Qt,Nn,cr,We,xr,Yn,Zi,fr,st,At,Bt,Cr,ki,er,Ct,Kn,ci=17891679e-13,Di=21460748e-13,Kr=22123015e-14,Wi=17891679e-13,os=73636953e-16,Li=21765803e-16,br=.0043752690880113,Ln=37393792e-14,as=11428639e-14,Xr=.00015835218,gi=119459e-10;Tn=0,Kt<.0052359877&&Kt>.0034906585&&(Tn=1),Kt>=.00826&&Kt<=.00924&&Et>=.5&&(Tn=2);var zi=B*gi*Ie,Yr=W*gi*(Q+qe),_o=-gi*ee*(Ue+ke-14-6*wt),Ur=ce*gi*(ht+ct-6),Mr=-gi*W*(Ye+Ge);(Wt<.052359877||Wt>Mi-.052359877)&&(Mr=0),R!==0&&(Mr/=R);var qn=Ur-n*Mr;Yt=zi+d*Xr*c,Xt=Yr+g*Xr*($t+mn),Ae=_o-Xr*w*(fn+Ut-14-6*wt);var ls=x*Xr*(on+Ft-6),cs=-Xr*g*(Pt+zn);(Wt<.052359877||Wt>Mi-.052359877)&&(cs=0),G=qn+ls,H=Mr,R!==0&&(G-=n/R*cs,H+=cs/R);var Fn=0,Ki=(se+xe*br)%zr;if(Et+=Yt*ot,Wt+=Xt*ot,Cn+=G*ot,or+=H*ot,Sn+=Ae*ot,Tn!==0){if(er=Math.pow(Kt/_a,od),Tn===2){Ct=n*n;var us=Et;Et=Gt;var hs=wt;wt=Mn,Kn=Et*wt,Tt=-.306-(Et-.64)*.44,Et<=.65?(yt=3.616-13.247*Et+16.29*wt,Qt=-19.302+117.39*Et-228.419*wt+156.591*Kn,Nn=-18.9068+109.7927*Et-214.6334*wt+146.5816*Kn,cr=-41.122+242.694*Et-471.094*wt+313.953*Kn,We=-146.407+841.88*Et-1629.014*wt+1083.435*Kn,xr=-532.114+3017.977*Et-5740.032*wt+3708.276*Kn):(yt=-72.099+331.819*Et-508.738*wt+266.724*Kn,Qt=-346.844+1582.851*Et-2415.925*wt+1246.113*Kn,Nn=-342.585+1554.908*Et-2366.899*wt+1215.972*Kn,cr=-1052.797+4758.686*Et-7193.992*wt+3651.957*Kn,We=-3581.69+16178.11*Et-24462.77*wt+12422.52*Kn,Et>.715?xr=-5149.66+29936.92*Et-54087.36*wt+31324.56*Kn:xr=1464.74-4664.75*Et+3763.64*wt),Et<.7?(fr=-919.2277+4988.61*Et-9064.77*wt+5542.21*Kn,Yn=-822.71072+4568.6173*Et-8491.4146*wt+5337.524*Kn,Zi=-853.666+4690.25*Et-8624.77*wt+5341.4*Kn):(fr=-37995.78+161616.52*Et-229838.2*wt+109377.94*Kn,Yn=-51752.104+218913.95*Et-309468.16*wt+146349.42*Kn,Zi=-40023.88+170470.89*Et-242699.48*wt+115605.82*Kn),st=R*R,He=.75*(1+2*n+Ct),Le=1.5*st,gt=1.875*R*(1-2*n-3*Ct),It=-1.875*R*(1+2*n-3*Ct),zt=35*st*He,Ce=39.375*st*st,tn=9.84375*R*(st*(1-2*n-5*Ct)+.33333333*(-2+4*n+6*Ct)),Rn=R*(4.92187512*st*(-2-4*n+10*Ct)+6.56250012*(1+2*n-3*Ct)),Rt=29.53125*R*(2-8*n+Ct*(-12+8*n+10*Ct)),Re=29.53125*R*(-2-8*n+Ct*(12+8*n-10*Ct)),Cr=Kt*Kt,ki=er*er,Bt=3*Cr*ki,At=Bt*Wi,Nt=At*He*Tt,en=At*Le*yt,Bt*=er,At=Bt*Ln,Pn=At*gt*Qt,Lt=At*It*Nn,Bt*=er,At=2*Bt*os,jt=At*zt*cr,Vt=At*Ce*We,Bt*=er,At=Bt*as,Mt=At*tn*xr,rn=At*Rn*Zi,At=2*Bt*Li,dn=At*Rt*Yn,_n=At*Re*fr,Se=(ue+fe+fe-(Ki+Ki))%zr,N=Ee+Ae+2*(pe+H-br)-be,Et=us,wt=hs}Tn===1&&(rt=1+wt*(-2.5+.8125*wt),Qt=1+2*wt,je=1+wt*(-6+6.60937*wt),He=.75*(1+n)*(1+n),tt=.9375*R*R*(1+3*n)-.75*(1+n),Ht=1+n,Ht*=1.875*Ht*Ht,K=3*Kt*Kt*er*er,de=2*K*He*rt*ci,ge=3*K*Ht*je*Kr*er,K=K*tt*Qt*Di*er,Se=(ue+fe+o-Ki)%zr,N=Ee+Jt+Ae+G+H-(be+br)),we=Se,Me=be,Dn=0,Kt=be+Fn}return{em:Et,argpm:Cn,inclm:Wt,mm:Sn,nm:Kt,nodem:or,irez:Tn,atime:Dn,d2201:Nt,d2211:en,d3210:Pn,d3222:Lt,d4410:jt,d4422:Vt,d5220:Mt,d5232:rn,d5421:dn,d5433:_n,dedt:Yt,didt:Xt,dmdt:Ae,dndt:Fn,dnodt:H,domdt:G,del1:K,del2:de,del3:ge,xfact:N,xlamo:Se,xli:we,xni:Me}}function E0(a){var n=(a-2451545)/36525,o=-62e-7*n*n*n+.093104*n*n+(876600*3600+8640184812866e-6)*n+67310.54841;return o=o*Iu/240%zr,o<0&&(o+=zr),o}function Nf(a,n,o,d,g,w,x){return a instanceof Date?E0(m_(a)):E0(a)}function rI(a){var n=a.ecco,o=a.epoch,d=a.inclo,g=a.opsmode,w=a.no,x=n*n,c=1-x,R=Math.sqrt(c),B=Math.cos(d),W=B*B,ee=Math.pow(_a/w,od),ce=.75*rc*(3*W-1)/(R*c),Ie=ce/(ee*ee),Ue=ee*(1-Ie*Ie-Ie*(1/3+134*Ie*Ie/81));Ie=ce/(Ue*Ue),w/=1+Ie;var ke=Math.pow(_a/w,od),Q=Math.sin(d),qe=ke*c,Ye=1-5*W,Ge=-Ye-W-W,ht=1/ke,ct=qe*qe,ot=ke*(1-n),xe="n",se;if(g==="a"){var ue=o-7305,Ee=Math.floor(ue+1e-8),be=ue-Ee,fe=.017202791694070362,pe=1.7321343856509375,Jt=5075514194322695e-30,fn=fe+zr;se=(pe+fe*Ee+fn*be+ue*ue*Jt)%zr,se<0&&(se+=zr)}else se=Nf(o+24332815e-1);return{no:w,method:xe,ainv:ht,ao:ke,con41:Ge,con42:Ye,cosio:B,cosio2:W,eccsq:x,omeosq:c,posq:ct,rp:ot,rteosq:R,sinio:Q,gsto:se}}function iI(a){var n=a.irez,o=a.d2201,d=a.d2211,g=a.d3210,w=a.d3222,x=a.d4410,c=a.d4422,R=a.d5220,B=a.d5232,W=a.d5421,ee=a.d5433,ce=a.dedt,Ie=a.del1,Ue=a.del2,ke=a.del3,Q=a.didt,qe=a.dmdt,Ye=a.dnodt,Ge=a.domdt,ht=a.argpo,ct=a.argpdot,ot=a.t,xe=a.tc,se=a.gsto,ue=a.xfact,Ee=a.xlamo,be=a.no,fe=a.atime,pe=a.em,Jt=a.argpm,fn=a.inclm,Ut=a.xli,$t=a.mm,mn=a.xni,Pt=a.nodem,zn=a.nm,on=.13130908,Ft=2.8843198,Gt=.37448087,Mn=5.7686396,wt=.95240898,Et=1.8014998,Cn=1.050833,Wt=4.4108898,Sn=.0043752690880113,Kt=720,or=-720,Tn=259200,Dn,Nt,en,Pn,Lt,jt,Vt,Mt,rn=0,dn=0,_n=(se+xe*Sn)%zr;if(pe+=ce*ot,fn+=Q*ot,Jt+=Ge*ot,Pt+=Ye*ot,$t+=qe*ot,n!==0){(fe===0||ot*fe<=0||Math.abs(ot)<Math.abs(fe))&&(fe=0,mn=be,Ut=Ee),ot>0?Dn=Kt:Dn=or;for(var Yt=381;Yt===381;)n!==2?(Vt=Ie*Math.sin(Ut-on)+Ue*Math.sin(2*(Ut-Ft))+ke*Math.sin(3*(Ut-Gt)),Lt=mn+ue,jt=Ie*Math.cos(Ut-on)+2*Ue*Math.cos(2*(Ut-Ft))+3*ke*Math.cos(3*(Ut-Gt)),jt*=Lt):(Mt=ht+ct*fe,en=Mt+Mt,Nt=Ut+Ut,Vt=o*Math.sin(en+Ut-Mn)+d*Math.sin(Ut-Mn)+g*Math.sin(Mt+Ut-wt)+w*Math.sin(-Mt+Ut-wt)+x*Math.sin(en+Nt-Et)+c*Math.sin(Nt-Et)+R*Math.sin(Mt+Ut-Cn)+B*Math.sin(-Mt+Ut-Cn)+W*Math.sin(Mt+Nt-Wt)+ee*Math.sin(-Mt+Nt-Wt),Lt=mn+ue,jt=o*Math.cos(en+Ut-Mn)+d*Math.cos(Ut-Mn)+g*Math.cos(Mt+Ut-wt)+w*Math.cos(-Mt+Ut-wt)+R*Math.cos(Mt+Ut-Cn)+B*Math.cos(-Mt+Ut-Cn)+2*(x*Math.cos(en+Nt-Et)+c*Math.cos(Nt-Et)+W*Math.cos(Mt+Nt-Wt)+ee*Math.cos(-Mt+Nt-Wt)),jt*=Lt),Math.abs(ot-fe)>=Kt?Yt=381:(dn=ot-fe,Yt=0),Yt===381&&(Ut+=Lt*Dn+Vt*Tn,mn+=Vt*Dn+jt*Tn,fe+=Dn);zn=mn+Vt*dn+jt*dn*dn*.5,Pn=Ut+Lt*dn+Vt*dn*dn*.5,n!==1?($t=Pn-2*Pt+2*_n,rn=zn-be):($t=Pn-Pt-Jt+_n,rn=zn-be),zn=be+rn}return{atime:fe,em:pe,argpm:Jt,inclm:fn,xli:Ut,mm:$t,xni:mn,nodem:Pt,dndt:rn,nm:zn}}var Ya;(function(a){a[a.None=0]="None",a[a.MeanEccentricityOutOfRange=1]="MeanEccentricityOutOfRange",a[a.MeanMotionBelowZero=2]="MeanMotionBelowZero",a[a.PerturbedEccentricityOutOfRange=3]="PerturbedEccentricityOutOfRange",a[a.SemiLatusRectumBelowZero=4]="SemiLatusRectumBelowZero",a[a.Decayed=6]="Decayed"})(Ya||(Ya={}));function Eb(a,n){var o,d,g,w,x,c,R,B,W,ee,ce,Ie,Ue,ke,Q,qe,Ye,Ge,ht,ct,ot,xe,se,ue,Ee,be,fe,pe=15e-13;a.t=n,a.error=Ya.None;var Jt=a.mo+a.mdot*a.t,fn=a.argpo+a.argpdot*a.t,Ut=a.nodeo+a.nodedot*a.t;W=fn,ot=Jt;var $t=a.t*a.t;if(se=Ut+a.nodecf*$t,Ye=1-a.cc1*a.t,Ge=a.bstar*a.cc4*a.t,ht=a.t2cof*$t,a.isimp!==1){R=a.omgcof*a.t;var mn=1+a.eta*Math.cos(Jt);c=a.xmcof*(mn*mn*mn-a.delmo),qe=R+c,ot=Jt+qe,W=fn-qe,Ie=$t*a.t,Ue=Ie*a.t,Ye=Ye-a.d2*$t-a.d3*Ie-a.d4*Ue,Ge+=a.bstar*a.cc5*(Math.sin(ot)-a.sinmao),ht=ht+a.t3cof*Ie+Ue*(a.t4cof+a.t*a.t5cof)}xe=a.no;var Pt=a.ecco;if(ct=a.inclo,a.method==="d"){ke=a.t;var zn={irez:a.irez,d2201:a.d2201,d2211:a.d2211,d3210:a.d3210,d3222:a.d3222,d4410:a.d4410,d4422:a.d4422,d5220:a.d5220,d5232:a.d5232,d5421:a.d5421,d5433:a.d5433,dedt:a.dedt,del1:a.del1,del2:a.del2,del3:a.del3,didt:a.didt,dmdt:a.dmdt,dnodt:a.dnodt,domdt:a.domdt,argpo:a.argpo,argpdot:a.argpdot,t:a.t,tc:ke,gsto:a.gsto,xfact:a.xfact,xlamo:a.xlamo,no:a.no,atime:a.atime,em:Pt,argpm:W,inclm:ct,xli:a.xli,mm:ot,xni:a.xni,nodem:se,nm:xe},on=iI(zn);Pt=on.em,W=on.argpm,ct=on.inclm,ot=on.mm,se=on.nodem,xe=on.nm}if(xe<=0)return a.error=Ya.MeanMotionBelowZero,null;var Ft=Math.pow(_a/xe,od)*Ye*Ye;if(xe=_a/Math.pow(Ft,1.5),Pt-=Ge,Pt>=1||Pt<-.001)return a.error=Ya.MeanEccentricityOutOfRange,null;Pt<1e-6&&(Pt=1e-6),ot+=a.no*ht,Ee=ot+W+se,se%=zr,W%=zr,Ee%=zr,ot=(Ee-W-se)%zr;var Gt={am:Ft,em:Pt,im:ct,Om:se,om:W,mm:ot,nm:xe},Mn=Math.sin(ct),wt=Math.cos(ct),Et=Pt;if(ue=ct,ee=W,fe=se,be=ot,w=Mn,g=wt,a.method==="d"){var Cn={inclo:a.inclo,init:"n",ep:Et,inclp:ue,nodep:fe,argpp:ee,mp:be,opsmode:a.operationmode},Wt=Tb(a,Cn);if(Et=Wt.ep,fe=Wt.nodep,ee=Wt.argpp,be=Wt.mp,ue=Wt.inclp,ue<0&&(ue=-ue,fe+=Mi,ee-=Mi),Et<0||Et>1)return a.error=Ya.PerturbedEccentricityOutOfRange,null}a.method==="d"&&(w=Math.sin(ue),g=Math.cos(ue),a.aycof=-.5*ic*w,Math.abs(g+1)>15e-13?a.xlcof=-.25*ic*w*(3+5*g)/(1+g):a.xlcof=-.25*ic*w*(3+5*g)/pe);var Sn=Et*Math.cos(ee);qe=1/(Ft*(1-Et*Et));var Kt=Et*Math.sin(ee)+qe*a.aycof,or=be+ee+fe+qe*a.xlcof*Sn,Tn=(or-fe)%zr;B=Tn,Q=9999.9;for(var Dn=1;Math.abs(Q)>=1e-12&&Dn<=10;)d=Math.sin(B),o=Math.cos(B),Q=1-o*Sn-d*Kt,Q=(Tn-Kt*o+Sn*d-B)/Q,Math.abs(Q)>=.95&&(Q>0?Q=.95:Q=-.95),B+=Q,Dn+=1;var Nt=Sn*o+Kt*d,en=Sn*d-Kt*o,Pn=Sn*Sn+Kt*Kt,Lt=Ft*(1-Pn);if(Lt<0)return a.error=Ya.SemiLatusRectumBelowZero,null;var jt=Ft*(1-Nt),Vt=Math.sqrt(Ft)*en/jt,Mt=Math.sqrt(Lt)/jt,rn=Math.sqrt(1-Pn);qe=en/(1+rn);var dn=Ft/jt*(d-Kt-Sn*qe),_n=Ft/jt*(o-Sn+Kt*qe);ce=Math.atan2(dn,_n);var Yt=(_n+_n)*dn,Xt=1-2*dn*dn;qe=1/Lt;var Ae=.5*rc*qe,H=Ae*qe;a.method==="d"&&(x=g*g,a.con41=3*x-1,a.x1mth2=1-x,a.x7thm1=7*x-1);var G=jt*(1-1.5*H*rn*a.con41)+.5*Ae*a.x1mth2*Xt;if(G<1)return a.error=Ya.Decayed,null;ce-=.25*H*a.x7thm1*Yt;var K=fe+1.5*H*g*Yt,de=ue+1.5*H*g*w*Xt,ge=Vt-xe*Ae*a.x1mth2*Yt/_a,N=Mt+xe*Ae*(a.x1mth2*Xt+1.5*a.con41)/_a,Se=Math.sin(ce),we=Math.cos(ce),Me=Math.sin(K),He=Math.cos(K),Le=Math.sin(de),tt=Math.cos(de),gt=-Me*tt,It=He*tt,Ht=gt*Se+He*we,zt=It*Se+Me*we,Ce=Le*Se,tn=gt*we-He*Se,Rn=It*we-Me*Se,Rt=Le*we,Re={x:G*Ht*zs,y:G*zt*zs,z:G*Ce*zs},rt={x:(ge*Ht+N*tn)*Tg,y:(ge*zt+N*Rn)*Tg,z:(ge*Ce+N*Rt)*Tg};return{position:Re,velocity:rt,meanElements:Gt}}function sI(a,n){var o=n.opsmode,d=n.epoch,g=n.xbstar,w=n.xecco,x=n.xargpo,c=n.xinclo,R=n.xmo,B=n.xno,W=n.xnodeo,ee,ce,Ie,Ue,ke,Q,qe,Ye,Ge,ht,ct,ot,xe,se,ue,Ee,be,fe,pe,Jt,fn,Ut,$t,mn,Pt,zn,on,Ft,Gt,Mn,wt,Et,Cn,Wt,Sn,Kt,or,Tn,Dn,Nt,en,Pn,Lt,jt,Vt,Mt,rn,dn,_n,Yt,Xt,Ae,H,G,K,de,ge=15e-13,N=a;N.isimp=0,N.method="n",N.aycof=0,N.con41=0,N.cc1=0,N.cc4=0,N.cc5=0,N.d2=0,N.d3=0,N.d4=0,N.delmo=0,N.eta=0,N.argpdot=0,N.omgcof=0,N.sinmao=0,N.t=0,N.t2cof=0,N.t3cof=0,N.t4cof=0,N.t5cof=0,N.x1mth2=0,N.x7thm1=0,N.mdot=0,N.nodedot=0,N.xlcof=0,N.xmcof=0,N.nodecf=0,N.irez=0,N.d2201=0,N.d2211=0,N.d3210=0,N.d3222=0,N.d4410=0,N.d4422=0,N.d5220=0,N.d5232=0,N.d5421=0,N.d5433=0,N.dedt=0,N.del1=0,N.del2=0,N.del3=0,N.didt=0,N.dmdt=0,N.dnodt=0,N.domdt=0,N.e3=0,N.ee2=0,N.peo=0,N.pgho=0,N.pho=0,N.pinco=0,N.plo=0,N.se2=0,N.se3=0,N.sgh2=0,N.sgh3=0,N.sgh4=0,N.sh2=0,N.sh3=0,N.si2=0,N.si3=0,N.sl2=0,N.sl3=0,N.sl4=0,N.gsto=0,N.xfact=0,N.xgh2=0,N.xgh3=0,N.xgh4=0,N.xh2=0,N.xh3=0,N.xi2=0,N.xi3=0,N.xl2=0,N.xl3=0,N.xl4=0,N.xlamo=0,N.zmol=0,N.zmos=0,N.atime=0,N.xli=0,N.xni=0,N.bstar=g,N.ecco=w,N.argpo=x,N.inclo=c,N.mo=R,N.no=B,N.nodeo=W,N.operationmode=o;var Se=78/zs+1,we=42/zs,Me=we*we*we*we;N.init="y",N.t=0;var He={ecco:N.ecco,epoch:d,inclo:N.inclo,no:N.no,method:N.method,opsmode:N.operationmode},Le=rI(He),tt=Le.ao,gt=Le.con42,It=Le.cosio,Ht=Le.cosio2,zt=Le.eccsq,Ce=Le.omeosq,tn=Le.posq,Rn=Le.rp,Rt=Le.rteosq,Re=Le.sinio;if(N.no=Le.no,N.con41=Le.con41,N.gsto=Le.gsto,N.a=Math.pow(N.no*XE,-2/3),N.alta=N.a*(1+N.ecco)-1,N.altp=N.a*(1-N.ecco)-1,N.error=0,Ce>=0||N.no>=0){if(N.isimp=0,Rn<220/zs+1&&(N.isimp=1),on=Se,fn=Me,fe=(Rn-1)*zs,fe<156){on=fe-78,fe<98&&(on=20);var rt=(120-on)/zs;fn=rt*rt*rt*rt,on=on/zs+1}pe=1/tn,Mt=1/(tt-on),N.eta=tt*N.ecco*Mt,ot=N.eta*N.eta,ct=N.ecco*N.eta,Jt=Math.abs(1-ot),Q=fn*Math.pow(Mt,4),qe=Q/Math.pow(Jt,3.5),Ue=qe*N.no*(tt*(1+1.5*ot+ct*(4+ot))+.375*rc*Mt/Jt*N.con41*(8+3*ot*(8+ot))),N.cc1=N.bstar*Ue,ke=0,N.ecco>1e-4&&(ke=-2*Q*Mt*ic*N.no*Re/N.ecco),N.x1mth2=1-Ht,N.cc4=2*N.no*qe*tt*Ce*(N.eta*(2+.5*ot)+N.ecco*(.5+2*ot)-rc*Mt/(tt*Jt)*(-3*N.con41*(1-2*ct+ot*(1.5-.5*ct))+.75*N.x1mth2*(2*ot-ct*(1+ot))*Math.cos(2*N.argpo))),N.cc5=2*qe*tt*Ce*(1+2.75*(ot+ct)+ct*ot),Ye=Ht*Ht,Lt=1.5*rc*pe*N.no,jt=.5*Lt*rc*pe,Vt=-.46875*QE*pe*pe*N.no,N.mdot=N.no+.5*Lt*Rt*N.con41+.0625*jt*Rt*(13-78*Ht+137*Ye),N.argpdot=-.5*Lt*gt+.0625*jt*(7-114*Ht+395*Ye)+Vt*(3-36*Ht+49*Ye),dn=-Lt*It,N.nodedot=dn+(.5*jt*(4-19*Ht)+2*Vt*(3-7*Ht))*It,rn=N.argpdot+N.nodedot,N.omgcof=N.bstar*ke*Math.cos(N.argpo),N.xmcof=0,N.ecco>1e-4&&(N.xmcof=-od*Q*N.bstar/ct),N.nodecf=3.5*Ce*dn*N.cc1,N.t2cof=1.5*N.cc1,Math.abs(It+1)>15e-13?N.xlcof=-.25*ic*Re*(3+5*It)/(1+It):N.xlcof=-.25*ic*Re*(3+5*It)/ge,N.aycof=-.5*ic*Re;var Tt=1+N.eta*Math.cos(N.mo);if(N.delmo=Tt*Tt*Tt,N.sinmao=Math.sin(N.mo),N.x7thm1=7*Ht-1,2*Mi/N.no>=225){N.method="d",N.isimp=1,en=0,ue=N.inclo;var yt={epoch:d,ep:N.ecco,argpp:N.argpo,tc:en,inclp:N.inclo,nodep:N.nodeo,np:N.no,e3:N.e3,ee2:N.ee2,peo:N.peo,pgho:N.pgho,pho:N.pho,pinco:N.pinco,plo:N.plo,se2:N.se2,se3:N.se3,sgh2:N.sgh2,sgh3:N.sgh3,sgh4:N.sgh4,sh2:N.sh2,sh3:N.sh3,si2:N.si2,si3:N.si3,sl2:N.sl2,sl3:N.sl3,sl4:N.sl4,xgh2:N.xgh2,xgh3:N.xgh3,xgh4:N.xgh4,xh2:N.xh2,xh3:N.xh3,xi2:N.xi2,xi3:N.xi3,xl2:N.xl2,xl3:N.xl3,xl4:N.xl4,zmol:N.zmol,zmos:N.zmos},je=tI(yt);N.e3=je.e3,N.ee2=je.ee2,N.peo=je.peo,N.pgho=je.pgho,N.pho=je.pho,N.pinco=je.pinco,N.plo=je.plo,N.se2=je.se2,N.se3=je.se3,N.sgh2=je.sgh2,N.sgh3=je.sgh3,N.sgh4=je.sgh4,N.sh2=je.sh2,N.sh3=je.sh3,N.si2=je.si2,N.si3=je.si3,N.sl2=je.sl2,N.sl3=je.sl3,N.sl4=je.sl4,ce=je.sinim,ee=je.cosim,Ge=je.em,ht=je.emsq,Ut=je.s1,$t=je.s2,mn=je.s3,Pt=je.s4,zn=je.s5,Ft=je.ss1,Gt=je.ss2,Mn=je.ss3,wt=je.ss4,Et=je.ss5,Cn=je.sz1,Wt=je.sz3,Sn=je.sz11,Kt=je.sz13,or=je.sz21,Tn=je.sz23,Dn=je.sz31,Nt=je.sz33,N.xgh2=je.xgh2,N.xgh3=je.xgh3,N.xgh4=je.xgh4,N.xh2=je.xh2,N.xh3=je.xh3,N.xi2=je.xi2,N.xi3=je.xi3,N.xl2=je.xl2,N.xl3=je.xl3,N.xl4=je.xl4,N.zmol=je.zmol,N.zmos=je.zmos,be=je.nm,_n=je.z1,Yt=je.z3,Xt=je.z11,Ae=je.z13,H=je.z21,G=je.z23,K=je.z31,de=je.z33;var Qt={inclo:ue,init:N.init,ep:N.ecco,inclp:N.inclo,nodep:N.nodeo,argpp:N.argpo,mp:N.mo,opsmode:N.operationmode},Nn=Tb(N,Qt);N.ecco=Nn.ep,N.inclo=Nn.inclp,N.nodeo=Nn.nodep,N.argpo=Nn.argpp,N.mo=Nn.mp,xe=0,se=0,Ee=0;var cr={cosim:ee,emsq:ht,argpo:N.argpo,s1:Ut,s2:$t,s3:mn,s4:Pt,s5:zn,sinim:ce,ss1:Ft,ss2:Gt,ss3:Mn,ss4:wt,ss5:Et,sz1:Cn,sz3:Wt,sz11:Sn,sz13:Kt,sz21:or,sz23:Tn,sz31:Dn,sz33:Nt,t:N.t,tc:en,gsto:N.gsto,mo:N.mo,mdot:N.mdot,no:N.no,nodeo:N.nodeo,nodedot:N.nodedot,xpidot:rn,z1:_n,z3:Yt,z11:Xt,z13:Ae,z21:H,z23:G,z31:K,z33:de,ecco:N.ecco,eccsq:zt,em:Ge,argpm:xe,inclm:ue,mm:Ee,nm:be,nodem:se,irez:N.irez,atime:N.atime,d2201:N.d2201,d2211:N.d2211,d3210:N.d3210,d3222:N.d3222,d4410:N.d4410,d4422:N.d4422,d5220:N.d5220,d5232:N.d5232,d5421:N.d5421,d5433:N.d5433,dedt:N.dedt,didt:N.didt,dmdt:N.dmdt,dnodt:N.dnodt,domdt:N.domdt,del1:N.del1,del2:N.del2,del3:N.del3,xfact:N.xfact,xlamo:N.xlamo,xli:N.xli,xni:N.xni},We=nI(cr);N.irez=We.irez,N.atime=We.atime,N.d2201=We.d2201,N.d2211=We.d2211,N.d3210=We.d3210,N.d3222=We.d3222,N.d4410=We.d4410,N.d4422=We.d4422,N.d5220=We.d5220,N.d5232=We.d5232,N.d5421=We.d5421,N.d5433=We.d5433,N.dedt=We.dedt,N.didt=We.didt,N.dmdt=We.dmdt,N.dnodt=We.dnodt,N.domdt=We.domdt,N.del1=We.del1,N.del2=We.del2,N.del3=We.del3,N.xfact=We.xfact,N.xlamo=We.xlamo,N.xli=We.xli,N.xni=We.xni}N.isimp!==1&&(Ie=N.cc1*N.cc1,N.d2=4*tt*Mt*Ie,Pn=N.d2*Mt*N.cc1/3,N.d3=(17*tt+on)*Pn,N.d4=.5*Pn*tt*Mt*(221*tt+31*on)*N.cc1,N.t3cof=N.d2+2*Ie,N.t4cof=.25*(3*N.d3+N.cc1*(12*N.d2+10*Ie)),N.t5cof=.2*(3*N.d4+12*N.cc1*N.d3+6*N.d2*N.d2+15*Ie*(2*N.d2+Ie)))}Eb(N,0),N.init="n"}function g_(a,n){var o="i",d=0,g=a.substring(2,7),w=parseInt(a.substring(18,20),10),x=parseFloat(a.substring(20,32)),c=parseFloat(a.substring(33,43)),R=parseFloat("".concat(a.substring(44,45),".").concat(a.substring(45,50),"E").concat(a.substring(50,52))),B=parseFloat("".concat(a.substring(53,54),".").concat(a.substring(54,59),"E").concat(a.substring(59,61))),W=parseFloat(n.substring(8,16))*Iu,ee=parseFloat(n.substring(17,25))*Iu,ce=parseFloat(".".concat(n.substring(26,33))),Ie=parseFloat(n.substring(34,42))*Iu,Ue=parseFloat(n.substring(43,51))*Iu,ke=parseFloat(n.substring(52,63))/JE,Q=w<57?w+2e3:w+1900,qe=eI(Q,x),Ye=qe.mon,Ge=qe.day,ht=qe.hr,ct=qe.minute,ot=qe.sec,xe=m_(Q,Ye,Ge,ht,ct,ot),se={error:d,satnum:g,epochyr:w,epochdays:x,ndot:c,nddot:R,bstar:B,inclo:W,nodeo:ee,ecco:ce,argpo:Ie,mo:Ue,no:ke,jdsatepoch:xe};return sI(se,{opsmode:o,satn:se.satnum,epoch:se.jdsatepoch-24332815e-1,xbstar:se.bstar,xecco:se.ecco,xargpo:se.argpo,xinclo:se.inclo,xmo:se.mo,xno:se.no,xnodeo:se.nodeo}),se}function __(a){for(var n=arguments.length,o=new Array(n>1?n-1:0),d=1;d<n;d++)o[d-1]=arguments[d];var g=m_.apply(void 0,o),w=(g-a.jdsatepoch)*WE;return Eb(a,w)}function Ib(a){return a*ZE}function I0(a){return a*Iu}function Sb(a){if(a<-Mi/2||a>Mi/2)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return Ib(a)}function Pb(a){if(a<-Mi||a>Mi)throw new RangeError("Longitude radians must be in range [-pi; pi].");return Ib(a)}function oI(a){var n=a.longitude,o=a.latitude,d=a.height,g=6378.137,w=6356.7523142,x=(g-w)/g,c=2*x-x*x,R=g/Math.sqrt(1-c*(Math.sin(o)*Math.sin(o))),B=(R+d)*Math.cos(o)*Math.cos(n),W=(R+d)*Math.cos(o)*Math.sin(n),ee=(R*(1-c)+d)*Math.sin(o);return{x:B,y:W,z:ee}}function Ab(a,n){for(var o=6378.137,d=6356.7523142,g=Math.sqrt(a.x*a.x+a.y*a.y),w=(o-d)/o,x=2*w-w*w,c=Math.atan2(a.y,a.x)-n;c<-Mi;)c+=zr;for(;c>Mi;)c-=zr;for(var R=20,B=0,W=Math.atan2(a.z,Math.sqrt(a.x*a.x+a.y*a.y)),ee;B++<R;)ee=1/Math.sqrt(1-x*(Math.sin(W)*Math.sin(W))),W=Math.atan2(a.z+o*ee*x*Math.sin(W),g);var ce=g/Math.cos(W)-o*ee;return{longitude:c,latitude:W,height:ce}}function aI(a,n){var o=a.x*Math.cos(n)+a.y*Math.sin(n),d=a.x*-Math.sin(n)+a.y*Math.cos(n),g=a.z;return{x:o,y:d,z:g}}function lI(a,n){var o=a.longitude,d=a.latitude,g=oI(a),w=n.x-g.x,x=n.y-g.y,c=n.z-g.z,R=Math.sin(d)*Math.cos(o)*w+Math.sin(d)*Math.sin(o)*x-Math.cos(d)*c,B=-Math.sin(o)*w+Math.cos(o)*x,W=Math.cos(d)*Math.cos(o)*w+Math.cos(d)*Math.sin(o)*x+Math.sin(d)*c;return{topS:R,topE:B,topZ:W}}function cI(a){var n=a.topS,o=a.topE,d=a.topZ,g=Math.sqrt(n*n+o*o+d*d),w=Math.asin(d/g),x=Math.atan2(-o,n)+Mi;return{azimuth:x,elevation:w,rangeSat:g}}function uI(a,n){var o=lI(a,n);return cI(o)}const Cb="iss_tle_cache_v1",hI="https://celestrak.org/NORAD/elements/gp.php?CATNR=25544&FORMAT=TLE",dI=6*60*60*1e3;function pI(){try{const a=localStorage.getItem(Cb);return a?JSON.parse(a):null}catch{return null}}function fI(a,n){try{localStorage.setItem(Cb,JSON.stringify({line1:a,line2:n,ts:Date.now()}))}catch{}}function mI(a){const n=String(a).split(`
`).map(o=>o.trim()).filter(Boolean);if(n.length>=2){const o=n[n.length-1];return{line1:n[n.length-2],line2:o}}throw new Error("TLE parse failed")}async function y_({force:a=!1}={}){const n=pI(),o=Date.now();if(!a&&(n!=null&&n.line1)&&(n!=null&&n.line2)&&(n!=null&&n.ts)&&o-n.ts<dI)return{line1:n.line1,line2:n.line2,fromCache:!0};try{const d=await fetch(hI,{cache:"no-store"});if(!d.ok)throw new Error("TLE fetch failed");const g=await d.text(),{line1:w,line2:x}=mI(g);return fI(w,x),{line1:w,line2:x,fromCache:!1}}catch(d){if(n!=null&&n.line1&&(n!=null&&n.line2))return{line1:n.line1,line2:n.line2,fromCache:!0,stale:!0};throw d}}function S0(a){return a*180/Math.PI}function gI(a,n,o,d,g){const w=__(a,g);if(!w.position)return null;const x=Nf(g),c=aI(w.position,x),R={latitude:I0(n),longitude:I0(o),height:d},B=uI(R,c);return{elevation:S0(B.elevation),azimuth:S0(B.azimuth)}}function _I({satrec:a,obsLat:n,obsLon:o,startMs:d,endMs:g,stepMs:w}){let c=!1,R=null,B=null,W=null,ee=null,ce=-999,Ie=null;const Ue=[];for(let ke=d;ke<=g;ke+=w){const Q=gI(a,n,o,0,new Date(ke));if(!Q)continue;const qe=Q.elevation,Ye=Q.azimuth,Ge=qe>0;if(!c&&Ge&&(c=!0,R=ke,B=Ye,ce=qe,Ie=ke),c&&(qe>ce&&(ce=qe,Ie=ke),!Ge)){W=ke,ee=Ye;const ht={aosMs:R,losMs:W,aosAz:B,losAz:ee,maxMs:Ie||R,maxElev:Math.max(0,ce),visible:ce>=In.MIN_ELEVATION};Ue.push(ht),c=!1,R=null,B=null,W=null,ee=null,ce=-999,Ie=null}}return c&&Ue.push({aosMs:R,losMs:g,aosAz:B,losAz:0,maxMs:Ie||R,maxElev:Math.max(0,ce),visible:ce>=In.MIN_ELEVATION}),Ue}async function yI({obsLat:a,obsLon:n}){const{line1:o,line2:d}=await y_(),g=g_(o,d),w=Date.now(),x=w+36*60*60*1e3,c=10*1e3,R=_I({satrec:g,obsLat:a,obsLon:n,startMs:w,endMs:x,stepMs:c}),B=R.length?R[0]:null,W=R.find(ee=>ee.visible)||null;return{nextPass:B,nextVisiblePass:W}}async function vI({pastMinutes:a=45,futureMinutes:n=90,stepSeconds:o=60}={}){const{line1:d,line2:g}=await y_(),w=g_(d,g),x=new Date,c=[],R=[];for(let W=a*60;W>=0;W-=o){const ee=new Date(x.getTime()-W*1e3),ce=Eg(w,ee);ce&&c.push(ce)}for(let W=o;W<=n*60;W+=o){const ee=new Date(x.getTime()+W*1e3),ce=Eg(w,ee);ce&&R.push(ce)}const B=Eg(w,x);return console.log(`[Trajectory] Calculated: ${c.length} past, ${R.length} future points`),{past:c,future:R,current:B}}function Eg(a,n){try{const o=__(a,n);if(!o.position)return null;const d=Nf(n),g=Ab(o.position,d),w=Sb(g.latitude);let x=Pb(g.longitude);for(;x>180;)x-=360;for(;x<-180;)x+=360;return{lat:w,lng:x,alt:g.height,time:n.getTime()}}catch(o){return console.warn("[Trajectory] Propagation error:",o),null}}function xI(a){if(!a||a.length<2)return[];const n=[];let o=[[a[0].lng,a[0].lat]];for(let d=1;d<a.length;d++){const g=a[d-1],w=a[d];Math.abs(w.lng-g.lng)>180?(o.length>1&&n.push(o),o=[[w.lng,w.lat]]):o.push([w.lng,w.lat])}return o.length>1&&n.push(o),n}function P0(a){const n=xI(a);return n.length===0?{type:"Feature",geometry:{type:"MultiLineString",coordinates:[]}}:n.length===1?{type:"Feature",geometry:{type:"LineString",coordinates:n[0]}}:{type:"Feature",geometry:{type:"MultiLineString",coordinates:n}}}const bI="https://api.wheretheiss.at/v1/satellites/25544",wI="http://api.open-notify.org/iss-now.json";function Vf(a,n){return{lat:Number(a.lat),lon:Number(a.lon),altKm:Number(a.altKm||408),velKmh:Number(a.velKmh||27580),source:n,ts:Date.now()}}async function TI(){const a=new AbortController,n=setTimeout(()=>a.abort(),5e3);try{const o=await fetch(bI,{cache:"no-store",signal:a.signal});if(clearTimeout(n),!o.ok)throw new Error(`HTTP ${o.status}`);const d=await o.json();return Vf({lat:d.latitude,lon:d.longitude,altKm:d.altitude,velKmh:d.velocity},"wheretheiss")}catch(o){throw clearTimeout(n),new Error(`Primary failed: ${o.message}`)}}async function EI(){const a=new AbortController,n=setTimeout(()=>a.abort(),5e3);try{const o=await fetch(wI,{cache:"no-store",signal:a.signal});if(clearTimeout(n),!o.ok)throw new Error(`HTTP ${o.status}`);const d=await o.json();if(d.message!=="success")throw new Error("API returned failure");return Vf({lat:d.iss_position.latitude,lon:d.iss_position.longitude},"open-notify")}catch(o){throw clearTimeout(n),new Error(`Secondary failed: ${o.message}`)}}async function II(){try{const{line1:a,line2:n}=await y_(),o=g_(a,n),d=new Date,g=__(o,d);if(!g.position)throw new Error("SGP4 propagation failed");const w=Nf(d),x=Ab(g.position,w),c=Sb(x.latitude),R=Pb(x.longitude),B=x.height;return Vf({lat:c,lon:R,altKm:B},"tle-sgp4")}catch(a){throw new Error(`Tertiary failed: ${a.message}`)}}async function SI(){try{const a=await TI();return console.log("[ISS]  Primary API success"),a}catch(a){console.warn("[ISS]  Primary failed:",a.message);try{const n=await EI();return console.log("[ISS]  Secondary API success"),n}catch(n){console.warn("[ISS]  Secondary failed:",n.message);try{const o=await II();return console.log("[ISS]  Tertiary (TLE) success"),o}catch{return console.error("[ISS]  CRITICAL: All data streams failed. Switching to SIMULATION."),Vf(PI(),"simulation")}}}}function PI(){const a=Date.now(),n=a/1e3/5560*(Math.PI*2),o=Math.sin(n)*51.6,d=a/1e3/10%360-180;return{lat:o,lon:d,altKm:420+Math.sin(a/1e4)*10,velKmh:27580+Math.cos(a/1e4)*50,source:"simulation"}}const Qa={smoothFactor:.06,dataInterval:3e3,positionThreshold:.001};let ho={lat:0,lng:0,alt:408},ji={lat:0,lng:0,alt:408},A0=null,Ug=!1,jg=null,qg=null;function AI(a,n,o){let d=n-a;d>180&&(d-=360),d<-180&&(d+=360);let g=a+d*o;return g>180&&(g-=360),g<-180&&(g+=360),g}function C0(a,n,o){return a+(n-a)*o}async function M0(){try{const a=await SI();a?(ho.lat=a.lat,ho.lng=a.lon,ho.alt=a.altKm||408,A0||(ji.lat=ho.lat,ji.lng=ho.lng,ji.alt=ho.alt),A0={...a},qg&&qg(a),console.log(`[Motion]  Target updated: ${ho.lat.toFixed(4)}, ${ho.lng.toFixed(4)} [${a.source}]`)):console.warn("[Motion]  No data received, keeping last position")}catch(a){console.error("[Motion] Data fetch error:",a)}}function Mb(){if(!Ug)return;const a=ji.lat,n=ji.lng;ji.lat=C0(ji.lat,ho.lat,Qa.smoothFactor),ji.lng=AI(ji.lng,ho.lng,Qa.smoothFactor),ji.alt=C0(ji.alt,ho.alt,Qa.smoothFactor),(Math.abs(ji.lat-a)>Qa.positionThreshold||Math.abs(ji.lng-n)>Qa.positionThreshold)&&jg&&jg({lat:ji.lat,lng:ji.lng,alt:ji.alt}),requestAnimationFrame(Mb)}function R0({onPosition:a,onData:n}={}){if(Ug){console.warn("[Motion] Already running");return}jg=a||null,qg=n||null,Ug=!0,console.log("[Motion]  Starting ISS motion system"),console.log(`[Motion] Config: smoothFactor=${Qa.smoothFactor}, interval=${Qa.dataInterval}ms`),M0(),setInterval(M0,Qa.dataInterval),requestAnimationFrame(Mb)}function k0(a,n){const o=document.createElement(a);return n&&(o.className=n),o}const Rb="isshub:view_mode";function CI(){return localStorage.getItem(Rb)==="3d"?"3d":"2d"}function MI({initialMode:a="2d",onChange:n}={}){try{const c=document.getElementById("isshub-viewmode-toggle");c&&c.remove()}catch{}const o=k0("div","view-toggle glass");o.id="isshub-viewmode-toggle",o.style.position="fixed",o.style.right="16px",o.style.bottom="56px",o.style.zIndex="1300";const d=k0("button","btn btn-primary view-mode-btn");d.type="button",d.style.cssText=`
    width: 44px;
    height: 44px;
    border-radius: 50%;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
  `,o.appendChild(d);let g=a==="3d"?"3d":"2d";function w(){const c=`
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>`,R=`
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>`,B=g==="3d"?"Switch to 2D Map":"Switch to 3D Globe";d.innerHTML=g==="3d"?c:R,d.title=g==="3d"?"2D Map":"3D Globe",d.setAttribute("aria-label",B)}function x(c){g=c==="3d"?"3d":"2d";try{localStorage.setItem(Rb,g)}catch{}w(),typeof n=="function"&&n(g)}return d.addEventListener("click",c=>{c.preventDefault(),x(g==="3d"?"2d":"3d")}),w(),{el:o,getMode:()=>g,setMode:x}}function $p(a,n){const o=document.createElement(a);return n&&(o.className=n),o}function RI(){const a=$p("div","weather-badge glass");a.style.position="fixed",a.style.left="16px",a.style.bottom="16px",a.style.zIndex="25",a.style.padding="10px 12px",a.style.minWidth="220px";const n=$p("div","weather-title");n.textContent="Hava durumu";const o=$p("div","weather-line");o.textContent="";const d=$p("div","weather-line muted");d.textContent="",a.append(n,o,d);function g({placeLabel:w,tempC:x,windKmh:c,codeLabel:R,timeLabel:B}={}){const W=w?` ${w}`:"",ee=Number.isFinite(x)?`${Math.round(x)}C`:"",ce=Number.isFinite(c)?`${Math.round(c)} km/h`:"";o.textContent=`${ee} ${R?`(${R})`:""} ${W}`.trim(),d.textContent=`Rzgar: ${ce}${B?`  ${B}`:""}`}return{el:a,setState:g}}const kI=6e4;let D0=null,L0=0,Ig=null;async function DI({lat:a,lon:n}={}){if(!Number.isFinite(a)||!Number.isFinite(n))throw new Error("WEATHER_BAD_COORDS");const o=`${a.toFixed(2)},${n.toFixed(2)}`,d=Date.now();if(o===D0&&Ig&&d-L0<kI)return Ig;const g=new URL("https://api.open-meteo.com/v1/forecast");g.searchParams.set("latitude",String(a)),g.searchParams.set("longitude",String(n)),g.searchParams.set("current","temperature_2m,wind_speed_10m,weather_code"),g.searchParams.set("timezone","auto");const w=await fetch(g,{cache:"no-store"});if(!w.ok)throw new Error("WEATHER_API_FAIL");const x=await w.json(),c=x==null?void 0:x.current,R={tempC:Number(c==null?void 0:c.temperature_2m),windKmh:Number(c==null?void 0:c.wind_speed_10m),code:Number(c==null?void 0:c.weather_code),timeIso:typeof(c==null?void 0:c.time)=="string"?c.time:null};return D0=o,L0=d,Ig=R,R}function LI(a){const n=Number(a);return Number.isFinite(n)?n===0?"Ak":n===1?"ounlukla ak":n===2?"Paral bulutlu":n===3?"Kapal":n===45||n===48?"Sis":n>=51&&n<=57?"ise":n>=61&&n<=67?"Yamur":n>=71&&n<=77?"Kar":n>=80&&n<=82?"Saanak":n>=85&&n<=86?"Kar saana":n>=95&&n<=99?"Frtna":`Kod ${n}`:""}const zI="https://nominatim.openstreetmap.org",FI="ISS-Tracker-HUB/1.0";async function OI(a,n){const o=new URL(`${zI}/reverse`);o.searchParams.set("lat",a.toString()),o.searchParams.set("lon",n.toString()),o.searchParams.set("format","json"),o.searchParams.set("addressdetails","1");try{const d=await fetch(o.toString(),{headers:{"User-Agent":FI}});if(!d.ok)throw new Error(`Reverse geocode error: ${d.status}`);const g=await d.json();return{displayName:g.display_name,address:g.address||{},lat:a,lon:n}}catch(d){return console.error("Reverse geocode error:",d),{displayName:`${a.toFixed(4)}, ${n.toFixed(4)}`,address:{},lat:a,lon:n}}}function NI(){return new Promise((a,n)=>{if(!navigator.geolocation){n(new Error("Geolocation not supported"));return}navigator.geolocation.getCurrentPosition(o=>{a({lat:o.coords.latitude,lon:o.coords.longitude})},o=>{n(o)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:3e5})})}const v_="isshub:userLocation";function VI(){return localStorage.getItem(v_)!==null}function BI(){const a=localStorage.getItem(v_);if(!a)return null;try{return JSON.parse(a)}catch{return null}}function UI(a){localStorage.setItem(v_,JSON.stringify(a))}function jI(a,n){if(VI()){const c=BI();c&&a&&a(c);return}const o=document.createElement("div");o.className="welcome-overlay",o.style.cssText=`
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    z-index: 5000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  `;const d=document.createElement("div");d.className="welcome-card hub-glass",d.style.cssText=`
    max-width: 500px;
    width: 100%;
    padding: 32px;
    text-align: center;
  `,d.innerHTML=`
    <div class="welcome-icon" style="font-size: 64px; margin-bottom: 16px;"></div>
    <h2 style="font-weight: 900; font-size: 24px; margin-bottom: 12px;">
      ISS'i Grmek ster misin?
    </h2>
    <p style="color: var(--muted); font-size: 14px; line-height: 1.6; margin-bottom: 24px;">
      ISS'in ne zaman gkyznde grnebileceini hesaplamak iin konumunuza ihtiyacmz var.
    </p>
    
    <div class="welcome-buttons" style="display: flex; flex-direction: column; gap: 12px;">
      <button type="button" class="btn-auto-location" style="
        padding: 14px 24px;
        border-radius: 12px;
        background: var(--accent);
        color: #000;
        border: none;
        font-weight: 800;
        font-size: 15px;
        cursor: pointer;
        transition: all 150ms;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      ">
        <span></span>
        <span>Konumu Otomatik Tespit Et</span>
      </button>
      
      <button type="button" class="btn-manual-location" style="
        padding: 14px 24px;
        border-radius: 12px;
        background: var(--card2);
        color: var(--text);
        border: 1px solid var(--ring);
        font-weight: 700;
        font-size: 14px;
        cursor: pointer;
        transition: all 150ms;
      ">
        Manuel Gir
      </button>
    </div>
    
    <div class="welcome-status" style="margin-top: 16px; min-height: 20px; font-size: 13px; color: var(--muted);"></div>
  `,o.appendChild(d),document.body.appendChild(o);const g=d.querySelector(".btn-auto-location"),w=d.querySelector(".btn-manual-location"),x=d.querySelector(".welcome-status");g.addEventListener("click",async()=>{g.disabled=!0,w.disabled=!0,x.textContent=" Konum tespit ediliyor...";try{const c=await NI();x.textContent=" Adres bilgisi alnyor...";const R=await OI(c.lat,c.lon),B={lat:c.lat,lon:c.lon,displayName:R.displayName,address:R.address,method:"auto"};UI(B),x.innerHTML=' <span style="color: var(--good);">Konum ayarland!</span>',setTimeout(()=>{o.remove(),a&&a(B)},1e3)}catch{x.innerHTML=' <span style="color: var(--bad);">Konum izni reddedildi veya alnamad</span>',g.disabled=!1,w.disabled=!1,setTimeout(()=>{x.textContent="Manuel giri kullanabilirsiniz"},2e3)}}),w.addEventListener("click",()=>{o.remove(),n&&n()})}const kb="isshub:language";let Fs="tr";const Ja={en:{speed:"Speed",altitude:"Altitude",lat:"Latitude",lon:"Longitude",close:"Close",save:"Save",cancel:"Cancel",settings:"Settings",theme:"Theme",language:"Language",units:"Units",crew:"Crew",follow:"Follow",on:"ON",off:"OFF",connectionStable:"Connection stable",daylight:"Daylight",eclipse:"Eclipse",tools:"Tools",location:"Location",changeLocation:"Change Location",passDepend:"Pass predictions depend on location",locationModalTitle:"Location Settings",locationModalDesc:"Select your location for accurate pass predictions",locGpsRequesting:"Requesting GPS location...",locGpsSuccess:"Location acquired",locGpsFailed:"GPS failed",locSearchFailed:"Search failed",locSaved:"Location saved",useMyLocation:"Use My Location (GPS)",searchLocation:"Search Location",searchPlaceholder:'Search: "London" / "Tokyo" ...',selection:"Selection",noSelection:"No selection",noResults:'No results. Try broader terms (e.g., "London").',searching:"Searching...",selectCity:"Select a city",followActive:"Tracking: ON",followInactive:"Tracking: OFF",passNoLocation:"No location set",passCalculating:"Calculating pass...",passNotFound:"No visible pass found",passError:"Pass calculation error",passCardTitle:"Next Pass",passVisible:" VISIBLE",passPoorAngle:" DIFFICULT (Low Angle: {deg})",passInvisible:" INVISIBLE",passNone:"No upcoming pass",passDetails:"Details",passClose:"Close",passDuration:"Duration",passFirstVisible:"First visible pass",passHoursMinutes:"{h}h {m}min later ({time})",passNotFoundDetails:"not found",passMinutes:"{min} min",globeLoadFailed:"3D Globe failed to load",globeError:"Globe error",bootReady:"App ready",locationSet:"Location set",offline:"Offline. Retrying...",staleData:"Data may be outdated",reconnecting:"Reconnecting...",trajectoryCalculating:"Calculating trajectory...",trajectoryError:"Trajectory error","hero.headline":"The ISS is currently over Earth","hero.subline.loading":"Calculating pass times...","hero.subline.pass":"Visible from your location in {minutes} minutes","hero.subline.permission":"Enable location to see when ISS passes overhead","hero.subline.unavailable":"Pass calculation unavailable","hero.cta.showPass":"Show Pass","hero.cta.liveTrack":"Live Track","hero.passCardComing":"Pass card is being prepared...",hudShowDetails:"Show details",hudHideDetails:"Hide details",hudDebug:"Debug",hudDebugReady:"Debug console ready",nasaLive:"NASA LIVE",cam1:"High Definition",cam2:"Standard Def",cam3:"Media TV",streamOffline:"Signal Lost / Offline",streamLocked:"Stream Unavailable",crewTitle:"Expedition Crew",daysInSpace:"{d} days in space",bioCdr:"Commander",bioFe:"Flight Engineer",helpTitle:"Help & Guide",helpDesc:"How to track the station",navMap:"Map",navTelemetry:"Telemetry",navPasses:"Passes",navSettings:"Settings",navNasaTV:"NASA TV",authLogin:"Sign In",authSignup:"Sign Up",authLogout:"Sign Out",authEmail:"Email",authPassword:"Password",authName:"Full Name",authForgotPassword:"Forgot password?",authNoAccount:"Don't have an account?",authHasAccount:"Already have an account?",authGoogleSignIn:"Continue with Google",authWelcome:"Welcome",authProfile:"Profile",addToCalendar:"Add to Calendar",calendarDownloaded:"Downloaded!",enableNotifications:"Enable Notifications",notificationsEnabled:"Notifications Enabled",passReminder:"ISS Pass Reminder"},tr:{speed:"Hz",altitude:"rtifa",lat:"Enlem",lon:"Boylam",close:"Kapat",save:"Kaydet",cancel:"ptal",settings:"Ayarlar",theme:"Tema",language:"Dil",units:"Birimler",crew:"Mrettebat",follow:"Takip",on:"AIK",off:"KAPALI",connectionStable:"Balant kararl",daylight:"Gndz",eclipse:"Tutulma (Gece)",tools:"Aralar",location:"Konum",changeLocation:"Konum Deitir",passDepend:"Gei tahminleri konuma baldr",locationModalTitle:"Konum Ayarlar",locationModalDesc:"Doru gei tahminleri iin konumunuzu sein",locGpsRequesting:"GPS konumu isteniyor...",locGpsSuccess:"Konum alnd",locGpsFailed:"GPS baarsz",locSearchFailed:"Arama baarsz",locSaved:"Konum kaydedildi",useMyLocation:"Konumumu Kullan (GPS)",searchLocation:"Arama ile Se",searchPlaceholder:'Ara: "Bursa" / "Istanbul" ...',selection:"Seim",noSelection:"Seim yaplmad",noResults:'Sonu yok. Daha genel yaz (rn: "Bursa").',searching:"Aranyor...",selectCity:"ehir sein",followActive:"Takip: Ak",followInactive:"Takip: Kapal",passNoLocation:"Konum belirtilmedi",passCalculating:"Gei hesaplanyor...",passNotFound:"Grnr gei bulunamad",passError:"Gei hesaplama hatas",passCardTitle:"Sradaki Gei",passVisible:" GRNR",passPoorAngle:" ZOR (Dk A: {deg})",passInvisible:" GRNMEZ",passNone:"Yaknda gei yok",passDetails:"Detaylar",passClose:"Kapat",passDuration:"Sre",passFirstVisible:"lk grnr gei",passHoursMinutes:"{h}sa {m}dk sonra ({time})",passNotFoundDetails:"bulunamad",passMinutes:"{min} dk",globeLoadFailed:"3D Kre yklenemedi",globeError:"Kre hatas",bootReady:"Uygulama hazr",locationSet:"Konum ayarland",offline:"evrimd. Tekrar deneniyor...",staleData:"Veriler gncel olmayabilir",reconnecting:"Yeniden balanlyor...",trajectoryCalculating:"Yrnge hesaplanyor...",trajectoryError:"Yrnge hatas","hero.headline":"ISS u an Dnya'nn zerinde","hero.subline.loading":"Gei hesaplanyor...","hero.subline.pass":"{minutes} dakika sonra bulunduun konumdan grlebilir","hero.subline.permission":"Konum izni vererek gei zamann ren","hero.subline.unavailable":"Gei hesaplamas kullanlamyor","hero.cta.showPass":"Geii Gster","hero.cta.liveTrack":"Canl Takip Et","hero.passCardComing":"Gei kart hazrlanyor...",hudShowDetails:"Detaylar gster",hudHideDetails:"Detaylar gizle",hudDebug:"Hata Ayklama",hudDebugReady:"Hata ayklama konsolu hazr",nasaLive:"NASA CANLI YAYIN",cam1:"Yksek Kalite (HD)",cam2:"Standart (SD)",cam3:"Medya TV",streamOffline:"Sinyal Yok / evrimd",streamLocked:"Yayn Kullanlamyor",crewTitle:"stasyon Mrettebat",daysInSpace:"{d} gndr uzayda",bioCdr:"Komutan",bioFe:"Uu Mhendisi",helpTitle:"Yardm & Rehber",helpDesc:"stasyon nasl takip edilir",navMap:"Harita",navTelemetry:"Telemetri",navPasses:"Geiler",navSettings:"Ayarlar",navNasaTV:"NASA TV",authLogin:"Giri Yap",authSignup:"Kayt Ol",authLogout:"k Yap",authEmail:"E-posta",authPassword:"ifre",authName:"Ad Soyad",authForgotPassword:"ifremi unuttum",authNoAccount:"Hesabnz yok mu?",authHasAccount:"Zaten hesabnz var m?",authGoogleSignIn:"Google ile devam et",authWelcome:"Ho geldin",authProfile:"Profil",addToCalendar:"Takvime Ekle",calendarDownloaded:"ndirildi!",enableNotifications:"Bildirimleri A",notificationsEnabled:"Bildirimler Ak",passReminder:"ISS Gei Hatrlatcs"},de:{},fr:{},es:{},it:{},ru:{},ja:{},zh:{},pt:{},hi:{},ar:{},bn:{},ko:{},nl:{},pl:{},ro:{},sv:{}};async function qI(){const a=localStorage.getItem(kb);if(a&&Ja[a])Fs=a;else{const o=(navigator.language||navigator.userLanguage).split("-")[0];Ja[o]?Fs=o:Fs="tr"}return Db(Fs),Fs}function sl(){return Fs}function $I(a){Ja[a]||(a="en"),Fs=a,localStorage.setItem(kb,a),Db(a),window.dispatchEvent(new CustomEvent("language-change",{detail:a}))}function mt(a){const n=Ja[Fs];return n&&n[a]?n[a]:Fs!=="tr"&&Ja.tr[a]?(console.warn(`[i18n] Missing "${a}" in "${Fs}", using TR fallback`),Ja.tr[a]):Fs!=="en"&&Ja.en[a]?(console.warn(`[i18n] Missing "${a}" in "${Fs}", using EN fallback`),Ja.en[a]):(console.warn(`[i18n] Missing translation key: "${a}"`),a)}function GI(a,n){return Fs==="en"?{speed:Math.round(a*.621371).toLocaleString("en-US"),speedUnit:"mph",altitude:(n*.621371).toFixed(1),altUnit:"mi"}:{speed:Math.round(a).toLocaleString("tr-TR"),speedUnit:"km/h",altitude:n.toFixed(1),altUnit:"km"}}function Db(a){document.documentElement.lang=a,document.querySelectorAll("[data-i18n]").forEach(n=>{const o=n.dataset.i18n;o&&(n.textContent=mt(o))})}async function HI(a){var n,o,d;try{const w=`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(a)}`,x=await fetch(w);if(!x.ok)throw new Error(`Wikipedia API error: ${x.status}`);const c=await x.json();return{name:c.title||a,thumbnail:((n=c.thumbnail)==null?void 0:n.source)||null,extract:c.extract||"No information available",description:c.description||"Astronaut",wikiUrl:((d=(o=c.content_urls)==null?void 0:o.desktop)==null?void 0:d.page)||null,lang:c.lang||"en"}}catch(g){return console.warn(`Failed to fetch details for ${a}:`,g),{name:a,thumbnail:null,extract:"Information not available",description:"ISS Crew Member",wikiUrl:null}}}async function ZI(a){const n=a.map(async o=>{const d=await HI(o.name);return{...o,...d}});return Promise.all(n)}function Lb(){if(document.querySelector(".crew-overlay"))return;const a=document.createElement("div");a.className="crew-overlay",a.style.display="flex";const n=document.createElement("div");n.className="crew-card hub-glass",n.innerHTML=`
    <div class="crew-top">
      <div class="crew-title"> ISS Mrettebat</div>
      <button type="button" class="btn crew-close"></button>
    </div>
    <div class="crew-content">
      <div style="text-align: center; padding: 40px 20px; color: var(--muted);">
         Ykleniyor...
      </div>
    </div>
  `,a.appendChild(n),document.body.appendChild(a);const o=n.querySelector(".crew-close");o.onclick=()=>a.remove(),a.onclick=d=>{d.target===a&&a.remove()},n.onclick=d=>d.stopPropagation(),fetch("http://api.open-notify.org/astros.json").then(d=>d.json()).then(async d=>{const g=d.people.filter(c=>c.craft==="ISS"),w=n.querySelector(".crew-content");w.innerHTML=`
        <div style="text-align: center; padding: 20px; color: var(--muted);">
           ${g.length} astronotun bilgileri Wikipedia'dan alnyor...
        </div>
      `;const x=await ZI(g);w.innerHTML=`
        <div class="crew-list">
          ${x.map(c=>WI(c)).join("")}
        </div>
      `}).catch(d=>{const g=n.querySelector(".crew-content");g.innerHTML=`
        <div style="text-align: center; padding: 40px 20px; color: var(--bad);">
           Yklenemedi<br>
          <small style="opacity: 0.7;">${d.message}</small>
        </div>
      `})}function WI(a){const{name:n,craft:o,thumbnail:d,extract:g,description:w,wikiUrl:x}=a;return`
    <div class="crew-item-enhanced">
      ${d?`
        <div class="crew-photo">
          <img src="${d}" alt="${n}" loading="lazy">
        </div>
      `:`
        <div class="crew-photo crew-photo-placeholder">
          <div class="crew-photo-icon"></div>
        </div>
      `}
      
      <div class="crew-details">
        <div class="crew-name-enhanced">${n}</div>
        <div class="crew-description">${w}</div>
        <div class="crew-craft-tag">
          <span class="crew-craft-icon"></span> ${o}
        </div>
        
        <div class="crew-bio">
          ${g||"No information available"}
        </div>
        
        ${x?`
          <a href="${x}" target="_blank" rel="noopener noreferrer" class="crew-wiki-link">
             Wikipedia'da Oku 
          </a>
        `:""}
      </div>
    </div>
  `}window.openCrewModal=Lb;const ss={settings:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>',video:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',user:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',map:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>',globe:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>',sun:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>',moon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>',activity:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>',users:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>'};function KI(a={}){const n=document.createElement("div");n.className="floating-hud glass-panel",(()=>{n.innerHTML=`
      <div class="hud-dashboard">
        <!-- Decoration: Top Border Line -->
        <div class="hud-deco-line"></div>
        
        <div class="hud-main-row">
          <!-- Left: Telemetry -->
          <div class="hud-section telemetry">
            <div class="hud-metric">
              <span class="hud-label">VELOCITY</span>
              <span class="hud-value" data-speed>--</span>
              <span class="hud-unit">KM/H</span>
            </div>
            <div class="hud-metric">
              <span class="hud-label">ALTITUDE</span>
              <span class="hud-value" data-altitude>--</span>
              <span class="hud-unit">KM</span>
            </div>
          </div>

          <!-- Center: Status & Location -->
          <div class="hud-section status">
             <div class="hud-location-box">
                <span class="hud-coord-label">LAT / LON</span>
                <span class="hud-coord-value" data-location>--.--, --.--</span>
             </div>
             <div class="hud-meta-row">
                <div class="hud-status-pill" data-status>${mt("connectionStable")}</div>
                <div class="hud-vis-icon" data-visibility>${ss.sun}</div>
             </div>
          </div>

          <!-- Right: Controls -->
          <div class="hud-section controls">
             <button class="btn-cyber-mini crew-btn" title="${mt("crew")}">
                ${ss.users} <span>CREW</span>
             </button>
             <button class="btn-cyber-mini debug-btn" data-toggle="debug" title="LOGS">
                ${ss.terminal||"TERM"}
             </button>
          </div>
        </div>

        <!-- Debug Terminal (Collapsible) -->
        <div class="hud-debug-panel" style="display: none;">
           <div class="hud-terminal-header">SYSTEM LOGS</div>
           <div class="hud-terminal-content" data-terminal></div>
        </div>
      </div>
    `})();const d=n.querySelector("[data-speed]"),g=n.querySelector("[data-altitude]"),w=n.querySelector("[data-status]"),x=n.querySelector("[data-visibility]"),c=n.querySelector("[data-location]"),R=n.querySelector("[data-terminal]"),B=n.querySelector(".hud-debug-panel"),W=n.querySelector("[data-toggle='debug']"),ee=n.querySelector(".crew-btn");let ce={};W==null||W.addEventListener("click",()=>{const Ue=B.style.display!=="none";B.style.display=Ue?"none":"block",W&&W.classList.toggle("active",!Ue)}),ee==null||ee.addEventListener("click",()=>Lb()),window.addEventListener("language-change",()=>{statusText&&(statusText.textContent=mt("connectionStable")),ee&&(ee.setAttribute("title",mt("crew")),ee.querySelector("span").textContent=mt("crew")),W&&(W.setAttribute("title",mt("hudDebug")),W.querySelector("span").textContent=mt("hudDebug")),ce.velocity&&Ie(ce)});function Ie(Ue){ce={...ce,...Ue};const ke=Ue.velocity??ce.velocity??27580,Q=Ue.altitude??ce.altitude??420,{speed:qe,altitude:Ye}=GI(ke,Q);if(d&&(d.textContent=qe),g&&(g.textContent=Ye),Ue.latitude!==void 0&&Ue.longitude!==void 0&&c&&(c.textContent=`${Ue.latitude.toFixed(2)}, ${Ue.longitude.toFixed(2)}`),Ue.visibility!==void 0&&x){const Ge=Ue.visibility==="daylight"||Ue.visibility===!0;x.innerHTML=Ge?ss.sun:ss.moon,x.title=mt(Ge?"daylight":"eclipse"),x.className=`hud-vis-icon ${Ge?"day":"night"}`}}return Ie({velocity:27580,altitude:420,visibility:"daylight"}),{el:n,update:Ie,log(Ue){if(w&&(w.textContent=Ue.substring(0,30)),R){const ke=document.createElement("div");for(ke.className="terminal-line",ke.textContent=`> ${Ue}`,R.appendChild(ke);R.children.length>8;)R.removeChild(R.firstChild);R.scrollTop=R.scrollHeight}},getLogFn(){return Ue=>this.log(Ue)}}}const XI=()=>{};var z0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zb=function(a){const n=[];let o=0;for(let d=0;d<a.length;d++){let g=a.charCodeAt(d);g<128?n[o++]=g:g<2048?(n[o++]=g>>6|192,n[o++]=g&63|128):(g&64512)===55296&&d+1<a.length&&(a.charCodeAt(d+1)&64512)===56320?(g=65536+((g&1023)<<10)+(a.charCodeAt(++d)&1023),n[o++]=g>>18|240,n[o++]=g>>12&63|128,n[o++]=g>>6&63|128,n[o++]=g&63|128):(n[o++]=g>>12|224,n[o++]=g>>6&63|128,n[o++]=g&63|128)}return n},YI=function(a){const n=[];let o=0,d=0;for(;o<a.length;){const g=a[o++];if(g<128)n[d++]=String.fromCharCode(g);else if(g>191&&g<224){const w=a[o++];n[d++]=String.fromCharCode((g&31)<<6|w&63)}else if(g>239&&g<365){const w=a[o++],x=a[o++],c=a[o++],R=((g&7)<<18|(w&63)<<12|(x&63)<<6|c&63)-65536;n[d++]=String.fromCharCode(55296+(R>>10)),n[d++]=String.fromCharCode(56320+(R&1023))}else{const w=a[o++],x=a[o++];n[d++]=String.fromCharCode((g&15)<<12|(w&63)<<6|x&63)}}return n.join("")},Fb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(a,n){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();const o=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,d=[];for(let g=0;g<a.length;g+=3){const w=a[g],x=g+1<a.length,c=x?a[g+1]:0,R=g+2<a.length,B=R?a[g+2]:0,W=w>>2,ee=(w&3)<<4|c>>4;let ce=(c&15)<<2|B>>6,Ie=B&63;R||(Ie=64,x||(ce=64)),d.push(o[W],o[ee],o[ce],o[Ie])}return d.join("")},encodeString(a,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(a):this.encodeByteArray(zb(a),n)},decodeString(a,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(a):YI(this.decodeStringToByteArray(a,n))},decodeStringToByteArray(a,n){this.init_();const o=n?this.charToByteMapWebSafe_:this.charToByteMap_,d=[];for(let g=0;g<a.length;){const w=o[a.charAt(g++)],c=g<a.length?o[a.charAt(g)]:0;++g;const B=g<a.length?o[a.charAt(g)]:64;++g;const ee=g<a.length?o[a.charAt(g)]:64;if(++g,w==null||c==null||B==null||ee==null)throw new QI;const ce=w<<2|c>>4;if(d.push(ce),B!==64){const Ie=c<<4&240|B>>2;if(d.push(Ie),ee!==64){const Ue=B<<6&192|ee;d.push(Ue)}}}return d},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class QI extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const JI=function(a){const n=zb(a);return Fb.encodeByteArray(n,!0)},ff=function(a){return JI(a).replace(/\./g,"")},Ob=function(a){try{return Fb.decodeString(a,!0)}catch(n){console.error("base64Decode failed: ",n)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tS=()=>eS().__FIREBASE_DEFAULTS__,nS=()=>{if(typeof process>"u"||typeof z0>"u")return;const a=z0.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},rS=()=>{if(typeof document>"u")return;let a;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const n=a&&Ob(a[1]);return n&&JSON.parse(n)},Bf=()=>{try{return XI()||tS()||nS()||rS()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},Nb=a=>{var n,o;return(o=(n=Bf())==null?void 0:n.emulatorHosts)==null?void 0:o[a]},Vb=a=>{const n=Nb(a);if(!n)return;const o=n.lastIndexOf(":");if(o<=0||o+1===n.length)throw new Error(`Invalid host ${n} with no separate hostname and port!`);const d=parseInt(n.substring(o+1),10);return n[0]==="["?[n.substring(1,o-1),d]:[n.substring(0,o),d]},Bb=()=>{var a;return(a=Bf())==null?void 0:a.config},Ub=a=>{var n;return(n=Bf())==null?void 0:n[`_${a}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((n,o)=>{this.resolve=n,this.reject=o})}wrapCallback(n){return(o,d)=>{o?this.reject(o):this.resolve(d),typeof n=="function"&&(this.promise.catch(()=>{}),n.length===1?n(o):n(o,d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mc(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function x_(a){return(await fetch(a,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jb(a,n){if(a.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const o={alg:"none",type:"JWT"},d=n||"demo-project",g=a.iat||0,w=a.sub||a.user_id;if(!w)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const x={iss:`https://securetoken.google.com/${d}`,aud:d,iat:g,exp:g+3600,auth_time:g,sub:w,user_id:w,firebase:{sign_in_provider:"custom",identities:{}},...a};return[ff(JSON.stringify(o)),ff(JSON.stringify(x)),""].join(".")}const ed={};function sS(){const a={prod:[],emulator:[]};for(const n of Object.keys(ed))ed[n]?a.emulator.push(n):a.prod.push(n);return a}function oS(a){let n=document.getElementById(a),o=!1;return n||(n=document.createElement("div"),n.setAttribute("id",a),o=!0),{created:o,element:n}}let F0=!1;function b_(a,n){if(typeof window>"u"||typeof document>"u"||!mc(window.location.host)||ed[a]===n||ed[a]||F0)return;ed[a]=n;function o(ce){return`__firebase__banner__${ce}`}const d="__firebase__banner",w=sS().prod.length>0;function x(){const ce=document.getElementById(d);ce&&ce.remove()}function c(ce){ce.style.display="flex",ce.style.background="#7faaf0",ce.style.position="fixed",ce.style.bottom="5px",ce.style.left="5px",ce.style.padding=".5em",ce.style.borderRadius="5px",ce.style.alignItems="center"}function R(ce,Ie){ce.setAttribute("width","24"),ce.setAttribute("id",Ie),ce.setAttribute("height","24"),ce.setAttribute("viewBox","0 0 24 24"),ce.setAttribute("fill","none"),ce.style.marginLeft="-6px"}function B(){const ce=document.createElement("span");return ce.style.cursor="pointer",ce.style.marginLeft="16px",ce.style.fontSize="24px",ce.innerHTML=" &times;",ce.onclick=()=>{F0=!0,x()},ce}function W(ce,Ie){ce.setAttribute("id",Ie),ce.innerText="Learn more",ce.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",ce.setAttribute("target","__blank"),ce.style.paddingLeft="5px",ce.style.textDecoration="underline"}function ee(){const ce=oS(d),Ie=o("text"),Ue=document.getElementById(Ie)||document.createElement("span"),ke=o("learnmore"),Q=document.getElementById(ke)||document.createElement("a"),qe=o("preprendIcon"),Ye=document.getElementById(qe)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(ce.created){const Ge=ce.element;c(Ge),W(Q,ke);const ht=B();R(Ye,qe),Ge.append(Ye,Ue,Q,ht),document.body.appendChild(Ge)}w?(Ue.innerText="Preview backend disconnected.",Ye.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Ye.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,Ue.innerText="Preview backend running in this workspace."),Ue.setAttribute("id",Ie)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",ee):ee()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gi(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function aS(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Gi())}function lS(){var n;const a=(n=Bf())==null?void 0:n.forceEnvironment;if(a==="node")return!0;if(a==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function cS(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function uS(){const a=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof a=="object"&&a.id!==void 0}function hS(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dS(){const a=Gi();return a.indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0}function pS(){return!lS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function fS(){try{return typeof indexedDB=="object"}catch{return!1}}function mS(){return new Promise((a,n)=>{try{let o=!0;const d="validate-browser-context-for-indexeddb-analytics-module",g=self.indexedDB.open(d);g.onsuccess=()=>{g.result.close(),o||self.indexedDB.deleteDatabase(d),a(!0)},g.onupgradeneeded=()=>{o=!1},g.onerror=()=>{var w;n(((w=g.error)==null?void 0:w.message)||"")}}catch(o){n(o)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gS="FirebaseError";class Go extends Error{constructor(n,o,d){super(o),this.code=n,this.customData=d,this.name=gS,Object.setPrototypeOf(this,Go.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_d.prototype.create)}}class _d{constructor(n,o,d){this.service=n,this.serviceName=o,this.errors=d}create(n,...o){const d=o[0]||{},g=`${this.service}/${n}`,w=this.errors[n],x=w?_S(w,d):"Error",c=`${this.serviceName}: ${x} (${g}).`;return new Go(g,c,d)}}function _S(a,n){return a.replace(yS,(o,d)=>{const g=n[d];return g!=null?String(g):`<${d}?>`})}const yS=/\{\$([^}]+)}/g;function vS(a){for(const n in a)if(Object.prototype.hasOwnProperty.call(a,n))return!1;return!0}function cc(a,n){if(a===n)return!0;const o=Object.keys(a),d=Object.keys(n);for(const g of o){if(!d.includes(g))return!1;const w=a[g],x=n[g];if(O0(w)&&O0(x)){if(!cc(w,x))return!1}else if(w!==x)return!1}for(const g of d)if(!o.includes(g))return!1;return!0}function O0(a){return a!==null&&typeof a=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yd(a){const n=[];for(const[o,d]of Object.entries(a))Array.isArray(d)?d.forEach(g=>{n.push(encodeURIComponent(o)+"="+encodeURIComponent(g))}):n.push(encodeURIComponent(o)+"="+encodeURIComponent(d));return n.length?"&"+n.join("&"):""}function Wh(a){const n={};return a.replace(/^\?/,"").split("&").forEach(d=>{if(d){const[g,w]=d.split("=");n[decodeURIComponent(g)]=decodeURIComponent(w)}}),n}function Kh(a){const n=a.indexOf("?");if(!n)return"";const o=a.indexOf("#",n);return a.substring(n,o>0?o:void 0)}function xS(a,n){const o=new bS(a,n);return o.subscribe.bind(o)}class bS{constructor(n,o){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=o,this.task.then(()=>{n(this)}).catch(d=>{this.error(d)})}next(n){this.forEachObserver(o=>{o.next(n)})}error(n){this.forEachObserver(o=>{o.error(n)}),this.close(n)}complete(){this.forEachObserver(n=>{n.complete()}),this.close()}subscribe(n,o,d){let g;if(n===void 0&&o===void 0&&d===void 0)throw new Error("Missing Observer.");wS(n,["next","error","complete"])?g=n:g={next:n,error:o,complete:d},g.next===void 0&&(g.next=Sg),g.error===void 0&&(g.error=Sg),g.complete===void 0&&(g.complete=Sg);const w=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?g.error(this.finalError):g.complete()}catch{}}),this.observers.push(g),w}unsubscribeOne(n){this.observers===void 0||this.observers[n]===void 0||(delete this.observers[n],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(n){if(!this.finalized)for(let o=0;o<this.observers.length;o++)this.sendOne(o,n)}sendOne(n,o){this.task.then(()=>{if(this.observers!==void 0&&this.observers[n]!==void 0)try{o(this.observers[n])}catch(d){typeof console<"u"&&console.error&&console.error(d)}})}close(n){this.finalized||(this.finalized=!0,n!==void 0&&(this.finalError=n),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function wS(a,n){if(typeof a!="object"||a===null)return!1;for(const o of n)if(o in a&&typeof a[o]=="function")return!0;return!1}function Sg(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hi(a){return a&&a._delegate?a._delegate:a}class cl{constructor(n,o,d){this.name=n,this.instanceFactory=o,this.type=d,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(n){return this.instantiationMode=n,this}setMultipleInstances(n){return this.multipleInstances=n,this}setServiceProps(n){return this.serviceProps=n,this}setInstanceCreatedCallback(n){return this.onInstanceCreated=n,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TS{constructor(n,o){this.name=n,this.container=o,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(n){const o=this.normalizeInstanceIdentifier(n);if(!this.instancesDeferred.has(o)){const d=new iS;if(this.instancesDeferred.set(o,d),this.isInitialized(o)||this.shouldAutoInitialize())try{const g=this.getOrInitializeService({instanceIdentifier:o});g&&d.resolve(g)}catch{}}return this.instancesDeferred.get(o).promise}getImmediate(n){const o=this.normalizeInstanceIdentifier(n==null?void 0:n.identifier),d=(n==null?void 0:n.optional)??!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(g){if(d)return null;throw g}else{if(d)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(n){if(n.name!==this.name)throw Error(`Mismatching Component ${n.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=n,!!this.shouldAutoInitialize()){if(IS(n))try{this.getOrInitializeService({instanceIdentifier:nc})}catch{}for(const[o,d]of this.instancesDeferred.entries()){const g=this.normalizeInstanceIdentifier(o);try{const w=this.getOrInitializeService({instanceIdentifier:g});d.resolve(w)}catch{}}}}clearInstance(n=nc){this.instancesDeferred.delete(n),this.instancesOptions.delete(n),this.instances.delete(n)}async delete(){const n=Array.from(this.instances.values());await Promise.all([...n.filter(o=>"INTERNAL"in o).map(o=>o.INTERNAL.delete()),...n.filter(o=>"_delete"in o).map(o=>o._delete())])}isComponentSet(){return this.component!=null}isInitialized(n=nc){return this.instances.has(n)}getOptions(n=nc){return this.instancesOptions.get(n)||{}}initialize(n={}){const{options:o={}}=n,d=this.normalizeInstanceIdentifier(n.instanceIdentifier);if(this.isInitialized(d))throw Error(`${this.name}(${d}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const g=this.getOrInitializeService({instanceIdentifier:d,options:o});for(const[w,x]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(w);d===c&&x.resolve(g)}return g}onInit(n,o){const d=this.normalizeInstanceIdentifier(o),g=this.onInitCallbacks.get(d)??new Set;g.add(n),this.onInitCallbacks.set(d,g);const w=this.instances.get(d);return w&&n(w,d),()=>{g.delete(n)}}invokeOnInitCallbacks(n,o){const d=this.onInitCallbacks.get(o);if(d)for(const g of d)try{g(n,o)}catch{}}getOrInitializeService({instanceIdentifier:n,options:o={}}){let d=this.instances.get(n);if(!d&&this.component&&(d=this.component.instanceFactory(this.container,{instanceIdentifier:ES(n),options:o}),this.instances.set(n,d),this.instancesOptions.set(n,o),this.invokeOnInitCallbacks(d,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,d)}catch{}return d||null}normalizeInstanceIdentifier(n=nc){return this.component?this.component.multipleInstances?n:nc:n}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ES(a){return a===nc?void 0:a}function IS(a){return a.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SS{constructor(n){this.name=n,this.providers=new Map}addComponent(n){const o=this.getProvider(n.name);if(o.isComponentSet())throw new Error(`Component ${n.name} has already been registered with ${this.name}`);o.setComponent(n)}addOrOverwriteComponent(n){this.getProvider(n.name).isComponentSet()&&this.providers.delete(n.name),this.addComponent(n)}getProvider(n){if(this.providers.has(n))return this.providers.get(n);const o=new TS(n,this);return this.providers.set(n,o),o}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bn;(function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"})(Bn||(Bn={}));const PS={debug:Bn.DEBUG,verbose:Bn.VERBOSE,info:Bn.INFO,warn:Bn.WARN,error:Bn.ERROR,silent:Bn.SILENT},AS=Bn.INFO,CS={[Bn.DEBUG]:"log",[Bn.VERBOSE]:"log",[Bn.INFO]:"info",[Bn.WARN]:"warn",[Bn.ERROR]:"error"},MS=(a,n,...o)=>{if(n<a.logLevel)return;const d=new Date().toISOString(),g=CS[n];if(g)console[g](`[${d}]  ${a.name}:`,...o);else throw new Error(`Attempted to log a message with an invalid logType (value: ${n})`)};class w_{constructor(n){this.name=n,this._logLevel=AS,this._logHandler=MS,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(n){if(!(n in Bn))throw new TypeError(`Invalid value "${n}" assigned to \`logLevel\``);this._logLevel=n}setLogLevel(n){this._logLevel=typeof n=="string"?PS[n]:n}get logHandler(){return this._logHandler}set logHandler(n){if(typeof n!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=n}get userLogHandler(){return this._userLogHandler}set userLogHandler(n){this._userLogHandler=n}debug(...n){this._userLogHandler&&this._userLogHandler(this,Bn.DEBUG,...n),this._logHandler(this,Bn.DEBUG,...n)}log(...n){this._userLogHandler&&this._userLogHandler(this,Bn.VERBOSE,...n),this._logHandler(this,Bn.VERBOSE,...n)}info(...n){this._userLogHandler&&this._userLogHandler(this,Bn.INFO,...n),this._logHandler(this,Bn.INFO,...n)}warn(...n){this._userLogHandler&&this._userLogHandler(this,Bn.WARN,...n),this._logHandler(this,Bn.WARN,...n)}error(...n){this._userLogHandler&&this._userLogHandler(this,Bn.ERROR,...n),this._logHandler(this,Bn.ERROR,...n)}}const RS=(a,n)=>n.some(o=>a instanceof o);let N0,V0;function kS(){return N0||(N0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function DS(){return V0||(V0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qb=new WeakMap,$g=new WeakMap,$b=new WeakMap,Pg=new WeakMap,T_=new WeakMap;function LS(a){const n=new Promise((o,d)=>{const g=()=>{a.removeEventListener("success",w),a.removeEventListener("error",x)},w=()=>{o(ol(a.result)),g()},x=()=>{d(a.error),g()};a.addEventListener("success",w),a.addEventListener("error",x)});return n.then(o=>{o instanceof IDBCursor&&qb.set(o,a)}).catch(()=>{}),T_.set(n,a),n}function zS(a){if($g.has(a))return;const n=new Promise((o,d)=>{const g=()=>{a.removeEventListener("complete",w),a.removeEventListener("error",x),a.removeEventListener("abort",x)},w=()=>{o(),g()},x=()=>{d(a.error||new DOMException("AbortError","AbortError")),g()};a.addEventListener("complete",w),a.addEventListener("error",x),a.addEventListener("abort",x)});$g.set(a,n)}let Gg={get(a,n,o){if(a instanceof IDBTransaction){if(n==="done")return $g.get(a);if(n==="objectStoreNames")return a.objectStoreNames||$b.get(a);if(n==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return ol(a[n])},set(a,n,o){return a[n]=o,!0},has(a,n){return a instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in a}};function FS(a){Gg=a(Gg)}function OS(a){return a===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...o){const d=a.call(Ag(this),n,...o);return $b.set(d,n.sort?n.sort():[n]),ol(d)}:DS().includes(a)?function(...n){return a.apply(Ag(this),n),ol(qb.get(this))}:function(...n){return ol(a.apply(Ag(this),n))}}function NS(a){return typeof a=="function"?OS(a):(a instanceof IDBTransaction&&zS(a),RS(a,kS())?new Proxy(a,Gg):a)}function ol(a){if(a instanceof IDBRequest)return LS(a);if(Pg.has(a))return Pg.get(a);const n=NS(a);return n!==a&&(Pg.set(a,n),T_.set(n,a)),n}const Ag=a=>T_.get(a);function VS(a,n,{blocked:o,upgrade:d,blocking:g,terminated:w}={}){const x=indexedDB.open(a,n),c=ol(x);return d&&x.addEventListener("upgradeneeded",R=>{d(ol(x.result),R.oldVersion,R.newVersion,ol(x.transaction),R)}),o&&x.addEventListener("blocked",R=>o(R.oldVersion,R.newVersion,R)),c.then(R=>{w&&R.addEventListener("close",()=>w()),g&&R.addEventListener("versionchange",B=>g(B.oldVersion,B.newVersion,B))}).catch(()=>{}),c}const BS=["get","getKey","getAll","getAllKeys","count"],US=["put","add","delete","clear"],Cg=new Map;function B0(a,n){if(!(a instanceof IDBDatabase&&!(n in a)&&typeof n=="string"))return;if(Cg.get(n))return Cg.get(n);const o=n.replace(/FromIndex$/,""),d=n!==o,g=US.includes(o);if(!(o in(d?IDBIndex:IDBObjectStore).prototype)||!(g||BS.includes(o)))return;const w=async function(x,...c){const R=this.transaction(x,g?"readwrite":"readonly");let B=R.store;return d&&(B=B.index(c.shift())),(await Promise.all([B[o](...c),g&&R.done]))[0]};return Cg.set(n,w),w}FS(a=>({...a,get:(n,o,d)=>B0(n,o)||a.get(n,o,d),has:(n,o)=>!!B0(n,o)||a.has(n,o)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jS{constructor(n){this.container=n}getPlatformInfoString(){return this.container.getProviders().map(o=>{if(qS(o)){const d=o.getImmediate();return`${d.library}/${d.version}`}else return null}).filter(o=>o).join(" ")}}function qS(a){const n=a.getComponent();return(n==null?void 0:n.type)==="VERSION"}const Hg="@firebase/app",U0="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wa=new w_("@firebase/app"),$S="@firebase/app-compat",GS="@firebase/analytics-compat",HS="@firebase/analytics",ZS="@firebase/app-check-compat",WS="@firebase/app-check",KS="@firebase/auth",XS="@firebase/auth-compat",YS="@firebase/database",QS="@firebase/data-connect",JS="@firebase/database-compat",eP="@firebase/functions",tP="@firebase/functions-compat",nP="@firebase/installations",rP="@firebase/installations-compat",iP="@firebase/messaging",sP="@firebase/messaging-compat",oP="@firebase/performance",aP="@firebase/performance-compat",lP="@firebase/remote-config",cP="@firebase/remote-config-compat",uP="@firebase/storage",hP="@firebase/storage-compat",dP="@firebase/firestore",pP="@firebase/ai",fP="@firebase/firestore-compat",mP="firebase",gP="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zg="[DEFAULT]",_P={[Hg]:"fire-core",[$S]:"fire-core-compat",[HS]:"fire-analytics",[GS]:"fire-analytics-compat",[WS]:"fire-app-check",[ZS]:"fire-app-check-compat",[KS]:"fire-auth",[XS]:"fire-auth-compat",[YS]:"fire-rtdb",[QS]:"fire-data-connect",[JS]:"fire-rtdb-compat",[eP]:"fire-fn",[tP]:"fire-fn-compat",[nP]:"fire-iid",[rP]:"fire-iid-compat",[iP]:"fire-fcm",[sP]:"fire-fcm-compat",[oP]:"fire-perf",[aP]:"fire-perf-compat",[lP]:"fire-rc",[cP]:"fire-rc-compat",[uP]:"fire-gcs",[hP]:"fire-gcs-compat",[dP]:"fire-fst",[fP]:"fire-fst-compat",[pP]:"fire-vertex","fire-js":"fire-js",[mP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mf=new Map,yP=new Map,Wg=new Map;function j0(a,n){try{a.container.addComponent(n)}catch(o){wa.debug(`Component ${n.name} failed to register with FirebaseApp ${a.name}`,o)}}function uc(a){const n=a.name;if(Wg.has(n))return wa.debug(`There were multiple attempts to register component ${n}.`),!1;Wg.set(n,a);for(const o of mf.values())j0(o,a);for(const o of yP.values())j0(o,a);return!0}function Uf(a,n){const o=a.container.getProvider("heartbeat").getImmediate({optional:!0});return o&&o.triggerHeartbeat(),a.container.getProvider(n)}function xs(a){return a==null?!1:a.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},al=new _d("app","Firebase",vP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{constructor(n,o,d){this._isDeleted=!1,this._options={...n},this._config={...o},this._name=o.name,this._automaticDataCollectionEnabled=o.automaticDataCollectionEnabled,this._container=d,this.container.addComponent(new cl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(n){this.checkDestroyed(),this._automaticDataCollectionEnabled=n}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(n){this._isDeleted=n}checkDestroyed(){if(this.isDeleted)throw al.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gc=gP;function Gb(a,n={}){let o=a;typeof n!="object"&&(n={name:n});const d={name:Zg,automaticDataCollectionEnabled:!0,...n},g=d.name;if(typeof g!="string"||!g)throw al.create("bad-app-name",{appName:String(g)});if(o||(o=Bb()),!o)throw al.create("no-options");const w=mf.get(g);if(w){if(cc(o,w.options)&&cc(d,w.config))return w;throw al.create("duplicate-app",{appName:g})}const x=new SS(g);for(const R of Wg.values())x.addComponent(R);const c=new xP(o,d,x);return mf.set(g,c),c}function E_(a=Zg){const n=mf.get(a);if(!n&&a===Zg&&Bb())return Gb();if(!n)throw al.create("no-app",{appName:a});return n}function Fo(a,n,o){let d=_P[a]??a;o&&(d+=`-${o}`);const g=d.match(/\s|\//),w=n.match(/\s|\//);if(g||w){const x=[`Unable to register library "${d}" with version "${n}":`];g&&x.push(`library name "${d}" contains illegal characters (whitespace or "/")`),g&&w&&x.push("and"),w&&x.push(`version name "${n}" contains illegal characters (whitespace or "/")`),wa.warn(x.join(" "));return}uc(new cl(`${d}-version`,()=>({library:d,version:n}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP="firebase-heartbeat-database",wP=1,ad="firebase-heartbeat-store";let Mg=null;function Hb(){return Mg||(Mg=VS(bP,wP,{upgrade:(a,n)=>{switch(n){case 0:try{a.createObjectStore(ad)}catch(o){console.warn(o)}}}}).catch(a=>{throw al.create("idb-open",{originalErrorMessage:a.message})})),Mg}async function TP(a){try{const o=(await Hb()).transaction(ad),d=await o.objectStore(ad).get(Zb(a));return await o.done,d}catch(n){if(n instanceof Go)wa.warn(n.message);else{const o=al.create("idb-get",{originalErrorMessage:n==null?void 0:n.message});wa.warn(o.message)}}}async function q0(a,n){try{const d=(await Hb()).transaction(ad,"readwrite");await d.objectStore(ad).put(n,Zb(a)),await d.done}catch(o){if(o instanceof Go)wa.warn(o.message);else{const d=al.create("idb-set",{originalErrorMessage:o==null?void 0:o.message});wa.warn(d.message)}}}function Zb(a){return`${a.name}!${a.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EP=1024,IP=30;class SP{constructor(n){this.container=n,this._heartbeatsCache=null;const o=this.container.getProvider("app").getImmediate();this._storage=new AP(o),this._heartbeatsCachePromise=this._storage.read().then(d=>(this._heartbeatsCache=d,d))}async triggerHeartbeat(){var n,o;try{const g=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),w=$0();if(((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((o=this._heartbeatsCache)==null?void 0:o.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===w||this._heartbeatsCache.heartbeats.some(x=>x.date===w))return;if(this._heartbeatsCache.heartbeats.push({date:w,agent:g}),this._heartbeatsCache.heartbeats.length>IP){const x=CP(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(x,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(d){wa.warn(d)}}async getHeartbeatsHeader(){var n;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const o=$0(),{heartbeatsToSend:d,unsentEntries:g}=PP(this._heartbeatsCache.heartbeats),w=ff(JSON.stringify({version:2,heartbeats:d}));return this._heartbeatsCache.lastSentHeartbeatDate=o,g.length>0?(this._heartbeatsCache.heartbeats=g,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),w}catch(o){return wa.warn(o),""}}}function $0(){return new Date().toISOString().substring(0,10)}function PP(a,n=EP){const o=[];let d=a.slice();for(const g of a){const w=o.find(x=>x.agent===g.agent);if(w){if(w.dates.push(g.date),G0(o)>n){w.dates.pop();break}}else if(o.push({agent:g.agent,dates:[g.date]}),G0(o)>n){o.pop();break}d=d.slice(1)}return{heartbeatsToSend:o,unsentEntries:d}}class AP{constructor(n){this.app=n,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return fS()?mS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const o=await TP(this.app);return o!=null&&o.heartbeats?o:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(n){if(await this._canUseIndexedDBPromise){const d=await this.read();return q0(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??d.lastSentHeartbeatDate,heartbeats:n.heartbeats})}else return}async add(n){if(await this._canUseIndexedDBPromise){const d=await this.read();return q0(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??d.lastSentHeartbeatDate,heartbeats:[...d.heartbeats,...n.heartbeats]})}else return}}function G0(a){return ff(JSON.stringify({version:2,heartbeats:a})).length}function CP(a){if(a.length===0)return-1;let n=0,o=a[0].date;for(let d=1;d<a.length;d++)a[d].date<o&&(o=a[d].date,n=d);return n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MP(a){uc(new cl("platform-logger",n=>new jS(n),"PRIVATE")),uc(new cl("heartbeat",n=>new SP(n),"PRIVATE")),Fo(Hg,U0,a),Fo(Hg,U0,"esm2020"),Fo("fire-js","")}MP("");var H0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ll,Wb;(function(){var a;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function n(xe,se){function ue(){}ue.prototype=se.prototype,xe.F=se.prototype,xe.prototype=new ue,xe.prototype.constructor=xe,xe.D=function(Ee,be,fe){for(var pe=Array(arguments.length-2),Jt=2;Jt<arguments.length;Jt++)pe[Jt-2]=arguments[Jt];return se.prototype[be].apply(Ee,pe)}}function o(){this.blockSize=-1}function d(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}n(d,o),d.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function g(xe,se,ue){ue||(ue=0);const Ee=Array(16);if(typeof se=="string")for(var be=0;be<16;++be)Ee[be]=se.charCodeAt(ue++)|se.charCodeAt(ue++)<<8|se.charCodeAt(ue++)<<16|se.charCodeAt(ue++)<<24;else for(be=0;be<16;++be)Ee[be]=se[ue++]|se[ue++]<<8|se[ue++]<<16|se[ue++]<<24;se=xe.g[0],ue=xe.g[1],be=xe.g[2];let fe=xe.g[3],pe;pe=se+(fe^ue&(be^fe))+Ee[0]+3614090360&4294967295,se=ue+(pe<<7&4294967295|pe>>>25),pe=fe+(be^se&(ue^be))+Ee[1]+3905402710&4294967295,fe=se+(pe<<12&4294967295|pe>>>20),pe=be+(ue^fe&(se^ue))+Ee[2]+606105819&4294967295,be=fe+(pe<<17&4294967295|pe>>>15),pe=ue+(se^be&(fe^se))+Ee[3]+3250441966&4294967295,ue=be+(pe<<22&4294967295|pe>>>10),pe=se+(fe^ue&(be^fe))+Ee[4]+4118548399&4294967295,se=ue+(pe<<7&4294967295|pe>>>25),pe=fe+(be^se&(ue^be))+Ee[5]+1200080426&4294967295,fe=se+(pe<<12&4294967295|pe>>>20),pe=be+(ue^fe&(se^ue))+Ee[6]+2821735955&4294967295,be=fe+(pe<<17&4294967295|pe>>>15),pe=ue+(se^be&(fe^se))+Ee[7]+4249261313&4294967295,ue=be+(pe<<22&4294967295|pe>>>10),pe=se+(fe^ue&(be^fe))+Ee[8]+1770035416&4294967295,se=ue+(pe<<7&4294967295|pe>>>25),pe=fe+(be^se&(ue^be))+Ee[9]+2336552879&4294967295,fe=se+(pe<<12&4294967295|pe>>>20),pe=be+(ue^fe&(se^ue))+Ee[10]+4294925233&4294967295,be=fe+(pe<<17&4294967295|pe>>>15),pe=ue+(se^be&(fe^se))+Ee[11]+2304563134&4294967295,ue=be+(pe<<22&4294967295|pe>>>10),pe=se+(fe^ue&(be^fe))+Ee[12]+1804603682&4294967295,se=ue+(pe<<7&4294967295|pe>>>25),pe=fe+(be^se&(ue^be))+Ee[13]+4254626195&4294967295,fe=se+(pe<<12&4294967295|pe>>>20),pe=be+(ue^fe&(se^ue))+Ee[14]+2792965006&4294967295,be=fe+(pe<<17&4294967295|pe>>>15),pe=ue+(se^be&(fe^se))+Ee[15]+1236535329&4294967295,ue=be+(pe<<22&4294967295|pe>>>10),pe=se+(be^fe&(ue^be))+Ee[1]+4129170786&4294967295,se=ue+(pe<<5&4294967295|pe>>>27),pe=fe+(ue^be&(se^ue))+Ee[6]+3225465664&4294967295,fe=se+(pe<<9&4294967295|pe>>>23),pe=be+(se^ue&(fe^se))+Ee[11]+643717713&4294967295,be=fe+(pe<<14&4294967295|pe>>>18),pe=ue+(fe^se&(be^fe))+Ee[0]+3921069994&4294967295,ue=be+(pe<<20&4294967295|pe>>>12),pe=se+(be^fe&(ue^be))+Ee[5]+3593408605&4294967295,se=ue+(pe<<5&4294967295|pe>>>27),pe=fe+(ue^be&(se^ue))+Ee[10]+38016083&4294967295,fe=se+(pe<<9&4294967295|pe>>>23),pe=be+(se^ue&(fe^se))+Ee[15]+3634488961&4294967295,be=fe+(pe<<14&4294967295|pe>>>18),pe=ue+(fe^se&(be^fe))+Ee[4]+3889429448&4294967295,ue=be+(pe<<20&4294967295|pe>>>12),pe=se+(be^fe&(ue^be))+Ee[9]+568446438&4294967295,se=ue+(pe<<5&4294967295|pe>>>27),pe=fe+(ue^be&(se^ue))+Ee[14]+3275163606&4294967295,fe=se+(pe<<9&4294967295|pe>>>23),pe=be+(se^ue&(fe^se))+Ee[3]+4107603335&4294967295,be=fe+(pe<<14&4294967295|pe>>>18),pe=ue+(fe^se&(be^fe))+Ee[8]+1163531501&4294967295,ue=be+(pe<<20&4294967295|pe>>>12),pe=se+(be^fe&(ue^be))+Ee[13]+2850285829&4294967295,se=ue+(pe<<5&4294967295|pe>>>27),pe=fe+(ue^be&(se^ue))+Ee[2]+4243563512&4294967295,fe=se+(pe<<9&4294967295|pe>>>23),pe=be+(se^ue&(fe^se))+Ee[7]+1735328473&4294967295,be=fe+(pe<<14&4294967295|pe>>>18),pe=ue+(fe^se&(be^fe))+Ee[12]+2368359562&4294967295,ue=be+(pe<<20&4294967295|pe>>>12),pe=se+(ue^be^fe)+Ee[5]+4294588738&4294967295,se=ue+(pe<<4&4294967295|pe>>>28),pe=fe+(se^ue^be)+Ee[8]+2272392833&4294967295,fe=se+(pe<<11&4294967295|pe>>>21),pe=be+(fe^se^ue)+Ee[11]+1839030562&4294967295,be=fe+(pe<<16&4294967295|pe>>>16),pe=ue+(be^fe^se)+Ee[14]+4259657740&4294967295,ue=be+(pe<<23&4294967295|pe>>>9),pe=se+(ue^be^fe)+Ee[1]+2763975236&4294967295,se=ue+(pe<<4&4294967295|pe>>>28),pe=fe+(se^ue^be)+Ee[4]+1272893353&4294967295,fe=se+(pe<<11&4294967295|pe>>>21),pe=be+(fe^se^ue)+Ee[7]+4139469664&4294967295,be=fe+(pe<<16&4294967295|pe>>>16),pe=ue+(be^fe^se)+Ee[10]+3200236656&4294967295,ue=be+(pe<<23&4294967295|pe>>>9),pe=se+(ue^be^fe)+Ee[13]+681279174&4294967295,se=ue+(pe<<4&4294967295|pe>>>28),pe=fe+(se^ue^be)+Ee[0]+3936430074&4294967295,fe=se+(pe<<11&4294967295|pe>>>21),pe=be+(fe^se^ue)+Ee[3]+3572445317&4294967295,be=fe+(pe<<16&4294967295|pe>>>16),pe=ue+(be^fe^se)+Ee[6]+76029189&4294967295,ue=be+(pe<<23&4294967295|pe>>>9),pe=se+(ue^be^fe)+Ee[9]+3654602809&4294967295,se=ue+(pe<<4&4294967295|pe>>>28),pe=fe+(se^ue^be)+Ee[12]+3873151461&4294967295,fe=se+(pe<<11&4294967295|pe>>>21),pe=be+(fe^se^ue)+Ee[15]+530742520&4294967295,be=fe+(pe<<16&4294967295|pe>>>16),pe=ue+(be^fe^se)+Ee[2]+3299628645&4294967295,ue=be+(pe<<23&4294967295|pe>>>9),pe=se+(be^(ue|~fe))+Ee[0]+4096336452&4294967295,se=ue+(pe<<6&4294967295|pe>>>26),pe=fe+(ue^(se|~be))+Ee[7]+1126891415&4294967295,fe=se+(pe<<10&4294967295|pe>>>22),pe=be+(se^(fe|~ue))+Ee[14]+2878612391&4294967295,be=fe+(pe<<15&4294967295|pe>>>17),pe=ue+(fe^(be|~se))+Ee[5]+4237533241&4294967295,ue=be+(pe<<21&4294967295|pe>>>11),pe=se+(be^(ue|~fe))+Ee[12]+1700485571&4294967295,se=ue+(pe<<6&4294967295|pe>>>26),pe=fe+(ue^(se|~be))+Ee[3]+2399980690&4294967295,fe=se+(pe<<10&4294967295|pe>>>22),pe=be+(se^(fe|~ue))+Ee[10]+4293915773&4294967295,be=fe+(pe<<15&4294967295|pe>>>17),pe=ue+(fe^(be|~se))+Ee[1]+2240044497&4294967295,ue=be+(pe<<21&4294967295|pe>>>11),pe=se+(be^(ue|~fe))+Ee[8]+1873313359&4294967295,se=ue+(pe<<6&4294967295|pe>>>26),pe=fe+(ue^(se|~be))+Ee[15]+4264355552&4294967295,fe=se+(pe<<10&4294967295|pe>>>22),pe=be+(se^(fe|~ue))+Ee[6]+2734768916&4294967295,be=fe+(pe<<15&4294967295|pe>>>17),pe=ue+(fe^(be|~se))+Ee[13]+1309151649&4294967295,ue=be+(pe<<21&4294967295|pe>>>11),pe=se+(be^(ue|~fe))+Ee[4]+4149444226&4294967295,se=ue+(pe<<6&4294967295|pe>>>26),pe=fe+(ue^(se|~be))+Ee[11]+3174756917&4294967295,fe=se+(pe<<10&4294967295|pe>>>22),pe=be+(se^(fe|~ue))+Ee[2]+718787259&4294967295,be=fe+(pe<<15&4294967295|pe>>>17),pe=ue+(fe^(be|~se))+Ee[9]+3951481745&4294967295,xe.g[0]=xe.g[0]+se&4294967295,xe.g[1]=xe.g[1]+(be+(pe<<21&4294967295|pe>>>11))&4294967295,xe.g[2]=xe.g[2]+be&4294967295,xe.g[3]=xe.g[3]+fe&4294967295}d.prototype.v=function(xe,se){se===void 0&&(se=xe.length);const ue=se-this.blockSize,Ee=this.C;let be=this.h,fe=0;for(;fe<se;){if(be==0)for(;fe<=ue;)g(this,xe,fe),fe+=this.blockSize;if(typeof xe=="string"){for(;fe<se;)if(Ee[be++]=xe.charCodeAt(fe++),be==this.blockSize){g(this,Ee),be=0;break}}else for(;fe<se;)if(Ee[be++]=xe[fe++],be==this.blockSize){g(this,Ee),be=0;break}}this.h=be,this.o+=se},d.prototype.A=function(){var xe=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);xe[0]=128;for(var se=1;se<xe.length-8;++se)xe[se]=0;se=this.o*8;for(var ue=xe.length-8;ue<xe.length;++ue)xe[ue]=se&255,se/=256;for(this.v(xe),xe=Array(16),se=0,ue=0;ue<4;++ue)for(let Ee=0;Ee<32;Ee+=8)xe[se++]=this.g[ue]>>>Ee&255;return xe};function w(xe,se){var ue=c;return Object.prototype.hasOwnProperty.call(ue,xe)?ue[xe]:ue[xe]=se(xe)}function x(xe,se){this.h=se;const ue=[];let Ee=!0;for(let be=xe.length-1;be>=0;be--){const fe=xe[be]|0;Ee&&fe==se||(ue[be]=fe,Ee=!1)}this.g=ue}var c={};function R(xe){return-128<=xe&&xe<128?w(xe,function(se){return new x([se|0],se<0?-1:0)}):new x([xe|0],xe<0?-1:0)}function B(xe){if(isNaN(xe)||!isFinite(xe))return ee;if(xe<0)return Q(B(-xe));const se=[];let ue=1;for(let Ee=0;xe>=ue;Ee++)se[Ee]=xe/ue|0,ue*=4294967296;return new x(se,0)}function W(xe,se){if(xe.length==0)throw Error("number format error: empty string");if(se=se||10,se<2||36<se)throw Error("radix out of range: "+se);if(xe.charAt(0)=="-")return Q(W(xe.substring(1),se));if(xe.indexOf("-")>=0)throw Error('number format error: interior "-" character');const ue=B(Math.pow(se,8));let Ee=ee;for(let fe=0;fe<xe.length;fe+=8){var be=Math.min(8,xe.length-fe);const pe=parseInt(xe.substring(fe,fe+be),se);be<8?(be=B(Math.pow(se,be)),Ee=Ee.j(be).add(B(pe))):(Ee=Ee.j(ue),Ee=Ee.add(B(pe)))}return Ee}var ee=R(0),ce=R(1),Ie=R(16777216);a=x.prototype,a.m=function(){if(ke(this))return-Q(this).m();let xe=0,se=1;for(let ue=0;ue<this.g.length;ue++){const Ee=this.i(ue);xe+=(Ee>=0?Ee:4294967296+Ee)*se,se*=4294967296}return xe},a.toString=function(xe){if(xe=xe||10,xe<2||36<xe)throw Error("radix out of range: "+xe);if(Ue(this))return"0";if(ke(this))return"-"+Q(this).toString(xe);const se=B(Math.pow(xe,6));var ue=this;let Ee="";for(;;){const be=ht(ue,se).g;ue=qe(ue,be.j(se));let fe=((ue.g.length>0?ue.g[0]:ue.h)>>>0).toString(xe);if(ue=be,Ue(ue))return fe+Ee;for(;fe.length<6;)fe="0"+fe;Ee=fe+Ee}},a.i=function(xe){return xe<0?0:xe<this.g.length?this.g[xe]:this.h};function Ue(xe){if(xe.h!=0)return!1;for(let se=0;se<xe.g.length;se++)if(xe.g[se]!=0)return!1;return!0}function ke(xe){return xe.h==-1}a.l=function(xe){return xe=qe(this,xe),ke(xe)?-1:Ue(xe)?0:1};function Q(xe){const se=xe.g.length,ue=[];for(let Ee=0;Ee<se;Ee++)ue[Ee]=~xe.g[Ee];return new x(ue,~xe.h).add(ce)}a.abs=function(){return ke(this)?Q(this):this},a.add=function(xe){const se=Math.max(this.g.length,xe.g.length),ue=[];let Ee=0;for(let be=0;be<=se;be++){let fe=Ee+(this.i(be)&65535)+(xe.i(be)&65535),pe=(fe>>>16)+(this.i(be)>>>16)+(xe.i(be)>>>16);Ee=pe>>>16,fe&=65535,pe&=65535,ue[be]=pe<<16|fe}return new x(ue,ue[ue.length-1]&-2147483648?-1:0)};function qe(xe,se){return xe.add(Q(se))}a.j=function(xe){if(Ue(this)||Ue(xe))return ee;if(ke(this))return ke(xe)?Q(this).j(Q(xe)):Q(Q(this).j(xe));if(ke(xe))return Q(this.j(Q(xe)));if(this.l(Ie)<0&&xe.l(Ie)<0)return B(this.m()*xe.m());const se=this.g.length+xe.g.length,ue=[];for(var Ee=0;Ee<2*se;Ee++)ue[Ee]=0;for(Ee=0;Ee<this.g.length;Ee++)for(let be=0;be<xe.g.length;be++){const fe=this.i(Ee)>>>16,pe=this.i(Ee)&65535,Jt=xe.i(be)>>>16,fn=xe.i(be)&65535;ue[2*Ee+2*be]+=pe*fn,Ye(ue,2*Ee+2*be),ue[2*Ee+2*be+1]+=fe*fn,Ye(ue,2*Ee+2*be+1),ue[2*Ee+2*be+1]+=pe*Jt,Ye(ue,2*Ee+2*be+1),ue[2*Ee+2*be+2]+=fe*Jt,Ye(ue,2*Ee+2*be+2)}for(xe=0;xe<se;xe++)ue[xe]=ue[2*xe+1]<<16|ue[2*xe];for(xe=se;xe<2*se;xe++)ue[xe]=0;return new x(ue,0)};function Ye(xe,se){for(;(xe[se]&65535)!=xe[se];)xe[se+1]+=xe[se]>>>16,xe[se]&=65535,se++}function Ge(xe,se){this.g=xe,this.h=se}function ht(xe,se){if(Ue(se))throw Error("division by zero");if(Ue(xe))return new Ge(ee,ee);if(ke(xe))return se=ht(Q(xe),se),new Ge(Q(se.g),Q(se.h));if(ke(se))return se=ht(xe,Q(se)),new Ge(Q(se.g),se.h);if(xe.g.length>30){if(ke(xe)||ke(se))throw Error("slowDivide_ only works with positive integers.");for(var ue=ce,Ee=se;Ee.l(xe)<=0;)ue=ct(ue),Ee=ct(Ee);var be=ot(ue,1),fe=ot(Ee,1);for(Ee=ot(Ee,2),ue=ot(ue,2);!Ue(Ee);){var pe=fe.add(Ee);pe.l(xe)<=0&&(be=be.add(ue),fe=pe),Ee=ot(Ee,1),ue=ot(ue,1)}return se=qe(xe,be.j(se)),new Ge(be,se)}for(be=ee;xe.l(se)>=0;){for(ue=Math.max(1,Math.floor(xe.m()/se.m())),Ee=Math.ceil(Math.log(ue)/Math.LN2),Ee=Ee<=48?1:Math.pow(2,Ee-48),fe=B(ue),pe=fe.j(se);ke(pe)||pe.l(xe)>0;)ue-=Ee,fe=B(ue),pe=fe.j(se);Ue(fe)&&(fe=ce),be=be.add(fe),xe=qe(xe,pe)}return new Ge(be,xe)}a.B=function(xe){return ht(this,xe).h},a.and=function(xe){const se=Math.max(this.g.length,xe.g.length),ue=[];for(let Ee=0;Ee<se;Ee++)ue[Ee]=this.i(Ee)&xe.i(Ee);return new x(ue,this.h&xe.h)},a.or=function(xe){const se=Math.max(this.g.length,xe.g.length),ue=[];for(let Ee=0;Ee<se;Ee++)ue[Ee]=this.i(Ee)|xe.i(Ee);return new x(ue,this.h|xe.h)},a.xor=function(xe){const se=Math.max(this.g.length,xe.g.length),ue=[];for(let Ee=0;Ee<se;Ee++)ue[Ee]=this.i(Ee)^xe.i(Ee);return new x(ue,this.h^xe.h)};function ct(xe){const se=xe.g.length+1,ue=[];for(let Ee=0;Ee<se;Ee++)ue[Ee]=xe.i(Ee)<<1|xe.i(Ee-1)>>>31;return new x(ue,xe.h)}function ot(xe,se){const ue=se>>5;se%=32;const Ee=xe.g.length-ue,be=[];for(let fe=0;fe<Ee;fe++)be[fe]=se>0?xe.i(fe+ue)>>>se|xe.i(fe+ue+1)<<32-se:xe.i(fe+ue);return new x(be,xe.h)}d.prototype.digest=d.prototype.A,d.prototype.reset=d.prototype.u,d.prototype.update=d.prototype.v,Wb=d,x.prototype.add=x.prototype.add,x.prototype.multiply=x.prototype.j,x.prototype.modulo=x.prototype.B,x.prototype.compare=x.prototype.l,x.prototype.toNumber=x.prototype.m,x.prototype.toString=x.prototype.toString,x.prototype.getBits=x.prototype.i,x.fromNumber=B,x.fromString=W,ll=x}).apply(typeof H0<"u"?H0:typeof self<"u"?self:typeof window<"u"?window:{});var Gp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Kb,Xh,Xb,tf,Kg,Yb,Qb,Jb;(function(){var a,n=Object.defineProperty;function o(E){E=[typeof globalThis=="object"&&globalThis,E,typeof window=="object"&&window,typeof self=="object"&&self,typeof Gp=="object"&&Gp];for(var L=0;L<E.length;++L){var j=E[L];if(j&&j.Math==Math)return j}throw Error("Cannot find global object")}var d=o(this);function g(E,L){if(L)e:{var j=d;E=E.split(".");for(var ne=0;ne<E.length-1;ne++){var ze=E[ne];if(!(ze in j))break e;j=j[ze]}E=E[E.length-1],ne=j[E],L=L(ne),L!=ne&&L!=null&&n(j,E,{configurable:!0,writable:!0,value:L})}}g("Symbol.dispose",function(E){return E||Symbol("Symbol.dispose")}),g("Array.prototype.values",function(E){return E||function(){return this[Symbol.iterator]()}}),g("Object.entries",function(E){return E||function(L){var j=[],ne;for(ne in L)Object.prototype.hasOwnProperty.call(L,ne)&&j.push([ne,L[ne]]);return j}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var w=w||{},x=this||self;function c(E){var L=typeof E;return L=="object"&&E!=null||L=="function"}function R(E,L,j){return E.call.apply(E.bind,arguments)}function B(E,L,j){return B=R,B.apply(null,arguments)}function W(E,L){var j=Array.prototype.slice.call(arguments,1);return function(){var ne=j.slice();return ne.push.apply(ne,arguments),E.apply(this,ne)}}function ee(E,L){function j(){}j.prototype=L.prototype,E.Z=L.prototype,E.prototype=new j,E.prototype.constructor=E,E.Ob=function(ne,ze,Ze){for(var ft=Array(arguments.length-2),cn=2;cn<arguments.length;cn++)ft[cn-2]=arguments[cn];return L.prototype[ze].apply(ne,ft)}}var ce=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?E=>E&&AsyncContext.Snapshot.wrap(E):E=>E;function Ie(E){const L=E.length;if(L>0){const j=Array(L);for(let ne=0;ne<L;ne++)j[ne]=E[ne];return j}return[]}function Ue(E,L){for(let ne=1;ne<arguments.length;ne++){const ze=arguments[ne];var j=typeof ze;if(j=j!="object"?j:ze?Array.isArray(ze)?"array":j:"null",j=="array"||j=="object"&&typeof ze.length=="number"){j=E.length||0;const Ze=ze.length||0;E.length=j+Ze;for(let ft=0;ft<Ze;ft++)E[j+ft]=ze[ft]}else E.push(ze)}}class ke{constructor(L,j){this.i=L,this.j=j,this.h=0,this.g=null}get(){let L;return this.h>0?(this.h--,L=this.g,this.g=L.next,L.next=null):L=this.i(),L}}function Q(E){x.setTimeout(()=>{throw E},0)}function qe(){var E=xe;let L=null;return E.g&&(L=E.g,E.g=E.g.next,E.g||(E.h=null),L.next=null),L}class Ye{constructor(){this.h=this.g=null}add(L,j){const ne=Ge.get();ne.set(L,j),this.h?this.h.next=ne:this.g=ne,this.h=ne}}var Ge=new ke(()=>new ht,E=>E.reset());class ht{constructor(){this.next=this.g=this.h=null}set(L,j){this.h=L,this.g=j,this.next=null}reset(){this.next=this.g=this.h=null}}let ct,ot=!1,xe=new Ye,se=()=>{const E=Promise.resolve(void 0);ct=()=>{E.then(ue)}};function ue(){for(var E;E=qe();){try{E.h.call(E.g)}catch(j){Q(j)}var L=Ge;L.j(E),L.h<100&&(L.h++,E.next=L.g,L.g=E)}ot=!1}function Ee(){this.u=this.u,this.C=this.C}Ee.prototype.u=!1,Ee.prototype.dispose=function(){this.u||(this.u=!0,this.N())},Ee.prototype[Symbol.dispose]=function(){this.dispose()},Ee.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function be(E,L){this.type=E,this.g=this.target=L,this.defaultPrevented=!1}be.prototype.h=function(){this.defaultPrevented=!0};var fe=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var E=!1,L=Object.defineProperty({},"passive",{get:function(){E=!0}});try{const j=()=>{};x.addEventListener("test",j,L),x.removeEventListener("test",j,L)}catch{}return E}();function pe(E){return/^[\s\xa0]*$/.test(E)}function Jt(E,L){be.call(this,E?E.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,E&&this.init(E,L)}ee(Jt,be),Jt.prototype.init=function(E,L){const j=this.type=E.type,ne=E.changedTouches&&E.changedTouches.length?E.changedTouches[0]:null;this.target=E.target||E.srcElement,this.g=L,L=E.relatedTarget,L||(j=="mouseover"?L=E.fromElement:j=="mouseout"&&(L=E.toElement)),this.relatedTarget=L,ne?(this.clientX=ne.clientX!==void 0?ne.clientX:ne.pageX,this.clientY=ne.clientY!==void 0?ne.clientY:ne.pageY,this.screenX=ne.screenX||0,this.screenY=ne.screenY||0):(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0),this.button=E.button,this.key=E.key||"",this.ctrlKey=E.ctrlKey,this.altKey=E.altKey,this.shiftKey=E.shiftKey,this.metaKey=E.metaKey,this.pointerId=E.pointerId||0,this.pointerType=E.pointerType,this.state=E.state,this.i=E,E.defaultPrevented&&Jt.Z.h.call(this)},Jt.prototype.h=function(){Jt.Z.h.call(this);const E=this.i;E.preventDefault?E.preventDefault():E.returnValue=!1};var fn="closure_listenable_"+(Math.random()*1e6|0),Ut=0;function $t(E,L,j,ne,ze){this.listener=E,this.proxy=null,this.src=L,this.type=j,this.capture=!!ne,this.ha=ze,this.key=++Ut,this.da=this.fa=!1}function mn(E){E.da=!0,E.listener=null,E.proxy=null,E.src=null,E.ha=null}function Pt(E,L,j){for(const ne in E)L.call(j,E[ne],ne,E)}function zn(E,L){for(const j in E)L.call(void 0,E[j],j,E)}function on(E){const L={};for(const j in E)L[j]=E[j];return L}const Ft="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Gt(E,L){let j,ne;for(let ze=1;ze<arguments.length;ze++){ne=arguments[ze];for(j in ne)E[j]=ne[j];for(let Ze=0;Ze<Ft.length;Ze++)j=Ft[Ze],Object.prototype.hasOwnProperty.call(ne,j)&&(E[j]=ne[j])}}function Mn(E){this.src=E,this.g={},this.h=0}Mn.prototype.add=function(E,L,j,ne,ze){const Ze=E.toString();E=this.g[Ze],E||(E=this.g[Ze]=[],this.h++);const ft=Et(E,L,ne,ze);return ft>-1?(L=E[ft],j||(L.fa=!1)):(L=new $t(L,this.src,Ze,!!ne,ze),L.fa=j,E.push(L)),L};function wt(E,L){const j=L.type;if(j in E.g){var ne=E.g[j],ze=Array.prototype.indexOf.call(ne,L,void 0),Ze;(Ze=ze>=0)&&Array.prototype.splice.call(ne,ze,1),Ze&&(mn(L),E.g[j].length==0&&(delete E.g[j],E.h--))}}function Et(E,L,j,ne){for(let ze=0;ze<E.length;++ze){const Ze=E[ze];if(!Ze.da&&Ze.listener==L&&Ze.capture==!!j&&Ze.ha==ne)return ze}return-1}var Cn="closure_lm_"+(Math.random()*1e6|0),Wt={};function Sn(E,L,j,ne,ze){if(Array.isArray(L)){for(let Ze=0;Ze<L.length;Ze++)Sn(E,L[Ze],j,ne,ze);return null}return j=jt(j),E&&E[fn]?E.J(L,j,c(ne)?!!ne.capture:!1,ze):Kt(E,L,j,!1,ne,ze)}function Kt(E,L,j,ne,ze,Ze){if(!L)throw Error("Invalid event type");const ft=c(ze)?!!ze.capture:!!ze;let cn=Pn(E);if(cn||(E[Cn]=cn=new Mn(E)),j=cn.add(L,j,ne,ft,Ze),j.proxy)return j;if(ne=or(),j.proxy=ne,ne.src=E,ne.listener=j,E.addEventListener)fe||(ze=ft),ze===void 0&&(ze=!1),E.addEventListener(L.toString(),ne,ze);else if(E.attachEvent)E.attachEvent(Nt(L.toString()),ne);else if(E.addListener&&E.removeListener)E.addListener(ne);else throw Error("addEventListener and attachEvent are unavailable.");return j}function or(){function E(j){return L.call(E.src,E.listener,j)}const L=en;return E}function Tn(E,L,j,ne,ze){if(Array.isArray(L))for(var Ze=0;Ze<L.length;Ze++)Tn(E,L[Ze],j,ne,ze);else ne=c(ne)?!!ne.capture:!!ne,j=jt(j),E&&E[fn]?(E=E.i,Ze=String(L).toString(),Ze in E.g&&(L=E.g[Ze],j=Et(L,j,ne,ze),j>-1&&(mn(L[j]),Array.prototype.splice.call(L,j,1),L.length==0&&(delete E.g[Ze],E.h--)))):E&&(E=Pn(E))&&(L=E.g[L.toString()],E=-1,L&&(E=Et(L,j,ne,ze)),(j=E>-1?L[E]:null)&&Dn(j))}function Dn(E){if(typeof E!="number"&&E&&!E.da){var L=E.src;if(L&&L[fn])wt(L.i,E);else{var j=E.type,ne=E.proxy;L.removeEventListener?L.removeEventListener(j,ne,E.capture):L.detachEvent?L.detachEvent(Nt(j),ne):L.addListener&&L.removeListener&&L.removeListener(ne),(j=Pn(L))?(wt(j,E),j.h==0&&(j.src=null,L[Cn]=null)):mn(E)}}}function Nt(E){return E in Wt?Wt[E]:Wt[E]="on"+E}function en(E,L){if(E.da)E=!0;else{L=new Jt(L,this);const j=E.listener,ne=E.ha||E.src;E.fa&&Dn(E),E=j.call(ne,L)}return E}function Pn(E){return E=E[Cn],E instanceof Mn?E:null}var Lt="__closure_events_fn_"+(Math.random()*1e9>>>0);function jt(E){return typeof E=="function"?E:(E[Lt]||(E[Lt]=function(L){return E.handleEvent(L)}),E[Lt])}function Vt(){Ee.call(this),this.i=new Mn(this),this.M=this,this.G=null}ee(Vt,Ee),Vt.prototype[fn]=!0,Vt.prototype.removeEventListener=function(E,L,j,ne){Tn(this,E,L,j,ne)};function Mt(E,L){var j,ne=E.G;if(ne)for(j=[];ne;ne=ne.G)j.push(ne);if(E=E.M,ne=L.type||L,typeof L=="string")L=new be(L,E);else if(L instanceof be)L.target=L.target||E;else{var ze=L;L=new be(ne,E),Gt(L,ze)}ze=!0;let Ze,ft;if(j)for(ft=j.length-1;ft>=0;ft--)Ze=L.g=j[ft],ze=rn(Ze,ne,!0,L)&&ze;if(Ze=L.g=E,ze=rn(Ze,ne,!0,L)&&ze,ze=rn(Ze,ne,!1,L)&&ze,j)for(ft=0;ft<j.length;ft++)Ze=L.g=j[ft],ze=rn(Ze,ne,!1,L)&&ze}Vt.prototype.N=function(){if(Vt.Z.N.call(this),this.i){var E=this.i;for(const L in E.g){const j=E.g[L];for(let ne=0;ne<j.length;ne++)mn(j[ne]);delete E.g[L],E.h--}}this.G=null},Vt.prototype.J=function(E,L,j,ne){return this.i.add(String(E),L,!1,j,ne)},Vt.prototype.K=function(E,L,j,ne){return this.i.add(String(E),L,!0,j,ne)};function rn(E,L,j,ne){if(L=E.i.g[String(L)],!L)return!0;L=L.concat();let ze=!0;for(let Ze=0;Ze<L.length;++Ze){const ft=L[Ze];if(ft&&!ft.da&&ft.capture==j){const cn=ft.listener,hr=ft.ha||ft.src;ft.fa&&wt(E.i,ft),ze=cn.call(hr,ne)!==!1&&ze}}return ze&&!ne.defaultPrevented}function dn(E,L){if(typeof E!="function")if(E&&typeof E.handleEvent=="function")E=B(E.handleEvent,E);else throw Error("Invalid listener argument");return Number(L)>2147483647?-1:x.setTimeout(E,L||0)}function _n(E){E.g=dn(()=>{E.g=null,E.i&&(E.i=!1,_n(E))},E.l);const L=E.h;E.h=null,E.m.apply(null,L)}class Yt extends Ee{constructor(L,j){super(),this.m=L,this.l=j,this.h=null,this.i=!1,this.g=null}j(L){this.h=arguments,this.g?this.i=!0:_n(this)}N(){super.N(),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Xt(E){Ee.call(this),this.h=E,this.g={}}ee(Xt,Ee);var Ae=[];function H(E){Pt(E.g,function(L,j){this.g.hasOwnProperty(j)&&Dn(L)},E),E.g={}}Xt.prototype.N=function(){Xt.Z.N.call(this),H(this)},Xt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var G=x.JSON.stringify,K=x.JSON.parse,de=class{stringify(E){return x.JSON.stringify(E,void 0)}parse(E){return x.JSON.parse(E,void 0)}};function ge(){}function N(){}var Se={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function we(){be.call(this,"d")}ee(we,be);function Me(){be.call(this,"c")}ee(Me,be);var He={},Le=null;function tt(){return Le=Le||new Vt}He.Ia="serverreachability";function gt(E){be.call(this,He.Ia,E)}ee(gt,be);function It(E){const L=tt();Mt(L,new gt(L))}He.STAT_EVENT="statevent";function Ht(E,L){be.call(this,He.STAT_EVENT,E),this.stat=L}ee(Ht,be);function zt(E){const L=tt();Mt(L,new Ht(L,E))}He.Ja="timingevent";function Ce(E,L){be.call(this,He.Ja,E),this.size=L}ee(Ce,be);function tn(E,L){if(typeof E!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){E()},L)}function Rn(){this.g=!0}Rn.prototype.ua=function(){this.g=!1};function Rt(E,L,j,ne,ze,Ze){E.info(function(){if(E.g)if(Ze){var ft="",cn=Ze.split("&");for(let an=0;an<cn.length;an++){var hr=cn[an].split("=");if(hr.length>1){const Fr=hr[0];hr=hr[1];const hi=Fr.split("_");ft=hi.length>=2&&hi[1]=="type"?ft+(Fr+"="+hr+"&"):ft+(Fr+"=redacted&")}}}else ft=null;else ft=Ze;return"XMLHTTP REQ ("+ne+") [attempt "+ze+"]: "+L+`
`+j+`
`+ft})}function Re(E,L,j,ne,ze,Ze,ft){E.info(function(){return"XMLHTTP RESP ("+ne+") [ attempt "+ze+"]: "+L+`
`+j+`
`+Ze+" "+ft})}function rt(E,L,j,ne){E.info(function(){return"XMLHTTP TEXT ("+L+"): "+yt(E,j)+(ne?" "+ne:"")})}function Tt(E,L){E.info(function(){return"TIMEOUT: "+L})}Rn.prototype.info=function(){};function yt(E,L){if(!E.g)return L;if(!L)return null;try{const Ze=JSON.parse(L);if(Ze){for(E=0;E<Ze.length;E++)if(Array.isArray(Ze[E])){var j=Ze[E];if(!(j.length<2)){var ne=j[1];if(Array.isArray(ne)&&!(ne.length<1)){var ze=ne[0];if(ze!="noop"&&ze!="stop"&&ze!="close")for(let ft=1;ft<ne.length;ft++)ne[ft]=""}}}}return G(Ze)}catch{return L}}var je={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Qt={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Nn;function cr(){}ee(cr,ge),cr.prototype.g=function(){return new XMLHttpRequest},Nn=new cr;function We(E){return encodeURIComponent(String(E))}function xr(E){var L=1;E=E.split(":");const j=[];for(;L>0&&E.length;)j.push(E.shift()),L--;return E.length&&j.push(E.join(":")),j}function Yn(E,L,j,ne){this.j=E,this.i=L,this.l=j,this.S=ne||1,this.V=new Xt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Zi}function Zi(){this.i=null,this.g="",this.h=!1}var fr={},st={};function At(E,L,j){E.M=1,E.A=Ki(Mr(L)),E.u=j,E.R=!0,Bt(E,null)}function Bt(E,L){E.F=Date.now(),Ct(E),E.B=Mr(E.A);var j=E.B,ne=E.S;Array.isArray(ne)||(ne=[String(ne)]),xo(j.i,"t",ne),E.C=0,j=E.j.L,E.h=new Zi,E.g=tr(E.j,j?L:null,!E.u),E.P>0&&(E.O=new Yt(B(E.Y,E,E.g),E.P)),L=E.V,j=E.g,ne=E.ba;var ze="readystatechange";Array.isArray(ze)||(ze&&(Ae[0]=ze.toString()),ze=Ae);for(let Ze=0;Ze<ze.length;Ze++){const ft=Sn(j,ze[Ze],ne||L.handleEvent,!1,L.h||L);if(!ft)break;L.g[ft.key]=ft}L=E.J?on(E.J):{},E.u?(E.v||(E.v="POST"),L["Content-Type"]="application/x-www-form-urlencoded",E.g.ea(E.B,E.v,E.u,L)):(E.v="GET",E.g.ea(E.B,E.v,null,L)),It(),Rt(E.i,E.v,E.B,E.l,E.S,E.u)}Yn.prototype.ba=function(E){E=E.target;const L=this.O;L&&Er(E)==3?L.j():this.Y(E)},Yn.prototype.Y=function(E){try{if(E==this.g)e:{const cn=Er(this.g),hr=this.g.ya(),an=this.g.ca();if(!(cn<3)&&(cn!=3||this.g&&(this.h.h||this.g.la()||Bs(this.g)))){this.K||cn!=4||hr==7||(hr==8||an<=0?It(3):It(2)),ci(this);var L=this.g.ca();this.X=L;var j=Cr(this);if(this.o=L==200,Re(this.i,this.v,this.B,this.l,this.S,cn,L),this.o){if(this.U&&!this.L){t:{if(this.g){var ne,ze=this.g;if((ne=ze.g?ze.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!pe(ne)){var Ze=ne;break t}}Ze=null}if(E=Ze)rt(this.i,this.l,E,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Wi(this,E);else{this.o=!1,this.m=3,zt(12),Kr(this),Di(this);break e}}if(this.R){E=!0;let Fr;for(;!this.K&&this.C<j.length;)if(Fr=er(this,j),Fr==st){cn==4&&(this.m=4,zt(14),E=!1),rt(this.i,this.l,null,"[Incomplete Response]");break}else if(Fr==fr){this.m=4,zt(15),rt(this.i,this.l,j,"[Invalid Chunk]"),E=!1;break}else rt(this.i,this.l,Fr,null),Wi(this,Fr);if(ki(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),cn!=4||j.length!=0||this.h.h||(this.m=1,zt(16),E=!1),this.o=this.o&&E,!E)rt(this.i,this.l,j,"[Invalid Chunked Response]"),Kr(this),Di(this);else if(j.length>0&&!this.W){this.W=!0;var ft=this.j;ft.g==this&&ft.aa&&!ft.P&&(ft.j.info("Great, no buffering proxy detected. Bytes received: "+j.length),ps(ft),ft.P=!0,zt(11))}}else rt(this.i,this.l,j,null),Wi(this,j);cn==4&&Kr(this),this.o&&!this.K&&(cn==4?Ma(this.j,this):(this.o=!1,Ct(this)))}else ws(this.g),L==400&&j.indexOf("Unknown SID")>0?(this.m=3,zt(12)):(this.m=0,zt(13)),Kr(this),Di(this)}}}catch{}finally{}};function Cr(E){if(!ki(E))return E.g.la();const L=Bs(E.g);if(L==="")return"";let j="";const ne=L.length,ze=Er(E.g)==4;if(!E.h.i){if(typeof TextDecoder>"u")return Kr(E),Di(E),"";E.h.i=new x.TextDecoder}for(let Ze=0;Ze<ne;Ze++)E.h.h=!0,j+=E.h.i.decode(L[Ze],{stream:!(ze&&Ze==ne-1)});return L.length=0,E.h.g+=j,E.C=0,E.h.g}function ki(E){return E.g?E.v=="GET"&&E.M!=2&&E.j.Aa:!1}function er(E,L){var j=E.C,ne=L.indexOf(`
`,j);return ne==-1?st:(j=Number(L.substring(j,ne)),isNaN(j)?fr:(ne+=1,ne+j>L.length?st:(L=L.slice(ne,ne+j),E.C=ne+j,L)))}Yn.prototype.cancel=function(){this.K=!0,Kr(this)};function Ct(E){E.T=Date.now()+E.H,Kn(E,E.H)}function Kn(E,L){if(E.D!=null)throw Error("WatchDog timer not null");E.D=tn(B(E.aa,E),L)}function ci(E){E.D&&(x.clearTimeout(E.D),E.D=null)}Yn.prototype.aa=function(){this.D=null;const E=Date.now();E-this.T>=0?(Tt(this.i,this.B),this.M!=2&&(It(),zt(17)),Kr(this),this.m=2,Di(this)):Kn(this,this.T-E)};function Di(E){E.j.I==0||E.K||Ma(E.j,E)}function Kr(E){ci(E);var L=E.O;L&&typeof L.dispose=="function"&&L.dispose(),E.O=null,H(E.V),E.g&&(L=E.g,E.g=null,L.abort(),L.dispose())}function Wi(E,L){try{var j=E.j;if(j.I!=0&&(j.g==E||as(j.h,E))){if(!E.L&&as(j.h,E)&&j.I==3){try{var ne=j.Ba.g.parse(L)}catch{ne=null}if(Array.isArray(ne)&&ne.length==3){var ze=ne;if(ze[0]==0){e:if(!j.v){if(j.g)if(j.g.F+3e3<E.F)js(j),$n(j);else break e;Us(j),zt(18)}}else j.xa=ze[1],0<j.xa-j.K&&ze[2]<37500&&j.F&&j.A==0&&!j.C&&(j.C=tn(B(j.Va,j),6e3));Ln(j.h)<=1&&j.ta&&(j.ta=void 0)}else qs(j,11)}else if((E.L||j.g==E)&&js(j),!pe(L))for(ze=j.Ba.g.parse(L),L=0;L<ze.length;L++){let an=ze[L];const Fr=an[0];if(!(Fr<=j.K))if(j.K=Fr,an=an[1],j.I==2)if(an[0]=="c"){j.M=an[1],j.ba=an[2];const hi=an[3];hi!=null&&(j.ka=hi,j.j.info("VER="+j.ka));const es=an[4];es!=null&&(j.za=es,j.j.info("SVER="+j.za));const yi=an[5];yi!=null&&typeof yi=="number"&&yi>0&&(ne=1.5*yi,j.O=ne,j.j.info("backChannelRequestTimeoutMs_="+ne)),ne=j;const Hs=E.g;if(Hs){const ro=Hs.g?Hs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ro){var Ze=ne.h;Ze.g||ro.indexOf("spdy")==-1&&ro.indexOf("quic")==-1&&ro.indexOf("h2")==-1||(Ze.j=Ze.l,Ze.g=new Set,Ze.h&&(Xr(Ze,Ze.h),Ze.h=null))}if(ne.G){const xl=Hs.g?Hs.g.getResponseHeader("X-HTTP-Session-Id"):null;xl&&(ne.wa=xl,Fn(ne.J,ne.G,xl))}}j.I=3,j.l&&j.l.ra(),j.aa&&(j.T=Date.now()-E.F,j.j.info("Handshake RTT: "+j.T+"ms")),ne=j;var ft=E;if(ne.na=Ji(ne,ne.L?ne.ba:null,ne.W),ft.L){gi(ne.h,ft);var cn=ft,hr=ne.O;hr&&(cn.H=hr),cn.D&&(ci(cn),Ct(cn)),ne.g=ft}else Ii(ne);j.i.length>0&&vn(j)}else an[0]!="stop"&&an[0]!="close"||qs(j,7);else j.I==3&&(an[0]=="stop"||an[0]=="close"?an[0]=="stop"?qs(j,7):Ts(j):an[0]!="noop"&&j.l&&j.l.qa(an),j.A=0)}}It(4)}catch{}}var os=class{constructor(E,L){this.g=E,this.map=L}};function Li(E){this.l=E||10,x.PerformanceNavigationTiming?(E=x.performance.getEntriesByType("navigation"),E=E.length>0&&(E[0].nextHopProtocol=="hq"||E[0].nextHopProtocol=="h2")):E=!!(x.chrome&&x.chrome.loadTimes&&x.chrome.loadTimes()&&x.chrome.loadTimes().wasFetchedViaSpdy),this.j=E?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function br(E){return E.h?!0:E.g?E.g.size>=E.j:!1}function Ln(E){return E.h?1:E.g?E.g.size:0}function as(E,L){return E.h?E.h==L:E.g?E.g.has(L):!1}function Xr(E,L){E.g?E.g.add(L):E.h=L}function gi(E,L){E.h&&E.h==L?E.h=null:E.g&&E.g.has(L)&&E.g.delete(L)}Li.prototype.cancel=function(){if(this.i=zi(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const E of this.g.values())E.cancel();this.g.clear()}};function zi(E){if(E.h!=null)return E.i.concat(E.h.G);if(E.g!=null&&E.g.size!==0){let L=E.i;for(const j of E.g.values())L=L.concat(j.G);return L}return Ie(E.i)}var Yr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function _o(E,L){if(E){E=E.split("&");for(let j=0;j<E.length;j++){const ne=E[j].indexOf("=");let ze,Ze=null;ne>=0?(ze=E[j].substring(0,ne),Ze=E[j].substring(ne+1)):ze=E[j],L(ze,Ze?decodeURIComponent(Ze.replace(/\+/g," ")):"")}}}function Ur(E){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let L;E instanceof Ur?(this.l=E.l,qn(this,E.j),this.o=E.o,this.g=E.g,ls(this,E.u),this.h=E.h,cs(this,bs(E.i)),this.m=E.m):E&&(L=String(E).match(Yr))?(this.l=!1,qn(this,L[1]||"",!0),this.o=us(L[2]||""),this.g=us(L[3]||"",!0),ls(this,L[4]),this.h=us(L[5]||"",!0),cs(this,L[6]||"",!0),this.m=us(L[7]||"")):(this.l=!1,this.i=new Xi(null,this.l))}Ur.prototype.toString=function(){const E=[];var L=this.j;L&&E.push(hs(L,vo,!0),":");var j=this.g;return(j||L=="file")&&(E.push("//"),(L=this.o)&&E.push(hs(L,vo,!0),"@"),E.push(We(j).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),j=this.u,j!=null&&E.push(":",String(j))),(j=this.h)&&(this.g&&j.charAt(0)!="/"&&E.push("/"),E.push(hs(j,j.charAt(0)=="/"?Ko:Wo,!0))),(j=this.i.toString())&&E.push("?",j),(j=this.m)&&E.push("#",hs(j,gl)),E.join("")},Ur.prototype.resolve=function(E){const L=Mr(this);let j=!!E.j;j?qn(L,E.j):j=!!E.o,j?L.o=E.o:j=!!E.g,j?L.g=E.g:j=E.u!=null;var ne=E.h;if(j)ls(L,E.u);else if(j=!!E.h){if(ne.charAt(0)!="/")if(this.g&&!this.h)ne="/"+ne;else{var ze=L.h.lastIndexOf("/");ze!=-1&&(ne=L.h.slice(0,ze+1)+ne)}if(ze=ne,ze==".."||ze==".")ne="";else if(ze.indexOf("./")!=-1||ze.indexOf("/.")!=-1){ne=ze.lastIndexOf("/",0)==0,ze=ze.split("/");const Ze=[];for(let ft=0;ft<ze.length;){const cn=ze[ft++];cn=="."?ne&&ft==ze.length&&Ze.push(""):cn==".."?((Ze.length>1||Ze.length==1&&Ze[0]!="")&&Ze.pop(),ne&&ft==ze.length&&Ze.push("")):(Ze.push(cn),ne=!0)}ne=Ze.join("/")}else ne=ze}return j?L.h=ne:j=E.i.toString()!=="",j?cs(L,bs(E.i)):j=!!E.m,j&&(L.m=E.m),L};function Mr(E){return new Ur(E)}function qn(E,L,j){E.j=j?us(L,!0):L,E.j&&(E.j=E.j.replace(/:$/,""))}function ls(E,L){if(L){if(L=Number(L),isNaN(L)||L<0)throw Error("Bad port number "+L);E.u=L}else E.u=null}function cs(E,L,j){L instanceof Xi?(E.i=L,gn(E.i,E.l)):(j||(L=hs(L,Xo)),E.i=new Xi(L,E.l))}function Fn(E,L,j){E.i.set(L,j)}function Ki(E){return Fn(E,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),E}function us(E,L){return E?L?decodeURI(E.replace(/%25/g,"%2525")):decodeURIComponent(E):""}function hs(E,L,j){return typeof E=="string"?(E=encodeURI(E).replace(L,yo),j&&(E=E.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),E):null}function yo(E){return E=E.charCodeAt(0),"%"+(E>>4&15).toString(16)+(E&15).toString(16)}var vo=/[#\/\?@]/g,Wo=/[#\?:]/g,Ko=/[#\?]/g,Xo=/[#\?@]/g,gl=/#/g;function Xi(E,L){this.h=this.g=null,this.i=E||null,this.j=!!L}function Fi(E){E.g||(E.g=new Map,E.h=0,E.i&&_o(E.i,function(L,j){E.add(decodeURIComponent(L.replace(/\+/g," ")),j)}))}a=Xi.prototype,a.add=function(E,L){Fi(this),this.i=null,E=Yi(this,E);let j=this.g.get(E);return j||this.g.set(E,j=[]),j.push(L),this.h+=1,this};function Yo(E,L){Fi(E),L=Yi(E,L),E.g.has(L)&&(E.i=null,E.h-=E.g.get(L).length,E.g.delete(L))}function Js(E,L){return Fi(E),L=Yi(E,L),E.g.has(L)}a.forEach=function(E,L){Fi(this),this.g.forEach(function(j,ne){j.forEach(function(ze){E.call(L,ze,ne,this)},this)},this)};function Aa(E,L){Fi(E);let j=[];if(typeof L=="string")Js(E,L)&&(j=j.concat(E.g.get(Yi(E,L))));else for(E=Array.from(E.g.values()),L=0;L<E.length;L++)j=j.concat(E[L]);return j}a.set=function(E,L){return Fi(this),this.i=null,E=Yi(this,E),Js(this,E)&&(this.h-=this.g.get(E).length),this.g.set(E,[L]),this.h+=1,this},a.get=function(E,L){return E?(E=Aa(this,E),E.length>0?String(E[0]):L):L};function xo(E,L,j){Yo(E,L),j.length>0&&(E.i=null,E.g.set(Yi(E,L),Ie(j)),E.h+=j.length)}a.toString=function(){if(this.i)return this.i;if(!this.g)return"";const E=[],L=Array.from(this.g.keys());for(let ne=0;ne<L.length;ne++){var j=L[ne];const ze=We(j);j=Aa(this,j);for(let Ze=0;Ze<j.length;Ze++){let ft=ze;j[Ze]!==""&&(ft+="="+We(j[Ze])),E.push(ft)}}return this.i=E.join("&")};function bs(E){const L=new Xi;return L.i=E.i,E.g&&(L.g=new Map(E.g),L.h=E.h),L}function Yi(E,L){return L=String(L),E.j&&(L=L.toLowerCase()),L}function gn(E,L){L&&!E.j&&(Fi(E),E.i=null,E.g.forEach(function(j,ne){const ze=ne.toLowerCase();ne!=ze&&(Yo(this,ne),xo(this,ze,j))},E)),E.j=L}function _l(E,L){const j=new Rn;if(x.Image){const ne=new Image;ne.onload=W(ds,j,"TestLoadImage: loaded",!0,L,ne),ne.onerror=W(ds,j,"TestLoadImage: error",!1,L,ne),ne.onabort=W(ds,j,"TestLoadImage: abort",!1,L,ne),ne.ontimeout=W(ds,j,"TestLoadImage: timeout",!1,L,ne),x.setTimeout(function(){ne.ontimeout&&ne.ontimeout()},1e4),ne.src=E}else L(!1)}function $u(E,L){const j=new Rn,ne=new AbortController,ze=setTimeout(()=>{ne.abort(),ds(j,"TestPingServer: timeout",!1,L)},1e4);fetch(E,{signal:ne.signal}).then(Ze=>{clearTimeout(ze),Ze.ok?ds(j,"TestPingServer: ok",!0,L):ds(j,"TestPingServer: server error",!1,L)}).catch(()=>{clearTimeout(ze),ds(j,"TestPingServer: error",!1,L)})}function ds(E,L,j,ne,ze){try{ze&&(ze.onload=null,ze.onerror=null,ze.onabort=null,ze.ontimeout=null),ne(j)}catch{}}function _i(){this.g=new de}function jr(E){this.i=E.Sb||null,this.h=E.ab||!1}ee(jr,ge),jr.prototype.g=function(){return new Qn(this.i,this.h)};function Qn(E,L){Vt.call(this),this.H=E,this.o=L,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}ee(Qn,Vt),a=Qn.prototype,a.open=function(E,L){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=E,this.D=L,this.readyState=1,Oi(this)},a.send=function(E){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const L={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};E&&(L.body=E),(this.H||x).fetch(new Request(this.D,L)).then(this.Pa.bind(this),this.ga.bind(this))},a.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Vn(this)),this.readyState=0},a.Pa=function(E){if(this.g&&(this.l=E,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=E.headers,this.readyState=2,Oi(this)),this.g&&(this.readyState=3,Oi(this),this.g)))if(this.responseType==="arraybuffer")E.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof x.ReadableStream<"u"&&"body"in E){if(this.j=E.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;qt(this)}else E.text().then(this.Oa.bind(this),this.ga.bind(this))};function qt(E){E.j.read().then(E.Ma.bind(E)).catch(E.ga.bind(E))}a.Ma=function(E){if(this.g){if(this.o&&E.value)this.response.push(E.value);else if(!this.o){var L=E.value?E.value:new Uint8Array(0);(L=this.B.decode(L,{stream:!E.done}))&&(this.response=this.responseText+=L)}E.done?Vn(this):Oi(this),this.readyState==3&&qt(this)}},a.Oa=function(E){this.g&&(this.response=this.responseText=E,Vn(this))},a.Na=function(E){this.g&&(this.response=E,Vn(this))},a.ga=function(){this.g&&Vn(this)};function Vn(E){E.readyState=4,E.l=null,E.j=null,E.B=null,Oi(E)}a.setRequestHeader=function(E,L){this.A.append(E,L)},a.getResponseHeader=function(E){return this.h&&this.h.get(E.toLowerCase())||""},a.getAllResponseHeaders=function(){if(!this.h)return"";const E=[],L=this.h.entries();for(var j=L.next();!j.done;)j=j.value,E.push(j[0]+": "+j[1]),j=L.next();return E.join(`\r
`)};function Oi(E){E.onreadystatechange&&E.onreadystatechange.call(E)}Object.defineProperty(Qn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(E){this.m=E?"include":"same-origin"}});function Qr(E){let L="";return Pt(E,function(j,ne){L+=ne,L+=":",L+=j,L+=`\r
`}),L}function ui(E,L,j){e:{for(ne in j){var ne=!1;break e}ne=!0}ne||(j=Qr(j),typeof E=="string"?j!=null&&We(j):Fn(E,L,j))}function kn(E){Vt.call(this),this.headers=new Map,this.L=E||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}ee(kn,Vt);var bo=/^https?$/i,Ns=["POST","PUT"];a=kn.prototype,a.Fa=function(E){this.H=E},a.ea=function(E,L,j,ne){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+E);L=L?L.toUpperCase():"GET",this.D=E,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Nn.g(),this.g.onreadystatechange=ce(B(this.Ca,this));try{this.B=!0,this.g.open(L,String(E),!0),this.B=!1}catch(Ze){mr(this,Ze);return}if(E=j||"",j=new Map(this.headers),ne)if(Object.getPrototypeOf(ne)===Object.prototype)for(var ze in ne)j.set(ze,ne[ze]);else if(typeof ne.keys=="function"&&typeof ne.get=="function")for(const Ze of ne.keys())j.set(Ze,ne.get(Ze));else throw Error("Unknown input type for opt_headers: "+String(ne));ne=Array.from(j.keys()).find(Ze=>Ze.toLowerCase()=="content-type"),ze=x.FormData&&E instanceof x.FormData,!(Array.prototype.indexOf.call(Ns,L,void 0)>=0)||ne||ze||j.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Ze,ft]of j)this.g.setRequestHeader(Ze,ft);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(E),this.v=!1}catch(Ze){mr(this,Ze)}};function mr(E,L){E.h=!1,E.g&&(E.j=!0,E.g.abort(),E.j=!1),E.l=L,E.o=5,Vs(E),eo(E)}function Vs(E){E.A||(E.A=!0,Mt(E,"complete"),Mt(E,"error"))}a.abort=function(E){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=E||7,Mt(this,"complete"),Mt(this,"abort"),eo(this))},a.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),eo(this,!0)),kn.Z.N.call(this)},a.Ca=function(){this.u||(this.B||this.v||this.j?Qi(this):this.Xa())},a.Xa=function(){Qi(this)};function Qi(E){if(E.h&&typeof w<"u"){if(E.v&&Er(E)==4)setTimeout(E.Ca.bind(E),0);else if(Mt(E,"readystatechange"),Er(E)==4){E.h=!1;try{const Ze=E.ca();e:switch(Ze){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var L=!0;break e;default:L=!1}var j;if(!(j=L)){var ne;if(ne=Ze===0){let ft=String(E.D).match(Yr)[1]||null;!ft&&x.self&&x.self.location&&(ft=x.self.location.protocol.slice(0,-1)),ne=!bo.test(ft?ft.toLowerCase():"")}j=ne}if(j)Mt(E,"complete"),Mt(E,"success");else{E.o=6;try{var ze=Er(E)>2?E.g.statusText:""}catch{ze=""}E.l=ze+" ["+E.ca()+"]",Vs(E)}}finally{eo(E)}}}}function eo(E,L){if(E.g){E.m&&(clearTimeout(E.m),E.m=null);const j=E.g;E.g=null,L||Mt(E,"ready");try{j.onreadystatechange=null}catch{}}}a.isActive=function(){return!!this.g};function Er(E){return E.g?E.g.readyState:0}a.ca=function(){try{return Er(this)>2?this.g.status:-1}catch{return-1}},a.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},a.La=function(E){if(this.g){var L=this.g.responseText;return E&&L.indexOf(E)==0&&(L=L.substring(E.length)),K(L)}};function Bs(E){try{if(!E.g)return null;if("response"in E.g)return E.g.response;switch(E.F){case"":case"text":return E.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in E.g)return E.g.mozResponseArrayBuffer}return null}catch{return null}}function ws(E){const L={};E=(E.g&&Er(E)>=2&&E.g.getAllResponseHeaders()||"").split(`\r
`);for(let ne=0;ne<E.length;ne++){if(pe(E[ne]))continue;var j=xr(E[ne]);const ze=j[0];if(j=j[1],typeof j!="string")continue;j=j.trim();const Ze=L[ze]||[];L[ze]=Ze,Ze.push(j)}zn(L,function(ne){return ne.join(", ")})}a.ya=function(){return this.o},a.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function wo(E,L,j){return j&&j.internalChannelParams&&j.internalChannelParams[E]||L}function Ca(E){this.za=0,this.i=[],this.j=new Rn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=wo("failFast",!1,E),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=wo("baseRetryDelayMs",5e3,E),this.Za=wo("retryDelaySeedMs",1e4,E),this.Ta=wo("forwardChannelMaxRetries",2,E),this.va=wo("forwardChannelRequestTimeoutMs",2e4,E),this.ma=E&&E.xmlHttpFactory||void 0,this.Ua=E&&E.Rb||void 0,this.Aa=E&&E.useFetchStreams||!1,this.O=void 0,this.L=E&&E.supportsCrossDomainXhr||!1,this.M="",this.h=new Li(E&&E.concurrentRequestLimit),this.Ba=new _i,this.S=E&&E.fastHandshake||!1,this.R=E&&E.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=E&&E.Pb||!1,E&&E.ua&&this.j.ua(),E&&E.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&E&&E.detectBufferingProxy||!1,this.ia=void 0,E&&E.longPollingTimeout&&E.longPollingTimeout>0&&(this.ia=E.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}a=Ca.prototype,a.ka=8,a.I=1,a.connect=function(E,L,j,ne){zt(0),this.W=E,this.H=L||{},j&&ne!==void 0&&(this.H.OSID=j,this.H.OAID=ne),this.F=this.X,this.J=Ji(this,null,this.W),vn(this)};function Ts(E){if(to(E),E.I==3){var L=E.V++,j=Mr(E.J);if(Fn(j,"SID",E.M),Fn(j,"RID",L),Fn(j,"TYPE","terminate"),xn(E,j),L=new Yn(E,E.j,L),L.M=2,L.A=Ki(Mr(j)),j=!1,x.navigator&&x.navigator.sendBeacon)try{j=x.navigator.sendBeacon(L.A.toString(),"")}catch{}!j&&x.Image&&(new Image().src=L.A,j=!0),j||(L.g=tr(L.j,null),L.g.ea(L.A)),L.F=Date.now(),Ct(L)}Jr(E)}function $n(E){E.g&&(ps(E),E.g.cancel(),E.g=null)}function to(E){$n(E),E.v&&(x.clearTimeout(E.v),E.v=null),js(E),E.h.cancel(),E.m&&(typeof E.m=="number"&&x.clearTimeout(E.m),E.m=null)}function vn(E){if(!br(E.h)&&!E.m){E.m=!0;var L=E.Ea;ct||se(),ot||(ct(),ot=!0),xe.add(L,E),E.D=0}}function ln(E,L){return Ln(E.h)>=E.h.j-(E.m?1:0)?!1:E.m?(E.i=L.G.concat(E.i),!0):E.I==1||E.I==2||E.D>=(E.Sa?0:E.Ta)?!1:(E.m=tn(B(E.Ea,E,L),bc(E,E.D)),E.D++,!0)}a.Ea=function(E){if(this.m)if(this.m=null,this.I==1){if(!E){this.V=Math.floor(Math.random()*1e5),E=this.V++;const ze=new Yn(this,this.j,E);let Ze=this.o;if(this.U&&(Ze?(Ze=on(Ze),Gt(Ze,this.U)):Ze=this.U),this.u!==null||this.R||(ze.J=Ze,Ze=null),this.S)e:{for(var L=0,j=0;j<this.i.length;j++){t:{var ne=this.i[j];if("__data__"in ne.map&&(ne=ne.map.__data__,typeof ne=="string")){ne=ne.length;break t}ne=void 0}if(ne===void 0)break;if(L+=ne,L>4096){L=j;break e}if(L===4096||j===this.i.length-1){L=j+1;break e}}L=1e3}else L=1e3;L=To(this,ze,L),j=Mr(this.J),Fn(j,"RID",E),Fn(j,"CVER",22),this.G&&Fn(j,"X-HTTP-Session-Id",this.G),xn(this,j),Ze&&(this.R?L="headers="+We(Qr(Ze))+"&"+L:this.u&&ui(j,this.u,Ze)),Xr(this.h,ze),this.Ra&&Fn(j,"TYPE","init"),this.S?(Fn(j,"$req",L),Fn(j,"SID","null"),ze.U=!0,At(ze,j,null)):At(ze,j,L),this.I=2}}else this.I==3&&(E?no(this,E):this.i.length==0||br(this.h)||no(this))};function no(E,L){var j;L?j=L.l:j=E.V++;const ne=Mr(E.J);Fn(ne,"SID",E.M),Fn(ne,"RID",j),Fn(ne,"AID",E.K),xn(E,ne),E.u&&E.o&&ui(ne,E.u,E.o),j=new Yn(E,E.j,j,E.D+1),E.u===null&&(j.J=E.o),L&&(E.i=L.G.concat(E.i)),L=To(E,j,1e3),j.H=Math.round(E.va*.5)+Math.round(E.va*.5*Math.random()),Xr(E.h,j),At(j,ne,L)}function xn(E,L){E.H&&Pt(E.H,function(j,ne){Fn(L,ne,j)}),E.l&&Pt({},function(j,ne){Fn(L,ne,j)})}function To(E,L,j){j=Math.min(E.i.length,j);const ne=E.l?B(E.l.Ka,E.l,E):null;e:{var ze=E.i;let cn=-1;for(;;){const hr=["count="+j];cn==-1?j>0?(cn=ze[0].g,hr.push("ofs="+cn)):cn=0:hr.push("ofs="+cn);let an=!0;for(let Fr=0;Fr<j;Fr++){var Ze=ze[Fr].g;const hi=ze[Fr].map;if(Ze-=cn,Ze<0)cn=Math.max(0,ze[Fr].g-100),an=!1;else try{Ze="req"+Ze+"_"||"";try{var ft=hi instanceof Map?hi:Object.entries(hi);for(const[es,yi]of ft){let Hs=yi;c(yi)&&(Hs=G(yi)),hr.push(Ze+es+"="+encodeURIComponent(Hs))}}catch(es){throw hr.push(Ze+"type="+encodeURIComponent("_badmap")),es}}catch{ne&&ne(hi)}}if(an){ft=hr.join("&");break e}}ft=void 0}return E=E.i.splice(0,j),L.G=E,ft}function Ii(E){if(!E.g&&!E.v){E.Y=1;var L=E.Da;ct||se(),ot||(ct(),ot=!0),xe.add(L,E),E.A=0}}function Us(E){return E.g||E.v||E.A>=3?!1:(E.Y++,E.v=tn(B(E.Da,E),bc(E,E.A)),E.A++,!0)}a.Da=function(){if(this.v=null,yl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var E=4*this.T;this.j.info("BP detection timer enabled: "+E),this.B=tn(B(this.Wa,this),E)}},a.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,zt(10),$n(this),yl(this))};function ps(E){E.B!=null&&(x.clearTimeout(E.B),E.B=null)}function yl(E){E.g=new Yn(E,E.j,"rpc",E.Y),E.u===null&&(E.g.J=E.o),E.g.P=0;var L=Mr(E.na);Fn(L,"RID","rpc"),Fn(L,"SID",E.M),Fn(L,"AID",E.K),Fn(L,"CI",E.F?"0":"1"),!E.F&&E.ia&&Fn(L,"TO",E.ia),Fn(L,"TYPE","xmlhttp"),xn(E,L),E.u&&E.o&&ui(L,E.u,E.o),E.O&&(E.g.H=E.O);var j=E.g;E=E.ba,j.M=1,j.A=Ki(Mr(L)),j.u=null,j.R=!0,Bt(j,E)}a.Va=function(){this.C!=null&&(this.C=null,$n(this),Us(this),zt(19))};function js(E){E.C!=null&&(x.clearTimeout(E.C),E.C=null)}function Ma(E,L){var j=null;if(E.g==L){js(E),ps(E),E.g=null;var ne=2}else if(as(E.h,L))j=L.G,gi(E.h,L),ne=1;else return;if(E.I!=0){if(L.o)if(ne==1){j=L.u?L.u.length:0,L=Date.now()-L.F;var ze=E.D;ne=tt(),Mt(ne,new Ce(ne,j)),vn(E)}else Ii(E);else if(ze=L.m,ze==3||ze==0&&L.X>0||!(ne==1&&ln(E,L)||ne==2&&Us(E)))switch(j&&j.length>0&&(L=E.h,L.i=L.i.concat(j)),ze){case 1:qs(E,5);break;case 4:qs(E,10);break;case 3:qs(E,6);break;default:qs(E,2)}}}function bc(E,L){let j=E.Qa+Math.floor(Math.random()*E.Za);return E.isActive()||(j*=2),j*L}function qs(E,L){if(E.j.info("Error code "+L),L==2){var j=B(E.bb,E),ne=E.Ua;const ze=!ne;ne=new Ur(ne||"//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||qn(ne,"https"),Ki(ne),ze?_l(ne.toString(),j):$u(ne.toString(),j)}else zt(2);E.I=0,E.l&&E.l.pa(L),Jr(E),to(E)}a.bb=function(E){E?(this.j.info("Successfully pinged google.com"),zt(2)):(this.j.info("Failed to ping google.com"),zt(1))};function Jr(E){if(E.I=0,E.ja=[],E.l){const L=zi(E.h);(L.length!=0||E.i.length!=0)&&(Ue(E.ja,L),Ue(E.ja,E.i),E.h.i.length=0,Ie(E.i),E.i.length=0),E.l.oa()}}function Ji(E,L,j){var ne=j instanceof Ur?Mr(j):new Ur(j);if(ne.g!="")L&&(ne.g=L+"."+ne.g),ls(ne,ne.u);else{var ze=x.location;ne=ze.protocol,L=L?L+"."+ze.hostname:ze.hostname,ze=+ze.port;const Ze=new Ur(null);ne&&qn(Ze,ne),L&&(Ze.g=L),ze&&ls(Ze,ze),j&&(Ze.h=j),ne=Ze}return j=E.G,L=E.wa,j&&L&&Fn(ne,j,L),Fn(ne,"VER",E.ka),xn(E,ne),ne}function tr(E,L,j){if(L&&!E.L)throw Error("Can't create secondary domain capable XhrIo object.");return L=E.Aa&&!E.ma?new kn(new jr({ab:j})):new kn(E.ma),L.Fa(E.L),L}a.isActive=function(){return!!this.l&&this.l.isActive(this)};function $s(){}a=$s.prototype,a.ra=function(){},a.qa=function(){},a.pa=function(){},a.oa=function(){},a.isActive=function(){return!0},a.Ka=function(){};function Eo(){}Eo.prototype.g=function(E,L){return new Gr(E,L)};function Gr(E,L){Vt.call(this),this.g=new Ca(L),this.l=E,this.h=L&&L.messageUrlParams||null,E=L&&L.messageHeaders||null,L&&L.clientProtocolHeaderRequired&&(E?E["X-Client-Protocol"]="webchannel":E={"X-Client-Protocol":"webchannel"}),this.g.o=E,E=L&&L.initMessageHeaders||null,L&&L.messageContentType&&(E?E["X-WebChannel-Content-Type"]=L.messageContentType:E={"X-WebChannel-Content-Type":L.messageContentType}),L&&L.sa&&(E?E["X-WebChannel-Client-Profile"]=L.sa:E={"X-WebChannel-Client-Profile":L.sa}),this.g.U=E,(E=L&&L.Qb)&&!pe(E)&&(this.g.u=E),this.A=L&&L.supportsCrossDomainXhr||!1,this.v=L&&L.sendRawJson||!1,(L=L&&L.httpSessionIdParam)&&!pe(L)&&(this.g.G=L,E=this.h,E!==null&&L in E&&(E=this.h,L in E&&delete E[L])),this.j=new Gs(this)}ee(Gr,Vt),Gr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Gr.prototype.close=function(){Ts(this.g)},Gr.prototype.o=function(E){var L=this.g;if(typeof E=="string"){var j={};j.__data__=E,E=j}else this.v&&(j={},j.__data__=G(E),E=j);L.i.push(new os(L.Ya++,E)),L.I==3&&vn(L)},Gr.prototype.N=function(){this.g.l=null,delete this.j,Ts(this.g),delete this.g,Gr.Z.N.call(this)};function ur(E){we.call(this),E.__headers__&&(this.headers=E.__headers__,this.statusCode=E.__status__,delete E.__headers__,delete E.__status__);var L=E.__sm__;if(L){e:{for(const j in L){E=j;break e}E=void 0}(this.i=E)&&(E=this.i,L=L!==null&&E in L?L[E]:void 0),this.data=L}else this.data=E}ee(ur,we);function vl(){Me.call(this),this.status=1}ee(vl,Me);function Gs(E){this.g=E}ee(Gs,$s),Gs.prototype.ra=function(){Mt(this.g,"a")},Gs.prototype.qa=function(E){Mt(this.g,new ur(E))},Gs.prototype.pa=function(E){Mt(this.g,new vl)},Gs.prototype.oa=function(){Mt(this.g,"b")},Eo.prototype.createWebChannel=Eo.prototype.g,Gr.prototype.send=Gr.prototype.o,Gr.prototype.open=Gr.prototype.m,Gr.prototype.close=Gr.prototype.close,Jb=function(){return new Eo},Qb=function(){return tt()},Yb=He,Kg={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},je.NO_ERROR=0,je.TIMEOUT=8,je.HTTP_ERROR=6,tf=je,Qt.COMPLETE="complete",Xb=Qt,N.EventType=Se,Se.OPEN="a",Se.CLOSE="b",Se.ERROR="c",Se.MESSAGE="d",Vt.prototype.listen=Vt.prototype.J,Xh=N,kn.prototype.listenOnce=kn.prototype.K,kn.prototype.getLastError=kn.prototype.Ha,kn.prototype.getLastErrorCode=kn.prototype.ya,kn.prototype.getStatus=kn.prototype.ca,kn.prototype.getResponseJson=kn.prototype.La,kn.prototype.getResponseText=kn.prototype.la,kn.prototype.send=kn.prototype.ea,kn.prototype.setWithCredentials=kn.prototype.Fa,Kb=kn}).apply(typeof Gp<"u"?Gp:typeof self<"u"?self:typeof window<"u"?window:{});const Z0="@firebase/firestore",W0="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(n){this.uid=n}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(n){return n.uid===this.uid}}qi.UNAUTHENTICATED=new qi(null),qi.GOOGLE_CREDENTIALS=new qi("google-credentials-uid"),qi.FIRST_PARTY=new qi("first-party-uid"),qi.MOCK_USER=new qi("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vu="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hc=new w_("@firebase/firestore");function bu(){return hc.logLevel}function Dt(a,...n){if(hc.logLevel<=Bn.DEBUG){const o=n.map(I_);hc.debug(`Firestore (${Vu}): ${a}`,...o)}}function Ta(a,...n){if(hc.logLevel<=Bn.ERROR){const o=n.map(I_);hc.error(`Firestore (${Vu}): ${a}`,...o)}}function ku(a,...n){if(hc.logLevel<=Bn.WARN){const o=n.map(I_);hc.warn(`Firestore (${Vu}): ${a}`,...o)}}function I_(a){if(typeof a=="string")return a;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(o){return JSON.stringify(o)}(a)}catch{return a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(a,n,o){let d="Unexpected state";typeof n=="string"?d=n:o=n,e1(a,d,o)}function e1(a,n,o){let d=`FIRESTORE (${Vu}) INTERNAL ASSERTION FAILED: ${n} (ID: ${a.toString(16)})`;if(o!==void 0)try{d+=" CONTEXT: "+JSON.stringify(o)}catch{d+=" CONTEXT: "+o}throw Ta(d),new Error(d)}function sr(a,n,o,d){let g="Unexpected state";typeof o=="string"?g=o:d=o,a||e1(n,g,d)}function wn(a,n){return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Zt extends Go{constructor(n,o){super(n,o),this.code=n,this.message=o,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(){this.promise=new Promise((n,o)=>{this.resolve=n,this.reject=o})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1{constructor(n,o){this.user=o,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${n}`)}}class RP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(n,o){n.enqueueRetryable(()=>o(qi.UNAUTHENTICATED))}shutdown(){}}class kP{constructor(n){this.token=n,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(n,o){this.changeListener=o,n.enqueueRetryable(()=>o(this.token.user))}shutdown(){this.changeListener=null}}class DP{constructor(n){this.t=n,this.currentUser=qi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(n,o){sr(this.o===void 0,42304);let d=this.i;const g=R=>this.i!==d?(d=this.i,o(R)):Promise.resolve();let w=new ac;this.o=()=>{this.i++,this.currentUser=this.u(),w.resolve(),w=new ac,n.enqueueRetryable(()=>g(this.currentUser))};const x=()=>{const R=w;n.enqueueRetryable(async()=>{await R.promise,await g(this.currentUser)})},c=R=>{Dt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=R,this.o&&(this.auth.addAuthTokenListener(this.o),x())};this.t.onInit(R=>c(R)),setTimeout(()=>{if(!this.auth){const R=this.t.getImmediate({optional:!0});R?c(R):(Dt("FirebaseAuthCredentialsProvider","Auth not yet detected"),w.resolve(),w=new ac)}},0),x()}getToken(){const n=this.i,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then(d=>this.i!==n?(Dt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):d?(sr(typeof d.accessToken=="string",31837,{l:d}),new t1(d.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const n=this.auth&&this.auth.getUid();return sr(n===null||typeof n=="string",2055,{h:n}),new qi(n)}}class LP{constructor(n,o,d){this.P=n,this.T=o,this.I=d,this.type="FirstParty",this.user=qi.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const n=this.R();return n&&this.A.set("Authorization",n),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class zP{constructor(n,o,d){this.P=n,this.T=o,this.I=d}getToken(){return Promise.resolve(new LP(this.P,this.T,this.I))}start(n,o){n.enqueueRetryable(()=>o(qi.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class K0{constructor(n){this.value=n,this.type="AppCheck",this.headers=new Map,n&&n.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class FP{constructor(n,o){this.V=o,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,xs(n)&&n.settings.appCheckToken&&(this.p=n.settings.appCheckToken)}start(n,o){sr(this.o===void 0,3512);const d=w=>{w.error!=null&&Dt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${w.error.message}`);const x=w.token!==this.m;return this.m=w.token,Dt("FirebaseAppCheckTokenProvider",`Received ${x?"new":"existing"} token.`),x?o(w.token):Promise.resolve()};this.o=w=>{n.enqueueRetryable(()=>d(w))};const g=w=>{Dt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=w,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(w=>g(w)),setTimeout(()=>{if(!this.appCheck){const w=this.V.getImmediate({optional:!0});w?g(w):Dt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new K0(this.p));const n=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(n).then(o=>o?(sr(typeof o.token=="string",44558,{tokenResult:o}),this.m=o.token,new K0(o.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OP(a){const n=typeof self<"u"&&(self.crypto||self.msCrypto),o=new Uint8Array(a);if(n&&typeof n.getRandomValues=="function")n.getRandomValues(o);else for(let d=0;d<a;d++)o[d]=Math.floor(256*Math.random());return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_{static newId(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=62*Math.floor(4.129032258064516);let d="";for(;d.length<20;){const g=OP(40);for(let w=0;w<g.length;++w)d.length<20&&g[w]<o&&(d+=n.charAt(g[w]%62))}return d}}function Un(a,n){return a<n?-1:a>n?1:0}function Xg(a,n){const o=Math.min(a.length,n.length);for(let d=0;d<o;d++){const g=a.charAt(d),w=n.charAt(d);if(g!==w)return Rg(g)===Rg(w)?Un(g,w):Rg(g)?1:-1}return Un(a.length,n.length)}const NP=55296,VP=57343;function Rg(a){const n=a.charCodeAt(0);return n>=NP&&n<=VP}function Du(a,n,o){return a.length===n.length&&a.every((d,g)=>o(d,n[g]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X0="__name__";class zo{constructor(n,o,d){o===void 0?o=0:o>n.length&&hn(637,{offset:o,range:n.length}),d===void 0?d=n.length-o:d>n.length-o&&hn(1746,{length:d,range:n.length-o}),this.segments=n,this.offset=o,this.len=d}get length(){return this.len}isEqual(n){return zo.comparator(this,n)===0}child(n){const o=this.segments.slice(this.offset,this.limit());return n instanceof zo?n.forEach(d=>{o.push(d)}):o.push(n),this.construct(o)}limit(){return this.offset+this.length}popFirst(n){return n=n===void 0?1:n,this.construct(this.segments,this.offset+n,this.length-n)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(n){return this.segments[this.offset+n]}isEmpty(){return this.length===0}isPrefixOf(n){if(n.length<this.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==n.get(o))return!1;return!0}isImmediateParentOf(n){if(this.length+1!==n.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==n.get(o))return!1;return!0}forEach(n){for(let o=this.offset,d=this.limit();o<d;o++)n(this.segments[o])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(n,o){const d=Math.min(n.length,o.length);for(let g=0;g<d;g++){const w=zo.compareSegments(n.get(g),o.get(g));if(w!==0)return w}return Un(n.length,o.length)}static compareSegments(n,o){const d=zo.isNumericId(n),g=zo.isNumericId(o);return d&&!g?-1:!d&&g?1:d&&g?zo.extractNumericId(n).compare(zo.extractNumericId(o)):Xg(n,o)}static isNumericId(n){return n.startsWith("__id")&&n.endsWith("__")}static extractNumericId(n){return ll.fromString(n.substring(4,n.length-2))}}class Vr extends zo{construct(n,o,d){return new Vr(n,o,d)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...n){const o=[];for(const d of n){if(d.indexOf("//")>=0)throw new Zt(lt.INVALID_ARGUMENT,`Invalid segment (${d}). Paths must not contain // in them.`);o.push(...d.split("/").filter(g=>g.length>0))}return new Vr(o)}static emptyPath(){return new Vr([])}}const BP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ci extends zo{construct(n,o,d){return new Ci(n,o,d)}static isValidIdentifier(n){return BP.test(n)}canonicalString(){return this.toArray().map(n=>(n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ci.isValidIdentifier(n)||(n="`"+n+"`"),n)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===X0}static keyField(){return new Ci([X0])}static fromServerFormat(n){const o=[];let d="",g=0;const w=()=>{if(d.length===0)throw new Zt(lt.INVALID_ARGUMENT,`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);o.push(d),d=""};let x=!1;for(;g<n.length;){const c=n[g];if(c==="\\"){if(g+1===n.length)throw new Zt(lt.INVALID_ARGUMENT,"Path has trailing escape character: "+n);const R=n[g+1];if(R!=="\\"&&R!=="."&&R!=="`")throw new Zt(lt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);d+=R,g+=2}else c==="`"?(x=!x,g++):c!=="."||x?(d+=c,g++):(w(),g++)}if(w(),x)throw new Zt(lt.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new Ci(o)}static emptyPath(){return new Ci([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(n){this.path=n}static fromPath(n){return new nn(Vr.fromString(n))}static fromName(n){return new nn(Vr.fromString(n).popFirst(5))}static empty(){return new nn(Vr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(n){return this.path.length>=2&&this.path.get(this.path.length-2)===n}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(n){return n!==null&&Vr.comparator(this.path,n.path)===0}toString(){return this.path.toString()}static comparator(n,o){return Vr.comparator(n.path,o.path)}static isDocumentKey(n){return n.length%2==0}static fromSegments(n){return new nn(new Vr(n.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UP(a,n,o){if(!o)throw new Zt(lt.INVALID_ARGUMENT,`Function ${a}() cannot be called with an empty ${n}.`)}function jP(a,n,o,d){if(n===!0&&d===!0)throw new Zt(lt.INVALID_ARGUMENT,`${a} and ${o} cannot be used together.`)}function Y0(a){if(!nn.isDocumentKey(a))throw new Zt(lt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${a} has ${a.length}.`)}function n1(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}function P_(a){if(a===void 0)return"undefined";if(a===null)return"null";if(typeof a=="string")return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if(typeof a=="number"||typeof a=="boolean")return""+a;if(typeof a=="object"){if(a instanceof Array)return"an array";{const n=function(d){return d.constructor?d.constructor.name:null}(a);return n?`a custom ${n} object`:"an object"}}return typeof a=="function"?"a function":hn(12329,{type:typeof a})}function Su(a,n){if("_delegate"in a&&(a=a._delegate),!(a instanceof n)){if(n.name===a.constructor.name)throw new Zt(lt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const o=P_(a);throw new Zt(lt.INVALID_ARGUMENT,`Expected type '${n.name}', but it was: ${o}`)}}return a}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function li(a,n){const o={typeString:a};return n&&(o.value=n),o}function vd(a,n){if(!n1(a))throw new Zt(lt.INVALID_ARGUMENT,"JSON must be an object");let o;for(const d in n)if(n[d]){const g=n[d].typeString,w="value"in n[d]?{value:n[d].value}:void 0;if(!(d in a)){o=`JSON missing required field: '${d}'`;break}const x=a[d];if(g&&typeof x!==g){o=`JSON field '${d}' must be a ${g}.`;break}if(w!==void 0&&x!==w.value){o=`Expected '${d}' field to equal '${w.value}'`;break}}if(o)throw new Zt(lt.INVALID_ARGUMENT,o);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q0=-62135596800,J0=1e6;class Ar{static now(){return Ar.fromMillis(Date.now())}static fromDate(n){return Ar.fromMillis(n.getTime())}static fromMillis(n){const o=Math.floor(n/1e3),d=Math.floor((n-1e3*o)*J0);return new Ar(o,d)}constructor(n,o){if(this.seconds=n,this.nanoseconds=o,o<0)throw new Zt(lt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+o);if(o>=1e9)throw new Zt(lt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+o);if(n<Q0)throw new Zt(lt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n);if(n>=253402300800)throw new Zt(lt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/J0}_compareTo(n){return this.seconds===n.seconds?Un(this.nanoseconds,n.nanoseconds):Un(this.seconds,n.seconds)}isEqual(n){return n.seconds===this.seconds&&n.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ar._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(n){if(vd(n,Ar._jsonSchema))return new Ar(n.seconds,n.nanoseconds)}valueOf(){const n=this.seconds-Q0;return String(n).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ar._jsonSchemaVersion="firestore/timestamp/1.0",Ar._jsonSchema={type:li("string",Ar._jsonSchemaVersion),seconds:li("number"),nanoseconds:li("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{static fromTimestamp(n){return new yn(n)}static min(){return new yn(new Ar(0,0))}static max(){return new yn(new Ar(253402300799,999999999))}constructor(n){this.timestamp=n}compareTo(n){return this.timestamp._compareTo(n.timestamp)}isEqual(n){return this.timestamp.isEqual(n.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ld=-1;function qP(a,n){const o=a.toTimestamp().seconds,d=a.toTimestamp().nanoseconds+1,g=yn.fromTimestamp(d===1e9?new Ar(o+1,0):new Ar(o,d));return new ul(g,nn.empty(),n)}function $P(a){return new ul(a.readTime,a.key,ld)}class ul{constructor(n,o,d){this.readTime=n,this.documentKey=o,this.largestBatchId=d}static min(){return new ul(yn.min(),nn.empty(),ld)}static max(){return new ul(yn.max(),nn.empty(),ld)}}function GP(a,n){let o=a.readTime.compareTo(n.readTime);return o!==0?o:(o=nn.comparator(a.documentKey,n.documentKey),o!==0?o:Un(a.largestBatchId,n.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HP="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ZP{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(n){this.onCommittedListeners.push(n)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(n=>n())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bu(a){if(a.code!==lt.FAILED_PRECONDITION||a.message!==HP)throw a;Dt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(n){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,n(o=>{this.isDone=!0,this.result=o,this.nextCallback&&this.nextCallback(o)},o=>{this.isDone=!0,this.error=o,this.catchCallback&&this.catchCallback(o)})}catch(n){return this.next(void 0,n)}next(n,o){return this.callbackAttached&&hn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(o,this.error):this.wrapSuccess(n,this.result):new nt((d,g)=>{this.nextCallback=w=>{this.wrapSuccess(n,w).next(d,g)},this.catchCallback=w=>{this.wrapFailure(o,w).next(d,g)}})}toPromise(){return new Promise((n,o)=>{this.next(n,o)})}wrapUserFunction(n){try{const o=n();return o instanceof nt?o:nt.resolve(o)}catch(o){return nt.reject(o)}}wrapSuccess(n,o){return n?this.wrapUserFunction(()=>n(o)):nt.resolve(o)}wrapFailure(n,o){return n?this.wrapUserFunction(()=>n(o)):nt.reject(o)}static resolve(n){return new nt((o,d)=>{o(n)})}static reject(n){return new nt((o,d)=>{d(n)})}static waitFor(n){return new nt((o,d)=>{let g=0,w=0,x=!1;n.forEach(c=>{++g,c.next(()=>{++w,x&&w===g&&o()},R=>d(R))}),x=!0,w===g&&o()})}static or(n){let o=nt.resolve(!1);for(const d of n)o=o.next(g=>g?nt.resolve(g):d());return o}static forEach(n,o){const d=[];return n.forEach((g,w)=>{d.push(o.call(this,g,w))}),this.waitFor(d)}static mapArray(n,o){return new nt((d,g)=>{const w=n.length,x=new Array(w);let c=0;for(let R=0;R<w;R++){const B=R;o(n[B]).next(W=>{x[B]=W,++c,c===w&&d(x)},W=>g(W))}})}static doWhile(n,o){return new nt((d,g)=>{const w=()=>{n()===!0?o().next(()=>{w()},g):d()};w()})}}function WP(a){const n=a.match(/Android ([\d.]+)/i),o=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(o)}function Uu(a){return a.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{constructor(n,o){this.previousValue=n,o&&(o.sequenceNumberHandler=d=>this.ae(d),this.ue=d=>o.writeSequenceNumber(d))}ae(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){const n=++this.previousValue;return this.ue&&this.ue(n),n}}jf.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A_=-1;function qf(a){return a==null}function gf(a){return a===0&&1/a==-1/0}function KP(a){return typeof a=="number"&&Number.isInteger(a)&&!gf(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r1="";function XP(a){let n="";for(let o=0;o<a.length;o++)n.length>0&&(n=ex(n)),n=YP(a.get(o),n);return ex(n)}function YP(a,n){let o=n;const d=a.length;for(let g=0;g<d;g++){const w=a.charAt(g);switch(w){case"\0":o+="";break;case r1:o+="";break;default:o+=w}}return o}function ex(a){return a+r1+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tx(a){let n=0;for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&n++;return n}function _c(a,n){for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&n(o,a[o])}function i1(a){for(const n in a)if(Object.prototype.hasOwnProperty.call(a,n))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(n,o){this.comparator=n,this.root=o||Ai.EMPTY}insert(n,o){return new Br(this.comparator,this.root.insert(n,o,this.comparator).copy(null,null,Ai.BLACK,null,null))}remove(n){return new Br(this.comparator,this.root.remove(n,this.comparator).copy(null,null,Ai.BLACK,null,null))}get(n){let o=this.root;for(;!o.isEmpty();){const d=this.comparator(n,o.key);if(d===0)return o.value;d<0?o=o.left:d>0&&(o=o.right)}return null}indexOf(n){let o=0,d=this.root;for(;!d.isEmpty();){const g=this.comparator(n,d.key);if(g===0)return o+d.left.size;g<0?d=d.left:(o+=d.left.size+1,d=d.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(n){return this.root.inorderTraversal(n)}forEach(n){this.inorderTraversal((o,d)=>(n(o,d),!1))}toString(){const n=[];return this.inorderTraversal((o,d)=>(n.push(`${o}:${d}`),!1)),`{${n.join(", ")}}`}reverseTraversal(n){return this.root.reverseTraversal(n)}getIterator(){return new Hp(this.root,null,this.comparator,!1)}getIteratorFrom(n){return new Hp(this.root,n,this.comparator,!1)}getReverseIterator(){return new Hp(this.root,null,this.comparator,!0)}getReverseIteratorFrom(n){return new Hp(this.root,n,this.comparator,!0)}}class Hp{constructor(n,o,d,g){this.isReverse=g,this.nodeStack=[];let w=1;for(;!n.isEmpty();)if(w=o?d(n.key,o):1,o&&g&&(w*=-1),w<0)n=this.isReverse?n.left:n.right;else{if(w===0){this.nodeStack.push(n);break}this.nodeStack.push(n),n=this.isReverse?n.right:n.left}}getNext(){let n=this.nodeStack.pop();const o={key:n.key,value:n.value};if(this.isReverse)for(n=n.left;!n.isEmpty();)this.nodeStack.push(n),n=n.right;else for(n=n.right;!n.isEmpty();)this.nodeStack.push(n),n=n.left;return o}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const n=this.nodeStack[this.nodeStack.length-1];return{key:n.key,value:n.value}}}class Ai{constructor(n,o,d,g,w){this.key=n,this.value=o,this.color=d??Ai.RED,this.left=g??Ai.EMPTY,this.right=w??Ai.EMPTY,this.size=this.left.size+1+this.right.size}copy(n,o,d,g,w){return new Ai(n??this.key,o??this.value,d??this.color,g??this.left,w??this.right)}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,o,d){let g=this;const w=d(n,g.key);return g=w<0?g.copy(null,null,null,g.left.insert(n,o,d),null):w===0?g.copy(null,o,null,null,null):g.copy(null,null,null,null,g.right.insert(n,o,d)),g.fixUp()}removeMin(){if(this.left.isEmpty())return Ai.EMPTY;let n=this;return n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.removeMin(),null),n.fixUp()}remove(n,o){let d,g=this;if(o(n,g.key)<0)g.left.isEmpty()||g.left.isRed()||g.left.left.isRed()||(g=g.moveRedLeft()),g=g.copy(null,null,null,g.left.remove(n,o),null);else{if(g.left.isRed()&&(g=g.rotateRight()),g.right.isEmpty()||g.right.isRed()||g.right.left.isRed()||(g=g.moveRedRight()),o(n,g.key)===0){if(g.right.isEmpty())return Ai.EMPTY;d=g.right.min(),g=g.copy(d.key,d.value,null,null,g.right.removeMin())}g=g.copy(null,null,null,null,g.right.remove(n,o))}return g.fixUp()}isRed(){return this.color}fixUp(){let n=this;return n.right.isRed()&&!n.left.isRed()&&(n=n.rotateLeft()),n.left.isRed()&&n.left.left.isRed()&&(n=n.rotateRight()),n.left.isRed()&&n.right.isRed()&&(n=n.colorFlip()),n}moveRedLeft(){let n=this.colorFlip();return n.right.left.isRed()&&(n=n.copy(null,null,null,null,n.right.rotateRight()),n=n.rotateLeft(),n=n.colorFlip()),n}moveRedRight(){let n=this.colorFlip();return n.left.left.isRed()&&(n=n.rotateRight(),n=n.colorFlip()),n}rotateLeft(){const n=this.copy(null,null,Ai.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight(){const n=this.copy(null,null,Ai.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip(){const n=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,o)}checkMaxDepth(){const n=this.check();return Math.pow(2,n)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw hn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw hn(14113,{key:this.key,value:this.value});const n=this.left.check();if(n!==this.right.check())throw hn(27949);return n+(this.isRed()?0:1)}}Ai.EMPTY=null,Ai.RED=!0,Ai.BLACK=!1;Ai.EMPTY=new class{constructor(){this.size=0}get key(){throw hn(57766)}get value(){throw hn(16141)}get color(){throw hn(16727)}get left(){throw hn(29726)}get right(){throw hn(36894)}copy(n,o,d,g,w){return this}insert(n,o,d){return new Ai(n,o)}remove(n,o){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(n){this.comparator=n,this.data=new Br(this.comparator)}has(n){return this.data.get(n)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(n){return this.data.indexOf(n)}forEach(n){this.data.inorderTraversal((o,d)=>(n(o),!1))}forEachInRange(n,o){const d=this.data.getIteratorFrom(n[0]);for(;d.hasNext();){const g=d.getNext();if(this.comparator(g.key,n[1])>=0)return;o(g.key)}}forEachWhile(n,o){let d;for(d=o!==void 0?this.data.getIteratorFrom(o):this.data.getIterator();d.hasNext();)if(!n(d.getNext().key))return}firstAfterOrEqual(n){const o=this.data.getIteratorFrom(n);return o.hasNext()?o.getNext().key:null}getIterator(){return new nx(this.data.getIterator())}getIteratorFrom(n){return new nx(this.data.getIteratorFrom(n))}add(n){return this.copy(this.data.remove(n).insert(n,!0))}delete(n){return this.has(n)?this.copy(this.data.remove(n)):this}isEmpty(){return this.data.isEmpty()}unionWith(n){let o=this;return o.size<n.size&&(o=n,n=this),n.forEach(d=>{o=o.add(d)}),o}isEqual(n){if(!(n instanceof mi)||this.size!==n.size)return!1;const o=this.data.getIterator(),d=n.data.getIterator();for(;o.hasNext();){const g=o.getNext().key,w=d.getNext().key;if(this.comparator(g,w)!==0)return!1}return!0}toArray(){const n=[];return this.forEach(o=>{n.push(o)}),n}toString(){const n=[];return this.forEach(o=>n.push(o)),"SortedSet("+n.toString()+")"}copy(n){const o=new mi(this.comparator);return o.data=n,o}}class nx{constructor(n){this.iter=n}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(n){this.fields=n,n.sort(Ci.comparator)}static empty(){return new po([])}unionWith(n){let o=new mi(Ci.comparator);for(const d of this.fields)o=o.add(d);for(const d of n)o=o.add(d);return new po(o.toArray())}covers(n){for(const o of this.fields)if(o.isPrefixOf(n))return!0;return!1}isEqual(n){return Du(this.fields,n.fields,(o,d)=>o.isEqual(d))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(n){this.binaryString=n}static fromBase64String(n){const o=function(g){try{return atob(g)}catch(w){throw typeof DOMException<"u"&&w instanceof DOMException?new s1("Invalid base64 string: "+w):w}}(n);return new Ri(o)}static fromUint8Array(n){const o=function(g){let w="";for(let x=0;x<g.length;++x)w+=String.fromCharCode(g[x]);return w}(n);return new Ri(o)}[Symbol.iterator](){let n=0;return{next:()=>n<this.binaryString.length?{value:this.binaryString.charCodeAt(n++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(o){return btoa(o)}(this.binaryString)}toUint8Array(){return function(o){const d=new Uint8Array(o.length);for(let g=0;g<o.length;g++)d[g]=o.charCodeAt(g);return d}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(n){return Un(this.binaryString,n.binaryString)}isEqual(n){return this.binaryString===n.binaryString}}Ri.EMPTY_BYTE_STRING=new Ri("");const QP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hl(a){if(sr(!!a,39018),typeof a=="string"){let n=0;const o=QP.exec(a);if(sr(!!o,46558,{timestamp:a}),o[1]){let g=o[1];g=(g+"000000000").substr(0,9),n=Number(g)}const d=new Date(a);return{seconds:Math.floor(d.getTime()/1e3),nanos:n}}return{seconds:Wr(a.seconds),nanos:Wr(a.nanos)}}function Wr(a){return typeof a=="number"?a:typeof a=="string"?Number(a):0}function dl(a){return typeof a=="string"?Ri.fromBase64String(a):Ri.fromUint8Array(a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1="server_timestamp",a1="__type__",l1="__previous_value__",c1="__local_write_time__";function C_(a){var o,d;return((d=(((o=a==null?void 0:a.mapValue)==null?void 0:o.fields)||{})[a1])==null?void 0:d.stringValue)===o1}function $f(a){const n=a.mapValue.fields[l1];return C_(n)?$f(n):n}function cd(a){const n=hl(a.mapValue.fields[c1].timestampValue);return new Ar(n.seconds,n.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(n,o,d,g,w,x,c,R,B,W){this.databaseId=n,this.appId=o,this.persistenceKey=d,this.host=g,this.ssl=w,this.forceLongPolling=x,this.autoDetectLongPolling=c,this.longPollingOptions=R,this.useFetchStreams=B,this.isUsingEmulator=W}}const _f="(default)";class ud{constructor(n,o){this.projectId=n,this.database=o||_f}static empty(){return new ud("","")}get isDefaultDatabase(){return this.database===_f}isEqual(n){return n instanceof ud&&n.projectId===this.projectId&&n.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u1="__type__",eA="__max__",Zp={mapValue:{}},h1="__vector__",yf="value";function pl(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?C_(a)?4:nA(a)?9007199254740991:tA(a)?10:11:hn(28295,{value:a})}function jo(a,n){if(a===n)return!0;const o=pl(a);if(o!==pl(n))return!1;switch(o){case 0:case 9007199254740991:return!0;case 1:return a.booleanValue===n.booleanValue;case 4:return cd(a).isEqual(cd(n));case 3:return function(g,w){if(typeof g.timestampValue=="string"&&typeof w.timestampValue=="string"&&g.timestampValue.length===w.timestampValue.length)return g.timestampValue===w.timestampValue;const x=hl(g.timestampValue),c=hl(w.timestampValue);return x.seconds===c.seconds&&x.nanos===c.nanos}(a,n);case 5:return a.stringValue===n.stringValue;case 6:return function(g,w){return dl(g.bytesValue).isEqual(dl(w.bytesValue))}(a,n);case 7:return a.referenceValue===n.referenceValue;case 8:return function(g,w){return Wr(g.geoPointValue.latitude)===Wr(w.geoPointValue.latitude)&&Wr(g.geoPointValue.longitude)===Wr(w.geoPointValue.longitude)}(a,n);case 2:return function(g,w){if("integerValue"in g&&"integerValue"in w)return Wr(g.integerValue)===Wr(w.integerValue);if("doubleValue"in g&&"doubleValue"in w){const x=Wr(g.doubleValue),c=Wr(w.doubleValue);return x===c?gf(x)===gf(c):isNaN(x)&&isNaN(c)}return!1}(a,n);case 9:return Du(a.arrayValue.values||[],n.arrayValue.values||[],jo);case 10:case 11:return function(g,w){const x=g.mapValue.fields||{},c=w.mapValue.fields||{};if(tx(x)!==tx(c))return!1;for(const R in x)if(x.hasOwnProperty(R)&&(c[R]===void 0||!jo(x[R],c[R])))return!1;return!0}(a,n);default:return hn(52216,{left:a})}}function hd(a,n){return(a.values||[]).find(o=>jo(o,n))!==void 0}function Lu(a,n){if(a===n)return 0;const o=pl(a),d=pl(n);if(o!==d)return Un(o,d);switch(o){case 0:case 9007199254740991:return 0;case 1:return Un(a.booleanValue,n.booleanValue);case 2:return function(w,x){const c=Wr(w.integerValue||w.doubleValue),R=Wr(x.integerValue||x.doubleValue);return c<R?-1:c>R?1:c===R?0:isNaN(c)?isNaN(R)?0:-1:1}(a,n);case 3:return rx(a.timestampValue,n.timestampValue);case 4:return rx(cd(a),cd(n));case 5:return Xg(a.stringValue,n.stringValue);case 6:return function(w,x){const c=dl(w),R=dl(x);return c.compareTo(R)}(a.bytesValue,n.bytesValue);case 7:return function(w,x){const c=w.split("/"),R=x.split("/");for(let B=0;B<c.length&&B<R.length;B++){const W=Un(c[B],R[B]);if(W!==0)return W}return Un(c.length,R.length)}(a.referenceValue,n.referenceValue);case 8:return function(w,x){const c=Un(Wr(w.latitude),Wr(x.latitude));return c!==0?c:Un(Wr(w.longitude),Wr(x.longitude))}(a.geoPointValue,n.geoPointValue);case 9:return ix(a.arrayValue,n.arrayValue);case 10:return function(w,x){var ce,Ie,Ue,ke;const c=w.fields||{},R=x.fields||{},B=(ce=c[yf])==null?void 0:ce.arrayValue,W=(Ie=R[yf])==null?void 0:Ie.arrayValue,ee=Un(((Ue=B==null?void 0:B.values)==null?void 0:Ue.length)||0,((ke=W==null?void 0:W.values)==null?void 0:ke.length)||0);return ee!==0?ee:ix(B,W)}(a.mapValue,n.mapValue);case 11:return function(w,x){if(w===Zp.mapValue&&x===Zp.mapValue)return 0;if(w===Zp.mapValue)return 1;if(x===Zp.mapValue)return-1;const c=w.fields||{},R=Object.keys(c),B=x.fields||{},W=Object.keys(B);R.sort(),W.sort();for(let ee=0;ee<R.length&&ee<W.length;++ee){const ce=Xg(R[ee],W[ee]);if(ce!==0)return ce;const Ie=Lu(c[R[ee]],B[W[ee]]);if(Ie!==0)return Ie}return Un(R.length,W.length)}(a.mapValue,n.mapValue);default:throw hn(23264,{he:o})}}function rx(a,n){if(typeof a=="string"&&typeof n=="string"&&a.length===n.length)return Un(a,n);const o=hl(a),d=hl(n),g=Un(o.seconds,d.seconds);return g!==0?g:Un(o.nanos,d.nanos)}function ix(a,n){const o=a.values||[],d=n.values||[];for(let g=0;g<o.length&&g<d.length;++g){const w=Lu(o[g],d[g]);if(w)return w}return Un(o.length,d.length)}function zu(a){return Yg(a)}function Yg(a){return"nullValue"in a?"null":"booleanValue"in a?""+a.booleanValue:"integerValue"in a?""+a.integerValue:"doubleValue"in a?""+a.doubleValue:"timestampValue"in a?function(o){const d=hl(o);return`time(${d.seconds},${d.nanos})`}(a.timestampValue):"stringValue"in a?a.stringValue:"bytesValue"in a?function(o){return dl(o).toBase64()}(a.bytesValue):"referenceValue"in a?function(o){return nn.fromName(o).toString()}(a.referenceValue):"geoPointValue"in a?function(o){return`geo(${o.latitude},${o.longitude})`}(a.geoPointValue):"arrayValue"in a?function(o){let d="[",g=!0;for(const w of o.values||[])g?g=!1:d+=",",d+=Yg(w);return d+"]"}(a.arrayValue):"mapValue"in a?function(o){const d=Object.keys(o.fields||{}).sort();let g="{",w=!0;for(const x of d)w?w=!1:g+=",",g+=`${x}:${Yg(o.fields[x])}`;return g+"}"}(a.mapValue):hn(61005,{value:a})}function nf(a){switch(pl(a)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const n=$f(a);return n?16+nf(n):16;case 5:return 2*a.stringValue.length;case 6:return dl(a.bytesValue).approximateByteSize();case 7:return a.referenceValue.length;case 9:return function(d){return(d.values||[]).reduce((g,w)=>g+nf(w),0)}(a.arrayValue);case 10:case 11:return function(d){let g=0;return _c(d.fields,(w,x)=>{g+=w.length+nf(x)}),g}(a.mapValue);default:throw hn(13486,{value:a})}}function Qg(a){return!!a&&"integerValue"in a}function M_(a){return!!a&&"arrayValue"in a}function sx(a){return!!a&&"nullValue"in a}function ox(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function rf(a){return!!a&&"mapValue"in a}function tA(a){var o,d;return((d=(((o=a==null?void 0:a.mapValue)==null?void 0:o.fields)||{})[u1])==null?void 0:d.stringValue)===h1}function td(a){if(a.geoPointValue)return{geoPointValue:{...a.geoPointValue}};if(a.timestampValue&&typeof a.timestampValue=="object")return{timestampValue:{...a.timestampValue}};if(a.mapValue){const n={mapValue:{fields:{}}};return _c(a.mapValue.fields,(o,d)=>n.mapValue.fields[o]=td(d)),n}if(a.arrayValue){const n={arrayValue:{values:[]}};for(let o=0;o<(a.arrayValue.values||[]).length;++o)n.arrayValue.values[o]=td(a.arrayValue.values[o]);return n}return{...a}}function nA(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue===eA}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs{constructor(n){this.value=n}static empty(){return new Xs({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let o=this.value;for(let d=0;d<n.length-1;++d)if(o=(o.mapValue.fields||{})[n.get(d)],!rf(o))return null;return o=(o.mapValue.fields||{})[n.lastSegment()],o||null}}set(n,o){this.getFieldsMap(n.popLast())[n.lastSegment()]=td(o)}setAll(n){let o=Ci.emptyPath(),d={},g=[];n.forEach((x,c)=>{if(!o.isImmediateParentOf(c)){const R=this.getFieldsMap(o);this.applyChanges(R,d,g),d={},g=[],o=c.popLast()}x?d[c.lastSegment()]=td(x):g.push(c.lastSegment())});const w=this.getFieldsMap(o);this.applyChanges(w,d,g)}delete(n){const o=this.field(n.popLast());rf(o)&&o.mapValue.fields&&delete o.mapValue.fields[n.lastSegment()]}isEqual(n){return jo(this.value,n.value)}getFieldsMap(n){let o=this.value;o.mapValue.fields||(o.mapValue={fields:{}});for(let d=0;d<n.length;++d){let g=o.mapValue.fields[n.get(d)];rf(g)&&g.mapValue.fields||(g={mapValue:{fields:{}}},o.mapValue.fields[n.get(d)]=g),o=g}return o.mapValue.fields}applyChanges(n,o,d){_c(o,(g,w)=>n[g]=w);for(const g of d)delete n[g]}clone(){return new Xs(td(this.value))}}function d1(a){const n=[];return _c(a.fields,(o,d)=>{const g=new Ci([o]);if(rf(d)){const w=d1(d.mapValue).fields;if(w.length===0)n.push(g);else for(const x of w)n.push(g.child(x))}else n.push(g)}),new po(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(n,o,d,g,w,x,c){this.key=n,this.documentType=o,this.version=d,this.readTime=g,this.createTime=w,this.data=x,this.documentState=c}static newInvalidDocument(n){return new $i(n,0,yn.min(),yn.min(),yn.min(),Xs.empty(),0)}static newFoundDocument(n,o,d,g){return new $i(n,1,o,yn.min(),d,g,0)}static newNoDocument(n,o){return new $i(n,2,o,yn.min(),yn.min(),Xs.empty(),0)}static newUnknownDocument(n,o){return new $i(n,3,o,yn.min(),yn.min(),Xs.empty(),2)}convertToFoundDocument(n,o){return!this.createTime.isEqual(yn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=n),this.version=n,this.documentType=1,this.data=o,this.documentState=0,this}convertToNoDocument(n){return this.version=n,this.documentType=2,this.data=Xs.empty(),this.documentState=0,this}convertToUnknownDocument(n){return this.version=n,this.documentType=3,this.data=Xs.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=yn.min(),this}setReadTime(n){return this.readTime=n,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(n){return n instanceof $i&&this.key.isEqual(n.key)&&this.version.isEqual(n.version)&&this.documentType===n.documentType&&this.documentState===n.documentState&&this.data.isEqual(n.data)}mutableCopy(){return new $i(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(n,o){this.position=n,this.inclusive=o}}function ax(a,n,o){let d=0;for(let g=0;g<a.position.length;g++){const w=n[g],x=a.position[g];if(w.field.isKeyField()?d=nn.comparator(nn.fromName(x.referenceValue),o.key):d=Lu(x,o.data.field(w.field)),w.dir==="desc"&&(d*=-1),d!==0)break}return d}function lx(a,n){if(a===null)return n===null;if(n===null||a.inclusive!==n.inclusive||a.position.length!==n.position.length)return!1;for(let o=0;o<a.position.length;o++)if(!jo(a.position[o],n.position[o]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(n,o="asc"){this.field=n,this.dir=o}}function rA(a,n){return a.dir===n.dir&&a.field.isEqual(n.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1{}class fi extends p1{constructor(n,o,d){super(),this.field=n,this.op=o,this.value=d}static create(n,o,d){return n.isKeyField()?o==="in"||o==="not-in"?this.createKeyFieldInFilter(n,o,d):new sA(n,o,d):o==="array-contains"?new lA(n,d):o==="in"?new cA(n,d):o==="not-in"?new uA(n,d):o==="array-contains-any"?new hA(n,d):new fi(n,o,d)}static createKeyFieldInFilter(n,o,d){return o==="in"?new oA(n,d):new aA(n,d)}matches(n){const o=n.data.field(this.field);return this.op==="!="?o!==null&&o.nullValue===void 0&&this.matchesComparison(Lu(o,this.value)):o!==null&&pl(this.value)===pl(o)&&this.matchesComparison(Lu(o,this.value))}matchesComparison(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return hn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class qo extends p1{constructor(n,o){super(),this.filters=n,this.op=o,this.Pe=null}static create(n,o){return new qo(n,o)}matches(n){return f1(this)?this.filters.find(o=>!o.matches(n))===void 0:this.filters.find(o=>o.matches(n))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((n,o)=>n.concat(o.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function f1(a){return a.op==="and"}function m1(a){return iA(a)&&f1(a)}function iA(a){for(const n of a.filters)if(n instanceof qo)return!1;return!0}function Jg(a){if(a instanceof fi)return a.field.canonicalString()+a.op.toString()+zu(a.value);if(m1(a))return a.filters.map(n=>Jg(n)).join(",");{const n=a.filters.map(o=>Jg(o)).join(",");return`${a.op}(${n})`}}function g1(a,n){return a instanceof fi?function(d,g){return g instanceof fi&&d.op===g.op&&d.field.isEqual(g.field)&&jo(d.value,g.value)}(a,n):a instanceof qo?function(d,g){return g instanceof qo&&d.op===g.op&&d.filters.length===g.filters.length?d.filters.reduce((w,x,c)=>w&&g1(x,g.filters[c]),!0):!1}(a,n):void hn(19439)}function _1(a){return a instanceof fi?function(o){return`${o.field.canonicalString()} ${o.op} ${zu(o.value)}`}(a):a instanceof qo?function(o){return o.op.toString()+" {"+o.getFilters().map(_1).join(" ,")+"}"}(a):"Filter"}class sA extends fi{constructor(n,o,d){super(n,o,d),this.key=nn.fromName(d.referenceValue)}matches(n){const o=nn.comparator(n.key,this.key);return this.matchesComparison(o)}}class oA extends fi{constructor(n,o){super(n,"in",o),this.keys=y1("in",o)}matches(n){return this.keys.some(o=>o.isEqual(n.key))}}class aA extends fi{constructor(n,o){super(n,"not-in",o),this.keys=y1("not-in",o)}matches(n){return!this.keys.some(o=>o.isEqual(n.key))}}function y1(a,n){var o;return(((o=n.arrayValue)==null?void 0:o.values)||[]).map(d=>nn.fromName(d.referenceValue))}class lA extends fi{constructor(n,o){super(n,"array-contains",o)}matches(n){const o=n.data.field(this.field);return M_(o)&&hd(o.arrayValue,this.value)}}class cA extends fi{constructor(n,o){super(n,"in",o)}matches(n){const o=n.data.field(this.field);return o!==null&&hd(this.value.arrayValue,o)}}class uA extends fi{constructor(n,o){super(n,"not-in",o)}matches(n){if(hd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const o=n.data.field(this.field);return o!==null&&o.nullValue===void 0&&!hd(this.value.arrayValue,o)}}class hA extends fi{constructor(n,o){super(n,"array-contains-any",o)}matches(n){const o=n.data.field(this.field);return!(!M_(o)||!o.arrayValue.values)&&o.arrayValue.values.some(d=>hd(this.value.arrayValue,d))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dA{constructor(n,o=null,d=[],g=[],w=null,x=null,c=null){this.path=n,this.collectionGroup=o,this.orderBy=d,this.filters=g,this.limit=w,this.startAt=x,this.endAt=c,this.Te=null}}function cx(a,n=null,o=[],d=[],g=null,w=null,x=null){return new dA(a,n,o,d,g,w,x)}function R_(a){const n=wn(a);if(n.Te===null){let o=n.path.canonicalString();n.collectionGroup!==null&&(o+="|cg:"+n.collectionGroup),o+="|f:",o+=n.filters.map(d=>Jg(d)).join(","),o+="|ob:",o+=n.orderBy.map(d=>function(w){return w.field.canonicalString()+w.dir}(d)).join(","),qf(n.limit)||(o+="|l:",o+=n.limit),n.startAt&&(o+="|lb:",o+=n.startAt.inclusive?"b:":"a:",o+=n.startAt.position.map(d=>zu(d)).join(",")),n.endAt&&(o+="|ub:",o+=n.endAt.inclusive?"a:":"b:",o+=n.endAt.position.map(d=>zu(d)).join(",")),n.Te=o}return n.Te}function k_(a,n){if(a.limit!==n.limit||a.orderBy.length!==n.orderBy.length)return!1;for(let o=0;o<a.orderBy.length;o++)if(!rA(a.orderBy[o],n.orderBy[o]))return!1;if(a.filters.length!==n.filters.length)return!1;for(let o=0;o<a.filters.length;o++)if(!g1(a.filters[o],n.filters[o]))return!1;return a.collectionGroup===n.collectionGroup&&!!a.path.isEqual(n.path)&&!!lx(a.startAt,n.startAt)&&lx(a.endAt,n.endAt)}function e_(a){return nn.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(n,o=null,d=[],g=[],w=null,x="F",c=null,R=null){this.path=n,this.collectionGroup=o,this.explicitOrderBy=d,this.filters=g,this.limit=w,this.limitType=x,this.startAt=c,this.endAt=R,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function pA(a,n,o,d,g,w,x,c){return new Gf(a,n,o,d,g,w,x,c)}function D_(a){return new Gf(a)}function ux(a){return a.filters.length===0&&a.limit===null&&a.startAt==null&&a.endAt==null&&(a.explicitOrderBy.length===0||a.explicitOrderBy.length===1&&a.explicitOrderBy[0].field.isKeyField())}function fA(a){return a.collectionGroup!==null}function nd(a){const n=wn(a);if(n.Ie===null){n.Ie=[];const o=new Set;for(const w of n.explicitOrderBy)n.Ie.push(w),o.add(w.field.canonicalString());const d=n.explicitOrderBy.length>0?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";(function(x){let c=new mi(Ci.comparator);return x.filters.forEach(R=>{R.getFlattenedFilters().forEach(B=>{B.isInequality()&&(c=c.add(B.field))})}),c})(n).forEach(w=>{o.has(w.canonicalString())||w.isKeyField()||n.Ie.push(new xf(w,d))}),o.has(Ci.keyField().canonicalString())||n.Ie.push(new xf(Ci.keyField(),d))}return n.Ie}function Oo(a){const n=wn(a);return n.Ee||(n.Ee=mA(n,nd(a))),n.Ee}function mA(a,n){if(a.limitType==="F")return cx(a.path,a.collectionGroup,n,a.filters,a.limit,a.startAt,a.endAt);{n=n.map(g=>{const w=g.dir==="desc"?"asc":"desc";return new xf(g.field,w)});const o=a.endAt?new vf(a.endAt.position,a.endAt.inclusive):null,d=a.startAt?new vf(a.startAt.position,a.startAt.inclusive):null;return cx(a.path,a.collectionGroup,n,a.filters,a.limit,o,d)}}function t_(a,n,o){return new Gf(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),n,o,a.startAt,a.endAt)}function Hf(a,n){return k_(Oo(a),Oo(n))&&a.limitType===n.limitType}function v1(a){return`${R_(Oo(a))}|lt:${a.limitType}`}function wu(a){return`Query(target=${function(o){let d=o.path.canonicalString();return o.collectionGroup!==null&&(d+=" collectionGroup="+o.collectionGroup),o.filters.length>0&&(d+=`, filters: [${o.filters.map(g=>_1(g)).join(", ")}]`),qf(o.limit)||(d+=", limit: "+o.limit),o.orderBy.length>0&&(d+=`, orderBy: [${o.orderBy.map(g=>function(x){return`${x.field.canonicalString()} (${x.dir})`}(g)).join(", ")}]`),o.startAt&&(d+=", startAt: ",d+=o.startAt.inclusive?"b:":"a:",d+=o.startAt.position.map(g=>zu(g)).join(",")),o.endAt&&(d+=", endAt: ",d+=o.endAt.inclusive?"a:":"b:",d+=o.endAt.position.map(g=>zu(g)).join(",")),`Target(${d})`}(Oo(a))}; limitType=${a.limitType})`}function Zf(a,n){return n.isFoundDocument()&&function(d,g){const w=g.key.path;return d.collectionGroup!==null?g.key.hasCollectionId(d.collectionGroup)&&d.path.isPrefixOf(w):nn.isDocumentKey(d.path)?d.path.isEqual(w):d.path.isImmediateParentOf(w)}(a,n)&&function(d,g){for(const w of nd(d))if(!w.field.isKeyField()&&g.data.field(w.field)===null)return!1;return!0}(a,n)&&function(d,g){for(const w of d.filters)if(!w.matches(g))return!1;return!0}(a,n)&&function(d,g){return!(d.startAt&&!function(x,c,R){const B=ax(x,c,R);return x.inclusive?B<=0:B<0}(d.startAt,nd(d),g)||d.endAt&&!function(x,c,R){const B=ax(x,c,R);return x.inclusive?B>=0:B>0}(d.endAt,nd(d),g))}(a,n)}function gA(a){return a.collectionGroup||(a.path.length%2==1?a.path.lastSegment():a.path.get(a.path.length-2))}function x1(a){return(n,o)=>{let d=!1;for(const g of nd(a)){const w=_A(g,n,o);if(w!==0)return w;d=d||g.field.isKeyField()}return 0}}function _A(a,n,o){const d=a.field.isKeyField()?nn.comparator(n.key,o.key):function(w,x,c){const R=x.data.field(w),B=c.data.field(w);return R!==null&&B!==null?Lu(R,B):hn(42886)}(a.field,n,o);switch(a.dir){case"asc":return d;case"desc":return-1*d;default:return hn(19790,{direction:a.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(n,o){this.mapKeyFn=n,this.equalsFn=o,this.inner={},this.innerSize=0}get(n){const o=this.mapKeyFn(n),d=this.inner[o];if(d!==void 0){for(const[g,w]of d)if(this.equalsFn(g,n))return w}}has(n){return this.get(n)!==void 0}set(n,o){const d=this.mapKeyFn(n),g=this.inner[d];if(g===void 0)return this.inner[d]=[[n,o]],void this.innerSize++;for(let w=0;w<g.length;w++)if(this.equalsFn(g[w][0],n))return void(g[w]=[n,o]);g.push([n,o]),this.innerSize++}delete(n){const o=this.mapKeyFn(n),d=this.inner[o];if(d===void 0)return!1;for(let g=0;g<d.length;g++)if(this.equalsFn(d[g][0],n))return d.length===1?delete this.inner[o]:d.splice(g,1),this.innerSize--,!0;return!1}forEach(n){_c(this.inner,(o,d)=>{for(const[g,w]of d)n(g,w)})}isEmpty(){return i1(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yA=new Br(nn.comparator);function Ea(){return yA}const b1=new Br(nn.comparator);function Yh(...a){let n=b1;for(const o of a)n=n.insert(o.key,o);return n}function w1(a){let n=b1;return a.forEach((o,d)=>n=n.insert(o,d.overlayedDocument)),n}function sc(){return rd()}function T1(){return rd()}function rd(){return new yc(a=>a.toString(),(a,n)=>a.isEqual(n))}const vA=new Br(nn.comparator),xA=new mi(nn.comparator);function jn(...a){let n=xA;for(const o of a)n=n.add(o);return n}const bA=new mi(Un);function wA(){return bA}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L_(a,n){if(a.useProto3Json){if(isNaN(n))return{doubleValue:"NaN"};if(n===1/0)return{doubleValue:"Infinity"};if(n===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:gf(n)?"-0":n}}function E1(a){return{integerValue:""+a}}function TA(a,n){return KP(n)?E1(n):L_(a,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(){this._=void 0}}function EA(a,n,o){return a instanceof bf?function(g,w){const x={fields:{[a1]:{stringValue:o1},[c1]:{timestampValue:{seconds:g.seconds,nanos:g.nanoseconds}}}};return w&&C_(w)&&(w=$f(w)),w&&(x.fields[l1]=w),{mapValue:x}}(o,n):a instanceof dd?S1(a,n):a instanceof pd?P1(a,n):function(g,w){const x=I1(g,w),c=hx(x)+hx(g.Ae);return Qg(x)&&Qg(g.Ae)?E1(c):L_(g.serializer,c)}(a,n)}function IA(a,n,o){return a instanceof dd?S1(a,n):a instanceof pd?P1(a,n):o}function I1(a,n){return a instanceof wf?function(d){return Qg(d)||function(w){return!!w&&"doubleValue"in w}(d)}(n)?n:{integerValue:0}:null}class bf extends Wf{}class dd extends Wf{constructor(n){super(),this.elements=n}}function S1(a,n){const o=A1(n);for(const d of a.elements)o.some(g=>jo(g,d))||o.push(d);return{arrayValue:{values:o}}}class pd extends Wf{constructor(n){super(),this.elements=n}}function P1(a,n){let o=A1(n);for(const d of a.elements)o=o.filter(g=>!jo(g,d));return{arrayValue:{values:o}}}class wf extends Wf{constructor(n,o){super(),this.serializer=n,this.Ae=o}}function hx(a){return Wr(a.integerValue||a.doubleValue)}function A1(a){return M_(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}function SA(a,n){return a.field.isEqual(n.field)&&function(d,g){return d instanceof dd&&g instanceof dd||d instanceof pd&&g instanceof pd?Du(d.elements,g.elements,jo):d instanceof wf&&g instanceof wf?jo(d.Ae,g.Ae):d instanceof bf&&g instanceof bf}(a.transform,n.transform)}class PA{constructor(n,o){this.version=n,this.transformResults=o}}class xa{constructor(n,o){this.updateTime=n,this.exists=o}static none(){return new xa}static exists(n){return new xa(void 0,n)}static updateTime(n){return new xa(n)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(n){return this.exists===n.exists&&(this.updateTime?!!n.updateTime&&this.updateTime.isEqual(n.updateTime):!n.updateTime)}}function sf(a,n){return a.updateTime!==void 0?n.isFoundDocument()&&n.version.isEqual(a.updateTime):a.exists===void 0||a.exists===n.isFoundDocument()}class Kf{}function C1(a,n){if(!a.hasLocalMutations||n&&n.fields.length===0)return null;if(n===null)return a.isNoDocument()?new R1(a.key,xa.none()):new xd(a.key,a.data,xa.none());{const o=a.data,d=Xs.empty();let g=new mi(Ci.comparator);for(let w of n.fields)if(!g.has(w)){let x=o.field(w);x===null&&w.length>1&&(w=w.popLast(),x=o.field(w)),x===null?d.delete(w):d.set(w,x),g=g.add(w)}return new vc(a.key,d,new po(g.toArray()),xa.none())}}function AA(a,n,o){a instanceof xd?function(g,w,x){const c=g.value.clone(),R=px(g.fieldTransforms,w,x.transformResults);c.setAll(R),w.convertToFoundDocument(x.version,c).setHasCommittedMutations()}(a,n,o):a instanceof vc?function(g,w,x){if(!sf(g.precondition,w))return void w.convertToUnknownDocument(x.version);const c=px(g.fieldTransforms,w,x.transformResults),R=w.data;R.setAll(M1(g)),R.setAll(c),w.convertToFoundDocument(x.version,R).setHasCommittedMutations()}(a,n,o):function(g,w,x){w.convertToNoDocument(x.version).setHasCommittedMutations()}(0,n,o)}function id(a,n,o,d){return a instanceof xd?function(w,x,c,R){if(!sf(w.precondition,x))return c;const B=w.value.clone(),W=fx(w.fieldTransforms,R,x);return B.setAll(W),x.convertToFoundDocument(x.version,B).setHasLocalMutations(),null}(a,n,o,d):a instanceof vc?function(w,x,c,R){if(!sf(w.precondition,x))return c;const B=fx(w.fieldTransforms,R,x),W=x.data;return W.setAll(M1(w)),W.setAll(B),x.convertToFoundDocument(x.version,W).setHasLocalMutations(),c===null?null:c.unionWith(w.fieldMask.fields).unionWith(w.fieldTransforms.map(ee=>ee.field))}(a,n,o,d):function(w,x,c){return sf(w.precondition,x)?(x.convertToNoDocument(x.version).setHasLocalMutations(),null):c}(a,n,o)}function CA(a,n){let o=null;for(const d of a.fieldTransforms){const g=n.data.field(d.field),w=I1(d.transform,g||null);w!=null&&(o===null&&(o=Xs.empty()),o.set(d.field,w))}return o||null}function dx(a,n){return a.type===n.type&&!!a.key.isEqual(n.key)&&!!a.precondition.isEqual(n.precondition)&&!!function(d,g){return d===void 0&&g===void 0||!(!d||!g)&&Du(d,g,(w,x)=>SA(w,x))}(a.fieldTransforms,n.fieldTransforms)&&(a.type===0?a.value.isEqual(n.value):a.type!==1||a.data.isEqual(n.data)&&a.fieldMask.isEqual(n.fieldMask))}class xd extends Kf{constructor(n,o,d,g=[]){super(),this.key=n,this.value=o,this.precondition=d,this.fieldTransforms=g,this.type=0}getFieldMask(){return null}}class vc extends Kf{constructor(n,o,d,g,w=[]){super(),this.key=n,this.data=o,this.fieldMask=d,this.precondition=g,this.fieldTransforms=w,this.type=1}getFieldMask(){return this.fieldMask}}function M1(a){const n=new Map;return a.fieldMask.fields.forEach(o=>{if(!o.isEmpty()){const d=a.data.field(o);n.set(o,d)}}),n}function px(a,n,o){const d=new Map;sr(a.length===o.length,32656,{Re:o.length,Ve:a.length});for(let g=0;g<o.length;g++){const w=a[g],x=w.transform,c=n.data.field(w.field);d.set(w.field,IA(x,c,o[g]))}return d}function fx(a,n,o){const d=new Map;for(const g of a){const w=g.transform,x=o.data.field(g.field);d.set(g.field,EA(w,x,n))}return d}class R1 extends Kf{constructor(n,o){super(),this.key=n,this.precondition=o,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class MA extends Kf{constructor(n,o){super(),this.key=n,this.precondition=o,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RA{constructor(n,o,d,g){this.batchId=n,this.localWriteTime=o,this.baseMutations=d,this.mutations=g}applyToRemoteDocument(n,o){const d=o.mutationResults;for(let g=0;g<this.mutations.length;g++){const w=this.mutations[g];w.key.isEqual(n.key)&&AA(w,n,d[g])}}applyToLocalView(n,o){for(const d of this.baseMutations)d.key.isEqual(n.key)&&(o=id(d,n,o,this.localWriteTime));for(const d of this.mutations)d.key.isEqual(n.key)&&(o=id(d,n,o,this.localWriteTime));return o}applyToLocalDocumentSet(n,o){const d=T1();return this.mutations.forEach(g=>{const w=n.get(g.key),x=w.overlayedDocument;let c=this.applyToLocalView(x,w.mutatedFields);c=o.has(g.key)?null:c;const R=C1(x,c);R!==null&&d.set(g.key,R),x.isValidDocument()||x.convertToNoDocument(yn.min())}),d}keys(){return this.mutations.reduce((n,o)=>n.add(o.key),jn())}isEqual(n){return this.batchId===n.batchId&&Du(this.mutations,n.mutations,(o,d)=>dx(o,d))&&Du(this.baseMutations,n.baseMutations,(o,d)=>dx(o,d))}}class z_{constructor(n,o,d,g){this.batch=n,this.commitVersion=o,this.mutationResults=d,this.docVersions=g}static from(n,o,d){sr(n.mutations.length===d.length,58842,{me:n.mutations.length,fe:d.length});let g=function(){return vA}();const w=n.mutations;for(let x=0;x<w.length;x++)g=g.insert(w[x].key,d[x].version);return new z_(n,o,d,g)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(n,o){this.largestBatchId=n,this.mutation=o}getKey(){return this.mutation.key}isEqual(n){return n!==null&&this.mutation===n.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DA{constructor(n,o){this.count=n,this.unchangedNames=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ai,Zn;function LA(a){switch(a){case lt.OK:return hn(64938);case lt.CANCELLED:case lt.UNKNOWN:case lt.DEADLINE_EXCEEDED:case lt.RESOURCE_EXHAUSTED:case lt.INTERNAL:case lt.UNAVAILABLE:case lt.UNAUTHENTICATED:return!1;case lt.INVALID_ARGUMENT:case lt.NOT_FOUND:case lt.ALREADY_EXISTS:case lt.PERMISSION_DENIED:case lt.FAILED_PRECONDITION:case lt.ABORTED:case lt.OUT_OF_RANGE:case lt.UNIMPLEMENTED:case lt.DATA_LOSS:return!0;default:return hn(15467,{code:a})}}function k1(a){if(a===void 0)return Ta("GRPC error has no .code"),lt.UNKNOWN;switch(a){case ai.OK:return lt.OK;case ai.CANCELLED:return lt.CANCELLED;case ai.UNKNOWN:return lt.UNKNOWN;case ai.DEADLINE_EXCEEDED:return lt.DEADLINE_EXCEEDED;case ai.RESOURCE_EXHAUSTED:return lt.RESOURCE_EXHAUSTED;case ai.INTERNAL:return lt.INTERNAL;case ai.UNAVAILABLE:return lt.UNAVAILABLE;case ai.UNAUTHENTICATED:return lt.UNAUTHENTICATED;case ai.INVALID_ARGUMENT:return lt.INVALID_ARGUMENT;case ai.NOT_FOUND:return lt.NOT_FOUND;case ai.ALREADY_EXISTS:return lt.ALREADY_EXISTS;case ai.PERMISSION_DENIED:return lt.PERMISSION_DENIED;case ai.FAILED_PRECONDITION:return lt.FAILED_PRECONDITION;case ai.ABORTED:return lt.ABORTED;case ai.OUT_OF_RANGE:return lt.OUT_OF_RANGE;case ai.UNIMPLEMENTED:return lt.UNIMPLEMENTED;case ai.DATA_LOSS:return lt.DATA_LOSS;default:return hn(39323,{code:a})}}(Zn=ai||(ai={}))[Zn.OK=0]="OK",Zn[Zn.CANCELLED=1]="CANCELLED",Zn[Zn.UNKNOWN=2]="UNKNOWN",Zn[Zn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zn[Zn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zn[Zn.NOT_FOUND=5]="NOT_FOUND",Zn[Zn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zn[Zn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zn[Zn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zn[Zn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zn[Zn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zn[Zn.ABORTED=10]="ABORTED",Zn[Zn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zn[Zn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zn[Zn.INTERNAL=13]="INTERNAL",Zn[Zn.UNAVAILABLE=14]="UNAVAILABLE",Zn[Zn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zA(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FA=new ll([4294967295,4294967295],0);function mx(a){const n=zA().encode(a),o=new Wb;return o.update(n),new Uint8Array(o.digest())}function gx(a){const n=new DataView(a.buffer),o=n.getUint32(0,!0),d=n.getUint32(4,!0),g=n.getUint32(8,!0),w=n.getUint32(12,!0);return[new ll([o,d],0),new ll([g,w],0)]}class F_{constructor(n,o,d){if(this.bitmap=n,this.padding=o,this.hashCount=d,o<0||o>=8)throw new Qh(`Invalid padding: ${o}`);if(d<0)throw new Qh(`Invalid hash count: ${d}`);if(n.length>0&&this.hashCount===0)throw new Qh(`Invalid hash count: ${d}`);if(n.length===0&&o!==0)throw new Qh(`Invalid padding when bitmap length is 0: ${o}`);this.ge=8*n.length-o,this.pe=ll.fromNumber(this.ge)}ye(n,o,d){let g=n.add(o.multiply(ll.fromNumber(d)));return g.compare(FA)===1&&(g=new ll([g.getBits(0),g.getBits(1)],0)),g.modulo(this.pe).toNumber()}we(n){return!!(this.bitmap[Math.floor(n/8)]&1<<n%8)}mightContain(n){if(this.ge===0)return!1;const o=mx(n),[d,g]=gx(o);for(let w=0;w<this.hashCount;w++){const x=this.ye(d,g,w);if(!this.we(x))return!1}return!0}static create(n,o,d){const g=n%8==0?0:8-n%8,w=new Uint8Array(Math.ceil(n/8)),x=new F_(w,g,o);return d.forEach(c=>x.insert(c)),x}insert(n){if(this.ge===0)return;const o=mx(n),[d,g]=gx(o);for(let w=0;w<this.hashCount;w++){const x=this.ye(d,g,w);this.Se(x)}}Se(n){const o=Math.floor(n/8),d=n%8;this.bitmap[o]|=1<<d}}class Qh extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xf{constructor(n,o,d,g,w){this.snapshotVersion=n,this.targetChanges=o,this.targetMismatches=d,this.documentUpdates=g,this.resolvedLimboDocuments=w}static createSynthesizedRemoteEventForCurrentChange(n,o,d){const g=new Map;return g.set(n,bd.createSynthesizedTargetChangeForCurrentChange(n,o,d)),new Xf(yn.min(),g,new Br(Un),Ea(),jn())}}class bd{constructor(n,o,d,g,w){this.resumeToken=n,this.current=o,this.addedDocuments=d,this.modifiedDocuments=g,this.removedDocuments=w}static createSynthesizedTargetChangeForCurrentChange(n,o,d){return new bd(d,o,jn(),jn(),jn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(n,o,d,g){this.be=n,this.removedTargetIds=o,this.key=d,this.De=g}}class D1{constructor(n,o){this.targetId=n,this.Ce=o}}class L1{constructor(n,o,d=Ri.EMPTY_BYTE_STRING,g=null){this.state=n,this.targetIds=o,this.resumeToken=d,this.cause=g}}class _x{constructor(){this.ve=0,this.Fe=yx(),this.Me=Ri.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(n){n.approximateByteSize()>0&&(this.Oe=!0,this.Me=n)}ke(){let n=jn(),o=jn(),d=jn();return this.Fe.forEach((g,w)=>{switch(w){case 0:n=n.add(g);break;case 2:o=o.add(g);break;case 1:d=d.add(g);break;default:hn(38017,{changeType:w})}}),new bd(this.Me,this.xe,n,o,d)}qe(){this.Oe=!1,this.Fe=yx()}Qe(n,o){this.Oe=!0,this.Fe=this.Fe.insert(n,o)}$e(n){this.Oe=!0,this.Fe=this.Fe.remove(n)}Ue(){this.ve+=1}Ke(){this.ve-=1,sr(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class OA{constructor(n){this.Ge=n,this.ze=new Map,this.je=Ea(),this.Je=Wp(),this.He=Wp(),this.Ye=new Br(Un)}Ze(n){for(const o of n.be)n.De&&n.De.isFoundDocument()?this.Xe(o,n.De):this.et(o,n.key,n.De);for(const o of n.removedTargetIds)this.et(o,n.key,n.De)}tt(n){this.forEachTarget(n,o=>{const d=this.nt(o);switch(n.state){case 0:this.rt(o)&&d.Le(n.resumeToken);break;case 1:d.Ke(),d.Ne||d.qe(),d.Le(n.resumeToken);break;case 2:d.Ke(),d.Ne||this.removeTarget(o);break;case 3:this.rt(o)&&(d.We(),d.Le(n.resumeToken));break;case 4:this.rt(o)&&(this.it(o),d.Le(n.resumeToken));break;default:hn(56790,{state:n.state})}})}forEachTarget(n,o){n.targetIds.length>0?n.targetIds.forEach(o):this.ze.forEach((d,g)=>{this.rt(g)&&o(g)})}st(n){const o=n.targetId,d=n.Ce.count,g=this.ot(o);if(g){const w=g.target;if(e_(w))if(d===0){const x=new nn(w.path);this.et(o,x,$i.newNoDocument(x,yn.min()))}else sr(d===1,20013,{expectedCount:d});else{const x=this._t(o);if(x!==d){const c=this.ut(n),R=c?this.ct(c,n,x):1;if(R!==0){this.it(o);const B=R===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(o,B)}}}}}ut(n){const o=n.Ce.unchangedNames;if(!o||!o.bits)return null;const{bits:{bitmap:d="",padding:g=0},hashCount:w=0}=o;let x,c;try{x=dl(d).toUint8Array()}catch(R){if(R instanceof s1)return ku("Decoding the base64 bloom filter in existence filter failed ("+R.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw R}try{c=new F_(x,g,w)}catch(R){return ku(R instanceof Qh?"BloomFilter error: ":"Applying bloom filter failed: ",R),null}return c.ge===0?null:c}ct(n,o,d){return o.Ce.count===d-this.Pt(n,o.targetId)?0:2}Pt(n,o){const d=this.Ge.getRemoteKeysForTarget(o);let g=0;return d.forEach(w=>{const x=this.Ge.ht(),c=`projects/${x.projectId}/databases/${x.database}/documents/${w.path.canonicalString()}`;n.mightContain(c)||(this.et(o,w,null),g++)}),g}Tt(n){const o=new Map;this.ze.forEach((w,x)=>{const c=this.ot(x);if(c){if(w.current&&e_(c.target)){const R=new nn(c.target.path);this.It(R).has(x)||this.Et(x,R)||this.et(x,R,$i.newNoDocument(R,n))}w.Be&&(o.set(x,w.ke()),w.qe())}});let d=jn();this.He.forEach((w,x)=>{let c=!0;x.forEachWhile(R=>{const B=this.ot(R);return!B||B.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(d=d.add(w))}),this.je.forEach((w,x)=>x.setReadTime(n));const g=new Xf(n,o,this.Ye,this.je,d);return this.je=Ea(),this.Je=Wp(),this.He=Wp(),this.Ye=new Br(Un),g}Xe(n,o){if(!this.rt(n))return;const d=this.Et(n,o.key)?2:0;this.nt(n).Qe(o.key,d),this.je=this.je.insert(o.key,o),this.Je=this.Je.insert(o.key,this.It(o.key).add(n)),this.He=this.He.insert(o.key,this.dt(o.key).add(n))}et(n,o,d){if(!this.rt(n))return;const g=this.nt(n);this.Et(n,o)?g.Qe(o,1):g.$e(o),this.He=this.He.insert(o,this.dt(o).delete(n)),this.He=this.He.insert(o,this.dt(o).add(n)),d&&(this.je=this.je.insert(o,d))}removeTarget(n){this.ze.delete(n)}_t(n){const o=this.nt(n).ke();return this.Ge.getRemoteKeysForTarget(n).size+o.addedDocuments.size-o.removedDocuments.size}Ue(n){this.nt(n).Ue()}nt(n){let o=this.ze.get(n);return o||(o=new _x,this.ze.set(n,o)),o}dt(n){let o=this.He.get(n);return o||(o=new mi(Un),this.He=this.He.insert(n,o)),o}It(n){let o=this.Je.get(n);return o||(o=new mi(Un),this.Je=this.Je.insert(n,o)),o}rt(n){const o=this.ot(n)!==null;return o||Dt("WatchChangeAggregator","Detected inactive target",n),o}ot(n){const o=this.ze.get(n);return o&&o.Ne?null:this.Ge.At(n)}it(n){this.ze.set(n,new _x),this.Ge.getRemoteKeysForTarget(n).forEach(o=>{this.et(n,o,null)})}Et(n,o){return this.Ge.getRemoteKeysForTarget(n).has(o)}}function Wp(){return new Br(nn.comparator)}function yx(){return new Br(nn.comparator)}const NA={asc:"ASCENDING",desc:"DESCENDING"},VA={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},BA={and:"AND",or:"OR"};class UA{constructor(n,o){this.databaseId=n,this.useProto3Json=o}}function n_(a,n){return a.useProto3Json||qf(n)?n:{value:n}}function Tf(a,n){return a.useProto3Json?`${new Date(1e3*n.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+n.nanoseconds).slice(-9)}Z`:{seconds:""+n.seconds,nanos:n.nanoseconds}}function z1(a,n){return a.useProto3Json?n.toBase64():n.toUint8Array()}function jA(a,n){return Tf(a,n.toTimestamp())}function No(a){return sr(!!a,49232),yn.fromTimestamp(function(o){const d=hl(o);return new Ar(d.seconds,d.nanos)}(a))}function O_(a,n){return r_(a,n).canonicalString()}function r_(a,n){const o=function(g){return new Vr(["projects",g.projectId,"databases",g.database])}(a).child("documents");return n===void 0?o:o.child(n)}function F1(a){const n=Vr.fromString(a);return sr(U1(n),10190,{key:n.toString()}),n}function i_(a,n){return O_(a.databaseId,n.path)}function kg(a,n){const o=F1(n);if(o.get(1)!==a.databaseId.projectId)throw new Zt(lt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+o.get(1)+" vs "+a.databaseId.projectId);if(o.get(3)!==a.databaseId.database)throw new Zt(lt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+o.get(3)+" vs "+a.databaseId.database);return new nn(N1(o))}function O1(a,n){return O_(a.databaseId,n)}function qA(a){const n=F1(a);return n.length===4?Vr.emptyPath():N1(n)}function s_(a){return new Vr(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function N1(a){return sr(a.length>4&&a.get(4)==="documents",29091,{key:a.toString()}),a.popFirst(5)}function vx(a,n,o){return{name:i_(a,n),fields:o.value.mapValue.fields}}function $A(a,n){let o;if("targetChange"in n){n.targetChange;const d=function(B){return B==="NO_CHANGE"?0:B==="ADD"?1:B==="REMOVE"?2:B==="CURRENT"?3:B==="RESET"?4:hn(39313,{state:B})}(n.targetChange.targetChangeType||"NO_CHANGE"),g=n.targetChange.targetIds||[],w=function(B,W){return B.useProto3Json?(sr(W===void 0||typeof W=="string",58123),Ri.fromBase64String(W||"")):(sr(W===void 0||W instanceof Buffer||W instanceof Uint8Array,16193),Ri.fromUint8Array(W||new Uint8Array))}(a,n.targetChange.resumeToken),x=n.targetChange.cause,c=x&&function(B){const W=B.code===void 0?lt.UNKNOWN:k1(B.code);return new Zt(W,B.message||"")}(x);o=new L1(d,g,w,c||null)}else if("documentChange"in n){n.documentChange;const d=n.documentChange;d.document,d.document.name,d.document.updateTime;const g=kg(a,d.document.name),w=No(d.document.updateTime),x=d.document.createTime?No(d.document.createTime):yn.min(),c=new Xs({mapValue:{fields:d.document.fields}}),R=$i.newFoundDocument(g,w,x,c),B=d.targetIds||[],W=d.removedTargetIds||[];o=new of(B,W,R.key,R)}else if("documentDelete"in n){n.documentDelete;const d=n.documentDelete;d.document;const g=kg(a,d.document),w=d.readTime?No(d.readTime):yn.min(),x=$i.newNoDocument(g,w),c=d.removedTargetIds||[];o=new of([],c,x.key,x)}else if("documentRemove"in n){n.documentRemove;const d=n.documentRemove;d.document;const g=kg(a,d.document),w=d.removedTargetIds||[];o=new of([],w,g,null)}else{if(!("filter"in n))return hn(11601,{Rt:n});{n.filter;const d=n.filter;d.targetId;const{count:g=0,unchangedNames:w}=d,x=new DA(g,w),c=d.targetId;o=new D1(c,x)}}return o}function GA(a,n){let o;if(n instanceof xd)o={update:vx(a,n.key,n.value)};else if(n instanceof R1)o={delete:i_(a,n.key)};else if(n instanceof vc)o={update:vx(a,n.key,n.data),updateMask:eC(n.fieldMask)};else{if(!(n instanceof MA))return hn(16599,{Vt:n.type});o={verify:i_(a,n.key)}}return n.fieldTransforms.length>0&&(o.updateTransforms=n.fieldTransforms.map(d=>function(w,x){const c=x.transform;if(c instanceof bf)return{fieldPath:x.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof dd)return{fieldPath:x.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof pd)return{fieldPath:x.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof wf)return{fieldPath:x.field.canonicalString(),increment:c.Ae};throw hn(20930,{transform:x.transform})}(0,d))),n.precondition.isNone||(o.currentDocument=function(g,w){return w.updateTime!==void 0?{updateTime:jA(g,w.updateTime)}:w.exists!==void 0?{exists:w.exists}:hn(27497)}(a,n.precondition)),o}function HA(a,n){return a&&a.length>0?(sr(n!==void 0,14353),a.map(o=>function(g,w){let x=g.updateTime?No(g.updateTime):No(w);return x.isEqual(yn.min())&&(x=No(w)),new PA(x,g.transformResults||[])}(o,n))):[]}function ZA(a,n){return{documents:[O1(a,n.path)]}}function WA(a,n){const o={structuredQuery:{}},d=n.path;let g;n.collectionGroup!==null?(g=d,o.structuredQuery.from=[{collectionId:n.collectionGroup,allDescendants:!0}]):(g=d.popLast(),o.structuredQuery.from=[{collectionId:d.lastSegment()}]),o.parent=O1(a,g);const w=function(B){if(B.length!==0)return B1(qo.create(B,"and"))}(n.filters);w&&(o.structuredQuery.where=w);const x=function(B){if(B.length!==0)return B.map(W=>function(ce){return{field:Tu(ce.field),direction:YA(ce.dir)}}(W))}(n.orderBy);x&&(o.structuredQuery.orderBy=x);const c=n_(a,n.limit);return c!==null&&(o.structuredQuery.limit=c),n.startAt&&(o.structuredQuery.startAt=function(B){return{before:B.inclusive,values:B.position}}(n.startAt)),n.endAt&&(o.structuredQuery.endAt=function(B){return{before:!B.inclusive,values:B.position}}(n.endAt)),{ft:o,parent:g}}function KA(a){let n=qA(a.parent);const o=a.structuredQuery,d=o.from?o.from.length:0;let g=null;if(d>0){sr(d===1,65062);const W=o.from[0];W.allDescendants?g=W.collectionId:n=n.child(W.collectionId)}let w=[];o.where&&(w=function(ee){const ce=V1(ee);return ce instanceof qo&&m1(ce)?ce.getFilters():[ce]}(o.where));let x=[];o.orderBy&&(x=function(ee){return ee.map(ce=>function(Ue){return new xf(Eu(Ue.field),function(Q){switch(Q){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Ue.direction))}(ce))}(o.orderBy));let c=null;o.limit&&(c=function(ee){let ce;return ce=typeof ee=="object"?ee.value:ee,qf(ce)?null:ce}(o.limit));let R=null;o.startAt&&(R=function(ee){const ce=!!ee.before,Ie=ee.values||[];return new vf(Ie,ce)}(o.startAt));let B=null;return o.endAt&&(B=function(ee){const ce=!ee.before,Ie=ee.values||[];return new vf(Ie,ce)}(o.endAt)),pA(n,g,x,w,c,"F",R,B)}function XA(a,n){const o=function(g){switch(g){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return hn(28987,{purpose:g})}}(n.purpose);return o==null?null:{"goog-listen-tags":o}}function V1(a){return a.unaryFilter!==void 0?function(o){switch(o.unaryFilter.op){case"IS_NAN":const d=Eu(o.unaryFilter.field);return fi.create(d,"==",{doubleValue:NaN});case"IS_NULL":const g=Eu(o.unaryFilter.field);return fi.create(g,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const w=Eu(o.unaryFilter.field);return fi.create(w,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const x=Eu(o.unaryFilter.field);return fi.create(x,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return hn(61313);default:return hn(60726)}}(a):a.fieldFilter!==void 0?function(o){return fi.create(Eu(o.fieldFilter.field),function(g){switch(g){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return hn(58110);default:return hn(50506)}}(o.fieldFilter.op),o.fieldFilter.value)}(a):a.compositeFilter!==void 0?function(o){return qo.create(o.compositeFilter.filters.map(d=>V1(d)),function(g){switch(g){case"AND":return"and";case"OR":return"or";default:return hn(1026)}}(o.compositeFilter.op))}(a):hn(30097,{filter:a})}function YA(a){return NA[a]}function QA(a){return VA[a]}function JA(a){return BA[a]}function Tu(a){return{fieldPath:a.canonicalString()}}function Eu(a){return Ci.fromServerFormat(a.fieldPath)}function B1(a){return a instanceof fi?function(o){if(o.op==="=="){if(ox(o.value))return{unaryFilter:{field:Tu(o.field),op:"IS_NAN"}};if(sx(o.value))return{unaryFilter:{field:Tu(o.field),op:"IS_NULL"}}}else if(o.op==="!="){if(ox(o.value))return{unaryFilter:{field:Tu(o.field),op:"IS_NOT_NAN"}};if(sx(o.value))return{unaryFilter:{field:Tu(o.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Tu(o.field),op:QA(o.op),value:o.value}}}(a):a instanceof qo?function(o){const d=o.getFilters().map(g=>B1(g));return d.length===1?d[0]:{compositeFilter:{op:JA(o.op),filters:d}}}(a):hn(54877,{filter:a})}function eC(a){const n=[];return a.fields.forEach(o=>n.push(o.canonicalString())),{fieldPaths:n}}function U1(a){return a.length>=4&&a.get(0)==="projects"&&a.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(n,o,d,g,w=yn.min(),x=yn.min(),c=Ri.EMPTY_BYTE_STRING,R=null){this.target=n,this.targetId=o,this.purpose=d,this.sequenceNumber=g,this.snapshotVersion=w,this.lastLimboFreeSnapshotVersion=x,this.resumeToken=c,this.expectedCount=R}withSequenceNumber(n){return new il(this.target,this.targetId,this.purpose,n,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(n,o){return new il(this.target,this.targetId,this.purpose,this.sequenceNumber,o,this.lastLimboFreeSnapshotVersion,n,null)}withExpectedCount(n){return new il(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,n)}withLastLimboFreeSnapshotVersion(n){return new il(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,n,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC{constructor(n){this.yt=n}}function nC(a){const n=KA({parent:a.parent,structuredQuery:a.structuredQuery});return a.limitType==="LAST"?t_(n,n.limit,"L"):n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rC{constructor(){this.Cn=new iC}addToCollectionParentIndex(n,o){return this.Cn.add(o),nt.resolve()}getCollectionParents(n,o){return nt.resolve(this.Cn.getEntries(o))}addFieldIndex(n,o){return nt.resolve()}deleteFieldIndex(n,o){return nt.resolve()}deleteAllFieldIndexes(n){return nt.resolve()}createTargetIndexes(n,o){return nt.resolve()}getDocumentsMatchingTarget(n,o){return nt.resolve(null)}getIndexType(n,o){return nt.resolve(0)}getFieldIndexes(n,o){return nt.resolve([])}getNextCollectionGroupToUpdate(n){return nt.resolve(null)}getMinOffset(n,o){return nt.resolve(ul.min())}getMinOffsetFromCollectionGroup(n,o){return nt.resolve(ul.min())}updateCollectionGroup(n,o,d){return nt.resolve()}updateIndexEntries(n,o){return nt.resolve()}}class iC{constructor(){this.index={}}add(n){const o=n.lastSegment(),d=n.popLast(),g=this.index[o]||new mi(Vr.comparator),w=!g.has(d);return this.index[o]=g.add(d),w}has(n){const o=n.lastSegment(),d=n.popLast(),g=this.index[o];return g&&g.has(d)}getEntries(n){return(this.index[n]||new mi(Vr.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},j1=41943040;class vs{static withCacheSize(n){return new vs(n,vs.DEFAULT_COLLECTION_PERCENTILE,vs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(n,o,d){this.cacheSizeCollectionThreshold=n,this.percentileToCollect=o,this.maximumSequenceNumbersToCollect=d}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */vs.DEFAULT_COLLECTION_PERCENTILE=10,vs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,vs.DEFAULT=new vs(j1,vs.DEFAULT_COLLECTION_PERCENTILE,vs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),vs.DISABLED=new vs(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu{constructor(n){this.ar=n}next(){return this.ar+=2,this.ar}static ur(){return new Fu(0)}static cr(){return new Fu(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bx="LruGarbageCollector",sC=1048576;function wx([a,n],[o,d]){const g=Un(a,o);return g===0?Un(n,d):g}class oC{constructor(n){this.Ir=n,this.buffer=new mi(wx),this.Er=0}dr(){return++this.Er}Ar(n){const o=[n,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(o);else{const d=this.buffer.last();wx(o,d)<0&&(this.buffer=this.buffer.delete(d).add(o))}}get maxValue(){return this.buffer.last()[0]}}class aC{constructor(n,o,d){this.garbageCollector=n,this.asyncQueue=o,this.localStore=d,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(n){Dt(bx,`Garbage collection scheduled in ${n}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(o){Uu(o)?Dt(bx,"Ignoring IndexedDB error during garbage collection: ",o):await Bu(o)}await this.Vr(3e5)})}}class lC{constructor(n,o){this.mr=n,this.params=o}calculateTargetCount(n,o){return this.mr.gr(n).next(d=>Math.floor(o/100*d))}nthSequenceNumber(n,o){if(o===0)return nt.resolve(jf.ce);const d=new oC(o);return this.mr.forEachTarget(n,g=>d.Ar(g.sequenceNumber)).next(()=>this.mr.pr(n,g=>d.Ar(g))).next(()=>d.maxValue)}removeTargets(n,o,d){return this.mr.removeTargets(n,o,d)}removeOrphanedDocuments(n,o){return this.mr.removeOrphanedDocuments(n,o)}collect(n,o){return this.params.cacheSizeCollectionThreshold===-1?(Dt("LruGarbageCollector","Garbage collection skipped; disabled"),nt.resolve(xx)):this.getCacheSize(n).next(d=>d<this.params.cacheSizeCollectionThreshold?(Dt("LruGarbageCollector",`Garbage collection skipped; Cache size ${d} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),xx):this.yr(n,o))}getCacheSize(n){return this.mr.getCacheSize(n)}yr(n,o){let d,g,w,x,c,R,B;const W=Date.now();return this.calculateTargetCount(n,this.params.percentileToCollect).next(ee=>(ee>this.params.maximumSequenceNumbersToCollect?(Dt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${ee}`),g=this.params.maximumSequenceNumbersToCollect):g=ee,x=Date.now(),this.nthSequenceNumber(n,g))).next(ee=>(d=ee,c=Date.now(),this.removeTargets(n,d,o))).next(ee=>(w=ee,R=Date.now(),this.removeOrphanedDocuments(n,d))).next(ee=>(B=Date.now(),bu()<=Bn.DEBUG&&Dt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${x-W}ms
	Determined least recently used ${g} in `+(c-x)+`ms
	Removed ${w} targets in `+(R-c)+`ms
	Removed ${ee} documents in `+(B-R)+`ms
Total Duration: ${B-W}ms`),nt.resolve({didRun:!0,sequenceNumbersCollected:g,targetsRemoved:w,documentsRemoved:ee})))}}function cC(a,n){return new lC(a,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uC{constructor(){this.changes=new yc(n=>n.toString(),(n,o)=>n.isEqual(o)),this.changesApplied=!1}addEntry(n){this.assertNotApplied(),this.changes.set(n.key,n)}removeEntry(n,o){this.assertNotApplied(),this.changes.set(n,$i.newInvalidDocument(n).setReadTime(o))}getEntry(n,o){this.assertNotApplied();const d=this.changes.get(o);return d!==void 0?nt.resolve(d):this.getFromCache(n,o)}getEntries(n,o){return this.getAllFromCache(n,o)}apply(n){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(n)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(n,o){this.overlayedDocument=n,this.mutatedFields=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dC{constructor(n,o,d,g){this.remoteDocumentCache=n,this.mutationQueue=o,this.documentOverlayCache=d,this.indexManager=g}getDocument(n,o){let d=null;return this.documentOverlayCache.getOverlay(n,o).next(g=>(d=g,this.remoteDocumentCache.getEntry(n,o))).next(g=>(d!==null&&id(d.mutation,g,po.empty(),Ar.now()),g))}getDocuments(n,o){return this.remoteDocumentCache.getEntries(n,o).next(d=>this.getLocalViewOfDocuments(n,d,jn()).next(()=>d))}getLocalViewOfDocuments(n,o,d=jn()){const g=sc();return this.populateOverlays(n,g,o).next(()=>this.computeViews(n,o,g,d).next(w=>{let x=Yh();return w.forEach((c,R)=>{x=x.insert(c,R.overlayedDocument)}),x}))}getOverlayedDocuments(n,o){const d=sc();return this.populateOverlays(n,d,o).next(()=>this.computeViews(n,o,d,jn()))}populateOverlays(n,o,d){const g=[];return d.forEach(w=>{o.has(w)||g.push(w)}),this.documentOverlayCache.getOverlays(n,g).next(w=>{w.forEach((x,c)=>{o.set(x,c)})})}computeViews(n,o,d,g){let w=Ea();const x=rd(),c=function(){return rd()}();return o.forEach((R,B)=>{const W=d.get(B.key);g.has(B.key)&&(W===void 0||W.mutation instanceof vc)?w=w.insert(B.key,B):W!==void 0?(x.set(B.key,W.mutation.getFieldMask()),id(W.mutation,B,W.mutation.getFieldMask(),Ar.now())):x.set(B.key,po.empty())}),this.recalculateAndSaveOverlays(n,w).next(R=>(R.forEach((B,W)=>x.set(B,W)),o.forEach((B,W)=>c.set(B,new hC(W,x.get(B)??null))),c))}recalculateAndSaveOverlays(n,o){const d=rd();let g=new Br((x,c)=>x-c),w=jn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(n,o).next(x=>{for(const c of x)c.keys().forEach(R=>{const B=o.get(R);if(B===null)return;let W=d.get(R)||po.empty();W=c.applyToLocalView(B,W),d.set(R,W);const ee=(g.get(c.batchId)||jn()).add(R);g=g.insert(c.batchId,ee)})}).next(()=>{const x=[],c=g.getReverseIterator();for(;c.hasNext();){const R=c.getNext(),B=R.key,W=R.value,ee=T1();W.forEach(ce=>{if(!w.has(ce)){const Ie=C1(o.get(ce),d.get(ce));Ie!==null&&ee.set(ce,Ie),w=w.add(ce)}}),x.push(this.documentOverlayCache.saveOverlays(n,B,ee))}return nt.waitFor(x)}).next(()=>d)}recalculateAndSaveOverlaysForDocumentKeys(n,o){return this.remoteDocumentCache.getEntries(n,o).next(d=>this.recalculateAndSaveOverlays(n,d))}getDocumentsMatchingQuery(n,o,d,g){return function(x){return nn.isDocumentKey(x.path)&&x.collectionGroup===null&&x.filters.length===0}(o)?this.getDocumentsMatchingDocumentQuery(n,o.path):fA(o)?this.getDocumentsMatchingCollectionGroupQuery(n,o,d,g):this.getDocumentsMatchingCollectionQuery(n,o,d,g)}getNextDocuments(n,o,d,g){return this.remoteDocumentCache.getAllFromCollectionGroup(n,o,d,g).next(w=>{const x=g-w.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(n,o,d.largestBatchId,g-w.size):nt.resolve(sc());let c=ld,R=w;return x.next(B=>nt.forEach(B,(W,ee)=>(c<ee.largestBatchId&&(c=ee.largestBatchId),w.get(W)?nt.resolve():this.remoteDocumentCache.getEntry(n,W).next(ce=>{R=R.insert(W,ce)}))).next(()=>this.populateOverlays(n,B,w)).next(()=>this.computeViews(n,R,B,jn())).next(W=>({batchId:c,changes:w1(W)})))})}getDocumentsMatchingDocumentQuery(n,o){return this.getDocument(n,new nn(o)).next(d=>{let g=Yh();return d.isFoundDocument()&&(g=g.insert(d.key,d)),g})}getDocumentsMatchingCollectionGroupQuery(n,o,d,g){const w=o.collectionGroup;let x=Yh();return this.indexManager.getCollectionParents(n,w).next(c=>nt.forEach(c,R=>{const B=function(ee,ce){return new Gf(ce,null,ee.explicitOrderBy.slice(),ee.filters.slice(),ee.limit,ee.limitType,ee.startAt,ee.endAt)}(o,R.child(w));return this.getDocumentsMatchingCollectionQuery(n,B,d,g).next(W=>{W.forEach((ee,ce)=>{x=x.insert(ee,ce)})})}).next(()=>x))}getDocumentsMatchingCollectionQuery(n,o,d,g){let w;return this.documentOverlayCache.getOverlaysForCollection(n,o.path,d.largestBatchId).next(x=>(w=x,this.remoteDocumentCache.getDocumentsMatchingQuery(n,o,d,w,g))).next(x=>{w.forEach((R,B)=>{const W=B.getKey();x.get(W)===null&&(x=x.insert(W,$i.newInvalidDocument(W)))});let c=Yh();return x.forEach((R,B)=>{const W=w.get(R);W!==void 0&&id(W.mutation,B,po.empty(),Ar.now()),Zf(o,B)&&(c=c.insert(R,B))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pC{constructor(n){this.serializer=n,this.Lr=new Map,this.kr=new Map}getBundleMetadata(n,o){return nt.resolve(this.Lr.get(o))}saveBundleMetadata(n,o){return this.Lr.set(o.id,function(g){return{id:g.id,version:g.version,createTime:No(g.createTime)}}(o)),nt.resolve()}getNamedQuery(n,o){return nt.resolve(this.kr.get(o))}saveNamedQuery(n,o){return this.kr.set(o.name,function(g){return{name:g.name,query:nC(g.bundledQuery),readTime:No(g.readTime)}}(o)),nt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{constructor(){this.overlays=new Br(nn.comparator),this.qr=new Map}getOverlay(n,o){return nt.resolve(this.overlays.get(o))}getOverlays(n,o){const d=sc();return nt.forEach(o,g=>this.getOverlay(n,g).next(w=>{w!==null&&d.set(g,w)})).next(()=>d)}saveOverlays(n,o,d){return d.forEach((g,w)=>{this.St(n,o,w)}),nt.resolve()}removeOverlaysForBatchId(n,o,d){const g=this.qr.get(d);return g!==void 0&&(g.forEach(w=>this.overlays=this.overlays.remove(w)),this.qr.delete(d)),nt.resolve()}getOverlaysForCollection(n,o,d){const g=sc(),w=o.length+1,x=new nn(o.child("")),c=this.overlays.getIteratorFrom(x);for(;c.hasNext();){const R=c.getNext().value,B=R.getKey();if(!o.isPrefixOf(B.path))break;B.path.length===w&&R.largestBatchId>d&&g.set(R.getKey(),R)}return nt.resolve(g)}getOverlaysForCollectionGroup(n,o,d,g){let w=new Br((B,W)=>B-W);const x=this.overlays.getIterator();for(;x.hasNext();){const B=x.getNext().value;if(B.getKey().getCollectionGroup()===o&&B.largestBatchId>d){let W=w.get(B.largestBatchId);W===null&&(W=sc(),w=w.insert(B.largestBatchId,W)),W.set(B.getKey(),B)}}const c=sc(),R=w.getIterator();for(;R.hasNext()&&(R.getNext().value.forEach((B,W)=>c.set(B,W)),!(c.size()>=g)););return nt.resolve(c)}St(n,o,d){const g=this.overlays.get(d.key);if(g!==null){const x=this.qr.get(g.largestBatchId).delete(d.key);this.qr.set(g.largestBatchId,x)}this.overlays=this.overlays.insert(d.key,new kA(o,d));let w=this.qr.get(o);w===void 0&&(w=jn(),this.qr.set(o,w)),this.qr.set(o,w.add(d.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC{constructor(){this.sessionToken=Ri.EMPTY_BYTE_STRING}getSessionToken(n){return nt.resolve(this.sessionToken)}setSessionToken(n,o){return this.sessionToken=o,nt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_{constructor(){this.Qr=new mi(Ti.$r),this.Ur=new mi(Ti.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(n,o){const d=new Ti(n,o);this.Qr=this.Qr.add(d),this.Ur=this.Ur.add(d)}Wr(n,o){n.forEach(d=>this.addReference(d,o))}removeReference(n,o){this.Gr(new Ti(n,o))}zr(n,o){n.forEach(d=>this.removeReference(d,o))}jr(n){const o=new nn(new Vr([])),d=new Ti(o,n),g=new Ti(o,n+1),w=[];return this.Ur.forEachInRange([d,g],x=>{this.Gr(x),w.push(x.key)}),w}Jr(){this.Qr.forEach(n=>this.Gr(n))}Gr(n){this.Qr=this.Qr.delete(n),this.Ur=this.Ur.delete(n)}Hr(n){const o=new nn(new Vr([])),d=new Ti(o,n),g=new Ti(o,n+1);let w=jn();return this.Ur.forEachInRange([d,g],x=>{w=w.add(x.key)}),w}containsKey(n){const o=new Ti(n,0),d=this.Qr.firstAfterOrEqual(o);return d!==null&&n.isEqual(d.key)}}class Ti{constructor(n,o){this.key=n,this.Yr=o}static $r(n,o){return nn.comparator(n.key,o.key)||Un(n.Yr,o.Yr)}static Kr(n,o){return Un(n.Yr,o.Yr)||nn.comparator(n.key,o.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(n,o){this.indexManager=n,this.referenceDelegate=o,this.mutationQueue=[],this.tr=1,this.Zr=new mi(Ti.$r)}checkEmpty(n){return nt.resolve(this.mutationQueue.length===0)}addMutationBatch(n,o,d,g){const w=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const x=new RA(w,o,d,g);this.mutationQueue.push(x);for(const c of g)this.Zr=this.Zr.add(new Ti(c.key,w)),this.indexManager.addToCollectionParentIndex(n,c.key.path.popLast());return nt.resolve(x)}lookupMutationBatch(n,o){return nt.resolve(this.Xr(o))}getNextMutationBatchAfterBatchId(n,o){const d=o+1,g=this.ei(d),w=g<0?0:g;return nt.resolve(this.mutationQueue.length>w?this.mutationQueue[w]:null)}getHighestUnacknowledgedBatchId(){return nt.resolve(this.mutationQueue.length===0?A_:this.tr-1)}getAllMutationBatches(n){return nt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(n,o){const d=new Ti(o,0),g=new Ti(o,Number.POSITIVE_INFINITY),w=[];return this.Zr.forEachInRange([d,g],x=>{const c=this.Xr(x.Yr);w.push(c)}),nt.resolve(w)}getAllMutationBatchesAffectingDocumentKeys(n,o){let d=new mi(Un);return o.forEach(g=>{const w=new Ti(g,0),x=new Ti(g,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([w,x],c=>{d=d.add(c.Yr)})}),nt.resolve(this.ti(d))}getAllMutationBatchesAffectingQuery(n,o){const d=o.path,g=d.length+1;let w=d;nn.isDocumentKey(w)||(w=w.child(""));const x=new Ti(new nn(w),0);let c=new mi(Un);return this.Zr.forEachWhile(R=>{const B=R.key.path;return!!d.isPrefixOf(B)&&(B.length===g&&(c=c.add(R.Yr)),!0)},x),nt.resolve(this.ti(c))}ti(n){const o=[];return n.forEach(d=>{const g=this.Xr(d);g!==null&&o.push(g)}),o}removeMutationBatch(n,o){sr(this.ni(o.batchId,"removed")===0,55003),this.mutationQueue.shift();let d=this.Zr;return nt.forEach(o.mutations,g=>{const w=new Ti(g.key,o.batchId);return d=d.delete(w),this.referenceDelegate.markPotentiallyOrphaned(n,g.key)}).next(()=>{this.Zr=d})}ir(n){}containsKey(n,o){const d=new Ti(o,0),g=this.Zr.firstAfterOrEqual(d);return nt.resolve(o.isEqual(g&&g.key))}performConsistencyCheck(n){return this.mutationQueue.length,nt.resolve()}ni(n,o){return this.ei(n)}ei(n){return this.mutationQueue.length===0?0:n-this.mutationQueue[0].batchId}Xr(n){const o=this.ei(n);return o<0||o>=this.mutationQueue.length?null:this.mutationQueue[o]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _C{constructor(n){this.ri=n,this.docs=function(){return new Br(nn.comparator)}(),this.size=0}setIndexManager(n){this.indexManager=n}addEntry(n,o){const d=o.key,g=this.docs.get(d),w=g?g.size:0,x=this.ri(o);return this.docs=this.docs.insert(d,{document:o.mutableCopy(),size:x}),this.size+=x-w,this.indexManager.addToCollectionParentIndex(n,d.path.popLast())}removeEntry(n){const o=this.docs.get(n);o&&(this.docs=this.docs.remove(n),this.size-=o.size)}getEntry(n,o){const d=this.docs.get(o);return nt.resolve(d?d.document.mutableCopy():$i.newInvalidDocument(o))}getEntries(n,o){let d=Ea();return o.forEach(g=>{const w=this.docs.get(g);d=d.insert(g,w?w.document.mutableCopy():$i.newInvalidDocument(g))}),nt.resolve(d)}getDocumentsMatchingQuery(n,o,d,g){let w=Ea();const x=o.path,c=new nn(x.child("__id-9223372036854775808__")),R=this.docs.getIteratorFrom(c);for(;R.hasNext();){const{key:B,value:{document:W}}=R.getNext();if(!x.isPrefixOf(B.path))break;B.path.length>x.length+1||GP($P(W),d)<=0||(g.has(W.key)||Zf(o,W))&&(w=w.insert(W.key,W.mutableCopy()))}return nt.resolve(w)}getAllFromCollectionGroup(n,o,d,g){hn(9500)}ii(n,o){return nt.forEach(this.docs,d=>o(d))}newChangeBuffer(n){return new yC(this)}getSize(n){return nt.resolve(this.size)}}class yC extends uC{constructor(n){super(),this.Nr=n}applyChanges(n){const o=[];return this.changes.forEach((d,g)=>{g.isValidDocument()?o.push(this.Nr.addEntry(n,g)):this.Nr.removeEntry(d)}),nt.waitFor(o)}getFromCache(n,o){return this.Nr.getEntry(n,o)}getAllFromCache(n,o){return this.Nr.getEntries(n,o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(n){this.persistence=n,this.si=new yc(o=>R_(o),k_),this.lastRemoteSnapshotVersion=yn.min(),this.highestTargetId=0,this.oi=0,this._i=new N_,this.targetCount=0,this.ai=Fu.ur()}forEachTarget(n,o){return this.si.forEach((d,g)=>o(g)),nt.resolve()}getLastRemoteSnapshotVersion(n){return nt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(n){return nt.resolve(this.oi)}allocateTargetId(n){return this.highestTargetId=this.ai.next(),nt.resolve(this.highestTargetId)}setTargetsMetadata(n,o,d){return d&&(this.lastRemoteSnapshotVersion=d),o>this.oi&&(this.oi=o),nt.resolve()}Pr(n){this.si.set(n.target,n);const o=n.targetId;o>this.highestTargetId&&(this.ai=new Fu(o),this.highestTargetId=o),n.sequenceNumber>this.oi&&(this.oi=n.sequenceNumber)}addTargetData(n,o){return this.Pr(o),this.targetCount+=1,nt.resolve()}updateTargetData(n,o){return this.Pr(o),nt.resolve()}removeTargetData(n,o){return this.si.delete(o.target),this._i.jr(o.targetId),this.targetCount-=1,nt.resolve()}removeTargets(n,o,d){let g=0;const w=[];return this.si.forEach((x,c)=>{c.sequenceNumber<=o&&d.get(c.targetId)===null&&(this.si.delete(x),w.push(this.removeMatchingKeysForTargetId(n,c.targetId)),g++)}),nt.waitFor(w).next(()=>g)}getTargetCount(n){return nt.resolve(this.targetCount)}getTargetData(n,o){const d=this.si.get(o)||null;return nt.resolve(d)}addMatchingKeys(n,o,d){return this._i.Wr(o,d),nt.resolve()}removeMatchingKeys(n,o,d){this._i.zr(o,d);const g=this.persistence.referenceDelegate,w=[];return g&&o.forEach(x=>{w.push(g.markPotentiallyOrphaned(n,x))}),nt.waitFor(w)}removeMatchingKeysForTargetId(n,o){return this._i.jr(o),nt.resolve()}getMatchingKeysForTargetId(n,o){const d=this._i.Hr(o);return nt.resolve(d)}containsKey(n,o){return nt.resolve(this._i.containsKey(o))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{constructor(n,o){this.ui={},this.overlays={},this.ci=new jf(0),this.li=!1,this.li=!0,this.hi=new mC,this.referenceDelegate=n(this),this.Pi=new vC(this),this.indexManager=new rC,this.remoteDocumentCache=function(g){return new _C(g)}(d=>this.referenceDelegate.Ti(d)),this.serializer=new tC(o),this.Ii=new pC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(n){return this.indexManager}getDocumentOverlayCache(n){let o=this.overlays[n.toKey()];return o||(o=new fC,this.overlays[n.toKey()]=o),o}getMutationQueue(n,o){let d=this.ui[n.toKey()];return d||(d=new gC(o,this.referenceDelegate),this.ui[n.toKey()]=d),d}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(n,o,d){Dt("MemoryPersistence","Starting transaction:",n);const g=new xC(this.ci.next());return this.referenceDelegate.Ei(),d(g).next(w=>this.referenceDelegate.di(g).next(()=>w)).toPromise().then(w=>(g.raiseOnCommittedEvent(),w))}Ai(n,o){return nt.or(Object.values(this.ui).map(d=>()=>d.containsKey(n,o)))}}class xC extends ZP{constructor(n){super(),this.currentSequenceNumber=n}}class V_{constructor(n){this.persistence=n,this.Ri=new N_,this.Vi=null}static mi(n){return new V_(n)}get fi(){if(this.Vi)return this.Vi;throw hn(60996)}addReference(n,o,d){return this.Ri.addReference(d,o),this.fi.delete(d.toString()),nt.resolve()}removeReference(n,o,d){return this.Ri.removeReference(d,o),this.fi.add(d.toString()),nt.resolve()}markPotentiallyOrphaned(n,o){return this.fi.add(o.toString()),nt.resolve()}removeTarget(n,o){this.Ri.jr(o.targetId).forEach(g=>this.fi.add(g.toString()));const d=this.persistence.getTargetCache();return d.getMatchingKeysForTargetId(n,o.targetId).next(g=>{g.forEach(w=>this.fi.add(w.toString()))}).next(()=>d.removeTargetData(n,o))}Ei(){this.Vi=new Set}di(n){const o=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nt.forEach(this.fi,d=>{const g=nn.fromPath(d);return this.gi(n,g).next(w=>{w||o.removeEntry(g,yn.min())})}).next(()=>(this.Vi=null,o.apply(n)))}updateLimboDocument(n,o){return this.gi(n,o).next(d=>{d?this.fi.delete(o.toString()):this.fi.add(o.toString())})}Ti(n){return 0}gi(n,o){return nt.or([()=>nt.resolve(this.Ri.containsKey(o)),()=>this.persistence.getTargetCache().containsKey(n,o),()=>this.persistence.Ai(n,o)])}}class Ef{constructor(n,o){this.persistence=n,this.pi=new yc(d=>XP(d.path),(d,g)=>d.isEqual(g)),this.garbageCollector=cC(this,o)}static mi(n,o){return new Ef(n,o)}Ei(){}di(n){return nt.resolve()}forEachTarget(n,o){return this.persistence.getTargetCache().forEachTarget(n,o)}gr(n){const o=this.wr(n);return this.persistence.getTargetCache().getTargetCount(n).next(d=>o.next(g=>d+g))}wr(n){let o=0;return this.pr(n,d=>{o++}).next(()=>o)}pr(n,o){return nt.forEach(this.pi,(d,g)=>this.br(n,d,g).next(w=>w?nt.resolve():o(g)))}removeTargets(n,o,d){return this.persistence.getTargetCache().removeTargets(n,o,d)}removeOrphanedDocuments(n,o){let d=0;const g=this.persistence.getRemoteDocumentCache(),w=g.newChangeBuffer();return g.ii(n,x=>this.br(n,x,o).next(c=>{c||(d++,w.removeEntry(x,yn.min()))})).next(()=>w.apply(n)).next(()=>d)}markPotentiallyOrphaned(n,o){return this.pi.set(o,n.currentSequenceNumber),nt.resolve()}removeTarget(n,o){const d=o.withSequenceNumber(n.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(n,d)}addReference(n,o,d){return this.pi.set(d,n.currentSequenceNumber),nt.resolve()}removeReference(n,o,d){return this.pi.set(d,n.currentSequenceNumber),nt.resolve()}updateLimboDocument(n,o){return this.pi.set(o,n.currentSequenceNumber),nt.resolve()}Ti(n){let o=n.key.toString().length;return n.isFoundDocument()&&(o+=nf(n.data.value)),o}br(n,o,d){return nt.or([()=>this.persistence.Ai(n,o),()=>this.persistence.getTargetCache().containsKey(n,o),()=>{const g=this.pi.get(o);return nt.resolve(g!==void 0&&g>d)}])}getCacheSize(n){return this.persistence.getRemoteDocumentCache().getSize(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_{constructor(n,o,d,g){this.targetId=n,this.fromCache=o,this.Es=d,this.ds=g}static As(n,o){let d=jn(),g=jn();for(const w of o.docChanges)switch(w.type){case 0:d=d.add(w.doc.key);break;case 1:g=g.add(w.doc.key)}return new B_(n,o.fromCache,d,g)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bC{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(n){this._documentReadCount+=n}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wC{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return pS()?8:WP(Gi())>0?6:4}()}initialize(n,o){this.ps=n,this.indexManager=o,this.Rs=!0}getDocumentsMatchingQuery(n,o,d,g){const w={result:null};return this.ys(n,o).next(x=>{w.result=x}).next(()=>{if(!w.result)return this.ws(n,o,g,d).next(x=>{w.result=x})}).next(()=>{if(w.result)return;const x=new bC;return this.Ss(n,o,x).next(c=>{if(w.result=c,this.Vs)return this.bs(n,o,x,c.size)})}).next(()=>w.result)}bs(n,o,d,g){return d.documentReadCount<this.fs?(bu()<=Bn.DEBUG&&Dt("QueryEngine","SDK will not create cache indexes for query:",wu(o),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),nt.resolve()):(bu()<=Bn.DEBUG&&Dt("QueryEngine","Query:",wu(o),"scans",d.documentReadCount,"local documents and returns",g,"documents as results."),d.documentReadCount>this.gs*g?(bu()<=Bn.DEBUG&&Dt("QueryEngine","The SDK decides to create cache indexes for query:",wu(o),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(n,Oo(o))):nt.resolve())}ys(n,o){if(ux(o))return nt.resolve(null);let d=Oo(o);return this.indexManager.getIndexType(n,d).next(g=>g===0?null:(o.limit!==null&&g===1&&(o=t_(o,null,"F"),d=Oo(o)),this.indexManager.getDocumentsMatchingTarget(n,d).next(w=>{const x=jn(...w);return this.ps.getDocuments(n,x).next(c=>this.indexManager.getMinOffset(n,d).next(R=>{const B=this.Ds(o,c);return this.Cs(o,B,x,R.readTime)?this.ys(n,t_(o,null,"F")):this.vs(n,B,o,R)}))})))}ws(n,o,d,g){return ux(o)||g.isEqual(yn.min())?nt.resolve(null):this.ps.getDocuments(n,d).next(w=>{const x=this.Ds(o,w);return this.Cs(o,x,d,g)?nt.resolve(null):(bu()<=Bn.DEBUG&&Dt("QueryEngine","Re-using previous result from %s to execute query: %s",g.toString(),wu(o)),this.vs(n,x,o,qP(g,ld)).next(c=>c))})}Ds(n,o){let d=new mi(x1(n));return o.forEach((g,w)=>{Zf(n,w)&&(d=d.add(w))}),d}Cs(n,o,d,g){if(n.limit===null)return!1;if(d.size!==o.size)return!0;const w=n.limitType==="F"?o.last():o.first();return!!w&&(w.hasPendingWrites||w.version.compareTo(g)>0)}Ss(n,o,d){return bu()<=Bn.DEBUG&&Dt("QueryEngine","Using full collection scan to execute query:",wu(o)),this.ps.getDocumentsMatchingQuery(n,o,ul.min(),d)}vs(n,o,d,g){return this.ps.getDocumentsMatchingQuery(n,d,g).next(w=>(o.forEach(x=>{w=w.insert(x.key,x)}),w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U_="LocalStore",TC=3e8;class EC{constructor(n,o,d,g){this.persistence=n,this.Fs=o,this.serializer=g,this.Ms=new Br(Un),this.xs=new yc(w=>R_(w),k_),this.Os=new Map,this.Ns=n.getRemoteDocumentCache(),this.Pi=n.getTargetCache(),this.Ii=n.getBundleCache(),this.Bs(d)}Bs(n){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(n),this.indexManager=this.persistence.getIndexManager(n),this.mutationQueue=this.persistence.getMutationQueue(n,this.indexManager),this.localDocuments=new dC(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(n){return this.persistence.runTransaction("Collect garbage","readwrite-primary",o=>n.collect(o,this.Ms))}}function IC(a,n,o,d){return new EC(a,n,o,d)}async function $1(a,n){const o=wn(a);return await o.persistence.runTransaction("Handle user change","readonly",d=>{let g;return o.mutationQueue.getAllMutationBatches(d).next(w=>(g=w,o.Bs(n),o.mutationQueue.getAllMutationBatches(d))).next(w=>{const x=[],c=[];let R=jn();for(const B of g){x.push(B.batchId);for(const W of B.mutations)R=R.add(W.key)}for(const B of w){c.push(B.batchId);for(const W of B.mutations)R=R.add(W.key)}return o.localDocuments.getDocuments(d,R).next(B=>({Ls:B,removedBatchIds:x,addedBatchIds:c}))})})}function SC(a,n){const o=wn(a);return o.persistence.runTransaction("Acknowledge batch","readwrite-primary",d=>{const g=n.batch.keys(),w=o.Ns.newChangeBuffer({trackRemovals:!0});return function(c,R,B,W){const ee=B.batch,ce=ee.keys();let Ie=nt.resolve();return ce.forEach(Ue=>{Ie=Ie.next(()=>W.getEntry(R,Ue)).next(ke=>{const Q=B.docVersions.get(Ue);sr(Q!==null,48541),ke.version.compareTo(Q)<0&&(ee.applyToRemoteDocument(ke,B),ke.isValidDocument()&&(ke.setReadTime(B.commitVersion),W.addEntry(ke)))})}),Ie.next(()=>c.mutationQueue.removeMutationBatch(R,ee))}(o,d,n,w).next(()=>w.apply(d)).next(()=>o.mutationQueue.performConsistencyCheck(d)).next(()=>o.documentOverlayCache.removeOverlaysForBatchId(d,g,n.batch.batchId)).next(()=>o.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,function(c){let R=jn();for(let B=0;B<c.mutationResults.length;++B)c.mutationResults[B].transformResults.length>0&&(R=R.add(c.batch.mutations[B].key));return R}(n))).next(()=>o.localDocuments.getDocuments(d,g))})}function G1(a){const n=wn(a);return n.persistence.runTransaction("Get last remote snapshot version","readonly",o=>n.Pi.getLastRemoteSnapshotVersion(o))}function PC(a,n){const o=wn(a),d=n.snapshotVersion;let g=o.Ms;return o.persistence.runTransaction("Apply remote event","readwrite-primary",w=>{const x=o.Ns.newChangeBuffer({trackRemovals:!0});g=o.Ms;const c=[];n.targetChanges.forEach((W,ee)=>{const ce=g.get(ee);if(!ce)return;c.push(o.Pi.removeMatchingKeys(w,W.removedDocuments,ee).next(()=>o.Pi.addMatchingKeys(w,W.addedDocuments,ee)));let Ie=ce.withSequenceNumber(w.currentSequenceNumber);n.targetMismatches.get(ee)!==null?Ie=Ie.withResumeToken(Ri.EMPTY_BYTE_STRING,yn.min()).withLastLimboFreeSnapshotVersion(yn.min()):W.resumeToken.approximateByteSize()>0&&(Ie=Ie.withResumeToken(W.resumeToken,d)),g=g.insert(ee,Ie),function(ke,Q,qe){return ke.resumeToken.approximateByteSize()===0||Q.snapshotVersion.toMicroseconds()-ke.snapshotVersion.toMicroseconds()>=TC?!0:qe.addedDocuments.size+qe.modifiedDocuments.size+qe.removedDocuments.size>0}(ce,Ie,W)&&c.push(o.Pi.updateTargetData(w,Ie))});let R=Ea(),B=jn();if(n.documentUpdates.forEach(W=>{n.resolvedLimboDocuments.has(W)&&c.push(o.persistence.referenceDelegate.updateLimboDocument(w,W))}),c.push(AC(w,x,n.documentUpdates).next(W=>{R=W.ks,B=W.qs})),!d.isEqual(yn.min())){const W=o.Pi.getLastRemoteSnapshotVersion(w).next(ee=>o.Pi.setTargetsMetadata(w,w.currentSequenceNumber,d));c.push(W)}return nt.waitFor(c).next(()=>x.apply(w)).next(()=>o.localDocuments.getLocalViewOfDocuments(w,R,B)).next(()=>R)}).then(w=>(o.Ms=g,w))}function AC(a,n,o){let d=jn(),g=jn();return o.forEach(w=>d=d.add(w)),n.getEntries(a,d).next(w=>{let x=Ea();return o.forEach((c,R)=>{const B=w.get(c);R.isFoundDocument()!==B.isFoundDocument()&&(g=g.add(c)),R.isNoDocument()&&R.version.isEqual(yn.min())?(n.removeEntry(c,R.readTime),x=x.insert(c,R)):!B.isValidDocument()||R.version.compareTo(B.version)>0||R.version.compareTo(B.version)===0&&B.hasPendingWrites?(n.addEntry(R),x=x.insert(c,R)):Dt(U_,"Ignoring outdated watch update for ",c,". Current version:",B.version," Watch version:",R.version)}),{ks:x,qs:g}})}function CC(a,n){const o=wn(a);return o.persistence.runTransaction("Get next mutation batch","readonly",d=>(n===void 0&&(n=A_),o.mutationQueue.getNextMutationBatchAfterBatchId(d,n)))}function MC(a,n){const o=wn(a);return o.persistence.runTransaction("Allocate target","readwrite",d=>{let g;return o.Pi.getTargetData(d,n).next(w=>w?(g=w,nt.resolve(g)):o.Pi.allocateTargetId(d).next(x=>(g=new il(n,x,"TargetPurposeListen",d.currentSequenceNumber),o.Pi.addTargetData(d,g).next(()=>g))))}).then(d=>{const g=o.Ms.get(d.targetId);return(g===null||d.snapshotVersion.compareTo(g.snapshotVersion)>0)&&(o.Ms=o.Ms.insert(d.targetId,d),o.xs.set(n,d.targetId)),d})}async function o_(a,n,o){const d=wn(a),g=d.Ms.get(n),w=o?"readwrite":"readwrite-primary";try{o||await d.persistence.runTransaction("Release target",w,x=>d.persistence.referenceDelegate.removeTarget(x,g))}catch(x){if(!Uu(x))throw x;Dt(U_,`Failed to update sequence numbers for target ${n}: ${x}`)}d.Ms=d.Ms.remove(n),d.xs.delete(g.target)}function Tx(a,n,o){const d=wn(a);let g=yn.min(),w=jn();return d.persistence.runTransaction("Execute query","readwrite",x=>function(R,B,W){const ee=wn(R),ce=ee.xs.get(W);return ce!==void 0?nt.resolve(ee.Ms.get(ce)):ee.Pi.getTargetData(B,W)}(d,x,Oo(n)).next(c=>{if(c)return g=c.lastLimboFreeSnapshotVersion,d.Pi.getMatchingKeysForTargetId(x,c.targetId).next(R=>{w=R})}).next(()=>d.Fs.getDocumentsMatchingQuery(x,n,o?g:yn.min(),o?w:jn())).next(c=>(RC(d,gA(n),c),{documents:c,Qs:w})))}function RC(a,n,o){let d=a.Os.get(n)||yn.min();o.forEach((g,w)=>{w.readTime.compareTo(d)>0&&(d=w.readTime)}),a.Os.set(n,d)}class Ex{constructor(){this.activeTargetIds=wA()}zs(n){this.activeTargetIds=this.activeTargetIds.add(n)}js(n){this.activeTargetIds=this.activeTargetIds.delete(n)}Gs(){const n={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(n)}}class kC{constructor(){this.Mo=new Ex,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(n){}updateMutationState(n,o,d){}addLocalQueryTarget(n,o=!0){return o&&this.Mo.zs(n),this.xo[n]||"not-current"}updateQueryState(n,o,d){this.xo[n]=o}removeLocalQueryTarget(n){this.Mo.js(n)}isLocalQueryTarget(n){return this.Mo.activeTargetIds.has(n)}clearQueryState(n){delete this.xo[n]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(n){return this.Mo.activeTargetIds.has(n)}start(){return this.Mo=new Ex,Promise.resolve()}handleUserChange(n,o,d){}setOnlineState(n){}shutdown(){}writeSequenceNumber(n){}notifyBundleLoaded(n){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{Oo(n){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ix="ConnectivityMonitor";class Sx{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(n){this.qo.push(n)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Dt(Ix,"Network connectivity changed: AVAILABLE");for(const n of this.qo)n(0)}ko(){Dt(Ix,"Network connectivity changed: UNAVAILABLE");for(const n of this.qo)n(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kp=null;function a_(){return Kp===null?Kp=function(){return 268435456+Math.round(2147483648*Math.random())}():Kp++,"0x"+Kp.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dg="RestConnection",LC={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class zC{get $o(){return!1}constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const o=n.ssl?"https":"http",d=encodeURIComponent(this.databaseId.projectId),g=encodeURIComponent(this.databaseId.database);this.Uo=o+"://"+n.host,this.Ko=`projects/${d}/databases/${g}`,this.Wo=this.databaseId.database===_f?`project_id=${d}`:`project_id=${d}&database_id=${g}`}Go(n,o,d,g,w){const x=a_(),c=this.zo(n,o.toUriEncodedString());Dt(Dg,`Sending RPC '${n}' ${x}:`,c,d);const R={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(R,g,w);const{host:B}=new URL(c),W=mc(B);return this.Jo(n,c,R,d,W).then(ee=>(Dt(Dg,`Received RPC '${n}' ${x}: `,ee),ee),ee=>{throw ku(Dg,`RPC '${n}' ${x} failed with error: `,ee,"url: ",c,"request:",d),ee})}Ho(n,o,d,g,w,x){return this.Go(n,o,d,g,w)}jo(n,o,d){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Vu}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),o&&o.headers.forEach((g,w)=>n[w]=g),d&&d.headers.forEach((g,w)=>n[w]=g)}zo(n,o){const d=LC[n];return`${this.Uo}/v1/${o}:${d}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(n){this.Yo=n.Yo,this.Zo=n.Zo}Xo(n){this.e_=n}t_(n){this.n_=n}r_(n){this.i_=n}onMessage(n){this.s_=n}close(){this.Zo()}send(n){this.Yo(n)}o_(){this.e_()}__(){this.n_()}a_(n){this.i_(n)}u_(n){this.s_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ui="WebChannelConnection";class OC extends zC{constructor(n){super(n),this.c_=[],this.forceLongPolling=n.forceLongPolling,this.autoDetectLongPolling=n.autoDetectLongPolling,this.useFetchStreams=n.useFetchStreams,this.longPollingOptions=n.longPollingOptions}Jo(n,o,d,g,w){const x=a_();return new Promise((c,R)=>{const B=new Kb;B.setWithCredentials(!0),B.listenOnce(Xb.COMPLETE,()=>{try{switch(B.getLastErrorCode()){case tf.NO_ERROR:const ee=B.getResponseJson();Dt(Ui,`XHR for RPC '${n}' ${x} received:`,JSON.stringify(ee)),c(ee);break;case tf.TIMEOUT:Dt(Ui,`RPC '${n}' ${x} timed out`),R(new Zt(lt.DEADLINE_EXCEEDED,"Request time out"));break;case tf.HTTP_ERROR:const ce=B.getStatus();if(Dt(Ui,`RPC '${n}' ${x} failed with status:`,ce,"response text:",B.getResponseText()),ce>0){let Ie=B.getResponseJson();Array.isArray(Ie)&&(Ie=Ie[0]);const Ue=Ie==null?void 0:Ie.error;if(Ue&&Ue.status&&Ue.message){const ke=function(qe){const Ye=qe.toLowerCase().replace(/_/g,"-");return Object.values(lt).indexOf(Ye)>=0?Ye:lt.UNKNOWN}(Ue.status);R(new Zt(ke,Ue.message))}else R(new Zt(lt.UNKNOWN,"Server responded with status "+B.getStatus()))}else R(new Zt(lt.UNAVAILABLE,"Connection failed."));break;default:hn(9055,{l_:n,streamId:x,h_:B.getLastErrorCode(),P_:B.getLastError()})}}finally{Dt(Ui,`RPC '${n}' ${x} completed.`)}});const W=JSON.stringify(g);Dt(Ui,`RPC '${n}' ${x} sending request:`,g),B.send(o,"POST",W,d,15)})}T_(n,o,d){const g=a_(),w=[this.Uo,"/","google.firestore.v1.Firestore","/",n,"/channel"],x=Jb(),c=Qb(),R={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},B=this.longPollingOptions.timeoutSeconds;B!==void 0&&(R.longPollingTimeout=Math.round(1e3*B)),this.useFetchStreams&&(R.useFetchStreams=!0),this.jo(R.initMessageHeaders,o,d),R.encodeInitMessageHeaders=!0;const W=w.join("");Dt(Ui,`Creating RPC '${n}' stream ${g}: ${W}`,R);const ee=x.createWebChannel(W,R);this.I_(ee);let ce=!1,Ie=!1;const Ue=new FC({Yo:Q=>{Ie?Dt(Ui,`Not sending because RPC '${n}' stream ${g} is closed:`,Q):(ce||(Dt(Ui,`Opening RPC '${n}' stream ${g} transport.`),ee.open(),ce=!0),Dt(Ui,`RPC '${n}' stream ${g} sending:`,Q),ee.send(Q))},Zo:()=>ee.close()}),ke=(Q,qe,Ye)=>{Q.listen(qe,Ge=>{try{Ye(Ge)}catch(ht){setTimeout(()=>{throw ht},0)}})};return ke(ee,Xh.EventType.OPEN,()=>{Ie||(Dt(Ui,`RPC '${n}' stream ${g} transport opened.`),Ue.o_())}),ke(ee,Xh.EventType.CLOSE,()=>{Ie||(Ie=!0,Dt(Ui,`RPC '${n}' stream ${g} transport closed`),Ue.a_(),this.E_(ee))}),ke(ee,Xh.EventType.ERROR,Q=>{Ie||(Ie=!0,ku(Ui,`RPC '${n}' stream ${g} transport errored. Name:`,Q.name,"Message:",Q.message),Ue.a_(new Zt(lt.UNAVAILABLE,"The operation could not be completed")))}),ke(ee,Xh.EventType.MESSAGE,Q=>{var qe;if(!Ie){const Ye=Q.data[0];sr(!!Ye,16349);const Ge=Ye,ht=(Ge==null?void 0:Ge.error)||((qe=Ge[0])==null?void 0:qe.error);if(ht){Dt(Ui,`RPC '${n}' stream ${g} received error:`,ht);const ct=ht.status;let ot=function(ue){const Ee=ai[ue];if(Ee!==void 0)return k1(Ee)}(ct),xe=ht.message;ot===void 0&&(ot=lt.INTERNAL,xe="Unknown error status: "+ct+" with message "+ht.message),Ie=!0,Ue.a_(new Zt(ot,xe)),ee.close()}else Dt(Ui,`RPC '${n}' stream ${g} received:`,Ye),Ue.u_(Ye)}}),ke(c,Yb.STAT_EVENT,Q=>{Q.stat===Kg.PROXY?Dt(Ui,`RPC '${n}' stream ${g} detected buffering proxy`):Q.stat===Kg.NOPROXY&&Dt(Ui,`RPC '${n}' stream ${g} detected no buffering proxy`)}),setTimeout(()=>{Ue.__()},0),Ue}terminate(){this.c_.forEach(n=>n.close()),this.c_=[]}I_(n){this.c_.push(n)}E_(n){this.c_=this.c_.filter(o=>o===n)}}function Lg(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yf(a){return new UA(a,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H1{constructor(n,o,d=1e3,g=1.5,w=6e4){this.Mi=n,this.timerId=o,this.d_=d,this.A_=g,this.R_=w,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(n){this.cancel();const o=Math.floor(this.V_+this.y_()),d=Math.max(0,Date.now()-this.f_),g=Math.max(0,o-d);g>0&&Dt("ExponentialBackoff",`Backing off for ${g} ms (base delay: ${this.V_} ms, delay with jitter: ${o} ms, last attempt: ${d} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,g,()=>(this.f_=Date.now(),n())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Px="PersistentStream";class Z1{constructor(n,o,d,g,w,x,c,R){this.Mi=n,this.S_=d,this.b_=g,this.connection=w,this.authCredentialsProvider=x,this.appCheckCredentialsProvider=c,this.listener=R,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new H1(n,o)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(n){this.Q_(),this.stream.send(n)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(n,o){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,n!==4?this.M_.reset():o&&o.code===lt.RESOURCE_EXHAUSTED?(Ta(o.toString()),Ta("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):o&&o.code===lt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=n,await this.listener.r_(o)}K_(){}auth(){this.state=1;const n=this.W_(this.D_),o=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([d,g])=>{this.D_===o&&this.G_(d,g)},d=>{n(()=>{const g=new Zt(lt.UNKNOWN,"Fetching auth token failed: "+d.message);return this.z_(g)})})}G_(n,o){const d=this.W_(this.D_);this.stream=this.j_(n,o),this.stream.Xo(()=>{d(()=>this.listener.Xo())}),this.stream.t_(()=>{d(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(g=>{d(()=>this.z_(g))}),this.stream.onMessage(g=>{d(()=>++this.F_==1?this.J_(g):this.onNext(g))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(n){return Dt(Px,`close with error: ${n}`),this.stream=null,this.close(4,n)}W_(n){return o=>{this.Mi.enqueueAndForget(()=>this.D_===n?o():(Dt(Px,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class NC extends Z1{constructor(n,o,d,g,w,x){super(n,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",o,d,g,x),this.serializer=w}j_(n,o){return this.connection.T_("Listen",n,o)}J_(n){return this.onNext(n)}onNext(n){this.M_.reset();const o=$A(this.serializer,n),d=function(w){if(!("targetChange"in w))return yn.min();const x=w.targetChange;return x.targetIds&&x.targetIds.length?yn.min():x.readTime?No(x.readTime):yn.min()}(n);return this.listener.H_(o,d)}Y_(n){const o={};o.database=s_(this.serializer),o.addTarget=function(w,x){let c;const R=x.target;if(c=e_(R)?{documents:ZA(w,R)}:{query:WA(w,R).ft},c.targetId=x.targetId,x.resumeToken.approximateByteSize()>0){c.resumeToken=z1(w,x.resumeToken);const B=n_(w,x.expectedCount);B!==null&&(c.expectedCount=B)}else if(x.snapshotVersion.compareTo(yn.min())>0){c.readTime=Tf(w,x.snapshotVersion.toTimestamp());const B=n_(w,x.expectedCount);B!==null&&(c.expectedCount=B)}return c}(this.serializer,n);const d=XA(this.serializer,n);d&&(o.labels=d),this.q_(o)}Z_(n){const o={};o.database=s_(this.serializer),o.removeTarget=n,this.q_(o)}}class VC extends Z1{constructor(n,o,d,g,w,x){super(n,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",o,d,g,x),this.serializer=w}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(n,o){return this.connection.T_("Write",n,o)}J_(n){return sr(!!n.streamToken,31322),this.lastStreamToken=n.streamToken,sr(!n.writeResults||n.writeResults.length===0,55816),this.listener.ta()}onNext(n){sr(!!n.streamToken,12678),this.lastStreamToken=n.streamToken,this.M_.reset();const o=HA(n.writeResults,n.commitTime),d=No(n.commitTime);return this.listener.na(d,o)}ra(){const n={};n.database=s_(this.serializer),this.q_(n)}ea(n){const o={streamToken:this.lastStreamToken,writes:n.map(d=>GA(this.serializer,d))};this.q_(o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{}class UC extends BC{constructor(n,o,d,g){super(),this.authCredentials=n,this.appCheckCredentials=o,this.connection=d,this.serializer=g,this.ia=!1}sa(){if(this.ia)throw new Zt(lt.FAILED_PRECONDITION,"The client has already been terminated.")}Go(n,o,d,g){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([w,x])=>this.connection.Go(n,r_(o,d),g,w,x)).catch(w=>{throw w.name==="FirebaseError"?(w.code===lt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),w):new Zt(lt.UNKNOWN,w.toString())})}Ho(n,o,d,g,w){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([x,c])=>this.connection.Ho(n,r_(o,d),g,x,c,w)).catch(x=>{throw x.name==="FirebaseError"?(x.code===lt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),x):new Zt(lt.UNKNOWN,x.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class jC{constructor(n,o){this.asyncQueue=n,this.onlineStateHandler=o,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(n){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${n.toString()}`),this.ca("Offline")))}set(n){this.Pa(),this.oa=0,n==="Online"&&(this.aa=!1),this.ca(n)}ca(n){n!==this.state&&(this.state=n,this.onlineStateHandler(n))}la(n){const o=`Could not reach Cloud Firestore backend. ${n}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ta(o),this.aa=!1):Dt("OnlineStateTracker",o)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dc="RemoteStore";class qC{constructor(n,o,d,g,w){this.localStore=n,this.datastore=o,this.asyncQueue=d,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=w,this.Aa.Oo(x=>{d.enqueueAndForget(async()=>{xc(this)&&(Dt(dc,"Restarting streams for network reachability change."),await async function(R){const B=wn(R);B.Ea.add(4),await wd(B),B.Ra.set("Unknown"),B.Ea.delete(4),await Qf(B)}(this))})}),this.Ra=new jC(d,g)}}async function Qf(a){if(xc(a))for(const n of a.da)await n(!0)}async function wd(a){for(const n of a.da)await n(!1)}function W1(a,n){const o=wn(a);o.Ia.has(n.targetId)||(o.Ia.set(n.targetId,n),G_(o)?$_(o):ju(o).O_()&&q_(o,n))}function j_(a,n){const o=wn(a),d=ju(o);o.Ia.delete(n),d.O_()&&K1(o,n),o.Ia.size===0&&(d.O_()?d.L_():xc(o)&&o.Ra.set("Unknown"))}function q_(a,n){if(a.Va.Ue(n.targetId),n.resumeToken.approximateByteSize()>0||n.snapshotVersion.compareTo(yn.min())>0){const o=a.remoteSyncer.getRemoteKeysForTarget(n.targetId).size;n=n.withExpectedCount(o)}ju(a).Y_(n)}function K1(a,n){a.Va.Ue(n),ju(a).Z_(n)}function $_(a){a.Va=new OA({getRemoteKeysForTarget:n=>a.remoteSyncer.getRemoteKeysForTarget(n),At:n=>a.Ia.get(n)||null,ht:()=>a.datastore.serializer.databaseId}),ju(a).start(),a.Ra.ua()}function G_(a){return xc(a)&&!ju(a).x_()&&a.Ia.size>0}function xc(a){return wn(a).Ea.size===0}function X1(a){a.Va=void 0}async function $C(a){a.Ra.set("Online")}async function GC(a){a.Ia.forEach((n,o)=>{q_(a,n)})}async function HC(a,n){X1(a),G_(a)?(a.Ra.ha(n),$_(a)):a.Ra.set("Unknown")}async function ZC(a,n,o){if(a.Ra.set("Online"),n instanceof L1&&n.state===2&&n.cause)try{await async function(g,w){const x=w.cause;for(const c of w.targetIds)g.Ia.has(c)&&(await g.remoteSyncer.rejectListen(c,x),g.Ia.delete(c),g.Va.removeTarget(c))}(a,n)}catch(d){Dt(dc,"Failed to remove targets %s: %s ",n.targetIds.join(","),d),await If(a,d)}else if(n instanceof of?a.Va.Ze(n):n instanceof D1?a.Va.st(n):a.Va.tt(n),!o.isEqual(yn.min()))try{const d=await G1(a.localStore);o.compareTo(d)>=0&&await function(w,x){const c=w.Va.Tt(x);return c.targetChanges.forEach((R,B)=>{if(R.resumeToken.approximateByteSize()>0){const W=w.Ia.get(B);W&&w.Ia.set(B,W.withResumeToken(R.resumeToken,x))}}),c.targetMismatches.forEach((R,B)=>{const W=w.Ia.get(R);if(!W)return;w.Ia.set(R,W.withResumeToken(Ri.EMPTY_BYTE_STRING,W.snapshotVersion)),K1(w,R);const ee=new il(W.target,R,B,W.sequenceNumber);q_(w,ee)}),w.remoteSyncer.applyRemoteEvent(c)}(a,o)}catch(d){Dt(dc,"Failed to raise snapshot:",d),await If(a,d)}}async function If(a,n,o){if(!Uu(n))throw n;a.Ea.add(1),await wd(a),a.Ra.set("Offline"),o||(o=()=>G1(a.localStore)),a.asyncQueue.enqueueRetryable(async()=>{Dt(dc,"Retrying IndexedDB access"),await o(),a.Ea.delete(1),await Qf(a)})}function Y1(a,n){return n().catch(o=>If(a,o,n))}async function Jf(a){const n=wn(a),o=fl(n);let d=n.Ta.length>0?n.Ta[n.Ta.length-1].batchId:A_;for(;WC(n);)try{const g=await CC(n.localStore,d);if(g===null){n.Ta.length===0&&o.L_();break}d=g.batchId,KC(n,g)}catch(g){await If(n,g)}Q1(n)&&J1(n)}function WC(a){return xc(a)&&a.Ta.length<10}function KC(a,n){a.Ta.push(n);const o=fl(a);o.O_()&&o.X_&&o.ea(n.mutations)}function Q1(a){return xc(a)&&!fl(a).x_()&&a.Ta.length>0}function J1(a){fl(a).start()}async function XC(a){fl(a).ra()}async function YC(a){const n=fl(a);for(const o of a.Ta)n.ea(o.mutations)}async function QC(a,n,o){const d=a.Ta.shift(),g=z_.from(d,n,o);await Y1(a,()=>a.remoteSyncer.applySuccessfulWrite(g)),await Jf(a)}async function JC(a,n){n&&fl(a).X_&&await async function(d,g){if(function(x){return LA(x)&&x!==lt.ABORTED}(g.code)){const w=d.Ta.shift();fl(d).B_(),await Y1(d,()=>d.remoteSyncer.rejectFailedWrite(w.batchId,g)),await Jf(d)}}(a,n),Q1(a)&&J1(a)}async function Ax(a,n){const o=wn(a);o.asyncQueue.verifyOperationInProgress(),Dt(dc,"RemoteStore received new credentials");const d=xc(o);o.Ea.add(3),await wd(o),d&&o.Ra.set("Unknown"),await o.remoteSyncer.handleCredentialChange(n),o.Ea.delete(3),await Qf(o)}async function eM(a,n){const o=wn(a);n?(o.Ea.delete(2),await Qf(o)):n||(o.Ea.add(2),await wd(o),o.Ra.set("Unknown"))}function ju(a){return a.ma||(a.ma=function(o,d,g){const w=wn(o);return w.sa(),new NC(d,w.connection,w.authCredentials,w.appCheckCredentials,w.serializer,g)}(a.datastore,a.asyncQueue,{Xo:$C.bind(null,a),t_:GC.bind(null,a),r_:HC.bind(null,a),H_:ZC.bind(null,a)}),a.da.push(async n=>{n?(a.ma.B_(),G_(a)?$_(a):a.Ra.set("Unknown")):(await a.ma.stop(),X1(a))})),a.ma}function fl(a){return a.fa||(a.fa=function(o,d,g){const w=wn(o);return w.sa(),new VC(d,w.connection,w.authCredentials,w.appCheckCredentials,w.serializer,g)}(a.datastore,a.asyncQueue,{Xo:()=>Promise.resolve(),t_:XC.bind(null,a),r_:JC.bind(null,a),ta:YC.bind(null,a),na:QC.bind(null,a)}),a.da.push(async n=>{n?(a.fa.B_(),await Jf(a)):(await a.fa.stop(),a.Ta.length>0&&(Dt(dc,`Stopping write stream with ${a.Ta.length} pending writes`),a.Ta=[]))})),a.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H_{constructor(n,o,d,g,w){this.asyncQueue=n,this.timerId=o,this.targetTimeMs=d,this.op=g,this.removalCallback=w,this.deferred=new ac,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(x=>{})}get promise(){return this.deferred.promise}static createAndSchedule(n,o,d,g,w){const x=Date.now()+d,c=new H_(n,o,x,g,w);return c.start(d),c}start(n){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),n)}skipDelay(){return this.handleDelayElapsed()}cancel(n){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Zt(lt.CANCELLED,"Operation cancelled"+(n?": "+n:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(n=>this.deferred.resolve(n))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Z_(a,n){if(Ta("AsyncQueue",`${n}: ${a}`),Uu(a))return new Zt(lt.UNAVAILABLE,`${n}: ${a}`);throw a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{static emptySet(n){return new Pu(n.comparator)}constructor(n){this.comparator=n?(o,d)=>n(o,d)||nn.comparator(o.key,d.key):(o,d)=>nn.comparator(o.key,d.key),this.keyedMap=Yh(),this.sortedSet=new Br(this.comparator)}has(n){return this.keyedMap.get(n)!=null}get(n){return this.keyedMap.get(n)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(n){const o=this.keyedMap.get(n);return o?this.sortedSet.indexOf(o):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((o,d)=>(n(o),!1))}add(n){const o=this.delete(n.key);return o.copy(o.keyedMap.insert(n.key,n),o.sortedSet.insert(n,null))}delete(n){const o=this.get(n);return o?this.copy(this.keyedMap.remove(n),this.sortedSet.remove(o)):this}isEqual(n){if(!(n instanceof Pu)||this.size!==n.size)return!1;const o=this.sortedSet.getIterator(),d=n.sortedSet.getIterator();for(;o.hasNext();){const g=o.getNext().key,w=d.getNext().key;if(!g.isEqual(w))return!1}return!0}toString(){const n=[];return this.forEach(o=>{n.push(o.toString())}),n.length===0?"DocumentSet ()":`DocumentSet (
  `+n.join(`  
`)+`
)`}copy(n,o){const d=new Pu;return d.comparator=this.comparator,d.keyedMap=n,d.sortedSet=o,d}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cx{constructor(){this.ga=new Br(nn.comparator)}track(n){const o=n.doc.key,d=this.ga.get(o);d?n.type!==0&&d.type===3?this.ga=this.ga.insert(o,n):n.type===3&&d.type!==1?this.ga=this.ga.insert(o,{type:d.type,doc:n.doc}):n.type===2&&d.type===2?this.ga=this.ga.insert(o,{type:2,doc:n.doc}):n.type===2&&d.type===0?this.ga=this.ga.insert(o,{type:0,doc:n.doc}):n.type===1&&d.type===0?this.ga=this.ga.remove(o):n.type===1&&d.type===2?this.ga=this.ga.insert(o,{type:1,doc:d.doc}):n.type===0&&d.type===1?this.ga=this.ga.insert(o,{type:2,doc:n.doc}):hn(63341,{Rt:n,pa:d}):this.ga=this.ga.insert(o,n)}ya(){const n=[];return this.ga.inorderTraversal((o,d)=>{n.push(d)}),n}}class Ou{constructor(n,o,d,g,w,x,c,R,B){this.query=n,this.docs=o,this.oldDocs=d,this.docChanges=g,this.mutatedKeys=w,this.fromCache=x,this.syncStateChanged=c,this.excludesMetadataChanges=R,this.hasCachedResults=B}static fromInitialDocuments(n,o,d,g,w){const x=[];return o.forEach(c=>{x.push({type:0,doc:c})}),new Ou(n,o,Pu.emptySet(o),x,d,g,!0,!1,w)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(n){if(!(this.fromCache===n.fromCache&&this.hasCachedResults===n.hasCachedResults&&this.syncStateChanged===n.syncStateChanged&&this.mutatedKeys.isEqual(n.mutatedKeys)&&Hf(this.query,n.query)&&this.docs.isEqual(n.docs)&&this.oldDocs.isEqual(n.oldDocs)))return!1;const o=this.docChanges,d=n.docChanges;if(o.length!==d.length)return!1;for(let g=0;g<o.length;g++)if(o[g].type!==d[g].type||!o[g].doc.isEqual(d[g].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tM{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(n=>n.Da())}}class nM{constructor(){this.queries=Mx(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(o,d){const g=wn(o),w=g.queries;g.queries=Mx(),w.forEach((x,c)=>{for(const R of c.Sa)R.onError(d)})})(this,new Zt(lt.ABORTED,"Firestore shutting down"))}}function Mx(){return new yc(a=>v1(a),Hf)}async function rM(a,n){const o=wn(a);let d=3;const g=n.query;let w=o.queries.get(g);w?!w.ba()&&n.Da()&&(d=2):(w=new tM,d=n.Da()?0:1);try{switch(d){case 0:w.wa=await o.onListen(g,!0);break;case 1:w.wa=await o.onListen(g,!1);break;case 2:await o.onFirstRemoteStoreListen(g)}}catch(x){const c=Z_(x,`Initialization of query '${wu(n.query)}' failed`);return void n.onError(c)}o.queries.set(g,w),w.Sa.push(n),n.va(o.onlineState),w.wa&&n.Fa(w.wa)&&W_(o)}async function iM(a,n){const o=wn(a),d=n.query;let g=3;const w=o.queries.get(d);if(w){const x=w.Sa.indexOf(n);x>=0&&(w.Sa.splice(x,1),w.Sa.length===0?g=n.Da()?0:1:!w.ba()&&n.Da()&&(g=2))}switch(g){case 0:return o.queries.delete(d),o.onUnlisten(d,!0);case 1:return o.queries.delete(d),o.onUnlisten(d,!1);case 2:return o.onLastRemoteStoreUnlisten(d);default:return}}function sM(a,n){const o=wn(a);let d=!1;for(const g of n){const w=g.query,x=o.queries.get(w);if(x){for(const c of x.Sa)c.Fa(g)&&(d=!0);x.wa=g}}d&&W_(o)}function oM(a,n,o){const d=wn(a),g=d.queries.get(n);if(g)for(const w of g.Sa)w.onError(o);d.queries.delete(n)}function W_(a){a.Ca.forEach(n=>{n.next()})}var l_,Rx;(Rx=l_||(l_={})).Ma="default",Rx.Cache="cache";class aM{constructor(n,o,d){this.query=n,this.xa=o,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=d||{}}Fa(n){if(!this.options.includeMetadataChanges){const d=[];for(const g of n.docChanges)g.type!==3&&d.push(g);n=new Ou(n.query,n.docs,n.oldDocs,d,n.mutatedKeys,n.fromCache,n.syncStateChanged,!0,n.hasCachedResults)}let o=!1;return this.Oa?this.Ba(n)&&(this.xa.next(n),o=!0):this.La(n,this.onlineState)&&(this.ka(n),o=!0),this.Na=n,o}onError(n){this.xa.error(n)}va(n){this.onlineState=n;let o=!1;return this.Na&&!this.Oa&&this.La(this.Na,n)&&(this.ka(this.Na),o=!0),o}La(n,o){if(!n.fromCache||!this.Da())return!0;const d=o!=="Offline";return(!this.options.qa||!d)&&(!n.docs.isEmpty()||n.hasCachedResults||o==="Offline")}Ba(n){if(n.docChanges.length>0)return!0;const o=this.Na&&this.Na.hasPendingWrites!==n.hasPendingWrites;return!(!n.syncStateChanged&&!o)&&this.options.includeMetadataChanges===!0}ka(n){n=Ou.fromInitialDocuments(n.query,n.docs,n.mutatedKeys,n.fromCache,n.hasCachedResults),this.Oa=!0,this.xa.next(n)}Da(){return this.options.source!==l_.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ew{constructor(n){this.key=n}}class tw{constructor(n){this.key=n}}class lM{constructor(n,o){this.query=n,this.Ya=o,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=jn(),this.mutatedKeys=jn(),this.eu=x1(n),this.tu=new Pu(this.eu)}get nu(){return this.Ya}ru(n,o){const d=o?o.iu:new Cx,g=o?o.tu:this.tu;let w=o?o.mutatedKeys:this.mutatedKeys,x=g,c=!1;const R=this.query.limitType==="F"&&g.size===this.query.limit?g.last():null,B=this.query.limitType==="L"&&g.size===this.query.limit?g.first():null;if(n.inorderTraversal((W,ee)=>{const ce=g.get(W),Ie=Zf(this.query,ee)?ee:null,Ue=!!ce&&this.mutatedKeys.has(ce.key),ke=!!Ie&&(Ie.hasLocalMutations||this.mutatedKeys.has(Ie.key)&&Ie.hasCommittedMutations);let Q=!1;ce&&Ie?ce.data.isEqual(Ie.data)?Ue!==ke&&(d.track({type:3,doc:Ie}),Q=!0):this.su(ce,Ie)||(d.track({type:2,doc:Ie}),Q=!0,(R&&this.eu(Ie,R)>0||B&&this.eu(Ie,B)<0)&&(c=!0)):!ce&&Ie?(d.track({type:0,doc:Ie}),Q=!0):ce&&!Ie&&(d.track({type:1,doc:ce}),Q=!0,(R||B)&&(c=!0)),Q&&(Ie?(x=x.add(Ie),w=ke?w.add(W):w.delete(W)):(x=x.delete(W),w=w.delete(W)))}),this.query.limit!==null)for(;x.size>this.query.limit;){const W=this.query.limitType==="F"?x.last():x.first();x=x.delete(W.key),w=w.delete(W.key),d.track({type:1,doc:W})}return{tu:x,iu:d,Cs:c,mutatedKeys:w}}su(n,o){return n.hasLocalMutations&&o.hasCommittedMutations&&!o.hasLocalMutations}applyChanges(n,o,d,g){const w=this.tu;this.tu=n.tu,this.mutatedKeys=n.mutatedKeys;const x=n.iu.ya();x.sort((W,ee)=>function(Ie,Ue){const ke=Q=>{switch(Q){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return hn(20277,{Rt:Q})}};return ke(Ie)-ke(Ue)}(W.type,ee.type)||this.eu(W.doc,ee.doc)),this.ou(d),g=g??!1;const c=o&&!g?this._u():[],R=this.Xa.size===0&&this.current&&!g?1:0,B=R!==this.Za;return this.Za=R,x.length!==0||B?{snapshot:new Ou(this.query,n.tu,w,x,n.mutatedKeys,R===0,B,!1,!!d&&d.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(n){return this.current&&n==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Cx,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(n){return!this.Ya.has(n)&&!!this.tu.has(n)&&!this.tu.get(n).hasLocalMutations}ou(n){n&&(n.addedDocuments.forEach(o=>this.Ya=this.Ya.add(o)),n.modifiedDocuments.forEach(o=>{}),n.removedDocuments.forEach(o=>this.Ya=this.Ya.delete(o)),this.current=n.current)}_u(){if(!this.current)return[];const n=this.Xa;this.Xa=jn(),this.tu.forEach(d=>{this.uu(d.key)&&(this.Xa=this.Xa.add(d.key))});const o=[];return n.forEach(d=>{this.Xa.has(d)||o.push(new tw(d))}),this.Xa.forEach(d=>{n.has(d)||o.push(new ew(d))}),o}cu(n){this.Ya=n.Qs,this.Xa=jn();const o=this.ru(n.documents);return this.applyChanges(o,!0)}lu(){return Ou.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const K_="SyncEngine";class cM{constructor(n,o,d){this.query=n,this.targetId=o,this.view=d}}class uM{constructor(n){this.key=n,this.hu=!1}}class hM{constructor(n,o,d,g,w,x){this.localStore=n,this.remoteStore=o,this.eventManager=d,this.sharedClientState=g,this.currentUser=w,this.maxConcurrentLimboResolutions=x,this.Pu={},this.Tu=new yc(c=>v1(c),Hf),this.Iu=new Map,this.Eu=new Set,this.du=new Br(nn.comparator),this.Au=new Map,this.Ru=new N_,this.Vu={},this.mu=new Map,this.fu=Fu.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function dM(a,n,o=!0){const d=aw(a);let g;const w=d.Tu.get(n);return w?(d.sharedClientState.addLocalQueryTarget(w.targetId),g=w.view.lu()):g=await nw(d,n,o,!0),g}async function pM(a,n){const o=aw(a);await nw(o,n,!0,!1)}async function nw(a,n,o,d){const g=await MC(a.localStore,Oo(n)),w=g.targetId,x=a.sharedClientState.addLocalQueryTarget(w,o);let c;return d&&(c=await fM(a,n,w,x==="current",g.resumeToken)),a.isPrimaryClient&&o&&W1(a.remoteStore,g),c}async function fM(a,n,o,d,g){a.pu=(ee,ce,Ie)=>async function(ke,Q,qe,Ye){let Ge=Q.view.ru(qe);Ge.Cs&&(Ge=await Tx(ke.localStore,Q.query,!1).then(({documents:xe})=>Q.view.ru(xe,Ge)));const ht=Ye&&Ye.targetChanges.get(Q.targetId),ct=Ye&&Ye.targetMismatches.get(Q.targetId)!=null,ot=Q.view.applyChanges(Ge,ke.isPrimaryClient,ht,ct);return Dx(ke,Q.targetId,ot.au),ot.snapshot}(a,ee,ce,Ie);const w=await Tx(a.localStore,n,!0),x=new lM(n,w.Qs),c=x.ru(w.documents),R=bd.createSynthesizedTargetChangeForCurrentChange(o,d&&a.onlineState!=="Offline",g),B=x.applyChanges(c,a.isPrimaryClient,R);Dx(a,o,B.au);const W=new cM(n,o,x);return a.Tu.set(n,W),a.Iu.has(o)?a.Iu.get(o).push(n):a.Iu.set(o,[n]),B.snapshot}async function mM(a,n,o){const d=wn(a),g=d.Tu.get(n),w=d.Iu.get(g.targetId);if(w.length>1)return d.Iu.set(g.targetId,w.filter(x=>!Hf(x,n))),void d.Tu.delete(n);d.isPrimaryClient?(d.sharedClientState.removeLocalQueryTarget(g.targetId),d.sharedClientState.isActiveQueryTarget(g.targetId)||await o_(d.localStore,g.targetId,!1).then(()=>{d.sharedClientState.clearQueryState(g.targetId),o&&j_(d.remoteStore,g.targetId),c_(d,g.targetId)}).catch(Bu)):(c_(d,g.targetId),await o_(d.localStore,g.targetId,!0))}async function gM(a,n){const o=wn(a),d=o.Tu.get(n),g=o.Iu.get(d.targetId);o.isPrimaryClient&&g.length===1&&(o.sharedClientState.removeLocalQueryTarget(d.targetId),j_(o.remoteStore,d.targetId))}async function _M(a,n,o){const d=EM(a);try{const g=await function(x,c){const R=wn(x),B=Ar.now(),W=c.reduce((Ie,Ue)=>Ie.add(Ue.key),jn());let ee,ce;return R.persistence.runTransaction("Locally write mutations","readwrite",Ie=>{let Ue=Ea(),ke=jn();return R.Ns.getEntries(Ie,W).next(Q=>{Ue=Q,Ue.forEach((qe,Ye)=>{Ye.isValidDocument()||(ke=ke.add(qe))})}).next(()=>R.localDocuments.getOverlayedDocuments(Ie,Ue)).next(Q=>{ee=Q;const qe=[];for(const Ye of c){const Ge=CA(Ye,ee.get(Ye.key).overlayedDocument);Ge!=null&&qe.push(new vc(Ye.key,Ge,d1(Ge.value.mapValue),xa.exists(!0)))}return R.mutationQueue.addMutationBatch(Ie,B,qe,c)}).next(Q=>{ce=Q;const qe=Q.applyToLocalDocumentSet(ee,ke);return R.documentOverlayCache.saveOverlays(Ie,Q.batchId,qe)})}).then(()=>({batchId:ce.batchId,changes:w1(ee)}))}(d.localStore,n);d.sharedClientState.addPendingMutation(g.batchId),function(x,c,R){let B=x.Vu[x.currentUser.toKey()];B||(B=new Br(Un)),B=B.insert(c,R),x.Vu[x.currentUser.toKey()]=B}(d,g.batchId,o),await Td(d,g.changes),await Jf(d.remoteStore)}catch(g){const w=Z_(g,"Failed to persist write");o.reject(w)}}async function rw(a,n){const o=wn(a);try{const d=await PC(o.localStore,n);n.targetChanges.forEach((g,w)=>{const x=o.Au.get(w);x&&(sr(g.addedDocuments.size+g.modifiedDocuments.size+g.removedDocuments.size<=1,22616),g.addedDocuments.size>0?x.hu=!0:g.modifiedDocuments.size>0?sr(x.hu,14607):g.removedDocuments.size>0&&(sr(x.hu,42227),x.hu=!1))}),await Td(o,d,n)}catch(d){await Bu(d)}}function kx(a,n,o){const d=wn(a);if(d.isPrimaryClient&&o===0||!d.isPrimaryClient&&o===1){const g=[];d.Tu.forEach((w,x)=>{const c=x.view.va(n);c.snapshot&&g.push(c.snapshot)}),function(x,c){const R=wn(x);R.onlineState=c;let B=!1;R.queries.forEach((W,ee)=>{for(const ce of ee.Sa)ce.va(c)&&(B=!0)}),B&&W_(R)}(d.eventManager,n),g.length&&d.Pu.H_(g),d.onlineState=n,d.isPrimaryClient&&d.sharedClientState.setOnlineState(n)}}async function yM(a,n,o){const d=wn(a);d.sharedClientState.updateQueryState(n,"rejected",o);const g=d.Au.get(n),w=g&&g.key;if(w){let x=new Br(nn.comparator);x=x.insert(w,$i.newNoDocument(w,yn.min()));const c=jn().add(w),R=new Xf(yn.min(),new Map,new Br(Un),x,c);await rw(d,R),d.du=d.du.remove(w),d.Au.delete(n),X_(d)}else await o_(d.localStore,n,!1).then(()=>c_(d,n,o)).catch(Bu)}async function vM(a,n){const o=wn(a),d=n.batch.batchId;try{const g=await SC(o.localStore,n);sw(o,d,null),iw(o,d),o.sharedClientState.updateMutationState(d,"acknowledged"),await Td(o,g)}catch(g){await Bu(g)}}async function xM(a,n,o){const d=wn(a);try{const g=await function(x,c){const R=wn(x);return R.persistence.runTransaction("Reject batch","readwrite-primary",B=>{let W;return R.mutationQueue.lookupMutationBatch(B,c).next(ee=>(sr(ee!==null,37113),W=ee.keys(),R.mutationQueue.removeMutationBatch(B,ee))).next(()=>R.mutationQueue.performConsistencyCheck(B)).next(()=>R.documentOverlayCache.removeOverlaysForBatchId(B,W,c)).next(()=>R.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(B,W)).next(()=>R.localDocuments.getDocuments(B,W))})}(d.localStore,n);sw(d,n,o),iw(d,n),d.sharedClientState.updateMutationState(n,"rejected",o),await Td(d,g)}catch(g){await Bu(g)}}function iw(a,n){(a.mu.get(n)||[]).forEach(o=>{o.resolve()}),a.mu.delete(n)}function sw(a,n,o){const d=wn(a);let g=d.Vu[d.currentUser.toKey()];if(g){const w=g.get(n);w&&(o?w.reject(o):w.resolve(),g=g.remove(n)),d.Vu[d.currentUser.toKey()]=g}}function c_(a,n,o=null){a.sharedClientState.removeLocalQueryTarget(n);for(const d of a.Iu.get(n))a.Tu.delete(d),o&&a.Pu.yu(d,o);a.Iu.delete(n),a.isPrimaryClient&&a.Ru.jr(n).forEach(d=>{a.Ru.containsKey(d)||ow(a,d)})}function ow(a,n){a.Eu.delete(n.path.canonicalString());const o=a.du.get(n);o!==null&&(j_(a.remoteStore,o),a.du=a.du.remove(n),a.Au.delete(o),X_(a))}function Dx(a,n,o){for(const d of o)d instanceof ew?(a.Ru.addReference(d.key,n),bM(a,d)):d instanceof tw?(Dt(K_,"Document no longer in limbo: "+d.key),a.Ru.removeReference(d.key,n),a.Ru.containsKey(d.key)||ow(a,d.key)):hn(19791,{wu:d})}function bM(a,n){const o=n.key,d=o.path.canonicalString();a.du.get(o)||a.Eu.has(d)||(Dt(K_,"New document in limbo: "+o),a.Eu.add(d),X_(a))}function X_(a){for(;a.Eu.size>0&&a.du.size<a.maxConcurrentLimboResolutions;){const n=a.Eu.values().next().value;a.Eu.delete(n);const o=new nn(Vr.fromString(n)),d=a.fu.next();a.Au.set(d,new uM(o)),a.du=a.du.insert(o,d),W1(a.remoteStore,new il(Oo(D_(o.path)),d,"TargetPurposeLimboResolution",jf.ce))}}async function Td(a,n,o){const d=wn(a),g=[],w=[],x=[];d.Tu.isEmpty()||(d.Tu.forEach((c,R)=>{x.push(d.pu(R,n,o).then(B=>{var W;if((B||o)&&d.isPrimaryClient){const ee=B?!B.fromCache:(W=o==null?void 0:o.targetChanges.get(R.targetId))==null?void 0:W.current;d.sharedClientState.updateQueryState(R.targetId,ee?"current":"not-current")}if(B){g.push(B);const ee=B_.As(R.targetId,B);w.push(ee)}}))}),await Promise.all(x),d.Pu.H_(g),await async function(R,B){const W=wn(R);try{await W.persistence.runTransaction("notifyLocalViewChanges","readwrite",ee=>nt.forEach(B,ce=>nt.forEach(ce.Es,Ie=>W.persistence.referenceDelegate.addReference(ee,ce.targetId,Ie)).next(()=>nt.forEach(ce.ds,Ie=>W.persistence.referenceDelegate.removeReference(ee,ce.targetId,Ie)))))}catch(ee){if(!Uu(ee))throw ee;Dt(U_,"Failed to update sequence numbers: "+ee)}for(const ee of B){const ce=ee.targetId;if(!ee.fromCache){const Ie=W.Ms.get(ce),Ue=Ie.snapshotVersion,ke=Ie.withLastLimboFreeSnapshotVersion(Ue);W.Ms=W.Ms.insert(ce,ke)}}}(d.localStore,w))}async function wM(a,n){const o=wn(a);if(!o.currentUser.isEqual(n)){Dt(K_,"User change. New user:",n.toKey());const d=await $1(o.localStore,n);o.currentUser=n,function(w,x){w.mu.forEach(c=>{c.forEach(R=>{R.reject(new Zt(lt.CANCELLED,x))})}),w.mu.clear()}(o,"'waitForPendingWrites' promise is rejected due to a user change."),o.sharedClientState.handleUserChange(n,d.removedBatchIds,d.addedBatchIds),await Td(o,d.Ls)}}function TM(a,n){const o=wn(a),d=o.Au.get(n);if(d&&d.hu)return jn().add(d.key);{let g=jn();const w=o.Iu.get(n);if(!w)return g;for(const x of w){const c=o.Tu.get(x);g=g.unionWith(c.view.nu)}return g}}function aw(a){const n=wn(a);return n.remoteStore.remoteSyncer.applyRemoteEvent=rw.bind(null,n),n.remoteStore.remoteSyncer.getRemoteKeysForTarget=TM.bind(null,n),n.remoteStore.remoteSyncer.rejectListen=yM.bind(null,n),n.Pu.H_=sM.bind(null,n.eventManager),n.Pu.yu=oM.bind(null,n.eventManager),n}function EM(a){const n=wn(a);return n.remoteStore.remoteSyncer.applySuccessfulWrite=vM.bind(null,n),n.remoteStore.remoteSyncer.rejectFailedWrite=xM.bind(null,n),n}class Sf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(n){this.serializer=Yf(n.databaseInfo.databaseId),this.sharedClientState=this.Du(n),this.persistence=this.Cu(n),await this.persistence.start(),this.localStore=this.vu(n),this.gcScheduler=this.Fu(n,this.localStore),this.indexBackfillerScheduler=this.Mu(n,this.localStore)}Fu(n,o){return null}Mu(n,o){return null}vu(n){return IC(this.persistence,new wC,n.initialUser,this.serializer)}Cu(n){return new q1(V_.mi,this.serializer)}Du(n){return new kC}async terminate(){var n,o;(n=this.gcScheduler)==null||n.stop(),(o=this.indexBackfillerScheduler)==null||o.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Sf.provider={build:()=>new Sf};class IM extends Sf{constructor(n){super(),this.cacheSizeBytes=n}Fu(n,o){sr(this.persistence.referenceDelegate instanceof Ef,46915);const d=this.persistence.referenceDelegate.garbageCollector;return new aC(d,n.asyncQueue,o)}Cu(n){const o=this.cacheSizeBytes!==void 0?vs.withCacheSize(this.cacheSizeBytes):vs.DEFAULT;return new q1(d=>Ef.mi(d,o),this.serializer)}}class u_{async initialize(n,o){this.localStore||(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(o),this.remoteStore=this.createRemoteStore(o),this.eventManager=this.createEventManager(o),this.syncEngine=this.createSyncEngine(o,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=d=>kx(this.syncEngine,d,1),this.remoteStore.remoteSyncer.handleCredentialChange=wM.bind(null,this.syncEngine),await eM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(n){return function(){return new nM}()}createDatastore(n){const o=Yf(n.databaseInfo.databaseId),d=function(w){return new OC(w)}(n.databaseInfo);return function(w,x,c,R){return new UC(w,x,c,R)}(n.authCredentials,n.appCheckCredentials,d,o)}createRemoteStore(n){return function(d,g,w,x,c){return new qC(d,g,w,x,c)}(this.localStore,this.datastore,n.asyncQueue,o=>kx(this.syncEngine,o,0),function(){return Sx.v()?new Sx:new DC}())}createSyncEngine(n,o){return function(g,w,x,c,R,B,W){const ee=new hM(g,w,x,c,R,B);return W&&(ee.gu=!0),ee}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,n.initialUser,n.maxConcurrentLimboResolutions,o)}async terminate(){var n,o;await async function(g){const w=wn(g);Dt(dc,"RemoteStore shutting down."),w.Ea.add(5),await wd(w),w.Aa.shutdown(),w.Ra.set("Unknown")}(this.remoteStore),(n=this.datastore)==null||n.terminate(),(o=this.eventManager)==null||o.terminate()}}u_.provider={build:()=>new u_};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SM{constructor(n){this.observer=n,this.muted=!1}next(n){this.muted||this.observer.next&&this.Ou(this.observer.next,n)}error(n){this.muted||(this.observer.error?this.Ou(this.observer.error,n):Ta("Uncaught Error in snapshot listener:",n.toString()))}Nu(){this.muted=!0}Ou(n,o){setTimeout(()=>{this.muted||n(o)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ml="FirestoreClient";class PM{constructor(n,o,d,g,w){this.authCredentials=n,this.appCheckCredentials=o,this.asyncQueue=d,this.databaseInfo=g,this.user=qi.UNAUTHENTICATED,this.clientId=S_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=w,this.authCredentials.start(d,async x=>{Dt(ml,"Received user=",x.uid),await this.authCredentialListener(x),this.user=x}),this.appCheckCredentials.start(d,x=>(Dt(ml,"Received new app check token=",x),this.appCheckCredentialListener(x,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(n){this.authCredentialListener=n}setAppCheckTokenChangeListener(n){this.appCheckCredentialListener=n}terminate(){this.asyncQueue.enterRestrictedMode();const n=new ac;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(o){const d=Z_(o,"Failed to shutdown persistence");n.reject(d)}}),n.promise}}async function zg(a,n){a.asyncQueue.verifyOperationInProgress(),Dt(ml,"Initializing OfflineComponentProvider");const o=a.configuration;await n.initialize(o);let d=o.initialUser;a.setCredentialChangeListener(async g=>{d.isEqual(g)||(await $1(n.localStore,g),d=g)}),n.persistence.setDatabaseDeletedListener(()=>a.terminate()),a._offlineComponents=n}async function Lx(a,n){a.asyncQueue.verifyOperationInProgress();const o=await AM(a);Dt(ml,"Initializing OnlineComponentProvider"),await n.initialize(o,a.configuration),a.setCredentialChangeListener(d=>Ax(n.remoteStore,d)),a.setAppCheckTokenChangeListener((d,g)=>Ax(n.remoteStore,g)),a._onlineComponents=n}async function AM(a){if(!a._offlineComponents)if(a._uninitializedComponentsProvider){Dt(ml,"Using user provided OfflineComponentProvider");try{await zg(a,a._uninitializedComponentsProvider._offline)}catch(n){const o=n;if(!function(g){return g.name==="FirebaseError"?g.code===lt.FAILED_PRECONDITION||g.code===lt.UNIMPLEMENTED:!(typeof DOMException<"u"&&g instanceof DOMException)||g.code===22||g.code===20||g.code===11}(o))throw o;ku("Error using user provided cache. Falling back to memory cache: "+o),await zg(a,new Sf)}}else Dt(ml,"Using default OfflineComponentProvider"),await zg(a,new IM(void 0));return a._offlineComponents}async function lw(a){return a._onlineComponents||(a._uninitializedComponentsProvider?(Dt(ml,"Using user provided OnlineComponentProvider"),await Lx(a,a._uninitializedComponentsProvider._online)):(Dt(ml,"Using default OnlineComponentProvider"),await Lx(a,new u_))),a._onlineComponents}function CM(a){return lw(a).then(n=>n.syncEngine)}async function zx(a){const n=await lw(a),o=n.eventManager;return o.onListen=dM.bind(null,n.syncEngine),o.onUnlisten=mM.bind(null,n.syncEngine),o.onFirstRemoteStoreListen=pM.bind(null,n.syncEngine),o.onLastRemoteStoreUnlisten=gM.bind(null,n.syncEngine),o}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cw(a){const n={};return a.timeoutSeconds!==void 0&&(n.timeoutSeconds=a.timeoutSeconds),n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fx=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uw="firestore.googleapis.com",Ox=!0;class Nx{constructor(n){if(n.host===void 0){if(n.ssl!==void 0)throw new Zt(lt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=uw,this.ssl=Ox}else this.host=n.host,this.ssl=n.ssl??Ox;if(this.isUsingEmulator=n.emulatorOptions!==void 0,this.credentials=n.credentials,this.ignoreUndefinedProperties=!!n.ignoreUndefinedProperties,this.localCache=n.localCache,n.cacheSizeBytes===void 0)this.cacheSizeBytes=j1;else{if(n.cacheSizeBytes!==-1&&n.cacheSizeBytes<sC)throw new Zt(lt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=n.cacheSizeBytes}jP("experimentalForceLongPolling",n.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",n.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!n.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:n.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!n.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cw(n.experimentalLongPollingOptions??{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new Zt(lt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new Zt(lt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new Zt(lt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!n.useFetchStreams}isEqual(n){return this.host===n.host&&this.ssl===n.ssl&&this.credentials===n.credentials&&this.cacheSizeBytes===n.cacheSizeBytes&&this.experimentalForceLongPolling===n.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===n.experimentalAutoDetectLongPolling&&function(d,g){return d.timeoutSeconds===g.timeoutSeconds}(this.experimentalLongPollingOptions,n.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===n.ignoreUndefinedProperties&&this.useFetchStreams===n.useFetchStreams}}class Y_{constructor(n,o,d,g){this._authCredentials=n,this._appCheckCredentials=o,this._databaseId=d,this._app=g,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nx({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Zt(lt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(n){if(this._settingsFrozen)throw new Zt(lt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nx(n),this._emulatorOptions=n.emulatorOptions||{},n.credentials!==void 0&&(this._authCredentials=function(d){if(!d)return new RP;switch(d.type){case"firstParty":return new zP(d.sessionIndex||"0",d.iamToken||null,d.authTokenFactory||null);case"provider":return d.client;default:throw new Zt(lt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(n.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(o){const d=Fx.get(o);d&&(Dt("ComponentProvider","Removing Datastore"),Fx.delete(o),d.terminate())}(this),Promise.resolve()}}function MM(a,n,o,d={}){var B;a=Su(a,Y_);const g=mc(n),w=a._getSettings(),x={...w,emulatorOptions:a._getEmulatorOptions()},c=`${n}:${o}`;g&&(x_(`https://${c}`),b_("Firestore",!0)),w.host!==uw&&w.host!==c&&ku("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const R={...w,host:c,ssl:g,emulatorOptions:d};if(!cc(R,x)&&(a._setSettings(R),d.mockUserToken)){let W,ee;if(typeof d.mockUserToken=="string")W=d.mockUserToken,ee=qi.MOCK_USER;else{W=jb(d.mockUserToken,(B=a._app)==null?void 0:B.options.projectId);const ce=d.mockUserToken.sub||d.mockUserToken.user_id;if(!ce)throw new Zt(lt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");ee=new qi(ce)}a._authCredentials=new kP(new t1(W,ee))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em{constructor(n,o,d){this.converter=o,this._query=d,this.type="query",this.firestore=n}withConverter(n){return new em(this.firestore,n,this._query)}}class Ei{constructor(n,o,d){this.converter=o,this._key=d,this.type="document",this.firestore=n}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fd(this.firestore,this.converter,this._key.path.popLast())}withConverter(n){return new Ei(this.firestore,n,this._key)}toJSON(){return{type:Ei._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(n,o,d){if(vd(o,Ei._jsonSchema))return new Ei(n,d||null,new nn(Vr.fromString(o.referencePath)))}}Ei._jsonSchemaVersion="firestore/documentReference/1.0",Ei._jsonSchema={type:li("string",Ei._jsonSchemaVersion),referencePath:li("string")};class fd extends em{constructor(n,o,d){super(n,o,D_(d)),this._path=d,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const n=this._path.popLast();return n.isEmpty()?null:new Ei(this.firestore,null,new nn(n))}withConverter(n){return new fd(this.firestore,n,this._path)}}function hw(a,n,...o){if(a=Hi(a),arguments.length===1&&(n=S_.newId()),UP("doc","path",n),a instanceof Y_){const d=Vr.fromString(n,...o);return Y0(d),new Ei(a,null,new nn(d))}{if(!(a instanceof Ei||a instanceof fd))throw new Zt(lt.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const d=a._path.child(Vr.fromString(n,...o));return Y0(d),new Ei(a.firestore,a instanceof fd?a.converter:null,new nn(d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vx="AsyncQueue";class Bx{constructor(n=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new H1(this,"async_queue_retry"),this._c=()=>{const d=Lg();d&&Dt(Vx,"Visibility state changed to "+d.visibilityState),this.M_.w_()},this.ac=n;const o=Lg();o&&typeof o.addEventListener=="function"&&o.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(n){this.enqueue(n)}enqueueAndForgetEvenWhileRestricted(n){this.uc(),this.cc(n)}enterRestrictedMode(n){if(!this.ec){this.ec=!0,this.sc=n||!1;const o=Lg();o&&typeof o.removeEventListener=="function"&&o.removeEventListener("visibilitychange",this._c)}}enqueue(n){if(this.uc(),this.ec)return new Promise(()=>{});const o=new ac;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(n().then(o.resolve,o.reject),o.promise)).then(()=>o.promise)}enqueueRetryable(n){this.enqueueAndForget(()=>(this.Xu.push(n),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(n){if(!Uu(n))throw n;Dt(Vx,"Operation failed with retryable error: "+n)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(n){const o=this.ac.then(()=>(this.rc=!0,n().catch(d=>{throw this.nc=d,this.rc=!1,Ta("INTERNAL UNHANDLED ERROR: ",Ux(d)),d}).then(d=>(this.rc=!1,d))));return this.ac=o,o}enqueueAfterDelay(n,o,d){this.uc(),this.oc.indexOf(n)>-1&&(o=0);const g=H_.createAndSchedule(this,n,o,d,w=>this.hc(w));return this.tc.push(g),g}uc(){this.nc&&hn(47125,{Pc:Ux(this.nc)})}verifyOperationInProgress(){}async Tc(){let n;do n=this.ac,await n;while(n!==this.ac)}Ic(n){for(const o of this.tc)if(o.timerId===n)return!0;return!1}Ec(n){return this.Tc().then(()=>{this.tc.sort((o,d)=>o.targetTimeMs-d.targetTimeMs);for(const o of this.tc)if(o.skipDelay(),n!=="all"&&o.timerId===n)break;return this.Tc()})}dc(n){this.oc.push(n)}hc(n){const o=this.tc.indexOf(n);this.tc.splice(o,1)}}function Ux(a){let n=a.message||"";return a.stack&&(n=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx(a){return function(o,d){if(typeof o!="object"||o===null)return!1;const g=o;for(const w of d)if(w in g&&typeof g[w]=="function")return!0;return!1}(a,["next","error","complete"])}class Pf extends Y_{constructor(n,o,d,g){super(n,o,d,g),this.type="firestore",this._queue=new Bx,this._persistenceKey=(g==null?void 0:g.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const n=this._firestoreClient.terminate();this._queue=new Bx(n),this._firestoreClient=void 0,await n}}}function RM(a,n){const o=typeof a=="object"?a:E_(),d=typeof a=="string"?a:_f,g=Uf(o,"firestore").getImmediate({identifier:d});if(!g._initialized){const w=Vb("firestore");w&&MM(g,...w)}return g}function dw(a){if(a._terminated)throw new Zt(lt.FAILED_PRECONDITION,"The client has already been terminated.");return a._firestoreClient||kM(a),a._firestoreClient}function kM(a){var d,g,w;const n=a._freezeSettings(),o=function(c,R,B,W){return new JP(c,R,B,W.host,W.ssl,W.experimentalForceLongPolling,W.experimentalAutoDetectLongPolling,cw(W.experimentalLongPollingOptions),W.useFetchStreams,W.isUsingEmulator)}(a._databaseId,((d=a._app)==null?void 0:d.options.appId)||"",a._persistenceKey,n);a._componentsProvider||(g=n.localCache)!=null&&g._offlineComponentProvider&&((w=n.localCache)!=null&&w._onlineComponentProvider)&&(a._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),a._firestoreClient=new PM(a._authCredentials,a._appCheckCredentials,a._queue,o,a._componentsProvider&&function(c){const R=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(R),_online:R}}(a._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(n){this._byteString=n}static fromBase64String(n){try{return new Ys(Ri.fromBase64String(n))}catch(o){throw new Zt(lt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+o)}}static fromUint8Array(n){return new Ys(Ri.fromUint8Array(n))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(n){return this._byteString.isEqual(n._byteString)}toJSON(){return{type:Ys._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(n){if(vd(n,Ys._jsonSchema))return Ys.fromBase64String(n.bytes)}}Ys._jsonSchemaVersion="firestore/bytes/1.0",Ys._jsonSchema={type:li("string",Ys._jsonSchemaVersion),bytes:li("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q_{constructor(...n){for(let o=0;o<n.length;++o)if(n[o].length===0)throw new Zt(lt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ci(n)}isEqual(n){return this._internalPath.isEqual(n._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pw{constructor(n){this._methodName=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(n,o){if(!isFinite(n)||n<-90||n>90)throw new Zt(lt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+n);if(!isFinite(o)||o<-180||o>180)throw new Zt(lt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+o);this._lat=n,this._long=o}get latitude(){return this._lat}get longitude(){return this._long}isEqual(n){return this._lat===n._lat&&this._long===n._long}_compareTo(n){return Un(this._lat,n._lat)||Un(this._long,n._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Vo._jsonSchemaVersion}}static fromJSON(n){if(vd(n,Vo._jsonSchema))return new Vo(n.latitude,n.longitude)}}Vo._jsonSchemaVersion="firestore/geoPoint/1.0",Vo._jsonSchema={type:li("string",Vo._jsonSchemaVersion),latitude:li("number"),longitude:li("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(n){this._values=(n||[]).map(o=>o)}toArray(){return this._values.map(n=>n)}isEqual(n){return function(d,g){if(d.length!==g.length)return!1;for(let w=0;w<d.length;++w)if(d[w]!==g[w])return!1;return!0}(this._values,n._values)}toJSON(){return{type:Bo._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(n){if(vd(n,Bo._jsonSchema)){if(Array.isArray(n.vectorValues)&&n.vectorValues.every(o=>typeof o=="number"))return new Bo(n.vectorValues);throw new Zt(lt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Bo._jsonSchemaVersion="firestore/vectorValue/1.0",Bo._jsonSchema={type:li("string",Bo._jsonSchemaVersion),vectorValues:li("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DM=/^__.*__$/;class LM{constructor(n,o,d){this.data=n,this.fieldMask=o,this.fieldTransforms=d}toMutation(n,o){return this.fieldMask!==null?new vc(n,this.data,this.fieldMask,o,this.fieldTransforms):new xd(n,this.data,o,this.fieldTransforms)}}function fw(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw hn(40011,{Ac:a})}}class J_{constructor(n,o,d,g,w,x){this.settings=n,this.databaseId=o,this.serializer=d,this.ignoreUndefinedProperties=g,w===void 0&&this.Rc(),this.fieldTransforms=w||[],this.fieldMask=x||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(n){return new J_({...this.settings,...n},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(n){var g;const o=(g=this.path)==null?void 0:g.child(n),d=this.Vc({path:o,fc:!1});return d.gc(n),d}yc(n){var g;const o=(g=this.path)==null?void 0:g.child(n),d=this.Vc({path:o,fc:!1});return d.Rc(),d}wc(n){return this.Vc({path:void 0,fc:!0})}Sc(n){return Af(n,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(n){return this.fieldMask.find(o=>n.isPrefixOf(o))!==void 0||this.fieldTransforms.find(o=>n.isPrefixOf(o.field))!==void 0}Rc(){if(this.path)for(let n=0;n<this.path.length;n++)this.gc(this.path.get(n))}gc(n){if(n.length===0)throw this.Sc("Document fields must not be empty");if(fw(this.Ac)&&DM.test(n))throw this.Sc('Document fields cannot begin and end with "__"')}}class zM{constructor(n,o,d){this.databaseId=n,this.ignoreUndefinedProperties=o,this.serializer=d||Yf(n)}Cc(n,o,d,g=!1){return new J_({Ac:n,methodName:o,Dc:d,path:Ci.emptyPath(),fc:!1,bc:g},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function FM(a){const n=a._freezeSettings(),o=Yf(a._databaseId);return new zM(a._databaseId,!!n.ignoreUndefinedProperties,o)}function OM(a,n,o,d,g,w={}){const x=a.Cc(w.merge||w.mergeFields?2:0,n,o,g);yw("Data must be an object, but it was:",x,d);const c=gw(d,x);let R,B;if(w.merge)R=new po(x.fieldMask),B=x.fieldTransforms;else if(w.mergeFields){const W=[];for(const ee of w.mergeFields){const ce=NM(n,ee,o);if(!x.contains(ce))throw new Zt(lt.INVALID_ARGUMENT,`Field '${ce}' is specified in your field mask but missing from your input data.`);BM(W,ce)||W.push(ce)}R=new po(W),B=x.fieldTransforms.filter(ee=>R.covers(ee.field))}else R=null,B=x.fieldTransforms;return new LM(new Xs(c),R,B)}function mw(a,n){if(_w(a=Hi(a)))return yw("Unsupported field value:",n,a),gw(a,n);if(a instanceof pw)return function(d,g){if(!fw(g.Ac))throw g.Sc(`${d._methodName}() can only be used with update() and set()`);if(!g.path)throw g.Sc(`${d._methodName}() is not currently supported inside arrays`);const w=d._toFieldTransform(g);w&&g.fieldTransforms.push(w)}(a,n),null;if(a===void 0&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),a instanceof Array){if(n.settings.fc&&n.Ac!==4)throw n.Sc("Nested arrays are not supported");return function(d,g){const w=[];let x=0;for(const c of d){let R=mw(c,g.wc(x));R==null&&(R={nullValue:"NULL_VALUE"}),w.push(R),x++}return{arrayValue:{values:w}}}(a,n)}return function(d,g){if((d=Hi(d))===null)return{nullValue:"NULL_VALUE"};if(typeof d=="number")return TA(g.serializer,d);if(typeof d=="boolean")return{booleanValue:d};if(typeof d=="string")return{stringValue:d};if(d instanceof Date){const w=Ar.fromDate(d);return{timestampValue:Tf(g.serializer,w)}}if(d instanceof Ar){const w=new Ar(d.seconds,1e3*Math.floor(d.nanoseconds/1e3));return{timestampValue:Tf(g.serializer,w)}}if(d instanceof Vo)return{geoPointValue:{latitude:d.latitude,longitude:d.longitude}};if(d instanceof Ys)return{bytesValue:z1(g.serializer,d._byteString)};if(d instanceof Ei){const w=g.databaseId,x=d.firestore._databaseId;if(!x.isEqual(w))throw g.Sc(`Document reference is for database ${x.projectId}/${x.database} but should be for database ${w.projectId}/${w.database}`);return{referenceValue:O_(d.firestore._databaseId||g.databaseId,d._key.path)}}if(d instanceof Bo)return function(x,c){return{mapValue:{fields:{[u1]:{stringValue:h1},[yf]:{arrayValue:{values:x.toArray().map(B=>{if(typeof B!="number")throw c.Sc("VectorValues must only contain numeric values.");return L_(c.serializer,B)})}}}}}}(d,g);throw g.Sc(`Unsupported field value: ${P_(d)}`)}(a,n)}function gw(a,n){const o={};return i1(a)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):_c(a,(d,g)=>{const w=mw(g,n.mc(d));w!=null&&(o[d]=w)}),{mapValue:{fields:o}}}function _w(a){return!(typeof a!="object"||a===null||a instanceof Array||a instanceof Date||a instanceof Ar||a instanceof Vo||a instanceof Ys||a instanceof Ei||a instanceof pw||a instanceof Bo)}function yw(a,n,o){if(!_w(o)||!n1(o)){const d=P_(o);throw d==="an object"?n.Sc(a+" a custom object"):n.Sc(a+" "+d)}}function NM(a,n,o){if((n=Hi(n))instanceof Q_)return n._internalPath;if(typeof n=="string")return vw(a,n);throw Af("Field path arguments must be of type string or ",a,!1,void 0,o)}const VM=new RegExp("[~\\*/\\[\\]]");function vw(a,n,o){if(n.search(VM)>=0)throw Af(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,a,!1,void 0,o);try{return new Q_(...n.split("."))._internalPath}catch{throw Af(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,a,!1,void 0,o)}}function Af(a,n,o,d,g){const w=d&&!d.isEmpty(),x=g!==void 0;let c=`Function ${n}() called with invalid data`;o&&(c+=" (via `toFirestore()`)"),c+=". ";let R="";return(w||x)&&(R+=" (found",w&&(R+=` in field ${d}`),x&&(R+=` in document ${g}`),R+=")"),new Zt(lt.INVALID_ARGUMENT,c+a+R)}function BM(a,n){return a.some(o=>o.isEqual(n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xw{constructor(n,o,d,g,w){this._firestore=n,this._userDataWriter=o,this._key=d,this._document=g,this._converter=w}get id(){return this._key.path.lastSegment()}get ref(){return new Ei(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const n=new UM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(n)}return this._userDataWriter.convertValue(this._document.data.value)}}get(n){if(this._document){const o=this._document.data.field(bw("DocumentSnapshot.get",n));if(o!==null)return this._userDataWriter.convertValue(o)}}}class UM extends xw{data(){return super.data()}}function bw(a,n){return typeof n=="string"?vw(a,n):n instanceof Q_?n._internalPath:n._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jM(a){if(a.limitType==="L"&&a.explicitOrderBy.length===0)throw new Zt(lt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class qM{convertValue(n,o="none"){switch(pl(n)){case 0:return null;case 1:return n.booleanValue;case 2:return Wr(n.integerValue||n.doubleValue);case 3:return this.convertTimestamp(n.timestampValue);case 4:return this.convertServerTimestamp(n,o);case 5:return n.stringValue;case 6:return this.convertBytes(dl(n.bytesValue));case 7:return this.convertReference(n.referenceValue);case 8:return this.convertGeoPoint(n.geoPointValue);case 9:return this.convertArray(n.arrayValue,o);case 11:return this.convertObject(n.mapValue,o);case 10:return this.convertVectorValue(n.mapValue);default:throw hn(62114,{value:n})}}convertObject(n,o){return this.convertObjectMap(n.fields,o)}convertObjectMap(n,o="none"){const d={};return _c(n,(g,w)=>{d[g]=this.convertValue(w,o)}),d}convertVectorValue(n){var d,g,w;const o=(w=(g=(d=n.fields)==null?void 0:d[yf].arrayValue)==null?void 0:g.values)==null?void 0:w.map(x=>Wr(x.doubleValue));return new Bo(o)}convertGeoPoint(n){return new Vo(Wr(n.latitude),Wr(n.longitude))}convertArray(n,o){return(n.values||[]).map(d=>this.convertValue(d,o))}convertServerTimestamp(n,o){switch(o){case"previous":const d=$f(n);return d==null?null:this.convertValue(d,o);case"estimate":return this.convertTimestamp(cd(n));default:return null}}convertTimestamp(n){const o=hl(n);return new Ar(o.seconds,o.nanos)}convertDocumentKey(n,o){const d=Vr.fromString(n);sr(U1(d),9688,{name:n});const g=new ud(d.get(1),d.get(3)),w=new nn(d.popFirst(5));return g.isEqual(o)||Ta(`Document ${w} contains a document reference within a different database (${g.projectId}/${g.database}) which is not supported. It will be treated as a reference in the current database (${o.projectId}/${o.database}) instead.`),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $M(a,n,o){let d;return d=a?o&&(o.merge||o.mergeFields)?a.toFirestore(n,o):a.toFirestore(n):n,d}class Jh{constructor(n,o){this.hasPendingWrites=n,this.fromCache=o}isEqual(n){return this.hasPendingWrites===n.hasPendingWrites&&this.fromCache===n.fromCache}}class lc extends xw{constructor(n,o,d,g,w,x){super(n,o,d,g,x),this._firestore=n,this._firestoreImpl=n,this.metadata=w}exists(){return super.exists()}data(n={}){if(this._document){if(this._converter){const o=new af(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(o,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}}get(n,o={}){if(this._document){const d=this._document.data.field(bw("DocumentSnapshot.get",n));if(d!==null)return this._userDataWriter.convertValue(d,o.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Zt(lt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const n=this._document,o={};return o.type=lc._jsonSchemaVersion,o.bundle="",o.bundleSource="DocumentSnapshot",o.bundleName=this._key.toString(),!n||!n.isValidDocument()||!n.isFoundDocument()?o:(this._userDataWriter.convertObjectMap(n.data.value.mapValue.fields,"previous"),o.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),o)}}lc._jsonSchemaVersion="firestore/documentSnapshot/1.0",lc._jsonSchema={type:li("string",lc._jsonSchemaVersion),bundleSource:li("string","DocumentSnapshot"),bundleName:li("string"),bundle:li("string")};class af extends lc{data(n={}){return super.data(n)}}class Au{constructor(n,o,d,g){this._firestore=n,this._userDataWriter=o,this._snapshot=g,this.metadata=new Jh(g.hasPendingWrites,g.fromCache),this.query=d}get docs(){const n=[];return this.forEach(o=>n.push(o)),n}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(n,o){this._snapshot.docs.forEach(d=>{n.call(o,new af(this._firestore,this._userDataWriter,d.key,d,new Jh(this._snapshot.mutatedKeys.has(d.key),this._snapshot.fromCache),this.query.converter))})}docChanges(n={}){const o=!!n.includeMetadataChanges;if(o&&this._snapshot.excludesMetadataChanges)throw new Zt(lt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===o||(this._cachedChanges=function(g,w){if(g._snapshot.oldDocs.isEmpty()){let x=0;return g._snapshot.docChanges.map(c=>{const R=new af(g._firestore,g._userDataWriter,c.doc.key,c.doc,new Jh(g._snapshot.mutatedKeys.has(c.doc.key),g._snapshot.fromCache),g.query.converter);return c.doc,{type:"added",doc:R,oldIndex:-1,newIndex:x++}})}{let x=g._snapshot.oldDocs;return g._snapshot.docChanges.filter(c=>w||c.type!==3).map(c=>{const R=new af(g._firestore,g._userDataWriter,c.doc.key,c.doc,new Jh(g._snapshot.mutatedKeys.has(c.doc.key),g._snapshot.fromCache),g.query.converter);let B=-1,W=-1;return c.type!==0&&(B=x.indexOf(c.doc.key),x=x.delete(c.doc.key)),c.type!==1&&(x=x.add(c.doc),W=x.indexOf(c.doc.key)),{type:GM(c.type),doc:R,oldIndex:B,newIndex:W}})}}(this,o),this._cachedChangesIncludeMetadataChanges=o),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Zt(lt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const n={};n.type=Au._jsonSchemaVersion,n.bundleSource="QuerySnapshot",n.bundleName=S_.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const o=[],d=[],g=[];return this.docs.forEach(w=>{w._document!==null&&(o.push(w._document),d.push(this._userDataWriter.convertObjectMap(w._document.data.value.mapValue.fields,"previous")),g.push(w.ref.path))}),n.bundle=(this._firestore,this.query._query,n.bundleName,"NOT SUPPORTED"),n}}function GM(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return hn(61501,{type:a})}}Au._jsonSchemaVersion="firestore/querySnapshot/1.0",Au._jsonSchema={type:li("string",Au._jsonSchemaVersion),bundleSource:li("string","QuerySnapshot"),bundleName:li("string"),bundle:li("string")};class ww extends qM{constructor(n){super(),this.firestore=n}convertBytes(n){return new Ys(n)}convertReference(n){const o=this.convertDocumentKey(n,this.firestore._databaseId);return new Ei(this.firestore,null,o)}}function HM(a,n,o){a=Su(a,Ei);const d=Su(a.firestore,Pf),g=$M(a.converter,n,o);return WM(d,[OM(FM(d),"setDoc",a._key,g,a.converter!==null,o).toMutation(a._key,xa.none())])}function ZM(a,...n){var R,B,W;a=Hi(a);let o={includeMetadataChanges:!1,source:"default"},d=0;typeof n[d]!="object"||jx(n[d])||(o=n[d++]);const g={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(jx(n[d])){const ee=n[d];n[d]=(R=ee.next)==null?void 0:R.bind(ee),n[d+1]=(B=ee.error)==null?void 0:B.bind(ee),n[d+2]=(W=ee.complete)==null?void 0:W.bind(ee)}let w,x,c;if(a instanceof Ei)x=Su(a.firestore,Pf),c=D_(a._key.path),w={next:ee=>{n[d]&&n[d](KM(x,a,ee))},error:n[d+1],complete:n[d+2]};else{const ee=Su(a,em);x=Su(ee.firestore,Pf),c=ee._query;const ce=new ww(x);w={next:Ie=>{n[d]&&n[d](new Au(x,ce,ee,Ie))},error:n[d+1],complete:n[d+2]},jM(a._query)}return function(ce,Ie,Ue,ke){const Q=new SM(ke),qe=new aM(Ie,Q,Ue);return ce.asyncQueue.enqueueAndForget(async()=>rM(await zx(ce),qe)),()=>{Q.Nu(),ce.asyncQueue.enqueueAndForget(async()=>iM(await zx(ce),qe))}}(dw(x),c,g,w)}function WM(a,n){return function(d,g){const w=new ac;return d.asyncQueue.enqueueAndForget(async()=>_M(await CM(d),g,w)),w.promise}(dw(a),n)}function KM(a,n,o){const d=o.docs.get(n._key),g=new ww(a);return new lc(a,g,n._key,d,new Jh(o.hasPendingWrites,o.fromCache),n.converter)}(function(n,o=!0){(function(g){Vu=g})(gc),uc(new cl("firestore",(d,{instanceIdentifier:g,options:w})=>{const x=d.getProvider("app").getImmediate(),c=new Pf(new DP(d.getProvider("auth-internal")),new FP(x,d.getProvider("app-check-internal")),function(B,W){if(!Object.prototype.hasOwnProperty.apply(B.options,["projectId"]))throw new Zt(lt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ud(B.options.projectId,W)}(x,g),x);return w={useFetchStreams:o,...w},c._setSettings(w),c},"PUBLIC").setMultipleInstances(!0)),Fo(Z0,W0,n),Fo(Z0,W0,"esm2020")})();var XM="firebase",YM="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Fo(XM,YM,"app");function Tw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const QM=Tw,Ew=new _d("auth","Firebase",Tw());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cf=new w_("@firebase/auth");function JM(a,...n){Cf.logLevel<=Bn.WARN&&Cf.warn(`Auth (${gc}): ${a}`,...n)}function lf(a,...n){Cf.logLevel<=Bn.ERROR&&Cf.error(`Auth (${gc}): ${a}`,...n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qs(a,...n){throw ty(a,...n)}function go(a,...n){return ty(a,...n)}function ey(a,n,o){const d={...QM(),[n]:o};return new _d("auth","Firebase",d).create(n,{appName:a.name})}function ba(a){return ey(a,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function eR(a,n,o){const d=o;if(!(n instanceof d))throw d.name!==n.constructor.name&&Qs(a,"argument-error"),ey(a,"argument-error",`Type of ${n.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ty(a,...n){if(typeof a!="string"){const o=n[0],d=[...n.slice(1)];return d[0]&&(d[0].appName=a.name),a._errorFactory.create(o,...d)}return Ew.create(a,...n)}function un(a,n,...o){if(!a)throw ty(n,...o)}function ya(a){const n="INTERNAL ASSERTION FAILED: "+a;throw lf(n),new Error(n)}function Ia(a,n){a||ya(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h_(){var a;return typeof self<"u"&&((a=self.location)==null?void 0:a.href)||""}function tR(){return qx()==="http:"||qx()==="https:"}function qx(){var a;return typeof self<"u"&&((a=self.location)==null?void 0:a.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nR(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(tR()||uS()||"connection"in navigator)?navigator.onLine:!0}function rR(){if(typeof navigator>"u")return null;const a=navigator;return a.languages&&a.languages[0]||a.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(n,o){this.shortDelay=n,this.longDelay=o,Ia(o>n,"Short delay should be less than long delay!"),this.isMobile=aS()||hS()}get(){return nR()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ny(a,n){Ia(a.emulator,"Emulator should always be set here");const{url:o}=a.emulator;return n?`${o}${n.startsWith("/")?n.slice(1):n}`:o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iw{static initialize(n,o,d){this.fetchImpl=n,o&&(this.headersImpl=o),d&&(this.responseImpl=d)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ya("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ya("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ya("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sR=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],oR=new Ed(3e4,6e4);function Sa(a,n){return a.tenantId&&!n.tenantId?{...n,tenantId:a.tenantId}:n}async function Ho(a,n,o,d,g={}){return Sw(a,g,async()=>{let w={},x={};d&&(n==="GET"?x=d:w={body:JSON.stringify(d)});const c=yd({key:a.config.apiKey,...x}).slice(1),R=await a._getAdditionalHeaders();R["Content-Type"]="application/json",a.languageCode&&(R["X-Firebase-Locale"]=a.languageCode);const B={method:n,headers:R,...w};return cS()||(B.referrerPolicy="no-referrer"),a.emulatorConfig&&mc(a.emulatorConfig.host)&&(B.credentials="include"),Iw.fetch()(await Pw(a,a.config.apiHost,o,c),B)})}async function Sw(a,n,o){a._canInitEmulator=!1;const d={...iR,...n};try{const g=new lR(a),w=await Promise.race([o(),g.promise]);g.clearNetworkTimeout();const x=await w.json();if("needConfirmation"in x)throw Xp(a,"account-exists-with-different-credential",x);if(w.ok&&!("errorMessage"in x))return x;{const c=w.ok?x.errorMessage:x.error.message,[R,B]=c.split(" : ");if(R==="FEDERATED_USER_ID_ALREADY_LINKED")throw Xp(a,"credential-already-in-use",x);if(R==="EMAIL_EXISTS")throw Xp(a,"email-already-in-use",x);if(R==="USER_DISABLED")throw Xp(a,"user-disabled",x);const W=d[R]||R.toLowerCase().replace(/[_\s]+/g,"-");if(B)throw ey(a,W,B);Qs(a,W)}}catch(g){if(g instanceof Go)throw g;Qs(a,"network-request-failed",{message:String(g)})}}async function Id(a,n,o,d,g={}){const w=await Ho(a,n,o,d,g);return"mfaPendingCredential"in w&&Qs(a,"multi-factor-auth-required",{_serverResponse:w}),w}async function Pw(a,n,o,d){const g=`${n}${o}?${d}`,w=a,x=w.config.emulator?ny(a.config,g):`${a.config.apiScheme}://${g}`;return sR.includes(o)&&(await w._persistenceManagerAvailable,w._getPersistenceType()==="COOKIE")?w._getPersistence()._getFinalTarget(x).toString():x}function aR(a){switch(a){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class lR{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(n){this.auth=n,this.timer=null,this.promise=new Promise((o,d)=>{this.timer=setTimeout(()=>d(go(this.auth,"network-request-failed")),oR.get())})}}function Xp(a,n,o){const d={appName:a.name};o.email&&(d.email=o.email),o.phoneNumber&&(d.phoneNumber=o.phoneNumber);const g=go(a,n,d);return g.customData._tokenResponse=o,g}function $x(a){return a!==void 0&&a.enterprise!==void 0}class cR{constructor(n){if(this.siteKey="",this.recaptchaEnforcementState=[],n.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=n.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=n.recaptchaEnforcementState}getProviderEnforcementState(n){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const o of this.recaptchaEnforcementState)if(o.provider&&o.provider===n)return aR(o.enforcementState);return null}isProviderEnabled(n){return this.getProviderEnforcementState(n)==="ENFORCE"||this.getProviderEnforcementState(n)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function uR(a,n){return Ho(a,"GET","/v2/recaptchaConfig",Sa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hR(a,n){return Ho(a,"POST","/v1/accounts:delete",n)}async function Mf(a,n){return Ho(a,"POST","/v1/accounts:lookup",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sd(a){if(a)try{const n=new Date(Number(a));if(!isNaN(n.getTime()))return n.toUTCString()}catch{}}async function dR(a,n=!1){const o=Hi(a),d=await o.getIdToken(n),g=ry(d);un(g&&g.exp&&g.auth_time&&g.iat,o.auth,"internal-error");const w=typeof g.firebase=="object"?g.firebase:void 0,x=w==null?void 0:w.sign_in_provider;return{claims:g,token:d,authTime:sd(Fg(g.auth_time)),issuedAtTime:sd(Fg(g.iat)),expirationTime:sd(Fg(g.exp)),signInProvider:x||null,signInSecondFactor:(w==null?void 0:w.sign_in_second_factor)||null}}function Fg(a){return Number(a)*1e3}function ry(a){const[n,o,d]=a.split(".");if(n===void 0||o===void 0||d===void 0)return lf("JWT malformed, contained fewer than 3 sections"),null;try{const g=Ob(o);return g?JSON.parse(g):(lf("Failed to decode base64 JWT payload"),null)}catch(g){return lf("Caught error parsing JWT payload as JSON",g==null?void 0:g.toString()),null}}function Gx(a){const n=ry(a);return un(n,"internal-error"),un(typeof n.exp<"u","internal-error"),un(typeof n.iat<"u","internal-error"),Number(n.exp)-Number(n.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nu(a,n,o=!1){if(o)return n;try{return await n}catch(d){throw d instanceof Go&&pR(d)&&a.auth.currentUser===a&&await a.auth.signOut(),d}}function pR({code:a}){return a==="auth/user-disabled"||a==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR{constructor(n){this.user=n,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(n){if(n){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const d=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,d)}}schedule(n=!1){if(!this.isRunning)return;const o=this.getInterval(n);this.timerId=setTimeout(async()=>{await this.iteration()},o)}async iteration(){try{await this.user.getIdToken(!0)}catch(n){(n==null?void 0:n.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(n,o){this.createdAt=n,this.lastLoginAt=o,this._initializeTime()}_initializeTime(){this.lastSignInTime=sd(this.lastLoginAt),this.creationTime=sd(this.createdAt)}_copy(n){this.createdAt=n.createdAt,this.lastLoginAt=n.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rf(a){var ee;const n=a.auth,o=await a.getIdToken(),d=await Nu(a,Mf(n,{idToken:o}));un(d==null?void 0:d.users.length,n,"internal-error");const g=d.users[0];a._notifyReloadListener(g);const w=(ee=g.providerUserInfo)!=null&&ee.length?Aw(g.providerUserInfo):[],x=gR(a.providerData,w),c=a.isAnonymous,R=!(a.email&&g.passwordHash)&&!(x!=null&&x.length),B=c?R:!1,W={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:x,metadata:new d_(g.createdAt,g.lastLoginAt),isAnonymous:B};Object.assign(a,W)}async function mR(a){const n=Hi(a);await Rf(n),await n.auth._persistUserIfCurrent(n),n.auth._notifyListenersIfCurrent(n)}function gR(a,n){return[...a.filter(d=>!n.some(g=>g.providerId===d.providerId)),...n]}function Aw(a){return a.map(({providerId:n,...o})=>({providerId:n,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _R(a,n){const o=await Sw(a,{},async()=>{const d=yd({grant_type:"refresh_token",refresh_token:n}).slice(1),{tokenApiHost:g,apiKey:w}=a.config,x=await Pw(a,g,"/v1/token",`key=${w}`),c=await a._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const R={method:"POST",headers:c,body:d};return a.emulatorConfig&&mc(a.emulatorConfig.host)&&(R.credentials="include"),Iw.fetch()(x,R)});return{accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token}}async function yR(a,n){return Ho(a,"POST","/v2/accounts:revokeToken",Sa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(n){un(n.idToken,"internal-error"),un(typeof n.idToken<"u","internal-error"),un(typeof n.refreshToken<"u","internal-error");const o="expiresIn"in n&&typeof n.expiresIn<"u"?Number(n.expiresIn):Gx(n.idToken);this.updateTokensAndExpiration(n.idToken,n.refreshToken,o)}updateFromIdToken(n){un(n.length!==0,"internal-error");const o=Gx(n);this.updateTokensAndExpiration(n,null,o)}async getToken(n,o=!1){return!o&&this.accessToken&&!this.isExpired?this.accessToken:(un(this.refreshToken,n,"user-token-expired"),this.refreshToken?(await this.refresh(n,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(n,o){const{accessToken:d,refreshToken:g,expiresIn:w}=await _R(n,o);this.updateTokensAndExpiration(d,g,Number(w))}updateTokensAndExpiration(n,o,d){this.refreshToken=o||null,this.accessToken=n||null,this.expirationTime=Date.now()+d*1e3}static fromJSON(n,o){const{refreshToken:d,accessToken:g,expirationTime:w}=o,x=new Cu;return d&&(un(typeof d=="string","internal-error",{appName:n}),x.refreshToken=d),g&&(un(typeof g=="string","internal-error",{appName:n}),x.accessToken=g),w&&(un(typeof w=="number","internal-error",{appName:n}),x.expirationTime=w),x}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(n){this.accessToken=n.accessToken,this.refreshToken=n.refreshToken,this.expirationTime=n.expirationTime}_clone(){return Object.assign(new Cu,this.toJSON())}_performRefresh(){return ya("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ka(a,n){un(typeof a=="string"||typeof a>"u","internal-error",{appName:n})}class fo{constructor({uid:n,auth:o,stsTokenManager:d,...g}){this.providerId="firebase",this.proactiveRefresh=new fR(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=o,this.stsTokenManager=d,this.accessToken=d.accessToken,this.displayName=g.displayName||null,this.email=g.email||null,this.emailVerified=g.emailVerified||!1,this.phoneNumber=g.phoneNumber||null,this.photoURL=g.photoURL||null,this.isAnonymous=g.isAnonymous||!1,this.tenantId=g.tenantId||null,this.providerData=g.providerData?[...g.providerData]:[],this.metadata=new d_(g.createdAt||void 0,g.lastLoginAt||void 0)}async getIdToken(n){const o=await Nu(this,this.stsTokenManager.getToken(this.auth,n));return un(o,this.auth,"internal-error"),this.accessToken!==o&&(this.accessToken=o,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),o}getIdTokenResult(n){return dR(this,n)}reload(){return mR(this)}_assign(n){this!==n&&(un(this.uid===n.uid,this.auth,"internal-error"),this.displayName=n.displayName,this.photoURL=n.photoURL,this.email=n.email,this.emailVerified=n.emailVerified,this.phoneNumber=n.phoneNumber,this.isAnonymous=n.isAnonymous,this.tenantId=n.tenantId,this.providerData=n.providerData.map(o=>({...o})),this.metadata._copy(n.metadata),this.stsTokenManager._assign(n.stsTokenManager))}_clone(n){const o=new fo({...this,auth:n,stsTokenManager:this.stsTokenManager._clone()});return o.metadata._copy(this.metadata),o}_onReload(n){un(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=n,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(n){this.reloadListener?this.reloadListener(n):this.reloadUserInfo=n}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(n,o=!1){let d=!1;n.idToken&&n.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(n),d=!0),o&&await Rf(this),await this.auth._persistUserIfCurrent(this),d&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(xs(this.auth.app))return Promise.reject(ba(this.auth));const n=await this.getIdToken();return await Nu(this,hR(this.auth,{idToken:n})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(n=>({...n})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(n,o){const d=o.displayName??void 0,g=o.email??void 0,w=o.phoneNumber??void 0,x=o.photoURL??void 0,c=o.tenantId??void 0,R=o._redirectEventId??void 0,B=o.createdAt??void 0,W=o.lastLoginAt??void 0,{uid:ee,emailVerified:ce,isAnonymous:Ie,providerData:Ue,stsTokenManager:ke}=o;un(ee&&ke,n,"internal-error");const Q=Cu.fromJSON(this.name,ke);un(typeof ee=="string",n,"internal-error"),Ka(d,n.name),Ka(g,n.name),un(typeof ce=="boolean",n,"internal-error"),un(typeof Ie=="boolean",n,"internal-error"),Ka(w,n.name),Ka(x,n.name),Ka(c,n.name),Ka(R,n.name),Ka(B,n.name),Ka(W,n.name);const qe=new fo({uid:ee,auth:n,email:g,emailVerified:ce,displayName:d,isAnonymous:Ie,photoURL:x,phoneNumber:w,tenantId:c,stsTokenManager:Q,createdAt:B,lastLoginAt:W});return Ue&&Array.isArray(Ue)&&(qe.providerData=Ue.map(Ye=>({...Ye}))),R&&(qe._redirectEventId=R),qe}static async _fromIdTokenResponse(n,o,d=!1){const g=new Cu;g.updateFromServerResponse(o);const w=new fo({uid:o.localId,auth:n,stsTokenManager:g,isAnonymous:d});return await Rf(w),w}static async _fromGetAccountInfoResponse(n,o,d){const g=o.users[0];un(g.localId!==void 0,"internal-error");const w=g.providerUserInfo!==void 0?Aw(g.providerUserInfo):[],x=!(g.email&&g.passwordHash)&&!(w!=null&&w.length),c=new Cu;c.updateFromIdToken(d);const R=new fo({uid:g.localId,auth:n,stsTokenManager:c,isAnonymous:x}),B={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:w,metadata:new d_(g.createdAt,g.lastLoginAt),isAnonymous:!(g.email&&g.passwordHash)&&!(w!=null&&w.length)};return Object.assign(R,B),R}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hx=new Map;function va(a){Ia(a instanceof Function,"Expected a class definition");let n=Hx.get(a);return n?(Ia(n instanceof a,"Instance stored in cache mismatched with class"),n):(n=new a,Hx.set(a,n),n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(n,o){this.storage[n]=o}async _get(n){const o=this.storage[n];return o===void 0?null:o}async _remove(n){delete this.storage[n]}_addListener(n,o){}_removeListener(n,o){}}Cw.type="NONE";const Zx=Cw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cf(a,n,o){return`firebase:${a}:${n}:${o}`}class Mu{constructor(n,o,d){this.persistence=n,this.auth=o,this.userKey=d;const{config:g,name:w}=this.auth;this.fullUserKey=cf(this.userKey,g.apiKey,w),this.fullPersistenceKey=cf("persistence",g.apiKey,w),this.boundEventHandler=o._onStorageEvent.bind(o),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(n){return this.persistence._set(this.fullUserKey,n.toJSON())}async getCurrentUser(){const n=await this.persistence._get(this.fullUserKey);if(!n)return null;if(typeof n=="string"){const o=await Mf(this.auth,{idToken:n}).catch(()=>{});return o?fo._fromGetAccountInfoResponse(this.auth,o,n):null}return fo._fromJSON(this.auth,n)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(n){if(this.persistence===n)return;const o=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=n,o)return this.setCurrentUser(o)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(n,o,d="authUser"){if(!o.length)return new Mu(va(Zx),n,d);const g=(await Promise.all(o.map(async B=>{if(await B._isAvailable())return B}))).filter(B=>B);let w=g[0]||va(Zx);const x=cf(d,n.config.apiKey,n.name);let c=null;for(const B of o)try{const W=await B._get(x);if(W){let ee;if(typeof W=="string"){const ce=await Mf(n,{idToken:W}).catch(()=>{});if(!ce)break;ee=await fo._fromGetAccountInfoResponse(n,ce,W)}else ee=fo._fromJSON(n,W);B!==w&&(c=ee),w=B;break}}catch{}const R=g.filter(B=>B._shouldAllowMigration);return!w._shouldAllowMigration||!R.length?new Mu(w,n,d):(w=R[0],c&&await w._set(x,c.toJSON()),await Promise.all(o.map(async B=>{if(B!==w)try{await B._remove(x)}catch{}})),new Mu(w,n,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wx(a){const n=a.toLowerCase();if(n.includes("opera/")||n.includes("opr/")||n.includes("opios/"))return"Opera";if(Dw(n))return"IEMobile";if(n.includes("msie")||n.includes("trident/"))return"IE";if(n.includes("edge/"))return"Edge";if(Mw(n))return"Firefox";if(n.includes("silk/"))return"Silk";if(zw(n))return"Blackberry";if(Fw(n))return"Webos";if(Rw(n))return"Safari";if((n.includes("chrome/")||kw(n))&&!n.includes("edge/"))return"Chrome";if(Lw(n))return"Android";{const o=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,d=a.match(o);if((d==null?void 0:d.length)===2)return d[1]}return"Other"}function Mw(a=Gi()){return/firefox\//i.test(a)}function Rw(a=Gi()){const n=a.toLowerCase();return n.includes("safari/")&&!n.includes("chrome/")&&!n.includes("crios/")&&!n.includes("android")}function kw(a=Gi()){return/crios\//i.test(a)}function Dw(a=Gi()){return/iemobile/i.test(a)}function Lw(a=Gi()){return/android/i.test(a)}function zw(a=Gi()){return/blackberry/i.test(a)}function Fw(a=Gi()){return/webos/i.test(a)}function iy(a=Gi()){return/iphone|ipad|ipod/i.test(a)||/macintosh/i.test(a)&&/mobile/i.test(a)}function vR(a=Gi()){var n;return iy(a)&&!!((n=window.navigator)!=null&&n.standalone)}function xR(){return dS()&&document.documentMode===10}function Ow(a=Gi()){return iy(a)||Lw(a)||Fw(a)||zw(a)||/windows phone/i.test(a)||Dw(a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nw(a,n=[]){let o;switch(a){case"Browser":o=Wx(Gi());break;case"Worker":o=`${Wx(Gi())}-${a}`;break;default:o=a}const d=n.length?n.join(","):"FirebaseCore-web";return`${o}/JsCore/${gc}/${d}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR{constructor(n){this.auth=n,this.queue=[]}pushCallback(n,o){const d=w=>new Promise((x,c)=>{try{const R=n(w);x(R)}catch(R){c(R)}});d.onAbort=o,this.queue.push(d);const g=this.queue.length-1;return()=>{this.queue[g]=()=>Promise.resolve()}}async runMiddleware(n){if(this.auth.currentUser===n)return;const o=[];try{for(const d of this.queue)await d(n),d.onAbort&&o.push(d.onAbort)}catch(d){o.reverse();for(const g of o)try{g()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:d==null?void 0:d.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wR(a,n={}){return Ho(a,"GET","/v2/passwordPolicy",Sa(a,n))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TR=6;class ER{constructor(n){var d;const o=n.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=o.minPasswordLength??TR,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=n.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((d=n.allowedNonAlphanumericCharacters)==null?void 0:d.join(""))??"",this.forceUpgradeOnSignin=n.forceUpgradeOnSignin??!1,this.schemaVersion=n.schemaVersion}validatePassword(n){const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(n,o),this.validatePasswordCharacterOptions(n,o),o.isValid&&(o.isValid=o.meetsMinPasswordLength??!0),o.isValid&&(o.isValid=o.meetsMaxPasswordLength??!0),o.isValid&&(o.isValid=o.containsLowercaseLetter??!0),o.isValid&&(o.isValid=o.containsUppercaseLetter??!0),o.isValid&&(o.isValid=o.containsNumericCharacter??!0),o.isValid&&(o.isValid=o.containsNonAlphanumericCharacter??!0),o}validatePasswordLengthOptions(n,o){const d=this.customStrengthOptions.minPasswordLength,g=this.customStrengthOptions.maxPasswordLength;d&&(o.meetsMinPasswordLength=n.length>=d),g&&(o.meetsMaxPasswordLength=n.length<=g)}validatePasswordCharacterOptions(n,o){this.updatePasswordCharacterOptionsStatuses(o,!1,!1,!1,!1);let d;for(let g=0;g<n.length;g++)d=n.charAt(g),this.updatePasswordCharacterOptionsStatuses(o,d>="a"&&d<="z",d>="A"&&d<="Z",d>="0"&&d<="9",this.allowedNonAlphanumericCharacters.includes(d))}updatePasswordCharacterOptionsStatuses(n,o,d,g,w){this.customStrengthOptions.containsLowercaseLetter&&(n.containsLowercaseLetter||(n.containsLowercaseLetter=o)),this.customStrengthOptions.containsUppercaseLetter&&(n.containsUppercaseLetter||(n.containsUppercaseLetter=d)),this.customStrengthOptions.containsNumericCharacter&&(n.containsNumericCharacter||(n.containsNumericCharacter=g)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(n.containsNonAlphanumericCharacter||(n.containsNonAlphanumericCharacter=w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(n,o,d,g){this.app=n,this.heartbeatServiceProvider=o,this.appCheckServiceProvider=d,this.config=g,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Kx(this),this.idTokenSubscription=new Kx(this),this.beforeStateQueue=new bR(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ew,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=n.name,this.clientVersion=g.sdkClientVersion,this._persistenceManagerAvailable=new Promise(w=>this._resolvePersistenceManagerAvailable=w)}_initializeWithPersistence(n,o){return o&&(this._popupRedirectResolver=va(o)),this._initializationPromise=this.queue(async()=>{var d,g,w;if(!this._deleted&&(this.persistenceManager=await Mu.create(this,n),(d=this._resolvePersistenceManagerAvailable)==null||d.call(this),!this._deleted)){if((g=this._popupRedirectResolver)!=null&&g._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(o),this.lastNotifiedUid=((w=this.currentUser)==null?void 0:w.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const n=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!n)){if(this.currentUser&&n&&this.currentUser.uid===n.uid){this._currentUser._assign(n),await this.currentUser.getIdToken();return}await this._updateCurrentUser(n,!0)}}async initializeCurrentUserFromIdToken(n){try{const o=await Mf(this,{idToken:n}),d=await fo._fromGetAccountInfoResponse(this,o,n);await this.directlySetCurrentUser(d)}catch(o){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",o),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(n){var w;if(xs(this.app)){const x=this.app.settings.authIdToken;return x?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(x).then(c,c))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let d=o,g=!1;if(n&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const x=(w=this.redirectUser)==null?void 0:w._redirectEventId,c=d==null?void 0:d._redirectEventId,R=await this.tryRedirectSignIn(n);(!x||x===c)&&(R!=null&&R.user)&&(d=R.user,g=!0)}if(!d)return this.directlySetCurrentUser(null);if(!d._redirectEventId){if(g)try{await this.beforeStateQueue.runMiddleware(d)}catch(x){d=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(x))}return d?this.reloadAndSetCurrentUserOrClear(d):this.directlySetCurrentUser(null)}return un(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===d._redirectEventId?this.directlySetCurrentUser(d):this.reloadAndSetCurrentUserOrClear(d)}async tryRedirectSignIn(n){let o=null;try{o=await this._popupRedirectResolver._completeRedirectFn(this,n,!0)}catch{await this._setRedirectUser(null)}return o}async reloadAndSetCurrentUserOrClear(n){try{await Rf(n)}catch(o){if((o==null?void 0:o.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(n)}useDeviceLanguage(){this.languageCode=rR()}async _delete(){this._deleted=!0}async updateCurrentUser(n){if(xs(this.app))return Promise.reject(ba(this));const o=n?Hi(n):null;return o&&un(o.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(o&&o._clone(this))}async _updateCurrentUser(n,o=!1){if(!this._deleted)return n&&un(this.tenantId===n.tenantId,this,"tenant-id-mismatch"),o||await this.beforeStateQueue.runMiddleware(n),this.queue(async()=>{await this.directlySetCurrentUser(n),this.notifyAuthListeners()})}async signOut(){return xs(this.app)?Promise.reject(ba(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(n){return xs(this.app)?Promise.reject(ba(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(va(n))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(n){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const o=this._getPasswordPolicyInternal();return o.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):o.validatePassword(n)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const n=await wR(this),o=new ER(n);this.tenantId===null?this._projectPasswordPolicy=o:this._tenantPasswordPolicies[this.tenantId]=o}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(n){this._errorFactory=new _d("auth","Firebase",n())}onAuthStateChanged(n,o,d){return this.registerStateListener(this.authStateSubscription,n,o,d)}beforeAuthStateChanged(n,o){return this.beforeStateQueue.pushCallback(n,o)}onIdTokenChanged(n,o,d){return this.registerStateListener(this.idTokenSubscription,n,o,d)}authStateReady(){return new Promise((n,o)=>{if(this.currentUser)n();else{const d=this.onAuthStateChanged(()=>{d(),n()},o)}})}async revokeAccessToken(n){if(this.currentUser){const o=await this.currentUser.getIdToken(),d={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:n,idToken:o};this.tenantId!=null&&(d.tenantId=this.tenantId),await yR(this,d)}}toJSON(){var n;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(n=this._currentUser)==null?void 0:n.toJSON()}}async _setRedirectUser(n,o){const d=await this.getOrInitRedirectPersistenceManager(o);return n===null?d.removeCurrentUser():d.setCurrentUser(n)}async getOrInitRedirectPersistenceManager(n){if(!this.redirectPersistenceManager){const o=n&&va(n)||this._popupRedirectResolver;un(o,this,"argument-error"),this.redirectPersistenceManager=await Mu.create(this,[va(o._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(n){var o,d;return this._isInitialized&&await this.queue(async()=>{}),((o=this._currentUser)==null?void 0:o._redirectEventId)===n?this._currentUser:((d=this.redirectUser)==null?void 0:d._redirectEventId)===n?this.redirectUser:null}async _persistUserIfCurrent(n){if(n===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(n))}_notifyListenersIfCurrent(n){n===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=((o=this.currentUser)==null?void 0:o.uid)??null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(n,o,d,g){if(this._deleted)return()=>{};const w=typeof o=="function"?o:o.next.bind(o);let x=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(un(c,this,"internal-error"),c.then(()=>{x||w(this.currentUser)}),typeof o=="function"){const R=n.addObserver(o,d,g);return()=>{x=!0,R()}}else{const R=n.addObserver(o);return()=>{x=!0,R()}}}async directlySetCurrentUser(n){this.currentUser&&this.currentUser!==n&&this._currentUser._stopProactiveRefresh(),n&&this.isProactiveRefreshEnabled&&n._startProactiveRefresh(),this.currentUser=n,n?await this.assertedPersistence.setCurrentUser(n):await this.assertedPersistence.removeCurrentUser()}queue(n){return this.operations=this.operations.then(n,n),this.operations}get assertedPersistence(){return un(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(n){!n||this.frameworks.includes(n)||(this.frameworks.push(n),this.frameworks.sort(),this.clientVersion=Nw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var g;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const o=await((g=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:g.getHeartbeatsHeader());o&&(n["X-Firebase-Client"]=o);const d=await this._getAppCheckToken();return d&&(n["X-Firebase-AppCheck"]=d),n}async _getAppCheckToken(){var o;if(xs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((o=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:o.getToken());return n!=null&&n.error&&JM(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Pa(a){return Hi(a)}class Kx{constructor(n){this.auth=n,this.observer=null,this.addObserver=xS(o=>this.observer=o)}get next(){return un(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tm={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function SR(a){tm=a}function Vw(a){return tm.loadJS(a)}function PR(){return tm.recaptchaEnterpriseScript}function AR(){return tm.gapiScript}function CR(a){return`__${a}${Math.floor(Math.random()*1e6)}`}class MR{constructor(){this.enterprise=new RR}ready(n){n()}execute(n,o){return Promise.resolve("token")}render(n,o){return""}}class RR{ready(n){n()}execute(n,o){return Promise.resolve("token")}render(n,o){return""}}const kR="recaptcha-enterprise",Bw="NO_RECAPTCHA";class DR{constructor(n){this.type=kR,this.auth=Pa(n)}async verify(n="verify",o=!1){async function d(w){if(!o){if(w.tenantId==null&&w._agentRecaptchaConfig!=null)return w._agentRecaptchaConfig.siteKey;if(w.tenantId!=null&&w._tenantRecaptchaConfigs[w.tenantId]!==void 0)return w._tenantRecaptchaConfigs[w.tenantId].siteKey}return new Promise(async(x,c)=>{uR(w,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(R=>{if(R.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const B=new cR(R);return w.tenantId==null?w._agentRecaptchaConfig=B:w._tenantRecaptchaConfigs[w.tenantId]=B,x(B.siteKey)}}).catch(R=>{c(R)})})}function g(w,x,c){const R=window.grecaptcha;$x(R)?R.enterprise.ready(()=>{R.enterprise.execute(w,{action:n}).then(B=>{x(B)}).catch(()=>{x(Bw)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new MR().execute("siteKey",{action:"verify"}):new Promise((w,x)=>{d(this.auth).then(c=>{if(!o&&$x(window.grecaptcha))g(c,w,x);else{if(typeof window>"u"){x(new Error("RecaptchaVerifier is only supported in browser"));return}let R=PR();R.length!==0&&(R+=c),Vw(R).then(()=>{g(c,w,x)}).catch(B=>{x(B)})}}).catch(c=>{x(c)})})}}async function Xx(a,n,o,d=!1,g=!1){const w=new DR(a);let x;if(g)x=Bw;else try{x=await w.verify(o)}catch{x=await w.verify(o,!0)}const c={...n};if(o==="mfaSmsEnrollment"||o==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const R=c.phoneEnrollmentInfo.phoneNumber,B=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:R,recaptchaToken:B,captchaResponse:x,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const R=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:R,captchaResponse:x,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return d?Object.assign(c,{captchaResp:x}):Object.assign(c,{captchaResponse:x}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function kf(a,n,o,d,g){var w;if((w=a._getRecaptchaConfig())!=null&&w.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const x=await Xx(a,n,o,o==="getOobCode");return d(a,x)}else return d(a,n).catch(async x=>{if(x.code==="auth/missing-recaptcha-token"){console.log(`${o} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await Xx(a,n,o,o==="getOobCode");return d(a,c)}else return Promise.reject(x)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LR(a,n){const o=Uf(a,"auth");if(o.isInitialized()){const g=o.getImmediate(),w=o.getOptions();if(cc(w,n??{}))return g;Qs(g,"already-initialized")}return o.initialize({options:n})}function zR(a,n){const o=(n==null?void 0:n.persistence)||[],d=(Array.isArray(o)?o:[o]).map(va);n!=null&&n.errorMap&&a._updateErrorMap(n.errorMap),a._initializeWithPersistence(d,n==null?void 0:n.popupRedirectResolver)}function FR(a,n,o){const d=Pa(a);un(/^https?:\/\//.test(n),d,"invalid-emulator-scheme");const g=!1,w=Uw(n),{host:x,port:c}=OR(n),R=c===null?"":`:${c}`,B={url:`${w}//${x}${R}/`},W=Object.freeze({host:x,port:c,protocol:w.replace(":",""),options:Object.freeze({disableWarnings:g})});if(!d._canInitEmulator){un(d.config.emulator&&d.emulatorConfig,d,"emulator-config-failed"),un(cc(B,d.config.emulator)&&cc(W,d.emulatorConfig),d,"emulator-config-failed");return}d.config.emulator=B,d.emulatorConfig=W,d.settings.appVerificationDisabledForTesting=!0,mc(x)?(x_(`${w}//${x}${R}`),b_("Auth",!0)):NR()}function Uw(a){const n=a.indexOf(":");return n<0?"":a.substr(0,n+1)}function OR(a){const n=Uw(a),o=/(\/\/)?([^?#/]+)/.exec(a.substr(n.length));if(!o)return{host:"",port:null};const d=o[2].split("@").pop()||"",g=/^(\[[^\]]+\])(:|$)/.exec(d);if(g){const w=g[1];return{host:w,port:Yx(d.substr(w.length+1))}}else{const[w,x]=d.split(":");return{host:w,port:Yx(x)}}}function Yx(a){if(!a)return null;const n=Number(a);return isNaN(n)?null:n}function NR(){function a(){const n=document.createElement("p"),o=n.style;n.innerText="Running in emulator mode. Do not use with production credentials.",o.position="fixed",o.width="100%",o.backgroundColor="#ffffff",o.border=".1em solid #000000",o.color="#b50000",o.bottom="0px",o.left="0px",o.margin="0px",o.zIndex="10000",o.textAlign="center",n.classList.add("firebase-emulator-warning"),document.body.appendChild(n)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",a):a())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(n,o){this.providerId=n,this.signInMethod=o}toJSON(){return ya("not implemented")}_getIdTokenResponse(n){return ya("not implemented")}_linkToIdToken(n,o){return ya("not implemented")}_getReauthenticationResolver(n){return ya("not implemented")}}async function VR(a,n){return Ho(a,"POST","/v1/accounts:signUp",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BR(a,n){return Id(a,"POST","/v1/accounts:signInWithPassword",Sa(a,n))}async function UR(a,n){return Ho(a,"POST","/v1/accounts:sendOobCode",Sa(a,n))}async function jR(a,n){return UR(a,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qR(a,n){return Id(a,"POST","/v1/accounts:signInWithEmailLink",Sa(a,n))}async function $R(a,n){return Id(a,"POST","/v1/accounts:signInWithEmailLink",Sa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md extends sy{constructor(n,o,d,g=null){super("password",d),this._email=n,this._password=o,this._tenantId=g}static _fromEmailAndPassword(n,o){return new md(n,o,"password")}static _fromEmailAndCode(n,o,d=null){return new md(n,o,"emailLink",d)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(n){const o=typeof n=="string"?JSON.parse(n):n;if(o!=null&&o.email&&(o!=null&&o.password)){if(o.signInMethod==="password")return this._fromEmailAndPassword(o.email,o.password);if(o.signInMethod==="emailLink")return this._fromEmailAndCode(o.email,o.password,o.tenantId)}return null}async _getIdTokenResponse(n){switch(this.signInMethod){case"password":const o={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return kf(n,o,"signInWithPassword",BR);case"emailLink":return qR(n,{email:this._email,oobCode:this._password});default:Qs(n,"internal-error")}}async _linkToIdToken(n,o){switch(this.signInMethod){case"password":const d={idToken:o,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return kf(n,d,"signUpPassword",VR);case"emailLink":return $R(n,{idToken:o,email:this._email,oobCode:this._password});default:Qs(n,"internal-error")}}_getReauthenticationResolver(n){return this._getIdTokenResponse(n)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ru(a,n){return Id(a,"POST","/v1/accounts:signInWithIdp",Sa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GR="http://localhost";class pc extends sy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(n){const o=new pc(n.providerId,n.signInMethod);return n.idToken||n.accessToken?(n.idToken&&(o.idToken=n.idToken),n.accessToken&&(o.accessToken=n.accessToken),n.nonce&&!n.pendingToken&&(o.nonce=n.nonce),n.pendingToken&&(o.pendingToken=n.pendingToken)):n.oauthToken&&n.oauthTokenSecret?(o.accessToken=n.oauthToken,o.secret=n.oauthTokenSecret):Qs("argument-error"),o}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(n){const o=typeof n=="string"?JSON.parse(n):n,{providerId:d,signInMethod:g,...w}=o;if(!d||!g)return null;const x=new pc(d,g);return x.idToken=w.idToken||void 0,x.accessToken=w.accessToken||void 0,x.secret=w.secret,x.nonce=w.nonce,x.pendingToken=w.pendingToken||null,x}_getIdTokenResponse(n){const o=this.buildRequest();return Ru(n,o)}_linkToIdToken(n,o){const d=this.buildRequest();return d.idToken=o,Ru(n,d)}_getReauthenticationResolver(n){const o=this.buildRequest();return o.autoCreate=!1,Ru(n,o)}buildRequest(){const n={requestUri:GR,returnSecureToken:!0};if(this.pendingToken)n.pendingToken=this.pendingToken;else{const o={};this.idToken&&(o.id_token=this.idToken),this.accessToken&&(o.access_token=this.accessToken),this.secret&&(o.oauth_token_secret=this.secret),o.providerId=this.providerId,this.nonce&&!this.pendingToken&&(o.nonce=this.nonce),n.postBody=yd(o)}return n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HR(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function ZR(a){const n=Wh(Kh(a)).link,o=n?Wh(Kh(n)).deep_link_id:null,d=Wh(Kh(a)).deep_link_id;return(d?Wh(Kh(d)).link:null)||d||o||n||a}class oy{constructor(n){const o=Wh(Kh(n)),d=o.apiKey??null,g=o.oobCode??null,w=HR(o.mode??null);un(d&&g&&w,"argument-error"),this.apiKey=d,this.operation=w,this.code=g,this.continueUrl=o.continueUrl??null,this.languageCode=o.lang??null,this.tenantId=o.tenantId??null}static parseLink(n){const o=ZR(n);try{return new oy(o)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(){this.providerId=qu.PROVIDER_ID}static credential(n,o){return md._fromEmailAndPassword(n,o)}static credentialWithLink(n,o){const d=oy.parseLink(o);return un(d,"argument-error"),md._fromEmailAndCode(n,d.code,d.tenantId)}}qu.PROVIDER_ID="password";qu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";qu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(n){this.providerId=n,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(n){this.defaultLanguageCode=n}setCustomParameters(n){return this.customParameters=n,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sd extends ay{constructor(){super(...arguments),this.scopes=[]}addScope(n){return this.scopes.includes(n)||this.scopes.push(n),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el extends Sd{constructor(){super("facebook.com")}static credential(n){return pc._fromParams({providerId:el.PROVIDER_ID,signInMethod:el.FACEBOOK_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return el.credentialFromTaggedObject(n)}static credentialFromError(n){return el.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return el.credential(n.oauthAccessToken)}catch{return null}}}el.FACEBOOK_SIGN_IN_METHOD="facebook.com";el.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga extends Sd{constructor(){super("google.com"),this.addScope("profile")}static credential(n,o){return pc._fromParams({providerId:ga.PROVIDER_ID,signInMethod:ga.GOOGLE_SIGN_IN_METHOD,idToken:n,accessToken:o})}static credentialFromResult(n){return ga.credentialFromTaggedObject(n)}static credentialFromError(n){return ga.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthIdToken:o,oauthAccessToken:d}=n;if(!o&&!d)return null;try{return ga.credential(o,d)}catch{return null}}}ga.GOOGLE_SIGN_IN_METHOD="google.com";ga.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl extends Sd{constructor(){super("github.com")}static credential(n){return pc._fromParams({providerId:tl.PROVIDER_ID,signInMethod:tl.GITHUB_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return tl.credentialFromTaggedObject(n)}static credentialFromError(n){return tl.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return tl.credential(n.oauthAccessToken)}catch{return null}}}tl.GITHUB_SIGN_IN_METHOD="github.com";tl.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl extends Sd{constructor(){super("twitter.com")}static credential(n,o){return pc._fromParams({providerId:nl.PROVIDER_ID,signInMethod:nl.TWITTER_SIGN_IN_METHOD,oauthToken:n,oauthTokenSecret:o})}static credentialFromResult(n){return nl.credentialFromTaggedObject(n)}static credentialFromError(n){return nl.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthAccessToken:o,oauthTokenSecret:d}=n;if(!o||!d)return null;try{return nl.credential(o,d)}catch{return null}}}nl.TWITTER_SIGN_IN_METHOD="twitter.com";nl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WR(a,n){return Id(a,"POST","/v1/accounts:signUp",Sa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc{constructor(n){this.user=n.user,this.providerId=n.providerId,this._tokenResponse=n._tokenResponse,this.operationType=n.operationType}static async _fromIdTokenResponse(n,o,d,g=!1){const w=await fo._fromIdTokenResponse(n,d,g),x=Qx(d);return new fc({user:w,providerId:x,_tokenResponse:d,operationType:o})}static async _forOperation(n,o,d){await n._updateTokensIfNecessary(d,!0);const g=Qx(d);return new fc({user:n,providerId:g,_tokenResponse:d,operationType:o})}}function Qx(a){return a.providerId?a.providerId:"phoneNumber"in a?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Df extends Go{constructor(n,o,d,g){super(o.code,o.message),this.operationType=d,this.user=g,Object.setPrototypeOf(this,Df.prototype),this.customData={appName:n.name,tenantId:n.tenantId??void 0,_serverResponse:o.customData._serverResponse,operationType:d}}static _fromErrorAndOperation(n,o,d,g){return new Df(n,o,d,g)}}function jw(a,n,o,d){return(n==="reauthenticate"?o._getReauthenticationResolver(a):o._getIdTokenResponse(a)).catch(w=>{throw w.code==="auth/multi-factor-auth-required"?Df._fromErrorAndOperation(a,w,n,d):w})}async function KR(a,n,o=!1){const d=await Nu(a,n._linkToIdToken(a.auth,await a.getIdToken()),o);return fc._forOperation(a,"link",d)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XR(a,n,o=!1){const{auth:d}=a;if(xs(d.app))return Promise.reject(ba(d));const g="reauthenticate";try{const w=await Nu(a,jw(d,g,n,a),o);un(w.idToken,d,"internal-error");const x=ry(w.idToken);un(x,d,"internal-error");const{sub:c}=x;return un(a.uid===c,d,"user-mismatch"),fc._forOperation(a,g,w)}catch(w){throw(w==null?void 0:w.code)==="auth/user-not-found"&&Qs(d,"user-mismatch"),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qw(a,n,o=!1){if(xs(a.app))return Promise.reject(ba(a));const d="signIn",g=await jw(a,d,n),w=await fc._fromIdTokenResponse(a,d,g);return o||await a._updateCurrentUser(w.user),w}async function YR(a,n){return qw(Pa(a),n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $w(a){const n=Pa(a);n._getPasswordPolicyInternal()&&await n._updatePasswordPolicy()}async function QR(a,n,o){const d=Pa(a);await kf(d,{requestType:"PASSWORD_RESET",email:n,clientType:"CLIENT_TYPE_WEB"},"getOobCode",jR)}async function JR(a,n,o){if(xs(a.app))return Promise.reject(ba(a));const d=Pa(a),x=await kf(d,{returnSecureToken:!0,email:n,password:o,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",WR).catch(R=>{throw R.code==="auth/password-does-not-meet-requirements"&&$w(a),R}),c=await fc._fromIdTokenResponse(d,"signIn",x);return await d._updateCurrentUser(c.user),c}function ek(a,n,o){return xs(a.app)?Promise.reject(ba(a)):YR(Hi(a),qu.credential(n,o)).catch(async d=>{throw d.code==="auth/password-does-not-meet-requirements"&&$w(a),d})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tk(a,n){return Ho(a,"POST","/v1/accounts:update",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nk(a,{displayName:n,photoURL:o}){if(n===void 0&&o===void 0)return;const d=Hi(a),w={idToken:await d.getIdToken(),displayName:n,photoUrl:o,returnSecureToken:!0},x=await Nu(d,tk(d.auth,w));d.displayName=x.displayName||null,d.photoURL=x.photoUrl||null;const c=d.providerData.find(({providerId:R})=>R==="password");c&&(c.displayName=d.displayName,c.photoURL=d.photoURL),await d._updateTokensIfNecessary(x)}function rk(a,n,o,d){return Hi(a).onIdTokenChanged(n,o,d)}function ik(a,n,o){return Hi(a).beforeAuthStateChanged(n,o)}function sk(a,n,o,d){return Hi(a).onAuthStateChanged(n,o,d)}function ok(a){return Hi(a).signOut()}const Lf="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(n,o){this.storageRetriever=n,this.type=o}_isAvailable(){try{return this.storage?(this.storage.setItem(Lf,"1"),this.storage.removeItem(Lf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(n,o){return this.storage.setItem(n,JSON.stringify(o)),Promise.resolve()}_get(n){const o=this.storage.getItem(n);return Promise.resolve(o?JSON.parse(o):null)}_remove(n){return this.storage.removeItem(n),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ak=1e3,lk=10;class Hw extends Gw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(n,o)=>this.onStorageEvent(n,o),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ow(),this._shouldAllowMigration=!0}forAllChangedKeys(n){for(const o of Object.keys(this.listeners)){const d=this.storage.getItem(o),g=this.localCache[o];d!==g&&n(o,g,d)}}onStorageEvent(n,o=!1){if(!n.key){this.forAllChangedKeys((x,c,R)=>{this.notifyListeners(x,R)});return}const d=n.key;o?this.detachListener():this.stopPolling();const g=()=>{const x=this.storage.getItem(d);!o&&this.localCache[d]===x||this.notifyListeners(d,x)},w=this.storage.getItem(d);xR()&&w!==n.newValue&&n.newValue!==n.oldValue?setTimeout(g,lk):g()}notifyListeners(n,o){this.localCache[n]=o;const d=this.listeners[n];if(d)for(const g of Array.from(d))g(o&&JSON.parse(o))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((n,o,d)=>{this.onStorageEvent(new StorageEvent("storage",{key:n,oldValue:o,newValue:d}),!0)})},ak)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(n,o){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[n]||(this.listeners[n]=new Set,this.localCache[n]=this.storage.getItem(n)),this.listeners[n].add(o)}_removeListener(n,o){this.listeners[n]&&(this.listeners[n].delete(o),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(n,o){await super._set(n,o),this.localCache[n]=JSON.stringify(o)}async _get(n){const o=await super._get(n);return this.localCache[n]=JSON.stringify(o),o}async _remove(n){await super._remove(n),delete this.localCache[n]}}Hw.type="LOCAL";const ck=Hw;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw extends Gw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(n,o){}_removeListener(n,o){}}Zw.type="SESSION";const Ww=Zw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uk(a){return Promise.all(a.map(async n=>{try{return{fulfilled:!0,value:await n}}catch(o){return{fulfilled:!1,reason:o}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(n){this.eventTarget=n,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(n){const o=this.receivers.find(g=>g.isListeningto(n));if(o)return o;const d=new nm(n);return this.receivers.push(d),d}isListeningto(n){return this.eventTarget===n}async handleEvent(n){const o=n,{eventId:d,eventType:g,data:w}=o.data,x=this.handlersMap[g];if(!(x!=null&&x.size))return;o.ports[0].postMessage({status:"ack",eventId:d,eventType:g});const c=Array.from(x).map(async B=>B(o.origin,w)),R=await uk(c);o.ports[0].postMessage({status:"done",eventId:d,eventType:g,response:R})}_subscribe(n,o){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[n]||(this.handlersMap[n]=new Set),this.handlersMap[n].add(o)}_unsubscribe(n,o){this.handlersMap[n]&&o&&this.handlersMap[n].delete(o),(!o||this.handlersMap[n].size===0)&&delete this.handlersMap[n],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}nm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ly(a="",n=10){let o="";for(let d=0;d<n;d++)o+=Math.floor(Math.random()*10);return a+o}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(n){this.target=n,this.handlers=new Set}removeMessageHandler(n){n.messageChannel&&(n.messageChannel.port1.removeEventListener("message",n.onMessage),n.messageChannel.port1.close()),this.handlers.delete(n)}async _send(n,o,d=50){const g=typeof MessageChannel<"u"?new MessageChannel:null;if(!g)throw new Error("connection_unavailable");let w,x;return new Promise((c,R)=>{const B=ly("",20);g.port1.start();const W=setTimeout(()=>{R(new Error("unsupported_event"))},d);x={messageChannel:g,onMessage(ee){const ce=ee;if(ce.data.eventId===B)switch(ce.data.status){case"ack":clearTimeout(W),w=setTimeout(()=>{R(new Error("timeout"))},3e3);break;case"done":clearTimeout(w),c(ce.data.response);break;default:clearTimeout(W),clearTimeout(w),R(new Error("invalid_response"));break}}},this.handlers.add(x),g.port1.addEventListener("message",x.onMessage),this.target.postMessage({eventType:n,eventId:B,data:o},[g.port2])}).finally(()=>{x&&this.removeMessageHandler(x)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uo(){return window}function dk(a){Uo().location.href=a}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kw(){return typeof Uo().WorkerGlobalScope<"u"&&typeof Uo().importScripts=="function"}async function pk(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function fk(){var a;return((a=navigator==null?void 0:navigator.serviceWorker)==null?void 0:a.controller)||null}function mk(){return Kw()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xw="firebaseLocalStorageDb",gk=1,zf="firebaseLocalStorage",Yw="fbase_key";class Pd{constructor(n){this.request=n}toPromise(){return new Promise((n,o)=>{this.request.addEventListener("success",()=>{n(this.request.result)}),this.request.addEventListener("error",()=>{o(this.request.error)})})}}function rm(a,n){return a.transaction([zf],n?"readwrite":"readonly").objectStore(zf)}function _k(){const a=indexedDB.deleteDatabase(Xw);return new Pd(a).toPromise()}function p_(){const a=indexedDB.open(Xw,gk);return new Promise((n,o)=>{a.addEventListener("error",()=>{o(a.error)}),a.addEventListener("upgradeneeded",()=>{const d=a.result;try{d.createObjectStore(zf,{keyPath:Yw})}catch(g){o(g)}}),a.addEventListener("success",async()=>{const d=a.result;d.objectStoreNames.contains(zf)?n(d):(d.close(),await _k(),n(await p_()))})})}async function Jx(a,n,o){const d=rm(a,!0).put({[Yw]:n,value:o});return new Pd(d).toPromise()}async function yk(a,n){const o=rm(a,!1).get(n),d=await new Pd(o).toPromise();return d===void 0?null:d.value}function eb(a,n){const o=rm(a,!0).delete(n);return new Pd(o).toPromise()}const vk=800,xk=3;class Qw{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await p_(),this.db)}async _withRetries(n){let o=0;for(;;)try{const d=await this._openDb();return await n(d)}catch(d){if(o++>xk)throw d;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Kw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nm._getInstance(mk()),this.receiver._subscribe("keyChanged",async(n,o)=>({keyProcessed:(await this._poll()).includes(o.key)})),this.receiver._subscribe("ping",async(n,o)=>["keyChanged"])}async initializeSender(){var o,d;if(this.activeServiceWorker=await pk(),!this.activeServiceWorker)return;this.sender=new hk(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(o=n[0])!=null&&o.fulfilled&&(d=n[0])!=null&&d.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(n){if(!(!this.sender||!this.activeServiceWorker||fk()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:n},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const n=await p_();return await Jx(n,Lf,"1"),await eb(n,Lf),!0}catch{}return!1}async _withPendingWrite(n){this.pendingWrites++;try{await n()}finally{this.pendingWrites--}}async _set(n,o){return this._withPendingWrite(async()=>(await this._withRetries(d=>Jx(d,n,o)),this.localCache[n]=o,this.notifyServiceWorker(n)))}async _get(n){const o=await this._withRetries(d=>yk(d,n));return this.localCache[n]=o,o}async _remove(n){return this._withPendingWrite(async()=>(await this._withRetries(o=>eb(o,n)),delete this.localCache[n],this.notifyServiceWorker(n)))}async _poll(){const n=await this._withRetries(g=>{const w=rm(g,!1).getAll();return new Pd(w).toPromise()});if(!n)return[];if(this.pendingWrites!==0)return[];const o=[],d=new Set;if(n.length!==0)for(const{fbase_key:g,value:w}of n)d.add(g),JSON.stringify(this.localCache[g])!==JSON.stringify(w)&&(this.notifyListeners(g,w),o.push(g));for(const g of Object.keys(this.localCache))this.localCache[g]&&!d.has(g)&&(this.notifyListeners(g,null),o.push(g));return o}notifyListeners(n,o){this.localCache[n]=o;const d=this.listeners[n];if(d)for(const g of Array.from(d))g(o)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),vk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(n,o){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[n]||(this.listeners[n]=new Set,this._get(n)),this.listeners[n].add(o)}_removeListener(n,o){this.listeners[n]&&(this.listeners[n].delete(o),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Qw.type="LOCAL";const bk=Qw;new Ed(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(a,n){return n?va(n):(un(a._popupRedirectResolver,a,"argument-error"),a._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cy extends sy{constructor(n){super("custom","custom"),this.params=n}_getIdTokenResponse(n){return Ru(n,this._buildIdpRequest())}_linkToIdToken(n,o){return Ru(n,this._buildIdpRequest(o))}_getReauthenticationResolver(n){return Ru(n,this._buildIdpRequest())}_buildIdpRequest(n){const o={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return n&&(o.idToken=n),o}}function wk(a){return qw(a.auth,new cy(a),a.bypassAuthState)}function Tk(a){const{auth:n,user:o}=a;return un(o,n,"internal-error"),XR(o,new cy(a),a.bypassAuthState)}async function Ek(a){const{auth:n,user:o}=a;return un(o,n,"internal-error"),KR(o,new cy(a),a.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eT{constructor(n,o,d,g,w=!1){this.auth=n,this.resolver=d,this.user=g,this.bypassAuthState=w,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(o)?o:[o]}execute(){return new Promise(async(n,o)=>{this.pendingPromise={resolve:n,reject:o};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(d){this.reject(d)}})}async onAuthEvent(n){const{urlResponse:o,sessionId:d,postBody:g,tenantId:w,error:x,type:c}=n;if(x){this.reject(x);return}const R={auth:this.auth,requestUri:o,sessionId:d,tenantId:w||void 0,postBody:g||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(R))}catch(B){this.reject(B)}}onError(n){this.reject(n)}getIdpTask(n){switch(n){case"signInViaPopup":case"signInViaRedirect":return wk;case"linkViaPopup":case"linkViaRedirect":return Ek;case"reauthViaPopup":case"reauthViaRedirect":return Tk;default:Qs(this.auth,"internal-error")}}resolve(n){Ia(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(n),this.unregisterAndCleanUp()}reject(n){Ia(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(n),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ik=new Ed(2e3,1e4);async function Sk(a,n,o){if(xs(a.app))return Promise.reject(go(a,"operation-not-supported-in-this-environment"));const d=Pa(a);eR(a,n,ay);const g=Jw(d,o);return new oc(d,"signInViaPopup",n,g).executeNotNull()}class oc extends eT{constructor(n,o,d,g,w){super(n,o,g,w),this.provider=d,this.authWindow=null,this.pollId=null,oc.currentPopupAction&&oc.currentPopupAction.cancel(),oc.currentPopupAction=this}async executeNotNull(){const n=await this.execute();return un(n,this.auth,"internal-error"),n}async onExecution(){Ia(this.filter.length===1,"Popup operations only handle one event");const n=ly();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(o=>{this.reject(o)}),this.resolver._isIframeWebStorageSupported(this.auth,o=>{o||this.reject(go(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var n;return((n=this.authWindow)==null?void 0:n.associatedEvent)||null}cancel(){this.reject(go(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,oc.currentPopupAction=null}pollUserCancellation(){const n=()=>{var o,d;if((d=(o=this.authWindow)==null?void 0:o.window)!=null&&d.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(go(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(n,Ik.get())};n()}}oc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pk="pendingRedirect",uf=new Map;class Ak extends eT{constructor(n,o,d=!1){super(n,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],o,void 0,d),this.eventId=null}async execute(){let n=uf.get(this.auth._key());if(!n){try{const d=await Ck(this.resolver,this.auth)?await super.execute():null;n=()=>Promise.resolve(d)}catch(o){n=()=>Promise.reject(o)}uf.set(this.auth._key(),n)}return this.bypassAuthState||uf.set(this.auth._key(),()=>Promise.resolve(null)),n()}async onAuthEvent(n){if(n.type==="signInViaRedirect")return super.onAuthEvent(n);if(n.type==="unknown"){this.resolve(null);return}if(n.eventId){const o=await this.auth._redirectUserForId(n.eventId);if(o)return this.user=o,super.onAuthEvent(n);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Ck(a,n){const o=kk(n),d=Rk(a);if(!await d._isAvailable())return!1;const g=await d._get(o)==="true";return await d._remove(o),g}function Mk(a,n){uf.set(a._key(),n)}function Rk(a){return va(a._redirectPersistence)}function kk(a){return cf(Pk,a.config.apiKey,a.name)}async function Dk(a,n,o=!1){if(xs(a.app))return Promise.reject(ba(a));const d=Pa(a),g=Jw(d,n),x=await new Ak(d,g,o).execute();return x&&!o&&(delete x.user._redirectEventId,await d._persistUserIfCurrent(x.user),await d._setRedirectUser(null,n)),x}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk=10*60*1e3;class zk{constructor(n){this.auth=n,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(n){this.consumers.add(n),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,n)&&(this.sendToConsumer(this.queuedRedirectEvent,n),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(n){this.consumers.delete(n)}onEvent(n){if(this.hasEventBeenHandled(n))return!1;let o=!1;return this.consumers.forEach(d=>{this.isEventForConsumer(n,d)&&(o=!0,this.sendToConsumer(n,d),this.saveEventToCache(n))}),this.hasHandledPotentialRedirect||!Fk(n)||(this.hasHandledPotentialRedirect=!0,o||(this.queuedRedirectEvent=n,o=!0)),o}sendToConsumer(n,o){var d;if(n.error&&!tT(n)){const g=((d=n.error.code)==null?void 0:d.split("auth/")[1])||"internal-error";o.onError(go(this.auth,g))}else o.onAuthEvent(n)}isEventForConsumer(n,o){const d=o.eventId===null||!!n.eventId&&n.eventId===o.eventId;return o.filter.includes(n.type)&&d}hasEventBeenHandled(n){return Date.now()-this.lastProcessedEventTime>=Lk&&this.cachedEventUids.clear(),this.cachedEventUids.has(tb(n))}saveEventToCache(n){this.cachedEventUids.add(tb(n)),this.lastProcessedEventTime=Date.now()}}function tb(a){return[a.type,a.eventId,a.sessionId,a.tenantId].filter(n=>n).join("-")}function tT({type:a,error:n}){return a==="unknown"&&(n==null?void 0:n.code)==="auth/no-auth-event"}function Fk(a){switch(a.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return tT(a);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ok(a,n={}){return Ho(a,"GET","/v1/projects",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Vk=/^https?/;async function Bk(a){if(a.config.emulator)return;const{authorizedDomains:n}=await Ok(a);for(const o of n)try{if(Uk(o))return}catch{}Qs(a,"unauthorized-domain")}function Uk(a){const n=h_(),{protocol:o,hostname:d}=new URL(n);if(a.startsWith("chrome-extension://")){const x=new URL(a);return x.hostname===""&&d===""?o==="chrome-extension:"&&a.replace("chrome-extension://","")===n.replace("chrome-extension://",""):o==="chrome-extension:"&&x.hostname===d}if(!Vk.test(o))return!1;if(Nk.test(a))return d===a;const g=a.replace(/\./g,"\\.");return new RegExp("^(.+\\."+g+"|"+g+")$","i").test(d)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jk=new Ed(3e4,6e4);function nb(){const a=Uo().___jsl;if(a!=null&&a.H){for(const n of Object.keys(a.H))if(a.H[n].r=a.H[n].r||[],a.H[n].L=a.H[n].L||[],a.H[n].r=[...a.H[n].L],a.CP)for(let o=0;o<a.CP.length;o++)a.CP[o]=null}}function qk(a){return new Promise((n,o)=>{var g,w,x;function d(){nb(),gapi.load("gapi.iframes",{callback:()=>{n(gapi.iframes.getContext())},ontimeout:()=>{nb(),o(go(a,"network-request-failed"))},timeout:jk.get()})}if((w=(g=Uo().gapi)==null?void 0:g.iframes)!=null&&w.Iframe)n(gapi.iframes.getContext());else if((x=Uo().gapi)!=null&&x.load)d();else{const c=CR("iframefcb");return Uo()[c]=()=>{gapi.load?d():o(go(a,"network-request-failed"))},Vw(`${AR()}?onload=${c}`).catch(R=>o(R))}}).catch(n=>{throw hf=null,n})}let hf=null;function $k(a){return hf=hf||qk(a),hf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk=new Ed(5e3,15e3),Hk="__/auth/iframe",Zk="emulator/auth/iframe",Wk={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Kk=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Xk(a){const n=a.config;un(n.authDomain,a,"auth-domain-config-required");const o=n.emulator?ny(n,Zk):`https://${a.config.authDomain}/${Hk}`,d={apiKey:n.apiKey,appName:a.name,v:gc},g=Kk.get(a.config.apiHost);g&&(d.eid=g);const w=a._getFrameworks();return w.length&&(d.fw=w.join(",")),`${o}?${yd(d).slice(1)}`}async function Yk(a){const n=await $k(a),o=Uo().gapi;return un(o,a,"internal-error"),n.open({where:document.body,url:Xk(a),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Wk,dontclear:!0},d=>new Promise(async(g,w)=>{await d.restyle({setHideOnLeave:!1});const x=go(a,"network-request-failed"),c=Uo().setTimeout(()=>{w(x)},Gk.get());function R(){Uo().clearTimeout(c),g(d)}d.ping(R).then(R,()=>{w(x)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qk={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Jk=500,eD=600,tD="_blank",nD="http://localhost";class rb{constructor(n){this.window=n,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rD(a,n,o,d=Jk,g=eD){const w=Math.max((window.screen.availHeight-g)/2,0).toString(),x=Math.max((window.screen.availWidth-d)/2,0).toString();let c="";const R={...Qk,width:d.toString(),height:g.toString(),top:w,left:x},B=Gi().toLowerCase();o&&(c=kw(B)?tD:o),Mw(B)&&(n=n||nD,R.scrollbars="yes");const W=Object.entries(R).reduce((ce,[Ie,Ue])=>`${ce}${Ie}=${Ue},`,"");if(vR(B)&&c!=="_self")return iD(n||"",c),new rb(null);const ee=window.open(n||"",c,W);un(ee,a,"popup-blocked");try{ee.focus()}catch{}return new rb(ee)}function iD(a,n){const o=document.createElement("a");o.href=a,o.target=n;const d=document.createEvent("MouseEvent");d.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),o.dispatchEvent(d)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD="__/auth/handler",oD="emulator/auth/handler",aD=encodeURIComponent("fac");async function ib(a,n,o,d,g,w){un(a.config.authDomain,a,"auth-domain-config-required"),un(a.config.apiKey,a,"invalid-api-key");const x={apiKey:a.config.apiKey,appName:a.name,authType:o,redirectUrl:d,v:gc,eventId:g};if(n instanceof ay){n.setDefaultLanguage(a.languageCode),x.providerId=n.providerId||"",vS(n.getCustomParameters())||(x.customParameters=JSON.stringify(n.getCustomParameters()));for(const[W,ee]of Object.entries({}))x[W]=ee}if(n instanceof Sd){const W=n.getScopes().filter(ee=>ee!=="");W.length>0&&(x.scopes=W.join(","))}a.tenantId&&(x.tid=a.tenantId);const c=x;for(const W of Object.keys(c))c[W]===void 0&&delete c[W];const R=await a._getAppCheckToken(),B=R?`#${aD}=${encodeURIComponent(R)}`:"";return`${lD(a)}?${yd(c).slice(1)}${B}`}function lD({config:a}){return a.emulator?ny(a,oD):`https://${a.authDomain}/${sD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Og="webStorageSupport";class cD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ww,this._completeRedirectFn=Dk,this._overrideRedirectResult=Mk}async _openPopup(n,o,d,g){var x;Ia((x=this.eventManagers[n._key()])==null?void 0:x.manager,"_initialize() not called before _openPopup()");const w=await ib(n,o,d,h_(),g);return rD(n,w,ly())}async _openRedirect(n,o,d,g){await this._originValidation(n);const w=await ib(n,o,d,h_(),g);return dk(w),new Promise(()=>{})}_initialize(n){const o=n._key();if(this.eventManagers[o]){const{manager:g,promise:w}=this.eventManagers[o];return g?Promise.resolve(g):(Ia(w,"If manager is not set, promise should be"),w)}const d=this.initAndGetManager(n);return this.eventManagers[o]={promise:d},d.catch(()=>{delete this.eventManagers[o]}),d}async initAndGetManager(n){const o=await Yk(n),d=new zk(n);return o.register("authEvent",g=>(un(g==null?void 0:g.authEvent,n,"invalid-auth-event"),{status:d.onEvent(g.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[n._key()]={manager:d},this.iframes[n._key()]=o,d}_isIframeWebStorageSupported(n,o){this.iframes[n._key()].send(Og,{type:Og},g=>{var x;const w=(x=g==null?void 0:g[0])==null?void 0:x[Og];w!==void 0&&o(!!w),Qs(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(n){const o=n._key();return this.originValidationPromises[o]||(this.originValidationPromises[o]=Bk(n)),this.originValidationPromises[o]}get _shouldInitProactively(){return Ow()||Rw()||iy()}}const uD=cD;var sb="@firebase/auth",ob="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hD{constructor(n){this.auth=n,this.internalListeners=new Map}getUid(){var n;return this.assertAuthConfigured(),((n=this.auth.currentUser)==null?void 0:n.uid)||null}async getToken(n){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(n)}:null}addAuthTokenListener(n){if(this.assertAuthConfigured(),this.internalListeners.has(n))return;const o=this.auth.onIdTokenChanged(d=>{n((d==null?void 0:d.stsTokenManager.accessToken)||null)});this.internalListeners.set(n,o),this.updateProactiveRefresh()}removeAuthTokenListener(n){this.assertAuthConfigured();const o=this.internalListeners.get(n);o&&(this.internalListeners.delete(n),o(),this.updateProactiveRefresh())}assertAuthConfigured(){un(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dD(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function pD(a){uc(new cl("auth",(n,{options:o})=>{const d=n.getProvider("app").getImmediate(),g=n.getProvider("heartbeat"),w=n.getProvider("app-check-internal"),{apiKey:x,authDomain:c}=d.options;un(x&&!x.includes(":"),"invalid-api-key",{appName:d.name});const R={apiKey:x,authDomain:c,clientPlatform:a,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Nw(a)},B=new IR(d,g,w,R);return zR(B,o),B},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,o,d)=>{n.getProvider("auth-internal").initialize()})),uc(new cl("auth-internal",n=>{const o=Pa(n.getProvider("auth").getImmediate());return(d=>new hD(d))(o)},"PRIVATE").setInstantiationMode("EXPLICIT")),Fo(sb,ob,dD(a)),Fo(sb,ob,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD=5*60,mD=Ub("authIdTokenMaxAge")||fD;let ab=null;const gD=a=>async n=>{const o=n&&await n.getIdTokenResult(),d=o&&(new Date().getTime()-Date.parse(o.issuedAtTime))/1e3;if(d&&d>mD)return;const g=o==null?void 0:o.token;ab!==g&&(ab=g,await fetch(a,{method:g?"POST":"DELETE",headers:g?{Authorization:`Bearer ${g}`}:{}}))};function _D(a=E_()){const n=Uf(a,"auth");if(n.isInitialized())return n.getImmediate();const o=LR(a,{popupRedirectResolver:uD,persistence:[bk,ck,Ww]}),d=Ub("authTokenSyncURL");if(d&&typeof isSecureContext=="boolean"&&isSecureContext){const w=new URL(d,location.origin);if(location.origin===w.origin){const x=gD(w.toString());ik(o,x,()=>x(o.currentUser)),rk(o,c=>x(c))}}const g=Nb("auth");return g&&FR(o,`http://${g}`),o}function yD(){var a;return((a=document.getElementsByTagName("head"))==null?void 0:a[0])??document}SR({loadJS(a){return new Promise((n,o)=>{const d=document.createElement("script");d.setAttribute("src",a),d.onload=n,d.onerror=g=>{const w=go("internal-error");w.customData=g,o(w)},d.type="text/javascript",d.charset="UTF-8",yD().appendChild(d)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});pD("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nT="firebasestorage.googleapis.com",vD="storageBucket",xD=2*60*1e3,bD=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo extends Go{constructor(n,o,d=0){super(Ng(n),`Firebase Storage: ${o} (${Ng(n)})`),this.status_=d,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Zo.prototype)}get status(){return this.status_}set status(n){this.status_=n}_codeEquals(n){return Ng(n)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(n){this.customData.serverResponse=n,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var $o;(function(a){a.UNKNOWN="unknown",a.OBJECT_NOT_FOUND="object-not-found",a.BUCKET_NOT_FOUND="bucket-not-found",a.PROJECT_NOT_FOUND="project-not-found",a.QUOTA_EXCEEDED="quota-exceeded",a.UNAUTHENTICATED="unauthenticated",a.UNAUTHORIZED="unauthorized",a.UNAUTHORIZED_APP="unauthorized-app",a.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",a.INVALID_CHECKSUM="invalid-checksum",a.CANCELED="canceled",a.INVALID_EVENT_NAME="invalid-event-name",a.INVALID_URL="invalid-url",a.INVALID_DEFAULT_BUCKET="invalid-default-bucket",a.NO_DEFAULT_BUCKET="no-default-bucket",a.CANNOT_SLICE_BLOB="cannot-slice-blob",a.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",a.NO_DOWNLOAD_URL="no-download-url",a.INVALID_ARGUMENT="invalid-argument",a.INVALID_ARGUMENT_COUNT="invalid-argument-count",a.APP_DELETED="app-deleted",a.INVALID_ROOT_OPERATION="invalid-root-operation",a.INVALID_FORMAT="invalid-format",a.INTERNAL_ERROR="internal-error",a.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})($o||($o={}));function Ng(a){return"storage/"+a}function wD(){const a="An unknown error occurred, please check the error payload for server response.";return new Zo($o.UNKNOWN,a)}function TD(){return new Zo($o.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ED(){return new Zo($o.CANCELED,"User canceled the upload/download.")}function ID(a){return new Zo($o.INVALID_URL,"Invalid URL '"+a+"'.")}function SD(a){return new Zo($o.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+a+"'.")}function lb(a){return new Zo($o.INVALID_ARGUMENT,a)}function rT(){return new Zo($o.APP_DELETED,"The Firebase app was deleted.")}function PD(a){return new Zo($o.INVALID_ROOT_OPERATION,"The operation '"+a+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(n,o){this.bucket=n,this.path_=o}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const n=encodeURIComponent;return"/b/"+n(this.bucket)+"/o/"+n(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(n,o){let d;try{d=mo.makeFromUrl(n,o)}catch{return new mo(n,"")}if(d.path==="")return d;throw SD(n)}static makeFromUrl(n,o){let d=null;const g="([A-Za-z0-9.\\-_]+)";function w(ht){ht.path.charAt(ht.path.length-1)==="/"&&(ht.path_=ht.path_.slice(0,-1))}const x="(/(.*))?$",c=new RegExp("^gs://"+g+x,"i"),R={bucket:1,path:3};function B(ht){ht.path_=decodeURIComponent(ht.path)}const W="v[A-Za-z0-9_]+",ee=o.replace(/[.]/g,"\\."),ce="(/([^?#]*).*)?$",Ie=new RegExp(`^https?://${ee}/${W}/b/${g}/o${ce}`,"i"),Ue={bucket:1,path:3},ke=o===nT?"(?:storage.googleapis.com|storage.cloud.google.com)":o,Q="([^?#]*)",qe=new RegExp(`^https?://${ke}/${g}/${Q}`,"i"),Ge=[{regex:c,indices:R,postModify:w},{regex:Ie,indices:Ue,postModify:B},{regex:qe,indices:{bucket:1,path:2},postModify:B}];for(let ht=0;ht<Ge.length;ht++){const ct=Ge[ht],ot=ct.regex.exec(n);if(ot){const xe=ot[ct.indices.bucket];let se=ot[ct.indices.path];se||(se=""),d=new mo(xe,se),ct.postModify(d);break}}if(d==null)throw ID(n);return d}}class AD{constructor(n){this.promise_=Promise.reject(n)}getPromise(){return this.promise_}cancel(n=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CD(a,n,o){let d=1,g=null,w=null,x=!1,c=0;function R(){return c===2}let B=!1;function W(...Q){B||(B=!0,n.apply(null,Q))}function ee(Q){g=setTimeout(()=>{g=null,a(Ie,R())},Q)}function ce(){w&&clearTimeout(w)}function Ie(Q,...qe){if(B){ce();return}if(Q){ce(),W.call(null,Q,...qe);return}if(R()||x){ce(),W.call(null,Q,...qe);return}d<64&&(d*=2);let Ge;c===1?(c=2,Ge=0):Ge=(d+Math.random())*1e3,ee(Ge)}let Ue=!1;function ke(Q){Ue||(Ue=!0,ce(),!B&&(g!==null?(Q||(c=2),clearTimeout(g),ee(0)):Q||(c=1)))}return ee(0),w=setTimeout(()=>{x=!0,ke(!0)},o),ke}function MD(a){a(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RD(a){return a!==void 0}function cb(a,n,o,d){if(d<n)throw lb(`Invalid value for '${a}'. Expected ${n} or greater.`);if(d>o)throw lb(`Invalid value for '${a}'. Expected ${o} or less.`)}function kD(a){const n=encodeURIComponent;let o="?";for(const d in a)if(a.hasOwnProperty(d)){const g=n(d)+"="+n(a[d]);o=o+g+"&"}return o=o.slice(0,-1),o}var Ff;(function(a){a[a.NO_ERROR=0]="NO_ERROR",a[a.NETWORK_ERROR=1]="NETWORK_ERROR",a[a.ABORT=2]="ABORT"})(Ff||(Ff={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DD(a,n){const o=a>=500&&a<600,g=[408,429].indexOf(a)!==-1,w=n.indexOf(a)!==-1;return o||g||w}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LD{constructor(n,o,d,g,w,x,c,R,B,W,ee,ce=!0,Ie=!1){this.url_=n,this.method_=o,this.headers_=d,this.body_=g,this.successCodes_=w,this.additionalRetryCodes_=x,this.callback_=c,this.errorCallback_=R,this.timeout_=B,this.progressCallback_=W,this.connectionFactory_=ee,this.retry=ce,this.isUsingEmulator=Ie,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Ue,ke)=>{this.resolve_=Ue,this.reject_=ke,this.start_()})}start_(){const n=(d,g)=>{if(g){d(!1,new Yp(!1,null,!0));return}const w=this.connectionFactory_();this.pendingConnection_=w;const x=c=>{const R=c.loaded,B=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(R,B)};this.progressCallback_!==null&&w.addUploadProgressListener(x),w.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&w.removeUploadProgressListener(x),this.pendingConnection_=null;const c=w.getErrorCode()===Ff.NO_ERROR,R=w.getStatus();if(!c||DD(R,this.additionalRetryCodes_)&&this.retry){const W=w.getErrorCode()===Ff.ABORT;d(!1,new Yp(!1,null,W));return}const B=this.successCodes_.indexOf(R)!==-1;d(!0,new Yp(B,w))})},o=(d,g)=>{const w=this.resolve_,x=this.reject_,c=g.connection;if(g.wasSuccessCode)try{const R=this.callback_(c,c.getResponse());RD(R)?w(R):w()}catch(R){x(R)}else if(c!==null){const R=wD();R.serverResponse=c.getErrorText(),this.errorCallback_?x(this.errorCallback_(c,R)):x(R)}else if(g.canceled){const R=this.appDelete_?rT():ED();x(R)}else{const R=TD();x(R)}};this.canceled_?o(!1,new Yp(!1,null,!0)):this.backoffId_=CD(n,o,this.timeout_)}getPromise(){return this.promise_}cancel(n){this.canceled_=!0,this.appDelete_=n||!1,this.backoffId_!==null&&MD(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Yp{constructor(n,o,d){this.wasSuccessCode=n,this.connection=o,this.canceled=!!d}}function zD(a,n){n!==null&&n.length>0&&(a.Authorization="Firebase "+n)}function FD(a,n){a["X-Firebase-Storage-Version"]="webjs/"+(n??"AppManager")}function OD(a,n){n&&(a["X-Firebase-GMPID"]=n)}function ND(a,n){n!==null&&(a["X-Firebase-AppCheck"]=n)}function VD(a,n,o,d,g,w,x=!0,c=!1){const R=kD(a.urlParams),B=a.url+R,W=Object.assign({},a.headers);return OD(W,n),zD(W,o),FD(W,w),ND(W,d),new LD(B,a.method,W,a.body,a.successCodes,a.additionalRetryCodes,a.handler,a.errorHandler,a.timeout,a.progressCallback,g,x,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BD(a){if(a.length===0)return null;const n=a.lastIndexOf("/");return n===-1?"":a.slice(0,n)}function UD(a){const n=a.lastIndexOf("/",a.length-2);return n===-1?a:a.slice(n+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(n,o){this._service=n,o instanceof mo?this._location=o:this._location=mo.makeFromUrl(o,n.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(n,o){return new Of(n,o)}get root(){const n=new mo(this._location.bucket,"");return this._newRef(this._service,n)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return UD(this._location.path)}get storage(){return this._service}get parent(){const n=BD(this._location.path);if(n===null)return null;const o=new mo(this._location.bucket,n);return new Of(this._service,o)}_throwIfRoot(n){if(this._location.path==="")throw PD(n)}}function ub(a,n){const o=n==null?void 0:n[vD];return o==null?null:mo.makeFromBucketSpec(o,a)}function jD(a,n,o,d={}){a.host=`${n}:${o}`;const g=mc(n);g&&(x_(`https://${a.host}/b`),b_("Storage",!0)),a._isUsingEmulator=!0,a._protocol=g?"https":"http";const{mockUserToken:w}=d;w&&(a._overrideAuthToken=typeof w=="string"?w:jb(w,a.app.options.projectId))}class qD{constructor(n,o,d,g,w,x=!1){this.app=n,this._authProvider=o,this._appCheckProvider=d,this._url=g,this._firebaseVersion=w,this._isUsingEmulator=x,this._bucket=null,this._host=nT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=xD,this._maxUploadRetryTime=bD,this._requests=new Set,g!=null?this._bucket=mo.makeFromBucketSpec(g,this._host):this._bucket=ub(this._host,this.app.options)}get host(){return this._host}set host(n){this._host=n,this._url!=null?this._bucket=mo.makeFromBucketSpec(this._url,n):this._bucket=ub(n,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(n){cb("time",0,Number.POSITIVE_INFINITY,n),this._maxUploadRetryTime=n}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(n){cb("time",0,Number.POSITIVE_INFINITY,n),this._maxOperationRetryTime=n}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const n=this._authProvider.getImmediate({optional:!0});if(n){const o=await n.getToken();if(o!==null)return o.accessToken}return null}async _getAppCheckToken(){if(xs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=this._appCheckProvider.getImmediate({optional:!0});return n?(await n.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(n=>n.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(n){return new Of(this,n)}_makeRequest(n,o,d,g,w=!0){if(this._deleted)return new AD(rT());{const x=VD(n,this._appId,d,g,o,this._firebaseVersion,w,this._isUsingEmulator);return this._requests.add(x),x.getPromise().then(()=>this._requests.delete(x),()=>this._requests.delete(x)),x}}async makeRequestWithTokens(n,o){const[d,g]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(n,o,d,g).getPromise()}}const hb="@firebase/storage",db="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT="storage";function $D(a=E_(),n){a=Hi(a);const d=Uf(a,iT).getImmediate({identifier:n}),g=Vb("storage");return g&&GD(d,...g),d}function GD(a,n,o,d={}){jD(a,n,o,d)}function HD(a,{instanceIdentifier:n}){const o=a.getProvider("app").getImmediate(),d=a.getProvider("auth-internal"),g=a.getProvider("app-check-internal");return new qD(o,d,g,n,gc)}function ZD(){uc(new cl(iT,HD,"PUBLIC").setMultipleInstances(!0)),Fo(hb,db,""),Fo(hb,db,"esm2020")}ZD();const WD={apiKey:"AIzaSyCYPLxlqnPO7neX3ovWYdLR8dScB_A2hjg",authDomain:"iss-tracker-hub.firebaseapp.com",projectId:"iss-tracker-hub",storageBucket:"iss-tracker-hub.firebasestorage.app",messagingSenderId:"851736073236",appId:"1:851736073236:web:0d481bdae81bf2a26d8301"};let Qp=null,Os=null,gd=null,KD=null;try{Qp=Gb(WD),Os=_D(Qp),gd=RM(Qp),KD=$D(Qp),console.log("[Firebase] Initialized successfully")}catch(a){console.warn("[Firebase] Initialization failed:",a.message),console.warn("[Firebase] Running in offline mode - auth features disabled")}const df=[];let uy=null;const pb={"auth/email-already-in-use":{tr:"Bu e-posta zaten kullanmda",en:"This email is already in use"},"auth/invalid-email":{tr:"Geersiz e-posta adresi",en:"Invalid email address"},"auth/weak-password":{tr:"ifre en az 6 karakter olmal",en:"Password should be at least 6 characters"},"auth/user-not-found":{tr:"Bu e-posta ile kaytl kullanc yok",en:"No user found with this email"},"auth/wrong-password":{tr:"ifre hatal",en:"Wrong password"},"auth/too-many-requests":{tr:"ok fazla deneme. Ltfen bekleyin.",en:"Too many attempts. Please wait."},"auth/network-request-failed":{tr:"nternet balants yok",en:"No internet connection"},default:{tr:"Bir hata olutu",en:"An error occurred"}};function im(a,n="tr"){const o=pb[a]||pb.default;return o[n]||o.en}function XD(){if(!Os){console.warn("[AuthService] Firebase auth not initialized");return}sk(Os,a=>{uy=a,n3(a),a?console.log("[AuthService] User signed in:",a.email):console.log("[AuthService] User signed out")})}async function YD(a,n,o=null){if(!Os)throw new Error("Firebase not initialized");try{const d=await JR(Os,a,n);return o&&d.user&&await nk(d.user,{displayName:o}),{success:!0,user:d.user}}catch(d){return{success:!1,error:im(d.code),code:d.code}}}async function QD(a,n){if(!Os)throw new Error("Firebase not initialized");try{return{success:!0,user:(await ek(Os,a,n)).user}}catch(o){return{success:!1,error:im(o.code),code:o.code}}}async function JD(){if(!Os)throw new Error("Firebase not initialized");try{const a=new ga;return{success:!0,user:(await Sk(Os,a)).user}}catch(a){return{success:!1,error:im(a.code),code:a.code}}}async function e3(){if(!Os)return{success:!0};try{return await ok(Os),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function t3(a){if(!Os)throw new Error("Firebase not initialized");try{return await QR(Os,a),{success:!0}}catch(n){return{success:!1,error:im(n.code),code:n.code}}}function sT(){return uy}function oT(a){return df.push(a),a(uy),()=>{const n=df.indexOf(a);n>-1&&df.splice(n,1)}}function n3(a){df.forEach(n=>{try{n(a)}catch(o){console.error("[AuthService] Listener error:",o)}})}XD();const f_={theme:"dark",colorPalette:"CYAN",language:"tr",units:"metric",location:{lat:null,lon:null,name:null},notifications:{passAlerts:!1,emailAlerts:!1},savedImages:[]};let rl=null,pf=null;const r3=[];oT(a=>{a?i3(a.uid):(pf&&(pf(),pf=null),rl=null,cT(null))});function i3(a){if(!gd){console.warn("[UserPrefs] Firestore not available");return}const n=hw(gd,"users",a,"settings","preferences");pf=ZM(n,o=>{o.exists()?rl={...f_,...o.data()}:(rl={...f_},aT(rl)),cT(rl),console.log("[UserPrefs] Preferences loaded:",rl)},o=>{console.error("[UserPrefs] Snapshot error:",o)})}function s3(){return rl||{...f_}}async function aT(a){const n=sT();if(!n||!gd){try{localStorage.setItem("isshub:preferences",JSON.stringify(a))}catch{}return{success:!0,local:!0}}try{const o=hw(gd,"users",n.uid,"settings","preferences");return await HM(o,{...a,updatedAt:new Date().toISOString()},{merge:!0}),rl=a,{success:!0}}catch(o){return console.error("[UserPrefs] Save failed:",o),{success:!1,error:o.message}}}async function lT(a,n){const d={...s3(),[a]:n};return aT(d)}async function o3(a){return lT("theme",a)}async function a3(a){return lT("colorPalette",a)}function cT(a){r3.forEach(n=>{try{n(a)}catch(o){console.error("[UserPrefs] Listener error:",o)}})}function l3(a={}){const n=document.createElement("div");n.className="hub-modal-overlay hidden";const o=[{code:"en",label:"English",flag:""},{code:"tr",label:"Trke",flag:""},{code:"de",label:"Deutsch",flag:""},{code:"fr",label:"Franais",flag:""},{code:"es",label:"Espaol",flag:""},{code:"it",label:"Italiano",flag:""},{code:"ru",label:"",flag:""},{code:"ja",label:"",flag:""},{code:"zh",label:"",flag:""},{code:"pt",label:"Portugus",flag:""},{code:"hi",label:"",flag:""},{code:"ar",label:"",flag:""},{code:"bn",label:"",flag:""},{code:"ko",label:"",flag:""},{code:"nl",label:"Nederlands",flag:""},{code:"pl",label:"Polski",flag:""},{code:"ro",label:"Romn",flag:""},{code:"sv",label:"Svenska",flag:""}];n.innerHTML=`
    <div class="hub-modal settings-modal">
      <div class="hub-modal-header">
        <div class="hub-modal-title" style="display:flex; gap:8px; align-items:center;">
            ${ss.settings} <span>${mt("settings")}</span>
        </div>
        <button class="hub-modal-close" aria-label="${mt("close")}">${ss.close}</button>
      </div>
      <div class="hub-modal-body">
      
        <!-- Tools Section (Location Restoration) -->
        <div class="settings-group">
            <div class="settings-label">${mt("tools")} & ${mt("location")}</div>
            <div class="settings-controls">
                <button class="settings-btn" id="btn-location">
                    <span style="display:flex; gap:6px; justify-content:center; align-items:center;">
                        ${ss.map} ${mt("changeLocation")}
                    </span>
                </button>
            </div>
            <div class="settings-hint">${mt("passDepend")}</div>
        </div>

        <!-- Language Section -->
        <div class="settings-group">
          <div class="settings-label">${mt("language")}</div>
          <div class="settings-controls" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;">
            ${o.map(Q=>`
                <button class="settings-btn" data-lang="${Q.code}" aria-label="${Q.label}" style="font-size:11px; padding:6px;">
                    ${Q.flag} ${Q.code.toUpperCase()}
                </button>
            `).join("")}
          </div>
        </div>

        <!-- Theme Section -->
        <div class="settings-group">
          <div class="settings-label">${mt("theme")}</div>
          <div class="settings-controls" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;">
              <button class="settings-btn" data-theme="light" aria-label="Light theme" style="font-size:11px; padding:6px;"> Light</button>
              <button class="settings-btn active" data-theme="dark" aria-label="Dark theme" style="font-size:11px; padding:6px;"> Dark</button>
              <button class="settings-btn" data-theme="system" aria-label="System theme" style="font-size:11px; padding:6px;"> System</button>
          </div>
        </div>

        <!-- Accent Color Section -->
        <div class="settings-group">
            <div class="settings-label">Color</div>
            <div class="settings-controls" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px;">
                <button class="settings-btn color-btn" data-color="cyan" style="background:#00f3ff; height:24px; border-radius:4px;"></button>
                <button class="settings-btn color-btn" data-color="pink" style="background:#ff00ff; height:24px; border-radius:4px;"></button>
                <button class="settings-btn color-btn" data-color="green" style="background:#0aff00; height:24px; border-radius:4px;"></button>
                <button class="settings-btn color-btn" data-color="orange" style="background:#ffaa00; height:24px; border-radius:4px;"></button>
                <button class="settings-btn color-btn" data-color="purple" style="background:#bd00ff; height:24px; border-radius:4px;"></button>
            </div>
        </div>

        <!-- Meta Info -->
        <div class="settings-meta">
          ISS Tracker HUB v0.3.2<br>
          Restoration Build
        </div>
      </div>
    </div>
  `;const d=n.querySelector(".hub-modal-close"),g=n.querySelectorAll("[data-lang]"),w=n.querySelector(".hub-modal-title span"),x=n.querySelector(".settings-group:nth-child(2) .settings-label"),c=n.querySelector(".settings-group:nth-child(3) .settings-label"),R=n.querySelector("#btn-location"),B=()=>{n.classList.add("hidden"),document.removeEventListener("keydown",W)},W=Q=>{Q.key==="Escape"&&!n.classList.contains("hidden")&&B()};d.addEventListener("click",B),n.addEventListener("click",Q=>{Q.target===n&&B()}),R.addEventListener("click",()=>{B(),a.onOpenLocation&&a.onOpenLocation()});const ee=()=>{const Q=sl();g.forEach(qe=>{qe.dataset.lang===Q?qe.classList.add("active"):qe.classList.remove("active")}),w.textContent=mt("settings"),x.textContent=mt("language"),c.textContent=mt("theme")};g.forEach(Q=>{Q.addEventListener("click",()=>{const qe=Q.dataset.lang;$I(qe),ee()})});const ce=n.querySelectorAll("[data-theme]");ce.forEach(Q=>{Q.addEventListener("click",()=>{const qe=Q.dataset.theme;document.documentElement.setAttribute("data-theme",qe==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":qe),localStorage.setItem("issThemeMode",qe),o3(qe),ce.forEach(Ye=>Ye.classList.remove("active")),Q.classList.add("active")})});const Ie=n.querySelectorAll("[data-color]"),Ue={cyan:"#00f3ff",pink:"#ff00ff",green:"#0aff00",orange:"#ffaa00",purple:"#bd00ff"};Ie.forEach(Q=>{Q.addEventListener("click",()=>{const qe=Q.dataset.color,Ye=Ue[qe],Ge=document.documentElement;Ge.style.setProperty("--accent",Ye),Ge.style.setProperty("--neon-cyan",Ye),Ge.style.setProperty("--border",`rgba(${ke(Ye)}, 0.3)`),localStorage.setItem("issAccentColor",qe),a3(qe.toUpperCase()),Ie.forEach(ht=>ht.style.outline="none"),Q.style.outline="2px solid #fff"})});function ke(Q){const qe=parseInt(Q.replace("#",""),16),Ye=qe>>16&255,Ge=qe>>8&255,ht=qe&255;return`${Ye}, ${Ge}, ${ht}`}return{el:n,open:()=>{ee();const Q=localStorage.getItem("issThemeMode")||"system";ce.forEach(qe=>{qe.dataset.theme===Q?qe.classList.add("active"):qe.classList.remove("active")}),document.addEventListener("keydown",W),n.classList.remove("hidden")}}}function c3(){const a=document.createElement("div");a.className="network-status-bar",a.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(239, 68, 68, 0.95);
    color: white;
    padding: 8px 16px;
    text-align: center;
    font-size: 13px;
    font-weight: 600;
    z-index: 9999;
    display: none;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
  `.trim();const n=document.createElement("span");a.appendChild(n);let o=navigator.onLine,d=Date.now();const g=3e4;function w(){const R=Date.now()-d>g;o?R?(a.style.background="rgba(251, 191, 36, 0.95)",n.textContent=" "+mt("staleData"),a.style.display="block"):a.style.display="none":(a.style.background="rgba(239, 68, 68, 0.95)",n.textContent=" "+mt("offline"),a.style.display="block")}return window.addEventListener("online",()=>{o=!0,console.log("[Network] Online"),w()}),window.addEventListener("offline",()=>{o=!1,console.log("[Network] Offline"),w()}),setInterval(w,5e3),{el:a,markDataReceived:()=>{d=Date.now(),w()},update:w}}const fb="isshub:landingHeroDismissed",Jp=typeof window<"u"&&window.localStorage?window.localStorage:null;function u3({onShowPass:a,onLiveTrack:n,getPassState:o}){if(Jp&&Jp.getItem(fb)==="true")return{el:null,update:()=>{},dismiss:()=>{}};const d=document.createElement("div");d.className="landing-hero-overlay",d.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 20px;
  `;const g=document.createElement("div");g.className="landing-hero-card glass",g.style.cssText=`
    max-width: 500px;
    width: 100%;
    padding: 40px 32px;
    border-radius: 24px;
    text-align: center;
    position: relative;
  `;const w=document.createElement("button");w.className="btn landing-hero-close",w.type="button",w.innerHTML="",w.title=mt("close"),w.style.cssText=`
    position: absolute;
    top: 16px;
    right: 16px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-size: 24px;
    line-height: 1;
    padding: 0;
    opacity: 0.7;
  `;const x=document.createElement("h1");x.className="landing-hero-headline",x.textContent=mt("hero.headline"),x.style.cssText=`
    font-size: clamp(24px, 5vw, 28px);
    font-weight: 700;
    margin: 0 0 16px 0;
    line-height: 1.2;
  `;const c=document.createElement("p");c.className="landing-hero-subline",c.textContent=mt("hero.subline.loading"),c.style.cssText=`
    font-size: clamp(14px, 3.5vw, 16px);
    opacity: 0.9;
    margin: 0 0 32px 0;
    line-height: 1.5;
    min-height: 48px;
  `;const R=document.createElement("div");R.style.cssText=`
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  `;const B=document.createElement("button");B.className="btn btn-primary",B.type="button",B.textContent=mt("hero.cta.showPass"),B.style.cssText=`
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 600;
  `;const W=document.createElement("button");W.className="btn btn-ghost",W.type="button",W.textContent=mt("hero.cta.liveTrack"),W.style.cssText=`
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 600;
  `;const ee=document.createElement("div");ee.style.cssText=`
    margin-top: 16px;
    font-size: 13px;
    opacity: 0.7;
    display: none;
  `,ee.textContent=mt("hero.passCardComing"),R.append(B,W),g.append(w,x,c,R,ee),d.appendChild(g);function ce(){Jp&&Jp.setItem(fb,"true"),d.remove()}w.addEventListener("click",ce),B.addEventListener("click",()=>{ee.style.display="block",setTimeout(()=>{ce(),a&&a()},1500)}),W.addEventListener("click",()=>{ce(),n&&n()});function Ie(){if(!o){c.textContent=mt("hero.subline.loading");return}const Q=o();if(Q.loading||Q.calculating){c.textContent=mt("hero.subline.loading");return}if(Q.pass&&Q.pass.aosMs){const qe=Date.now(),Ye=Math.max(1,Math.round((Q.pass.aosMs-qe)/6e4));c.textContent=mt("hero.subline.pass").replace("{minutes}",Ye);return}if(!Q.hasLocation){c.textContent=mt("hero.subline.permission");return}if(Q.error){c.textContent=mt("hero.subline.unavailable");return}c.textContent=mt("hero.subline.loading")}Ie();const Ue=setInterval(Ie,1e4),ke=ce;return ce=()=>{clearInterval(Ue),ke()},{el:d,update:Ie,dismiss:ce}}function h3(a){if(!a||!a.startTime)return null;const n=B=>new Date(B).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),o=new Date(a.startTime),d=new Date(o.getTime()+(a.duration||5)*60*1e3),g=new Date,w=sl(),x=w==="tr"?"ISS Geii":"ISS Pass",c=w==="tr"?`Uluslararas Uzay stasyonu konumunuzdan grnr olacak. Maksimum ykseklik: ${a.maxElevation||"--"}`:`The International Space Station will be visible from your location. Max elevation: ${a.maxElevation||"--"}`;return`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//ISS Tracker Hub//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:iss-pass-${o.getTime()}@isstrackhub.app
DTSTAMP:${n(g)}
DTSTART:${n(o)}
DTEND:${n(d)}
SUMMARY: ${x}
DESCRIPTION:${c}
LOCATION:Sky above your location
STATUS:CONFIRMED
TRANSP:OPAQUE
BEGIN:VALARM
ACTION:DISPLAY
DESCRIPTION:${x} - ${w==="tr"?"10 dakika sonra!":"10 minutes!"}
TRIGGER:-PT10M
END:VALARM
END:VEVENT
END:VCALENDAR`}function d3(a){const n=h3(a);if(!n)return console.warn("[PassNotification] Cannot generate ICS: invalid pass data"),!1;const o=new Blob([n],{type:"text/calendar;charset=utf-8"}),d=URL.createObjectURL(o),g=document.createElement("a");return g.href=d,g.download=`iss-pass-${new Date(a.startTime).toISOString().slice(0,10)}.ics`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(d),!0}function Ls(a,n){const o=document.createElement(a);return n&&(o.className=n),o}function mb(a){const n=String(a);return n.length===1?"0"+n:n}function Vg(a){if(!a||typeof a!="number")return"";const n=new Date(a);return`${mb(n.getHours())}:${mb(n.getMinutes())}`}function p3(){const a=Ls("div","pass-card glass"),n=Ls("div","pass-head"),o=Ls("div","pass-title");o.textContent=mt("passCardTitle");const d=Ls("button","btn btn-ghost btn-mini pass-details-btn");d.type="button",d.textContent=mt("passDetails"),n.append(o,d);const g=Ls("div","pass-countdown");g.textContent="--:--:--";const w=Ls("div","pass-label-row"),x=Ls("span","pass-dot"),c=Ls("span","pass-label");c.textContent="",w.append(x,c);const R=Ls("div","pass-meta");R.textContent="";const B=Ls("div","pass-extra");B.style.display="none";const W=Ls("div","pass-extra-line"),ee=Ls("div","pass-extra-line"),ce=Ls("button","btn btn-calendar");ce.type="button";const Ie=sl();ce.innerHTML=` ${Ie==="tr"?"Takvime Ekle":"Add to Calendar"}`,ce.style.cssText=`
    margin-top: 8px;
    padding: 8px 12px;
    font-size: 11px;
    background: rgba(0,243,255,0.2);
    border: 1px solid var(--accent);
    border-radius: 6px;
    color: var(--accent);
    cursor: pointer;
    width: 100%;
    transition: 0.2s;
  `,ce.onmouseenter=()=>ce.style.background="rgba(0,243,255,0.4)",ce.onmouseleave=()=>ce.style.background="rgba(0,243,255,0.2)",B.append(W,ee,ce),a.append(n,g,w,R,B);let Ue=null,ke=!1;function Q(Ge){ke=!!Ge,B.style.display=ke?"block":"none",a.classList.toggle("open",ke),d.textContent=mt(ke?"passClose":"passDetails")}d.addEventListener("click",Ge=>{Ge.preventDefault(),Q(!ke)}),ce.addEventListener("click",Ge=>{Ge.preventDefault(),Ge.stopPropagation(),Ue&&d3({startTime:Ue.aosMs,duration:Math.round((Ue.durationSec||300)/60),maxElevation:Ue.maxElevDeg})&&(ce.innerHTML=" "+(sl()==="tr"?"ndirildi!":"Downloaded!"),setTimeout(()=>{ce.innerHTML=" "+(sl()==="tr"?"Takvime Ekle":"Add to Calendar")},2e3))}),a.addEventListener("click",Ge=>{const ht=Ge.target;ht&&ht.closest&&(ht.closest(".pass-details-btn")||ht.closest(".btn-calendar"))||Q(!ke)});function qe({visible:Ge,reason:ht,maxElev:ct}){if(Ge){x.style.background="#16a34a",c.textContent=mt("passVisible");return}if(x.style.background="#ef4444",ht==="lowAngle"&&typeof ct=="number"){const ot=mt("passPoorAngle").replace("{deg}",String(Math.round(ct)));c.textContent=ot;return}c.textContent=mt("passInvisible")}function Ye({nextPass:Ge,nextVisiblePass:ht,countdownText:ct}){if(g.textContent=ct||"--:--:--",Ue=Ge,!Ge){qe({visible:!1,reason:"invisible",maxElev:null}),R.textContent=mt("passNone"),W.textContent="",ee.textContent="",ce.style.display="none";return}ce.style.display="block";const ot=Vg(Ge.aosMs),xe=Vg(Ge.losMs),se=typeof Ge.maxElevDeg=="number"?Math.round(Ge.maxElevDeg):null;R.textContent=`AOS ${ot}  LOS ${xe}  MAX ${se??""}`;const ue=!!Ge.isVisible,Ee=Ge.isLowAngle?"lowAngle":ue?null:"invisible";qe({visible:ue,reason:Ee,maxElev:Ge.maxElevDeg});function be(Ut){if(Ut==null)return"?";const $t=["N","NE","E","SE","S","SW","W","NW"],mn=Math.round(Ut/45)%8;return $t[mn]}const fe=typeof Ge.durationSec=="number"?Ge.durationSec:null,pe=fe==null?"":Math.max(1,Math.round(fe/60)),Jt=fe==null?"":mt("passMinutes").replace("{min}",pe);let fn="";if(Ge.aosAz!=null&&Ge.losAz!=null&&(fn=`   ${be(Ge.aosAz)}  ${be(Ge.losAz)}`),W.textContent=`AOS: ${ot}  LOS: ${xe}  ${mt("passDuration")}: ${Jt}${fn}`,ht&&typeof ht.aosMs=="number"){const Ut=Math.max(0,Math.floor((ht.aosMs-Date.now())/1e3)),$t=Math.floor(Ut/3600),mn=Math.floor(Ut%3600/60),Pt=Vg(ht.aosMs);ee.textContent=`${mt("passFirstVisible")}: ${mt("passHoursMinutes").replace("{h}",$t).replace("{m}",mn).replace("{time}",Pt)}`}else ee.textContent=`${mt("passFirstVisible")}: ${mt("passNotFoundDetails")}`}return{el:a,setState:Ye,setOpen:Q}}function f3(a){const n=document.createElement("div");n.className="mobile-nav";const o=[{id:"map",icon:ss.map,label:mt("navMap")||"Harita"},{id:"nasa",icon:ss.video,label:mt("navNasaTV")||"NASA TV"},{id:"telemetry",icon:ss.activity,label:mt("navTelemetry")||"Veriler"},{id:"passes",icon:ss.globe,label:mt("navPasses")||"Geiler"},{id:"settings",icon:ss.settings,label:mt("settings")||"Ayarlar"}];let d="map";function g(){n.innerHTML="",o.forEach(x=>{const c=document.createElement("button");c.className=`nav-item ${d===x.id?"active":""}`,c.innerHTML=`
        <div class="nav-icon">${x.icon}</div>
        <span class="nav-label">${x.label}</span>
      `,c.onclick=()=>w(x.id),n.appendChild(c)})}function w(x){if(!(d===x&&x!=="settings")){if(x==="settings"){a.onSettings&&a.onSettings();return}d=x,g(),a.onChange&&a.onChange(x)}}return g(),{el:n,setActive:w}}function m3(){const a=document.createElement("div");a.className="nasa-card hub-glass",a.style.cssText=`
    width: 100%;
    margin-bottom: 12px;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    border: 1px solid var(--border);
    background: #000;
  `;const n=document.createElement("div");n.style.cssText=`
    padding: 8px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0,243,255,0.1);
    border-bottom: 1px solid var(--border);
  `;const o=document.createElement("div");o.className="cyber-glitch-text",o.setAttribute("data-text",mt("nasaLive")||"NASA LIVE"),o.textContent=mt("nasaLive")||"NASA LIVE",o.style.fontSize="12px",n.appendChild(o);const d=document.createElement("div");d.innerHTML='<span style="color:red; animation: blink 1s infinite;"></span> LIVE',d.style.cssText="font-size: 10px; font-weight: bold; color: #fff;",n.appendChild(d);const g=document.createElement("div");g.style.cssText=`
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    background: #000;
  `;const w=document.createElement("iframe");w.style.cssText="position:absolute; top:0; left:0; width:100%; height:100%; border:none;",g.appendChild(w);const x=document.createElement("div");x.className="stream-locked",x.style.cssText=`
    position: absolute; top:0; left:0; width:100%; height:100%;
    background: rgba(10,10,15,0.9);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
    color: var(--neon-pink);
    gap: 8px;
  `,x.innerHTML=`
    <div style="font-size:24px;"></div>
    <div style="font-size:12px; text-transform:uppercase; letter-spacing:1px;">${mt("streamLocked")}</div>
  `,g.appendChild(x);const c=[{id:"hd",label:"ISS Cam 1",videoId:"xRPjKQtRKT8",available:!0},{id:"std",label:"NASA TV",videoId:"21X5lGlDOfg",available:!0},{id:"cam2",label:"ISS Cam 2",videoId:"86YLFOog4GM",available:!0}];let R=c[0];const B=document.createElement("div");B.style.cssText=`
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    border-top: 1px solid var(--border);
  `;const W=ce=>{R=ce,ee()},ee=()=>{if(B.innerHTML="",c.forEach(ce=>{const Ie=document.createElement("button");if(Ie.className="btn-stream",Ie.style.cssText=`
        background: transparent;
        border: none;
        border-right: 1px solid var(--border);
        color: var(--muted);
        font-size: 10px;
        padding: 8px 4px;
        cursor: pointer;
        position: relative;
        transition: 0.2s;
        height: 100%;
      `,ce===c[c.length-1]&&(Ie.style.borderRight="none"),Ie.textContent=ce.label,ce.id===R.id&&(Ie.style.color="var(--neon-cyan)",Ie.style.background="rgba(0,243,255,0.1)"),!ce.available){Ie.style.opacity="0.5",Ie.style.cursor="not-allowed";const Ue=document.createElement("span");Ue.textContent="",Ue.style.marginRight="4px",Ie.prepend(Ue)}Ie.onclick=()=>{W(ce)},B.appendChild(Ie)}),R.available){x.style.display="none";const ce=`https://www.youtube.com/embed/${R.videoId}?autoplay=1&mute=1&controls=0&modestbranding=1&rel=0`;w.src!==ce&&(w.src=ce)}else x.style.display="flex",w.src=""};return a.appendChild(n),a.appendChild(g),a.appendChild(B),W(c[0]),{el:a}}function g3(){const a=document.createElement("div");a.className="auth-overlay",a.style.cssText=`
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(8px);
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
  `;const n=document.createElement("div");n.className="auth-modal hub-glass",n.style.cssText=`
    width: 100%;
    max-width: 400px;
    border-radius: 16px;
    padding: 24px;
    background: var(--panel);
    border: 1px solid var(--border);
    box-shadow: 0 0 40px var(--neon-glow);
  `;let o="login";function d(){const x=sl(),c={login:x==="tr"?"Giri Yap":"Sign In",signup:x==="tr"?"Kayt Ol":"Sign Up",reset:x==="tr"?"ifre Sfrla":"Reset Password",email:x==="tr"?"E-posta":"Email",password:x==="tr"?"ifre":"Password",name:x==="tr"?"Ad Soyad":"Full Name",submit:o==="login"?x==="tr"?"Giri":"Login":o==="signup"?x==="tr"?"Kayt Ol":"Sign Up":x==="tr"?"Gnder":"Send",switchToSignup:x==="tr"?"Hesabnz yok mu? Kayt olun":"Don't have an account? Sign up",switchToLogin:x==="tr"?"Zaten hesabnz var m? Giri yapn":"Already have an account? Sign in",forgotPassword:x==="tr"?"ifremi unuttum":"Forgot password",backToLogin:x==="tr"?" Giri ekranna dn":" Back to login",googleSignIn:x==="tr"?"Google ile devam et":"Continue with Google",or:x==="tr"?"veya":"or"};n.innerHTML=`
      <div class="auth-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 class="cyber-glitch-text" data-text="${c[o]}" style="margin: 0; color: var(--accent); font-size: 20px;">
          ${c[o]}
        </h2>
        <button class="auth-close btn" style="font-size: 24px; background: transparent; border: none; color: var(--muted); cursor: pointer;"></button>
      </div>

      <form class="auth-form" style="display: flex; flex-direction: column; gap: 12px;">
        ${o==="signup"?`
          <input type="text" name="name" placeholder="${c.name}" 
            style="padding: 12px 16px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: var(--text); font-size: 14px;"
          />
        `:""}
        
        <input type="email" name="email" placeholder="${c.email}" required
          style="padding: 12px 16px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: var(--text); font-size: 14px;"
        />
        
        ${o!=="reset"?`
          <input type="password" name="password" placeholder="${c.password}" required minlength="6"
            style="padding: 12px 16px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: var(--text); font-size: 14px;"
          />
        `:""}
        
        <div class="auth-error" style="color: #ff4444; font-size: 12px; min-height: 18px;"></div>
        
        <button type="submit" class="btn-primary" style="
          padding: 14px;
          border-radius: 8px;
          background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
          color: #000;
          font-weight: bold;
          font-size: 14px;
          border: none;
          cursor: pointer;
          transition: 0.3s;
        ">${c.submit}</button>
      </form>

      ${o!=="reset"?`
        <div style="text-align: center; margin: 16px 0; color: var(--muted); font-size: 12px;">
           ${c.or} 
        </div>
        
        <button class="btn-google" style="
          width: 100%;
          padding: 12px;
          border-radius: 8px;
          background: #fff;
          color: #333;
          font-size: 13px;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        ">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          ${c.googleSignIn}
        </button>
      `:""}

      <div style="margin-top: 16px; text-align: center; font-size: 12px;">
        ${o==="login"?`
          <a href="#" class="auth-switch" data-mode="signup" style="color: var(--accent); text-decoration: none;">
            ${c.switchToSignup}
          </a>
          <br><br>
          <a href="#" class="auth-switch" data-mode="reset" style="color: var(--muted); text-decoration: none;">
            ${c.forgotPassword}
          </a>
        `:o==="signup"?`
          <a href="#" class="auth-switch" data-mode="login" style="color: var(--accent); text-decoration: none;">
            ${c.switchToLogin}
          </a>
        `:`
          <a href="#" class="auth-switch" data-mode="login" style="color: var(--accent); text-decoration: none;">
            ${c.backToLogin}
          </a>
        `}
      </div>
    `,n.querySelector(".auth-close").onclick=w,n.querySelectorAll(".auth-switch").forEach(ee=>{ee.onclick=ce=>{ce.preventDefault(),o=ee.dataset.mode,d()}});const R=n.querySelector(".auth-form"),B=n.querySelector(".auth-error");R.onsubmit=async ee=>{var Q,qe,Ye;ee.preventDefault(),B.textContent="";const ce=R.email.value.trim(),Ie=((Q=R.password)==null?void 0:Q.value)||"",Ue=((Ye=(qe=R.name)==null?void 0:qe.value)==null?void 0:Ye.trim())||null;let ke;if(o==="login")ke=await QD(ce,Ie);else if(o==="signup")ke=await YD(ce,Ie,Ue);else if(o==="reset"&&(ke=await t3(ce),ke.success)){B.style.color="#00ff00",B.textContent=sl()==="tr"?"ifre sfrlama e-postas gnderildi":"Password reset email sent";return}ke.success?w():B.textContent=ke.error};const W=n.querySelector(".btn-google");W&&(W.onclick=async()=>{B.textContent="";const ee=await JD();ee.success?w():B.textContent=ee.error})}function g(x="login"){o=x,d(),a.style.display="flex"}function w(){a.style.display="none"}return a.onclick=x=>{x.target===a&&w()},a.appendChild(n),{el:a,open:g,close:w}}function _3(){const a=document.createElement("div");a.className="user-button-container",a.style.cssText="position: relative;";const n=document.createElement("button");n.className="btn user-btn",n.style.cssText=`
    font-size: 14px;
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    cursor: pointer;
  `;function o(d){if(d){const g=d.displayName||d.email.split("@")[0];n.innerHTML=`
        <span style="width: 24px; height: 24px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 12px; color: #000; font-weight: bold;">
          ${g.charAt(0).toUpperCase()}
        </span>
        <span style="max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${g}</span>
      `}else{const g=sl();n.innerHTML=`
        ${ss.user}
        <span>${g==="tr"?"Giri":"Login"}</span>
      `}}return oT(o),a.appendChild(n),{el:a,button:n}}function ma(a,n=2){return typeof a!="number"||Number.isNaN(a)?"--":a.toFixed(n)}function gb(a){return typeof a!="number"||Number.isNaN(a)?"--":String(Math.round(a))}function Bg(a){const n=Math.max(0,Math.floor(a));return n<10?`0${n}`:`${n}`}function _b(a){return Math.max(-85,Math.min(85,a))}function yb(a){let n=a;for(;n>180;)n-=360;for(;n<-180;)n+=360;return n}function Wn(a,n,o){const d=document.createElement(a);return n&&(d.className=n),o&&o.appendChild(d),d}const y3="isshub:skin";function v3(){const a=safeStorage.getItem(y3);return a==="cyberpunk"||a==="liquid"||a==="realistic"?a:"realistic"}function x3(a){var d,g,w,x,c,R,B,W,ee,ce,Ie,Ue,ke,Q,qe,Ye,Ge,ht,ct,ot,xe,se,ue,Ee,be,fe,pe;document.documentElement.setAttribute("data-skin",a);const o=window.issLights;if(o)try{a==="cyberpunk"?((w=(g=(d=o.sun)==null?void 0:d.color)==null?void 0:g.set)==null||w.call(g,16738047),(R=(c=(x=o.ambient)==null?void 0:x.color)==null?void 0:c.set)==null||R.call(c,65518),o.sun&&(o.sun.intensity=.6),o.ambient&&(o.ambient.intensity=.18),(ee=(W=(B=o.starsMat)==null?void 0:B.color)==null?void 0:W.set)==null||ee.call(W,16738047)):a==="liquid"?((Ue=(Ie=(ce=o.sun)==null?void 0:ce.color)==null?void 0:Ie.set)==null||Ue.call(Ie,16777215),(qe=(Q=(ke=o.ambient)==null?void 0:ke.color)==null?void 0:Q.set)==null||qe.call(Q,16777215),o.sun&&(o.sun.intensity=.85),o.ambient&&(o.ambient.intensity=.32),(ht=(Ge=(Ye=o.starsMat)==null?void 0:Ye.color)==null?void 0:Ge.set)==null||ht.call(Ge,16777215)):((xe=(ot=(ct=o.sun)==null?void 0:ct.color)==null?void 0:ot.set)==null||xe.call(ot,16774629),(Ee=(ue=(se=o.ambient)==null?void 0:se.color)==null?void 0:ue.set)==null||Ee.call(ue,16777215),o.sun&&(o.sun.intensity=.55),o.ambient&&(o.ambient.intensity=.14),(pe=(fe=(be=o.starsMat)==null?void 0:be.color)==null?void 0:fe.set)==null||pe.call(fe,16777215))}catch{}}const uT="isshub:place_v2";function b3(){try{const a=safeStorage.getItem(uT);if(!a)return null;const n=JSON.parse(a);return!n||typeof n!="object"?null:{cityName:typeof n.cityName=="string"?n.cityName:null,districtName:typeof n.districtName=="string"?n.districtName:null,neighborhoodName:typeof n.neighborhoodName=="string"?n.neighborhoodName:null,displayName:typeof n.displayName=="string"?n.displayName:null,osmType:typeof n.osmType=="string"?n.osmType:null,osmId:typeof n.osmId=="string"?n.osmId:null,lat:typeof n.lat=="number"?n.lat:null,lon:typeof n.lon=="number"?n.lon:null}}catch{return null}}function w3(a){try{safeStorage.setItem(uT,JSON.stringify(a))}catch{}}function ef(a){if(!a)return"Konumum";const n=[];return a.cityName&&n.push(a.cityName),a.districtName&&n.push(a.districtName),a.neighborhoodName&&n.push(a.neighborhoodName),n.join(" / ")||"Konumum"}function T3(){const a=((In==null?void 0:In.NOMINATIM_PROXY_URL)||"").trim();return a?a.replace(/\/+$/,""):"https://nominatim.openstreetmap.org"}async function vb(a,n){const o=T3(),d=new URL(o+a),g=new URLSearchParams({format:"jsonv2",addressdetails:"1",...n});In!=null&&In.NOMINATIM_EMAIL&&g.set("email",String(In.NOMINATIM_EMAIL)),d.search=g.toString();const w=await fetch(d.toString(),{cache:"no-store"});if(!w.ok)throw new Error(`nominatim http ${w.status}`);return await w.json()}function xb(a){const n=(a==null?void 0:a.address)||{},o=n.city||n.town||n.village||n.municipality||n.county||n.state||null,d=n.city_district||n.district||n.borough||n.county||n.state_district||null,g=n.neighbourhood||n.suburb||n.quarter||n.hamlet||null,w=(a==null?void 0:a.lat)!=null?Number(a.lat):null,x=(a==null?void 0:a.lon)!=null?Number(a.lon):null,c=a!=null&&a.osm_type?String(a.osm_type):null,R=(a==null?void 0:a.osm_id)!=null?String(a.osm_id):null;return{cityName:o,districtName:d,neighborhoodName:g,displayName:a!=null&&a.display_name?String(a.display_name):null,osmType:c,osmId:R,lat:Number.isFinite(w)?w:null,lon:Number.isFinite(x)?x:null}}async function E3({timeoutMs:a=9e3}={}){if(!navigator.geolocation)throw new Error("geolocation not supported");return await new Promise((n,o)=>{const d=setTimeout(()=>o(new Error("timeout")),a);navigator.geolocation.getCurrentPosition(g=>{clearTimeout(d),n({lat:Number(g.coords.latitude),lon:Number(g.coords.longitude),accuracy:Number(g.coords.accuracy)})},g=>{clearTimeout(d),o(g||new Error("geolocation error"))},{enableHighAccuracy:!0,maximumAge:15e3,timeout:a})})}async function I3(a,n){if(!n)throw new Error("rootEl missing");try{const Re=await qI();console.log(`[boot] Language initialized: ${Re}`)}catch(Re){console.warn("[boot] i18n initialization failed:",Re)}n.innerHTML="";const o=Wn("div","hub",n),d=Wn("div","hub-map",o);d.id="map";const g=Wn("div","hub-overlay",o),w=Wn("div","hub-topbar hub-glass",g),x=Wn("div","hub-brand",w);Wn("div","hub-logo",x).setAttribute("aria-hidden","true");const R=Wn("div","hub-title",x),B=Wn("div","t",R);B.textContent="ISS Tracker HUB";const W=Wn("div","s",R);W.textContent="beta";const ee=Wn("div","hub-actions",w),ce=Wn("div","hub-pill",ee),Ie=Wn("div","hub-dot",ce),Ue=Wn("div","",ce);Ue.textContent=mt("follow")+": "+mt("on");const ke=Wn("button","btn settings-btn",ee);ke.type="button",ke.innerHTML=ss.settings,ke.title=mt("settings"),ke.setAttribute("aria-label",mt("settings")),ke.style.cssText="font-size: 18px; padding: 8px 12px;";const Q=l3({onOpenLocation:()=>de()});n.appendChild(Q.el),ke.addEventListener("click",()=>{Q.open()});const qe=g3();n.appendChild(qe.el);const Ye=_3();ee.insertBefore(Ye.el,ke),Ye.button.addEventListener("click",()=>{sT()?confirm(mt("authLogout")+"?")&&e3():qe.open("login")});const Ge=KI();n.appendChild(Ge.el);const ht=c3();n.appendChild(ht.el);const ct=Ge.getLogFn(),ot=Wn("div","hub-ver",g),xe=Wn("div","pass-section",g);xe.id="pass-section",xe.style.cssText=`
    position: fixed;
    bottom: 80px;
    right: 20px;
    max-width: 400px;
    width: calc(100% - 40px);
    z-index: 100;
    display: none;
  `;const se=p3();xe.appendChild(se.el),ot.textContent=In==null?void 0:In.VERSION;const ue=Wn("div","nasa-section",g);ue.id="nasa-section",ue.style.cssText=`
    position: fixed;
    bottom: 80px;
    left: 20px;
    right: 20px;
    max-width: 500px;
    z-index: 100;
    display: none;
  `;const Ee=m3();ue.appendChild(Ee.el);const be=Wn("div","nasa-note",ue);be.style.cssText=`
    font-size: 10px;
    color: var(--muted);
    text-align: center;
    padding: 8px;
    opacity: 0.7;
  `,be.textContent=" ISS sinyal durumuna gre canl yaynda kesintiler olabilir.";const fe={cityName:"Konumum",districtName:null,neighborhoodName:null,obsLat:null,obsLon:null,prediction:null,lastPredictionRefresh:0,predictionBusy:!1,lastTelemetryLogAt:0,lastTelemetryAt:0,lastIssLat:null,lastIssLon:null};function pe(Re){if(!Re){fe.prediction=null;return}const rt=Number(Re.maxElev),Tt=!!Re.visible,yt=Number(In==null?void 0:In.MIN_ELEVATION);fe.prediction={aosMs:Number(Re.aosMs),losMs:Number(Re.losMs),maxElevDeg:Number.isFinite(rt)?rt:0,visible:Tt,reason:Tt?"":`MAX ${Math.round(rt)} < ${yt}`,hint:""}}const Jt=u3({getPassState:()=>({loading:fe.predictionBusy,calculating:fe.predictionBusy,pass:fe.prediction,hasLocation:Number.isFinite(fe.obsLat)&&Number.isFinite(fe.obsLon),error:!1}),onShowPass:()=>{const Re=document.getElementById("pass-section");Re&&Re.style.display!=="none"?(Re.scrollIntoView({behavior:"smooth",block:"start"}),Re.classList.add("highlight"),setTimeout(()=>Re.classList.remove("highlight"),2e3),console.log("[Hero] Show Pass - scrolled to pass card")):console.log("[Hero] Show Pass - card not visible yet")},onLiveTrack:()=>{Et(!0),console.log("[Hero] Live Track clicked")}});Jt.el&&n.appendChild(Jt.el);async function fn({forceLog:Re=!1}={}){const rt=fe.obsLat,Tt=fe.obsLon;if(!Number.isFinite(rt)||!Number.isFinite(Tt)){Re&&ct(mt("passNoLocation"));return}if(!fe.predictionBusy){fe.predictionBusy=!0;try{ct(mt("passCalculating")+` (obs=${ma(rt,3)},${ma(Tt,3)})`);const yt=await yI({obsLat:rt,obsLon:Tt}),je=(yt==null?void 0:yt.nextPass)||null;pe(je),fe.lastPredictionRefresh=Date.now(),ct(je?`pass> bulundu: AOS=${new Date(je.aosMs).toLocaleTimeString()} LOS=${new Date(je.losMs).toLocaleTimeString()} MAX=${Math.round(je.maxElev)} ${je.visible?"":""}`:mt("passNotFound"))}catch(yt){ct(mt("passError")+`: ${String((yt==null?void 0:yt.message)||yt)}`),fe.prediction=null}finally{fe.predictionBusy=!1}}}function Ut(){const Re=fe.prediction;if(Re&&Re.aosMs){xe.style.display="block";const rt=Date.now(),Tt=Re.aosMs-rt,yt=Math.max(0,Math.floor(Tt/1e3)),je=Math.floor(yt/3600),Qt=Math.floor(yt%3600/60),Nn=yt%60,cr=`${String(je).padStart(2,"0")}:${String(Qt).padStart(2,"0")}:${String(Nn).padStart(2,"0")}`;se.setState({nextPass:Re,nextVisiblePass:Re.visible?Re:null,countdownText:cr})}else xe.style.display="none"}const $t=GE(d,{center:(In==null?void 0:In.DEFAULT_CENTER)||[35,39],zoom:(In==null?void 0:In.DEFAULT_ZOOM)||4}),{map:mn,issMarker:Pt}=$t;let zn=!0,on=0,Ft=CI(),Gt=null,Mn=!1,wt=null;function Et(Re){if(zn=!!Re,Ie.style.opacity=Re?"1":"0.35",Ue.textContent=mt(Re?"followActive":"followInactive"),ce.style.opacity=Re?"1":"0.85",Ft==="3d"&&Gt)try{Re?Gt.startFollow():Gt.stopFollow()}catch(rt){console.warn("Globe follow control error:",rt)}}Et(!0),ce.style.cursor="pointer",ce.addEventListener("click",()=>Et(!zn));async function Cn(){if(Gt||Mn)return Gt;Mn=!0;try{return Gt=await(await UE(()=>import("./globeView-Dw6YFlPo.js").then(rt=>rt.dI),[])).createGlobe(n),x3(v3()),Gt}catch(Re){ct(mt("globeLoadFailed")+`: ${(Re==null?void 0:Re.message)||Re}`);try{Gt==null||Gt.setVisible(!1)}catch{}return Gt=null,null}finally{Mn=!1}}function Wt(Re){if(Ft=Re==="3d"?"3d":"2d",d.style.display=Ft==="2d"?"block":"none",Ft==="3d")Cn().then(rt=>{if(!rt){d.style.display="block";try{wt==null||wt.setMode("2d")}catch{}return}if(rt.setVisible(!0),Number.isFinite(fe.lastIssLat)&&Number.isFinite(fe.lastIssLon))try{rt.setIssPosition(fe.lastIssLat,fe.lastIssLon)}catch{}if(zn)try{rt.startFollow()}catch{}try{window._applyTrajectoryToGlobe&&window._applyTrajectoryToGlobe()}catch{}}).catch(rt=>{ct(mt("globeError")+`: ${(rt==null?void 0:rt.message)||rt}`),d.style.display="block";try{wt==null||wt.setMode("2d")}catch{}});else{try{Gt==null||Gt.setVisible(!1)}catch{}try{Gt==null||Gt.stopFollow()}catch{}}}const Sn=MI({initialMode:Ft,onChange:Re=>Wt(Re)});wt=Sn,n.appendChild(Sn.el),Wt(Ft);const Kt=RI();n.appendChild(Kt.el);let or=0;async function Tn(Re,rt){const Tt=Date.now(),yt=Number(In==null?void 0:In.INTERVAL_WEATHER_REFRESH_MS);if(!(Tt-or<yt)){or=Tt;try{const je=await DI({lat:Re,lon:rt}),Qt=LI(je.code),Nn=je.timeIso?je.timeIso.replace("T"," "):null;Kt.setState({placeLabel:`ISS alt (${ma(Re,1)}, ${ma(rt,1)})`,tempC:je.tempC,windKmh:je.windKmh,codeLabel:Qt,timeLabel:Nn})}catch{Kt.setState({placeLabel:"ISS alt",tempC:NaN,windKmh:NaN,codeLabel:"Hava alnamad",timeLabel:null})}}}a&&typeof a=="object"&&(a.actions||(a.actions={}),a.actions.openCityPicker=()=>de());const Dn=Wn("div","loc-overlay",n),Nt=Wn("div","loc-card hub-glass",Dn),en=Wn("div","loc-top",Nt),Pn=Wn("div","loc-title",en);Pn.textContent=mt("locationModalTitle");const Lt=Wn("button","btn",en);Lt.type="button",Lt.textContent=mt("close");const jt=Wn("div","loc-body",Nt),Vt=Wn("div","",jt);Vt.style.fontWeight="900",Vt.style.opacity="0.9",Vt.textContent=mt("locationModalDesc");const Mt=Wn("div","loc-row",jt),rn=Wn("button","btn",Mt);rn.type="button",rn.textContent=mt("useMyLocation");const dn=Wn("button","btn",Mt);dn.type="button",dn.textContent=mt("searchLocation");const _n=Wn("input","loc-search",jt);_n.type="search",_n.placeholder=mt("searchPlaceholder"),_n.disabled=!0;const Yt=Wn("div","loc-list",jt);Yt.style.opacity="0.6";const Xt=Wn("div","loc-picked",jt);Xt.textContent=mt("selection")+": ";const Ae=Wn("span","small",Xt);Ae.textContent="";const H=Wn("div","loc-row",jt),G=Wn("button","btn",H);G.type="button",G.textContent=mt("save"),G.disabled=!0;let K=null;function de(){Dn.style.display="flex"}function ge(){Dn.style.display="none"}Lt.addEventListener("click",ge),Dn.addEventListener("click",Re=>{Re.target===Dn&&ge()});function N(Re){if(K=Re,!Re){Xt.firstChild.textContent=`${mt("selection")}: `,Ae.textContent="",G.disabled=!0;return}Xt.firstChild.textContent=`${mt("selection")}: ${ef(Re)||""}`,Ae.textContent=Re.displayName?Re.displayName:"",G.disabled=!(Re.lat!=null&&Re.lon!=null)}function Se(Re){Yt.innerHTML="",Yt.style.opacity="1";const rt=(Re||"").trim().toLowerCase(),Tt=HE.filter(yt=>rt?yt.name.toLowerCase().includes(rt):!0).slice(0,40);for(const yt of Tt){const je=document.createElement("button");je.type="button",je.className="btn",je.style.textAlign="left",je.style.padding="10px 12px",je.style.borderRadius="14px",je.textContent=yt.name,je.addEventListener("click",()=>{N({cityName:yt.name,districtName:null,neighborhoodName:null,displayName:yt.name,osmType:"fallback",osmId:`tr-city:${yt.name}`,lat:Number(yt.lat),lon:Number(yt.lon)})}),Yt.appendChild(je)}}function we(Re){if(Yt.innerHTML="",Yt.style.opacity="1",!Array.isArray(Re)||Re.length===0){const rt=document.createElement("div");rt.style.opacity="0.85",rt.style.fontWeight="900",rt.style.fontSize="13px",rt.textContent=mt("noResults"),Yt.appendChild(rt);return}for(const rt of Re){const Tt=xb(rt),yt=document.createElement("button");yt.type="button",yt.className="btn",yt.style.textAlign="left",yt.style.padding="10px 12px",yt.style.borderRadius="14px",yt.textContent=Tt.displayName||ef(Tt)||"",yt.addEventListener("click",()=>N(Tt)),Yt.appendChild(yt)}}let Me=null;async function He(Re){try{const rt=await vb("/search",{q:Re,limit:"12"});we(rt)}catch(rt){ct(mt("locSearchFailed")+`: ${String((rt==null?void 0:rt.message)||rt)}`),Se(Re)}}_n.addEventListener("input",()=>{const Re=(_n.value||"").trim();if(Me&&clearTimeout(Me),Re.length<3){Yt.innerHTML="",Yt.style.opacity="0.6",N(null);return}Me=setTimeout(()=>He(Re),250)}),dn.addEventListener("click",()=>{_n.disabled=!1,_n.focus(),Yt.innerHTML="",Yt.style.opacity="0.6",N(null)}),rn.addEventListener("click",async()=>{try{ct(mt("locGpsRequesting"));const Re=await E3({timeoutMs:9e3}),rt=await vb("/reverse",{lat:String(Re.lat),lon:String(Re.lon),zoom:"18"}),Tt=xb(rt);if(!Tt||Tt.lat==null||Tt.lon==null)throw new Error("reverse empty");N(Tt),G.disabled=!1,ct(mt("locGpsSuccess")+`: ${ef(Tt)}`)}catch(Re){ct(mt("locGpsFailed")+` (${String((Re==null?void 0:Re.message)||Re)})`),_n.disabled=!1,_n.focus()}}),G.addEventListener("click",async()=>{K&&(w3({cityName:K.cityName||null,districtName:K.districtName||null,neighborhoodName:K.neighborhoodName||null,displayName:K.displayName||null,osmType:K.osmType||null,osmId:K.osmId||null,lat:K.lat,lon:K.lon}),fe.cityName=K.cityName||"Konumum",fe.districtName=K.districtName||null,fe.neighborhoodName=K.neighborhoodName||null,fe.obsLat=Number(K.lat),fe.obsLon=Number(K.lon),ct(mt("locSaved")+`: ${ef(K)}`),ge(),await fn({forceLog:!0}),Ut())});const Le=b3();(Le!=null&&Le.cityName||Le!=null&&Le.displayName)&&(fe.cityName=Le.cityName||"Konumum",fe.districtName=Le.districtName||null,fe.neighborhoodName=Le.neighborhoodName||null,fe.obsLat=Number.isFinite(Le.lat)?Le.lat:null,fe.obsLon=Number.isFinite(Le.lon)?Le.lon:null);let tt=null;function gt(){tt&&clearInterval(tt),tt=setInterval(()=>{Ut();const Re=Date.now(),rt=Number(In==null?void 0:In.INTERVAL_PREDICTION_REFRESH);Re-fe.lastPredictionRefresh>rt&&!fe.predictionBusy&&fn().then(()=>Ut())},Number((In==null?void 0:In.INTERVAL_UI_TICK)??1e3))}function It({lat:Re,lng:rt,alt:Tt}){if($t.updateISSPosition(Re,rt),Ft==="3d"&&Gt)try{Gt.setIssPosition(Re,rt)}catch{}if(zn){const yt=Date.now(),je=Number(In==null?void 0:In.FOLLOW_PAN_INTERVAL_MS);yt-on>=je&&(on=yt,$t.panTo(Re,rt,mn.getZoom()))}}function Ht(Re){ht.markDataReceived(),Ge.update({altitude:Re.altKm,velocity:Re.velKmh,latitude:Re.lat,longitude:Re.lon,visibility:"daylight"}),fe.lastIssLat=Re.lat,fe.lastIssLon=Re.lon,fe.lastTelemetryAt=Re.ts,Tn(Re.lat,Re.lon);const rt=Number(In==null?void 0:In.TERMINAL_TELEMETRY_LOG_INTERVAL_MS),Tt=Date.now();Tt-fe.lastTelemetryLogAt>=rt&&(fe.lastTelemetryLogAt=Tt,ct(`[ISS]  ${Re.source}: lat=${ma(Re.lat,2)} lon=${ma(Re.lon,2)} alt=${gb(Re.altKm)}km v=${gb(Re.velKmh)}`)),!fe.prediction&&Number.isFinite(fe.obsLat)&&fn().catch(()=>{})}R0({onPosition:It,onData:Ht}),Ut(),gt();let zt=0,Ce=null;async function tn(){var Re,rt,Tt,yt;try{const je=Date.now();if(je-zt<3*60*1e3)return;zt=je,ct("[Trajectory] Hesaplanyor...");const Qt=await vI({pastMinutes:45,futureMinutes:90,stepSeconds:30});console.log("[Trajectory] Raw data:",Qt),Ce=Qt;const Nn=P0(Qt.past),cr=P0(Qt.future);console.log("[Trajectory] Past GeoJSON features:",((rt=(Re=Nn==null?void 0:Nn.geometry)==null?void 0:Re.coordinates)==null?void 0:rt.length)||0),console.log("[Trajectory] Future GeoJSON features:",((yt=(Tt=cr==null?void 0:cr.geometry)==null?void 0:Tt.coordinates)==null?void 0:yt.length)||0),$t&&$t.updateTrajectory?$t.updateTrajectory(Nn,cr):console.warn("[Trajectory] mapView or updateTrajectory not available"),Gt&&Gt.updateTrajectory&&Gt.updateTrajectory(Qt.past,Qt.future),ct(`[Trajectory]  ${Qt.past.length} gemi + ${Qt.future.length} gelecek nokta`)}catch(je){console.error("[Trajectory] Error:",je),ct(mt("trajectoryError")+`: ${(je==null?void 0:je.message)||je}`)}}function Rn(){Ce&&Gt&&Gt.updateTrajectory&&(Gt.updateTrajectory(Ce.past,Ce.future),console.log("[Trajectory] Applied to 3D Globe"))}window._applyTrajectoryToGlobe=Rn,$t&&$t.map&&($t.map.loaded()?(console.log("[Trajectory] Map already loaded, calculating immediately..."),tn()):$t.map.once("load",()=>{console.log("[Trajectory] Map loaded, calculating initial trajectory..."),tn()})),setInterval(()=>{tn()},5*60*1e3),R0({onPosition:Re=>{const rt=_b(Re.lat),Tt=yb(Re.lng);if(Ft==="3d"&&Gt)try{Gt.setIssPosition(rt,Tt)}catch{}fe.lastIssLat=rt,fe.lastIssLon=Tt},onData:Re=>{if(!Re)return;const rt=_b(Re.lat),Tt=yb(Re.lon);Ft==="2d"&&$t.updateISSPosition(rt,Tt),Ge.update({altitude:Re.altKm,velocity:Re.velKmh||27580,latitude:Re.lat,longitude:Re.lon,visibility:"daylight"});const yt=new Date;`${Bg(yt.getHours())}${Bg(yt.getMinutes())}${Bg(yt.getSeconds())}${Re.source}`;const je=Number(In==null?void 0:In.TERMINAL_TELEMETRY_LOG_INTERVAL_MS),Qt=Date.now();if(Qt-fe.lastTelemetryLogAt>=je&&(fe.lastTelemetryLogAt=Qt,ct(`ISS lat=${ma(Re.lat,2)} lon=${ma(Re.lon,2)} alt=${ma(Re.altKm,1)}km [${Re.source}]`)),Tn(Re.lat,Re.lon),zn&&Ft==="2d"){const Nn=Date.now(),cr=Number(In==null?void 0:In.FOLLOW_PAN_INTERVAL_MS);Nn-on>=cr&&(on=Nn,$t.panTo(Re.lat,Re.lon,4))}}}),ct("[Motion]  Motion system started (2D: native sticky, 3D: 60fps lerp)");const Rt=f3({onChange:Re=>{document.body.setAttribute("data-mobile-view",Re),ue.style.display=Re==="nasa"?"block":"none",xe.style.display=Re==="passes"?"block":"none",Ge.el.style.display=Re==="telemetry"?"flex":"none"},onSettings:()=>Q.open()});n.appendChild(Rt.el),document.body.classList.add("mobile-mode"),document.body.setAttribute("data-mobile-view","map"),ct(mt("bootReady")),setTimeout(()=>{jI(Re=>{ct(mt("locationSet")+`: ${Re.displayName}`),Re.lat&&Re.lon},()=>{de()})},1e3)}const Xa={LIGHT:"light",DARK:"dark",SYSTEM:"system"},xu={CYAN:{name:"Neon Cyan",accent:"#00f3ff",accentSecondary:"#00b4d8",glow:"rgba(0, 243, 255, 0.5)"},PINK:{name:"Neon Pink",accent:"#ff00ff",accentSecondary:"#ff69b4",glow:"rgba(255, 0, 255, 0.5)"},GREEN:{name:"Matrix Green",accent:"#0aff00",accentSecondary:"#00cc00",glow:"rgba(10, 255, 0, 0.5)"},PURPLE:{name:"Cyber Purple",accent:"#bd00ff",accentSecondary:"#9933ff",glow:"rgba(189, 0, 255, 0.5)"},ORANGE:{name:"Sunset Orange",accent:"#ff6b00",accentSecondary:"#ff9500",glow:"rgba(255, 107, 0, 0.5)"}};class S3{constructor(){this.currentMode=Xa.DARK,this.currentPalette="CYAN",this.listeners=[]}init(){const n=localStorage.getItem("iss-theme-mode"),o=localStorage.getItem("iss-color-palette");n&&Object.values(Xa).includes(n)&&(this.currentMode=n),o&&xu[o]&&(this.currentPalette=o),this.applyTheme(),this.applyPalette(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",d=>{this.currentMode===Xa.SYSTEM&&this.applyTheme()}),console.log("[ThemeManager] Initialized:",this.currentMode,this.currentPalette)}setMode(n){Object.values(Xa).includes(n)&&(this.currentMode=n,localStorage.setItem("iss-theme-mode",n),this.applyTheme(),this.notifyListeners())}setPalette(n){xu[n]&&(this.currentPalette=n,localStorage.setItem("iss-color-palette",n),this.applyPalette(),this.notifyListeners())}getEffectiveTheme(){var n;return this.currentMode===Xa.SYSTEM?(n=window.matchMedia)!=null&&n.call(window,"(prefers-color-scheme: dark)").matches?Xa.DARK:Xa.LIGHT:this.currentMode}applyTheme(){const n=this.getEffectiveTheme();document.documentElement.setAttribute("data-theme",n),document.body.classList.add("theme-transitioning"),setTimeout(()=>{document.body.classList.remove("theme-transitioning")},300)}applyPalette(){const n=xu[this.currentPalette];if(!n)return;const o=document.documentElement;o.style.setProperty("--accent",n.accent),o.style.setProperty("--accent-secondary",n.accentSecondary),o.style.setProperty("--neon-glow",n.glow),o.style.setProperty("--border",`${n.accent}40`),o.style.setProperty("--ring",`${n.accent}26`)}onThemeChange(n){return this.listeners.push(n),()=>{this.listeners=this.listeners.filter(o=>o!==n)}}notifyListeners(){this.listeners.forEach(n=>n({mode:this.currentMode,effectiveTheme:this.getEffectiveTheme(),palette:this.currentPalette,paletteData:xu[this.currentPalette]}))}getAvailablePalettes(){return Object.entries(xu).map(([n,o])=>({key:n,...o}))}getAvailableModes(){return Object.values(Xa)}getCurrentTheme(){return{mode:this.currentMode,effectiveTheme:this.getEffectiveTheme(),palette:this.currentPalette,paletteData:xu[this.currentPalette]}}}const hT=new S3;hT.init();console.log("[ISS Tracker] Theme initialized:",hT.getCurrentTheme());const P3=NE(),A3=document.getElementById("app");I3(P3,A3);export{UE as _,jE as c,qE as g};
