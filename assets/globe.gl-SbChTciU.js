import{O as Xh,V as gt,M as hn,a as we,C as Lg,G as Ms,b as pn,S as Wo,c as cs,F as $x,d as ao,T as Fg,e as $A,B as oi,f as Go,w as Be,H as rr,N as Ea,P as sN,g as Kh,h as cn,i as Pe,j as xn,R as Qo,L as Hi,k as Gi,l as Vt,m as oN,n as mr,o as iA,D as vi,W as q0,p as ds,q as aN,r as jx,s as lN,t as Og,A as Hx,u as uN,v as AN,x as cN,y as hN,z as fN,E as dN,I as pN,J as mN,K as Zh,Q as Ig,U as $i,X as kg,Y as uy,Z as Gn,_ as yA,$ as gN,a0 as _N,a1 as ni,a2 as Io,a3 as Fn,a4 as ko,a5 as Uo,a6 as sA,a7 as qs,a8 as No,a9 as Wx,aa as Hl,ab as yN,ac as Ug,ad as qg,ae as Up,af as Gg,ag as Vg,ah as Na,ai as ht,aj as jA,ak as zg,al as Jh,am as Vo,an as vN,ao as G0,ap as wr,aq as ef,ar as vA,as as tf,at as Fa,au as qp,av as xA,aw as Qx,ax as ki,ay as Yx,az as Xx,aA as Kx,aB as Zx,aC as Jx,aD as nf,aE as eb,aF as tb,aG as Ay,aH as Wl,aI as mi,aJ as xN,aK as nb,aL as rb,aM as ib,aN as sb,aO as ob,aP as ab,aQ as lb,aR as ub,aS as Ab,aT as cb,aU as hb,aV as fb,aW as bN,aX as TN,aY as wN,aZ as Ql,a_ as V0,a$ as z0,b0 as $0,b1 as js,b2 as db,b3 as pb,b4 as mb,b5 as gb,b6 as _b,b7 as yb,b8 as vb,b9 as xb,ba as SN,bb as EN,bc as bb,bd as Tb,be as oA,bf as aA,bg as Rl,bh as NN,bi as $g,bj as jg,bk as Hg,bl as zs,bm as Wg,bn as Qg,bo as m0,bp as g0,bq as _0,br as y0,bs as cy,bt as hy,bu as fy,bv as dy,bw as Gp,bx as Vp,by as zp,bz as $p,bA as jp,bB as j0,bC as Hp,bD as Wp,bE as Qp,bF as Yp,bG as Xp,bH as Kp,bI as Zp,bJ as Jp,bK as em,bL as tm,bM as nm,bN as rm,bO as im,bP as sm,bQ as om,bR as am,bS as lm,bT as um,bU as H0,bV as Am,bW as wb,bX as Sb,bY as RN,bZ as CN,b_ as MN,b$ as PN,c0 as BN,c1 as rf,c2 as DN,c3 as Eb,c4 as LN,c5 as FN,c6 as ON,c7 as IN,c8 as kN,c9 as UN,ca as Nb,cb as Yl,cc as qN,cd as GN,ce as VN,cf as zN,cg as $N,ch as jN,ci as HN,cj as WN,ck as QN,cl as YN,cm as XN,cn as KN,co as ZN,cp as JN,cq as eR,cr as tR,cs as nR,ct as rR,cu as Rb,cv as iR,cw as sR,cx as oR,cy as aR,cz as lR,cA as uR,cB as Cb,cC as AR,cD as bA,cE as cR,cF as Yg,cG as hR,cH as v0,cI as Xg,cJ as W0,cK as Q0,cL as Pd,cM as Bd,cN as fR,cO as dR,cP as Y0,cQ as Kg,cR as Ol,cS as pR,cT as Mb,cU as Il,cV as Ra,cW as mR,cX as gR,cY as _R,cZ as yR,c_ as vR,c$ as sf,d0 as Xl,d1 as x0,d2 as Zg,d3 as b0,d4 as xR,d5 as bR,d6 as TR,d7 as Pb,d8 as Jg,d9 as e1,da as wR,db as SR,dc as ER,dd as Bb,de as NR,df as wu,dg as t1,dh as xi,di as Cl,dj as py,dk as RR,dl as CR,dm as Db,dn as MR,dp as PR}from"./globeView-JMDs5gVg.js";import{g as BR}from"./index-CDZYWXLb.js";class DR extends Xh{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new gt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element&&t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const ol=new we,my=new hn,gy=new hn,_y=new we,yy=new we;class LR{constructor(e={}){const t=this;let r,i,s,o;const a={objects:new WeakMap},c=e.element!==void 0?e.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.sortObjects=!0,this.getSize=function(){return{width:r,height:i}},this.render=function(T,S){T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),S.parent===null&&S.matrixWorldAutoUpdate===!0&&S.updateMatrixWorld(),my.copy(S.matrixWorldInverse),gy.multiplyMatrices(S.projectionMatrix,my),p(T,T,S),this.sortObjects&&b(T)},this.setSize=function(T,S){r=T,i=S,s=r/2,o=i/2,c.style.width=T+"px",c.style.height=S+"px"};function f(T){T.isCSS2DObject&&(T.element.style.display="none");for(let S=0,N=T.children.length;S<N;S++)f(T.children[S])}function p(T,S,N){if(T.visible===!1){f(T);return}if(T.isCSS2DObject){ol.setFromMatrixPosition(T.matrixWorld),ol.applyMatrix4(gy);const C=ol.z>=-1&&ol.z<=1&&T.layers.test(N.layers)===!0,P=T.element;P.style.display=C===!0?"":"none",C===!0&&(T.onBeforeRender(t,S,N),P.style.transform="translate("+-100*T.center.x+"%,"+-100*T.center.y+"%)translate("+(ol.x*s+s)+"px,"+(-ol.y*o+o)+"px)",P.parentNode!==c&&c.appendChild(P),T.onAfterRender(t,S,N));const B={distanceToCameraSquared:g(N,T)};a.objects.set(T,B)}for(let C=0,P=T.children.length;C<P;C++)p(T.children[C],S,N)}function g(T,S){return _y.setFromMatrixPosition(T.matrixWorld),yy.setFromMatrixPosition(S.matrixWorld),_y.distanceToSquared(yy)}function v(T){const S=[];return T.traverseVisible(function(N){N.isCSS2DObject&&S.push(N)}),S}function b(T){const S=v(T).sort(function(C,P){if(C.renderOrder!==P.renderOrder)return P.renderOrder-C.renderOrder;const B=a.objects.get(C).distanceToCameraSquared,F=a.objects.get(P).distanceToCameraSquared;return B-F}),N=S.length;for(let C=0,P=S.length;C<P;C++)S[C].element.style.zIndex=N-C}}}function cm(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var FR=typeof global=="object"&&global&&global.Object===Object&&global,OR=typeof self=="object"&&self&&self.Object===Object&&self,Lb=FR||OR||Function("return this")(),Dd=function(){return Lb.Date.now()},IR=/\s/;function kR(n){for(var e=n.length;e--&&IR.test(n.charAt(e)););return e}var UR=/^\s+/;function qR(n){return n&&n.slice(0,kR(n)+1).replace(UR,"")}var X0=Lb.Symbol,Fb=Object.prototype,GR=Fb.hasOwnProperty,VR=Fb.toString,Su=X0?X0.toStringTag:void 0;function zR(n){var e=GR.call(n,Su),t=n[Su];try{n[Su]=void 0;var r=!0}catch{}var i=VR.call(n);return r&&(e?n[Su]=t:delete n[Su]),i}var $R=Object.prototype,jR=$R.toString;function HR(n){return jR.call(n)}var WR="[object Null]",QR="[object Undefined]",vy=X0?X0.toStringTag:void 0;function YR(n){return n==null?n===void 0?QR:WR:vy&&vy in Object(n)?zR(n):HR(n)}function XR(n){return n!=null&&typeof n=="object"}var KR="[object Symbol]";function ZR(n){return typeof n=="symbol"||XR(n)&&YR(n)==KR}var xy=NaN,JR=/^[-+]0x[0-9a-f]+$/i,eC=/^0b[01]+$/i,tC=/^0o[0-7]+$/i,nC=parseInt;function by(n){if(typeof n=="number")return n;if(ZR(n))return xy;if(cm(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=cm(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=qR(n);var t=eC.test(n);return t||tC.test(n)?nC(n.slice(2),t?2:8):JR.test(n)?xy:+n}var rC="Expected a function",iC=Math.max,sC=Math.min;function oC(n,e,t){var r,i,s,o,a,c,f=0,p=!1,g=!1,v=!0;if(typeof n!="function")throw new TypeError(rC);e=by(e)||0,cm(t)&&(p=!!t.leading,g="maxWait"in t,s=g?iC(by(t.maxWait)||0,e):s,v="trailing"in t?!!t.trailing:v);function b(I){var U=r,G=i;return r=i=void 0,f=I,o=n.apply(G,U),o}function T(I){return f=I,a=setTimeout(C,e),p?b(I):o}function S(I){var U=I-c,G=I-f,H=e-U;return g?sC(H,s-G):H}function N(I){var U=I-c,G=I-f;return c===void 0||U>=e||U<0||g&&G>=s}function C(){var I=Dd();if(N(I))return P(I);a=setTimeout(C,S(I))}function P(I){return a=void 0,v&&r?b(I):(r=i=void 0,o)}function B(){a!==void 0&&clearTimeout(a),f=0,r=c=i=a=void 0}function F(){return a===void 0?o:P(Dd())}function q(){var I=Dd(),U=N(I);if(r=arguments,i=this,c=I,U){if(a===void 0)return T(c);if(g)return clearTimeout(a),a=setTimeout(C,e),b(c)}return a===void 0&&(a=setTimeout(C,e)),o}return q.cancel=B,q.flush=F,q}function Ty(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function aC(n){if(Array.isArray(n))return n}function lC(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function uC(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function AC(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function cC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hC(n,e){return aC(n)||AC(n,e)||fC(n,e)||cC()}function fC(n,e){if(n){if(typeof n=="string")return Ty(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Ty(n,e):void 0}}var dC=uC(function n(e,t){var r=t.default,i=r===void 0?null:r,s=t.triggerUpdate,o=s===void 0?!0:s,a=t.onChange,c=a===void 0?function(f,p){}:a;lC(this,n),this.name=e,this.defaultVal=i,this.triggerUpdate=o,this.onChange=c});function Vn(n){var e=n.stateInit,t=e===void 0?function(){return{}}:e,r=n.props,i=r===void 0?{}:r,s=n.methods,o=s===void 0?{}:s,a=n.aliases,c=a===void 0?{}:a,f=n.init,p=f===void 0?function(){}:f,g=n.update,v=g===void 0?function(){}:g,b=Object.keys(i).map(function(T){return new dC(T,i[T])});return function T(){for(var S=arguments.length,N=new Array(S),C=0;C<S;C++)N[C]=arguments[C];var P=!!(this instanceof T&&this.constructor),B=P?N.shift():void 0,F=N[0],q=F===void 0?{}:F,I=Object.assign({},t instanceof Function?t(q):t,{initialised:!1}),U={};function G(W){return H(W,q),te(),G}var H=function(Z,re){p.call(G,Z,I,re),I.initialised=!0},te=oC(function(){I.initialised&&(v.call(G,I,U),U={})},1);return b.forEach(function(W){G[W.name]=Z(W);function Z(re){var oe=re.name,Y=re.triggerUpdate,ae=Y===void 0?!1:Y,he=re.onChange,be=he===void 0?function(Ue,Je){}:he,pe=re.defaultVal,Le=pe===void 0?null:pe;return function(Ue){var Je=I[oe];if(!arguments.length)return Je;var st=Ue===void 0?Le:Ue;return I[oe]=st,be.call(G,st,I,Je),!U.hasOwnProperty(oe)&&(U[oe]=Je),ae&&te(),G}}}),Object.keys(o).forEach(function(W){G[W]=function(){for(var Z,re=arguments.length,oe=new Array(re),Y=0;Y<re;Y++)oe[Y]=arguments[Y];return(Z=o[W]).call.apply(Z,[G,I].concat(oe))}}),Object.entries(c).forEach(function(W){var Z=hC(W,2),re=Z[0],oe=Z[1];return G[re]=G[oe]}),G.resetProps=function(){return b.forEach(function(W){G[W.name](W.defaultVal)}),G},G.resetProps(),I._rerender=te,P&&B&&G(B),G}}var On=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return n},Out:function(n){return n},InOut:function(n){return n}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var e=1.70158;return n===1?1:n*n*((e+1)*n-e)},Out:function(n){var e=1.70158;return n===0?0:--n*n*((e+1)*n+e)+1},InOut:function(n){var e=2.5949095;return(n*=2)<1?.5*(n*n*((e+1)*n-e)):.5*((n-=2)*n*((e+1)*n+e)+2)}}),Bounce:Object.freeze({In:function(n){return 1-On.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?On.Bounce.In(n*2)*.5:On.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(e){return Math.pow(e,n)},Out:function(e){return 1-Math.pow(1-e,n)},InOut:function(e){return e<.5?Math.pow(e*2,n)/2:(1-Math.pow(2-e*2,n))/2+.5}}}}),Yu=function(){return performance.now()},of=(function(){function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return n.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var i=0,s=t;i<s.length;i++){var o=s[i];(e=o._group)===null||e===void 0||e.remove(o),o._group=this,this._tweens[o.getId()]=o,this._tweensAddedDuringUpdate[o.getId()]=o}},n.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var s=i[r];s._group=void 0,delete this._tweens[s.getId()],delete this._tweensAddedDuringUpdate[s.getId()]}},n.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},n.prototype.update=function(e,t){e===void 0&&(e=Yu()),t===void 0&&(t=!0);var r=Object.keys(this._tweens);if(r.length!==0)for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var s=this._tweens[r[i]],o=!t;s&&s.update(e,o)===!1&&!t&&this.remove(s)}r=Object.keys(this._tweensAddedDuringUpdate)}},n})(),hm={Linear:function(n,e){var t=n.length-1,r=t*e,i=Math.floor(r),s=hm.Utils.Linear;return e<0?s(n[0],n[1],r):e>1?s(n[t],n[t-1],t-r):s(n[i],n[i+1>t?t:i+1],r-i)},Utils:{Linear:function(n,e,t){return(e-n)*t+n}}},Ob=(function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n})(),fm=new of,_r=(function(){function n(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=On.Linear.None,this._interpolationFunction=hm.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Ob.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=fm,fm.add(this))}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.getDuration=function(){return this._duration},n.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},n.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},n.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},n.prototype.start=function(e,t){if(e===void 0&&(e=Yu()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var r in this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var i={};for(var s in this._valuesEnd)i[s]=this._valuesEnd[s];this._valuesEnd=i}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},n.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},n.prototype._setupProperties=function(e,t,r,i,s){for(var o in r){var a=e[o],c=Array.isArray(a),f=c?"array":typeof a,p=!c&&Array.isArray(r[o]);if(!(f==="undefined"||f==="function")){if(p){var g=r[o];if(g.length===0)continue;for(var v=[a],b=0,T=g.length;b<T;b+=1){var S=this._handleRelativeValue(a,g[b]);if(isNaN(S)){p=!1,console.warn("Found invalid interpolation list. Skipping.");break}v.push(S)}p&&(r[o]=v)}if((f==="object"||c)&&a&&!p){t[o]=c?[]:{};var N=a;for(var C in N)t[o][C]=N[C];i[o]=c?[]:{};var g=r[o];if(!this._isDynamic){var P={};for(var C in g)P[C]=g[C];r[o]=g=P}this._setupProperties(N,t[o],g,i[o],s)}else(typeof t[o]>"u"||s)&&(t[o]=a),c||(t[o]*=1),p?i[o]=r[o].slice().reverse():i[o]=t[o]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},n.prototype.pause=function(e){return e===void 0&&(e=Yu()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},n.prototype.resume=function(e){return e===void 0&&(e=Yu()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},n.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},n.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},n.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},n.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},n.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},n.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},n.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},n.prototype.easing=function(e){return e===void 0&&(e=On.Linear.None),this._easingFunction=e,this},n.prototype.interpolation=function(e){return e===void 0&&(e=hm.Linear),this._interpolationFunction=e,this},n.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},n.prototype.onStart=function(e){return this._onStartCallback=e,this},n.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},n.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},n.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},n.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},n.prototype.onStop=function(e){return this._onStopCallback=e,this},n.prototype.update=function(e,t){var r=this,i;if(e===void 0&&(e=Yu()),t===void 0&&(t=n.autoStartOnUpdate),this._isPaused)return!0;var s;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var o=e-this._startTime,a=this._duration+((i=this._repeatDelayTime)!==null&&i!==void 0?i:this._delayTime),c=this._duration+this._repeat*a,f=function(){if(r._duration===0||o>c)return 1;var S=Math.trunc(o/a),N=o-S*a,C=Math.min(N/r._duration,1);return C===0&&o===r._duration?1:C},p=f(),g=this._easingFunction(p);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,g),this._onUpdateCallback&&this._onUpdateCallback(this._object,p),this._duration===0||o>=this._duration)if(this._repeat>0){var v=Math.min(Math.trunc((o-this._duration)/a)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=v);for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*v,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var b=0,T=this._chainedTweens.length;b<T;b++)this._chainedTweens[b].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(e,t,r,i){for(var s in r)if(t[s]!==void 0){var o=t[s]||0,a=r[s],c=Array.isArray(e[s]),f=Array.isArray(a),p=!c&&f;p?e[s]=this._interpolationFunction(a,i):typeof a=="object"&&a?this._updateProperties(e[s],o,a,i):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(e[s]=o+(a-o)*i))}},n.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},n.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];typeof r=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(r):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},n.autoStartOnUpdate=!1,n})();Ob.nextId;var Ss=fm;Ss.getAll.bind(Ss);Ss.removeAll.bind(Ss);Ss.add.bind(Ss);Ss.remove.bind(Ss);Ss.update.bind(Ss);function pC(n){const e=+this._x.call(null,n),t=+this._y.call(null,n),r=+this._z.call(null,n);return Ib(this.cover(e,t,r),e,t,r,n)}function Ib(n,e,t,r,i){if(isNaN(e)||isNaN(t)||isNaN(r))return n;var s,o=n._root,a={data:i},c=n._x0,f=n._y0,p=n._z0,g=n._x1,v=n._y1,b=n._z1,T,S,N,C,P,B,F,q,I,U,G;if(!o)return n._root=a,n;for(;o.length;)if((F=e>=(T=(c+g)/2))?c=T:g=T,(q=t>=(S=(f+v)/2))?f=S:v=S,(I=r>=(N=(p+b)/2))?p=N:b=N,s=o,!(o=o[U=I<<2|q<<1|F]))return s[U]=a,n;if(C=+n._x.call(null,o.data),P=+n._y.call(null,o.data),B=+n._z.call(null,o.data),e===C&&t===P&&r===B)return a.next=o,s?s[U]=a:n._root=a,n;do s=s?s[U]=new Array(8):n._root=new Array(8),(F=e>=(T=(c+g)/2))?c=T:g=T,(q=t>=(S=(f+v)/2))?f=S:v=S,(I=r>=(N=(p+b)/2))?p=N:b=N;while((U=I<<2|q<<1|F)===(G=(B>=N)<<2|(P>=S)<<1|C>=T));return s[G]=o,s[U]=a,n}function mC(n){Array.isArray(n)||(n=Array.from(n));const e=n.length,t=new Float64Array(e),r=new Float64Array(e),i=new Float64Array(e);let s=1/0,o=1/0,a=1/0,c=-1/0,f=-1/0,p=-1/0;for(let g=0,v,b,T,S;g<e;++g)isNaN(b=+this._x.call(null,v=n[g]))||isNaN(T=+this._y.call(null,v))||isNaN(S=+this._z.call(null,v))||(t[g]=b,r[g]=T,i[g]=S,b<s&&(s=b),b>c&&(c=b),T<o&&(o=T),T>f&&(f=T),S<a&&(a=S),S>p&&(p=S));if(s>c||o>f||a>p)return this;this.cover(s,o,a).cover(c,f,p);for(let g=0;g<e;++g)Ib(this,t[g],r[g],i[g],n[g]);return this}function gC(n,e,t){if(isNaN(n=+n)||isNaN(e=+e)||isNaN(t=+t))return this;var r=this._x0,i=this._y0,s=this._z0,o=this._x1,a=this._y1,c=this._z1;if(isNaN(r))o=(r=Math.floor(n))+1,a=(i=Math.floor(e))+1,c=(s=Math.floor(t))+1;else{for(var f=o-r||1,p=this._root,g,v;r>n||n>=o||i>e||e>=a||s>t||t>=c;)switch(v=(t<s)<<2|(e<i)<<1|n<r,g=new Array(8),g[v]=p,p=g,f*=2,v){case 0:o=r+f,a=i+f,c=s+f;break;case 1:r=o-f,a=i+f,c=s+f;break;case 2:o=r+f,i=a-f,c=s+f;break;case 3:r=o-f,i=a-f,c=s+f;break;case 4:o=r+f,a=i+f,s=c-f;break;case 5:r=o-f,a=i+f,s=c-f;break;case 6:o=r+f,i=a-f,s=c-f;break;case 7:r=o-f,i=a-f,s=c-f;break}this._root&&this._root.length&&(this._root=p)}return this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=c,this}function _C(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function yC(n){return arguments.length?this.cover(+n[0][0],+n[0][1],+n[0][2]).cover(+n[1][0],+n[1][1],+n[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function en(n,e,t,r,i,s,o){this.node=n,this.x0=e,this.y0=t,this.z0=r,this.x1=i,this.y1=s,this.z1=o}function vC(n,e,t,r){var i,s=this._x0,o=this._y0,a=this._z0,c,f,p,g,v,b,T=this._x1,S=this._y1,N=this._z1,C=[],P=this._root,B,F;for(P&&C.push(new en(P,s,o,a,T,S,N)),r==null?r=1/0:(s=n-r,o=e-r,a=t-r,T=n+r,S=e+r,N=t+r,r*=r);B=C.pop();)if(!(!(P=B.node)||(c=B.x0)>T||(f=B.y0)>S||(p=B.z0)>N||(g=B.x1)<s||(v=B.y1)<o||(b=B.z1)<a))if(P.length){var q=(c+g)/2,I=(f+v)/2,U=(p+b)/2;C.push(new en(P[7],q,I,U,g,v,b),new en(P[6],c,I,U,q,v,b),new en(P[5],q,f,U,g,I,b),new en(P[4],c,f,U,q,I,b),new en(P[3],q,I,p,g,v,U),new en(P[2],c,I,p,q,v,U),new en(P[1],q,f,p,g,I,U),new en(P[0],c,f,p,q,I,U)),(F=(t>=U)<<2|(e>=I)<<1|n>=q)&&(B=C[C.length-1],C[C.length-1]=C[C.length-1-F],C[C.length-1-F]=B)}else{var G=n-+this._x.call(null,P.data),H=e-+this._y.call(null,P.data),te=t-+this._z.call(null,P.data),W=G*G+H*H+te*te;if(W<r){var Z=Math.sqrt(r=W);s=n-Z,o=e-Z,a=t-Z,T=n+Z,S=e+Z,N=t+Z,i=P.data}}return i}const xC=(n,e,t,r,i,s)=>Math.sqrt((n-r)**2+(e-i)**2+(t-s)**2);function bC(n,e,t,r){const i=[],s=n-r,o=e-r,a=t-r,c=n+r,f=e+r,p=t+r;return this.visit((g,v,b,T,S,N,C)=>{if(!g.length)do{const P=g.data;xC(n,e,t,this._x(P),this._y(P),this._z(P))<=r&&i.push(P)}while(g=g.next);return v>c||b>f||T>p||S<s||N<o||C<a}),i}function TC(n){if(isNaN(v=+this._x.call(null,n))||isNaN(b=+this._y.call(null,n))||isNaN(T=+this._z.call(null,n)))return this;var e,t=this._root,r,i,s,o=this._x0,a=this._y0,c=this._z0,f=this._x1,p=this._y1,g=this._z1,v,b,T,S,N,C,P,B,F,q,I;if(!t)return this;if(t.length)for(;;){if((P=v>=(S=(o+f)/2))?o=S:f=S,(B=b>=(N=(a+p)/2))?a=N:p=N,(F=T>=(C=(c+g)/2))?c=C:g=C,e=t,!(t=t[q=F<<2|B<<1|P]))return this;if(!t.length)break;(e[q+1&7]||e[q+2&7]||e[q+3&7]||e[q+4&7]||e[q+5&7]||e[q+6&7]||e[q+7&7])&&(r=e,I=q)}for(;t.data!==n;)if(i=t,!(t=t.next))return this;return(s=t.next)&&delete t.next,i?(s?i.next=s:delete i.next,this):e?(s?e[q]=s:delete e[q],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(r?r[I]=t:this._root=t),this):(this._root=s,this)}function wC(n){for(var e=0,t=n.length;e<t;++e)this.remove(n[e]);return this}function SC(){return this._root}function EC(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function NC(n){var e=[],t,r=this._root,i,s,o,a,c,f,p;for(r&&e.push(new en(r,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!n(r=t.node,s=t.x0,o=t.y0,a=t.z0,c=t.x1,f=t.y1,p=t.z1)&&r.length){var g=(s+c)/2,v=(o+f)/2,b=(a+p)/2;(i=r[7])&&e.push(new en(i,g,v,b,c,f,p)),(i=r[6])&&e.push(new en(i,s,v,b,g,f,p)),(i=r[5])&&e.push(new en(i,g,o,b,c,v,p)),(i=r[4])&&e.push(new en(i,s,o,b,g,v,p)),(i=r[3])&&e.push(new en(i,g,v,a,c,f,b)),(i=r[2])&&e.push(new en(i,s,v,a,g,f,b)),(i=r[1])&&e.push(new en(i,g,o,a,c,v,b)),(i=r[0])&&e.push(new en(i,s,o,a,g,v,b))}return this}function RC(n){var e=[],t=[],r;for(this._root&&e.push(new en(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));r=e.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,c=r.z0,f=r.x1,p=r.y1,g=r.z1,v=(o+f)/2,b=(a+p)/2,T=(c+g)/2;(s=i[0])&&e.push(new en(s,o,a,c,v,b,T)),(s=i[1])&&e.push(new en(s,v,a,c,f,b,T)),(s=i[2])&&e.push(new en(s,o,b,c,v,p,T)),(s=i[3])&&e.push(new en(s,v,b,c,f,p,T)),(s=i[4])&&e.push(new en(s,o,a,T,v,b,g)),(s=i[5])&&e.push(new en(s,v,a,T,f,b,g)),(s=i[6])&&e.push(new en(s,o,b,T,v,p,g)),(s=i[7])&&e.push(new en(s,v,b,T,f,p,g))}t.push(r)}for(;r=t.pop();)n(r.node,r.x0,r.y0,r.z0,r.x1,r.y1,r.z1);return this}function CC(n){return n[0]}function MC(n){return arguments.length?(this._x=n,this):this._x}function PC(n){return n[1]}function BC(n){return arguments.length?(this._y=n,this):this._y}function DC(n){return n[2]}function LC(n){return arguments.length?(this._z=n,this):this._z}function kb(n,e,t,r){var i=new n1(e??CC,t??PC,r??DC,NaN,NaN,NaN,NaN,NaN,NaN);return n==null?i:i.addAll(n)}function n1(n,e,t,r,i,s,o,a,c){this._x=n,this._y=e,this._z=t,this._x0=r,this._y0=i,this._z0=s,this._x1=o,this._y1=a,this._z1=c,this._root=void 0}function wy(n){for(var e={data:n.data},t=e;n=n.next;)t=t.next={data:n.data};return e}var ar=kb.prototype=n1.prototype;ar.copy=function(){var n=new n1(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,r;if(!e)return n;if(!e.length)return n._root=wy(e),n;for(t=[{source:e,target:n._root=new Array(8)}];e=t.pop();)for(var i=0;i<8;++i)(r=e.source[i])&&(r.length?t.push({source:r,target:e.target[i]=new Array(8)}):e.target[i]=wy(r));return n};ar.add=pC;ar.addAll=mC;ar.cover=gC;ar.data=_C;ar.extent=yC;ar.find=vC;ar.findAllWithinRadius=bC;ar.remove=TC;ar.removeAll=wC;ar.root=SC;ar.size=EC;ar.visit=NC;ar.visitAfter=RC;ar.x=MC;ar.y=BC;ar.z=LC;function T0(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function FC(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function Ub(n){let e,t,r;n.length!==2?(e=T0,t=(a,c)=>T0(n(a),c),r=(a,c)=>n(a)-c):(e=n===T0||n===FC?n:OC,t=n,r=n);function i(a,c,f=0,p=a.length){if(f<p){if(e(c,c)!==0)return p;do{const g=f+p>>>1;t(a[g],c)<0?f=g+1:p=g}while(f<p)}return f}function s(a,c,f=0,p=a.length){if(f<p){if(e(c,c)!==0)return p;do{const g=f+p>>>1;t(a[g],c)<=0?f=g+1:p=g}while(f<p)}return f}function o(a,c,f=0,p=a.length){const g=i(a,c,f,p-1);return g>f&&r(a[g-1],c)>-r(a[g],c)?g-1:g}return{left:i,center:o,right:s}}function OC(){return 0}function IC(n){return n===null?NaN:+n}const kC=Ub(T0),qb=kC.right;Ub(IC).center;function K0(n,e){let t,r;if(e===void 0)for(const i of n)i!=null&&(t===void 0?i>=i&&(t=r=i):(t>i&&(t=i),r<i&&(r=i)));else{let i=-1;for(let s of n)(s=e(s,++i,n))!=null&&(t===void 0?s>=s&&(t=r=s):(t>s&&(t=s),r<s&&(r=s)))}return[t,r]}class Hs{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=t[i],o=e+s,a=Math.abs(e)<Math.abs(s)?e-(o-s):s-(o-e);a&&(t[r++]=a),e=o}return t[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let t=this._n,r,i,s,o=0;if(t>0){for(o=e[--t];t>0&&(r=o,i=e[--t],o=r+i,s=i-(o-r),!s););t>0&&(s<0&&e[t-1]<0||s>0&&e[t-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}const UC=Math.sqrt(50),qC=Math.sqrt(10),GC=Math.sqrt(2);function Z0(n,e,t){const r=(e-n)/Math.max(0,t),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=UC?10:s>=qC?5:s>=GC?2:1;let a,c,f;return i<0?(f=Math.pow(10,-i)/o,a=Math.round(n*f),c=Math.round(e*f),a/f<n&&++a,c/f>e&&--c,f=-f):(f=Math.pow(10,i)*o,a=Math.round(n/f),c=Math.round(e/f),a*f<n&&++a,c*f>e&&--c),c<a&&.5<=t&&t<2?Z0(n,e,t*2):[a,c,f]}function VC(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const r=e<n,[i,s,o]=r?Z0(e,n,t):Z0(n,e,t);if(!(s>=i))return[];const a=s-i+1,c=new Array(a);if(r)if(o<0)for(let f=0;f<a;++f)c[f]=(s-f)/-o;else for(let f=0;f<a;++f)c[f]=(s-f)*o;else if(o<0)for(let f=0;f<a;++f)c[f]=(i+f)/-o;else for(let f=0;f<a;++f)c[f]=(i+f)*o;return c}function dm(n,e,t){return e=+e,n=+n,t=+t,Z0(n,e,t)[2]}function zC(n,e,t){e=+e,n=+n,t=+t;const r=e<n,i=r?dm(e,n,t):dm(n,e,t);return(r?-1:1)*(i<0?1/-i:i)}function $C(n,e){let t;for(const r of n)r!=null&&(t<r||t===void 0&&r>=r)&&(t=r);return t}function jC(n,e){let t=0,r=0;if(e===void 0)for(let i of n)i!=null&&(i=+i)>=i&&(++t,r+=i);else{let i=-1;for(let s of n)(s=e(s,++i,n))!=null&&(s=+s)>=s&&(++t,r+=s)}if(t)return r/t}function*HC(n){for(const e of n)yield*e}function TA(n){return Array.from(HC(n))}function Ml(n,e,t){n=+n,e=+e,t=(i=arguments.length)<2?(e=n,n=0,1):i<3?1:+t;for(var r=-1,i=Math.max(0,Math.ceil((e-n)/t))|0,s=new Array(i);++r<i;)s[r]=n+r*t;return s}function WC(n,e){let t=0;for(let r of n)(r=+r)&&(t+=r);return t}function Gb(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function r1(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function Vb(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function HA(){}var wA=.7,J0=1/wA,kl="\\s*([+-]?\\d+)\\s*",SA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",gs="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",QC=/^#([0-9a-f]{3,8})$/,YC=new RegExp(`^rgb\\(${kl},${kl},${kl}\\)$`),XC=new RegExp(`^rgb\\(${gs},${gs},${gs}\\)$`),KC=new RegExp(`^rgba\\(${kl},${kl},${kl},${SA}\\)$`),ZC=new RegExp(`^rgba\\(${gs},${gs},${gs},${SA}\\)$`),JC=new RegExp(`^hsl\\(${SA},${gs},${gs}\\)$`),e9=new RegExp(`^hsla\\(${SA},${gs},${gs},${SA}\\)$`),Sy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};r1(HA,qa,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Ey,formatHex:Ey,formatHex8:t9,formatHsl:n9,formatRgb:Ny,toString:Ny});function Ey(){return this.rgb().formatHex()}function t9(){return this.rgb().formatHex8()}function n9(){return zb(this).formatHsl()}function Ny(){return this.rgb().formatRgb()}function qa(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=QC.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?Ry(e):t===3?new Or(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?yc(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?yc(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=YC.exec(n))?new Or(e[1],e[2],e[3],1):(e=XC.exec(n))?new Or(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=KC.exec(n))?yc(e[1],e[2],e[3],e[4]):(e=ZC.exec(n))?yc(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=JC.exec(n))?Py(e[1],e[2]/100,e[3]/100,1):(e=e9.exec(n))?Py(e[1],e[2]/100,e[3]/100,e[4]):Sy.hasOwnProperty(n)?Ry(Sy[n]):n==="transparent"?new Or(NaN,NaN,NaN,0):null}function Ry(n){return new Or(n>>16&255,n>>8&255,n&255,1)}function yc(n,e,t,r){return r<=0&&(n=e=t=NaN),new Or(n,e,t,r)}function r9(n){return n instanceof HA||(n=qa(n)),n?(n=n.rgb(),new Or(n.r,n.g,n.b,n.opacity)):new Or}function pm(n,e,t,r){return arguments.length===1?r9(n):new Or(n,e,t,r??1)}function Or(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}r1(Or,pm,Vb(HA,{brighter(n){return n=n==null?J0:Math.pow(J0,n),new Or(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?wA:Math.pow(wA,n),new Or(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Or(Oa(this.r),Oa(this.g),Oa(this.b),eh(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Cy,formatHex:Cy,formatHex8:i9,formatRgb:My,toString:My}));function Cy(){return`#${Ca(this.r)}${Ca(this.g)}${Ca(this.b)}`}function i9(){return`#${Ca(this.r)}${Ca(this.g)}${Ca(this.b)}${Ca((isNaN(this.opacity)?1:this.opacity)*255)}`}function My(){const n=eh(this.opacity);return`${n===1?"rgb(":"rgba("}${Oa(this.r)}, ${Oa(this.g)}, ${Oa(this.b)}${n===1?")":`, ${n})`}`}function eh(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Oa(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Ca(n){return n=Oa(n),(n<16?"0":"")+n.toString(16)}function Py(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Ui(n,e,t,r)}function zb(n){if(n instanceof Ui)return new Ui(n.h,n.s,n.l,n.opacity);if(n instanceof HA||(n=qa(n)),!n)return new Ui;if(n instanceof Ui)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),s=Math.max(e,t,r),o=NaN,a=s-i,c=(s+i)/2;return a?(e===s?o=(t-r)/a+(t<r)*6:t===s?o=(r-e)/a+2:o=(e-t)/a+4,a/=c<.5?s+i:2-s-i,o*=60):a=c>0&&c<1?0:o,new Ui(o,a,c,n.opacity)}function s9(n,e,t,r){return arguments.length===1?zb(n):new Ui(n,e,t,r??1)}function Ui(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}r1(Ui,s9,Vb(HA,{brighter(n){return n=n==null?J0:Math.pow(J0,n),new Ui(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?wA:Math.pow(wA,n),new Ui(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new Or(Ld(n>=240?n-240:n+120,i,r),Ld(n,i,r),Ld(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new Ui(By(this.h),vc(this.s),vc(this.l),eh(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=eh(this.opacity);return`${n===1?"hsl(":"hsla("}${By(this.h)}, ${vc(this.s)*100}%, ${vc(this.l)*100}%${n===1?")":`, ${n})`}`}}));function By(n){return n=(n||0)%360,n<0?n+360:n}function vc(n){return Math.max(0,Math.min(1,n||0))}function Ld(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const i1=n=>()=>n;function o9(n,e){return function(t){return n+t*e}}function a9(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function l9(n){return(n=+n)==1?$b:function(e,t){return t-e?a9(e,t,n):i1(isNaN(e)?t:e)}}function $b(n,e){var t=e-n;return t?o9(n,t):i1(isNaN(n)?e:n)}const Dy=(function n(e){var t=l9(e);function r(i,s){var o=t((i=pm(i)).r,(s=pm(s)).r),a=t(i.g,s.g),c=t(i.b,s.b),f=$b(i.opacity,s.opacity);return function(p){return i.r=o(p),i.g=a(p),i.b=c(p),i.opacity=f(p),i+""}}return r.gamma=n,r})(1);function jb(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,r=e.slice(),i;return function(s){for(i=0;i<t;++i)r[i]=n[i]*(1-s)+e[i]*s;return r}}function Hb(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function u9(n,e){return(Hb(e)?jb:Wb)(n,e)}function Wb(n,e){var t=e?e.length:0,r=n?Math.min(t,n.length):0,i=new Array(r),s=new Array(t),o;for(o=0;o<r;++o)i[o]=s1(n[o],e[o]);for(;o<t;++o)s[o]=e[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function A9(n,e){var t=new Date;return n=+n,e=+e,function(r){return t.setTime(n*(1-r)+e*r),t}}function EA(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function c9(n,e){var t={},r={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?t[i]=s1(n[i],e[i]):r[i]=e[i];return function(s){for(i in t)r[i]=t[i](s);return r}}var mm=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Fd=new RegExp(mm.source,"g");function h9(n){return function(){return n}}function f9(n){return function(e){return n(e)+""}}function d9(n,e){var t=mm.lastIndex=Fd.lastIndex=0,r,i,s,o=-1,a=[],c=[];for(n=n+"",e=e+"";(r=mm.exec(n))&&(i=Fd.exec(e));)(s=i.index)>t&&(s=e.slice(t,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,c.push({i:o,x:EA(r,i)})),t=Fd.lastIndex;return t<e.length&&(s=e.slice(t),a[o]?a[o]+=s:a[++o]=s),a.length<2?c[0]?f9(c[0].x):h9(e):(e=c.length,function(f){for(var p=0,g;p<e;++p)a[(g=c[p]).i]=g.x(f);return a.join("")})}function s1(n,e){var t=typeof e,r;return e==null||t==="boolean"?i1(e):(t==="number"?EA:t==="string"?(r=qa(e))?(e=r,Dy):d9:e instanceof qa?Dy:e instanceof Date?A9:Hb(e)?jb:Array.isArray(e)?Wb:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?c9:EA)(n,e)}function p9(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}function m9(n){return function(){return n}}function g9(n){return+n}var Ly=[0,1];function Pl(n){return n}function gm(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:m9(isNaN(e)?NaN:.5)}function _9(n,e){var t;return n>e&&(t=n,n=e,e=t),function(r){return Math.max(n,Math.min(e,r))}}function y9(n,e,t){var r=n[0],i=n[1],s=e[0],o=e[1];return i<r?(r=gm(i,r),s=t(o,s)):(r=gm(r,i),s=t(s,o)),function(a){return s(r(a))}}function v9(n,e,t){var r=Math.min(n.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=gm(n[o],n[o+1]),s[o]=t(e[o],e[o+1]);return function(a){var c=qb(n,a,1,r)-1;return s[c](i[c](a))}}function x9(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function b9(){var n=Ly,e=Ly,t=s1,r,i,s,o=Pl,a,c,f;function p(){var v=Math.min(n.length,e.length);return o!==Pl&&(o=_9(n[0],n[v-1])),a=v>2?v9:y9,c=f=null,g}function g(v){return v==null||isNaN(v=+v)?s:(c||(c=a(n.map(r),e,t)))(r(o(v)))}return g.invert=function(v){return o(i((f||(f=a(e,n.map(r),EA)))(v)))},g.domain=function(v){return arguments.length?(n=Array.from(v,g9),p()):n.slice()},g.range=function(v){return arguments.length?(e=Array.from(v),p()):e.slice()},g.rangeRound=function(v){return e=Array.from(v),t=p9,p()},g.clamp=function(v){return arguments.length?(o=v?!0:Pl,p()):o!==Pl},g.interpolate=function(v){return arguments.length?(t=v,p()):t},g.unknown=function(v){return arguments.length?(s=v,g):s},function(v,b){return r=v,i=b,p()}}function T9(){return b9()(Pl,Pl)}function w9(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function th(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,r=n.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+n.slice(t+1)]}function Kl(n){return n=th(Math.abs(n)),n?n[1]:NaN}function S9(n,e){return function(t,r){for(var i=t.length,s=[],o=0,a=n[0],c=0;i>0&&a>0&&(c+a+1>r&&(a=Math.max(1,r-c)),s.push(t.substring(i-=a,i+a)),!((c+=a+1)>r));)a=n[o=(o+1)%n.length];return s.reverse().join(e)}}function E9(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var N9=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nh(n){if(!(e=N9.exec(n)))throw new Error("invalid format: "+n);var e;return new o1({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}nh.prototype=o1.prototype;function o1(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}o1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function R9(n){e:for(var e=n.length,t=1,r=-1,i;t<e;++t)switch(n[t]){case".":r=i=t;break;case"0":r===0&&(r=t),i=t;break;default:if(!+n[t])break e;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(i+1):n}var Qb;function C9(n,e){var t=th(n,e);if(!t)return n+"";var r=t[0],i=t[1],s=i-(Qb=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+th(n,Math.max(0,e+s-1))[0]}function Fy(n,e){var t=th(n,e);if(!t)return n+"";var r=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Oy={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:w9,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>Fy(n*100,e),r:Fy,s:C9,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function Iy(n){return n}var ky=Array.prototype.map,Uy=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function M9(n){var e=n.grouping===void 0||n.thousands===void 0?Iy:S9(ky.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",s=n.numerals===void 0?Iy:E9(ky.call(n.numerals,String)),o=n.percent===void 0?"%":n.percent+"",a=n.minus===void 0?"−":n.minus+"",c=n.nan===void 0?"NaN":n.nan+"";function f(g){g=nh(g);var v=g.fill,b=g.align,T=g.sign,S=g.symbol,N=g.zero,C=g.width,P=g.comma,B=g.precision,F=g.trim,q=g.type;q==="n"?(P=!0,q="g"):Oy[q]||(B===void 0&&(B=12),F=!0,q="g"),(N||v==="0"&&b==="=")&&(N=!0,v="0",b="=");var I=S==="$"?t:S==="#"&&/[boxX]/.test(q)?"0"+q.toLowerCase():"",U=S==="$"?r:/[%p]/.test(q)?o:"",G=Oy[q],H=/[defgprs%]/.test(q);B=B===void 0?6:/[gprs]/.test(q)?Math.max(1,Math.min(21,B)):Math.max(0,Math.min(20,B));function te(W){var Z=I,re=U,oe,Y,ae;if(q==="c")re=G(W)+re,W="";else{W=+W;var he=W<0||1/W<0;if(W=isNaN(W)?c:G(Math.abs(W),B),F&&(W=R9(W)),he&&+W==0&&T!=="+"&&(he=!1),Z=(he?T==="("?T:a:T==="-"||T==="("?"":T)+Z,re=(q==="s"?Uy[8+Qb/3]:"")+re+(he&&T==="("?")":""),H){for(oe=-1,Y=W.length;++oe<Y;)if(ae=W.charCodeAt(oe),48>ae||ae>57){re=(ae===46?i+W.slice(oe+1):W.slice(oe))+re,W=W.slice(0,oe);break}}}P&&!N&&(W=e(W,1/0));var be=Z.length+W.length+re.length,pe=be<C?new Array(C-be+1).join(v):"";switch(P&&N&&(W=e(pe+W,pe.length?C-re.length:1/0),pe=""),b){case"<":W=Z+W+re+pe;break;case"=":W=Z+pe+W+re;break;case"^":W=pe.slice(0,be=pe.length>>1)+Z+W+re+pe.slice(be);break;default:W=pe+Z+W+re;break}return s(W)}return te.toString=function(){return g+""},te}function p(g,v){var b=f((g=nh(g),g.type="f",g)),T=Math.max(-8,Math.min(8,Math.floor(Kl(v)/3)))*3,S=Math.pow(10,-T),N=Uy[8+T/3];return function(C){return b(S*C)+N}}return{format:f,formatPrefix:p}}var xc,Yb,Xb;P9({thousands:",",grouping:[3],currency:["$",""]});function P9(n){return xc=M9(n),Yb=xc.format,Xb=xc.formatPrefix,xc}function B9(n){return Math.max(0,-Kl(Math.abs(n)))}function D9(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Kl(e)/3)))*3-Kl(Math.abs(n)))}function L9(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,Kl(e)-Kl(n))+1}function F9(n,e,t,r){var i=zC(n,e,t),s;switch(r=nh(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(n),Math.abs(e));return r.precision==null&&!isNaN(s=D9(i,o))&&(r.precision=s),Xb(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=L9(i,Math.max(Math.abs(n),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=B9(i))&&(r.precision=s-(r.type==="%")*2);break}}return Yb(r)}function Kb(n){var e=n.domain;return n.ticks=function(t){var r=e();return VC(r[0],r[r.length-1],t??10)},n.tickFormat=function(t,r){var i=e();return F9(i[0],i[i.length-1],t??10,r)},n.nice=function(t){t==null&&(t=10);var r=e(),i=0,s=r.length-1,o=r[i],a=r[s],c,f,p=10;for(a<o&&(f=o,o=a,a=f,f=i,i=s,s=f);p-- >0;){if(f=dm(o,a,t),f===c)return r[i]=o,r[s]=a,e(r);if(f>0)o=Math.floor(o/f)*f,a=Math.ceil(a/f)*f;else if(f<0)o=Math.ceil(o*f)/f,a=Math.floor(a*f)/f;else break;c=f}return n},n}function Js(){var n=T9();return n.copy=function(){return x9(n,Js())},Gb.apply(n,arguments),Kb(n)}function Zb(){var n=0,e=1,t=1,r=[.5],i=[0,1],s;function o(c){return c!=null&&c<=c?i[qb(r,c,0,t)]:s}function a(){var c=-1;for(r=new Array(t);++c<t;)r[c]=((c+1)*e-(c-t)*n)/(t+1);return o}return o.domain=function(c){return arguments.length?([n,e]=c,n=+n,e=+e,a()):[n,e]},o.range=function(c){return arguments.length?(t=(i=Array.from(c)).length-1,a()):i.slice()},o.invertExtent=function(c){var f=i.indexOf(c);return f<0?[NaN,NaN]:f<1?[n,r[0]]:f>=t?[r[t-1],e]:[r[f-1],r[f]]},o.unknown=function(c){return arguments.length&&(s=c),o},o.thresholds=function(){return r.slice()},o.copy=function(){return Zb().domain([n,e]).range(i).unknown(s)},Gb.apply(Kb(o),arguments)}var bt=1e-6,rh=1e-12,Pt=Math.PI,Ir=Pt/2,ih=Pt/4,ii=Pt*2,En=180/Pt,At=Pt/180,Zt=Math.abs,a1=Math.atan,Ti=Math.atan2,ft=Math.cos,bc=Math.ceil,O9=Math.exp,_m=Math.hypot,I9=Math.log,ot=Math.sin,k9=Math.sign||function(n){return n>0?1:n<0?-1:0},eo=Math.sqrt,U9=Math.tan;function q9(n){return n>1?0:n<-1?Pt:Math.acos(n)}function to(n){return n>1?Ir:n<-1?-Ir:Math.asin(n)}function qy(n){return(n=ot(n/2))*n}function fr(){}function sh(n,e){n&&Vy.hasOwnProperty(n.type)&&Vy[n.type](n,e)}var Gy={Feature:function(n,e){sh(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)sh(t[r].geometry,e)}},Vy={Sphere:function(n,e){e.sphere()},Point:function(n,e){n=n.coordinates,e.point(n[0],n[1],n[2])},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)n=t[r],e.point(n[0],n[1],n[2])},LineString:function(n,e){ym(n.coordinates,e,0)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)ym(t[r],e,0)},Polygon:function(n,e){zy(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)zy(t[r],e)},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)sh(t[r],e)}};function ym(n,e,t){var r=-1,i=n.length-t,s;for(e.lineStart();++r<i;)s=n[r],e.point(s[0],s[1],s[2]);e.lineEnd()}function zy(n,e){var t=-1,r=n.length;for(e.polygonStart();++t<r;)ym(n[t],e,1);e.polygonEnd()}function af(n,e){n&&Gy.hasOwnProperty(n.type)?Gy[n.type](n,e):sh(n,e)}var oh=new Hs,$y=new Hs,Jb,e4,vm,xm,bm,no={point:fr,lineStart:fr,lineEnd:fr,polygonStart:function(){oh=new Hs,no.lineStart=G9,no.lineEnd=V9},polygonEnd:function(){var n=+oh;$y.add(n<0?ii+n:n),this.lineStart=this.lineEnd=this.point=fr},sphere:function(){$y.add(ii)}};function G9(){no.point=z9}function V9(){t4(Jb,e4)}function z9(n,e){no.point=t4,Jb=n,e4=e,n*=At,e*=At,vm=n,xm=ft(e=e/2+ih),bm=ot(e)}function t4(n,e){n*=At,e*=At,e=e/2+ih;var t=n-vm,r=t>=0?1:-1,i=r*t,s=ft(e),o=ot(e),a=bm*o,c=xm*s+a*ft(i),f=a*r*ot(i);oh.add(Ti(f,c)),vm=n,xm=s,bm=o}function ah(n){return[Ti(n[1],n[0]),to(n[2])]}function Ga(n){var e=n[0],t=n[1],r=ft(t);return[r*ft(e),r*ot(e),ot(t)]}function Tc(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Zl(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function Od(n,e){n[0]+=e[0],n[1]+=e[1],n[2]+=e[2]}function wc(n,e){return[n[0]*e,n[1]*e,n[2]*e]}function lh(n){var e=eo(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=e,n[1]/=e,n[2]/=e}var yn,Fr,Sn,ti,_a,n4,r4,Ul,lA,Ro,ro,ks={point:Tm,lineStart:jy,lineEnd:Hy,polygonStart:function(){ks.point=s4,ks.lineStart=$9,ks.lineEnd=j9,lA=new Hs,no.polygonStart()},polygonEnd:function(){no.polygonEnd(),ks.point=Tm,ks.lineStart=jy,ks.lineEnd=Hy,oh<0?(yn=-(Sn=180),Fr=-(ti=90)):lA>bt?ti=90:lA<-bt&&(Fr=-90),ro[0]=yn,ro[1]=Sn},sphere:function(){yn=-(Sn=180),Fr=-(ti=90)}};function Tm(n,e){Ro.push(ro=[yn=n,Sn=n]),e<Fr&&(Fr=e),e>ti&&(ti=e)}function i4(n,e){var t=Ga([n*At,e*At]);if(Ul){var r=Zl(Ul,t),i=[r[1],-r[0],0],s=Zl(i,r);lh(s),s=ah(s);var o=n-_a,a=o>0?1:-1,c=s[0]*En*a,f,p=Zt(o)>180;p^(a*_a<c&&c<a*n)?(f=s[1]*En,f>ti&&(ti=f)):(c=(c+360)%360-180,p^(a*_a<c&&c<a*n)?(f=-s[1]*En,f<Fr&&(Fr=f)):(e<Fr&&(Fr=e),e>ti&&(ti=e))),p?n<_a?Zr(yn,n)>Zr(yn,Sn)&&(Sn=n):Zr(n,Sn)>Zr(yn,Sn)&&(yn=n):Sn>=yn?(n<yn&&(yn=n),n>Sn&&(Sn=n)):n>_a?Zr(yn,n)>Zr(yn,Sn)&&(Sn=n):Zr(n,Sn)>Zr(yn,Sn)&&(yn=n)}else Ro.push(ro=[yn=n,Sn=n]);e<Fr&&(Fr=e),e>ti&&(ti=e),Ul=t,_a=n}function jy(){ks.point=i4}function Hy(){ro[0]=yn,ro[1]=Sn,ks.point=Tm,Ul=null}function s4(n,e){if(Ul){var t=n-_a;lA.add(Zt(t)>180?t+(t>0?360:-360):t)}else n4=n,r4=e;no.point(n,e),i4(n,e)}function $9(){no.lineStart()}function j9(){s4(n4,r4),no.lineEnd(),Zt(lA)>bt&&(yn=-(Sn=180)),ro[0]=yn,ro[1]=Sn,Ul=null}function Zr(n,e){return(e-=n)<0?e+360:e}function H9(n,e){return n[0]-e[0]}function Wy(n,e){return n[0]<=n[1]?n[0]<=e&&e<=n[1]:e<n[0]||n[1]<e}function o4(n){var e,t,r,i,s,o,a;if(ti=Sn=-(yn=Fr=1/0),Ro=[],af(n,ks),t=Ro.length){for(Ro.sort(H9),e=1,r=Ro[0],s=[r];e<t;++e)i=Ro[e],Wy(r,i[0])||Wy(r,i[1])?(Zr(r[0],i[1])>Zr(r[0],r[1])&&(r[1]=i[1]),Zr(i[0],r[1])>Zr(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(o=-1/0,t=s.length-1,e=0,r=s[t];e<=t;r=i,++e)i=s[e],(a=Zr(r[1],i[0]))>o&&(o=a,yn=i[0],Sn=r[1])}return Ro=ro=null,yn===1/0||Fr===1/0?[[NaN,NaN],[NaN,NaN]]:[[yn,Fr],[Sn,ti]]}var Xu,uh,Ah,ch,hh,fh,dh,ph,wm,Sm,Em,a4,l4,Sr,Er,Nr,Vi={sphere:fr,point:l1,lineStart:Qy,lineEnd:Yy,polygonStart:function(){Vi.lineStart=Y9,Vi.lineEnd=X9},polygonEnd:function(){Vi.lineStart=Qy,Vi.lineEnd=Yy}};function l1(n,e){n*=At,e*=At;var t=ft(e);WA(t*ft(n),t*ot(n),ot(e))}function WA(n,e,t){++Xu,Ah+=(n-Ah)/Xu,ch+=(e-ch)/Xu,hh+=(t-hh)/Xu}function Qy(){Vi.point=W9}function W9(n,e){n*=At,e*=At;var t=ft(e);Sr=t*ft(n),Er=t*ot(n),Nr=ot(e),Vi.point=Q9,WA(Sr,Er,Nr)}function Q9(n,e){n*=At,e*=At;var t=ft(e),r=t*ft(n),i=t*ot(n),s=ot(e),o=Ti(eo((o=Er*s-Nr*i)*o+(o=Nr*r-Sr*s)*o+(o=Sr*i-Er*r)*o),Sr*r+Er*i+Nr*s);uh+=o,fh+=o*(Sr+(Sr=r)),dh+=o*(Er+(Er=i)),ph+=o*(Nr+(Nr=s)),WA(Sr,Er,Nr)}function Yy(){Vi.point=l1}function Y9(){Vi.point=K9}function X9(){u4(a4,l4),Vi.point=l1}function K9(n,e){a4=n,l4=e,n*=At,e*=At,Vi.point=u4;var t=ft(e);Sr=t*ft(n),Er=t*ot(n),Nr=ot(e),WA(Sr,Er,Nr)}function u4(n,e){n*=At,e*=At;var t=ft(e),r=t*ft(n),i=t*ot(n),s=ot(e),o=Er*s-Nr*i,a=Nr*r-Sr*s,c=Sr*i-Er*r,f=_m(o,a,c),p=to(f),g=f&&-p/f;wm.add(g*o),Sm.add(g*a),Em.add(g*c),uh+=p,fh+=p*(Sr+(Sr=r)),dh+=p*(Er+(Er=i)),ph+=p*(Nr+(Nr=s)),WA(Sr,Er,Nr)}function Xy(n){Xu=uh=Ah=ch=hh=fh=dh=ph=0,wm=new Hs,Sm=new Hs,Em=new Hs,af(n,Vi);var e=+wm,t=+Sm,r=+Em,i=_m(e,t,r);return i<rh&&(e=fh,t=dh,r=ph,uh<bt&&(e=Ah,t=ch,r=hh),i=_m(e,t,r),i<rh)?[NaN,NaN]:[Ti(t,e)*En,to(r/i)*En]}function Nm(n,e){function t(r,i){return r=n(r,i),e(r[0],r[1])}return n.invert&&e.invert&&(t.invert=function(r,i){return r=e.invert(r,i),r&&n.invert(r[0],r[1])}),t}function Rm(n,e){return Zt(n)>Pt&&(n-=Math.round(n/ii)*ii),[n,e]}Rm.invert=Rm;function A4(n,e,t){return(n%=ii)?e||t?Nm(Zy(n),Jy(e,t)):Zy(n):e||t?Jy(e,t):Rm}function Ky(n){return function(e,t){return e+=n,Zt(e)>Pt&&(e-=Math.round(e/ii)*ii),[e,t]}}function Zy(n){var e=Ky(n);return e.invert=Ky(-n),e}function Jy(n,e){var t=ft(n),r=ot(n),i=ft(e),s=ot(e);function o(a,c){var f=ft(c),p=ft(a)*f,g=ot(a)*f,v=ot(c),b=v*t+p*r;return[Ti(g*i-b*s,p*t-v*r),to(b*i+g*s)]}return o.invert=function(a,c){var f=ft(c),p=ft(a)*f,g=ot(a)*f,v=ot(c),b=v*i-g*s;return[Ti(g*i+v*s,p*t+b*r),to(b*t-p*r)]},o}function Z9(n){n=A4(n[0]*At,n[1]*At,n.length>2?n[2]*At:0);function e(t){return t=n(t[0]*At,t[1]*At),t[0]*=En,t[1]*=En,t}return e.invert=function(t){return t=n.invert(t[0]*At,t[1]*At),t[0]*=En,t[1]*=En,t},e}function J9(n,e,t,r,i,s){if(t){var o=ft(e),a=ot(e),c=r*t;i==null?(i=e+r*ii,s=e-c/2):(i=e3(o,i),s=e3(o,s),(r>0?i<s:i>s)&&(i+=r*ii));for(var f,p=i;r>0?p>s:p<s;p-=c)f=ah([o,-a*ft(p),-a*ot(p)]),n.point(f[0],f[1])}}function e3(n,e){e=Ga(e),e[0]-=n,lh(e);var t=q9(-e[1]);return((-e[2]<0?-t:t)+ii-bt)%ii}function c4(){var n=[],e;return{point:function(t,r,i){e.push([t,r,i])},lineStart:function(){n.push(e=[])},lineEnd:fr,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var t=n;return n=[],e=null,t}}}function w0(n,e){return Zt(n[0]-e[0])<bt&&Zt(n[1]-e[1])<bt}function Sc(n,e,t,r){this.x=n,this.z=e,this.o=t,this.e=r,this.v=!1,this.n=this.p=null}function h4(n,e,t,r,i){var s=[],o=[],a,c;if(n.forEach(function(T){if(!((S=T.length-1)<=0)){var S,N=T[0],C=T[S],P;if(w0(N,C)){if(!N[2]&&!C[2]){for(i.lineStart(),a=0;a<S;++a)i.point((N=T[a])[0],N[1]);i.lineEnd();return}C[0]+=2*bt}s.push(P=new Sc(N,T,null,!0)),o.push(P.o=new Sc(N,null,P,!1)),s.push(P=new Sc(C,T,null,!1)),o.push(P.o=new Sc(C,null,P,!0))}}),!!s.length){for(o.sort(e),t3(s),t3(o),a=0,c=o.length;a<c;++a)o[a].e=t=!t;for(var f=s[0],p,g;;){for(var v=f,b=!0;v.v;)if((v=v.n)===f)return;p=v.z,i.lineStart();do{if(v.v=v.o.v=!0,v.e){if(b)for(a=0,c=p.length;a<c;++a)i.point((g=p[a])[0],g[1]);else r(v.x,v.n.x,1,i);v=v.n}else{if(b)for(p=v.p.z,a=p.length-1;a>=0;--a)i.point((g=p[a])[0],g[1]);else r(v.x,v.p.x,-1,i);v=v.p}v=v.o,p=v.z,b=!b}while(!v.v);i.lineEnd()}}}function t3(n){if(e=n.length){for(var e,t=0,r=n[0],i;++t<e;)r.n=i=n[t],i.p=r,r=i;r.n=i=n[0],i.p=r}}function Id(n){return Zt(n[0])<=Pt?n[0]:k9(n[0])*((Zt(n[0])+Pt)%ii-Pt)}function f4(n,e){var t=Id(e),r=e[1],i=ot(r),s=[ot(t),-ft(t),0],o=0,a=0,c=new Hs;i===1?r=Ir+bt:i===-1&&(r=-Ir-bt);for(var f=0,p=n.length;f<p;++f)if(v=(g=n[f]).length)for(var g,v,b=g[v-1],T=Id(b),S=b[1]/2+ih,N=ot(S),C=ft(S),P=0;P<v;++P,T=F,N=I,C=U,b=B){var B=g[P],F=Id(B),q=B[1]/2+ih,I=ot(q),U=ft(q),G=F-T,H=G>=0?1:-1,te=H*G,W=te>Pt,Z=N*I;if(c.add(Ti(Z*H*ot(te),C*U+Z*ft(te))),o+=W?G+H*ii:G,W^T>=t^F>=t){var re=Zl(Ga(b),Ga(B));lh(re);var oe=Zl(s,re);lh(oe);var Y=(W^G>=0?-1:1)*to(oe[2]);(r>Y||r===Y&&(re[0]||re[1]))&&(a+=W^G>=0?1:-1)}}return(o<-bt||o<bt&&c<-rh)^a&1}function d4(n,e,t,r){return function(i){var s=e(i),o=c4(),a=e(o),c=!1,f,p,g,v={point:b,lineStart:S,lineEnd:N,polygonStart:function(){v.point=C,v.lineStart=P,v.lineEnd=B,p=[],f=[]},polygonEnd:function(){v.point=b,v.lineStart=S,v.lineEnd=N,p=TA(p);var F=f4(f,r);p.length?(c||(i.polygonStart(),c=!0),h4(p,tM,F,t,i)):F&&(c||(i.polygonStart(),c=!0),i.lineStart(),t(null,null,1,i),i.lineEnd()),c&&(i.polygonEnd(),c=!1),p=f=null},sphere:function(){i.polygonStart(),i.lineStart(),t(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function b(F,q){n(F,q)&&i.point(F,q)}function T(F,q){s.point(F,q)}function S(){v.point=T,s.lineStart()}function N(){v.point=b,s.lineEnd()}function C(F,q){g.push([F,q]),a.point(F,q)}function P(){a.lineStart(),g=[]}function B(){C(g[0][0],g[0][1]),a.lineEnd();var F=a.clean(),q=o.result(),I,U=q.length,G,H,te;if(g.pop(),f.push(g),g=null,!!U){if(F&1){if(H=q[0],(G=H.length-1)>0){for(c||(i.polygonStart(),c=!0),i.lineStart(),I=0;I<G;++I)i.point((te=H[I])[0],te[1]);i.lineEnd()}return}U>1&&F&2&&q.push(q.pop().concat(q.shift())),p.push(q.filter(eM))}}return v}}function eM(n){return n.length>1}function tM(n,e){return((n=n.x)[0]<0?n[1]-Ir-bt:Ir-n[1])-((e=e.x)[0]<0?e[1]-Ir-bt:Ir-e[1])}const n3=d4(function(){return!0},nM,iM,[-Pt,-Ir]);function nM(n){var e=NaN,t=NaN,r=NaN,i;return{lineStart:function(){n.lineStart(),i=1},point:function(s,o){var a=s>0?Pt:-Pt,c=Zt(s-e);Zt(c-Pt)<bt?(n.point(e,t=(t+o)/2>0?Ir:-Ir),n.point(r,t),n.lineEnd(),n.lineStart(),n.point(a,t),n.point(s,t),i=0):r!==a&&c>=Pt&&(Zt(e-r)<bt&&(e-=r*bt),Zt(s-a)<bt&&(s-=a*bt),t=rM(e,t,s,o),n.point(r,t),n.lineEnd(),n.lineStart(),n.point(a,t),i=0),n.point(e=s,t=o),r=a},lineEnd:function(){n.lineEnd(),e=t=NaN},clean:function(){return 2-i}}}function rM(n,e,t,r){var i,s,o=ot(n-t);return Zt(o)>bt?a1((ot(e)*(s=ft(r))*ot(t)-ot(r)*(i=ft(e))*ot(n))/(i*s*o)):(e+r)/2}function iM(n,e,t,r){var i;if(n==null)i=t*Ir,r.point(-Pt,i),r.point(0,i),r.point(Pt,i),r.point(Pt,0),r.point(Pt,-i),r.point(0,-i),r.point(-Pt,-i),r.point(-Pt,0),r.point(-Pt,i);else if(Zt(n[0]-e[0])>bt){var s=n[0]<e[0]?Pt:-Pt;i=t*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(e[0],e[1])}function sM(n){var e=ft(n),t=2*At,r=e>0,i=Zt(e)>bt;function s(p,g,v,b){J9(b,n,t,v,p,g)}function o(p,g){return ft(p)*ft(g)>e}function a(p){var g,v,b,T,S;return{lineStart:function(){T=b=!1,S=1},point:function(N,C){var P=[N,C],B,F=o(N,C),q=r?F?0:f(N,C):F?f(N+(N<0?Pt:-Pt),C):0;if(!g&&(T=b=F)&&p.lineStart(),F!==b&&(B=c(g,P),(!B||w0(g,B)||w0(P,B))&&(P[2]=1)),F!==b)S=0,F?(p.lineStart(),B=c(P,g),p.point(B[0],B[1])):(B=c(g,P),p.point(B[0],B[1],2),p.lineEnd()),g=B;else if(i&&g&&r^F){var I;!(q&v)&&(I=c(P,g,!0))&&(S=0,r?(p.lineStart(),p.point(I[0][0],I[0][1]),p.point(I[1][0],I[1][1]),p.lineEnd()):(p.point(I[1][0],I[1][1]),p.lineEnd(),p.lineStart(),p.point(I[0][0],I[0][1],3)))}F&&(!g||!w0(g,P))&&p.point(P[0],P[1]),g=P,b=F,v=q},lineEnd:function(){b&&p.lineEnd(),g=null},clean:function(){return S|(T&&b)<<1}}}function c(p,g,v){var b=Ga(p),T=Ga(g),S=[1,0,0],N=Zl(b,T),C=Tc(N,N),P=N[0],B=C-P*P;if(!B)return!v&&p;var F=e*C/B,q=-e*P/B,I=Zl(S,N),U=wc(S,F),G=wc(N,q);Od(U,G);var H=I,te=Tc(U,H),W=Tc(H,H),Z=te*te-W*(Tc(U,U)-1);if(!(Z<0)){var re=eo(Z),oe=wc(H,(-te-re)/W);if(Od(oe,U),oe=ah(oe),!v)return oe;var Y=p[0],ae=g[0],he=p[1],be=g[1],pe;ae<Y&&(pe=Y,Y=ae,ae=pe);var Le=ae-Y,Ue=Zt(Le-Pt)<bt,Je=Ue||Le<bt;if(!Ue&&be<he&&(pe=he,he=be,be=pe),Je?Ue?he+be>0^oe[1]<(Zt(oe[0]-Y)<bt?he:be):he<=oe[1]&&oe[1]<=be:Le>Pt^(Y<=oe[0]&&oe[0]<=ae)){var st=wc(H,(-te+re)/W);return Od(st,U),[oe,ah(st)]}}}function f(p,g){var v=r?n:Pt-n,b=0;return p<-v?b|=1:p>v&&(b|=2),g<-v?b|=4:g>v&&(b|=8),b}return d4(o,a,s,r?[0,-n]:[-Pt,n-Pt])}function oM(n,e,t,r,i,s){var o=n[0],a=n[1],c=e[0],f=e[1],p=0,g=1,v=c-o,b=f-a,T;if(T=t-o,!(!v&&T>0)){if(T/=v,v<0){if(T<p)return;T<g&&(g=T)}else if(v>0){if(T>g)return;T>p&&(p=T)}if(T=i-o,!(!v&&T<0)){if(T/=v,v<0){if(T>g)return;T>p&&(p=T)}else if(v>0){if(T<p)return;T<g&&(g=T)}if(T=r-a,!(!b&&T>0)){if(T/=b,b<0){if(T<p)return;T<g&&(g=T)}else if(b>0){if(T>g)return;T>p&&(p=T)}if(T=s-a,!(!b&&T<0)){if(T/=b,b<0){if(T>g)return;T>p&&(p=T)}else if(b>0){if(T<p)return;T<g&&(g=T)}return p>0&&(n[0]=o+p*v,n[1]=a+p*b),g<1&&(e[0]=o+g*v,e[1]=a+g*b),!0}}}}}var Ku=1e9,Ec=-Ku;function aM(n,e,t,r){function i(f,p){return n<=f&&f<=t&&e<=p&&p<=r}function s(f,p,g,v){var b=0,T=0;if(f==null||(b=o(f,g))!==(T=o(p,g))||c(f,p)<0^g>0)do v.point(b===0||b===3?n:t,b>1?r:e);while((b=(b+g+4)%4)!==T);else v.point(p[0],p[1])}function o(f,p){return Zt(f[0]-n)<bt?p>0?0:3:Zt(f[0]-t)<bt?p>0?2:1:Zt(f[1]-e)<bt?p>0?1:0:p>0?3:2}function a(f,p){return c(f.x,p.x)}function c(f,p){var g=o(f,1),v=o(p,1);return g!==v?g-v:g===0?p[1]-f[1]:g===1?f[0]-p[0]:g===2?f[1]-p[1]:p[0]-f[0]}return function(f){var p=f,g=c4(),v,b,T,S,N,C,P,B,F,q,I,U={point:G,lineStart:Z,lineEnd:re,polygonStart:te,polygonEnd:W};function G(Y,ae){i(Y,ae)&&p.point(Y,ae)}function H(){for(var Y=0,ae=0,he=b.length;ae<he;++ae)for(var be=b[ae],pe=1,Le=be.length,Ue=be[0],Je,st,ln=Ue[0],Nt=Ue[1];pe<Le;++pe)Je=ln,st=Nt,Ue=be[pe],ln=Ue[0],Nt=Ue[1],st<=r?Nt>r&&(ln-Je)*(r-st)>(Nt-st)*(n-Je)&&++Y:Nt<=r&&(ln-Je)*(r-st)<(Nt-st)*(n-Je)&&--Y;return Y}function te(){p=g,v=[],b=[],I=!0}function W(){var Y=H(),ae=I&&Y,he=(v=TA(v)).length;(ae||he)&&(f.polygonStart(),ae&&(f.lineStart(),s(null,null,1,f),f.lineEnd()),he&&h4(v,a,Y,s,f),f.polygonEnd()),p=f,v=b=T=null}function Z(){U.point=oe,b&&b.push(T=[]),q=!0,F=!1,P=B=NaN}function re(){v&&(oe(S,N),C&&F&&g.rejoin(),v.push(g.result())),U.point=G,F&&p.lineEnd()}function oe(Y,ae){var he=i(Y,ae);if(b&&T.push([Y,ae]),q)S=Y,N=ae,C=he,q=!1,he&&(p.lineStart(),p.point(Y,ae));else if(he&&F)p.point(Y,ae);else{var be=[P=Math.max(Ec,Math.min(Ku,P)),B=Math.max(Ec,Math.min(Ku,B))],pe=[Y=Math.max(Ec,Math.min(Ku,Y)),ae=Math.max(Ec,Math.min(Ku,ae))];oM(be,pe,n,e,t,r)?(F||(p.lineStart(),p.point(be[0],be[1])),p.point(pe[0],pe[1]),he||p.lineEnd(),I=!1):he&&(p.lineStart(),p.point(Y,ae),I=!1)}P=Y,B=ae,F=he}return U}}var Cm,Mm,S0,E0,Jl={sphere:fr,point:fr,lineStart:lM,lineEnd:fr,polygonStart:fr,polygonEnd:fr};function lM(){Jl.point=AM,Jl.lineEnd=uM}function uM(){Jl.point=Jl.lineEnd=fr}function AM(n,e){n*=At,e*=At,Mm=n,S0=ot(e),E0=ft(e),Jl.point=cM}function cM(n,e){n*=At,e*=At;var t=ot(e),r=ft(e),i=Zt(n-Mm),s=ft(i),o=ot(i),a=r*o,c=E0*t-S0*r*s,f=S0*t+E0*r*s;Cm.add(Ti(eo(a*a+c*c),f)),Mm=n,S0=t,E0=r}function hM(n){return Cm=new Hs,af(n,Jl),+Cm}var Pm=[null,null],fM={type:"LineString",coordinates:Pm};function zo(n,e){return Pm[0]=n,Pm[1]=e,hM(fM)}var r3={Feature:function(n,e){return mh(n.geometry,e)},FeatureCollection:function(n,e){for(var t=n.features,r=-1,i=t.length;++r<i;)if(mh(t[r].geometry,e))return!0;return!1}},i3={Sphere:function(){return!0},Point:function(n,e){return s3(n.coordinates,e)},MultiPoint:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)if(s3(t[r],e))return!0;return!1},LineString:function(n,e){return o3(n.coordinates,e)},MultiLineString:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)if(o3(t[r],e))return!0;return!1},Polygon:function(n,e){return a3(n.coordinates,e)},MultiPolygon:function(n,e){for(var t=n.coordinates,r=-1,i=t.length;++r<i;)if(a3(t[r],e))return!0;return!1},GeometryCollection:function(n,e){for(var t=n.geometries,r=-1,i=t.length;++r<i;)if(mh(t[r],e))return!0;return!1}};function mh(n,e){return n&&i3.hasOwnProperty(n.type)?i3[n.type](n,e):!1}function s3(n,e){return zo(n,e)===0}function o3(n,e){for(var t,r,i,s=0,o=n.length;s<o;s++){if(r=zo(n[s],e),r===0||s>0&&(i=zo(n[s],n[s-1]),i>0&&t<=i&&r<=i&&(t+r-i)*(1-Math.pow((t-r)/i,2))<rh*i))return!0;t=r}return!1}function a3(n,e){return!!f4(n.map(dM),p4(e))}function dM(n){return n=n.map(p4),n.pop(),n}function p4(n){return[n[0]*At,n[1]*At]}function pM(n,e){return(n&&r3.hasOwnProperty(n.type)?r3[n.type]:mh)(n,e)}function l3(n,e,t){var r=Ml(n,e-bt,t).concat(e);return function(i){return r.map(function(s){return[i,s]})}}function u3(n,e,t){var r=Ml(n,e-bt,t).concat(e);return function(i){return r.map(function(s){return[s,i]})}}function mM(){var n,e,t,r,i,s,o,a,c=10,f=c,p=90,g=360,v,b,T,S,N=2.5;function C(){return{type:"MultiLineString",coordinates:P()}}function P(){return Ml(bc(r/p)*p,t,p).map(T).concat(Ml(bc(a/g)*g,o,g).map(S)).concat(Ml(bc(e/c)*c,n,c).filter(function(B){return Zt(B%p)>bt}).map(v)).concat(Ml(bc(s/f)*f,i,f).filter(function(B){return Zt(B%g)>bt}).map(b))}return C.lines=function(){return P().map(function(B){return{type:"LineString",coordinates:B}})},C.outline=function(){return{type:"Polygon",coordinates:[T(r).concat(S(o).slice(1),T(t).reverse().slice(1),S(a).reverse().slice(1))]}},C.extent=function(B){return arguments.length?C.extentMajor(B).extentMinor(B):C.extentMinor()},C.extentMajor=function(B){return arguments.length?(r=+B[0][0],t=+B[1][0],a=+B[0][1],o=+B[1][1],r>t&&(B=r,r=t,t=B),a>o&&(B=a,a=o,o=B),C.precision(N)):[[r,a],[t,o]]},C.extentMinor=function(B){return arguments.length?(e=+B[0][0],n=+B[1][0],s=+B[0][1],i=+B[1][1],e>n&&(B=e,e=n,n=B),s>i&&(B=s,s=i,i=B),C.precision(N)):[[e,s],[n,i]]},C.step=function(B){return arguments.length?C.stepMajor(B).stepMinor(B):C.stepMinor()},C.stepMajor=function(B){return arguments.length?(p=+B[0],g=+B[1],C):[p,g]},C.stepMinor=function(B){return arguments.length?(c=+B[0],f=+B[1],C):[c,f]},C.precision=function(B){return arguments.length?(N=+B,v=l3(s,i,90),b=u3(e,n,N),T=l3(a,o,90),S=u3(r,t,N),C):N},C.extentMajor([[-180,-90+bt],[180,90-bt]]).extentMinor([[-180,-80-bt],[180,80+bt]])}function gM(){return mM()()}function u1(n,e){var t=n[0]*At,r=n[1]*At,i=e[0]*At,s=e[1]*At,o=ft(r),a=ot(r),c=ft(s),f=ot(s),p=o*ft(t),g=o*ot(t),v=c*ft(i),b=c*ot(i),T=2*to(eo(qy(s-r)+o*c*qy(i-t))),S=ot(T),N=T?function(C){var P=ot(C*=T)/S,B=ot(T-C)/S,F=B*p+P*v,q=B*g+P*b,I=B*a+P*f;return[Ti(q,F)*En,Ti(I,eo(F*F+q*q))*En]}:function(){return[t*En,r*En]};return N.distance=T,N}const A3=n=>n;var eu=1/0,gh=eu,NA=-eu,_h=NA,c3={point:_M,lineStart:fr,lineEnd:fr,polygonStart:fr,polygonEnd:fr,result:function(){var n=[[eu,gh],[NA,_h]];return NA=_h=-(gh=eu=1/0),n}};function _M(n,e){n<eu&&(eu=n),n>NA&&(NA=n),e<gh&&(gh=e),e>_h&&(_h=e)}function A1(n){return function(e){var t=new Bm;for(var r in n)t[r]=n[r];return t.stream=e,t}}function Bm(){}Bm.prototype={constructor:Bm,point:function(n,e){this.stream.point(n,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function c1(n,e,t){var r=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),r!=null&&n.clipExtent(null),af(t,n.stream(c3)),e(c3.result()),r!=null&&n.clipExtent(r),n}function m4(n,e,t){return c1(n,function(r){var i=e[1][0]-e[0][0],s=e[1][1]-e[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+e[0][0]+(i-o*(r[1][0]+r[0][0]))/2,c=+e[0][1]+(s-o*(r[1][1]+r[0][1]))/2;n.scale(150*o).translate([a,c])},t)}function yM(n,e,t){return m4(n,[[0,0],e],t)}function vM(n,e,t){return c1(n,function(r){var i=+e,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];n.scale(150*s).translate([o,a])},t)}function xM(n,e,t){return c1(n,function(r){var i=+e,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;n.scale(150*s).translate([o,a])},t)}var h3=16,bM=ft(30*At);function f3(n,e){return+e?wM(n,e):TM(n)}function TM(n){return A1({point:function(e,t){e=n(e,t),this.stream.point(e[0],e[1])}})}function wM(n,e){function t(r,i,s,o,a,c,f,p,g,v,b,T,S,N){var C=f-r,P=p-i,B=C*C+P*P;if(B>4*e&&S--){var F=o+v,q=a+b,I=c+T,U=eo(F*F+q*q+I*I),G=to(I/=U),H=Zt(Zt(I)-1)<bt||Zt(s-g)<bt?(s+g)/2:Ti(q,F),te=n(H,G),W=te[0],Z=te[1],re=W-r,oe=Z-i,Y=P*re-C*oe;(Y*Y/B>e||Zt((C*re+P*oe)/B-.5)>.3||o*v+a*b+c*T<bM)&&(t(r,i,s,o,a,c,W,Z,H,F/=U,q/=U,I,S,N),N.point(W,Z),t(W,Z,H,F,q,I,f,p,g,v,b,T,S,N))}}return function(r){var i,s,o,a,c,f,p,g,v,b,T,S,N={point:C,lineStart:P,lineEnd:F,polygonStart:function(){r.polygonStart(),N.lineStart=q},polygonEnd:function(){r.polygonEnd(),N.lineStart=P}};function C(G,H){G=n(G,H),r.point(G[0],G[1])}function P(){g=NaN,N.point=B,r.lineStart()}function B(G,H){var te=Ga([G,H]),W=n(G,H);t(g,v,p,b,T,S,g=W[0],v=W[1],p=G,b=te[0],T=te[1],S=te[2],h3,r),r.point(g,v)}function F(){N.point=C,r.lineEnd()}function q(){P(),N.point=I,N.lineEnd=U}function I(G,H){B(i=G,H),s=g,o=v,a=b,c=T,f=S,N.point=B}function U(){t(g,v,p,b,T,S,s,o,i,a,c,f,h3,r),N.lineEnd=F,F()}return N}}var SM=A1({point:function(n,e){this.stream.point(n*At,e*At)}});function EM(n){return A1({point:function(e,t){var r=n(e,t);return this.stream.point(r[0],r[1])}})}function NM(n,e,t,r,i){function s(o,a){return o*=r,a*=i,[e+n*o,t-n*a]}return s.invert=function(o,a){return[(o-e)/n*r,(t-a)/n*i]},s}function d3(n,e,t,r,i,s){if(!s)return NM(n,e,t,r,i);var o=ft(s),a=ot(s),c=o*n,f=a*n,p=o/n,g=a/n,v=(a*t-o*e)/n,b=(a*e+o*t)/n;function T(S,N){return S*=r,N*=i,[c*S-f*N+e,t-f*S-c*N]}return T.invert=function(S,N){return[r*(p*S-g*N+v),i*(b-g*S-p*N)]},T}function RM(n){return CM(function(){return n})()}function CM(n){var e,t=150,r=480,i=250,s=0,o=0,a=0,c=0,f=0,p,g=0,v=1,b=1,T=null,S=n3,N=null,C,P,B,F=A3,q=.5,I,U,G,H,te;function W(Y){return G(Y[0]*At,Y[1]*At)}function Z(Y){return Y=G.invert(Y[0],Y[1]),Y&&[Y[0]*En,Y[1]*En]}W.stream=function(Y){return H&&te===Y?H:H=SM(EM(p)(S(I(F(te=Y)))))},W.preclip=function(Y){return arguments.length?(S=Y,T=void 0,oe()):S},W.postclip=function(Y){return arguments.length?(F=Y,N=C=P=B=null,oe()):F},W.clipAngle=function(Y){return arguments.length?(S=+Y?sM(T=Y*At):(T=null,n3),oe()):T*En},W.clipExtent=function(Y){return arguments.length?(F=Y==null?(N=C=P=B=null,A3):aM(N=+Y[0][0],C=+Y[0][1],P=+Y[1][0],B=+Y[1][1]),oe()):N==null?null:[[N,C],[P,B]]},W.scale=function(Y){return arguments.length?(t=+Y,re()):t},W.translate=function(Y){return arguments.length?(r=+Y[0],i=+Y[1],re()):[r,i]},W.center=function(Y){return arguments.length?(s=Y[0]%360*At,o=Y[1]%360*At,re()):[s*En,o*En]},W.rotate=function(Y){return arguments.length?(a=Y[0]%360*At,c=Y[1]%360*At,f=Y.length>2?Y[2]%360*At:0,re()):[a*En,c*En,f*En]},W.angle=function(Y){return arguments.length?(g=Y%360*At,re()):g*En},W.reflectX=function(Y){return arguments.length?(v=Y?-1:1,re()):v<0},W.reflectY=function(Y){return arguments.length?(b=Y?-1:1,re()):b<0},W.precision=function(Y){return arguments.length?(I=f3(U,q=Y*Y),oe()):eo(q)},W.fitExtent=function(Y,ae){return m4(W,Y,ae)},W.fitSize=function(Y,ae){return yM(W,Y,ae)},W.fitWidth=function(Y,ae){return vM(W,Y,ae)},W.fitHeight=function(Y,ae){return xM(W,Y,ae)};function re(){var Y=d3(t,0,0,v,b,g).apply(null,e(s,o)),ae=d3(t,r-Y[0],i-Y[1],v,b,g);return p=A4(a,c,f),U=Nm(e,ae),G=Nm(p,U),I=f3(U,q),oe()}function oe(){return H=te=null,W}return function(){return e=n.apply(this,arguments),W.invert=e.invert&&Z,re()}}function MM(n){return function(e,t){var r=eo(e*e+t*t),i=n(r),s=ot(i),o=ft(i);return[Ti(e*s,r*o),to(r&&t*s/r)]}}function h1(n,e){return[n,I9(U9((Ir+e)/2))]}h1.invert=function(n,e){return[n,2*a1(O9(e))-Ir]};function g4(n,e){var t=ft(e),r=1+ft(n)*t;return[t*ot(n)/r,ot(e)/r]}g4.invert=MM(function(n){return 2*a1(n)});function PM(){return RM(g4).scale(250).clipAngle(142)}function Dm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function BM(n){if(Array.isArray(n))return n}function DM(n){if(Array.isArray(n))return Dm(n)}function uA(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function LM(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function FM(n,e,t){return e=yh(e),jM(n,y4()?Reflect.construct(e,[],yh(n).constructor):e.apply(n,t))}function _4(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function OM(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(n,e){return n.get(uA(n,e))}function yo(n,e,t){_4(n,e),e.set(n,t)}function vo(n,e,t){return n.set(uA(n,e),t),t}function IM(n,e){_4(n,e),e.add(n)}function kM(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,x4(r.key),r)}}function UM(n,e,t){return e&&kM(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function al(n,e,t){return(e=x4(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function yh(n){return yh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yh(n)}function qM(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Lm(n,e)}function y4(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(y4=function(){return!!n})()}function GM(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function VM(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function zM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $M(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jM(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LM(n)}function Lm(n,e){return Lm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Lm(n,e)}function N0(n,e){return BM(n)||VM(n,e)||b4(n,e)||zM()}function v4(n){return DM(n)||GM(n)||b4(n)||$M()}function HM(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function x4(n){var e=HM(n,"string");return typeof e=="symbol"?e:e+""}function b4(n,e){if(n){if(typeof n=="string")return Dm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Dm(n,e):void 0}}var T4=function(e){e instanceof Array?e.forEach(T4):(e.map&&e.map.dispose(),e.dispose())},w4=function(e){e.geometry&&e.geometry.dispose(),e.material&&T4(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(w4)},p3=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),w4(t)}};function S4(n,e,t){var r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180;return{x:t*Math.sin(r)*Math.cos(i),y:t*Math.cos(r),z:t*Math.sin(r)*Math.sin(i)}}function WM(n){var e=n.x,t=n.y,r=n.z,i=Math.sqrt(e*e+t*t+r*r),s=Math.acos(t/i),o=Math.atan2(r,e);return{lat:90-s*180/Math.PI,lng:90-o*180/Math.PI-(o<-Math.PI/2?360:0),r:i}}function la(n){return n*Math.PI/180}var E4=function(e){return 1-(h1(0,(.5-e)*Math.PI)[1]/Math.PI+1)/2},kd=function(e){return Math.max(0,Math.min(1,E4(e)))},m3=function(e){return .5-h1.invert(0,(2*(1-e)-1)*Math.PI)[1]/Math.PI},QM=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=Js().domain([1,0]).range([t,r]).clamp(!0),s=Js().domain([kd(t),kd(r)]).range([1,0]).clamp(!0),o=function(g){return s(kd(i(g)))},a=e.array,c=0,f=a.length;c<f;c+=2)a[c+1]=o(a[c+1]);e.needsUpdate=!0},g3=function(e,t,r,i){var s=Math.pow(2,e),o=Math.max(0,Math.min(s-1,Math.floor((r+180)*s/360))),a=(90-i)/180;t&&(a=Math.max(0,Math.min(1,E4(a))));var c=Math.floor(a*s);return[o,c]},Fm=function(e,t){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,a=[],c=Math.pow(2,e),f=360/c,p=180/c,g=s===void 0?c-1:s,v=o===void 0?c-1:o,b=r,T=Math.min(c-1,g);b<=T;b++)for(var S=i,N=Math.min(c-1,v);S<=N;S++){var C=S,P=p;if(t){C=S===0?S:m3(S/c)*c;var B=S+1===c?S+1:m3((S+1)/c)*c;P=(B-C)*180/c}var F=-180+(b+.5)*f,q=90-(C*180/c+P/2),I=P;a.push({x:b,y:S,lng:F,lat:q,latLen:I})}return a},YM=6,XM=7,KM=3,ZM=90,us=new WeakMap,Mo=new WeakMap,Ud=new WeakMap,Nc=new WeakMap,fi=new WeakMap,vh=new WeakMap,ql=new WeakMap,ua=new WeakMap,Rc=new WeakSet,JM=(function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.tileUrl,o=i.minLevel,a=o===void 0?0:o,c=i.maxLevel,f=c===void 0?17:c,p=i.mercatorProjection,g=p===void 0?!0:p;return OM(this,e),r=FM(this,e),IM(r,Rc),yo(r,us,void 0),yo(r,Mo,void 0),yo(r,Ud,void 0),yo(r,Nc,void 0),yo(r,fi,{}),yo(r,vh,void 0),yo(r,ql,void 0),yo(r,ua,void 0),al(r,"minLevel",void 0),al(r,"maxLevel",void 0),al(r,"thresholds",v4(new Array(30)).map(function(v,b){return 8/Math.pow(2,b)})),al(r,"curvatureResolution",5),al(r,"tileMargin",0),al(r,"clearTiles",function(){Object.values(yt(fi,r)).forEach(function(v){v.forEach(function(b){b.obj&&(r.remove(b.obj),p3(b.obj),delete b.obj)})}),vo(fi,r,{})}),vo(us,r,t),r.tileUrl=s,vo(Mo,r,g),r.minLevel=a,r.maxLevel=f,r.level=0,r.add(vo(ua,r,new pn(new Wo(yt(us,r)*.99,180,90),new cs({color:0})))),yt(ua,r).visible=!1,yt(ua,r).material.polygonOffset=!0,yt(ua,r).material.polygonOffsetUnits=3,yt(ua,r).material.polygonOffsetFactor=1,r}return qM(e,n),UM(e,[{key:"tileUrl",get:function(){return yt(Ud,this)},set:function(r){vo(Ud,this,r),this.updatePov(yt(ql,this))}},{key:"level",get:function(){return yt(Nc,this)},set:function(r){var i,s=this;yt(fi,this)[r]||uA(Rc,this,eP).call(this,r);var o=yt(Nc,this);if(vo(Nc,this,r),!(r===o||o===void 0)){if(yt(ua,this).visible=r>0,yt(fi,this)[r].forEach(function(c){return c.obj&&(c.obj.material.depthWrite=!0)}),o<r&&((i=yt(fi,this)[o])===null||i===void 0||i.forEach(function(c){return c.obj&&(c.obj.material.depthWrite=!1)})),o>r)for(var a=r+1;a<=o;a++)yt(fi,this)[a]&&yt(fi,this)[a].forEach(function(c){c.obj&&(s.remove(c.obj),p3(c.obj),delete c.obj)});uA(Rc,this,_3).call(this)}}},{key:"updatePov",value:function(r){var i=this;if(!(!r||!(r instanceof Lg))){vo(ql,this,r);var s;if(vo(vh,this,function(p){if(!p.hullPnts){var g=360/Math.pow(2,i.level),v=p.lng,b=p.lat,T=p.latLen,S=v-g/2,N=v+g/2,C=b-T/2,P=b+T/2;p.hullPnts=[[b,v],[C,S],[P,S],[C,N],[P,N]].map(function(B){var F=N0(B,2),q=F[0],I=F[1];return S4(q,I,yt(us,i))}).map(function(B){var F=B.x,q=B.y,I=B.z;return new we(F,q,I)})}return s||(s=new $x,r.updateMatrix(),r.updateMatrixWorld(),s.setFromProjectionMatrix(new hn().multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse))),p.hullPnts.some(function(B){return s.containsPoint(B.clone().applyMatrix4(i.matrixWorld))})}),this.tileUrl){var o=r.position.clone(),a=o.distanceTo(this.getWorldPosition(new we)),c=(a-yt(us,this))/yt(us,this),f=this.thresholds.findIndex(function(p){return p&&p<=c});this.level=Math.min(this.maxLevel,Math.max(this.minLevel,f<0?this.thresholds.length:f)),uA(Rc,this,_3).call(this)}}}}])})(Ms);function eP(n){var e=this;if(n>XM){yt(fi,this)[n]=[];return}var t=yt(fi,this)[n]=Fm(n,yt(Mo,this));t.forEach(function(r){return r.centroid=S4(r.lat,r.lng,yt(us,e))}),t.octree=kb().x(function(r){return r.centroid.x}).y(function(r){return r.centroid.y}).z(function(r){return r.centroid.z}).addAll(t)}function _3(){var n=this;if(!(!this.tileUrl||this.level===void 0||!yt(fi,this).hasOwnProperty(this.level))&&!(!yt(vh,this)&&this.level>YM)){var e=yt(fi,this)[this.level];if(yt(ql,this)){var t=this.worldToLocal(yt(ql,this).position.clone());if(e.octree){var r,i=this.worldToLocal(yt(ql,this).position.clone()),s=(i.length()-yt(us,this))*KM;e=(r=e.octree).findAllWithinRadius.apply(r,v4(i).concat([s]))}else{var o=WM(t),a=(o.r/yt(us,this)-1)*ZM,c=a/Math.cos(la(o.lat)),f=[o.lng-c,o.lng+c],p=[o.lat+a,o.lat-a],g=g3(this.level,yt(Mo,this),f[0],p[0]),v=N0(g,2),b=v[0],T=v[1],S=g3(this.level,yt(Mo,this),f[1],p[1]),N=N0(S,2),C=N[0],P=N[1];!e.record&&(e.record={});var B=e.record;if(!B.hasOwnProperty("".concat(Math.round((b+C)/2),"_").concat(Math.round((T+P)/2))))e=Fm(this.level,yt(Mo,this),b,T,C,P).map(function(G){var H="".concat(G.x,"_").concat(G.y);return B.hasOwnProperty(H)?B[H]:(B[H]=G,e.push(G),G)});else{for(var F=[],q=b;q<=C;q++)for(var I=T;I<=P;I++){var U="".concat(q,"_").concat(I);B.hasOwnProperty(U)||(B[U]=Fm(this.level,yt(Mo,this),q,I,q,I)[0],e.push(B[U])),F.push(B[U])}e=F}}}e.filter(function(G){return!G.obj}).filter(yt(vh,this)||function(){return!0}).forEach(function(G){var H=G.x,te=G.y,W=G.lng,Z=G.lat,re=G.latLen,oe=360/Math.pow(2,n.level);if(!G.obj){var Y=oe*(1-n.tileMargin),ae=re*(1-n.tileMargin),he=la(W),be=la(-Z),pe=new pn(new Wo(yt(us,n),Math.ceil(Y/n.curvatureResolution),Math.ceil(ae/n.curvatureResolution),la(90-Y/2)+he,la(Y),la(90-ae/2)+be,la(ae)),new ao);if(yt(Mo,n)){var Le=[Z+re/2,Z-re/2].map(function(ln){return .5-ln/180}),Ue=N0(Le,2),Je=Ue[0],st=Ue[1];QM(pe.geometry.attributes.uv,Je,st)}G.obj=pe}G.loading||(G.loading=!0,new Fg().load(n.tileUrl(H,te,n.level),function(ln){var Nt=G.obj;Nt&&(ln.colorSpace=$A,Nt.material.map=ln,Nt.material.color=null,Nt.material.needsUpdate=!0,n.add(Nt)),G.loading=!1}))})}}function tP(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let s=N4(n,0,i,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,f;if(r&&(s=oP(n,e,s,t)),n.length>80*t){a=n[0],c=n[1];let p=a,g=c;for(let v=t;v<i;v+=t){const b=n[v],T=n[v+1];b<a&&(a=b),T<c&&(c=T),b>p&&(p=b),T>g&&(g=T)}f=Math.max(p-a,g-c),f=f!==0?32767/f:0}return RA(s,o,t,a,c,f,0),o}function N4(n,e,t,r,i){let s;if(i===gP(n,e,t,r)>0)for(let o=e;o<t;o+=r)s=y3(o/r|0,n[o],n[o+1],s);else for(let o=t-r;o>=e;o-=r)s=y3(o/r|0,n[o],n[o+1],s);return s&&tu(s,s.next)&&(MA(s),s=s.next),s}function Va(n,e){if(!n)return n;e||(e=n);let t=n,r;do if(r=!1,!t.steiner&&(tu(t,t.next)||bn(t.prev,t,t.next)===0)){if(MA(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function RA(n,e,t,r,i,s,o){if(!n)return;!o&&s&&cP(n,r,i,s);let a=n;for(;n.prev!==n.next;){const c=n.prev,f=n.next;if(s?rP(n,r,i,s):nP(n)){e.push(c.i,n.i,f.i),MA(n),n=f.next,a=f.next;continue}if(n=f,n===a){o?o===1?(n=iP(Va(n),e),RA(n,e,t,r,i,s,2)):o===2&&sP(n,e,t,r,i,s):RA(Va(n),e,t,r,i,s,1);break}}}function nP(n){const e=n.prev,t=n,r=n.next;if(bn(e,t,r)>=0)return!1;const i=e.x,s=t.x,o=r.x,a=e.y,c=t.y,f=r.y,p=Math.min(i,s,o),g=Math.min(a,c,f),v=Math.max(i,s,o),b=Math.max(a,c,f);let T=r.next;for(;T!==e;){if(T.x>=p&&T.x<=v&&T.y>=g&&T.y<=b&&Zu(i,a,s,c,o,f,T.x,T.y)&&bn(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function rP(n,e,t,r){const i=n.prev,s=n,o=n.next;if(bn(i,s,o)>=0)return!1;const a=i.x,c=s.x,f=o.x,p=i.y,g=s.y,v=o.y,b=Math.min(a,c,f),T=Math.min(p,g,v),S=Math.max(a,c,f),N=Math.max(p,g,v),C=Om(b,T,e,t,r),P=Om(S,N,e,t,r);let B=n.prevZ,F=n.nextZ;for(;B&&B.z>=C&&F&&F.z<=P;){if(B.x>=b&&B.x<=S&&B.y>=T&&B.y<=N&&B!==i&&B!==o&&Zu(a,p,c,g,f,v,B.x,B.y)&&bn(B.prev,B,B.next)>=0||(B=B.prevZ,F.x>=b&&F.x<=S&&F.y>=T&&F.y<=N&&F!==i&&F!==o&&Zu(a,p,c,g,f,v,F.x,F.y)&&bn(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;B&&B.z>=C;){if(B.x>=b&&B.x<=S&&B.y>=T&&B.y<=N&&B!==i&&B!==o&&Zu(a,p,c,g,f,v,B.x,B.y)&&bn(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;F&&F.z<=P;){if(F.x>=b&&F.x<=S&&F.y>=T&&F.y<=N&&F!==i&&F!==o&&Zu(a,p,c,g,f,v,F.x,F.y)&&bn(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function iP(n,e){let t=n;do{const r=t.prev,i=t.next.next;!tu(r,i)&&C4(r,t,t.next,i)&&CA(r,i)&&CA(i,r)&&(e.push(r.i,t.i,i.i),MA(t),MA(t.next),t=n=i),t=t.next}while(t!==n);return Va(t)}function sP(n,e,t,r,i,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&dP(o,a)){let c=M4(o,a);o=Va(o,o.next),c=Va(c,c.next),RA(o,e,t,r,i,s,0),RA(c,e,t,r,i,s,0);return}a=a.next}o=o.next}while(o!==n)}function oP(n,e,t,r){const i=[];for(let s=0,o=e.length;s<o;s++){const a=e[s]*r,c=s<o-1?e[s+1]*r:n.length,f=N4(n,a,c,r,!1);f===f.next&&(f.steiner=!0),i.push(fP(f))}i.sort(aP);for(let s=0;s<i.length;s++)t=lP(i[s],t);return t}function aP(n,e){let t=n.x-e.x;if(t===0&&(t=n.y-e.y,t===0)){const r=(n.next.y-n.y)/(n.next.x-n.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=r-i}return t}function lP(n,e){const t=uP(n,e);if(!t)return e;const r=M4(t,n);return Va(r,r.next),Va(t,t.next)}function uP(n,e){let t=e;const r=n.x,i=n.y;let s=-1/0,o;if(tu(n,t))return t;do{if(tu(n,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const g=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(g<=r&&g>s&&(s=g,o=t.x<t.next.x?t:t.next,g===r))return o}t=t.next}while(t!==e);if(!o)return null;const a=o,c=o.x,f=o.y;let p=1/0;t=o;do{if(r>=t.x&&t.x>=c&&r!==t.x&&R4(i<f?r:s,i,c,f,i<f?s:r,i,t.x,t.y)){const g=Math.abs(i-t.y)/(r-t.x);CA(t,n)&&(g<p||g===p&&(t.x>o.x||t.x===o.x&&AP(o,t)))&&(o=t,p=g)}t=t.next}while(t!==a);return o}function AP(n,e){return bn(n.prev,n,e.prev)<0&&bn(e.next,n,n.next)<0}function cP(n,e,t,r){let i=n;do i.z===0&&(i.z=Om(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,hP(i)}function hP(n){let e,t=1;do{let r=n,i;n=null;let s=null;for(e=0;r;){e++;let o=r,a=0;for(let f=0;f<t&&(a++,o=o.nextZ,!!o);f++);let c=t;for(;a>0||c>0&&o;)a!==0&&(c===0||!o||r.z<=o.z)?(i=r,r=r.nextZ,a--):(i=o,o=o.nextZ,c--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;r=o}s.nextZ=null,t*=2}while(e>1);return n}function Om(n,e,t,r,i){return n=(n-t)*i|0,e=(e-r)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function fP(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function R4(n,e,t,r,i,s,o,a){return(i-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(r-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(r-a)}function Zu(n,e,t,r,i,s,o,a){return!(n===o&&e===a)&&R4(n,e,t,r,i,s,o,a)}function dP(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!pP(n,e)&&(CA(n,e)&&CA(e,n)&&mP(n,e)&&(bn(n.prev,n,e.prev)||bn(n,e.prev,e))||tu(n,e)&&bn(n.prev,n,n.next)>0&&bn(e.prev,e,e.next)>0)}function bn(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function tu(n,e){return n.x===e.x&&n.y===e.y}function C4(n,e,t,r){const i=Mc(bn(n,e,t)),s=Mc(bn(n,e,r)),o=Mc(bn(t,r,n)),a=Mc(bn(t,r,e));return!!(i!==s&&o!==a||i===0&&Cc(n,t,e)||s===0&&Cc(n,r,e)||o===0&&Cc(t,n,r)||a===0&&Cc(t,e,r))}function Cc(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function Mc(n){return n>0?1:n<0?-1:0}function pP(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&C4(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function CA(n,e){return bn(n.prev,n,n.next)<0?bn(n,e,n.next)>=0&&bn(n,n.prev,e)>=0:bn(n,e,n.prev)<0||bn(n,n.next,e)<0}function mP(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function M4(n,e){const t=Im(n.i,n.x,n.y),r=Im(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function y3(n,e,t,r){const i=Im(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function MA(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Im(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function gP(n,e,t,r){let i=0;for(let s=e,o=t-r;s<t;s+=r)i+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return i}function xh(n){const e=[],t=[],r=n[0][0].length;let i=0,s=0;for(const o of n){for(const a of o)for(let c=0;c<r;c++)e.push(a[c]);s&&(i+=s,t.push(i)),s=o.length}return{vertices:e,holes:t,dimensions:r}}function km(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function _P(n){if(Array.isArray(n))return n}function yP(n){if(Array.isArray(n))return km(n)}function vP(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function xP(n,e,t){return e=bh(e),MP(n,P4()?Reflect.construct(e,[],bh(n).constructor):e.apply(n,t))}function bP(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function TP(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function wP(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=f1(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){t=t.call(n)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||t.return==null||t.return()}finally{if(a)throw s}}}}function bh(n){return bh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},bh(n)}function SP(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Um(n,e)}function P4(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(P4=function(){return!!n})()}function EP(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function NP(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function RP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CP(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MP(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vP(n)}function Um(n,e){return Um=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Um(n,e)}function Eu(n,e){return _P(n)||NP(n,e)||f1(n,e)||RP()}function PP(n){return yP(n)||EP(n)||f1(n)||CP()}function f1(n,e){if(n){if(typeof n=="string")return km(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?km(n,e):void 0}}var v3=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=[],i=null;return e.forEach(function(s){if(i){var o=zo(s,i)*180/Math.PI;if(o>t)for(var a=u1(i,s),c=i.length>2||s.length>2?EA(i[2]||0,s[2]||0):null,f=c?function(v){return[].concat(PP(a(v)),[c(v)])}:a,p=1/Math.ceil(o/t),g=p;g<1;)r.push(f(g)),g+=p}r.push(i=s)}),r},qm=typeof window<"u"&&window.THREE?window.THREE:{BufferGeometry:oi,Float32BufferAttribute:Go},BP=new qm.BufferGeometry().setAttribute?"setAttribute":"addAttribute",B4=(function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:5;bP(this,e),r=xP(this,e),r.type="GeoJsonGeometry",r.parameters={geoJson:t,radius:i,resolution:s};var o=({Point:p,MultiPoint:g,LineString:v,MultiLineString:b,Polygon:T,MultiPolygon:S}[t.type]||function(){return[]})(t.coordinates,i),a=[],c=[],f=0;o.forEach(function(N){var C=a.length;Nu({indices:a,vertices:c},N),r.addGroup(C,a.length-C,f++)}),a.length&&r.setIndex(a),c.length&&r[BP]("position",new qm.Float32BufferAttribute(c,3));function p(N,C){var P=qd(N[1],N[0],C+(N[2]||0)),B=[];return[{vertices:P,indices:B}]}function g(N,C){var P={vertices:[],indices:[]};return N.map(function(B){return p(B,C)}).forEach(function(B){var F=Eu(B,1),q=F[0];Nu(P,q)}),[P]}function v(N,C){for(var P=v3(N,s).map(function(G){var H=Eu(G,3),te=H[0],W=H[1],Z=H[2],re=Z===void 0?0:Z;return qd(W,te,C+re)}),B=xh([P]),F=B.vertices,q=Math.round(F.length/3),I=[],U=1;U<q;U++)I.push(U-1,U);return[{vertices:F,indices:I}]}function b(N,C){var P={vertices:[],indices:[]};return N.map(function(B){return v(B,C)}).forEach(function(B){var F=Eu(B,1),q=F[0];Nu(P,q)}),[P]}function T(N,C){for(var P=N.map(function(Y){return v3(Y,s).map(function(ae){var he=Eu(ae,3),be=he[0],pe=he[1],Le=he[2],Ue=Le===void 0?0:Le;return qd(pe,be,C+Ue)})}),B=xh(P),F=B.vertices,q=B.holes,I=q[0]||1/0,U=F.slice(0,I*3),G=F.slice(I*3),H=new Set(q),te=Math.round(F.length/3),W=[],Z=[],re=1;re<te;re++)H.has(re)||(re<I?W.push(re-1,re):Z.push(re-1-I,re-I));var oe=[{indices:W,vertices:U}];return q.length&&oe.push({indices:Z,vertices:G}),oe}function S(N,C){var P={vertices:[],indices:[]},B={vertices:[],indices:[]};N.map(function(q){return T(q,C)}).forEach(function(q){var I=Eu(q,2),U=I[0],G=I[1];Nu(P,U),G&&Nu(B,G)});var F=[P];return B.vertices.length&&F.push(B),F}return r}return SP(e,n),TP(e)})(qm.BufferGeometry);function Nu(n,e){var t=Math.round(n.vertices.length/3);x3(n.vertices,e.vertices),x3(n.indices,e.indices.map(function(r){return r+t}))}function x3(n,e){var t=wP(e),r;try{for(t.s();!(r=t.n()).done;){var i=r.value;n.push(i)}}catch(s){t.e(s)}finally{t.f()}}function qd(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180;return[t*Math.sin(r)*Math.cos(i),t*Math.cos(r),t*Math.sin(r)*Math.sin(i)]}var ye=(function(n){return typeof n=="function"?n:typeof n=="string"?function(e){return e[n]}:function(e){return n}});function Th(n){"@babel/helpers - typeof";return Th=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Th(n)}var DP=/^\s+/,LP=/\s+$/;function Qe(n,e){if(n=n||"",e=e||{},n instanceof Qe)return n;if(!(this instanceof Qe))return new Qe(n,e);var t=FP(n);this._originalInput=n,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}Qe.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,r,i,s,o,a;return t=e.r/255,r=e.g/255,i=e.b/255,t<=.03928?s=t/12.92:s=Math.pow((t+.055)/1.055,2.4),r<=.03928?o=r/12.92:o=Math.pow((r+.055)/1.055,2.4),i<=.03928?a=i/12.92:a=Math.pow((i+.055)/1.055,2.4),.2126*s+.7152*o+.0722*a},setAlpha:function(e){return this._a=D4(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=T3(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=T3(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+r+"%, "+i+"%)":"hsva("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=b3(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=b3(this._r,this._g,this._b),t=Math.round(e.h*360),r=Math.round(e.s*100),i=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+r+"%, "+i+"%)":"hsla("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return w3(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return UP(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(An(this._r,255)*100)+"%",g:Math.round(An(this._g,255)*100)+"%",b:Math.round(An(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(An(this._r,255)*100)+"%, "+Math.round(An(this._g,255)*100)+"%, "+Math.round(An(this._b,255)*100)+"%)":"rgba("+Math.round(An(this._r,255)*100)+"%, "+Math.round(An(this._g,255)*100)+"%, "+Math.round(An(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:KP[w3(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+S3(this._r,this._g,this._b,this._a),r=t,i=this._gradientType?"GradientType = 1, ":"";if(e){var s=Qe(e);r="#"+S3(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+t+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,i=this._a<1&&this._a>=0,s=!t&&i&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return s?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(r=this.toRgbString()),e==="prgb"&&(r=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(r=this.toHexString()),e==="hex3"&&(r=this.toHexString(!0)),e==="hex4"&&(r=this.toHex8String(!0)),e==="hex8"&&(r=this.toHex8String()),e==="name"&&(r=this.toName()),e==="hsl"&&(r=this.toHslString()),e==="hsv"&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return Qe(this.toString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(zP,arguments)},brighten:function(){return this._applyModification($P,arguments)},darken:function(){return this._applyModification(jP,arguments)},desaturate:function(){return this._applyModification(qP,arguments)},saturate:function(){return this._applyModification(GP,arguments)},greyscale:function(){return this._applyModification(VP,arguments)},spin:function(){return this._applyModification(HP,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(YP,arguments)},complement:function(){return this._applyCombination(WP,arguments)},monochromatic:function(){return this._applyCombination(XP,arguments)},splitcomplement:function(){return this._applyCombination(QP,arguments)},triad:function(){return this._applyCombination(E3,[3])},tetrad:function(){return this._applyCombination(E3,[4])}};Qe.fromRatio=function(n,e){if(Th(n)=="object"){var t={};for(var r in n)n.hasOwnProperty(r)&&(r==="a"?t[r]=n[r]:t[r]=Ju(n[r]));n=t}return Qe(n,e)};function FP(n){var e={r:0,g:0,b:0},t=1,r=null,i=null,s=null,o=!1,a=!1;return typeof n=="string"&&(n=tB(n)),Th(n)=="object"&&(Os(n.r)&&Os(n.g)&&Os(n.b)?(e=OP(n.r,n.g,n.b),o=!0,a=String(n.r).substr(-1)==="%"?"prgb":"rgb"):Os(n.h)&&Os(n.s)&&Os(n.v)?(r=Ju(n.s),i=Ju(n.v),e=kP(n.h,r,i),o=!0,a="hsv"):Os(n.h)&&Os(n.s)&&Os(n.l)&&(r=Ju(n.s),s=Ju(n.l),e=IP(n.h,r,s),o=!0,a="hsl"),n.hasOwnProperty("a")&&(t=n.a)),t=D4(t),{ok:o,format:n.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function OP(n,e,t){return{r:An(n,255)*255,g:An(e,255)*255,b:An(t,255)*255}}function b3(n,e,t){n=An(n,255),e=An(e,255),t=An(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,o,a=(r+i)/2;if(r==i)s=o=0;else{var c=r-i;switch(o=a>.5?c/(2-r-i):c/(r+i),r){case n:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-n)/c+2;break;case t:s=(n-e)/c+4;break}s/=6}return{h:s,s:o,l:a}}function IP(n,e,t){var r,i,s;n=An(n,360),e=An(e,100),t=An(t,100);function o(f,p,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?f+(p-f)*6*g:g<1/2?p:g<2/3?f+(p-f)*(2/3-g)*6:f}if(e===0)r=i=s=t;else{var a=t<.5?t*(1+e):t+e-t*e,c=2*t-a;r=o(c,a,n+1/3),i=o(c,a,n),s=o(c,a,n-1/3)}return{r:r*255,g:i*255,b:s*255}}function T3(n,e,t){n=An(n,255),e=An(e,255),t=An(t,255);var r=Math.max(n,e,t),i=Math.min(n,e,t),s,o,a=r,c=r-i;if(o=r===0?0:c/r,r==i)s=0;else{switch(r){case n:s=(e-t)/c+(e<t?6:0);break;case e:s=(t-n)/c+2;break;case t:s=(n-e)/c+4;break}s/=6}return{h:s,s:o,v:a}}function kP(n,e,t){n=An(n,360)*6,e=An(e,100),t=An(t,100);var r=Math.floor(n),i=n-r,s=t*(1-e),o=t*(1-i*e),a=t*(1-(1-i)*e),c=r%6,f=[t,o,s,s,a,t][c],p=[a,t,t,o,s,s][c],g=[s,s,a,t,t,o][c];return{r:f*255,g:p*255,b:g*255}}function w3(n,e,t,r){var i=[zi(Math.round(n).toString(16)),zi(Math.round(e).toString(16)),zi(Math.round(t).toString(16))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function UP(n,e,t,r,i){var s=[zi(Math.round(n).toString(16)),zi(Math.round(e).toString(16)),zi(Math.round(t).toString(16)),zi(L4(r))];return i&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function S3(n,e,t,r){var i=[zi(L4(r)),zi(Math.round(n).toString(16)),zi(Math.round(e).toString(16)),zi(Math.round(t).toString(16))];return i.join("")}Qe.equals=function(n,e){return!n||!e?!1:Qe(n).toRgbString()==Qe(e).toRgbString()};Qe.random=function(){return Qe.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function qP(n,e){e=e===0?0:e||10;var t=Qe(n).toHsl();return t.s-=e/100,t.s=lf(t.s),Qe(t)}function GP(n,e){e=e===0?0:e||10;var t=Qe(n).toHsl();return t.s+=e/100,t.s=lf(t.s),Qe(t)}function VP(n){return Qe(n).desaturate(100)}function zP(n,e){e=e===0?0:e||10;var t=Qe(n).toHsl();return t.l+=e/100,t.l=lf(t.l),Qe(t)}function $P(n,e){e=e===0?0:e||10;var t=Qe(n).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),Qe(t)}function jP(n,e){e=e===0?0:e||10;var t=Qe(n).toHsl();return t.l-=e/100,t.l=lf(t.l),Qe(t)}function HP(n,e){var t=Qe(n).toHsl(),r=(t.h+e)%360;return t.h=r<0?360+r:r,Qe(t)}function WP(n){var e=Qe(n).toHsl();return e.h=(e.h+180)%360,Qe(e)}function E3(n,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=Qe(n).toHsl(),r=[Qe(n)],i=360/e,s=1;s<e;s++)r.push(Qe({h:(t.h+s*i)%360,s:t.s,l:t.l}));return r}function QP(n){var e=Qe(n).toHsl(),t=e.h;return[Qe(n),Qe({h:(t+72)%360,s:e.s,l:e.l}),Qe({h:(t+216)%360,s:e.s,l:e.l})]}function YP(n,e,t){e=e||6,t=t||30;var r=Qe(n).toHsl(),i=360/t,s=[Qe(n)];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(Qe(r));return s}function XP(n,e){e=e||6;for(var t=Qe(n).toHsv(),r=t.h,i=t.s,s=t.v,o=[],a=1/e;e--;)o.push(Qe({h:r,s:i,v:s})),s=(s+a)%1;return o}Qe.mix=function(n,e,t){t=t===0?0:t||50;var r=Qe(n).toRgb(),i=Qe(e).toRgb(),s=t/100,o={r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a};return Qe(o)};Qe.readability=function(n,e){var t=Qe(n),r=Qe(e);return(Math.max(t.getLuminance(),r.getLuminance())+.05)/(Math.min(t.getLuminance(),r.getLuminance())+.05)};Qe.isReadable=function(n,e,t){var r=Qe.readability(n,e),i,s;switch(s=!1,i=nB(t),i.level+i.size){case"AAsmall":case"AAAlarge":s=r>=4.5;break;case"AAlarge":s=r>=3;break;case"AAAsmall":s=r>=7;break}return s};Qe.mostReadable=function(n,e,t){var r=null,i=0,s,o,a,c;t=t||{},o=t.includeFallbackColors,a=t.level,c=t.size;for(var f=0;f<e.length;f++)s=Qe.readability(n,e[f]),s>i&&(i=s,r=Qe(e[f]));return Qe.isReadable(n,r,{level:a,size:c})||!o?r:(t.includeFallbackColors=!1,Qe.mostReadable(n,["#fff","#000"],t))};var Gm=Qe.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},KP=Qe.hexNames=ZP(Gm);function ZP(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[n[t]]=t);return e}function D4(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function An(n,e){JP(n)&&(n="100%");var t=eB(n);return n=Math.min(e,Math.max(0,parseFloat(n))),t&&(n=parseInt(n*e,10)/100),Math.abs(n-e)<1e-6?1:n%e/parseFloat(e)}function lf(n){return Math.min(1,Math.max(0,n))}function Yr(n){return parseInt(n,16)}function JP(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function eB(n){return typeof n=="string"&&n.indexOf("%")!=-1}function zi(n){return n.length==1?"0"+n:""+n}function Ju(n){return n<=1&&(n=n*100+"%"),n}function L4(n){return Math.round(parseFloat(n)*255).toString(16)}function N3(n){return Yr(n)/255}var Oi=(function(){var n="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+n+")",r="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function Os(n){return!!Oi.CSS_UNIT.exec(n)}function tB(n){n=n.replace(DP,"").replace(LP,"").toLowerCase();var e=!1;if(Gm[n])n=Gm[n],e=!0;else if(n=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=Oi.rgb.exec(n))?{r:t[1],g:t[2],b:t[3]}:(t=Oi.rgba.exec(n))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=Oi.hsl.exec(n))?{h:t[1],s:t[2],l:t[3]}:(t=Oi.hsla.exec(n))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=Oi.hsv.exec(n))?{h:t[1],s:t[2],v:t[3]}:(t=Oi.hsva.exec(n))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=Oi.hex8.exec(n))?{r:Yr(t[1]),g:Yr(t[2]),b:Yr(t[3]),a:N3(t[4]),format:e?"name":"hex8"}:(t=Oi.hex6.exec(n))?{r:Yr(t[1]),g:Yr(t[2]),b:Yr(t[3]),format:e?"name":"hex"}:(t=Oi.hex4.exec(n))?{r:Yr(t[1]+""+t[1]),g:Yr(t[2]+""+t[2]),b:Yr(t[3]+""+t[3]),a:N3(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=Oi.hex3.exec(n))?{r:Yr(t[1]+""+t[1]),g:Yr(t[2]+""+t[2]),b:Yr(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function nB(n){var e,t;return n=n||{level:"AA",size:"small"},e=(n.level||"AA").toUpperCase(),t=(n.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function Vm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function rB(n){if(Array.isArray(n))return n}function iB(n){if(Array.isArray(n))return Vm(n)}function F4(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function sB(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function oB(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function cr(n,e){return n.get(F4(n,e))}function ll(n,e,t){sB(n,e),e.set(n,t)}function Pc(n,e,t){return n.set(F4(n,e),t),t}function aB(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,mB(r.key),r)}}function lB(n,e,t){return e&&aB(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function uB(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function AB(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function cB(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hB(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fB(n,e){return rB(n)||AB(n,e)||O4(n,e)||cB()}function dB(n){return iB(n)||uB(n)||O4(n)||hB()}function pB(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function mB(n){var e=pB(n,"string");return typeof e=="symbol"?e:e+""}function O4(n,e){if(n){if(typeof n=="string")return Vm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Vm(n,e):void 0}}var ul=new WeakMap,Ru=new WeakMap,Al=new WeakMap,Gd=new WeakMap,Vd=new WeakMap,zd=new WeakMap,gB=(function(){function n(){oB(this,n),ll(this,ul,new Map),ll(this,Ru,new Map),ll(this,Al,function(e){return e}),ll(this,Gd,function(){return{}}),ll(this,Vd,function(){}),ll(this,zd,function(){})}return lB(n,[{key:"getObj",value:function(t){return cr(ul,this).get(cr(Al,this).call(this,t))}},{key:"getData",value:function(t){return cr(Ru,this).get(t)}},{key:"entries",value:function(){return dB(cr(Ru,this).entries()).map(function(t){var r=fB(t,2),i=r[0],s=r[1];return[s,i]})}},{key:"id",value:function(t){return Pc(Al,this,ye(t)),this}},{key:"onCreateObj",value:function(t){return Pc(Gd,this,t),this}},{key:"onUpdateObj",value:function(t){return Pc(Vd,this,t),this}},{key:"onRemoveObj",value:function(t){return Pc(zd,this,t),this}},{key:"digest",value:function(t){var r=this;t.filter(function(s){return!cr(ul,r).has(cr(Al,r).call(r,s))}).forEach(function(s){var o=cr(Gd,r).call(r,s);cr(ul,r).set(cr(Al,r).call(r,s),o),cr(Ru,r).set(o,s)});var i=new Map(t.map(function(s){return[cr(Al,r).call(r,s),s]}));return cr(ul,this).forEach(function(s,o){i.has(o)?cr(Vd,r).call(r,s,i.get(o)):(cr(zd,r).call(r,s,o),cr(ul,r).delete(o),cr(Ru,r).delete(s))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])})(),R0={exports:{}},_B=R0.exports,R3;function yB(){return R3||(R3=1,(function(n,e){(function(t,r){n.exports=r()})(_B,function(){return(function(t){function r(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var i={};return r.m=t,r.c=i,r.p="",r(0)})([function(t,r,i){var s=i(1),o=(function(){function a(c,f,p){c===void 0&&(c=NaN),f===void 0&&(f=NaN),p===void 0&&(p=!1),this._minFPS=f,this._maxFPS=c,this._timeScale=1,this._currentTick=0,this._currentTime=0,this._tickDeltaTime=0,this._isRunning=!1,this._maxInterval=isNaN(this._minFPS)?NaN:1e3/this._minFPS,this._minInterval=isNaN(this._maxFPS)?NaN:1e3/this._maxFPS,this._onResume=new s.default,this._onPause=new s.default,this._onTick=new s.default,this._onTickOncePerFrame=new s.default,p||this.resume()}return a.prototype.updateOnce=function(c){c(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},a.prototype.resume=function(){this._isRunning||(this._isRunning=!0,this._lastTimeUpdated=this.getTimer(),this._onResume.dispatch(),this.animateOnce())},a.prototype.pause=function(){this._isRunning&&(this._isRunning=!1,this._onPause.dispatch(),window.cancelAnimationFrame(this._animationFrameHandle))},a.prototype.dispose=function(){this.pause(),this._onResume.removeAll(),this._onPause.removeAll(),this._onTick.removeAll()},Object.defineProperty(a.prototype,"currentTick",{get:function(){return this._currentTick},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentTimeSeconds",{get:function(){return this._currentTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tickDeltaTimeSeconds",{get:function(){return this._tickDeltaTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"timeScale",{get:function(){return this._timeScale},set:function(c){this._timeScale!==c&&(this._timeScale=c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onResume",{get:function(){return this._onResume},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onPause",{get:function(){return this._onPause},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTick",{get:function(){return this._onTick},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"onTickOncePerFrame",{get:function(){return this._onTickOncePerFrame},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),a.prototype.animateOnce=function(){var c=this;this._animationFrameHandle=window.requestAnimationFrame(function(){return c.onFrame()})},a.prototype.onFrame=function(){if(this._now=this.getTimer(),this._frameDeltaTime=this._now-this._lastTimeUpdated,isNaN(this._minInterval)||this._frameDeltaTime>=this._minInterval)if(isNaN(this._maxInterval))this.update(this._frameDeltaTime*this._timeScale,!0),this._lastTimeUpdated=this._now;else for(this._interval=Math.min(this._frameDeltaTime,this._maxInterval);this._now>=this._lastTimeUpdated+this._interval;)this.update(this._interval*this._timeScale,this._now<=this._lastTimeUpdated+2*this._maxInterval),this._lastTimeUpdated+=this._interval;this._isRunning&&this.animateOnce()},a.prototype.update=function(c,f){f===void 0&&(f=!0),this._currentTick++,this._currentTime+=c,this._tickDeltaTime=c,this._onTick.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick),f&&this._onTickOncePerFrame.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},a.prototype.getTimer=function(){return Date.now()},a})();Object.defineProperty(r,"__esModule",{value:!0}),r.default=o},function(t,r,i){(function(s,o){t.exports=o()})(this,function(){return(function(s){function o(c){if(a[c])return a[c].exports;var f=a[c]={exports:{},id:c,loaded:!1};return s[c].call(f.exports,f,f.exports,o),f.loaded=!0,f.exports}var a={};return o.m=s,o.c=a,o.p="",o(0)})([function(s,o){var a=(function(){function c(){this.functions=[]}return c.prototype.add=function(f){return this.functions.indexOf(f)===-1&&(this.functions.push(f),!0)},c.prototype.remove=function(f){var p=this.functions.indexOf(f);return p>-1&&(this.functions.splice(p,1),!0)},c.prototype.removeAll=function(){return this.functions.length>0&&(this.functions.length=0,!0)},c.prototype.dispatch=function(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];var g=this.functions.concat();g.forEach(function(v){v.apply(void 0,f)})},Object.defineProperty(c.prototype,"numItems",{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),c})();Object.defineProperty(o,"__esModule",{value:!0}),o.default=a}])})}])})})(R0)),R0.exports}var vB=yB();const nu=BR(vB),Ws=11102230246251565e-32,hr=134217729,xB=(3+8*Ws)*Ws;function $d(n,e,t,r,i){let s,o,a,c,f=e[0],p=r[0],g=0,v=0;p>f==p>-f?(s=f,f=e[++g]):(s=p,p=r[++v]);let b=0;if(g<n&&v<t)for(p>f==p>-f?(o=f+s,a=s-(o-f),f=e[++g]):(o=p+s,a=s-(o-p),p=r[++v]),s=o,a!==0&&(i[b++]=a);g<n&&v<t;)p>f==p>-f?(o=s+f,c=o-s,a=s-(o-c)+(f-c),f=e[++g]):(o=s+p,c=o-s,a=s-(o-c)+(p-c),p=r[++v]),s=o,a!==0&&(i[b++]=a);for(;g<n;)o=s+f,c=o-s,a=s-(o-c)+(f-c),f=e[++g],s=o,a!==0&&(i[b++]=a);for(;v<t;)o=s+p,c=o-s,a=s-(o-c)+(p-c),p=r[++v],s=o,a!==0&&(i[b++]=a);return(s!==0||b===0)&&(i[b++]=s),b}function bB(n,e){let t=e[0];for(let r=1;r<n;r++)t+=e[r];return t}function QA(n){return new Float64Array(n)}const TB=(3+16*Ws)*Ws,wB=(2+12*Ws)*Ws,SB=(9+64*Ws)*Ws*Ws,cl=QA(4),C3=QA(8),M3=QA(12),P3=QA(16),br=QA(4);function EB(n,e,t,r,i,s,o){let a,c,f,p,g,v,b,T,S,N,C,P,B,F,q,I,U,G;const H=n-i,te=t-i,W=e-s,Z=r-s;F=H*Z,v=hr*H,b=v-(v-H),T=H-b,v=hr*Z,S=v-(v-Z),N=Z-S,q=T*N-(F-b*S-T*S-b*N),I=W*te,v=hr*W,b=v-(v-W),T=W-b,v=hr*te,S=v-(v-te),N=te-S,U=T*N-(I-b*S-T*S-b*N),C=q-U,g=q-C,cl[0]=q-(C+g)+(g-U),P=F+C,g=P-F,B=F-(P-g)+(C-g),C=B-I,g=B-C,cl[1]=B-(C+g)+(g-I),G=P+C,g=G-P,cl[2]=P-(G-g)+(C-g),cl[3]=G;let re=bB(4,cl),oe=wB*o;if(re>=oe||-re>=oe||(g=n-H,a=n-(H+g)+(g-i),g=t-te,f=t-(te+g)+(g-i),g=e-W,c=e-(W+g)+(g-s),g=r-Z,p=r-(Z+g)+(g-s),a===0&&c===0&&f===0&&p===0)||(oe=SB*o+xB*Math.abs(re),re+=H*p+Z*a-(W*f+te*c),re>=oe||-re>=oe))return re;F=a*Z,v=hr*a,b=v-(v-a),T=a-b,v=hr*Z,S=v-(v-Z),N=Z-S,q=T*N-(F-b*S-T*S-b*N),I=c*te,v=hr*c,b=v-(v-c),T=c-b,v=hr*te,S=v-(v-te),N=te-S,U=T*N-(I-b*S-T*S-b*N),C=q-U,g=q-C,br[0]=q-(C+g)+(g-U),P=F+C,g=P-F,B=F-(P-g)+(C-g),C=B-I,g=B-C,br[1]=B-(C+g)+(g-I),G=P+C,g=G-P,br[2]=P-(G-g)+(C-g),br[3]=G;const Y=$d(4,cl,4,br,C3);F=H*p,v=hr*H,b=v-(v-H),T=H-b,v=hr*p,S=v-(v-p),N=p-S,q=T*N-(F-b*S-T*S-b*N),I=W*f,v=hr*W,b=v-(v-W),T=W-b,v=hr*f,S=v-(v-f),N=f-S,U=T*N-(I-b*S-T*S-b*N),C=q-U,g=q-C,br[0]=q-(C+g)+(g-U),P=F+C,g=P-F,B=F-(P-g)+(C-g),C=B-I,g=B-C,br[1]=B-(C+g)+(g-I),G=P+C,g=G-P,br[2]=P-(G-g)+(C-g),br[3]=G;const ae=$d(Y,C3,4,br,M3);F=a*p,v=hr*a,b=v-(v-a),T=a-b,v=hr*p,S=v-(v-p),N=p-S,q=T*N-(F-b*S-T*S-b*N),I=c*f,v=hr*c,b=v-(v-c),T=c-b,v=hr*f,S=v-(v-f),N=f-S,U=T*N-(I-b*S-T*S-b*N),C=q-U,g=q-C,br[0]=q-(C+g)+(g-U),P=F+C,g=P-F,B=F-(P-g)+(C-g),C=B-I,g=B-C,br[1]=B-(C+g)+(g-I),G=P+C,g=G-P,br[2]=P-(G-g)+(C-g),br[3]=G;const he=$d(ae,M3,4,br,P3);return P3[he-1]}function eA(n,e,t,r,i,s){const o=(e-s)*(t-i),a=(n-i)*(r-s),c=o-a,f=Math.abs(o+a);return Math.abs(c)>=TB*f?c:-EB(n,e,t,r,i,s,f)}const B3=Math.pow(2,-52),Bc=new Uint32Array(512);class PA{static from(e,t=PB,r=BB){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=e[o];s[2*o]=t(a),s[2*o+1]=r(a)}return new PA(s)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=e.length>>1;let a=1/0,c=1/0,f=-1/0,p=-1/0;for(let H=0;H<o;H++){const te=e[2*H],W=e[2*H+1];te<a&&(a=te),W<c&&(c=W),te>f&&(f=te),W>p&&(p=W),this._ids[H]=H}const g=(a+f)/2,v=(c+p)/2;let b,T,S;for(let H=0,te=1/0;H<o;H++){const W=jd(g,v,e[2*H],e[2*H+1]);W<te&&(b=H,te=W)}const N=e[2*b],C=e[2*b+1];for(let H=0,te=1/0;H<o;H++){if(H===b)continue;const W=jd(N,C,e[2*H],e[2*H+1]);W<te&&W>0&&(T=H,te=W)}let P=e[2*T],B=e[2*T+1],F=1/0;for(let H=0;H<o;H++){if(H===b||H===T)continue;const te=CB(N,C,P,B,e[2*H],e[2*H+1]);te<F&&(S=H,F=te)}let q=e[2*S],I=e[2*S+1];if(F===1/0){for(let W=0;W<o;W++)this._dists[W]=e[2*W]-e[0]||e[2*W+1]-e[1];Bl(this._ids,this._dists,0,o-1);const H=new Uint32Array(o);let te=0;for(let W=0,Z=-1/0;W<o;W++){const re=this._ids[W],oe=this._dists[re];oe>Z&&(H[te++]=re,Z=oe)}this.hull=H.subarray(0,te),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(eA(N,C,P,B,q,I)<0){const H=T,te=P,W=B;T=S,P=q,B=I,S=H,q=te,I=W}const U=MB(N,C,P,B,q,I);this._cx=U.x,this._cy=U.y;for(let H=0;H<o;H++)this._dists[H]=jd(e[2*H],e[2*H+1],U.x,U.y);Bl(this._ids,this._dists,0,o-1),this._hullStart=b;let G=3;r[b]=t[S]=T,r[T]=t[b]=S,r[S]=t[T]=b,i[b]=0,i[T]=1,i[S]=2,s.fill(-1),s[this._hashKey(N,C)]=b,s[this._hashKey(P,B)]=T,s[this._hashKey(q,I)]=S,this.trianglesLen=0,this._addTriangle(b,T,S,-1,-1,-1);for(let H=0,te,W;H<this._ids.length;H++){const Z=this._ids[H],re=e[2*Z],oe=e[2*Z+1];if(H>0&&Math.abs(re-te)<=B3&&Math.abs(oe-W)<=B3||(te=re,W=oe,Z===b||Z===T||Z===S))continue;let Y=0;for(let Le=0,Ue=this._hashKey(re,oe);Le<this._hashSize&&(Y=s[(Ue+Le)%this._hashSize],!(Y!==-1&&Y!==r[Y]));Le++);Y=t[Y];let ae=Y,he;for(;he=r[ae],eA(re,oe,e[2*ae],e[2*ae+1],e[2*he],e[2*he+1])>=0;)if(ae=he,ae===Y){ae=-1;break}if(ae===-1)continue;let be=this._addTriangle(ae,Z,r[ae],-1,-1,i[ae]);i[Z]=this._legalize(be+2),i[ae]=be,G++;let pe=r[ae];for(;he=r[pe],eA(re,oe,e[2*pe],e[2*pe+1],e[2*he],e[2*he+1])<0;)be=this._addTriangle(pe,Z,he,i[Z],-1,i[pe]),i[Z]=this._legalize(be+2),r[pe]=pe,G--,pe=he;if(ae===Y)for(;he=t[ae],eA(re,oe,e[2*he],e[2*he+1],e[2*ae],e[2*ae+1])<0;)be=this._addTriangle(he,Z,ae,-1,i[ae],i[he]),this._legalize(be+2),i[he]=be,r[ae]=ae,G--,ae=he;this._hullStart=t[Z]=ae,r[ae]=t[pe]=Z,r[Z]=pe,s[this._hashKey(re,oe)]=Z,s[this._hashKey(e[2*ae],e[2*ae+1])]=ae}this.hull=new Uint32Array(G);for(let H=0,te=this._hullStart;H<G;H++)this.hull[H]=te,te=r[te];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(NB(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[e],c=e-e%3;if(o=c+(e+2)%3,a===-1){if(s===0)break;e=Bc[--s];continue}const f=a-a%3,p=c+(e+1)%3,g=f+(a+2)%3,v=t[o],b=t[e],T=t[p],S=t[g];if(RB(i[2*v],i[2*v+1],i[2*b],i[2*b+1],i[2*T],i[2*T+1],i[2*S],i[2*S+1])){t[e]=S,t[a]=v;const C=r[g];if(C===-1){let B=this._hullStart;do{if(this._hullTri[B]===g){this._hullTri[B]=e;break}B=this._hullPrev[B]}while(B!==this._hullStart)}this._link(e,C),this._link(a,r[o]),this._link(o,g);const P=f+(a+1)%3;s<Bc.length&&(Bc[s++]=P)}else{if(s===0)break;e=Bc[--s]}}return o}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function NB(n,e){const t=n/(Math.abs(n)+Math.abs(e));return(e>0?3-t:1+t)/4}function jd(n,e,t,r){const i=n-t,s=e-r;return i*i+s*s}function RB(n,e,t,r,i,s,o,a){const c=n-o,f=e-a,p=t-o,g=r-a,v=i-o,b=s-a,T=c*c+f*f,S=p*p+g*g,N=v*v+b*b;return c*(g*N-S*b)-f*(p*N-S*v)+T*(p*b-g*v)<0}function CB(n,e,t,r,i,s){const o=t-n,a=r-e,c=i-n,f=s-e,p=o*o+a*a,g=c*c+f*f,v=.5/(o*f-a*c),b=(f*p-a*g)*v,T=(o*g-c*p)*v;return b*b+T*T}function MB(n,e,t,r,i,s){const o=t-n,a=r-e,c=i-n,f=s-e,p=o*o+a*a,g=c*c+f*f,v=.5/(o*f-a*c),b=n+(f*p-a*g)*v,T=e+(o*g-c*p)*v;return{x:b,y:T}}function Bl(n,e,t,r){if(r-t<=20)for(let i=t+1;i<=r;i++){const s=n[i],o=e[s];let a=i-1;for(;a>=t&&e[n[a]]>o;)n[a+1]=n[a--];n[a+1]=s}else{const i=t+r>>1;let s=t+1,o=r;Cu(n,i,s),e[n[t]]>e[n[r]]&&Cu(n,t,r),e[n[s]]>e[n[r]]&&Cu(n,s,r),e[n[t]]>e[n[s]]&&Cu(n,t,s);const a=n[s],c=e[a];for(;;){do s++;while(e[n[s]]<c);do o--;while(e[n[o]]>c);if(o<s)break;Cu(n,s,o)}n[t+1]=n[o],n[o]=a,r-s+1>=o-t?(Bl(n,e,s,r),Bl(n,e,t,o-1)):(Bl(n,e,t,o-1),Bl(n,e,s,r))}}function Cu(n,e,t){const r=n[e];n[e]=n[t],n[t]=r}function PB(n){return n[0]}function BB(n){return n[1]}function DB(n,e){var t,r,i=0,s,o,a,c,f,p,g,v=n[0],b=n[1],T=e.length;for(t=0;t<T;t++){r=0;var S=e[t],N=S.length-1;if(p=S[0],p[0]!==S[N][0]&&p[1]!==S[N][1])throw new Error("First and last coordinates in a ring must be the same");for(o=p[0]-v,a=p[1]-b,r;r<N;r++){if(g=S[r+1],c=g[0]-v,f=g[1]-b,a===0&&f===0){if(c<=0&&o>=0||o<=0&&c>=0)return 0}else if(f>=0&&a<=0||f<=0&&a>=0){if(s=eA(o,c,a,f,0,0),s===0)return 0;(s>0&&f>0&&a<=0||s<0&&f<=0&&a>0)&&i++}p=g,a=f,o=c}}return i%2!==0}function LB(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return[...n.geometry.coordinates];if(n.type==="Point")return[...n.coordinates]}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return[...n];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function FB(n){return n.type==="Feature"?n.geometry:n}function OB(n,e,t={}){if(!n)throw new Error("point is required");if(!e)throw new Error("polygon is required");const r=LB(n),i=FB(e),s=i.type,o=e.bbox;let a=i.coordinates;if(o&&IB(r,o)===!1)return!1;s==="Polygon"&&(a=[a]);let c=!1;for(var f=0;f<a.length;++f){const p=DB(r,a[f]);if(p===0)return!t.ignoreBoundary;p&&(c=!0)}return c}function IB(n,e){return e[0]<=n[0]&&e[1]<=n[1]&&e[2]>=n[0]&&e[3]>=n[1]}var kB=OB;const D3=1e-6;class Ma{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,r){e=+e,t=+t,r=+r;const i=e+r,s=t;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>D3||Math.abs(this._y1-s)>D3)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${e-r},${t}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(e,t,r,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class zm{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class UB{constructor(e,[t,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=i,this.xmin=t,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:r},vectors:i}=this;let s,o;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let S=0,N=0,C=r.length,P,B;S<C;S+=3,N+=2){const F=r[S]*2,q=r[S+1]*2,I=r[S+2]*2,U=e[F],G=e[F+1],H=e[q],te=e[q+1],W=e[I],Z=e[I+1],re=H-U,oe=te-G,Y=W-U,ae=Z-G,he=(re*ae-oe*Y)*2;if(Math.abs(he)<1e-9){if(s===void 0){s=o=0;for(const pe of t)s+=e[pe*2],o+=e[pe*2+1];s/=t.length,o/=t.length}const be=1e9*Math.sign((s-U)*ae-(o-G)*Y);P=(U+W)/2-be*ae,B=(G+Z)/2+be*Y}else{const be=1/he,pe=re*re+oe*oe,Le=Y*Y+ae*ae;P=U+(ae*pe-oe*Le)*be,B=G+(re*Le-Y*pe)*be}a[N]=P,a[N+1]=B}let c=t[t.length-1],f,p=c*4,g,v=e[2*c],b,T=e[2*c+1];i.fill(0);for(let S=0;S<t.length;++S)c=t[S],f=p,g=v,b=T,p=c*4,v=e[2*c],T=e[2*c+1],i[f+2]=i[p]=b-T,i[f+3]=i[p+1]=v-g}render(e){const t=e==null?e=new Ma:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let p=0,g=r.length;p<g;++p){const v=r[p];if(v<p)continue;const b=Math.floor(p/3)*2,T=Math.floor(v/3)*2,S=o[b],N=o[b+1],C=o[T],P=o[T+1];this._renderSegment(S,N,C,P,e)}let c,f=s[s.length-1];for(let p=0;p<s.length;++p){c=f,f=s[p];const g=Math.floor(i[f]/3)*2,v=o[g],b=o[g+1],T=c*4,S=this._project(v,b,a[T+2],a[T+3]);S&&this._renderSegment(v,b,S[0],S[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new Ma:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const r=t==null?t=new Ma:void 0,i=this._clip(e);if(i===null||!i.length)return;t.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&t.lineTo(i[o],i[o+1]);return t.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,r=e.length/2;t<r;++t){const i=this.cellPolygon(t);i&&(i.index=t,yield i)}}cellPolygon(e){const t=new zm;return this.renderCell(e,t),t.value()}_renderSegment(e,t,r,i,s){let o;const a=this._regioncode(e,t),c=this._regioncode(r,i);a===0&&c===0?(s.moveTo(e,t),s.lineTo(r,i)):(o=this._clipSegment(e,t,r,i,a,c))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(e,t,r){return t=+t,t!==t||(r=+r,r!==r)?!1:this.delaunay._step(e,t,r)===e}*neighbors(e){const t=this._clip(e);if(t)for(const r of this.delaunay.neighbors(e)){const i=this._clip(r);if(i){e:for(let s=0,o=t.length;s<o;s+=2)for(let a=0,c=i.length;a<c;a+=2)if(t[s]===i[a]&&t[s+1]===i[a+1]&&t[(s+2)%o]===i[(a+c-2)%c]&&t[(s+3)%o]===i[(a+c-1)%c]){yield r;break e}}}}_cell(e){const{circumcenters:t,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[e];if(o===-1)return null;const a=[];let c=o;do{const f=Math.floor(c/3);if(a.push(t[f*2],t[f*2+1]),c=c%3===2?c-2:c+1,s[c]!==e)break;c=i[c]}while(c!==o&&c!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:r}=this,i=e*4;return this._simplify(r[i]||r[i+1]?this._clipInfinite(e,t,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(e,t))}_clipFinite(e,t){const r=t.length;let i=null,s,o,a=t[r-2],c=t[r-1],f,p=this._regioncode(a,c),g,v=0;for(let b=0;b<r;b+=2)if(s=a,o=c,a=t[b],c=t[b+1],f=p,p=this._regioncode(a,c),f===0&&p===0)g=v,v=0,i?i.push(a,c):i=[a,c];else{let T,S,N,C,P;if(f===0){if((T=this._clipSegment(s,o,a,c,f,p))===null)continue;[S,N,C,P]=T}else{if((T=this._clipSegment(a,c,s,o,p,f))===null)continue;[C,P,S,N]=T,g=v,v=this._edgecode(S,N),g&&v&&this._edge(e,g,v,i,i.length),i?i.push(S,N):i=[S,N]}g=v,v=this._edgecode(C,P),g&&v&&this._edge(e,g,v,i,i.length),i?i.push(C,P):i=[C,P]}if(i)g=v,v=this._edgecode(i[0],i[1]),g&&v&&this._edge(e,g,v,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,t,r,i,s,o){const a=s<o;for(a&&([e,t,r,i,s,o]=[r,i,e,t,o,s]);;){if(s===0&&o===0)return a?[r,i,e,t]:[e,t,r,i];if(s&o)return null;let c,f,p=s||o;p&8?(c=e+(r-e)*(this.ymax-t)/(i-t),f=this.ymax):p&4?(c=e+(r-e)*(this.ymin-t)/(i-t),f=this.ymin):p&2?(f=t+(i-t)*(this.xmax-e)/(r-e),c=this.xmax):(f=t+(i-t)*(this.xmin-e)/(r-e),c=this.xmin),s?(e=c,t=f,s=this._regioncode(e,t)):(r=c,i=f,o=this._regioncode(r,i))}}_clipInfinite(e,t,r,i,s,o){let a=Array.from(t),c;if((c=this._project(a[0],a[1],r,i))&&a.unshift(c[0],c[1]),(c=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(c[0],c[1]),a=this._clipFinite(e,a))for(let f=0,p=a.length,g,v=this._edgecode(a[p-2],a[p-1]);f<p;f+=2)g=v,v=this._edgecode(a[f],a[f+1]),g&&v&&(f=this._edge(e,g,v,a,f),p=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,t,r,i,s){for(;t!==r;){let o,a;switch(t){case 5:t=4;continue;case 4:t=6,o=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,o=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,o=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(e,o,a)&&(i.splice(s,0,o,a),s+=2)}return s}_project(e,t,r,i){let s=1/0,o,a,c;if(i<0){if(t<=this.ymin)return null;(o=(this.ymin-t)/i)<s&&(c=this.ymin,a=e+(s=o)*r)}else if(i>0){if(t>=this.ymax)return null;(o=(this.ymax-t)/i)<s&&(c=this.ymax,a=e+(s=o)*r)}if(r>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/r)<s&&(a=this.xmax,c=t+(s=o)*i)}else if(r<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/r)<s&&(a=this.xmin,c=t+(s=o)*i)}return[a,c]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const r=(t+2)%e.length,i=(t+4)%e.length;(e[t]===e[r]&&e[r]===e[i]||e[t+1]===e[r+1]&&e[r+1]===e[i+1])&&(e.splice(r,2),t-=2)}e.length||(e=null)}return e}}const qB=2*Math.PI,hl=Math.pow;function GB(n){return n[0]}function VB(n){return n[1]}function zB(n){const{triangles:e,coords:t}=n;for(let r=0;r<e.length;r+=3){const i=2*e[r],s=2*e[r+1],o=2*e[r+2];if((t[o]-t[i])*(t[s+1]-t[i+1])-(t[s]-t[i])*(t[o+1]-t[i+1])>1e-10)return!1}return!0}function $B(n,e,t){return[n+Math.sin(n+e)*t,e+Math.cos(n-e)*t]}class d1{static from(e,t=GB,r=VB,i){return new d1("length"in e?jB(e,t,r,i):Float64Array.from(HB(e,t,r,i)))}constructor(e){this._delaunator=new PA(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&zB(e)){this.collinear=Int32Array.from({length:t.length/2},(v,b)=>b).sort((v,b)=>t[2*v]-t[2*b]||t[2*v+1]-t[2*b+1]);const c=this.collinear[0],f=this.collinear[this.collinear.length-1],p=[t[2*c],t[2*c+1],t[2*f],t[2*f+1]],g=1e-8*Math.hypot(p[3]-p[1],p[2]-p[0]);for(let v=0,b=t.length/2;v<b;++v){const T=$B(t[2*v],t[2*v+1],g);t[2*v]=T[0],t[2*v+1]=T[1]}this._delaunator=new PA(t)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let c=0,f=r.length;c<f;++c){const p=s[c%3===2?c-2:c+1];(r[c]===-1||o[p]===-1)&&(o[p]=c)}for(let c=0,f=i.length;c<f;++c)a[i[c]]=c;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],o[i[0]]=1,i.length===2&&(o[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(e){return new UB(this,e)}*neighbors(e){const{inedges:t,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const g=a.indexOf(e);g>0&&(yield a[g-1]),g<a.length-1&&(yield a[g+1]);return}const c=t[e];if(c===-1)return;let f=c,p=-1;do{if(yield p=o[f],f=f%3===2?f-2:f+1,o[f]!==e)return;if(f=s[f],f===-1){const g=r[(i[e]+1)%r.length];g!==p&&(yield g);return}}while(f!==c)}find(e,t,r=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const i=r;let s;for(;(s=this._step(r,e,t))>=0&&s!==r&&s!==i;)r=s;return s}_step(e,t,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:c,points:f}=this;if(i[e]===-1||!f.length)return(e+1)%(f.length>>1);let p=e,g=hl(t-f[e*2],2)+hl(r-f[e*2+1],2);const v=i[e];let b=v;do{let T=c[b];const S=hl(t-f[T*2],2)+hl(r-f[T*2+1],2);if(S<g&&(g=S,p=T),b=b%3===2?b-2:b+1,c[b]!==e)break;if(b=a[b],b===-1){if(b=s[(o[e]+1)%s.length],b!==T&&hl(t-f[b*2],2)+hl(r-f[b*2+1],2)<g)return b;break}}while(b!==v);return p}render(e){const t=e==null?e=new Ma:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const c=i[o];if(c<o)continue;const f=s[o]*2,p=s[c]*2;e.moveTo(r[f],r[f+1]),e.lineTo(r[p],r[p+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!="function")&&(t=e,e=null),t=t==null?2:+t;const r=e==null?e=new Ma:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],c=i[s+1];e.moveTo(a+t,c),e.arc(a,c,t,0,qB)}return r&&r.value()}renderHull(e){const t=e==null?e=new Ma:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;e.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const c=2*r[a];e.lineTo(i[c],i[c+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new zm;return this.renderHull(e),e.value()}renderTriangle(e,t){const r=t==null?t=new Ma:void 0,{points:i,triangles:s}=this,o=s[e*=3]*2,a=s[e+1]*2,c=s[e+2]*2;return t.moveTo(i[o],i[o+1]),t.lineTo(i[a],i[a+1]),t.lineTo(i[c],i[c+1]),t.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,r=e.length/3;t<r;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new zm;return this.renderTriangle(e,t),t.value()}}function jB(n,e,t,r){const i=n.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=n[o];s[o*2]=e.call(r,a,o,n),s[o*2+1]=t.call(r,a,o,n)}return s}function*HB(n,e,t,r){let i=0;for(const s of n)yield e.call(r,s,i,n),yield t.call(r,s,i,n),++i}const p1=Math.PI,L3=p1/2,F3=180/p1,O3=p1/180,WB=Math.atan2,I3=Math.cos,QB=Math.max,YB=Math.min,k3=Math.sin,XB=Math.sign||function(n){return n>0?1:n<0?-1:0},I4=Math.sqrt;function KB(n){return n>1?L3:n<-1?-L3:Math.asin(n)}function k4(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Jr(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function wh(n,e){return[n[0]+e[0],n[1]+e[1],n[2]+e[2]]}function Sh(n){var e=I4(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return[n[0]/e,n[1]/e,n[2]/e]}function m1(n){return[WB(n[1],n[0])*F3,KB(QB(-1,YB(1,n[2])))*F3]}function _s(n){const e=n[0]*O3,t=n[1]*O3,r=I3(t);return[r*I3(e),r*k3(e),k3(t)]}function g1(n){return n=n.map(e=>_s(e)),k4(n[0],Jr(n[2],n[1]))}function ZB(n){const e=eD(n),t=nD(e),r=tD(t,n),i=iD(t,n.length),s=JB(i,n),o=rD(t,n),{polygons:a,centers:c}=sD(o,t,n),f=oD(a),p=lD(t,n),g=aD(r,t);return{delaunay:e,edges:r,triangles:t,centers:c,neighbors:i,polygons:a,mesh:f,hull:p,urquhart:g,find:s}}function JB(n,e){function t(r,i){let s=r[0]-i[0],o=r[1]-i[1],a=r[2]-i[2];return s*s+o*o+a*a}return function(i,s,o){o===void 0&&(o=0);let a,c,f=o;const p=_s([i,s]);do a=o,o=null,c=t(p,_s(e[a])),n[a].forEach(g=>{let v=t(p,_s(e[g]));if(v<c){c=v,o=g,f=g;return}});while(o!==null);return f}}function eD(n){if(n.length<2)return{};let e=0;for(;isNaN(n[e][0]+n[e][1])&&e++<n.length;);const t=Z9(n[e]),r=PM().translate([0,0]).scale(1).rotate(t.invert([180,0]));n=n.map(r);const i=[];let s=1;for(let g=0,v=n.length;g<v;g++){let b=n[g][0]**2+n[g][1]**2;!isFinite(b)||b>1e32?i.push(g):b>s&&(s=b)}const o=1e6*I4(s);i.forEach(g=>n[g]=[o,0]),n.push([0,o]),n.push([-o,0]),n.push([0,-o]);const a=d1.from(n);a.projection=r;const{triangles:c,halfedges:f,inedges:p}=a;for(let g=0,v=f.length;g<v;g++)if(f[g]<0){const b=g%3==2?g-2:g+1,T=g%3==0?g+2:g-1,S=f[b],N=f[T];f[S]=N,f[N]=S,f[b]=f[T]=-1,c[g]=c[b]=c[T]=e,p[c[S]]=S%3==0?S+2:S-1,p[c[N]]=N%3==0?N+2:N-1,g+=2-g%3}else c[g]>n.length-3-1&&(c[g]=e);return a}function tD(n,e){const t=new Set;return e.length===2?[[0,1]]:(n.forEach(r=>{if(r[0]!==r[1]&&!(g1(r.map(i=>e[i]))<0))for(let i=0,s;i<3;i++)s=(i+1)%3,t.add(K0([r[i],r[s]]).join("-"))}),Array.from(t,r=>r.split("-").map(Number)))}function nD(n){const{triangles:e}=n;if(!e)return[];const t=[];for(let r=0,i=e.length/3;r<i;r++){const s=e[3*r],o=e[3*r+1],a=e[3*r+2];s!==o&&o!==a&&t.push([s,a,o])}return t}function rD(n,e){return n.map(t=>{const r=t.map(s=>e[s]).map(_s),i=wh(wh(Jr(r[1],r[0]),Jr(r[2],r[1])),Jr(r[0],r[2]));return m1(Sh(i))})}function iD(n,e){const t=[];return n.forEach(r=>{for(let i=0;i<3;i++){const s=r[i],o=r[(i+1)%3];t[s]=t[s]||[],t[s].push(o)}}),n.length===0&&(e===2?(t[0]=[1],t[1]=[0]):e===1&&(t[0]=[])),t}function sD(n,e,t){const r=[],i=n.slice();if(e.length===0){if(t.length<2)return{polygons:r,centers:i};if(t.length===2){const a=_s(t[0]),c=_s(t[1]),f=Sh(wh(a,c)),p=Sh(Jr(a,c)),g=Jr(f,p),v=[f,Jr(f,g),Jr(Jr(f,g),g),Jr(Jr(Jr(f,g),g),g)].map(m1).map(o);return r.push(v),r.push(v.slice().reverse()),{polygons:r,centers:i}}}e.forEach((a,c)=>{for(let f=0;f<3;f++){const p=a[f],g=a[(f+1)%3],v=a[(f+2)%3];r[p]=r[p]||[],r[p].push([g,v,c,[p,g,v]])}});const s=r.map(a=>{const c=[a[0][2]];let f=a[0][1];for(let p=1;p<a.length;p++)for(let g=0;g<a.length;g++)if(a[g][0]==f){f=a[g][1],c.push(a[g][2]);break}if(c.length>2)return c;if(c.length==2){const p=U3(t[a[0][3][0]],t[a[0][3][1]],i[c[0]]),g=U3(t[a[0][3][2]],t[a[0][3][0]],i[c[0]]),v=o(p),b=o(g);return[c[0],b,c[1],v]}});function o(a){let c=-1;return i.slice(e.length,1/0).forEach((f,p)=>{f[0]===a[0]&&f[1]===a[1]&&(c=p+e.length)}),c<0&&(c=i.length,i.push(a)),c}return{polygons:s,centers:i}}function U3(n,e,t){n=_s(n),e=_s(e),t=_s(t);const r=XB(k4(Jr(e,n),t));return m1(Sh(wh(n,e)).map(i=>r*i))}function oD(n){const e=[];return n.forEach(t=>{if(!t)return;let r=t[t.length-1];for(let i of t)i>r&&e.push([r,i]),r=i}),e}function aD(n,e){return function(t){const r=new Map,i=new Map;return n.forEach((s,o)=>{const a=s.join("-");r.set(a,t[o]),i.set(a,!0)}),e.forEach(s=>{let o=0,a=-1;for(let c=0;c<3;c++){let f=K0([s[c],s[(c+1)%3]]).join("-");r.get(f)>o&&(o=r.get(f),a=f)}i.set(a,!1)}),n.map(s=>i.get(s.join("-")))}}function lD(n,e){const t=new Set,r=[];n.map(a=>{if(!(g1(a.map(c=>e[c>e.length?0:c]))>1e-12))for(let c=0;c<3;c++){let f=[a[c],a[(c+1)%3]],p=`${f[0]}-${f[1]}`;t.has(p)?t.delete(p):t.add(`${f[1]}-${f[0]}`)}});const i=new Map;let s;if(t.forEach(a=>{a=a.split("-").map(Number),i.set(a[0],a[1]),s=a[0]}),s===void 0)return r;let o=s;do{r.push(o);let a=i.get(o);i.set(o,-1),o=a}while(o>-1&&o!==s);return r}function uD(n){const e=function(t){if(e.delaunay=null,e._data=t,typeof e._data=="object"&&e._data.type==="FeatureCollection"&&(e._data=e._data.features),typeof e._data=="object"){const r=e._data.map(i=>[e._vx(i),e._vy(i),i]).filter(i=>isFinite(i[0]+i[1]));e.points=r.map(i=>[i[0],i[1]]),e.valid=r.map(i=>i[2]),e.delaunay=ZB(e.points)}return e};return e._vx=function(t){if(typeof t=="object"&&"type"in t)return Xy(t)[0];if(0 in t)return t[0]},e._vy=function(t){if(typeof t=="object"&&"type"in t)return Xy(t)[1];if(1 in t)return t[1]},e.x=function(t){return t?(e._vx=t,e):e._vx},e.y=function(t){return t?(e._vy=t,e):e._vy},e.polygons=function(t){if(t!==void 0&&e(t),!e.delaunay)return!1;const r={type:"FeatureCollection",features:[]};return e.valid.length===0||(e.delaunay.polygons.forEach((i,s)=>r.features.push({type:"Feature",geometry:i?{type:"Polygon",coordinates:[[...i,i[0]].map(o=>e.delaunay.centers[o])]}:null,properties:{site:e.valid[s],sitecoordinates:e.points[s],neighbours:e.delaunay.neighbors[s]}})),e.valid.length===1&&r.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:e.valid[0],sitecoordinates:e.points[0],neighbours:[]}})),r},e.triangles=function(t){return t!==void 0&&e(t),e.delaunay?{type:"FeatureCollection",features:e.delaunay.triangles.map((r,i)=>(r=r.map(s=>e.points[s]),r.center=e.delaunay.centers[i],r)).filter(r=>g1(r)>0).map(r=>({type:"Feature",properties:{circumcenter:r.center},geometry:{type:"Polygon",coordinates:[[...r,r[0]]]}}))}:!1},e.links=function(t){if(t!==void 0&&e(t),!e.delaunay)return!1;const r=e.delaunay.edges.map(s=>zo(e.points[s[0]],e.points[s[1]])),i=e.delaunay.urquhart(r);return{type:"FeatureCollection",features:e.delaunay.edges.map((s,o)=>({type:"Feature",properties:{source:e.valid[s[0]],target:e.valid[s[1]],length:r[o],urquhart:!!i[o]},geometry:{type:"LineString",coordinates:[e.points[s[0]],e.points[s[1]]]}}))}},e.mesh=function(t){return t!==void 0&&e(t),e.delaunay?{type:"MultiLineString",coordinates:e.delaunay.edges.map(r=>[e.points[r[0]],e.points[r[1]]])}:!1},e.cellMesh=function(t){if(t!==void 0&&e(t),!e.delaunay)return!1;const{centers:r,polygons:i}=e.delaunay,s=[];for(const o of i)if(o)for(let a=o.length,c=o[a-1],f=o[0],p=0;p<a;c=f,f=o[++p])f>c&&s.push([r[c],r[f]]);return{type:"MultiLineString",coordinates:s}},e._found=void 0,e.find=function(t,r,i){if(e._found=e.delaunay.find(t,r,e._found),!i||zo([t,r],e.points[e._found])<i)return e._found},e.hull=function(t){t!==void 0&&e(t);const r=e.delaunay.hull,i=e.points;return r.length===0?null:{type:"Polygon",coordinates:[[...r.map(s=>i[s]),i[r[0]]]]}},n?e(n):e}function $m(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function AD(n){if(Array.isArray(n))return n}function cD(n){if(Array.isArray(n))return $m(n)}function hD(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function fD(n,e,t){return e=Eh(e),xD(n,U4()?Reflect.construct(e,[],Eh(n).constructor):e.apply(n,t))}function dD(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function pD(n,e,t){return Object.defineProperty(n,"prototype",{writable:!1}),n}function Eh(n){return Eh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Eh(n)}function mD(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&jm(n,e)}function U4(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(U4=function(){return!!n})()}function gD(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function _D(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function yD(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vD(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xD(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hD(n)}function jm(n,e){return jm=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},jm(n,e)}function As(n,e){return AD(n)||_D(n,e)||q4(n,e)||yD()}function Hd(n){return cD(n)||gD(n)||q4(n)||vD()}function q4(n,e){if(n){if(typeof n=="string")return $m(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?$m(n,e):void 0}}function bD(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.resolution,r=t===void 0?1/0:t,i=TD(n,r),s=TA(i),o=wD(n,r),a=[].concat(Hd(s),Hd(o)),c={type:"Polygon",coordinates:n},f=o4(c),p=As(f,2),g=As(p[0],2),v=g[0],b=g[1],T=As(p[1],2),S=T[0],N=T[1],C=v>S||N>=89||b<=-89,P=[];if(C){var B=uD(a).triangles(),F=new Map(a.map(function(he,be){var pe=As(he,2),Le=pe[0],Ue=pe[1];return["".concat(Le,"-").concat(Ue),be]}));B.features.forEach(function(he){var be,pe=he.geometry.coordinates[0].slice(0,3).reverse(),Le=[];if(pe.forEach(function(Je){var st=As(Je,2),ln=st[0],Nt=st[1],wn="".concat(ln,"-").concat(Nt);F.has(wn)&&Le.push(F.get(wn))}),Le.length===3){if(Le.some(function(Je){return Je<s.length})){var Ue=he.properties.circumcenter;if(!Hm(Ue,c,C))return}(be=P).push.apply(be,Le)}})}else if(o.length)for(var H=PA.from(a),te=function(be){var pe,Le=[2,1,0].map(function(st){return H.triangles[be+st]}),Ue=Le.map(function(st){return a[st]});if(Le.some(function(st){return st<s.length})){var Je=[0,1].map(function(st){return jC(Ue,function(ln){return ln[st]})});if(!Hm(Je,c,C))return 1}(pe=P).push.apply(pe,Hd(Le))},W=0,Z=H.triangles.length;W<Z;W+=3)te(W);else{var q=xh(i),I=q.vertices,U=q.holes,G=U===void 0?[]:U;P=tP(I,G,2)}var re=Js(K0(a,function(he){return he[0]}),[0,1]),oe=Js(K0(a,function(he){return he[1]}),[0,1]),Y=a.map(function(he){var be=As(he,2),pe=be[0],Le=be[1];return[re(pe),oe(Le)]}),ae={points:a,indices:P,uvs:Y};return{contour:i,triangles:ae}}function TD(n,e){return n.map(function(t){var r=[],i;return t.forEach(function(s){if(i){var o=zo(s,i)*180/Math.PI;if(o>e)for(var a=u1(i,s),c=1/Math.ceil(o/e),f=c;f<1;)r.push(a(f)),f+=c}r.push(i=s)}),r})}function wD(n,e){var t={type:"Polygon",coordinates:n},r=o4(t),i=As(r,2),s=As(i[0],2),o=s[0],a=s[1],c=As(i[1],2),f=c[0],p=c[1];if(Math.min(Math.abs(f-o),Math.abs(p-a))<e)return[];var g=o>f||p>=89||a<=-89;return SD(e,{minLng:o,maxLng:f,minLat:a,maxLat:p}).filter(function(v){return Hm(v,t,g)})}function SD(n){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.minLng,r=e.maxLng,i=e.minLat,s=e.maxLat,o=Math.round(Math.pow(360/n,2)/Math.PI),a=(1+Math.sqrt(5))/2,c=function(C){return C/a*360%360-180},f=function(C){return Math.acos(2*C/o-1)/Math.PI*180-90},p=function(C){return o*(Math.cos((C+90)*Math.PI/180)+1)/2},g=[s!==void 0?Math.ceil(p(s)):0,i!==void 0?Math.floor(p(i)):o-1],v=t===void 0&&r===void 0?function(){return!0}:t===void 0?function(N){return N<=r}:r===void 0?function(N){return N>=t}:r>=t?function(N){return N>=t&&N<=r}:function(N){return N>=t||N<=r},b=[],T=g[0];T<=g[1];T++){var S=c(T);v(S)&&b.push([S,f(T)])}return b}function Hm(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?pM(e,n):kB(n,e)}var C0=window.THREE?window.THREE:{BufferGeometry:oi,Float32BufferAttribute:Go},q3=new C0.BufferGeometry().setAttribute?"setAttribute":"addAttribute",_1=(function(n){function e(t,r,i,s,o,a,c){var f;dD(this,e),f=fD(this,e),f.type="ConicPolygonGeometry",f.parameters={polygonGeoJson:t,bottomHeight:r,topHeight:i,closedBottom:s,closedTop:o,includeSides:a,curvatureResolution:c},r=r||0,i=i||1,s=s!==void 0?s:!0,o=o!==void 0?o:!0,a=a!==void 0?a:!0,c=c||5;var p=bD(t,{resolution:c}),g=p.contour,v=p.triangles,b=TA(v.uvs),T=[],S=[],N=[],C=0,P=function(U){var G=Math.round(T.length/3),H=N.length;T=T.concat(U.vertices),S=S.concat(U.uvs),N=N.concat(G?U.indices.map(function(te){return te+G}):U.indices),f.addGroup(H,N.length-H,C++)};a&&P(F()),s&&P(q(r,!1)),o&&P(q(i,!0)),f.setIndex(N),f[q3]("position",new C0.Float32BufferAttribute(T,3)),f[q3]("uv",new C0.Float32BufferAttribute(S,2)),f.computeVertexNormals();function B(I,U){var G=typeof U=="function"?U:function(){return U},H=I.map(function(te){return te.map(function(W){var Z=As(W,2),re=Z[0],oe=Z[1];return ED(oe,re,G(re,oe))})});return xh(H)}function F(){for(var I=B(g,r),U=I.vertices,G=I.holes,H=B(g,i),te=H.vertices,W=TA([te,U]),Z=Math.round(te.length/3),re=new Set(G),oe=0,Y=[],ae=0;ae<Z;ae++){var he=ae+1;if(he===Z)he=oe;else if(re.has(he)){var be=he;he=oe,oe=be}Y.push(ae,ae+Z,he+Z),Y.push(he+Z,he,ae)}for(var pe=[],Le=1;Le>=0;Le--)for(var Ue=0;Ue<Z;Ue+=1)pe.push(Ue/(Z-1),Le);return{indices:Y,vertices:W,uvs:pe}}function q(I){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return{indices:U?v.indices:v.indices.slice().reverse(),vertices:B([v.points],I).vertices,uvs:b}}return f}return mD(e,n),pD(e)})(C0.BufferGeometry);function ED(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180;return[t*Math.sin(r)*Math.cos(i),t*Math.cos(r),t*Math.sin(r)*Math.sin(i)]}function Wm(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function ND(n){if(Array.isArray(n))return n}function RD(n){if(Array.isArray(n))return Wm(n)}function CD(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function MD(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function PD(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BD(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DD(n,e){if(n==null)return{};var t,r,i=LD(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.includes(t)||{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function LD(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.includes(r))continue;t[r]=n[r]}return t}function FD(n,e){return ND(n)||MD(n,e)||G4(n,e)||PD()}function OD(n){return RD(n)||CD(n)||G4(n)||BD()}function ID(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function kD(n){var e=ID(n,"string");return typeof e=="symbol"?e:e+""}function G4(n,e){if(n){if(typeof n=="string")return Wm(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Wm(n,e):void 0}}var UD=(function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=(e instanceof Array?e.length?e:[void 0]:[e]).map(function(a){return{keyAccessor:a,isProp:!(a instanceof Function)}}),s=n.reduce(function(a,c){var f=a,p=c;return i.forEach(function(g,v){var b=g.keyAccessor,T=g.isProp,S;if(T){var N=p,C=N[b],P=DD(N,[b].map(kD));S=C,p=P}else S=b(p,v);v+1<i.length?(f.hasOwnProperty(S)||(f[S]={}),f=f[S]):t?(f.hasOwnProperty(S)||(f[S]=[]),f[S].push(p)):f[S]=p}),a},{});t instanceof Function&&(function a(c){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;f===i.length?Object.keys(c).forEach(function(p){return c[p]=t(c[p])}):Object.values(c).forEach(function(p){return a(p,f+1)})})(s);var o=s;return r&&(o=[],(function a(c){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];f.length===i.length?o.push({keys:f,vals:c}):Object.entries(c).forEach(function(p){var g=FD(p,2),v=g[0],b=g[1];return a(b,[].concat(OD(f),[v]))})})(s),e instanceof Array&&e.length===0&&o.length===1&&(o[0].keys=[])),o}),Et=(function(n){n=n||{};var e=typeof n<"u"?n:{},t={},r;for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);var i="";function s(ce){return e.locateFile?e.locateFile(ce,i):i+ce}var o;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",o=function(_e,Fe,ve){var A=new XMLHttpRequest;A.open("GET",_e,!0),A.responseType="arraybuffer",A.onload=function(){if(A.status==200||A.status==0&&A.response){Fe(A.response);return}var Ct=ed(_e);if(Ct){Fe(Ct.buffer);return}ve()},A.onerror=ve,A.send(null)};var a=e.print||console.log.bind(console),c=e.printErr||console.warn.bind(console);for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);t=null,e.arguments&&e.arguments;var f=0,p=function(ce){f=ce},g=function(){return f},v=8;function b(ce,_e,Fe,ve){switch(Fe=Fe||"i8",Fe.charAt(Fe.length-1)==="*"&&(Fe="i32"),Fe){case"i1":Z[ce>>0]=_e;break;case"i8":Z[ce>>0]=_e;break;case"i16":oe[ce>>1]=_e;break;case"i32":Y[ce>>2]=_e;break;case"i64":Jf=[_e>>>0,(Xa=_e,+Un(Xa)>=1?Xa>0?(na(+Ao(Xa/4294967296),4294967295)|0)>>>0:~~+Hr((Xa-+(~~Xa>>>0))/4294967296)>>>0:0)],Y[ce>>2]=Jf[0],Y[ce+4>>2]=Jf[1];break;case"float":ae[ce>>2]=_e;break;case"double":he[ce>>3]=_e;break;default:Ka("invalid type for setValue: "+Fe)}}function T(ce,_e,Fe){switch(_e=_e||"i8",_e.charAt(_e.length-1)==="*"&&(_e="i32"),_e){case"i1":return Z[ce>>0];case"i8":return Z[ce>>0];case"i16":return oe[ce>>1];case"i32":return Y[ce>>2];case"i64":return Y[ce>>2];case"float":return ae[ce>>2];case"double":return he[ce>>3];default:Ka("invalid type for getValue: "+_e)}return null}var S=!1;function N(ce,_e){ce||Ka("Assertion failed: "+_e)}function C(ce){var _e=e["_"+ce];return N(_e,"Cannot call unknown function "+ce+", make sure it is exported"),_e}function P(ce,_e,Fe,ve,A){var D={string:function(mt){var ui=0;if(mt!=null&&mt!==0){var uc=(mt.length<<2)+1;ui=c_(uc),G(mt,ui,uc)}return ui},array:function(mt){var ui=c_(mt.length);return H(mt,ui),ui}};function Ct(mt){return _e==="string"?I(mt):_e==="boolean"?!!mt:mt}var kt=C(ce),$n=[],pt=0;if(ve)for(var Mt=0;Mt<ve.length;Mt++){var co=D[Fe[Mt]];co?(pt===0&&(pt=u7()),$n[Mt]=co(ve[Mt])):$n[Mt]=ve[Mt]}var Dt=kt.apply(null,$n);return Dt=Ct(Dt),pt!==0&&l7(pt),Dt}function B(ce,_e,Fe,ve){Fe=Fe||[];var A=Fe.every(function(Ct){return Ct==="number"}),D=_e!=="string";return D&&A&&!ve?C(ce):function(){return P(ce,_e,Fe,arguments)}}var F=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function q(ce,_e,Fe){for(var ve=_e+Fe,A=_e;ce[A]&&!(A>=ve);)++A;if(A-_e>16&&ce.subarray&&F)return F.decode(ce.subarray(_e,A));for(var D="";_e<A;){var Ct=ce[_e++];if(!(Ct&128)){D+=String.fromCharCode(Ct);continue}var kt=ce[_e++]&63;if((Ct&224)==192){D+=String.fromCharCode((Ct&31)<<6|kt);continue}var $n=ce[_e++]&63;if((Ct&240)==224?Ct=(Ct&15)<<12|kt<<6|$n:Ct=(Ct&7)<<18|kt<<12|$n<<6|ce[_e++]&63,Ct<65536)D+=String.fromCharCode(Ct);else{var pt=Ct-65536;D+=String.fromCharCode(55296|pt>>10,56320|pt&1023)}}return D}function I(ce,_e){return ce?q(re,ce,_e):""}function U(ce,_e,Fe,ve){if(!(ve>0))return 0;for(var A=Fe,D=Fe+ve-1,Ct=0;Ct<ce.length;++Ct){var kt=ce.charCodeAt(Ct);if(kt>=55296&&kt<=57343){var $n=ce.charCodeAt(++Ct);kt=65536+((kt&1023)<<10)|$n&1023}if(kt<=127){if(Fe>=D)break;_e[Fe++]=kt}else if(kt<=2047){if(Fe+1>=D)break;_e[Fe++]=192|kt>>6,_e[Fe++]=128|kt&63}else if(kt<=65535){if(Fe+2>=D)break;_e[Fe++]=224|kt>>12,_e[Fe++]=128|kt>>6&63,_e[Fe++]=128|kt&63}else{if(Fe+3>=D)break;_e[Fe++]=240|kt>>18,_e[Fe++]=128|kt>>12&63,_e[Fe++]=128|kt>>6&63,_e[Fe++]=128|kt&63}}return _e[Fe]=0,Fe-A}function G(ce,_e,Fe){return U(ce,re,_e,Fe)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function H(ce,_e){Z.set(ce,_e)}function te(ce,_e){return ce%_e>0&&(ce+=_e-ce%_e),ce}var W,Z,re,oe,Y,ae,he;function be(ce){W=ce,e.HEAP8=Z=new Int8Array(ce),e.HEAP16=oe=new Int16Array(ce),e.HEAP32=Y=new Int32Array(ce),e.HEAPU8=re=new Uint8Array(ce),e.HEAPU16=new Uint16Array(ce),e.HEAPU32=new Uint32Array(ce),e.HEAPF32=ae=new Float32Array(ce),e.HEAPF64=he=new Float64Array(ce)}var pe=5271536,Le=28624,Ue=e.TOTAL_MEMORY||33554432;e.buffer?W=e.buffer:W=new ArrayBuffer(Ue),Ue=W.byteLength,be(W),Y[Le>>2]=pe;function Je(ce){for(;ce.length>0;){var _e=ce.shift();if(typeof _e=="function"){_e();continue}var Fe=_e.func;typeof Fe=="number"?_e.arg===void 0?e.dynCall_v(Fe):e.dynCall_vi(Fe,_e.arg):Fe(_e.arg===void 0?null:_e.arg)}}var st=[],ln=[],Nt=[],wn=[];function tn(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)kn(e.preRun.shift());Je(st)}function ur(){Je(ln)}function Zn(){Je(Nt)}function yr(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Rn(e.postRun.shift());Je(wn)}function kn(ce){st.unshift(ce)}function Rn(ce){wn.unshift(ce)}var Un=Math.abs,Hr=Math.ceil,Ao=Math.floor,na=Math.min,li=0,Pi=null;function QS(ce){li++,e.monitorRunDependencies&&e.monitorRunDependencies(li)}function YS(ce){if(li--,e.monitorRunDependencies&&e.monitorRunDependencies(li),li==0&&Pi){var _e=Pi;Pi=null,_e()}}e.preloadedImages={},e.preloadedAudios={};var Ds=null,Zf="data:application/octet-stream;base64,";function u_(ce){return String.prototype.startsWith?ce.startsWith(Zf):ce.indexOf(Zf)===0}var Xa,Jf;Ds="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAdmVydGV4Um90YXRpb25zAGNlbGxUb1ZlcnRleABncmFwaC0+YnVja2V0cyAhPSBOVUxMAHZlcnRleEdyYXBoLmMAaW5pdFZlcnRleEdyYXBoAG5vZGUgIT0gTlVMTABhZGRWZXJ0ZXhOb2Rl";var XS=28640;function KS(ce,_e,Fe,ve){Ka("Assertion failed: "+I(ce)+", at: "+[_e?I(_e):"unknown filename",Fe,ve?I(ve):"unknown function"])}function A_(){return Z.length}function ZS(ce,_e,Fe){re.set(re.subarray(_e,_e+Fe),ce)}function JS(ce){return e.___errno_location&&(Y[e.___errno_location()>>2]=ce),ce}function e7(ce){Ka("OOM")}function t7(ce){try{var _e=new ArrayBuffer(ce);return _e.byteLength!=ce?void 0:(new Int8Array(_e).set(Z),a7(_e),be(_e),1)}catch{}}function n7(ce){var _e=A_(),Fe=16777216,ve=2147483648-Fe;if(ce>ve)return!1;for(var A=16777216,D=Math.max(_e,A);D<ce;)D<=536870912?D=te(2*D,Fe):D=Math.min(te((3*D+2147483648)/4,Fe),ve);var Ct=t7(D);return!!Ct}var r7=typeof atob=="function"?atob:function(ce){var _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Fe="",ve,A,D,Ct,kt,$n,pt,Mt=0;ce=ce.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ct=_e.indexOf(ce.charAt(Mt++)),kt=_e.indexOf(ce.charAt(Mt++)),$n=_e.indexOf(ce.charAt(Mt++)),pt=_e.indexOf(ce.charAt(Mt++)),ve=Ct<<2|kt>>4,A=(kt&15)<<4|$n>>2,D=($n&3)<<6|pt,Fe=Fe+String.fromCharCode(ve),$n!==64&&(Fe=Fe+String.fromCharCode(A)),pt!==64&&(Fe=Fe+String.fromCharCode(D));while(Mt<ce.length);return Fe};function i7(ce){try{for(var _e=r7(ce),Fe=new Uint8Array(_e.length),ve=0;ve<_e.length;++ve)Fe[ve]=_e.charCodeAt(ve);return Fe}catch{throw new Error("Converting base64 string to bytes failed.")}}function ed(ce){if(u_(ce))return i7(ce.slice(Zf.length))}var s7={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},o7={b:p,c:g,d:KS,e:JS,f:A_,g:ZS,h:n7,i:e7,o:XS,p:Le},Se=(function(ce,_e,Fe){"almost asm";var ve=new ce.Int8Array(Fe),A=new ce.Int32Array(Fe);new ce.Uint8Array(Fe),new ce.Float32Array(Fe);var D=new ce.Float64Array(Fe),Ct=_e.o|0,kt=_e.p|0,$n=ce.Math.floor,pt=ce.Math.abs,Mt=ce.Math.sqrt,co=ce.Math.pow,Dt=ce.Math.cos,mt=ce.Math.sin,ui=ce.Math.tan,uc=ce.Math.acos,A7=ce.Math.asin,rd=ce.Math.atan,Ai=ce.Math.atan2,Za=ce.Math.ceil,Ki=ce.Math.imul,id=ce.Math.min,c7=ce.Math.max,Ls=ce.Math.clz32,lt=_e.b,k=_e.c,tt=_e.d,p_=_e.e,h7=_e.f,f7=_e.g,d7=_e.h,p7=_e.i,L=28656;function m7(u){return ve=new Int8Array(u),A=new Int32Array(u),D=new Float64Array(u),Fe=u,!0}function g7(u){u=u|0;var l=0;return l=L,L=L+u|0,L=L+15&-16,l|0}function _7(){return L|0}function y7(u){u=u|0,L=u}function v7(u,l){u=u|0,L=u}function x7(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;return(u|0)<0?(l=2,l|0):(u|0)>13780509?(l=dc(15,l)|0,l|0):(h=((u|0)<0)<<31>>31,m=Wn(u|0,h|0,3,0)|0,d=k()|0,h=He(u|0,h|0,1,0)|0,h=Wn(m|0,d|0,h|0,k()|0)|0,h=He(h|0,k()|0,1,0)|0,u=k()|0,A[l>>2]=h,A[l+4>>2]=u,l=0,l|0)}function m_(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,g_(u,l,h,d,0)|0}function g_(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0;if(w=L,L=L+16|0,y=w,!(__(u,l,h,d,m)|0))return d=0,L=w,d|0;do if((h|0)>=0){if((h|0)>13780509){if(_=dc(15,y)|0,_|0)break;x=y,y=A[x>>2]|0,x=A[x+4>>2]|0}else _=((h|0)<0)<<31>>31,E=Wn(h|0,_|0,3,0)|0,x=k()|0,_=He(h|0,_|0,1,0)|0,_=Wn(E|0,x|0,_|0,k()|0)|0,_=He(_|0,k()|0,1,0)|0,x=k()|0,A[y>>2]=_,A[y+4>>2]=x,y=_;if(go(d|0,0,y<<3|0)|0,m|0){go(m|0,0,y<<2|0)|0,_=Zi(u,l,h,d,m,y,x,0)|0;break}_=Dr(y,4)|0,_?(E=Zi(u,l,h,d,_,y,x,0)|0,We(_),_=E):_=13}else _=2;while(!1);return E=_,L=w,E|0}function __(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0;if(J=L,L=L+16|0,$=J,j=J+8|0,z=$,A[z>>2]=u,A[z+4>>2]=l,(h|0)<0)return j=2,L=J,j|0;if(_=d,A[_>>2]=u,A[_+4>>2]=l,_=(m|0)!=0,_&&(A[m>>2]=0),Qt(u,l)|0)return j=9,L=J,j|0;A[j>>2]=0;e:do if((h|0)>=1)if(_)for(M=1,E=0,O=0,z=1,_=u;;){if(!(E|O)){if(_=jn(_,l,4,j,$)|0,_|0)break e;if(l=$,_=A[l>>2]|0,l=A[l+4>>2]|0,Qt(_,l)|0){_=9;break e}}if(_=jn(_,l,A[26800+(O<<2)>>2]|0,j,$)|0,_|0)break e;if(l=$,_=A[l>>2]|0,l=A[l+4>>2]|0,u=d+(M<<3)|0,A[u>>2]=_,A[u+4>>2]=l,A[m+(M<<2)>>2]=z,u=E+1|0,y=(u|0)==(z|0),x=O+1|0,w=(x|0)==6,Qt(_,l)|0){_=9;break e}if(z=z+(w&y&1)|0,(z|0)>(h|0)){_=0;break}else M=M+1|0,E=y?0:u,O=y?w?0:x:O}else for(M=1,E=0,O=0,z=1,_=u;;){if(!(E|O)){if(_=jn(_,l,4,j,$)|0,_|0)break e;if(l=$,_=A[l>>2]|0,l=A[l+4>>2]|0,Qt(_,l)|0){_=9;break e}}if(_=jn(_,l,A[26800+(O<<2)>>2]|0,j,$)|0,_|0)break e;if(l=$,_=A[l>>2]|0,l=A[l+4>>2]|0,u=d+(M<<3)|0,A[u>>2]=_,A[u+4>>2]=l,u=E+1|0,y=(u|0)==(z|0),x=O+1|0,w=(x|0)==6,Qt(_,l)|0){_=9;break e}if(z=z+(w&y&1)|0,(z|0)>(h|0)){_=0;break}else M=M+1|0,E=y?0:u,O=y?w?0:x:O}else _=0;while(!1);return j=_,L=J,j|0}function Zi(u,l,h,d,m,_,y,x){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,_=_|0,y=y|0,x=x|0;var w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0;if(J=L,L=L+16|0,$=J+8|0,j=J,w=il(u|0,l|0,_|0,y|0)|0,M=k()|0,O=d+(w<<3)|0,ie=O,Ae=A[ie>>2]|0,ie=A[ie+4>>2]|0,E=(Ae|0)==(u|0)&(ie|0)==(l|0),!((Ae|0)==0&(ie|0)==0|E))do w=He(w|0,M|0,1,0)|0,w=rl(w|0,k()|0,_|0,y|0)|0,M=k()|0,O=d+(w<<3)|0,Ae=O,ie=A[Ae>>2]|0,Ae=A[Ae+4>>2]|0,E=(ie|0)==(u|0)&(Ae|0)==(l|0);while(!((ie|0)==0&(Ae|0)==0|E));if(w=m+(w<<2)|0,E&&(A[w>>2]|0)<=(x|0)||(Ae=O,A[Ae>>2]=u,A[Ae+4>>2]=l,A[w>>2]=x,(x|0)>=(h|0)))return Ae=0,L=J,Ae|0;switch(E=x+1|0,A[$>>2]=0,w=jn(u,l,2,$,j)|0,w|0){case 9:{z=9;break}case 0:{w=j,w=Zi(A[w>>2]|0,A[w+4>>2]|0,h,d,m,_,y,E)|0,w||(z=9);break}}e:do if((z|0)==9){switch(A[$>>2]=0,w=jn(u,l,3,$,j)|0,w|0){case 9:break;case 0:{if(w=j,w=Zi(A[w>>2]|0,A[w+4>>2]|0,h,d,m,_,y,E)|0,w|0)break e;break}default:break e}switch(A[$>>2]=0,w=jn(u,l,1,$,j)|0,w|0){case 9:break;case 0:{if(w=j,w=Zi(A[w>>2]|0,A[w+4>>2]|0,h,d,m,_,y,E)|0,w|0)break e;break}default:break e}switch(A[$>>2]=0,w=jn(u,l,5,$,j)|0,w|0){case 9:break;case 0:{if(w=j,w=Zi(A[w>>2]|0,A[w+4>>2]|0,h,d,m,_,y,E)|0,w|0)break e;break}default:break e}switch(A[$>>2]=0,w=jn(u,l,4,$,j)|0,w|0){case 9:break;case 0:{if(w=j,w=Zi(A[w>>2]|0,A[w+4>>2]|0,h,d,m,_,y,E)|0,w|0)break e;break}default:break e}switch(A[$>>2]=0,w=jn(u,l,6,$,j)|0,w|0){case 9:break;case 0:{if(w=j,w=Zi(A[w>>2]|0,A[w+4>>2]|0,h,d,m,_,y,E)|0,w|0)break e;break}default:break e}return Ae=0,L=J,Ae|0}while(!1);return Ae=w,L=J,Ae|0}function jn(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0;if(h>>>0>6)return m=1,m|0;if(O=(A[d>>2]|0)%6|0,A[d>>2]=O,(O|0)>0){_=0;do h=sa(h)|0,_=_+1|0;while((_|0)<(A[d>>2]|0))}if(O=ge(u|0,l|0,45)|0,k()|0,M=O&127,M>>>0>121)return m=5,m|0;w=Br(u,l)|0,_=ge(u|0,l|0,52)|0,k()|0,_=_&15;e:do if(!_)E=8;else{for(;;){if(y=(15-_|0)*3|0,x=ge(u|0,l|0,y|0)|0,k()|0,x=x&7,(x|0)==7){l=5;break}if(j=(ci(_)|0)==0,_=_+-1|0,z=Ee(7,0,y|0)|0,l=l&~(k()|0),$=Ee(A[(j?432:16)+(x*28|0)+(h<<2)>>2]|0,0,y|0)|0,y=k()|0,h=A[(j?640:224)+(x*28|0)+(h<<2)>>2]|0,u=$|u&~z,l=y|l,!h){h=0;break e}if(!_){E=8;break e}}return l|0}while(!1);(E|0)==8&&(j=A[848+(M*28|0)+(h<<2)>>2]|0,$=Ee(j|0,0,45)|0,u=$|u,l=k()|0|l&-1040385,h=A[4272+(M*28|0)+(h<<2)>>2]|0,(j&127|0)==127&&(j=Ee(A[848+(M*28|0)+20>>2]|0,0,45)|0,l=k()|0|l&-1040385,h=A[4272+(M*28|0)+20>>2]|0,u=oa(j|u,l)|0,l=k()|0,A[d>>2]=(A[d>>2]|0)+1)),x=ge(u|0,l|0,45)|0,k()|0,x=x&127;e:do if(rn(x)|0){t:do if((Br(u,l)|0)==1){if((M|0)!=(x|0))if(b_(x,A[7696+(M*28|0)>>2]|0)|0){u=yd(u,l)|0,y=1,l=k()|0;break}else tt(27795,26864,533,26872);switch(w|0){case 3:{u=oa(u,l)|0,l=k()|0,A[d>>2]=(A[d>>2]|0)+1,y=0;break t}case 5:{u=yd(u,l)|0,l=k()|0,A[d>>2]=(A[d>>2]|0)+5,y=0;break t}case 0:return j=9,j|0;default:return j=1,j|0}}else y=0;while(!1);if((h|0)>0){_=0;do u=_d(u,l)|0,l=k()|0,_=_+1|0;while((_|0)!=(h|0))}if((M|0)!=(x|0)){if(!(od(x)|0)){if((y|0)!=0|(Br(u,l)|0)!=5)break;A[d>>2]=(A[d>>2]|0)+1;break}switch(O&127){case 8:case 118:break e}(Br(u,l)|0)!=3&&(A[d>>2]=(A[d>>2]|0)+1)}}else if((h|0)>0){_=0;do u=oa(u,l)|0,l=k()|0,_=_+1|0;while((_|0)!=(h|0))}while(!1);return A[d>>2]=((A[d>>2]|0)+h|0)%6|0,j=m,A[j>>2]=u,A[j+4>>2]=l,j=0,j|0}function b7(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,y_(u,l,h,d)|0?(go(d|0,0,h*48|0)|0,d=T7(u,l,h,d)|0,d|0):(d=0,d|0)}function y_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0;if(j=L,L=L+16|0,z=j,$=j+8|0,O=z,A[O>>2]=u,A[O+4>>2]=l,(h|0)<0)return $=2,L=j,$|0;if(!h)return $=d,A[$>>2]=u,A[$+4>>2]=l,$=0,L=j,$|0;A[$>>2]=0;e:do if(Qt(u,l)|0)u=9;else{m=0,O=u;do{if(u=jn(O,l,4,$,z)|0,u|0)break e;if(l=z,O=A[l>>2]|0,l=A[l+4>>2]|0,m=m+1|0,Qt(O,l)|0){u=9;break e}}while((m|0)<(h|0));M=d,A[M>>2]=O,A[M+4>>2]=l,M=h+-1|0,E=0,u=1;do{if(m=26800+(E<<2)|0,(E|0)==5)for(y=A[m>>2]|0,_=0,m=u;;){if(u=z,u=jn(A[u>>2]|0,A[u+4>>2]|0,y,$,z)|0,u|0)break e;if((_|0)!=(M|0))if(w=z,x=A[w>>2]|0,w=A[w+4>>2]|0,u=d+(m<<3)|0,A[u>>2]=x,A[u+4>>2]=w,!(Qt(x,w)|0))u=m+1|0;else{u=9;break e}else u=m;if(_=_+1|0,(_|0)>=(h|0))break;m=u}else for(y=z,w=A[m>>2]|0,x=0,m=u,_=A[y>>2]|0,y=A[y+4>>2]|0;;){if(u=jn(_,y,w,$,z)|0,u|0)break e;if(y=z,_=A[y>>2]|0,y=A[y+4>>2]|0,u=d+(m<<3)|0,A[u>>2]=_,A[u+4>>2]=y,u=m+1|0,Qt(_,y)|0){u=9;break e}if(x=x+1|0,(x|0)>=(h|0))break;m=u}E=E+1|0}while(E>>>0<6);u=z,u=(O|0)==(A[u>>2]|0)&&(l|0)==(A[u+4>>2]|0)?0:9}while(!1);return $=u,L=j,$|0}function T7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0;if(O=L,L=L+16|0,y=O,!h)return A[d>>2]=u,A[d+4>>2]=l,d=0,L=O,d|0;do if((h|0)>=0){if((h|0)>13780509){if(m=dc(15,y)|0,m|0)break;_=y,m=A[_>>2]|0,_=A[_+4>>2]|0}else m=((h|0)<0)<<31>>31,M=Wn(h|0,m|0,3,0)|0,_=k()|0,m=He(h|0,m|0,1,0)|0,m=Wn(M|0,_|0,m|0,k()|0)|0,m=He(m|0,k()|0,1,0)|0,_=k()|0,M=y,A[M>>2]=m,A[M+4>>2]=_;if(E=Dr(m,8)|0,!E)m=13;else{if(M=Dr(m,4)|0,!M){We(E),m=13;break}if(m=Zi(u,l,h,E,M,m,_,0)|0,m|0){We(E),We(M);break}if(l=A[y>>2]|0,y=A[y+4>>2]|0,(y|0)>0|(y|0)==0&l>>>0>0){m=0,x=0,w=0;do u=E+(x<<3)|0,_=A[u>>2]|0,u=A[u+4>>2]|0,!((_|0)==0&(u|0)==0)&&(A[M+(x<<2)>>2]|0)==(h|0)&&(z=d+(m<<3)|0,A[z>>2]=_,A[z+4>>2]=u,m=m+1|0),x=He(x|0,w|0,1,0)|0,w=k()|0;while((w|0)<(y|0)|(w|0)==(y|0)&x>>>0<l>>>0)}We(E),We(M),m=0}}else m=2;while(!1);return z=m,L=O,z|0}function sd(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0;for(x=L,L=L+16|0,_=x,y=x+8|0,m=(Qt(u,l)|0)==0,m=m?1:2;;){if(A[y>>2]=0,E=(jn(u,l,m,y,_)|0)==0,w=_,E&((A[w>>2]|0)==(h|0)?(A[w+4>>2]|0)==(d|0):0)){u=4;break}if(m=m+1|0,m>>>0>=7){m=7,u=4;break}}return(u|0)==4?(L=x,m|0):0}function w7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0;if(x=L,L=L+48|0,m=x+16|0,_=x+8|0,y=x,h=bu(h)|0,h|0)return y=h,L=x,y|0;if(E=u,w=A[E+4>>2]|0,h=_,A[h>>2]=A[E>>2],A[h+4>>2]=w,Q_(_,m),h=E_(m,l,y)|0,!h){if(l=A[_>>2]|0,_=A[u+8>>2]|0,(_|0)>0){m=A[u+12>>2]|0,h=0;do l=(A[m+(h<<3)>>2]|0)+l|0,h=h+1|0;while((h|0)<(_|0))}h=y,m=A[h>>2]|0,h=A[h+4>>2]|0,_=((l|0)<0)<<31>>31,(h|0)<(_|0)|(h|0)==(_|0)&m>>>0<l>>>0?(h=y,A[h>>2]=l,A[h+4>>2]=_,h=_):l=m,w=He(l|0,h|0,12,0)|0,E=k()|0,h=y,A[h>>2]=w,A[h+4>>2]=E,h=d,A[h>>2]=w,A[h+4>>2]=E,h=0}return E=h,L=x,E|0}function v_(u,l,h,d,m,_,y){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,_=_|0,y=y|0;var x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0,$e=0,ke=0,at=0,ut=0,_t=0,et=0,je=0,Ne=0,dt=0,$t=0,ct=0,jt=0,xr=0,ly=0;if($t=L,L=L+64|0,et=$t+48|0,je=$t+32|0,Ne=$t+24|0,Re=$t+8|0,$e=$t,w=A[u>>2]|0,(w|0)<=0)return dt=0,L=$t,dt|0;for(ke=u+4|0,at=et+8|0,ut=je+8|0,_t=Re+8|0,x=0,se=0;;){E=A[ke>>2]|0,ue=E+(se<<4)|0,A[et>>2]=A[ue>>2],A[et+4>>2]=A[ue+4>>2],A[et+8>>2]=A[ue+8>>2],A[et+12>>2]=A[ue+12>>2],(se|0)==(w+-1|0)?(A[je>>2]=A[E>>2],A[je+4>>2]=A[E+4>>2],A[je+8>>2]=A[E+8>>2],A[je+12>>2]=A[E+12>>2]):(ue=E+(se+1<<4)|0,A[je>>2]=A[ue>>2],A[je+4>>2]=A[ue+4>>2],A[je+8>>2]=A[ue+8>>2],A[je+12>>2]=A[ue+12>>2]),w=O7(et,je,d,Ne)|0;e:do if(w)E=0,x=w;else if(w=Ne,E=A[w>>2]|0,w=A[w+4>>2]|0,(w|0)>0|(w|0)==0&E>>>0>0){Ae=0,ue=0;t:for(;;){if(jt=1/(+(E>>>0)+4294967296*+(w|0)),ly=+D[et>>3],w=Hn(E|0,w|0,Ae|0,ue|0)|0,xr=+(w>>>0)+4294967296*+(k()|0),ct=+(Ae>>>0)+4294967296*+(ue|0),D[Re>>3]=jt*(ly*xr)+jt*(+D[je>>3]*ct),D[_t>>3]=jt*(+D[at>>3]*xr)+jt*(+D[ut>>3]*ct),w=vd(Re,d,$e)|0,w|0){x=w;break}ie=$e,J=A[ie>>2]|0,ie=A[ie+4>>2]|0,z=il(J|0,ie|0,l|0,h|0)|0,M=k()|0,w=y+(z<<3)|0,O=w,E=A[O>>2]|0,O=A[O+4>>2]|0;n:do if((E|0)==0&(O|0)==0)ne=w,dt=16;else for($=0,j=0;;){if(($|0)>(h|0)|($|0)==(h|0)&j>>>0>l>>>0){x=1;break t}if((E|0)==(J|0)&(O|0)==(ie|0))break n;if(w=He(z|0,M|0,1,0)|0,z=rl(w|0,k()|0,l|0,h|0)|0,M=k()|0,j=He(j|0,$|0,1,0)|0,$=k()|0,w=y+(z<<3)|0,O=w,E=A[O>>2]|0,O=A[O+4>>2]|0,(E|0)==0&(O|0)==0){ne=w,dt=16;break}}while(!1);if((dt|0)==16&&(dt=0,!((J|0)==0&(ie|0)==0))&&(j=ne,A[j>>2]=J,A[j+4>>2]=ie,j=_+(A[m>>2]<<3)|0,A[j>>2]=J,A[j+4>>2]=ie,j=m,j=He(A[j>>2]|0,A[j+4>>2]|0,1,0)|0,J=k()|0,ie=m,A[ie>>2]=j,A[ie+4>>2]=J),Ae=He(Ae|0,ue|0,1,0)|0,ue=k()|0,w=Ne,E=A[w>>2]|0,w=A[w+4>>2]|0,!((w|0)>(ue|0)|(w|0)==(ue|0)&E>>>0>Ae>>>0)){E=1;break e}}E=0}else E=1;while(!1);if(se=se+1|0,!E){dt=21;break}if(w=A[u>>2]|0,(se|0)>=(w|0)){x=0,dt=21;break}}return(dt|0)==21?(L=$t,x|0):0}function S7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0,$e=0,ke=0,at=0,ut=0,_t=0,et=0,je=0,Ne=0,dt=0,$t=0,ct=0,jt=0,xr=0;if(xr=L,L=L+112|0,dt=xr+80|0,w=xr+72|0,$t=xr,ct=xr+56|0,m=bu(h)|0,m|0)return jt=m,L=xr,jt|0;if(E=u+8|0,jt=Ji((A[E>>2]<<5)+32|0)|0,!jt)return jt=13,L=xr,jt|0;if(Nd(u,jt),m=bu(h)|0,!m){if(je=u,Ne=A[je+4>>2]|0,m=w,A[m>>2]=A[je>>2],A[m+4>>2]=Ne,Q_(w,dt),m=E_(dt,l,$t)|0,m)je=0,Ne=0;else{if(m=A[w>>2]|0,_=A[E>>2]|0,(_|0)>0){y=A[u+12>>2]|0,h=0;do m=(A[y+(h<<3)>>2]|0)+m|0,h=h+1|0;while((h|0)!=(_|0));h=m}else h=m;m=$t,_=A[m>>2]|0,m=A[m+4>>2]|0,y=((h|0)<0)<<31>>31,(m|0)<(y|0)|(m|0)==(y|0)&_>>>0<h>>>0?(m=$t,A[m>>2]=h,A[m+4>>2]=y,m=y):h=_,je=He(h|0,m|0,12,0)|0,Ne=k()|0,m=$t,A[m>>2]=je,A[m+4>>2]=Ne,m=0}if(!m){if(h=Dr(je,8)|0,!h)return We(jt),jt=13,L=xr,jt|0;if(x=Dr(je,8)|0,!x)return We(jt),We(h),jt=13,L=xr,jt|0;_t=dt,A[_t>>2]=0,A[_t+4>>2]=0,_t=u,et=A[_t+4>>2]|0,m=w,A[m>>2]=A[_t>>2],A[m+4>>2]=et,m=v_(w,je,Ne,l,dt,h,x)|0;e:do if(m)We(h),We(x),We(jt);else{t:do if((A[E>>2]|0)>0){for(y=u+12|0,_=0;m=v_((A[y>>2]|0)+(_<<3)|0,je,Ne,l,dt,h,x)|0,_=_+1|0,!(m|0);)if((_|0)>=(A[E>>2]|0))break t;We(h),We(x),We(jt);break e}while(!1);(Ne|0)>0|(Ne|0)==0&je>>>0>0&&go(x|0,0,je<<3|0)|0,et=dt,_t=A[et+4>>2]|0;t:do if((_t|0)>0|(_t|0)==0&(A[et>>2]|0)>>>0>0){ke=h,at=x,ut=h,_t=x,et=h,m=h,ne=h,Re=x,$e=x,h=x;n:for(;;){for(ie=0,Ae=0,ue=0,se=0,_=0,y=0;;){x=$t,w=x+56|0;do A[x>>2]=0,x=x+4|0;while((x|0)<(w|0));if(l=ke+(ie<<3)|0,E=A[l>>2]|0,l=A[l+4>>2]|0,__(E,l,1,$t,0)|0){x=$t,w=x+56|0;do A[x>>2]=0,x=x+4|0;while((x|0)<(w|0));x=Dr(7,4)|0,x|0&&(Zi(E,l,1,$t,x,7,0,0)|0,We(x))}for(J=0;;){j=$t+(J<<3)|0,$=A[j>>2]|0,j=A[j+4>>2]|0;r:do if(($|0)==0&(j|0)==0)x=_,w=y;else{if(M=il($|0,j|0,je|0,Ne|0)|0,E=k()|0,x=d+(M<<3)|0,l=x,w=A[l>>2]|0,l=A[l+4>>2]|0,!((w|0)==0&(l|0)==0)){O=0,z=0;do{if((O|0)>(Ne|0)|(O|0)==(Ne|0)&z>>>0>je>>>0)break n;if((w|0)==($|0)&(l|0)==(j|0)){x=_,w=y;break r}x=He(M|0,E|0,1,0)|0,M=rl(x|0,k()|0,je|0,Ne|0)|0,E=k()|0,z=He(z|0,O|0,1,0)|0,O=k()|0,x=d+(M<<3)|0,l=x,w=A[l>>2]|0,l=A[l+4>>2]|0}while(!((w|0)==0&(l|0)==0))}if(($|0)==0&(j|0)==0){x=_,w=y;break}aa($,j,ct)|0,Rd(u,jt,ct)|0&&(z=He(_|0,y|0,1,0)|0,y=k()|0,O=x,A[O>>2]=$,A[O+4>>2]=j,_=at+(_<<3)|0,A[_>>2]=$,A[_+4>>2]=j,_=z),x=_,w=y}while(!1);if(J=J+1|0,J>>>0>=7)break;_=x,y=w}if(ie=He(ie|0,Ae|0,1,0)|0,Ae=k()|0,ue=He(ue|0,se|0,1,0)|0,se=k()|0,y=dt,_=A[y>>2]|0,y=A[y+4>>2]|0,(se|0)<(y|0)|(se|0)==(y|0)&ue>>>0<_>>>0)_=x,y=w;else break}if((y|0)>0|(y|0)==0&_>>>0>0){_=0,y=0;do se=ke+(_<<3)|0,A[se>>2]=0,A[se+4>>2]=0,_=He(_|0,y|0,1,0)|0,y=k()|0,se=dt,ue=A[se+4>>2]|0;while((y|0)<(ue|0)|((y|0)==(ue|0)?_>>>0<(A[se>>2]|0)>>>0:0))}if(se=dt,A[se>>2]=x,A[se+4>>2]=w,(w|0)>0|(w|0)==0&x>>>0>0)J=h,ie=$e,Ae=et,ue=Re,se=at,h=ne,$e=m,Re=ut,ne=J,m=ie,et=_t,_t=Ae,ut=ue,at=ke,ke=se;else break t}We(ut),We(_t),We(jt),m=1;break e}else m=x;while(!1);We(jt),We(h),We(m),m=0}while(!1);return jt=m,L=xr,jt|0}}return We(jt),jt=m,L=xr,jt|0}function E7(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;if(M=L,L=L+176|0,w=M,(l|0)<1)return ey(h,0,0),E=0,L=M,E|0;for(x=u,x=ge(A[x>>2]|0,A[x+4>>2]|0,52)|0,k()|0,ey(h,(l|0)>6?l:6,x&15),x=0;d=u+(x<<3)|0,d=tl(A[d>>2]|0,A[d+4>>2]|0,w)|0,!(d|0);){if(d=A[w>>2]|0,(d|0)>0){y=0;do _=w+8+(y<<4)|0,y=y+1|0,d=w+8+(((y|0)%(d|0)|0)<<4)|0,m=tN(h,d,_)|0,m?ry(h,m)|0:eN(h,_,d)|0,d=A[w>>2]|0;while((y|0)<(d|0))}if(x=x+1|0,(x|0)>=(l|0)){d=0,E=13;break}}return(E|0)==13?(L=M,d|0):(ty(h),E=d,L=M,E|0)}function N7(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0;if(_=L,L=L+32|0,d=_,m=_+16|0,u=E7(u,l,m)|0,u|0)return h=u,L=_,h|0;if(A[h>>2]=0,A[h+4>>2]=0,A[h+8>>2]=0,u=ny(m)|0,u|0)do{l=ME(h)|0;do PE(l,u)|0,y=u+16|0,A[d>>2]=A[y>>2],A[d+4>>2]=A[y+4>>2],A[d+8>>2]=A[y+8>>2],A[d+12>>2]=A[y+12>>2],ry(m,u)|0,u=nN(m,d)|0;while((u|0)!=0);u=ny(m)|0}while((u|0)!=0);return ty(m),u=BE(h)|0,u?($_(h),y=u,L=_,y|0):(y=0,L=_,y|0)}function rn(u){return u=u|0,u>>>0>121?(u=0,u|0):(u=A[7696+(u*28|0)+16>>2]|0,u|0)}function od(u){return u=u|0,(u|0)==4|(u|0)==117|0}function x_(u){return u=u|0,A[11120+((A[u>>2]|0)*216|0)+((A[u+4>>2]|0)*72|0)+((A[u+8>>2]|0)*24|0)+(A[u+12>>2]<<3)>>2]|0}function R7(u){return u=u|0,A[11120+((A[u>>2]|0)*216|0)+((A[u+4>>2]|0)*72|0)+((A[u+8>>2]|0)*24|0)+(A[u+12>>2]<<3)+4>>2]|0}function C7(u,l){u=u|0,l=l|0,u=7696+(u*28|0)|0,A[l>>2]=A[u>>2],A[l+4>>2]=A[u+4>>2],A[l+8>>2]=A[u+8>>2],A[l+12>>2]=A[u+12>>2]}function M7(u,l){u=u|0,l=l|0;var h=0,d=0;if(l>>>0>20)return l=-1,l|0;do if((A[11120+(l*216|0)>>2]|0)!=(u|0))if((A[11120+(l*216|0)+8>>2]|0)!=(u|0))if((A[11120+(l*216|0)+16>>2]|0)!=(u|0))if((A[11120+(l*216|0)+24>>2]|0)!=(u|0))if((A[11120+(l*216|0)+32>>2]|0)!=(u|0))if((A[11120+(l*216|0)+40>>2]|0)!=(u|0))if((A[11120+(l*216|0)+48>>2]|0)!=(u|0))if((A[11120+(l*216|0)+56>>2]|0)!=(u|0))if((A[11120+(l*216|0)+64>>2]|0)!=(u|0))if((A[11120+(l*216|0)+72>>2]|0)!=(u|0))if((A[11120+(l*216|0)+80>>2]|0)!=(u|0))if((A[11120+(l*216|0)+88>>2]|0)!=(u|0))if((A[11120+(l*216|0)+96>>2]|0)!=(u|0))if((A[11120+(l*216|0)+104>>2]|0)!=(u|0))if((A[11120+(l*216|0)+112>>2]|0)!=(u|0))if((A[11120+(l*216|0)+120>>2]|0)!=(u|0))if((A[11120+(l*216|0)+128>>2]|0)!=(u|0))if((A[11120+(l*216|0)+136>>2]|0)==(u|0))u=2,h=1,d=2;else{if((A[11120+(l*216|0)+144>>2]|0)==(u|0)){u=0,h=2,d=0;break}if((A[11120+(l*216|0)+152>>2]|0)==(u|0)){u=0,h=2,d=1;break}if((A[11120+(l*216|0)+160>>2]|0)==(u|0)){u=0,h=2,d=2;break}if((A[11120+(l*216|0)+168>>2]|0)==(u|0)){u=1,h=2,d=0;break}if((A[11120+(l*216|0)+176>>2]|0)==(u|0)){u=1,h=2,d=1;break}if((A[11120+(l*216|0)+184>>2]|0)==(u|0)){u=1,h=2,d=2;break}if((A[11120+(l*216|0)+192>>2]|0)==(u|0)){u=2,h=2,d=0;break}if((A[11120+(l*216|0)+200>>2]|0)==(u|0)){u=2,h=2,d=1;break}if((A[11120+(l*216|0)+208>>2]|0)==(u|0)){u=2,h=2,d=2;break}else u=-1;return u|0}else u=2,h=1,d=1;else u=2,h=1,d=0;else u=1,h=1,d=2;else u=1,h=1,d=1;else u=1,h=1,d=0;else u=0,h=1,d=2;else u=0,h=1,d=1;else u=0,h=1,d=0;else u=2,h=0,d=2;else u=2,h=0,d=1;else u=2,h=0,d=0;else u=1,h=0,d=2;else u=1,h=0,d=1;else u=1,h=0,d=0;else u=0,h=0,d=2;else u=0,h=0,d=1;else u=0,h=0,d=0;while(!1);return l=A[11120+(l*216|0)+(h*72|0)+(u*24|0)+(d<<3)+4>>2]|0,l|0}function b_(u,l){return u=u|0,l=l|0,(A[7696+(u*28|0)+20>>2]|0)==(l|0)?(l=1,l|0):(l=(A[7696+(u*28|0)+24>>2]|0)==(l|0),l|0)}function ad(u,l){return u=u|0,l=l|0,A[848+(u*28|0)+(l<<2)>>2]|0}function ld(u,l){return u=u|0,l=l|0,(A[848+(u*28|0)>>2]|0)==(l|0)?(l=0,l|0):(A[848+(u*28|0)+4>>2]|0)==(l|0)?(l=1,l|0):(A[848+(u*28|0)+8>>2]|0)==(l|0)?(l=2,l|0):(A[848+(u*28|0)+12>>2]|0)==(l|0)?(l=3,l|0):(A[848+(u*28|0)+16>>2]|0)==(l|0)?(l=4,l|0):(A[848+(u*28|0)+20>>2]|0)==(l|0)?(l=5,l|0):((A[848+(u*28|0)+24>>2]|0)==(l|0)?6:7)|0}function P7(){return 122}function B7(u){u=u|0;var l=0,h=0,d=0;l=0;do Ee(l|0,0,45)|0,d=k()|0|134225919,h=u+(l<<3)|0,A[h>>2]=-1,A[h+4>>2]=d,l=l+1|0;while((l|0)!=122);return 0}function D7(u){u=u|0;var l=0,h=0,d=0;return d=+D[u+16>>3],h=+D[u+24>>3],l=d-h,+(d<h?l+6.283185307179586:l)}function T_(u){return u=u|0,+D[u+16>>3]<+D[u+24>>3]|0}function L7(u){return u=u|0,+(+D[u>>3]-+D[u+8>>3])}function ud(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;return h=+D[l>>3],!(h>=+D[u+8>>3])||!(h<=+D[u>>3])?(l=0,l|0):(d=+D[u+16>>3],h=+D[u+24>>3],m=+D[l+8>>3],l=m>=h,u=m<=d&1,d<h?l&&(u=1):l||(u=0),l=(u|0)!=0,l|0)}function Ad(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;return+D[u>>3]<+D[l+8>>3]||+D[u+8>>3]>+D[l>>3]?(d=0,d|0):(_=+D[u+16>>3],h=u+24|0,M=+D[h>>3],y=_<M,d=l+16|0,E=+D[d>>3],m=l+24|0,w=+D[m>>3],x=E<w,l=M-E<w-_,u=y?x|l?1:2:0,l=x?y?1:l?2:1:0,_=+Wr(_,u),_<+Wr(+D[m>>3],l)||(M=+Wr(+D[h>>3],u),M>+Wr(+D[d>>3],l))?(x=0,x|0):(x=1,x|0))}function F7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0;_=+D[u+16>>3],w=+D[u+24>>3],u=_<w,x=+D[l+16>>3],y=+D[l+24>>3],m=x<y,l=w-x<y-_,A[h>>2]=u?m|l?1:2:0,A[d>>2]=m?u?1:l?2:1:0}function w_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;return+D[u>>3]<+D[l>>3]||+D[u+8>>3]>+D[l+8>>3]?(d=0,d|0):(d=u+16|0,w=+D[d>>3],_=+D[u+24>>3],y=w<_,h=l+16|0,M=+D[h>>3],m=l+24|0,E=+D[m>>3],x=M<E,l=_-M<E-w,u=y?x|l?1:2:0,l=x?y?1:l?2:1:0,_=+Wr(_,u),_<=+Wr(+D[m>>3],l)?(M=+Wr(+D[d>>3],u),x=M>=+Wr(+D[h>>3],l),x|0):(x=0,x|0))}function S_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0;m=L,L=L+176|0,d=m,A[d>>2]=4,x=+D[l>>3],D[d+8>>3]=x,_=+D[l+16>>3],D[d+16>>3]=_,D[d+24>>3]=x,x=+D[l+24>>3],D[d+32>>3]=x,y=+D[l+8>>3],D[d+40>>3]=y,D[d+48>>3]=x,D[d+56>>3]=y,D[d+64>>3]=_,l=d+72|0,h=l+96|0;do A[l>>2]=0,l=l+4|0;while((l|0)<(h|0));sl(u|0,d|0,168)|0,L=m}function E_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0;j=L,L=L+288|0,M=j+264|0,O=j+96|0,E=j,x=E,w=x+96|0;do A[x>>2]=0,x=x+4|0;while((x|0)<(w|0));return l=bd(l,E)|0,l|0?($=l,L=j,$|0):(w=E,E=A[w>>2]|0,w=A[w+4>>2]|0,aa(E,w,M)|0,tl(E,w,O)|0,y=+vu(M,O+8|0),D[M>>3]=+D[u>>3],w=M+8|0,D[w>>3]=+D[u+16>>3],D[O>>3]=+D[u+8>>3],E=O+8|0,D[E>>3]=+D[u+24>>3],m=+vu(M,O),ie=+D[w>>3]-+D[E>>3],_=+pt(+ie),J=+D[M>>3]-+D[O>>3],d=+pt(+J),!(ie==0|J==0)&&(ie=+oy(+_,+d),ie=+Za(+(m*m/+gc(+(ie/+gc(+_,+d)),3)/(y*(y*2.59807621135)*.8))),D[Ct>>3]=ie,z=~~ie>>>0,$=+pt(ie)>=1?ie>0?~~+id(+$n(ie/4294967296),4294967295)>>>0:~~+Za((ie-+(~~ie>>>0))/4294967296)>>>0:0,(A[Ct+4>>2]&2146435072|0)!=2146435072)?(O=(z|0)==0&($|0)==0,l=h,A[l>>2]=O?1:z,A[l+4>>2]=O?0:$,l=0):l=1,$=l,L=j,$|0)}function O7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0;E=L,L=L+288|0,y=E+264|0,x=E+96|0,w=E,m=w,_=m+96|0;do A[m>>2]=0,m=m+4|0;while((m|0)<(_|0));return h=bd(h,w)|0,h|0?(d=h,L=E,d|0):(h=w,m=A[h>>2]|0,h=A[h+4>>2]|0,aa(m,h,y)|0,tl(m,h,x)|0,M=+vu(y,x+8|0),M=+Za(+(+vu(u,l)/(M*2))),D[Ct>>3]=M,h=~~M>>>0,m=+pt(M)>=1?M>0?~~+id(+$n(M/4294967296),4294967295)>>>0:~~+Za((M-+(~~M>>>0))/4294967296)>>>0:0,(A[Ct+4>>2]&2146435072|0)==2146435072?(d=1,L=E,d|0):(w=(h|0)==0&(m|0)==0,A[d>>2]=w?1:h,A[d+4>>2]=w?0:m,d=0,L=E,d|0))}function I7(u,l){u=u|0,l=+l;var h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;_=u+16|0,y=+D[_>>3],h=u+24|0,m=+D[h>>3],d=y-m,d=y<m?d+6.283185307179586:d,E=+D[u>>3],x=u+8|0,w=+D[x>>3],M=E-w,d=(d*l-d)*.5,l=(M*l-M)*.5,E=E+l,D[u>>3]=E>1.5707963267948966?1.5707963267948966:E,l=w-l,D[x>>3]=l<-1.5707963267948966?-1.5707963267948966:l,l=y+d,l=l>3.141592653589793?l+-6.283185307179586:l,D[_>>3]=l<-3.141592653589793?l+6.283185307179586:l,l=m-d,l=l>3.141592653589793?l+-6.283185307179586:l,D[h>>3]=l<-3.141592653589793?l+6.283185307179586:l}function k7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0,A[u>>2]=l,A[u+4>>2]=h,A[u+8>>2]=d}function U7(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0;O=l+8|0,A[O>>2]=0,w=+D[u>>3],y=+pt(+w),E=+D[u+8>>3],x=+pt(+E)*1.1547005383792515,y=y+x*.5,h=~~y,u=~~x,y=y-+(h|0),x=x-+(u|0);do if(y<.5)if(y<.3333333333333333)if(A[l>>2]=h,x<(y+1)*.5){A[l+4>>2]=u;break}else{u=u+1|0,A[l+4>>2]=u;break}else if(z=1-y,u=(!(x<z)&1)+u|0,A[l+4>>2]=u,z<=x&x<y*2){h=h+1|0,A[l>>2]=h;break}else{A[l>>2]=h;break}else{if(!(y<.6666666666666666))if(h=h+1|0,A[l>>2]=h,x<y*.5){A[l+4>>2]=u;break}else{u=u+1|0,A[l+4>>2]=u;break}if(x<1-y){if(A[l+4>>2]=u,y*2+-1<x){A[l>>2]=h;break}}else u=u+1|0,A[l+4>>2]=u;h=h+1|0,A[l>>2]=h}while(!1);do if(w<0)if(u&1){M=(u+1|0)/2|0,M=Hn(h|0,((h|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,h=~~(+(h|0)-((+(M>>>0)+4294967296*+(k()|0))*2+1)),A[l>>2]=h;break}else{M=(u|0)/2|0,M=Hn(h|0,((h|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,h=~~(+(h|0)-(+(M>>>0)+4294967296*+(k()|0))*2),A[l>>2]=h;break}while(!1);M=l+4|0,E<0&&(h=h-((u<<1|1|0)/2|0)|0,A[l>>2]=h,u=0-u|0,A[M>>2]=u),d=u-h|0,(h|0)<0?(m=0-h|0,A[M>>2]=d,A[O>>2]=m,A[l>>2]=0,u=d,h=0):m=0,(u|0)<0&&(h=h-u|0,A[l>>2]=h,m=m-u|0,A[O>>2]=m,A[M>>2]=0,u=0),_=h-m|0,d=u-m|0,(m|0)<0&&(A[l>>2]=_,A[M>>2]=d,A[O>>2]=0,u=d,h=_,m=0),d=(u|0)<(h|0)?u:h,d=(m|0)<(d|0)?m:d,!((d|0)<=0)&&(A[l>>2]=h-d,A[M>>2]=u-d,A[O>>2]=m-d)}function Ar(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0;l=A[u>>2]|0,y=u+4|0,h=A[y>>2]|0,(l|0)<0&&(h=h-l|0,A[y>>2]=h,_=u+8|0,A[_>>2]=(A[_>>2]|0)-l,A[u>>2]=0,l=0),(h|0)<0?(l=l-h|0,A[u>>2]=l,_=u+8|0,m=(A[_>>2]|0)-h|0,A[_>>2]=m,A[y>>2]=0,h=0):(m=u+8|0,_=m,m=A[m>>2]|0),(m|0)<0&&(l=l-m|0,A[u>>2]=l,h=h-m|0,A[y>>2]=h,A[_>>2]=0,m=0),d=(h|0)<(l|0)?h:l,d=(m|0)<(d|0)?m:d,!((d|0)<=0)&&(A[u>>2]=l-d,A[y>>2]=h-d,A[_>>2]=m-d)}function ra(u,l){u=u|0,l=l|0;var h=0,d=0;d=A[u+8>>2]|0,h=+((A[u+4>>2]|0)-d|0),D[l>>3]=+((A[u>>2]|0)-d|0)-h*.5,D[l+8>>3]=h*.8660254037844386}function vr(u,l,h){u=u|0,l=l|0,h=h|0,A[h>>2]=(A[l>>2]|0)+(A[u>>2]|0),A[h+4>>2]=(A[l+4>>2]|0)+(A[u+4>>2]|0),A[h+8>>2]=(A[l+8>>2]|0)+(A[u+8>>2]|0)}function cd(u,l,h){u=u|0,l=l|0,h=h|0,A[h>>2]=(A[u>>2]|0)-(A[l>>2]|0),A[h+4>>2]=(A[u+4>>2]|0)-(A[l+4>>2]|0),A[h+8>>2]=(A[u+8>>2]|0)-(A[l+8>>2]|0)}function N_(u,l){u=u|0,l=l|0;var h=0,d=0;h=Ki(A[u>>2]|0,l)|0,A[u>>2]=h,h=u+4|0,d=Ki(A[h>>2]|0,l)|0,A[h>>2]=d,u=u+8|0,l=Ki(A[u>>2]|0,l)|0,A[u>>2]=l}function Ac(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;y=A[u>>2]|0,x=(y|0)<0,d=(A[u+4>>2]|0)-(x?y:0)|0,_=(d|0)<0,m=(_?0-d|0:0)+((A[u+8>>2]|0)-(x?y:0))|0,h=(m|0)<0,u=h?0:m,l=(_?0:d)-(h?m:0)|0,m=(x?0:y)-(_?d:0)-(h?m:0)|0,h=(l|0)<(m|0)?l:m,h=(u|0)<(h|0)?u:h,d=(h|0)>0,u=u-(d?h:0)|0,l=l-(d?h:0)|0;e:do switch(m-(d?h:0)|0){case 0:switch(l|0){case 0:return x=(u|0)==0?0:(u|0)==1?1:7,x|0;case 1:return x=(u|0)==0?2:(u|0)==1?3:7,x|0;default:break e}case 1:switch(l|0){case 0:return x=(u|0)==0?4:(u|0)==1?5:7,x|0;case 1:{if(!u)u=6;else break e;return u|0}default:break e}}while(!1);return x=7,x|0}function q7(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0;if(w=u+8|0,y=A[w>>2]|0,x=(A[u>>2]|0)-y|0,E=u+4|0,y=(A[E>>2]|0)-y|0,x>>>0>715827881|y>>>0>715827881){if(d=(x|0)>0,m=2147483647-x|0,_=-2147483648-x|0,(d?(m|0)<(x|0):(_|0)>(x|0))||(h=x<<1,d?(2147483647-h|0)<(x|0):(-2147483648-h|0)>(x|0))||((y|0)>0?(2147483647-y|0)<(y|0):(-2147483648-y|0)>(y|0))||(l=x*3|0,h=y<<1,(d?(m|0)<(h|0):(_|0)>(h|0))||((x|0)>-1?(l|-2147483648|0)>=(y|0):(l^-2147483648|0)<(y|0))))return E=1,E|0}else h=y<<1,l=x*3|0;return d=po(+(l-y|0)*.14285714285714285)|0,A[u>>2]=d,m=po(+(h+x|0)*.14285714285714285)|0,A[E>>2]=m,A[w>>2]=0,h=(m|0)<(d|0),l=h?d:m,h=h?m:d,(h|0)<0&&(((h|0)==-2147483648||((l|0)>0?(2147483647-l|0)<(h|0):(-2147483648-l|0)>(h|0)))&&tt(27795,26892,354,26903),((l|0)>-1?(l|-2147483648|0)>=(h|0):(l^-2147483648|0)<(h|0))&&tt(27795,26892,354,26903)),l=m-d|0,(d|0)<0?(h=0-d|0,A[E>>2]=l,A[w>>2]=h,A[u>>2]=0,d=0):(l=m,h=0),(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[w>>2]=h,A[E>>2]=0,l=0),_=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=_,A[E>>2]=m,A[w>>2]=0,l=m,m=_,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,(d|0)<=0?(E=0,E|0):(A[u>>2]=m-d,A[E>>2]=l-d,A[w>>2]=h-d,E=0,E|0)}function G7(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0,w=0;if(y=u+8|0,m=A[y>>2]|0,_=(A[u>>2]|0)-m|0,x=u+4|0,m=(A[x>>2]|0)-m|0,_>>>0>715827881|m>>>0>715827881){if(h=(_|0)>0,(h?(2147483647-_|0)<(_|0):(-2147483648-_|0)>(_|0))||(l=_<<1,d=(m|0)>0,d?(2147483647-m|0)<(m|0):(-2147483648-m|0)>(m|0)))return x=1,x|0;if(w=m<<1,(d?(2147483647-w|0)<(m|0):(-2147483648-w|0)>(m|0))||(h?(2147483647-l|0)<(m|0):(-2147483648-l|0)>(m|0))||(h=m*3|0,(m|0)>-1?(h|-2147483648|0)>=(_|0):(h^-2147483648|0)<(_|0)))return w=1,w|0}else h=m*3|0,l=_<<1;return d=po(+(l+m|0)*.14285714285714285)|0,A[u>>2]=d,m=po(+(h-_|0)*.14285714285714285)|0,A[x>>2]=m,A[y>>2]=0,h=(m|0)<(d|0),l=h?d:m,h=h?m:d,(h|0)<0&&(((h|0)==-2147483648||((l|0)>0?(2147483647-l|0)<(h|0):(-2147483648-l|0)>(h|0)))&&tt(27795,26892,402,26917),((l|0)>-1?(l|-2147483648|0)>=(h|0):(l^-2147483648|0)<(h|0))&&tt(27795,26892,402,26917)),l=m-d|0,(d|0)<0?(h=0-d|0,A[x>>2]=l,A[y>>2]=h,A[u>>2]=0,d=0):(l=m,h=0),(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[y>>2]=h,A[x>>2]=0,l=0),_=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=_,A[x>>2]=m,A[y>>2]=0,l=m,m=_,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,(d|0)<=0?(w=0,w|0):(A[u>>2]=m-d,A[x>>2]=l-d,A[y>>2]=h-d,w=0,w|0)}function V7(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;y=u+8|0,h=A[y>>2]|0,l=(A[u>>2]|0)-h|0,x=u+4|0,h=(A[x>>2]|0)-h|0,d=po(+((l*3|0)-h|0)*.14285714285714285)|0,A[u>>2]=d,l=po(+((h<<1)+l|0)*.14285714285714285)|0,A[x>>2]=l,A[y>>2]=0,h=l-d|0,(d|0)<0?(_=0-d|0,A[x>>2]=h,A[y>>2]=_,A[u>>2]=0,l=h,d=0,h=_):h=0,(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[y>>2]=h,A[x>>2]=0,l=0),_=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=_,A[x>>2]=m,A[y>>2]=0,l=m,m=_,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(A[u>>2]=m-d,A[x>>2]=l-d,A[y>>2]=h-d)}function R_(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;y=u+8|0,h=A[y>>2]|0,l=(A[u>>2]|0)-h|0,x=u+4|0,h=(A[x>>2]|0)-h|0,d=po(+((l<<1)+h|0)*.14285714285714285)|0,A[u>>2]=d,l=po(+((h*3|0)-l|0)*.14285714285714285)|0,A[x>>2]=l,A[y>>2]=0,h=l-d|0,(d|0)<0?(_=0-d|0,A[x>>2]=h,A[y>>2]=_,A[u>>2]=0,l=h,d=0,h=_):h=0,(l|0)<0&&(d=d-l|0,A[u>>2]=d,h=h-l|0,A[y>>2]=h,A[x>>2]=0,l=0),_=d-h|0,m=l-h|0,(h|0)<0?(A[u>>2]=_,A[x>>2]=m,A[y>>2]=0,l=m,m=_,h=0):m=d,d=(l|0)<(m|0)?l:m,d=(h|0)<(d|0)?h:d,!((d|0)<=0)&&(A[u>>2]=m-d,A[x>>2]=l-d,A[y>>2]=h-d)}function cc(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;l=A[u>>2]|0,y=u+4|0,h=A[y>>2]|0,x=u+8|0,d=A[x>>2]|0,m=h+(l*3|0)|0,A[u>>2]=m,h=d+(h*3|0)|0,A[y>>2]=h,l=(d*3|0)+l|0,A[x>>2]=l,d=h-m|0,(m|0)<0?(l=l-m|0,A[y>>2]=d,A[x>>2]=l,A[u>>2]=0,h=d,d=0):d=m,(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[x>>2]=l,A[y>>2]=0,h=0),_=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=_,A[y>>2]=m,A[x>>2]=0,d=_,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[y>>2]=m-h,A[x>>2]=l-h)}function ia(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;m=A[u>>2]|0,y=u+4|0,l=A[y>>2]|0,x=u+8|0,h=A[x>>2]|0,d=(l*3|0)+m|0,m=h+(m*3|0)|0,A[u>>2]=m,A[y>>2]=d,l=(h*3|0)+l|0,A[x>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[y>>2]=h,A[x>>2]=l,A[u>>2]=0,m=0):h=d,(h|0)<0&&(m=m-h|0,A[u>>2]=m,l=l-h|0,A[x>>2]=l,A[y>>2]=0,h=0),_=m-l|0,d=h-l|0,(l|0)<0?(A[u>>2]=_,A[y>>2]=d,A[x>>2]=0,m=_,l=0):d=h,h=(d|0)<(m|0)?d:m,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=m-h,A[y>>2]=d-h,A[x>>2]=l-h)}function C_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0;(l+-1|0)>>>0>=6||(m=(A[15440+(l*12|0)>>2]|0)+(A[u>>2]|0)|0,A[u>>2]=m,x=u+4|0,d=(A[15440+(l*12|0)+4>>2]|0)+(A[x>>2]|0)|0,A[x>>2]=d,y=u+8|0,l=(A[15440+(l*12|0)+8>>2]|0)+(A[y>>2]|0)|0,A[y>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[x>>2]=h,A[y>>2]=l,A[u>>2]=0,d=0):(h=d,d=m),(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[y>>2]=l,A[x>>2]=0,h=0),_=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=_,A[x>>2]=m,A[y>>2]=0,d=_,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[x>>2]=m-h,A[y>>2]=l-h))}function M_(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;m=A[u>>2]|0,y=u+4|0,l=A[y>>2]|0,x=u+8|0,h=A[x>>2]|0,d=l+m|0,m=h+m|0,A[u>>2]=m,A[y>>2]=d,l=h+l|0,A[x>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[y>>2]=h,A[x>>2]=l,A[u>>2]=0,d=0):(h=d,d=m),(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[x>>2]=l,A[y>>2]=0,h=0),_=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=_,A[y>>2]=m,A[x>>2]=0,d=_,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[y>>2]=m-h,A[x>>2]=l-h)}function hc(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;l=A[u>>2]|0,y=u+4|0,d=A[y>>2]|0,x=u+8|0,h=A[x>>2]|0,m=d+l|0,A[u>>2]=m,d=h+d|0,A[y>>2]=d,l=h+l|0,A[x>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[y>>2]=h,A[x>>2]=l,A[u>>2]=0,d=0):(h=d,d=m),(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[x>>2]=l,A[y>>2]=0,h=0),_=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=_,A[y>>2]=m,A[x>>2]=0,d=_,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[y>>2]=m-h,A[x>>2]=l-h)}function sa(u){switch(u=u|0,u|0){case 1:{u=5;break}case 5:{u=4;break}case 4:{u=6;break}case 6:{u=2;break}case 2:{u=3;break}case 3:{u=1;break}}return u|0}function ho(u){switch(u=u|0,u|0){case 1:{u=3;break}case 3:{u=2;break}case 2:{u=6;break}case 6:{u=4;break}case 4:{u=5;break}case 5:{u=1;break}}return u|0}function P_(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;l=A[u>>2]|0,y=u+4|0,h=A[y>>2]|0,x=u+8|0,d=A[x>>2]|0,m=h+(l<<1)|0,A[u>>2]=m,h=d+(h<<1)|0,A[y>>2]=h,l=(d<<1)+l|0,A[x>>2]=l,d=h-m|0,(m|0)<0?(l=l-m|0,A[y>>2]=d,A[x>>2]=l,A[u>>2]=0,h=d,d=0):d=m,(h|0)<0&&(d=d-h|0,A[u>>2]=d,l=l-h|0,A[x>>2]=l,A[y>>2]=0,h=0),_=d-l|0,m=h-l|0,(l|0)<0?(A[u>>2]=_,A[y>>2]=m,A[x>>2]=0,d=_,l=0):m=h,h=(m|0)<(d|0)?m:d,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=d-h,A[y>>2]=m-h,A[x>>2]=l-h)}function B_(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;m=A[u>>2]|0,y=u+4|0,l=A[y>>2]|0,x=u+8|0,h=A[x>>2]|0,d=(l<<1)+m|0,m=h+(m<<1)|0,A[u>>2]=m,A[y>>2]=d,l=(h<<1)+l|0,A[x>>2]=l,h=d-m|0,(m|0)<0?(l=l-m|0,A[y>>2]=h,A[x>>2]=l,A[u>>2]=0,m=0):h=d,(h|0)<0&&(m=m-h|0,A[u>>2]=m,l=l-h|0,A[x>>2]=l,A[y>>2]=0,h=0),_=m-l|0,d=h-l|0,(l|0)<0?(A[u>>2]=_,A[y>>2]=d,A[x>>2]=0,m=_,l=0):d=h,h=(d|0)<(m|0)?d:m,h=(l|0)<(h|0)?l:h,!((h|0)<=0)&&(A[u>>2]=m-h,A[y>>2]=d-h,A[x>>2]=l-h)}function hd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0;return y=(A[u>>2]|0)-(A[l>>2]|0)|0,x=(y|0)<0,d=(A[u+4>>2]|0)-(A[l+4>>2]|0)-(x?y:0)|0,_=(d|0)<0,m=(x?0-y|0:0)+(A[u+8>>2]|0)-(A[l+8>>2]|0)+(_?0-d|0:0)|0,u=(m|0)<0,l=u?0:m,h=(_?0:d)-(u?m:0)|0,m=(x?0:y)-(_?d:0)-(u?m:0)|0,u=(h|0)<(m|0)?h:m,u=(l|0)<(u|0)?l:u,d=(u|0)>0,l=l-(d?u:0)|0,h=h-(d?u:0)|0,u=m-(d?u:0)|0,u=(u|0)>-1?u:0-u|0,h=(h|0)>-1?h:0-h|0,l=(l|0)>-1?l:0-l|0,l=(h|0)>(l|0)?h:l,((u|0)>(l|0)?u:l)|0}function z7(u,l){u=u|0,l=l|0;var h=0;h=A[u+8>>2]|0,A[l>>2]=(A[u>>2]|0)-h,A[l+4>>2]=(A[u+4>>2]|0)-h}function $7(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0;return d=A[u>>2]|0,A[l>>2]=d,m=A[u+4>>2]|0,y=l+4|0,A[y>>2]=m,x=l+8|0,A[x>>2]=0,h=(m|0)<(d|0),u=h?d:m,h=h?m:d,(h|0)<0&&((h|0)==-2147483648||((u|0)>0?(2147483647-u|0)<(h|0):(-2147483648-u|0)>(h|0))||((u|0)>-1?(u|-2147483648|0)>=(h|0):(u^-2147483648|0)<(h|0)))?(l=1,l|0):(u=m-d|0,(d|0)<0?(h=0-d|0,A[y>>2]=u,A[x>>2]=h,A[l>>2]=0,d=0):(u=m,h=0),(u|0)<0&&(d=d-u|0,A[l>>2]=d,h=h-u|0,A[x>>2]=h,A[y>>2]=0,u=0),_=d-h|0,m=u-h|0,(h|0)<0?(A[l>>2]=_,A[y>>2]=m,A[x>>2]=0,u=m,m=_,h=0):m=d,d=(u|0)<(m|0)?u:m,d=(h|0)<(d|0)?h:d,(d|0)<=0?(l=0,l|0):(A[l>>2]=m-d,A[y>>2]=u-d,A[x>>2]=h-d,l=0,l|0))}function D_(u){u=u|0;var l=0,h=0,d=0,m=0;l=u+8|0,m=A[l>>2]|0,h=m-(A[u>>2]|0)|0,A[u>>2]=h,d=u+4|0,u=(A[d>>2]|0)-m|0,A[d>>2]=u,A[l>>2]=0-(u+h)}function j7(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;h=A[u>>2]|0,l=0-h|0,A[u>>2]=l,y=u+8|0,A[y>>2]=0,x=u+4|0,d=A[x>>2]|0,m=d+h|0,(h|0)>0?(A[x>>2]=m,A[y>>2]=h,A[u>>2]=0,l=0,d=m):h=0,(d|0)<0?(_=l-d|0,A[u>>2]=_,h=h-d|0,A[y>>2]=h,A[x>>2]=0,m=_-h|0,l=0-h|0,(h|0)<0?(A[u>>2]=m,A[x>>2]=l,A[y>>2]=0,d=l,h=0):(d=0,m=_)):m=l,l=(d|0)<(m|0)?d:m,l=(h|0)<(l|0)?h:l,!((l|0)<=0)&&(A[u>>2]=m-l,A[x>>2]=d-l,A[y>>2]=h-l)}function H7(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0;if(O=L,L=L+64|0,M=O,x=O+56|0,!(!0&(l&2013265920|0)==134217728&(!0&(d&2013265920|0)==134217728)))return m=5,L=O,m|0;if((u|0)==(h|0)&(l|0)==(d|0))return A[m>>2]=0,m=0,L=O,m|0;if(y=ge(u|0,l|0,52)|0,k()|0,y=y&15,E=ge(h|0,d|0,52)|0,k()|0,(y|0)!=(E&15|0))return m=12,L=O,m|0;if(_=y+-1|0,y>>>0>1){gd(u,l,_,M)|0,gd(h,d,_,x)|0,E=M,w=A[E>>2]|0,E=A[E+4>>2]|0;e:do if((w|0)==(A[x>>2]|0)&&(E|0)==(A[x+4>>2]|0)){y=(y^15)*3|0,_=ge(u|0,l|0,y|0)|0,k()|0,_=_&7,y=ge(h|0,d|0,y|0)|0,k()|0,y=y&7;do if((_|0)==0|(y|0)==0)A[m>>2]=1,_=0;else if((_|0)==7)_=5;else{if((_|0)==1|(y|0)==1&&Qt(w,E)|0){_=5;break}if((A[15536+(_<<2)>>2]|0)!=(y|0)&&(A[15568+(_<<2)>>2]|0)!=(y|0))break e;A[m>>2]=1,_=0}while(!1);return m=_,L=O,m|0}while(!1)}_=M,y=_+56|0;do A[_>>2]=0,_=_+4|0;while((_|0)<(y|0));return m_(u,l,1,M)|0,l=M,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0))&&(l=M+8|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+16|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+24|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+32|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))&&(l=M+40|0,!((A[l>>2]|0)==(h|0)&&(A[l+4>>2]|0)==(d|0)))?(_=M+48|0,_=((A[_>>2]|0)==(h|0)?(A[_+4>>2]|0)==(d|0):0)&1):_=1,A[m>>2]=_,m=0,L=O,m|0}function W7(u,l,h,d,m){return u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,h=sd(u,l,h,d)|0,(h|0)==7?(m=11,m|0):(d=Ee(h|0,0,56)|0,l=l&-2130706433|(k()|0)|268435456,A[m>>2]=u|d,A[m+4>>2]=l,m=0,m|0)}function Q7(u,l,h){return u=u|0,l=l|0,h=h|0,!0&(l&2013265920|0)==268435456?(A[h>>2]=u,A[h+4>>2]=l&-2130706433|134217728,h=0,h|0):(h=6,h|0)}function Y7(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0;return m=L,L=L+16|0,d=m,A[d>>2]=0,!0&(l&2013265920|0)==268435456?(_=ge(u|0,l|0,56)|0,k()|0,d=jn(u,l&-2130706433|134217728,_&7,d,h)|0,L=m,d|0):(d=6,L=m,d|0)}function L_(u,l){u=u|0,l=l|0;var h=0;switch(h=ge(u|0,l|0,56)|0,k()|0,h&7){case 0:case 7:return h=0,h|0}return h=l&-2130706433|134217728,!(!0&(l&2013265920|0)==268435456)||!0&(l&117440512|0)==16777216&(Qt(u,h)|0)!=0?(h=0,h|0):(h=pd(u,h)|0,h|0)}function X7(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0;return m=L,L=L+16|0,d=m,!0&(l&2013265920|0)==268435456?(_=l&-2130706433|134217728,y=h,A[y>>2]=u,A[y+4>>2]=_,A[d>>2]=0,l=ge(u|0,l|0,56)|0,k()|0,d=jn(u,_,l&7,d,h+8|0)|0,L=m,d|0):(d=6,L=m,d|0)}function K7(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;return m=(Qt(u,l)|0)==0,l=l&-2130706433,d=h,A[d>>2]=m?u:0,A[d+4>>2]=m?l|285212672:0,d=h+8|0,A[d>>2]=u,A[d+4>>2]=l|301989888,d=h+16|0,A[d>>2]=u,A[d+4>>2]=l|318767104,d=h+24|0,A[d>>2]=u,A[d+4>>2]=l|335544320,d=h+32|0,A[d>>2]=u,A[d+4>>2]=l|352321536,h=h+40|0,A[h>>2]=u,A[h+4>>2]=l|369098752,0}function fc(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0;return y=L,L=L+16|0,m=y,_=l&-2130706433|134217728,!0&(l&2013265920|0)==268435456?(d=ge(u|0,l|0,56)|0,k()|0,d=KE(u,_,d&7)|0,(d|0)==-1?(A[h>>2]=0,_=6,L=y,_|0):(el(u,_,m)|0&&tt(27795,26932,282,26947),l=ge(u|0,l|0,52)|0,k()|0,l=l&15,Qt(u,_)|0?fd(m,l,d,2,h):dd(m,l,d,2,h),_=0,L=y,_|0)):(_=6,L=y,_|0)}function Z7(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;d=L,L=L+16|0,m=d,J7(u,l,h,m),U7(m,h+4|0),L=d}function J7(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0;if(x=L,L=L+16|0,w=x,eE(u,h,w),_=+uc(+(1-+D[w>>3]*.5)),_<1e-16){A[d>>2]=0,A[d+4>>2]=0,A[d+8>>2]=0,A[d+12>>2]=0,L=x;return}if(w=A[h>>2]|0,m=+D[15920+(w*24|0)>>3],m=+yu(m-+yu(+vE(15600+(w<<4)|0,u))),ci(l)|0?y=+yu(m+-.3334731722518321):y=m,m=+ui(+_)*2.618033988749896,(l|0)>0){u=0;do m=m*2.6457513110645907,u=u+1|0;while((u|0)!=(l|0))}_=+Dt(+y)*m,D[d>>3]=_,y=+mt(+y)*m,D[d+8>>3]=y,L=x}function eE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0;if(_=L,L=L+32|0,m=_,XE(u,m),A[l>>2]=0,D[h>>3]=5,d=+Bn(16400,m),d<+D[h>>3]&&(A[l>>2]=0,D[h>>3]=d),d=+Bn(16424,m),d<+D[h>>3]&&(A[l>>2]=1,D[h>>3]=d),d=+Bn(16448,m),d<+D[h>>3]&&(A[l>>2]=2,D[h>>3]=d),d=+Bn(16472,m),d<+D[h>>3]&&(A[l>>2]=3,D[h>>3]=d),d=+Bn(16496,m),d<+D[h>>3]&&(A[l>>2]=4,D[h>>3]=d),d=+Bn(16520,m),d<+D[h>>3]&&(A[l>>2]=5,D[h>>3]=d),d=+Bn(16544,m),d<+D[h>>3]&&(A[l>>2]=6,D[h>>3]=d),d=+Bn(16568,m),d<+D[h>>3]&&(A[l>>2]=7,D[h>>3]=d),d=+Bn(16592,m),d<+D[h>>3]&&(A[l>>2]=8,D[h>>3]=d),d=+Bn(16616,m),d<+D[h>>3]&&(A[l>>2]=9,D[h>>3]=d),d=+Bn(16640,m),d<+D[h>>3]&&(A[l>>2]=10,D[h>>3]=d),d=+Bn(16664,m),d<+D[h>>3]&&(A[l>>2]=11,D[h>>3]=d),d=+Bn(16688,m),d<+D[h>>3]&&(A[l>>2]=12,D[h>>3]=d),d=+Bn(16712,m),d<+D[h>>3]&&(A[l>>2]=13,D[h>>3]=d),d=+Bn(16736,m),d<+D[h>>3]&&(A[l>>2]=14,D[h>>3]=d),d=+Bn(16760,m),d<+D[h>>3]&&(A[l>>2]=15,D[h>>3]=d),d=+Bn(16784,m),d<+D[h>>3]&&(A[l>>2]=16,D[h>>3]=d),d=+Bn(16808,m),d<+D[h>>3]&&(A[l>>2]=17,D[h>>3]=d),d=+Bn(16832,m),d<+D[h>>3]&&(A[l>>2]=18,D[h>>3]=d),d=+Bn(16856,m),!(d<+D[h>>3])){L=_;return}A[l>>2]=19,D[h>>3]=d,L=_}function gu(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0;if(_=+YE(u),_<1e-16){l=15600+(l<<4)|0,A[m>>2]=A[l>>2],A[m+4>>2]=A[l+4>>2],A[m+8>>2]=A[l+8>>2],A[m+12>>2]=A[l+12>>2];return}if(y=+Ai(+ +D[u+8>>3],+ +D[u>>3]),(h|0)>0){u=0;do _=_*.37796447300922725,u=u+1|0;while((u|0)!=(h|0))}x=_*.3333333333333333,d?(h=(ci(h)|0)==0,_=+rd(+((h?x:x*.37796447300922725)*.381966011250105))):(_=+rd(+(_*.381966011250105)),ci(h)|0&&(y=+yu(y+.3334731722518321))),xE(15600+(l<<4)|0,+yu(+D[15920+(l*24|0)>>3]-y),_,m)}function tE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;d=L,L=L+16|0,m=d,ra(u+4|0,m),gu(m,A[u>>2]|0,l,0,h),L=d}function fd(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0,$e=0,ke=0,at=0,ut=0,_t=0,et=0,je=0,Ne=0,dt=0,$t=0,ct=0;if(dt=L,L=L+272|0,_=dt+256|0,ue=dt+240|0,et=dt,je=dt+224|0,Ne=dt+208|0,se=dt+176|0,ne=dt+160|0,Re=dt+192|0,$e=dt+144|0,ke=dt+128|0,at=dt+112|0,ut=dt+96|0,_t=dt+80|0,A[_>>2]=l,A[ue>>2]=A[u>>2],A[ue+4>>2]=A[u+4>>2],A[ue+8>>2]=A[u+8>>2],A[ue+12>>2]=A[u+12>>2],F_(ue,_,et),A[m>>2]=0,ue=d+h+((d|0)==5&1)|0,(ue|0)<=(h|0)){L=dt;return}w=A[_>>2]|0,E=je+4|0,M=se+4|0,O=h+5|0,z=16880+(w<<2)|0,$=16960+(w<<2)|0,j=ke+8|0,J=at+8|0,ie=ut+8|0,Ae=Ne+4|0,x=h;e:for(;;){y=et+(((x|0)%5|0)<<4)|0,A[Ne>>2]=A[y>>2],A[Ne+4>>2]=A[y+4>>2],A[Ne+8>>2]=A[y+8>>2],A[Ne+12>>2]=A[y+12>>2];do;while((Ja(Ne,w,0,1)|0)==2);if((x|0)>(h|0)&(ci(l)|0)!=0){if(A[se>>2]=A[Ne>>2],A[se+4>>2]=A[Ne+4>>2],A[se+8>>2]=A[Ne+8>>2],A[se+12>>2]=A[Ne+12>>2],ra(E,ne),d=A[se>>2]|0,_=A[17040+(d*80|0)+(A[je>>2]<<2)>>2]|0,A[se>>2]=A[18640+(d*80|0)+(_*20|0)>>2],y=A[18640+(d*80|0)+(_*20|0)+16>>2]|0,(y|0)>0){u=0;do M_(M),u=u+1|0;while((u|0)<(y|0))}switch(y=18640+(d*80|0)+(_*20|0)+4|0,A[Re>>2]=A[y>>2],A[Re+4>>2]=A[y+4>>2],A[Re+8>>2]=A[y+8>>2],N_(Re,(A[z>>2]|0)*3|0),vr(M,Re,M),Ar(M),ra(M,$e),$t=+(A[$>>2]|0),D[ke>>3]=$t*3,D[j>>3]=0,ct=$t*-1.5,D[at>>3]=ct,D[J>>3]=$t*2.598076211353316,D[ut>>3]=ct,D[ie>>3]=$t*-2.598076211353316,A[17040+((A[se>>2]|0)*80|0)+(A[Ne>>2]<<2)>>2]|0){case 1:{u=at,d=ke;break}case 3:{u=ut,d=at;break}case 2:{u=ke,d=ut;break}default:{u=12;break e}}K_(ne,$e,d,u,_t),gu(_t,A[se>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1}if((x|0)<(O|0)&&(ra(Ae,se),gu(se,A[Ne>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1),A[je>>2]=A[Ne>>2],A[je+4>>2]=A[Ne+4>>2],A[je+8>>2]=A[Ne+8>>2],A[je+12>>2]=A[Ne+12>>2],x=x+1|0,(x|0)>=(ue|0)){u=3;break}}if((u|0)==3){L=dt;return}else(u|0)==12&&tt(26970,27017,572,27027)}function F_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0;w=L,L=L+128|0,d=w+64|0,m=w,_=d,y=20240,x=_+60|0;do A[_>>2]=A[y>>2],_=_+4|0,y=y+4|0;while((_|0)<(x|0));_=m,y=20304,x=_+60|0;do A[_>>2]=A[y>>2],_=_+4|0,y=y+4|0;while((_|0)<(x|0));x=(ci(A[l>>2]|0)|0)==0,d=x?d:m,m=u+4|0,P_(m),B_(m),ci(A[l>>2]|0)|0&&(ia(m),A[l>>2]=(A[l>>2]|0)+1),A[h>>2]=A[u>>2],l=h+4|0,vr(m,d,l),Ar(l),A[h+16>>2]=A[u>>2],l=h+20|0,vr(m,d+12|0,l),Ar(l),A[h+32>>2]=A[u>>2],l=h+36|0,vr(m,d+24|0,l),Ar(l),A[h+48>>2]=A[u>>2],l=h+52|0,vr(m,d+36|0,l),Ar(l),A[h+64>>2]=A[u>>2],h=h+68|0,vr(m,d+48|0,h),Ar(h),L=w}function Ja(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0;if(j=L,L=L+32|0,z=j+12|0,x=j,$=u+4|0,O=A[16960+(l<<2)>>2]|0,M=(d|0)!=0,O=M?O*3|0:O,m=A[$>>2]|0,E=u+8|0,y=A[E>>2]|0,M){if(_=u+12|0,d=A[_>>2]|0,m=y+m+d|0,(m|0)==(O|0))return $=1,L=j,$|0;w=_}else w=u+12|0,d=A[w>>2]|0,m=y+m+d|0;if((m|0)<=(O|0))return $=0,L=j,$|0;do if((d|0)>0){if(d=A[u>>2]|0,(y|0)>0){_=18640+(d*80|0)+60|0,d=u;break}d=18640+(d*80|0)+40|0,h?(k7(z,O,0,0),cd($,z,x),hc(x),vr(x,z,$),_=d,d=u):(_=d,d=u)}else _=18640+((A[u>>2]|0)*80|0)+20|0,d=u;while(!1);if(A[d>>2]=A[_>>2],m=_+16|0,(A[m>>2]|0)>0){d=0;do M_($),d=d+1|0;while((d|0)<(A[m>>2]|0))}return u=_+4|0,A[z>>2]=A[u>>2],A[z+4>>2]=A[u+4>>2],A[z+8>>2]=A[u+8>>2],l=A[16880+(l<<2)>>2]|0,N_(z,M?l*3|0:l),vr($,z,$),Ar($),M?d=((A[E>>2]|0)+(A[$>>2]|0)+(A[w>>2]|0)|0)==(O|0)?1:2:d=2,$=d,L=j,$|0}function nE(u,l){u=u|0,l=l|0;var h=0;do h=Ja(u,l,0,1)|0;while((h|0)==2);return h|0}function dd(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0,$e=0,ke=0,at=0,ut=0,_t=0,et=0;if(ut=L,L=L+240|0,_=ut+224|0,Re=ut+208|0,$e=ut,ke=ut+192|0,at=ut+176|0,ie=ut+160|0,Ae=ut+144|0,ue=ut+128|0,se=ut+112|0,ne=ut+96|0,A[_>>2]=l,A[Re>>2]=A[u>>2],A[Re+4>>2]=A[u+4>>2],A[Re+8>>2]=A[u+8>>2],A[Re+12>>2]=A[u+12>>2],O_(Re,_,$e),A[m>>2]=0,J=d+h+((d|0)==6&1)|0,(J|0)<=(h|0)){L=ut;return}w=A[_>>2]|0,E=h+6|0,M=16960+(w<<2)|0,O=Ae+8|0,z=ue+8|0,$=se+8|0,j=ke+4|0,y=0,x=h,d=-1;e:for(;;){if(_=(x|0)%6|0,u=$e+(_<<4)|0,A[ke>>2]=A[u>>2],A[ke+4>>2]=A[u+4>>2],A[ke+8>>2]=A[u+8>>2],A[ke+12>>2]=A[u+12>>2],u=y,y=Ja(ke,w,0,1)|0,(x|0)>(h|0)&(ci(l)|0)!=0&&(u|0)!=1&&(A[ke>>2]|0)!=(d|0)){switch(ra($e+(((_+5|0)%6|0)<<4)+4|0,at),ra($e+(_<<4)+4|0,ie),_t=+(A[M>>2]|0),D[Ae>>3]=_t*3,D[O>>3]=0,et=_t*-1.5,D[ue>>3]=et,D[z>>3]=_t*2.598076211353316,D[se>>3]=et,D[$>>3]=_t*-2.598076211353316,_=A[Re>>2]|0,A[17040+(_*80|0)+(((d|0)==(_|0)?A[ke>>2]|0:d)<<2)>>2]|0){case 1:{u=ue,d=Ae;break}case 3:{u=se,d=ue;break}case 2:{u=Ae,d=se;break}default:{u=8;break e}}K_(at,ie,d,u,ne),!(Z_(at,ne)|0)&&!(Z_(ie,ne)|0)&&(gu(ne,A[Re>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1)}if((x|0)<(E|0)&&(ra(j,at),gu(at,A[ke>>2]|0,w,1,m+8+(A[m>>2]<<4)|0),A[m>>2]=(A[m>>2]|0)+1),x=x+1|0,(x|0)>=(J|0)){u=3;break}else d=A[ke>>2]|0}if((u|0)==3){L=ut;return}else(u|0)==8&&tt(27054,27017,737,27099)}function O_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0;w=L,L=L+160|0,d=w+80|0,m=w,_=d,y=20368,x=_+72|0;do A[_>>2]=A[y>>2],_=_+4|0,y=y+4|0;while((_|0)<(x|0));_=m,y=20448,x=_+72|0;do A[_>>2]=A[y>>2],_=_+4|0,y=y+4|0;while((_|0)<(x|0));x=(ci(A[l>>2]|0)|0)==0,d=x?d:m,m=u+4|0,P_(m),B_(m),ci(A[l>>2]|0)|0&&(ia(m),A[l>>2]=(A[l>>2]|0)+1),A[h>>2]=A[u>>2],l=h+4|0,vr(m,d,l),Ar(l),A[h+16>>2]=A[u>>2],l=h+20|0,vr(m,d+12|0,l),Ar(l),A[h+32>>2]=A[u>>2],l=h+36|0,vr(m,d+24|0,l),Ar(l),A[h+48>>2]=A[u>>2],l=h+52|0,vr(m,d+36|0,l),Ar(l),A[h+64>>2]=A[u>>2],l=h+68|0,vr(m,d+48|0,l),Ar(l),A[h+80>>2]=A[u>>2],h=h+84|0,vr(m,d+60|0,h),Ar(h),L=w}function rE(u,l){return u=u|0,l=l|0,l=ge(u|0,l|0,52)|0,k()|0,l&15|0}function I_(u,l){return u=u|0,l=l|0,l=ge(u|0,l|0,45)|0,k()|0,l&127|0}function iE(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,(h+-1|0)>>>0>14?(d=4,d|0):(h=ge(u|0,l|0,(15-h|0)*3|0)|0,k()|0,A[d>>2]=h&7,d=0,d|0)}function sE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0;if(u>>>0>15)return d=4,d|0;if(l>>>0>121)return d=17,d|0;y=Ee(u|0,0,52)|0,m=k()|0,x=Ee(l|0,0,45)|0,m=m|(k()|0)|134225919;e:do if((u|0)>=1){for(x=1,y=(ve[20528+l>>0]|0)!=0,_=-1;;){if(l=A[h+(x+-1<<2)>>2]|0,l>>>0>6){m=18,l=10;break}if(!((l|0)==0|y^1))if((l|0)==1){m=19,l=10;break}else y=0;if(E=(15-x|0)*3|0,w=Ee(7,0,E|0)|0,m=m&~(k()|0),l=Ee(l|0,((l|0)<0)<<31>>31|0,E|0)|0,_=l|_&~w,m=k()|0|m,(x|0)<(u|0))x=x+1|0;else break e}if((l|0)==10)return m|0}else _=-1;while(!1);return E=d,A[E>>2]=_,A[E+4>>2]=m,E=0,E|0}function pd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0;return!(!0&(l&-16777216|0)==134217728)||(d=ge(u|0,l|0,52)|0,k()|0,d=d&15,h=ge(u|0,l|0,45)|0,k()|0,h=h&127,h>>>0>121)?(u=0,u|0):(y=(d^15)*3|0,m=ge(u|0,l|0,y|0)|0,y=Ee(m|0,k()|0,y|0)|0,m=k()|0,_=Hn(-1227133514,-1171,y|0,m|0)|0,!((y&613566756&_|0)==0&(m&4681&(k()|0)|0)==0)||(y=(d*3|0)+19|0,_=Ee(~u|0,~l|0,y|0)|0,y=ge(_|0,k()|0,y|0)|0,!((d|0)==15|(y|0)==0&(k()|0)==0))?(y=0,y|0):!(ve[20528+h>>0]|0)||(l=l&8191,(u|0)==0&(l|0)==0)?(y=1,y|0):(y=Md(u|0,l|0)|0,k()|0,((63-y|0)%3|0|0)!=0|0))}function oE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0;return!0&(l&-16777216|0)==134217728&&(d=ge(u|0,l|0,52)|0,k()|0,d=d&15,h=ge(u|0,l|0,45)|0,k()|0,h=h&127,h>>>0<=121)&&(y=(d^15)*3|0,m=ge(u|0,l|0,y|0)|0,y=Ee(m|0,k()|0,y|0)|0,m=k()|0,_=Hn(-1227133514,-1171,y|0,m|0)|0,(y&613566756&_|0)==0&(m&4681&(k()|0)|0)==0)&&(y=(d*3|0)+19|0,_=Ee(~u|0,~l|0,y|0)|0,y=ge(_|0,k()|0,y|0)|0,(d|0)==15|(y|0)==0&(k()|0)==0)&&(!(ve[20528+h>>0]|0)||(h=l&8191,(u|0)==0&(h|0)==0)||(y=Md(u|0,h|0)|0,k()|0,(63-y|0)%3|0|0))||L_(u,l)|0?(y=1,y|0):(y=(J_(u,l)|0)!=0&1,y|0)}function md(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0;if(m=Ee(l|0,0,52)|0,_=k()|0,h=Ee(h|0,0,45)|0,h=_|(k()|0)|134225919,(l|0)<1){_=-1,d=h,l=u,A[l>>2]=_,u=u+4|0,A[u>>2]=d;return}for(_=1,m=-1;y=(15-_|0)*3|0,x=Ee(7,0,y|0)|0,h=h&~(k()|0),y=Ee(d|0,0,y|0)|0,m=m&~x|y,h=h|(k()|0),(_|0)!=(l|0);)_=_+1|0;x=u,y=x,A[y>>2]=m,x=x+4|0,A[x>>2]=h}function gd(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0;if(_=ge(u|0,l|0,52)|0,k()|0,_=_&15,h>>>0>15)return d=4,d|0;if((_|0)<(h|0))return d=12,d|0;if((_|0)==(h|0))return A[d>>2]=u,A[d+4>>2]=l,d=0,d|0;if(m=Ee(h|0,0,52)|0,m=m|u,u=k()|0|l&-15728641,(_|0)>(h|0))do l=Ee(7,0,(14-h|0)*3|0)|0,h=h+1|0,m=l|m,u=k()|0|u;while((h|0)<(_|0));return A[d>>2]=m,A[d+4>>2]=u,d=0,d|0}function _u(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0;if(_=ge(u|0,l|0,52)|0,k()|0,_=_&15,!((h|0)<16&(_|0)<=(h|0)))return d=4,d|0;m=h-_|0,h=ge(u|0,l|0,45)|0,k()|0;e:do if(!(rn(h&127)|0))h=fo(7,0,m,((m|0)<0)<<31>>31)|0,m=k()|0;else{t:do if(_|0){for(h=1;y=Ee(7,0,(15-h|0)*3|0)|0,!!((y&u|0)==0&((k()|0)&l|0)==0);)if(h>>>0<_>>>0)h=h+1|0;else break t;h=fo(7,0,m,((m|0)<0)<<31>>31)|0,m=k()|0;break e}while(!1);h=fo(7,0,m,((m|0)<0)<<31>>31)|0,h=Wn(h|0,k()|0,5,0)|0,h=He(h|0,k()|0,-5,-1)|0,h=mo(h|0,k()|0,6,0)|0,h=He(h|0,k()|0,1,0)|0,m=k()|0}while(!1);return y=d,A[y>>2]=h,A[y+4>>2]=m,y=0,y|0}function Qt(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;if(m=ge(u|0,l|0,45)|0,k()|0,!(rn(m&127)|0))return m=0,m|0;m=ge(u|0,l|0,52)|0,k()|0,m=m&15;e:do if(!m)h=0;else for(d=1;;){if(h=ge(u|0,l|0,(15-d|0)*3|0)|0,k()|0,h=h&7,h|0)break e;if(d>>>0<m>>>0)d=d+1|0;else{h=0;break}}while(!1);return m=(h|0)==0&1,m|0}function aE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0;if(y=L,L=L+16|0,_=y,Td(_,u,l,h),l=_,u=A[l>>2]|0,l=A[l+4>>2]|0,(u|0)==0&(l|0)==0)return L=y,0;m=0,h=0;do x=d+(m<<3)|0,A[x>>2]=u,A[x+4>>2]=l,m=He(m|0,h|0,1,0)|0,h=k()|0,wd(_),x=_,u=A[x>>2]|0,l=A[x+4>>2]|0;while(!((u|0)==0&(l|0)==0));return L=y,0}function k_(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,(d|0)<(h|0)?(h=l,d=u,lt(h|0),d|0):(h=Ee(-1,-1,((d-h|0)*3|0)+3|0)|0,d=Ee(~h|0,~(k()|0)|0,(15-d|0)*3|0)|0,h=~(k()|0)&l,d=~d&u,lt(h|0),d|0)}function U_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0;return m=ge(u|0,l|0,52)|0,k()|0,m=m&15,(h|0)<16&(m|0)<=(h|0)?((m|0)<(h|0)&&(m=Ee(-1,-1,((h+-1-m|0)*3|0)+3|0)|0,m=Ee(~m|0,~(k()|0)|0,(15-h|0)*3|0)|0,l=~(k()|0)&l,u=~m&u),m=Ee(h|0,0,52)|0,h=l&-15728641|(k()|0),A[d>>2]=u|m,A[d+4>>2]=h,d=0,d|0):(d=4,d|0)}function lE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0,$e=0,ke=0,at=0,ut=0,_t=0,et=0,je=0,Ne=0;if((h|0)==0&(d|0)==0)return Ne=0,Ne|0;if(m=u,_=A[m>>2]|0,m=A[m+4>>2]|0,!0&(m&15728640|0)==0){if(!((d|0)>0|(d|0)==0&h>>>0>0)||(Ne=l,A[Ne>>2]=_,A[Ne+4>>2]=m,(h|0)==1&(d|0)==0))return Ne=0,Ne|0;m=1,_=0;do et=u+(m<<3)|0,je=A[et+4>>2]|0,Ne=l+(m<<3)|0,A[Ne>>2]=A[et>>2],A[Ne+4>>2]=je,m=He(m|0,_|0,1,0)|0,_=k()|0;while((_|0)<(d|0)|(_|0)==(d|0)&m>>>0<h>>>0);return m=0,m|0}if(_t=h<<3,je=Ji(_t)|0,!je)return Ne=13,Ne|0;if(sl(je|0,u|0,_t|0)|0,et=Dr(h,8)|0,!et)return We(je),Ne=13,Ne|0;e:for(;;){m=je,E=A[m>>2]|0,m=A[m+4>>2]|0,at=ge(E|0,m|0,52)|0,k()|0,at=at&15,ut=at+-1|0,ke=(at|0)!=0,$e=(d|0)>0|(d|0)==0&h>>>0>0;t:do if(ke&$e){if(ue=Ee(ut|0,0,52)|0,se=k()|0,ut>>>0>15){if(!((E|0)==0&(m|0)==0)){Ne=16;break e}for(_=0,u=0;;){if(_=He(_|0,u|0,1,0)|0,u=k()|0,!((u|0)<(d|0)|(u|0)==(d|0)&_>>>0<h>>>0))break t;if(y=je+(_<<3)|0,Re=A[y>>2]|0,y=A[y+4>>2]|0,!((Re|0)==0&(y|0)==0)){m=y,Ne=16;break e}}}for(x=E,u=m,_=0,y=0;;){if(!((x|0)==0&(u|0)==0)){if(!(!0&(u&117440512|0)==0)){Ne=21;break e}if(M=ge(x|0,u|0,52)|0,k()|0,M=M&15,(M|0)<(ut|0)){m=12,Ne=27;break e}if((M|0)!=(ut|0)&&(x=x|ue,u=u&-15728641|se,M>>>0>=at>>>0)){w=ut;do Re=Ee(7,0,(14-w|0)*3|0)|0,w=w+1|0,x=Re|x,u=k()|0|u;while(w>>>0<M>>>0)}if(z=il(x|0,u|0,h|0,d|0)|0,$=k()|0,w=et+(z<<3)|0,M=w,O=A[M>>2]|0,M=A[M+4>>2]|0,!((O|0)==0&(M|0)==0)){ie=0,Ae=0;do{if((ie|0)>(d|0)|(ie|0)==(d|0)&Ae>>>0>h>>>0){Ne=31;break e}if((O|0)==(x|0)&(M&-117440513|0)==(u|0)){j=ge(O|0,M|0,56)|0,k()|0,j=j&7,J=j+1|0,Re=ge(O|0,M|0,45)|0,k()|0;n:do if(!(rn(Re&127)|0))M=7;else{if(O=ge(O|0,M|0,52)|0,k()|0,O=O&15,!O){M=6;break}for(M=1;;){if(Re=Ee(7,0,(15-M|0)*3|0)|0,!((Re&x|0)==0&((k()|0)&u|0)==0)){M=7;break n}if(M>>>0<O>>>0)M=M+1|0;else{M=6;break}}}while(!1);if((j+2|0)>>>0>M>>>0){Ne=41;break e}Re=Ee(J|0,0,56)|0,u=k()|0|u&-117440513,ne=w,A[ne>>2]=0,A[ne+4>>2]=0,x=Re|x}else z=He(z|0,$|0,1,0)|0,z=rl(z|0,k()|0,h|0,d|0)|0,$=k()|0;Ae=He(Ae|0,ie|0,1,0)|0,ie=k()|0,w=et+(z<<3)|0,M=w,O=A[M>>2]|0,M=A[M+4>>2]|0}while(!((O|0)==0&(M|0)==0))}Re=w,A[Re>>2]=x,A[Re+4>>2]=u}if(_=He(_|0,y|0,1,0)|0,y=k()|0,!((y|0)<(d|0)|(y|0)==(d|0)&_>>>0<h>>>0))break t;u=je+(_<<3)|0,x=A[u>>2]|0,u=A[u+4>>2]|0}}while(!1);if(Re=He(h|0,d|0,5,0)|0,ne=k()|0,ne>>>0<0|(ne|0)==0&Re>>>0<11){Ne=85;break}if(Re=mo(h|0,d|0,6,0)|0,k()|0,Re=Dr(Re,8)|0,!Re){Ne=48;break}do if($e){for(J=0,u=0,j=0,ie=0;;){if(M=et+(J<<3)|0,y=M,_=A[y>>2]|0,y=A[y+4>>2]|0,(_|0)==0&(y|0)==0)ne=j;else{O=ge(_|0,y|0,56)|0,k()|0,O=O&7,x=O+1|0,z=y&-117440513,ne=ge(_|0,y|0,45)|0,k()|0;t:do if(rn(ne&127)|0){if($=ge(_|0,y|0,52)|0,k()|0,$=$&15,$|0)for(w=1;;){if(ne=Ee(7,0,(15-w|0)*3|0)|0,!((_&ne|0)==0&(z&(k()|0)|0)==0))break t;if(w>>>0<$>>>0)w=w+1|0;else break}y=Ee(x|0,0,56)|0,_=y|_,y=k()|0|z,x=M,A[x>>2]=_,A[x+4>>2]=y,x=O+2|0}while(!1);(x|0)==7?(ne=Re+(u<<3)|0,A[ne>>2]=_,A[ne+4>>2]=y&-117440513,u=He(u|0,j|0,1,0)|0,ne=k()|0):ne=j}if(J=He(J|0,ie|0,1,0)|0,ie=k()|0,(ie|0)<(d|0)|(ie|0)==(d|0)&J>>>0<h>>>0)j=ne;else break}if($e){if(Ae=ut>>>0>15,ue=Ee(ut|0,0,52)|0,se=k()|0,!ke){for(_=0,w=0,x=0,y=0;(E|0)==0&(m|0)==0||(ut=l+(_<<3)|0,A[ut>>2]=E,A[ut+4>>2]=m,_=He(_|0,w|0,1,0)|0,w=k()|0),x=He(x|0,y|0,1,0)|0,y=k()|0,!!((y|0)<(d|0)|(y|0)==(d|0)&x>>>0<h>>>0);)m=je+(x<<3)|0,E=A[m>>2]|0,m=A[m+4>>2]|0;m=ne;break}for(_=0,w=0,y=0,x=0;;){do if(!((E|0)==0&(m|0)==0)){if($=ge(E|0,m|0,52)|0,k()|0,$=$&15,Ae|($|0)<(ut|0)){Ne=80;break e}if(($|0)!=(ut|0)){if(M=E|ue,O=m&-15728641|se,$>>>0>=at>>>0){z=ut;do ke=Ee(7,0,(14-z|0)*3|0)|0,z=z+1|0,M=ke|M,O=k()|0|O;while(z>>>0<$>>>0)}}else M=E,O=m;j=il(M|0,O|0,h|0,d|0)|0,z=0,$=0,ie=k()|0;do{if((z|0)>(d|0)|(z|0)==(d|0)&$>>>0>h>>>0){Ne=81;break e}if(ke=et+(j<<3)|0,J=A[ke+4>>2]|0,(J&-117440513|0)==(O|0)&&(A[ke>>2]|0)==(M|0)){Ne=65;break}ke=He(j|0,ie|0,1,0)|0,j=rl(ke|0,k()|0,h|0,d|0)|0,ie=k()|0,$=He($|0,z|0,1,0)|0,z=k()|0,ke=et+(j<<3)|0}while(!((A[ke>>2]|0)==(M|0)&&(A[ke+4>>2]|0)==(O|0)));if((Ne|0)==65&&(Ne=0,!0&(J&117440512|0)==100663296))break;ke=l+(_<<3)|0,A[ke>>2]=E,A[ke+4>>2]=m,_=He(_|0,w|0,1,0)|0,w=k()|0}while(!1);if(y=He(y|0,x|0,1,0)|0,x=k()|0,!((x|0)<(d|0)|(x|0)==(d|0)&y>>>0<h>>>0))break;m=je+(y<<3)|0,E=A[m>>2]|0,m=A[m+4>>2]|0}m=ne}else _=0,m=ne}else _=0,u=0,m=0;while(!1);if(go(et|0,0,_t|0)|0,sl(je|0,Re|0,u<<3|0)|0,We(Re),(u|0)==0&(m|0)==0){Ne=89;break}else l=l+(_<<3)|0,d=m,h=u}if((Ne|0)==16)!0&(m&117440512|0)==0?(m=4,Ne=27):Ne=21;else if((Ne|0)==31)tt(27795,27122,620,27132);else{if((Ne|0)==41)return We(je),We(et),Ne=10,Ne|0;if((Ne|0)==48)return We(je),We(et),Ne=13,Ne|0;(Ne|0)==80?tt(27795,27122,711,27132):(Ne|0)==81?tt(27795,27122,723,27132):(Ne|0)==85&&(sl(l|0,je|0,h<<3|0)|0,Ne=89)}return(Ne|0)==21?(We(je),We(et),Ne=5,Ne|0):(Ne|0)==27?(We(je),We(et),Ne=m,Ne|0):(Ne|0)==89?(We(je),We(et),Ne=0,Ne|0):0}function uE(u,l,h,d,m,_,y){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,_=_|0,y=y|0;var x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0;if(J=L,L=L+16|0,j=J,!((h|0)>0|(h|0)==0&l>>>0>0))return j=0,L=J,j|0;if((y|0)>=16)return j=12,L=J,j|0;z=0,$=0,O=0,x=0;e:for(;;){if(E=u+(z<<3)|0,w=A[E>>2]|0,E=A[E+4>>2]|0,M=ge(w|0,E|0,52)|0,k()|0,(M&15|0)>(y|0)){x=12,w=11;break}if(Td(j,w,E,y),M=j,E=A[M>>2]|0,M=A[M+4>>2]|0,(E|0)==0&(M|0)==0)w=O;else{w=O;do{if(!((x|0)<(_|0)|(x|0)==(_|0)&w>>>0<m>>>0)){w=10;break e}O=d+(w<<3)|0,A[O>>2]=E,A[O+4>>2]=M,w=He(w|0,x|0,1,0)|0,x=k()|0,wd(j),O=j,E=A[O>>2]|0,M=A[O+4>>2]|0}while(!((E|0)==0&(M|0)==0))}if(z=He(z|0,$|0,1,0)|0,$=k()|0,($|0)<(h|0)|($|0)==(h|0)&z>>>0<l>>>0)O=w;else{x=0,w=11;break}}return(w|0)==10?(j=14,L=J,j|0):(w|0)==11?(L=J,x|0):0}function AE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0;z=L,L=L+16|0,O=z;e:do if((h|0)>0|(h|0)==0&l>>>0>0){for(E=0,y=0,_=0,M=0;;){if(w=u+(E<<3)|0,x=A[w>>2]|0,w=A[w+4>>2]|0,!((x|0)==0&(w|0)==0)&&(w=(_u(x,w,d,O)|0)==0,x=O,y=He(A[x>>2]|0,A[x+4>>2]|0,y|0,_|0)|0,_=k()|0,!w)){_=12;break}if(E=He(E|0,M|0,1,0)|0,M=k()|0,!((M|0)<(h|0)|(M|0)==(h|0)&E>>>0<l>>>0))break e}return L=z,_|0}else y=0,_=0;while(!1);return A[m>>2]=y,A[m+4>>2]=_,m=0,L=z,m|0}function cE(u,l){return u=u|0,l=l|0,l=ge(u|0,l|0,52)|0,k()|0,l&1|0}function Br(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;if(m=ge(u|0,l|0,52)|0,k()|0,m=m&15,!m)return m=0,m|0;for(d=1;;){if(h=ge(u|0,l|0,(15-d|0)*3|0)|0,k()|0,h=h&7,h|0){d=5;break}if(d>>>0<m>>>0)d=d+1|0;else{h=0,d=5;break}}return(d|0)==5?h|0:0}function _d(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0;if(w=ge(u|0,l|0,52)|0,k()|0,w=w&15,!w)return x=l,w=u,lt(x|0),w|0;for(x=1,h=0;;){_=(15-x|0)*3|0,d=Ee(7,0,_|0)|0,m=k()|0,y=ge(u|0,l|0,_|0)|0,k()|0,_=Ee(sa(y&7)|0,0,_|0)|0,y=k()|0,u=_|u&~d,l=y|l&~m;e:do if(!h)if((_&d|0)==0&(y&m|0)==0)h=0;else if(d=ge(u|0,l|0,52)|0,k()|0,d=d&15,!d)h=1;else{h=1;t:for(;;){switch(y=ge(u|0,l|0,(15-h|0)*3|0)|0,k()|0,y&7){case 1:break t;case 0:break;default:{h=1;break e}}if(h>>>0<d>>>0)h=h+1|0;else{h=1;break e}}for(h=1;;)if(y=(15-h|0)*3|0,m=ge(u|0,l|0,y|0)|0,k()|0,_=Ee(7,0,y|0)|0,l=l&~(k()|0),y=Ee(sa(m&7)|0,0,y|0)|0,u=u&~_|y,l=l|(k()|0),h>>>0<d>>>0)h=h+1|0;else{h=1;break}}while(!1);if(x>>>0<w>>>0)x=x+1|0;else break}return lt(l|0),u|0}function oa(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0;if(d=ge(u|0,l|0,52)|0,k()|0,d=d&15,!d)return h=l,d=u,lt(h|0),d|0;for(h=1;_=(15-h|0)*3|0,y=ge(u|0,l|0,_|0)|0,k()|0,m=Ee(7,0,_|0)|0,l=l&~(k()|0),_=Ee(sa(y&7)|0,0,_|0)|0,u=_|u&~m,l=k()|0|l,h>>>0<d>>>0;)h=h+1|0;return lt(l|0),u|0}function hE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0;if(w=ge(u|0,l|0,52)|0,k()|0,w=w&15,!w)return x=l,w=u,lt(x|0),w|0;for(x=1,h=0;;){_=(15-x|0)*3|0,d=Ee(7,0,_|0)|0,m=k()|0,y=ge(u|0,l|0,_|0)|0,k()|0,_=Ee(ho(y&7)|0,0,_|0)|0,y=k()|0,u=_|u&~d,l=y|l&~m;e:do if(!h)if((_&d|0)==0&(y&m|0)==0)h=0;else if(d=ge(u|0,l|0,52)|0,k()|0,d=d&15,!d)h=1;else{h=1;t:for(;;){switch(y=ge(u|0,l|0,(15-h|0)*3|0)|0,k()|0,y&7){case 1:break t;case 0:break;default:{h=1;break e}}if(h>>>0<d>>>0)h=h+1|0;else{h=1;break e}}for(h=1;;)if(m=(15-h|0)*3|0,_=Ee(7,0,m|0)|0,y=l&~(k()|0),l=ge(u|0,l|0,m|0)|0,k()|0,l=Ee(ho(l&7)|0,0,m|0)|0,u=u&~_|l,l=y|(k()|0),h>>>0<d>>>0)h=h+1|0;else{h=1;break}}while(!1);if(x>>>0<w>>>0)x=x+1|0;else break}return lt(l|0),u|0}function yd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0;if(d=ge(u|0,l|0,52)|0,k()|0,d=d&15,!d)return h=l,d=u,lt(h|0),d|0;for(h=1;y=(15-h|0)*3|0,_=Ee(7,0,y|0)|0,m=l&~(k()|0),l=ge(u|0,l|0,y|0)|0,k()|0,l=Ee(ho(l&7)|0,0,y|0)|0,u=l|u&~_,l=k()|0|m,h>>>0<d>>>0;)h=h+1|0;return lt(l|0),u|0}function fE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;if(w=L,L=L+64|0,x=w+40|0,d=w+24|0,m=w+12|0,_=w,Ee(l|0,0,52)|0,h=k()|0|134225919,!l)return(A[u+4>>2]|0)>2||(A[u+8>>2]|0)>2||(A[u+12>>2]|0)>2?(y=0,x=0,lt(y|0),L=w,x|0):(Ee(x_(u)|0,0,45)|0,y=k()|0|h,x=-1,lt(y|0),L=w,x|0);if(A[x>>2]=A[u>>2],A[x+4>>2]=A[u+4>>2],A[x+8>>2]=A[u+8>>2],A[x+12>>2]=A[u+12>>2],y=x+4|0,(l|0)>0)for(u=-1;A[d>>2]=A[y>>2],A[d+4>>2]=A[y+4>>2],A[d+8>>2]=A[y+8>>2],l&1?(V7(y),A[m>>2]=A[y>>2],A[m+4>>2]=A[y+4>>2],A[m+8>>2]=A[y+8>>2],cc(m)):(R_(y),A[m>>2]=A[y>>2],A[m+4>>2]=A[y+4>>2],A[m+8>>2]=A[y+8>>2],ia(m)),cd(d,m,_),Ar(_),M=(15-l|0)*3|0,E=Ee(7,0,M|0)|0,h=h&~(k()|0),M=Ee(Ac(_)|0,0,M|0)|0,u=M|u&~E,h=k()|0|h,(l|0)>1;)l=l+-1|0;else u=-1;e:do if((A[y>>2]|0)<=2&&(A[x+8>>2]|0)<=2&&(A[x+12>>2]|0)<=2){if(d=x_(x)|0,l=Ee(d|0,0,45)|0,l=l|u,u=k()|0|h&-1040385,_=R7(x)|0,!(rn(d)|0)){if((_|0)<=0)break;for(m=0;;){if(d=ge(l|0,u|0,52)|0,k()|0,d=d&15,d)for(h=1;M=(15-h|0)*3|0,x=ge(l|0,u|0,M|0)|0,k()|0,E=Ee(7,0,M|0)|0,u=u&~(k()|0),M=Ee(sa(x&7)|0,0,M|0)|0,l=l&~E|M,u=u|(k()|0),h>>>0<d>>>0;)h=h+1|0;if(m=m+1|0,(m|0)==(_|0))break e}}m=ge(l|0,u|0,52)|0,k()|0,m=m&15;t:do if(m){h=1;n:for(;;){switch(M=ge(l|0,u|0,(15-h|0)*3|0)|0,k()|0,M&7){case 1:break n;case 0:break;default:break t}if(h>>>0<m>>>0)h=h+1|0;else break t}if(b_(d,A[x>>2]|0)|0)for(h=1;x=(15-h|0)*3|0,E=Ee(7,0,x|0)|0,M=u&~(k()|0),u=ge(l|0,u|0,x|0)|0,k()|0,u=Ee(ho(u&7)|0,0,x|0)|0,l=l&~E|u,u=M|(k()|0),h>>>0<m>>>0;)h=h+1|0;else for(h=1;M=(15-h|0)*3|0,x=ge(l|0,u|0,M|0)|0,k()|0,E=Ee(7,0,M|0)|0,u=u&~(k()|0),M=Ee(sa(x&7)|0,0,M|0)|0,l=l&~E|M,u=u|(k()|0),h>>>0<m>>>0;)h=h+1|0}while(!1);if((_|0)>0){h=0;do l=_d(l,u)|0,u=k()|0,h=h+1|0;while((h|0)!=(_|0))}}else l=0,u=0;while(!1);return E=u,M=l,lt(E|0),L=w,M|0}function ci(u){return u=u|0,(u|0)%2|0|0}function vd(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;return m=L,L=L+16|0,d=m,l>>>0>15?(d=4,L=m,d|0):(A[u+4>>2]&2146435072|0)==2146435072||(A[u+8+4>>2]&2146435072|0)==2146435072?(d=3,L=m,d|0):(Z7(u,l,d),l=fE(d,l)|0,d=k()|0,A[h>>2]=l,A[h+4>>2]=d,(l|0)==0&(d|0)==0&&tt(27795,27122,1050,27145),d=0,L=m,d|0)}function xd(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0;if(m=h+4|0,_=ge(u|0,l|0,52)|0,k()|0,_=_&15,y=ge(u|0,l|0,45)|0,k()|0,d=(_|0)==0,rn(y&127)|0){if(d)return y=1,y|0;d=1}else{if(d)return y=0,y|0;(A[m>>2]|0)==0&&(A[h+8>>2]|0)==0?d=(A[h+12>>2]|0)!=0&1:d=1}for(h=1;h&1?cc(m):ia(m),y=ge(u|0,l|0,(15-h|0)*3|0)|0,k()|0,C_(m,y&7),h>>>0<_>>>0;)h=h+1|0;return d|0}function el(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;if(M=L,L=L+16|0,w=M,E=ge(u|0,l|0,45)|0,k()|0,E=E&127,E>>>0>121)return A[h>>2]=0,A[h+4>>2]=0,A[h+8>>2]=0,A[h+12>>2]=0,E=5,L=M,E|0;e:do if((rn(E)|0)!=0&&(_=ge(u|0,l|0,52)|0,k()|0,_=_&15,(_|0)!=0)){d=1;t:for(;;){switch(x=ge(u|0,l|0,(15-d|0)*3|0)|0,k()|0,x&7){case 5:break t;case 0:break;default:{d=l;break e}}if(d>>>0<_>>>0)d=d+1|0;else{d=l;break e}}for(m=1,d=l;l=(15-m|0)*3|0,y=Ee(7,0,l|0)|0,x=d&~(k()|0),d=ge(u|0,d|0,l|0)|0,k()|0,d=Ee(ho(d&7)|0,0,l|0)|0,u=u&~y|d,d=x|(k()|0),m>>>0<_>>>0;)m=m+1|0}else d=l;while(!1);if(x=7696+(E*28|0)|0,A[h>>2]=A[x>>2],A[h+4>>2]=A[x+4>>2],A[h+8>>2]=A[x+8>>2],A[h+12>>2]=A[x+12>>2],!(xd(u,d,h)|0))return E=0,L=M,E|0;if(y=h+4|0,A[w>>2]=A[y>>2],A[w+4>>2]=A[y+4>>2],A[w+8>>2]=A[y+8>>2],_=ge(u|0,d|0,52)|0,k()|0,x=_&15,_&1?(ia(y),_=x+1|0):_=x,!(rn(E)|0))d=0;else{e:do if(!x)d=0;else for(l=1;;){if(m=ge(u|0,d|0,(15-l|0)*3|0)|0,k()|0,m=m&7,m|0){d=m;break e}if(l>>>0<x>>>0)l=l+1|0;else{d=0;break}}while(!1);d=(d|0)==4&1}if(!(Ja(h,_,d,0)|0))(_|0)!=(x|0)&&(A[y>>2]=A[w>>2],A[y+4>>2]=A[w+4>>2],A[y+8>>2]=A[w+8>>2]);else{if(rn(E)|0)do;while((Ja(h,_,0,0)|0)!=0);(_|0)!=(x|0)&&R_(y)}return E=0,L=M,E|0}function aa(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0;return _=L,L=L+16|0,d=_,m=el(u,l,d)|0,m|0?(L=_,m|0):(m=ge(u|0,l|0,52)|0,k()|0,tE(d,m&15,h),m=0,L=_,m|0)}function tl(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0;if(y=L,L=L+16|0,_=y,d=el(u,l,_)|0,d|0)return _=d,L=y,_|0;d=ge(u|0,l|0,45)|0,k()|0,d=(rn(d&127)|0)==0,m=ge(u|0,l|0,52)|0,k()|0,m=m&15;e:do if(!d){if(m|0)for(d=1;;){if(x=Ee(7,0,(15-d|0)*3|0)|0,!((x&u|0)==0&((k()|0)&l|0)==0))break e;if(d>>>0<m>>>0)d=d+1|0;else break}return fd(_,m,0,5,h),x=0,L=y,x|0}while(!1);return dd(_,m,0,6,h),x=0,L=y,x|0}function dE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0;if(m=ge(u|0,l|0,45)|0,k()|0,!(rn(m&127)|0))return m=2,A[h>>2]=m,0;if(m=ge(u|0,l|0,52)|0,k()|0,m=m&15,!m)return m=5,A[h>>2]=m,0;for(d=1;;){if(_=Ee(7,0,(15-d|0)*3|0)|0,!((_&u|0)==0&((k()|0)&l|0)==0)){d=2,u=6;break}if(d>>>0<m>>>0)d=d+1|0;else{d=5,u=6;break}}return(u|0)==6&&(A[h>>2]=d),0}function q_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0;O=L,L=L+128|0,E=O+112|0,_=O+96|0,M=O,m=ge(u|0,l|0,52)|0,k()|0,x=m&15,A[E>>2]=x,y=ge(u|0,l|0,45)|0,k()|0,y=y&127;e:do if(rn(y)|0){if(x|0)for(d=1;;){if(w=Ee(7,0,(15-d|0)*3|0)|0,!((w&u|0)==0&((k()|0)&l|0)==0)){m=0;break e}if(d>>>0<x>>>0)d=d+1|0;else break}if(m&1)m=1;else return w=Ee(x+1|0,0,52)|0,M=k()|0|l&-15728641,E=Ee(7,0,(14-x|0)*3|0)|0,M=q_((w|u)&~E,M&~(k()|0),h)|0,L=O,M|0}else m=0;while(!1);if(d=el(u,l,_)|0,!d){m?(F_(_,E,M),w=5):(O_(_,E,M),w=6);e:do if(rn(y)|0)if(!x)u=5;else for(d=1;;){if(y=Ee(7,0,(15-d|0)*3|0)|0,!((y&u|0)==0&((k()|0)&l|0)==0)){u=2;break e}if(d>>>0<x>>>0)d=d+1|0;else{u=5;break}}else u=2;while(!1);go(h|0,-1,u<<2|0)|0;e:do if(m)for(_=0;;){if(y=M+(_<<4)|0,nE(y,A[E>>2]|0)|0,y=A[y>>2]|0,x=A[h>>2]|0,(x|0)==-1|(x|0)==(y|0))d=h;else{m=0;do{if(m=m+1|0,m>>>0>=u>>>0){d=1;break e}d=h+(m<<2)|0,x=A[d>>2]|0}while(!((x|0)==-1|(x|0)==(y|0)))}if(A[d>>2]=y,_=_+1|0,_>>>0>=w>>>0){d=0;break}}else for(_=0;;){if(y=M+(_<<4)|0,Ja(y,A[E>>2]|0,0,1)|0,y=A[y>>2]|0,x=A[h>>2]|0,(x|0)==-1|(x|0)==(y|0))d=h;else{m=0;do{if(m=m+1|0,m>>>0>=u>>>0){d=1;break e}d=h+(m<<2)|0,x=A[d>>2]|0}while(!((x|0)==-1|(x|0)==(y|0)))}if(A[d>>2]=y,_=_+1|0,_>>>0>=w>>>0){d=0;break}}while(!1)}return M=d,L=O,M|0}function pE(){return 12}function bd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0;if(u>>>0>15)return x=4,x|0;if(Ee(u|0,0,52)|0,x=k()|0|134225919,!u){h=0,d=0;do rn(d)|0&&(Ee(d|0,0,45)|0,y=x|(k()|0),u=l+(h<<3)|0,A[u>>2]=-1,A[u+4>>2]=y,h=h+1|0),d=d+1|0;while((d|0)!=122);return h=0,h|0}h=0,y=0;do{if(rn(y)|0){for(Ee(y|0,0,45)|0,d=1,m=-1,_=x|(k()|0);w=Ee(7,0,(15-d|0)*3|0)|0,m=m&~w,_=_&~(k()|0),(d|0)!=(u|0);)d=d+1|0;w=l+(h<<3)|0,A[w>>2]=m,A[w+4>>2]=_,h=h+1|0}y=y+1|0}while((y|0)!=122);return h=0,h|0}function mE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0;if(ue=L,L=L+16|0,ie=ue,Ae=ge(u|0,l|0,52)|0,k()|0,Ae=Ae&15,h>>>0>15)return Ae=4,L=ue,Ae|0;if((Ae|0)<(h|0))return Ae=12,L=ue,Ae|0;if((Ae|0)!=(h|0))if(_=Ee(h|0,0,52)|0,_=_|u,x=k()|0|l&-15728641,(Ae|0)>(h|0)){w=h;do J=Ee(7,0,(14-w|0)*3|0)|0,w=w+1|0,_=J|_,x=k()|0|x;while((w|0)<(Ae|0));J=_}else J=_;else J=u,x=l;j=ge(J|0,x|0,45)|0,k()|0;e:do if(rn(j&127)|0){if(w=ge(J|0,x|0,52)|0,k()|0,w=w&15,w|0)for(_=1;;){if(j=Ee(7,0,(15-_|0)*3|0)|0,!((j&J|0)==0&((k()|0)&x|0)==0)){E=33;break e}if(_>>>0<w>>>0)_=_+1|0;else break}if(j=d,A[j>>2]=0,A[j+4>>2]=0,(Ae|0)>(h|0)){for(j=l&-15728641,$=Ae;;){if(z=$,$=$+-1|0,$>>>0>15|(Ae|0)<($|0)){E=19;break}if((Ae|0)!=($|0))if(_=Ee($|0,0,52)|0,_=_|u,w=k()|0|j,(Ae|0)<(z|0))O=_;else{E=$;do O=Ee(7,0,(14-E|0)*3|0)|0,E=E+1|0,_=O|_,w=k()|0|w;while((E|0)<(Ae|0));O=_}else O=u,w=l;if(M=ge(O|0,w|0,45)|0,k()|0,!(rn(M&127)|0))_=0;else{M=ge(O|0,w|0,52)|0,k()|0,M=M&15;t:do if(!M)_=0;else for(E=1;;){if(_=ge(O|0,w|0,(15-E|0)*3|0)|0,k()|0,_=_&7,_|0)break t;if(E>>>0<M>>>0)E=E+1|0;else{_=0;break}}while(!1);_=(_|0)==0&1}if(w=ge(u|0,l|0,(15-z|0)*3|0)|0,k()|0,w=w&7,(w|0)==7){m=5,E=42;break}if(_=(_|0)!=0,(w|0)==1&_){m=5,E=42;break}if(O=w+(((w|0)!=0&_)<<31>>31)|0,O|0&&(E=Ae-z|0,E=fo(7,0,E,((E|0)<0)<<31>>31)|0,M=k()|0,_?(_=Wn(E|0,M|0,5,0)|0,_=He(_|0,k()|0,-5,-1)|0,_=mo(_|0,k()|0,6,0)|0,_=He(_|0,k()|0,1,0)|0,w=k()|0):(_=E,w=M),z=O+-1|0,z=Wn(E|0,M|0,z|0,((z|0)<0)<<31>>31|0)|0,z=He(_|0,w|0,z|0,k()|0)|0,O=k()|0,M=d,M=He(z|0,O|0,A[M>>2]|0,A[M+4>>2]|0)|0,O=k()|0,z=d,A[z>>2]=M,A[z+4>>2]=O),($|0)<=(h|0)){E=37;break}}if((E|0)==19)tt(27795,27122,1367,27158);else if((E|0)==37){y=d,m=A[y+4>>2]|0,y=A[y>>2]|0;break}else if((E|0)==42)return L=ue,m|0}else m=0,y=0}else E=33;while(!1);e:do if((E|0)==33)if(j=d,A[j>>2]=0,A[j+4>>2]=0,(Ae|0)>(h|0)){for(_=Ae;;){if(m=ge(u|0,l|0,(15-_|0)*3|0)|0,k()|0,m=m&7,(m|0)==7){m=5;break}if(y=Ae-_|0,y=fo(7,0,y,((y|0)<0)<<31>>31)|0,m=Wn(y|0,k()|0,m|0,0)|0,y=k()|0,j=d,y=He(A[j>>2]|0,A[j+4>>2]|0,m|0,y|0)|0,m=k()|0,j=d,A[j>>2]=y,A[j+4>>2]=m,_=_+-1|0,(_|0)<=(h|0))break e}return L=ue,m|0}else m=0,y=0;while(!1);return _u(J,x,Ae,ie)|0&&tt(27795,27122,1327,27173),Ae=ie,ie=A[Ae+4>>2]|0,((m|0)>-1|(m|0)==-1&y>>>0>4294967295)&((ie|0)>(m|0)|((ie|0)==(m|0)?(A[Ae>>2]|0)>>>0>y>>>0:0))?(Ae=0,L=ue,Ae|0):(tt(27795,27122,1407,27158),0)}function gE(u,l,h,d,m,_){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,_=_|0;var y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0;if(O=L,L=L+16|0,y=O,m>>>0>15)return _=4,L=O,_|0;if(x=ge(h|0,d|0,52)|0,k()|0,x=x&15,(x|0)>(m|0))return _=12,L=O,_|0;if(_u(h,d,m,y)|0&&tt(27795,27122,1327,27173),M=y,E=A[M+4>>2]|0,!(((l|0)>-1|(l|0)==-1&u>>>0>4294967295)&((E|0)>(l|0)|((E|0)==(l|0)?(A[M>>2]|0)>>>0>u>>>0:0))))return _=2,L=O,_|0;M=m-x|0,m=Ee(m|0,0,52)|0,w=k()|0|d&-15728641,E=_,A[E>>2]=m|h,A[E+4>>2]=w,E=ge(h|0,d|0,45)|0,k()|0;e:do if(rn(E&127)|0){if(x|0)for(y=1;;){if(E=Ee(7,0,(15-y|0)*3|0)|0,!((E&h|0)==0&((k()|0)&d|0)==0))break e;if(y>>>0<x>>>0)y=y+1|0;else break}if((M|0)<1)return _=0,L=O,_|0;for(E=x^15,d=-1,w=1,y=1;;){x=M-w|0,x=fo(7,0,x,((x|0)<0)<<31>>31)|0,h=k()|0;do if(y)if(y=Wn(x|0,h|0,5,0)|0,y=He(y|0,k()|0,-5,-1)|0,y=mo(y|0,k()|0,6,0)|0,m=k()|0,(l|0)>(m|0)|(l|0)==(m|0)&u>>>0>y>>>0){l=He(u|0,l|0,-1,-1)|0,l=Hn(l|0,k()|0,y|0,m|0)|0,y=k()|0,z=_,j=A[z>>2]|0,z=A[z+4>>2]|0,J=(E+d|0)*3|0,$=Ee(7,0,J|0)|0,z=z&~(k()|0),d=mo(l|0,y|0,x|0,h|0)|0,u=k()|0,m=He(d|0,u|0,2,0)|0,J=Ee(m|0,k()|0,J|0)|0,z=k()|0|z,m=_,A[m>>2]=J|j&~$,A[m+4>>2]=z,u=Wn(d|0,u|0,x|0,h|0)|0,u=Hn(l|0,y|0,u|0,k()|0)|0,y=0,l=k()|0;break}else{J=_,$=A[J>>2]|0,J=A[J+4>>2]|0,j=Ee(7,0,(E+d|0)*3|0)|0,J=J&~(k()|0),y=_,A[y>>2]=$&~j,A[y+4>>2]=J,y=1;break}else $=_,m=A[$>>2]|0,$=A[$+4>>2]|0,d=(E+d|0)*3|0,z=Ee(7,0,d|0)|0,$=$&~(k()|0),J=mo(u|0,l|0,x|0,h|0)|0,y=k()|0,d=Ee(J|0,y|0,d|0)|0,$=k()|0|$,j=_,A[j>>2]=d|m&~z,A[j+4>>2]=$,y=Wn(J|0,y|0,x|0,h|0)|0,u=Hn(u|0,l|0,y|0,k()|0)|0,y=0,l=k()|0;while(!1);if((M|0)>(w|0))d=~w,w=w+1|0;else{l=0;break}}return L=O,l|0}while(!1);if((M|0)<1)return J=0,L=O,J|0;for(m=x^15,y=1;;)if(j=M-y|0,j=fo(7,0,j,((j|0)<0)<<31>>31)|0,J=k()|0,w=_,h=A[w>>2]|0,w=A[w+4>>2]|0,x=(m-y|0)*3|0,d=Ee(7,0,x|0)|0,w=w&~(k()|0),z=mo(u|0,l|0,j|0,J|0)|0,$=k()|0,x=Ee(z|0,$|0,x|0)|0,w=k()|0|w,E=_,A[E>>2]=x|h&~d,A[E+4>>2]=w,J=Wn(z|0,$|0,j|0,J|0)|0,u=Hn(u|0,l|0,J|0,k()|0)|0,l=k()|0,(M|0)<=(y|0)){l=0;break}else y=y+1|0;return L=O,l|0}function Td(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0;m=ge(l|0,h|0,52)|0,k()|0,m=m&15,(l|0)==0&(h|0)==0|((d|0)>15|(m|0)>(d|0))?(_=-1,l=-1,h=0,m=0):(l=k_(l,h,m+1|0,d)|0,y=(k()|0)&-15728641,h=Ee(d|0,0,52)|0,h=l|h,y=y|(k()|0),l=(Qt(h,y)|0)==0,_=m,l=l?-1:d,m=y),y=u,A[y>>2]=h,A[y+4>>2]=m,A[u+8>>2]=_,A[u+12>>2]=l}function G_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0;if(m=ge(u|0,l|0,52)|0,k()|0,m=m&15,_=d+8|0,A[_>>2]=m,(u|0)==0&(l|0)==0|((h|0)>15|(m|0)>(h|0))){h=d,A[h>>2]=0,A[h+4>>2]=0,A[_>>2]=-1,A[d+12>>2]=-1;return}if(u=k_(u,l,m+1|0,h)|0,_=(k()|0)&-15728641,m=Ee(h|0,0,52)|0,m=u|m,_=_|(k()|0),u=d,A[u>>2]=m,A[u+4>>2]=_,u=d+12|0,Qt(m,_)|0){A[u>>2]=h;return}else{A[u>>2]=-1;return}}function wd(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0;if(h=u,l=A[h>>2]|0,h=A[h+4>>2]|0,!((l|0)==0&(h|0)==0)&&(d=ge(l|0,h|0,52)|0,k()|0,d=d&15,x=Ee(1,0,(d^15)*3|0)|0,l=He(x|0,k()|0,l|0,h|0)|0,h=k()|0,x=u,A[x>>2]=l,A[x+4>>2]=h,x=u+8|0,y=A[x>>2]|0,!((d|0)<(y|0)))){for(w=u+12|0,_=d;;){if((_|0)==(y|0)){d=5;break}if(E=(_|0)==(A[w>>2]|0),m=(15-_|0)*3|0,d=ge(l|0,h|0,m|0)|0,k()|0,d=d&7,E&((d|0)==1&!0)){d=7;break}if(!((d|0)==7&!0)){d=10;break}if(E=Ee(1,0,m|0)|0,l=He(l|0,h|0,E|0,k()|0)|0,h=k()|0,E=u,A[E>>2]=l,A[E+4>>2]=h,(_|0)>(y|0))_=_+-1|0;else{d=10;break}}if((d|0)==5){E=u,A[E>>2]=0,A[E+4>>2]=0,A[x>>2]=-1,A[w>>2]=-1;return}else if((d|0)==7){y=Ee(1,0,m|0)|0,y=He(l|0,h|0,y|0,k()|0)|0,x=k()|0,E=u,A[E>>2]=y,A[E+4>>2]=x,A[w>>2]=_+-1;return}else if((d|0)==10)return}}function yu(u){u=+u;var l=0;return l=u<0?u+6.283185307179586:u,+(u>=6.283185307179586?l+-6.283185307179586:l)}function nl(u,l){return u=u|0,l=l|0,+pt(+(+D[u>>3]-+D[l>>3]))<17453292519943298e-27?(l=+pt(+(+D[u+8>>3]-+D[l+8>>3]))<17453292519943298e-27,l|0):(l=0,l|0)}function Wr(u,l){switch(u=+u,l=l|0,l|0){case 1:{u=u<0?u+6.283185307179586:u;break}case 2:{u=u>0?u+-6.283185307179586:u;break}}return+u}function _E(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0;return m=+D[l>>3],d=+D[u>>3],_=+mt(+((m-d)*.5)),h=+mt(+((+D[l+8>>3]-+D[u+8>>3])*.5)),h=_*_+h*(+Dt(+m)*+Dt(+d)*h),+(+Ai(+ +Mt(+h),+ +Mt(+(1-h)))*2)}function vu(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0;return m=+D[l>>3],d=+D[u>>3],_=+mt(+((m-d)*.5)),h=+mt(+((+D[l+8>>3]-+D[u+8>>3])*.5)),h=_*_+h*(+Dt(+m)*+Dt(+d)*h),+(+Ai(+ +Mt(+h),+ +Mt(+(1-h)))*2*6371.007180918475)}function yE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0;return m=+D[l>>3],d=+D[u>>3],_=+mt(+((m-d)*.5)),h=+mt(+((+D[l+8>>3]-+D[u+8>>3])*.5)),h=_*_+h*(+Dt(+m)*+Dt(+d)*h),+(+Ai(+ +Mt(+h),+ +Mt(+(1-h)))*2*6371.007180918475*1e3)}function vE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0;return _=+D[l>>3],d=+Dt(+_),m=+D[l+8>>3]-+D[u+8>>3],y=d*+mt(+m),h=+D[u>>3],+ +Ai(+y,+(+mt(+_)*+Dt(+h)-+Dt(+m)*(d*+mt(+h))))}function xE(u,l,h,d){u=u|0,l=+l,h=+h,d=d|0;var m=0,_=0,y=0,x=0;if(h<1e-16){A[d>>2]=A[u>>2],A[d+4>>2]=A[u+4>>2],A[d+8>>2]=A[u+8>>2],A[d+12>>2]=A[u+12>>2];return}_=l<0?l+6.283185307179586:l,_=l>=6.283185307179586?_+-6.283185307179586:_;do if(_<1e-16)l=+D[u>>3]+h,D[d>>3]=l,m=d;else{if(m=+pt(+(_+-3.141592653589793))<1e-16,l=+D[u>>3],m){l=l-h,D[d>>3]=l,m=d;break}if(y=+Dt(+h),h=+mt(+h),l=y*+mt(+l)+ +Dt(+_)*(h*+Dt(+l)),l=l>1?1:l,l=+A7(+(l<-1?-1:l)),D[d>>3]=l,+pt(+(l+-1.5707963267948966))<1e-16){D[d>>3]=1.5707963267948966,D[d+8>>3]=0;return}if(+pt(+(l+1.5707963267948966))<1e-16){D[d>>3]=-1.5707963267948966,D[d+8>>3]=0;return}if(x=1/+Dt(+l),_=h*+mt(+_)*x,h=+D[u>>3],l=x*((y-+mt(+l)*+mt(+h))/+Dt(+h)),y=_>1?1:_,l=l>1?1:l,l=+D[u+8>>3]+ +Ai(+(y<-1?-1:y),+(l<-1?-1:l)),l>3.141592653589793)do l=l+-6.283185307179586;while(l>3.141592653589793);if(l<-3.141592653589793)do l=l+6.283185307179586;while(l<-3.141592653589793);D[d+8>>3]=l;return}while(!1);if(+pt(+(l+-1.5707963267948966))<1e-16){D[m>>3]=1.5707963267948966,D[d+8>>3]=0;return}if(+pt(+(l+1.5707963267948966))<1e-16){D[m>>3]=-1.5707963267948966,D[d+8>>3]=0;return}if(l=+D[u+8>>3],l>3.141592653589793)do l=l+-6.283185307179586;while(l>3.141592653589793);if(l<-3.141592653589793)do l=l+6.283185307179586;while(l<-3.141592653589793);D[d+8>>3]=l}function V_(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(D[l>>3]=+D[20656+(u<<3)>>3],l=0,l|0)}function bE(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(D[l>>3]=+D[20784+(u<<3)>>3],l=0,l|0)}function TE(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(D[l>>3]=+D[20912+(u<<3)>>3],l=0,l|0)}function wE(u,l){return u=u|0,l=l|0,u>>>0>15?(l=4,l|0):(D[l>>3]=+D[21040+(u<<3)>>3],l=0,l|0)}function dc(u,l){u=u|0,l=l|0;var h=0;return u>>>0>15?(l=4,l|0):(h=fo(7,0,u,((u|0)<0)<<31>>31)|0,h=Wn(h|0,k()|0,120,0)|0,u=k()|0,A[l>>2]=h|2,A[l+4>>2]=u,l=0,l|0)}function z_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0;return z=+D[l>>3],M=+D[u>>3],w=+mt(+((z-M)*.5)),_=+D[l+8>>3],E=+D[u+8>>3],y=+mt(+((_-E)*.5)),x=+Dt(+M),O=+Dt(+z),y=w*w+y*(O*x*y),y=+Ai(+ +Mt(+y),+ +Mt(+(1-y)))*2,w=+D[h>>3],z=+mt(+((w-z)*.5)),d=+D[h+8>>3],_=+mt(+((d-_)*.5)),m=+Dt(+w),_=z*z+_*(O*m*_),_=+Ai(+ +Mt(+_),+ +Mt(+(1-_)))*2,w=+mt(+((M-w)*.5)),d=+mt(+((E-d)*.5)),d=w*w+d*(x*m*d),d=+Ai(+ +Mt(+d),+ +Mt(+(1-d)))*2,m=(y+_+d)*.5,+(+rd(+ +Mt(+(+ui(+(m*.5))*+ui(+((m-y)*.5))*+ui(+((m-_)*.5))*+ui(+((m-d)*.5)))))*4)}function Sd(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0;if(x=L,L=L+192|0,_=x+168|0,y=x,m=aa(u,l,_)|0,m|0)return h=m,L=x,h|0;if(tl(u,l,y)|0&&tt(27795,27190,415,27199),l=A[y>>2]|0,(l|0)>0){if(d=+z_(y+8|0,y+8+(((l|0)!=1&1)<<4)|0,_)+0,(l|0)!=1){u=1;do m=u,u=u+1|0,d=d+ +z_(y+8+(m<<4)|0,y+8+(((u|0)%(l|0)|0)<<4)|0,_);while((u|0)<(l|0))}}else d=0;return D[h>>3]=d,h=0,L=x,h|0}function SE(u,l,h){return u=u|0,l=l|0,h=h|0,u=Sd(u,l,h)|0,u|0||(D[h>>3]=+D[h>>3]*6371.007180918475*6371.007180918475),u|0}function EE(u,l,h){return u=u|0,l=l|0,h=h|0,u=Sd(u,l,h)|0,u|0||(D[h>>3]=+D[h>>3]*6371.007180918475*6371.007180918475*1e3*1e3),u|0}function NE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;if(x=L,L=L+176|0,y=x,u=fc(u,l,y)|0,u|0)return y=u,L=x,y|0;if(D[h>>3]=0,u=A[y>>2]|0,(u|0)<=1)return y=0,L=x,y|0;l=u+-1|0,u=0,d=+D[y+8>>3],m=+D[y+16>>3],_=0;do u=u+1|0,E=d,d=+D[y+8+(u<<4)>>3],M=+mt(+((d-E)*.5)),w=m,m=+D[y+8+(u<<4)+8>>3],w=+mt(+((m-w)*.5)),w=M*M+w*(+Dt(+d)*+Dt(+E)*w),_=_+ +Ai(+ +Mt(+w),+ +Mt(+(1-w)))*2;while((u|0)<(l|0));return D[h>>3]=_,y=0,L=x,y|0}function RE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;if(x=L,L=L+176|0,y=x,u=fc(u,l,y)|0,u|0)return y=u,_=+D[h>>3],_=_*6371.007180918475,D[h>>3]=_,L=x,y|0;if(D[h>>3]=0,u=A[y>>2]|0,(u|0)<=1)return y=0,_=0,_=_*6371.007180918475,D[h>>3]=_,L=x,y|0;l=u+-1|0,u=0,d=+D[y+8>>3],m=+D[y+16>>3],_=0;do u=u+1|0,E=d,d=+D[y+8+(u<<4)>>3],M=+mt(+((d-E)*.5)),w=m,m=+D[y+8+(u<<4)+8>>3],w=+mt(+((m-w)*.5)),w=M*M+w*(+Dt(+E)*+Dt(+d)*w),_=_+ +Ai(+ +Mt(+w),+ +Mt(+(1-w)))*2;while((u|0)!=(l|0));return D[h>>3]=_,y=0,M=_,M=M*6371.007180918475,D[h>>3]=M,L=x,y|0}function CE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;if(x=L,L=L+176|0,y=x,u=fc(u,l,y)|0,u|0)return y=u,_=+D[h>>3],_=_*6371.007180918475,_=_*1e3,D[h>>3]=_,L=x,y|0;if(D[h>>3]=0,u=A[y>>2]|0,(u|0)<=1)return y=0,_=0,_=_*6371.007180918475,_=_*1e3,D[h>>3]=_,L=x,y|0;l=u+-1|0,u=0,d=+D[y+8>>3],m=+D[y+16>>3],_=0;do u=u+1|0,E=d,d=+D[y+8+(u<<4)>>3],M=+mt(+((d-E)*.5)),w=m,m=+D[y+8+(u<<4)+8>>3],w=+mt(+((m-w)*.5)),w=M*M+w*(+Dt(+E)*+Dt(+d)*w),_=_+ +Ai(+ +Mt(+w),+ +Mt(+(1-w)))*2;while((u|0)!=(l|0));return D[h>>3]=_,y=0,M=_,M=M*6371.007180918475,M=M*1e3,D[h>>3]=M,L=x,y|0}function ME(u){u=u|0;var l=0,h=0,d=0;return l=Dr(1,12)|0,l||tt(27280,27235,49,27293),h=u+4|0,d=A[h>>2]|0,d|0?(d=d+8|0,A[d>>2]=l,A[h>>2]=l,l|0):(A[u>>2]|0&&tt(27310,27235,61,27333),d=u,A[d>>2]=l,A[h>>2]=l,l|0)}function PE(u,l){u=u|0,l=l|0;var h=0,d=0;return d=Ji(24)|0,d||tt(27347,27235,78,27361),A[d>>2]=A[l>>2],A[d+4>>2]=A[l+4>>2],A[d+8>>2]=A[l+8>>2],A[d+12>>2]=A[l+12>>2],A[d+16>>2]=0,l=u+4|0,h=A[l>>2]|0,h|0?(A[h+16>>2]=d,A[l>>2]=d,d|0):(A[u>>2]|0&&tt(27376,27235,82,27361),A[u>>2]=d,A[l>>2]=d,d|0)}function $_(u){u=u|0;var l=0,h=0,d=0,m=0;if(u)for(d=1;;){if(l=A[u>>2]|0,l|0)do{if(h=A[l>>2]|0,h|0)do m=h,h=A[h+16>>2]|0,We(m);while((h|0)!=0);m=l,l=A[l+8>>2]|0,We(m)}while((l|0)!=0);if(l=u,u=A[u+8>>2]|0,d||We(l),u)d=0;else break}}function BE(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0,$e=0,ke=0,at=0,ut=0,_t=0,et=0,je=0,Ne=0,dt=0,$t=0,ct=0;if(m=u+8|0,A[m>>2]|0)return ct=1,ct|0;if(d=A[u>>2]|0,!d)return ct=0,ct|0;l=d,h=0;do h=h+1|0,l=A[l+8>>2]|0;while((l|0)!=0);if(h>>>0<2)return ct=0,ct|0;dt=Ji(h<<2)|0,dt||tt(27396,27235,317,27415),Ne=Ji(h<<5)|0,Ne||tt(27437,27235,321,27415),A[u>>2]=0,$e=u+4|0,A[$e>>2]=0,A[m>>2]=0,h=0,je=0,Re=0,O=0;e:for(;;){if(M=A[d>>2]|0,M){_=0,y=M;do{if(w=+D[y+8>>3],l=y,y=A[y+16>>2]|0,E=(y|0)==0,m=E?M:y,x=+D[m+8>>3],+pt(+(w-x))>3.141592653589793){ct=14;break}_=_+(x-w)*(+D[l>>3]+ +D[m>>3])}while(!E);if((ct|0)==14){ct=0,_=0,l=M;do ne=+D[l+8>>3],et=l+16|0,_t=A[et>>2]|0,_t=(_t|0)==0?M:_t,se=+D[_t+8>>3],_=_+(+D[l>>3]+ +D[_t>>3])*((se<0?se+6.283185307179586:se)-(ne<0?ne+6.283185307179586:ne)),l=A[((l|0)==0?d:et)>>2]|0;while((l|0)!=0)}_>0?(A[dt+(je<<2)>>2]=d,je=je+1|0,m=Re,l=O):ct=19}else ct=19;if((ct|0)==19){ct=0;do if(h){if(l=h+8|0,A[l>>2]|0){ct=21;break e}if(h=Dr(1,12)|0,!h){ct=23;break e}A[l>>2]=h,m=h+4|0,y=h,l=O}else if(O){m=$e,y=O+8|0,l=d,h=u;break}else if(A[u>>2]|0){ct=27;break e}else{m=$e,y=u,l=d,h=u;break}while(!1);if(A[y>>2]=d,A[m>>2]=d,y=Ne+(Re<<5)|0,E=A[d>>2]|0,E){for(M=Ne+(Re<<5)+8|0,D[M>>3]=17976931348623157e292,O=Ne+(Re<<5)+24|0,D[O>>3]=17976931348623157e292,D[y>>3]=-17976931348623157e292,z=Ne+(Re<<5)+16|0,D[z>>3]=-17976931348623157e292,Ae=17976931348623157e292,ue=-17976931348623157e292,m=0,$=E,w=17976931348623157e292,J=17976931348623157e292,ie=-17976931348623157e292,x=-17976931348623157e292;_=+D[$>>3],ne=+D[$+8>>3],$=A[$+16>>2]|0,j=($|0)==0,se=+D[(j?E:$)+8>>3],_<w&&(D[M>>3]=_,w=_),ne<J&&(D[O>>3]=ne,J=ne),_>ie?D[y>>3]=_:_=ie,ne>x&&(D[z>>3]=ne,x=ne),Ae=ne>0&ne<Ae?ne:Ae,ue=ne<0&ne>ue?ne:ue,m=m|+pt(+(ne-se))>3.141592653589793,!j;)ie=_;m&&(D[z>>3]=ue,D[O>>3]=Ae)}else A[y>>2]=0,A[y+4>>2]=0,A[y+8>>2]=0,A[y+12>>2]=0,A[y+16>>2]=0,A[y+20>>2]=0,A[y+24>>2]=0,A[y+28>>2]=0;m=Re+1|0}if(et=d+8|0,d=A[et>>2]|0,A[et>>2]=0,d)Re=m,O=l;else{ct=45;break}}if((ct|0)==21)tt(27213,27235,35,27247);else if((ct|0)==23)tt(27267,27235,37,27247);else if((ct|0)==27)tt(27310,27235,61,27333);else if((ct|0)==45){e:do if((je|0)>0){for(et=(m|0)==0,ut=m<<2,_t=(u|0)==0,at=0,l=0;;){if(ke=A[dt+(at<<2)>>2]|0,et)ct=73;else{if(Re=Ji(ut)|0,!Re){ct=50;break}if($e=Ji(ut)|0,!$e){ct=52;break}t:do if(_t)h=0;else{for(m=0,h=0,y=u;d=Ne+(m<<5)|0,j_(A[y>>2]|0,d,A[ke>>2]|0)|0?(A[Re+(h<<2)>>2]=y,A[$e+(h<<2)>>2]=d,j=h+1|0):j=h,y=A[y+8>>2]|0,y;)m=m+1|0,h=j;if((j|0)>0)if(d=A[Re>>2]|0,(j|0)==1)h=d;else for(z=0,$=-1,h=d,O=d;;){for(E=A[O>>2]|0,d=0,y=0;m=A[A[Re+(y<<2)>>2]>>2]|0,(m|0)==(E|0)?M=d:M=d+((j_(m,A[$e+(y<<2)>>2]|0,A[E>>2]|0)|0)&1)|0,y=y+1|0,(y|0)!=(j|0);)d=M;if(m=(M|0)>($|0),h=m?O:h,d=z+1|0,(d|0)==(j|0))break t;z=d,$=m?M:$,O=A[Re+(d<<2)>>2]|0}else h=0}while(!1);if(We(Re),We($e),h){if(m=h+4|0,d=A[m>>2]|0,d)h=d+8|0;else if(A[h>>2]|0){ct=70;break}A[h>>2]=ke,A[m>>2]=ke}else ct=73}if((ct|0)==73){if(ct=0,l=A[ke>>2]|0,l|0)do $e=l,l=A[l+16>>2]|0,We($e);while((l|0)!=0);We(ke),l=1}if(at=at+1|0,(at|0)>=(je|0)){$t=l;break e}}(ct|0)==50?tt(27452,27235,249,27471):(ct|0)==52?tt(27490,27235,252,27471):(ct|0)==70&&tt(27310,27235,61,27333)}else $t=0;while(!1);return We(dt),We(Ne),ct=$t,ct|0}return 0}function j_(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;if(!(ud(l,h)|0)||(l=T_(l)|0,d=+D[h>>3],m=+D[h+8>>3],m=l&m<0?m+6.283185307179586:m,u=A[u>>2]|0,!u))return u=0,u|0;if(l){l=0,E=m,h=u;e:for(;;){for(;y=+D[h>>3],m=+D[h+8>>3],h=h+16|0,M=A[h>>2]|0,M=(M|0)==0?u:M,_=+D[M>>3],x=+D[M+8>>3],y>_?(w=y,y=x):(w=_,_=y,y=m,m=x),d=d==_|d==w?d+2220446049250313e-31:d,!!(d<_|d>w);)if(h=A[h>>2]|0,!h){h=22;break e}if(x=y<0?y+6.283185307179586:y,y=m<0?m+6.283185307179586:m,E=x==E|y==E?E+-2220446049250313e-31:E,w=x+(y-x)*((d-_)/(w-_)),(w<0?w+6.283185307179586:w)>E&&(l=l^1),h=A[h>>2]|0,!h){h=22;break}}if((h|0)==22)return l|0}else{l=0,E=m,h=u;e:for(;;){for(;y=+D[h>>3],m=+D[h+8>>3],h=h+16|0,M=A[h>>2]|0,M=(M|0)==0?u:M,_=+D[M>>3],x=+D[M+8>>3],y>_?(w=y,y=x):(w=_,_=y,y=m,m=x),d=d==_|d==w?d+2220446049250313e-31:d,!!(d<_|d>w);)if(h=A[h>>2]|0,!h){h=22;break e}if(E=y==E|m==E?E+-2220446049250313e-31:E,y+(m-y)*((d-_)/(w-_))>E&&(l=l^1),h=A[h>>2]|0,!h){h=22;break}}if((h|0)==22)return l|0}return 0}function Fs(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0;if(ue=L,L=L+32|0,Ae=ue+16|0,ie=ue,_=ge(u|0,l|0,52)|0,k()|0,_=_&15,$=ge(h|0,d|0,52)|0,k()|0,(_|0)!=($&15|0))return Ae=12,L=ue,Ae|0;if(E=ge(u|0,l|0,45)|0,k()|0,E=E&127,M=ge(h|0,d|0,45)|0,k()|0,M=M&127,E>>>0>121|M>>>0>121)return Ae=5,L=ue,Ae|0;if($=(E|0)!=(M|0),$){if(x=ld(E,M)|0,(x|0)==7)return Ae=1,L=ue,Ae|0;w=ld(M,E)|0,(w|0)==7?tt(27514,27538,161,27548):(j=x,y=w)}else j=0,y=0;O=rn(E)|0,z=rn(M)|0,A[Ae>>2]=0,A[Ae+4>>2]=0,A[Ae+8>>2]=0,A[Ae+12>>2]=0;do if(j){if(M=A[4272+(E*28|0)+(j<<2)>>2]|0,x=(M|0)>0,z)if(x){E=0,w=h,x=d;do w=hE(w,x)|0,x=k()|0,y=ho(y)|0,(y|0)==1&&(y=ho(1)|0),E=E+1|0;while((E|0)!=(M|0));M=y,E=w,w=x}else M=y,E=h,w=d;else if(x){E=0,w=h,x=d;do w=yd(w,x)|0,x=k()|0,y=ho(y)|0,E=E+1|0;while((E|0)!=(M|0));M=y,E=w,w=x}else M=y,E=h,w=d;if(xd(E,w,Ae)|0,$||tt(27563,27538,191,27548),x=(O|0)!=0,y=(z|0)!=0,x&y&&tt(27590,27538,192,27548),x){if(y=Br(u,l)|0,(y|0)==7){_=5;break}if(ve[22e3+(y*7|0)+j>>0]|0){_=1;break}w=A[21168+(y*28|0)+(j<<2)>>2]|0,E=w}else if(y){if(y=Br(E,w)|0,(y|0)==7){_=5;break}if(ve[22e3+(y*7|0)+M>>0]|0){_=1;break}E=0,w=A[21168+(M*28|0)+(y<<2)>>2]|0}else E=0,w=0;if((E|w|0)<0)_=5;else{if((w|0)>0){x=Ae+4|0,y=0;do hc(x),y=y+1|0;while((y|0)!=(w|0))}if(A[ie>>2]=0,A[ie+4>>2]=0,A[ie+8>>2]=0,C_(ie,j),_|0)for(;ci(_)|0?cc(ie):ia(ie),(_|0)>1;)_=_+-1|0;if((E|0)>0){_=0;do hc(ie),_=_+1|0;while((_|0)!=(E|0))}J=Ae+4|0,vr(J,ie,J),Ar(J),J=51}}else if(xd(h,d,Ae)|0,(O|0)!=0&(z|0)!=0)if((M|0)!=(E|0)&&tt(27621,27538,261,27548),y=Br(u,l)|0,_=Br(h,d)|0,(y|0)==7|(_|0)==7)_=5;else if(ve[22e3+(y*7|0)+_>>0]|0)_=1;else if(y=A[21168+(y*28|0)+(_<<2)>>2]|0,(y|0)>0){x=Ae+4|0,_=0;do hc(x),_=_+1|0;while((_|0)!=(y|0));J=51}else J=51;else J=51;while(!1);return(J|0)==51&&(_=Ae+4|0,A[m>>2]=A[_>>2],A[m+4>>2]=A[_+4>>2],A[m+8>>2]=A[_+8>>2],_=0),Ae=_,L=ue,Ae|0}function H_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0;if(J=L,L=L+48|0,E=J+36|0,y=J+24|0,x=J+12|0,w=J,m=ge(u|0,l|0,52)|0,k()|0,m=m&15,z=ge(u|0,l|0,45)|0,k()|0,z=z&127,z>>>0>121)return d=5,L=J,d|0;if(M=rn(z)|0,Ee(m|0,0,52)|0,ie=k()|0|134225919,_=d,A[_>>2]=-1,A[_+4>>2]=ie,!m)return m=Ac(h)|0,(m|0)==7||(m=ad(z,m)|0,(m|0)==127)?(ie=1,L=J,ie|0):($=Ee(m|0,0,45)|0,j=k()|0,z=d,j=A[z+4>>2]&-1040385|j,ie=d,A[ie>>2]=A[z>>2]|$,A[ie+4>>2]=j,ie=0,L=J,ie|0);for(A[E>>2]=A[h>>2],A[E+4>>2]=A[h+4>>2],A[E+8>>2]=A[h+8>>2],h=m;;){if(_=h,h=h+-1|0,A[y>>2]=A[E>>2],A[y+4>>2]=A[E+4>>2],A[y+8>>2]=A[E+8>>2],ci(_)|0){if(m=q7(E)|0,m|0){h=13;break}A[x>>2]=A[E>>2],A[x+4>>2]=A[E+4>>2],A[x+8>>2]=A[E+8>>2],cc(x)}else{if(m=G7(E)|0,m|0){h=13;break}A[x>>2]=A[E>>2],A[x+4>>2]=A[E+4>>2],A[x+8>>2]=A[E+8>>2],ia(x)}if(cd(y,x,w),Ar(w),m=d,ue=A[m>>2]|0,m=A[m+4>>2]|0,se=(15-_|0)*3|0,Ae=Ee(7,0,se|0)|0,m=m&~(k()|0),se=Ee(Ac(w)|0,0,se|0)|0,m=k()|0|m,ie=d,A[ie>>2]=se|ue&~Ae,A[ie+4>>2]=m,(_|0)<=1){h=14;break}}e:do if((h|0)!=13&&(h|0)==14)if((A[E>>2]|0)<=1&&(A[E+4>>2]|0)<=1&&(A[E+8>>2]|0)<=1){h=Ac(E)|0,m=ad(z,h)|0,(m|0)==127?w=0:w=rn(m)|0;t:do if(h){if(M){if(m=Br(u,l)|0,(m|0)==7){m=5;break e}if(_=A[21376+(m*28|0)+(h<<2)>>2]|0,(_|0)>0){m=h,h=0;do m=sa(m)|0,h=h+1|0;while((h|0)!=(_|0))}else m=h;if((m|0)==1){m=9;break e}h=ad(z,m)|0,(h|0)==127&&tt(27648,27538,411,27678),rn(h)|0?tt(27693,27538,412,27678):(j=h,$=_,O=m)}else j=m,$=0,O=h;if(x=A[4272+(z*28|0)+(O<<2)>>2]|0,(x|0)<=-1&&tt(27724,27538,419,27678),!w){if(($|0)<0){m=5;break e}if($|0){_=d,m=0,h=A[_>>2]|0,_=A[_+4>>2]|0;do h=oa(h,_)|0,_=k()|0,se=d,A[se>>2]=h,A[se+4>>2]=_,m=m+1|0;while((m|0)<($|0))}if((x|0)<=0){m=j,h=58;break}for(_=d,m=0,h=A[_>>2]|0,_=A[_+4>>2]|0;;)if(h=oa(h,_)|0,_=k()|0,se=d,A[se>>2]=h,A[se+4>>2]=_,m=m+1|0,(m|0)==(x|0)){m=j,h=58;break t}}if(y=ld(j,z)|0,(y|0)==7&&tt(27514,27538,428,27678),m=d,h=A[m>>2]|0,m=A[m+4>>2]|0,(x|0)>0){_=0;do h=oa(h,m)|0,m=k()|0,se=d,A[se>>2]=h,A[se+4>>2]=m,_=_+1|0;while((_|0)!=(x|0))}if(m=Br(h,m)|0,(m|0)==7&&tt(27795,27538,440,27678),h=od(j)|0,h=A[(h?21792:21584)+(y*28|0)+(m<<2)>>2]|0,(h|0)<0&&tt(27795,27538,454,27678),!h)m=j,h=58;else{y=d,m=0,_=A[y>>2]|0,y=A[y+4>>2]|0;do _=_d(_,y)|0,y=k()|0,se=d,A[se>>2]=_,A[se+4>>2]=y,m=m+1|0;while((m|0)<(h|0));m=j,h=58}}else if((M|0)!=0&(w|0)!=0){if(h=Br(u,l)|0,_=d,_=Br(A[_>>2]|0,A[_+4>>2]|0)|0,(h|0)==7|(_|0)==7){m=5;break e}if(_=A[21376+(h*28|0)+(_<<2)>>2]|0,(_|0)<0){m=5;break e}if(!_)h=59;else{x=d,h=0,y=A[x>>2]|0,x=A[x+4>>2]|0;do y=oa(y,x)|0,x=k()|0,se=d,A[se>>2]=y,A[se+4>>2]=x,h=h+1|0;while((h|0)<(_|0));h=58}}else h=58;while(!1);if((h|0)==58&&w&&(h=59),(h|0)==59&&(se=d,(Br(A[se>>2]|0,A[se+4>>2]|0)|0)==1)){m=9;break}se=d,Ae=A[se>>2]|0,se=A[se+4>>2]&-1040385,ue=Ee(m|0,0,45)|0,se=se|(k()|0),m=d,A[m>>2]=Ae|ue,A[m+4>>2]=se,m=0}else m=1;while(!1);return se=m,L=J,se|0}function DE(u,l,h,d,m,_){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,_=_|0;var y=0,x=0;return x=L,L=L+16|0,y=x,m?u=15:(u=Fs(u,l,h,d,y)|0,u||(z7(y,_),u=0)),L=x,u|0}function LE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0;return y=L,L=L+16|0,_=y,d?h=15:(h=$7(h,_)|0,h||(h=H_(u,l,_,m)|0)),L=y,h|0}function FE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0;return w=L,L=L+32|0,y=w+12|0,x=w,_=Fs(u,l,u,l,y)|0,_|0?(x=_,L=w,x|0):(u=Fs(u,l,h,d,x)|0,u|0?(x=u,L=w,x|0):(y=hd(y,x)|0,x=m,A[x>>2]=y,A[x+4>>2]=((y|0)<0)<<31>>31,x=0,L=w,x|0))}function OE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0;return w=L,L=L+32|0,y=w+12|0,x=w,_=Fs(u,l,u,l,y)|0,!_&&(_=Fs(u,l,h,d,x)|0,!_)?(d=hd(y,x)|0,d=He(d|0,((d|0)<0)<<31>>31|0,1,0)|0,y=k()|0,x=m,A[x>>2]=d,A[x+4>>2]=y,x=0,L=w,x|0):(x=_,L=w,x|0)}function IE(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0,$e=0,ke=0,at=0;if(ke=L,L=L+48|0,Re=ke+24|0,y=ke+12|0,$e=ke,_=Fs(u,l,u,l,Re)|0,!_&&(_=Fs(u,l,h,d,y)|0,!_)){se=hd(Re,y)|0,ne=((se|0)<0)<<31>>31,A[Re>>2]=0,A[Re+4>>2]=0,A[Re+8>>2]=0,A[y>>2]=0,A[y+4>>2]=0,A[y+8>>2]=0,Fs(u,l,u,l,Re)|0&&tt(27795,27538,692,27747),Fs(u,l,h,d,y)|0&&tt(27795,27538,697,27747),D_(Re),D_(y),M=(se|0)==0?0:1/+(se|0),h=A[Re>>2]|0,J=M*+((A[y>>2]|0)-h|0),ie=Re+4|0,d=A[ie>>2]|0,Ae=M*+((A[y+4>>2]|0)-d|0),ue=Re+8|0,_=A[ue>>2]|0,M=M*+((A[y+8>>2]|0)-_|0),A[$e>>2]=h,O=$e+4|0,A[O>>2]=d,z=$e+8|0,A[z>>2]=_;e:do if((se|0)<0)_=0;else for($=0,j=0;;){w=+(j>>>0)+4294967296*+($|0),at=J*w+ +(h|0),x=Ae*w+ +(d|0),w=M*w+ +(_|0),h=~~+_c(+at),y=~~+_c(+x),_=~~+_c(+w),at=+pt(+(+(h|0)-at)),x=+pt(+(+(y|0)-x)),w=+pt(+(+(_|0)-w));do if(at>x&at>w)h=0-(y+_)|0,d=y;else if(E=0-h|0,x>w){d=E-_|0;break}else{d=y,_=E-y|0;break}while(!1);if(A[$e>>2]=h,A[O>>2]=d,A[z>>2]=_,j7($e),_=H_(u,l,$e,m+(j<<3)|0)|0,_|0)break e;if(!(($|0)<(ne|0)|($|0)==(ne|0)&j>>>0<se>>>0)){_=0;break e}h=He(j|0,$|0,1,0)|0,d=k()|0,$=d,j=h,h=A[Re>>2]|0,d=A[ie>>2]|0,_=A[ue>>2]|0}while(!1);return $e=_,L=ke,$e|0}return $e=_,L=ke,$e|0}function fo(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0;if((h|0)==0&(d|0)==0)return m=0,_=1,lt(m|0),_|0;_=u,m=l,u=1,l=0;do y=(h&1|0)==0&!0,u=Wn((y?1:_)|0,(y?0:m)|0,u|0,l|0)|0,l=k()|0,h=sy(h|0,d|0,1)|0,d=k()|0,_=Wn(_|0,m|0,_|0,m|0)|0,m=k()|0;while(!((h|0)==0&(d|0)==0));return lt(l|0),u|0}function Ed(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0;x=L,L=L+16|0,_=x,y=ge(u|0,l|0,52)|0,k()|0,y=y&15;do if(y){if(m=aa(u,l,_)|0,!m){E=+D[_>>3],w=1/+Dt(+E),M=+D[25968+(y<<3)>>3],D[h>>3]=E+M,D[h+8>>3]=E-M,E=+D[_+8>>3],w=M*w,D[h+16>>3]=w+E,D[h+24>>3]=E-w;break}return y=m,L=x,y|0}else{if(m=ge(u|0,l|0,45)|0,k()|0,m=m&127,m>>>0>121)return y=5,L=x,y|0;_=22064+(m<<5)|0,A[h>>2]=A[_>>2],A[h+4>>2]=A[_+4>>2],A[h+8>>2]=A[_+8>>2],A[h+12>>2]=A[_+12>>2],A[h+16>>2]=A[_+16>>2],A[h+20>>2]=A[_+20>>2],A[h+24>>2]=A[_+24>>2],A[h+28>>2]=A[_+28>>2];break}while(!1);return I7(h,d?1.4:1.1),d=26096+(y<<3)|0,(A[d>>2]|0)==(u|0)&&(A[d+4>>2]|0)==(l|0)&&(D[h>>3]=1.5707963267948966),y=26224+(y<<3)|0,(A[y>>2]|0)==(u|0)&&(A[y+4>>2]|0)==(l|0)&&(D[h+8>>3]=-1.5707963267948966),+D[h>>3]!=1.5707963267948966&&+D[h+8>>3]!=-1.5707963267948966?(y=0,L=x,y|0):(D[h+16>>3]=3.141592653589793,D[h+24>>3]=-3.141592653589793,y=0,L=x,y|0)}function kE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0;E=L,L=L+48|0,y=E+32|0,_=E+40|0,x=E,md(y,0,0,0),w=A[y>>2]|0,y=A[y+4>>2]|0;do if(h>>>0<=15){if(m=bu(d)|0,m|0){d=x,A[d>>2]=0,A[d+4>>2]=0,A[x+8>>2]=m,A[x+12>>2]=-1,d=x+16|0,w=x+29|0,A[d>>2]=0,A[d+4>>2]=0,A[d+8>>2]=0,ve[d+12>>0]=0,ve[w>>0]=ve[_>>0]|0,ve[w+1>>0]=ve[_+1>>0]|0,ve[w+2>>0]=ve[_+2>>0]|0;break}if(m=Dr((A[l+8>>2]|0)+1|0,32)|0,m){Nd(l,m),M=x,A[M>>2]=w,A[M+4>>2]=y,A[x+8>>2]=0,A[x+12>>2]=h,A[x+16>>2]=d,A[x+20>>2]=l,A[x+24>>2]=m,ve[x+28>>0]=0,w=x+29|0,ve[w>>0]=ve[_>>0]|0,ve[w+1>>0]=ve[_+1>>0]|0,ve[w+2>>0]=ve[_+2>>0]|0;break}else{d=x,A[d>>2]=0,A[d+4>>2]=0,A[x+8>>2]=13,A[x+12>>2]=-1,d=x+16|0,w=x+29|0,A[d>>2]=0,A[d+4>>2]=0,A[d+8>>2]=0,ve[d+12>>0]=0,ve[w>>0]=ve[_>>0]|0,ve[w+1>>0]=ve[_+1>>0]|0,ve[w+2>>0]=ve[_+2>>0]|0;break}}else w=x,A[w>>2]=0,A[w+4>>2]=0,A[x+8>>2]=4,A[x+12>>2]=-1,w=x+16|0,M=x+29|0,A[w>>2]=0,A[w+4>>2]=0,A[w+8>>2]=0,ve[w+12>>0]=0,ve[M>>0]=ve[_>>0]|0,ve[M+1>>0]=ve[_+1>>0]|0,ve[M+2>>0]=ve[_+2>>0]|0;while(!1);pc(x),A[u>>2]=A[x>>2],A[u+4>>2]=A[x+4>>2],A[u+8>>2]=A[x+8>>2],A[u+12>>2]=A[x+12>>2],A[u+16>>2]=A[x+16>>2],A[u+20>>2]=A[x+20>>2],A[u+24>>2]=A[x+24>>2],A[u+28>>2]=A[x+28>>2],L=E}function pc(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0;if(ne=L,L=L+336|0,$=ne+168|0,j=ne,d=u,h=A[d>>2]|0,d=A[d+4>>2]|0,(h|0)==0&(d|0)==0){L=ne;return}if(l=u+28|0,ve[l>>0]|0?(h=W_(h,d)|0,d=k()|0):ve[l>>0]=1,se=u+20|0,!(A[A[se>>2]>>2]|0)){l=u+24|0,h=A[l>>2]|0,h|0&&We(h),ue=u,A[ue>>2]=0,A[ue+4>>2]=0,A[u+8>>2]=0,A[se>>2]=0,A[u+12>>2]=-1,A[u+16>>2]=0,A[l>>2]=0,L=ne;return}ue=u+16|0,l=A[ue>>2]|0,m=l&15;e:do if((h|0)==0&(d|0)==0)Ae=u+24|0;else{J=u+12|0,O=(m|0)==3,M=l&255,w=(m|1|0)==3,z=u+24|0,E=(m+-1|0)>>>0<3,y=(m|2|0)==3,x=j+8|0;t:for(;;){if(_=ge(h|0,d|0,52)|0,k()|0,_=_&15,(_|0)==(A[J>>2]|0)){switch(M&15){case 0:case 2:case 3:{if(m=aa(h,d,$)|0,m|0){ie=15;break t}if(Rd(A[se>>2]|0,A[z>>2]|0,$)|0){ie=19;break t}break}}if(w&&(m=A[(A[se>>2]|0)+4>>2]|0,A[$>>2]=A[m>>2],A[$+4>>2]=A[m+4>>2],A[$+8>>2]=A[m+8>>2],A[$+12>>2]=A[m+12>>2],ud(26832,$)|0)){if(vd(A[(A[se>>2]|0)+4>>2]|0,_,j)|0){ie=25;break}if(m=j,(A[m>>2]|0)==(h|0)&&(A[m+4>>2]|0)==(d|0)){ie=29;break}}if(E){if(m=tl(h,d,$)|0,m|0){ie=32;break}if(Ed(h,d,j,0)|0){ie=36;break}if(y&&Y_(A[se>>2]|0,A[z>>2]|0,$,j)|0){ie=42;break}if(w&&X_(A[se>>2]|0,A[z>>2]|0,$,j)|0){ie=42;break}}if(O){if(l=Ed(h,d,$,1)|0,m=A[z>>2]|0,l|0){ie=45;break}if(Ad(m,$)|0){if(S_(j,$),w_($,A[z>>2]|0)|0){ie=53;break}if(Rd(A[se>>2]|0,A[z>>2]|0,x)|0){ie=53;break}if(X_(A[se>>2]|0,A[z>>2]|0,j,$)|0){ie=53;break}}}}do if((_|0)<(A[J>>2]|0)){if(l=Ed(h,d,$,1)|0,m=A[z>>2]|0,l|0){ie=58;break t}if(!(Ad(m,$)|0)){ie=73;break}if(w_(A[z>>2]|0,$)|0&&(S_(j,$),Y_(A[se>>2]|0,A[z>>2]|0,j,$)|0)){ie=65;break t}if(h=U_(h,d,_+1|0,j)|0,h|0){ie=67;break t}d=j,h=A[d>>2]|0,d=A[d+4>>2]|0}else ie=73;while(!1);if((ie|0)==73&&(ie=0,h=W_(h,d)|0,d=k()|0),(h|0)==0&(d|0)==0){Ae=z;break e}}switch(ie|0){case 15:{l=A[z>>2]|0,l|0&&We(l),ie=u,A[ie>>2]=0,A[ie+4>>2]=0,A[se>>2]=0,A[J>>2]=-1,A[ue>>2]=0,A[z>>2]=0,A[u+8>>2]=m,ie=20;break}case 19:{A[u>>2]=h,A[u+4>>2]=d,ie=20;break}case 25:{tt(27795,27761,470,27772);break}case 29:{A[u>>2]=h,A[u+4>>2]=d,L=ne;return}case 32:{l=A[z>>2]|0,l|0&&We(l),Ae=u,A[Ae>>2]=0,A[Ae+4>>2]=0,A[se>>2]=0,A[J>>2]=-1,A[ue>>2]=0,A[z>>2]=0,A[u+8>>2]=m,L=ne;return}case 36:{tt(27795,27761,493,27772);break}case 42:{A[u>>2]=h,A[u+4>>2]=d,L=ne;return}case 45:{m|0&&We(m),ie=u,A[ie>>2]=0,A[ie+4>>2]=0,A[se>>2]=0,A[J>>2]=-1,A[ue>>2]=0,A[z>>2]=0,A[u+8>>2]=l,ie=55;break}case 53:{A[u>>2]=h,A[u+4>>2]=d,ie=55;break}case 58:{m|0&&We(m),ie=u,A[ie>>2]=0,A[ie+4>>2]=0,A[se>>2]=0,A[J>>2]=-1,A[ue>>2]=0,A[z>>2]=0,A[u+8>>2]=l,ie=71;break}case 65:{A[u>>2]=h,A[u+4>>2]=d,ie=71;break}case 67:{l=A[z>>2]|0,l|0&&We(l),Ae=u,A[Ae>>2]=0,A[Ae+4>>2]=0,A[se>>2]=0,A[J>>2]=-1,A[ue>>2]=0,A[z>>2]=0,A[u+8>>2]=h,L=ne;return}}if((ie|0)==20){L=ne;return}else if((ie|0)==55){L=ne;return}else if((ie|0)==71){L=ne;return}}while(!1);l=A[Ae>>2]|0,l|0&&We(l),ie=u,A[ie>>2]=0,A[ie+4>>2]=0,A[u+8>>2]=0,A[se>>2]=0,A[u+12>>2]=-1,A[ue>>2]=0,A[Ae>>2]=0,L=ne}function W_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0;O=L,L=L+16|0,M=O,d=ge(u|0,l|0,52)|0,k()|0,d=d&15,h=ge(u|0,l|0,45)|0,k()|0;do if(d){for(;h=Ee(d+4095|0,0,52)|0,m=k()|0|l&-15728641,_=(15-d|0)*3|0,y=Ee(7,0,_|0)|0,x=k()|0,h=h|u|y,m=m|x,w=ge(u|0,l|0,_|0)|0,k()|0,w=w&7,d=d+-1|0,!(w>>>0<6);)if(d)l=m,u=h;else{E=4;break}if((E|0)==4){h=ge(h|0,m|0,45)|0,k()|0;break}return M=(w|0)==0&(Qt(h,m)|0)!=0,M=Ee((M?2:1)+w|0,0,_|0)|0,E=k()|0|l&~x,M=M|u&~y,lt(E|0),L=O,M|0}while(!1);return h=h&127,h>>>0>120?(E=0,M=0,lt(E|0),L=O,M|0):(md(M,0,h+1|0,0),E=A[M+4>>2]|0,M=A[M>>2]|0,lt(E|0),L=O,M|0)}function UE(u,l,h,d,m,_){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0,_=_|0;var y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0;ie=L,L=L+160|0,O=ie+80|0,x=ie+64|0,z=ie+112|0,J=ie,kE(O,u,l,h),E=O,Td(x,A[E>>2]|0,A[E+4>>2]|0,l),E=x,w=A[E>>2]|0,E=A[E+4>>2]|0,y=A[O+8>>2]|0,$=z+4|0,A[$>>2]=A[O>>2],A[$+4>>2]=A[O+4>>2],A[$+8>>2]=A[O+8>>2],A[$+12>>2]=A[O+12>>2],A[$+16>>2]=A[O+16>>2],A[$+20>>2]=A[O+20>>2],A[$+24>>2]=A[O+24>>2],A[$+28>>2]=A[O+28>>2],$=J,A[$>>2]=w,A[$+4>>2]=E,$=J+8|0,A[$>>2]=y,u=J+12|0,l=z,h=u+36|0;do A[u>>2]=A[l>>2],u=u+4|0,l=l+4|0;while((u|0)<(h|0));if(z=J+48|0,A[z>>2]=A[x>>2],A[z+4>>2]=A[x+4>>2],A[z+8>>2]=A[x+8>>2],A[z+12>>2]=A[x+12>>2],(w|0)==0&(E|0)==0)return J=y,L=ie,J|0;h=J+16|0,M=J+24|0,O=J+28|0,y=0,x=0,l=w,u=E;do{if(!((y|0)<(m|0)|(y|0)==(m|0)&x>>>0<d>>>0)){j=4;break}if(E=x,x=He(x|0,y|0,1,0)|0,y=k()|0,E=_+(E<<3)|0,A[E>>2]=l,A[E+4>>2]=u,wd(z),u=z,l=A[u>>2]|0,u=A[u+4>>2]|0,(l|0)==0&(u|0)==0){if(pc(h),l=h,u=A[l>>2]|0,l=A[l+4>>2]|0,(u|0)==0&(l|0)==0){j=10;break}G_(u,l,A[O>>2]|0,z),u=z,l=A[u>>2]|0,u=A[u+4>>2]|0}E=J,A[E>>2]=l,A[E+4>>2]=u}while(!((l|0)==0&(u|0)==0));return(j|0)==4?(u=J+40|0,l=A[u>>2]|0,l|0&&We(l),j=J+16|0,A[j>>2]=0,A[j+4>>2]=0,A[M>>2]=0,A[J+36>>2]=0,A[O>>2]=-1,A[J+32>>2]=0,A[u>>2]=0,G_(0,0,0,z),A[J>>2]=0,A[J+4>>2]=0,A[$>>2]=0,J=14,L=ie,J|0):((j|0)==10&&(A[J>>2]=0,A[J+4>>2]=0,A[$>>2]=A[M>>2]),J=A[$>>2]|0,L=ie,J|0)}function qE(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0;if(O=L,L=L+48|0,w=O+32|0,x=O+40|0,E=O,!(A[u>>2]|0))return M=d,A[M>>2]=0,A[M+4>>2]=0,M=0,L=O,M|0;md(w,0,0,0),y=w,m=A[y>>2]|0,y=A[y+4>>2]|0;do if(l>>>0>15)M=E,A[M>>2]=0,A[M+4>>2]=0,A[E+8>>2]=4,A[E+12>>2]=-1,M=E+16|0,h=E+29|0,A[M>>2]=0,A[M+4>>2]=0,A[M+8>>2]=0,ve[M+12>>0]=0,ve[h>>0]=ve[x>>0]|0,ve[h+1>>0]=ve[x+1>>0]|0,ve[h+2>>0]=ve[x+2>>0]|0,h=4,M=9;else{if(h=bu(h)|0,h|0){w=E,A[w>>2]=0,A[w+4>>2]=0,A[E+8>>2]=h,A[E+12>>2]=-1,w=E+16|0,M=E+29|0,A[w>>2]=0,A[w+4>>2]=0,A[w+8>>2]=0,ve[w+12>>0]=0,ve[M>>0]=ve[x>>0]|0,ve[M+1>>0]=ve[x+1>>0]|0,ve[M+2>>0]=ve[x+2>>0]|0,M=9;break}if(h=Dr((A[u+8>>2]|0)+1|0,32)|0,!h){M=E,A[M>>2]=0,A[M+4>>2]=0,A[E+8>>2]=13,A[E+12>>2]=-1,M=E+16|0,h=E+29|0,A[M>>2]=0,A[M+4>>2]=0,A[M+8>>2]=0,ve[M+12>>0]=0,ve[h>>0]=ve[x>>0]|0,ve[h+1>>0]=ve[x+1>>0]|0,ve[h+2>>0]=ve[x+2>>0]|0,h=13,M=9;break}Nd(u,h),$=E,A[$>>2]=m,A[$+4>>2]=y,y=E+8|0,A[y>>2]=0,A[E+12>>2]=l,A[E+20>>2]=u,A[E+24>>2]=h,ve[E+28>>0]=0,m=E+29|0,ve[m>>0]=ve[x>>0]|0,ve[m+1>>0]=ve[x+1>>0]|0,ve[m+2>>0]=ve[x+2>>0]|0,A[E+16>>2]=3,z=+L7(h),z=z*+D7(h),_=+pt(+ +D[h>>3]),_=z/+Dt(+ +gc(+_,+ +pt(+ +D[h+8>>3])))*6371.007180918475*6371.007180918475,m=E+12|0,h=A[m>>2]|0;e:do if((h|0)>0)do{if(V_(h+-1|0,w)|0,!(_/+D[w>>3]>10))break e;$=A[m>>2]|0,h=$+-1|0,A[m>>2]=h}while(($|0)>1);while(!1);if(pc(E),m=d,A[m>>2]=0,A[m+4>>2]=0,m=E,h=A[m>>2]|0,m=A[m+4>>2]|0,!((h|0)==0&(m|0)==0))do _u(h,m,l,w)|0,x=w,u=d,x=He(A[u>>2]|0,A[u+4>>2]|0,A[x>>2]|0,A[x+4>>2]|0)|0,u=k()|0,$=d,A[$>>2]=x,A[$+4>>2]=u,pc(E),$=E,h=A[$>>2]|0,m=A[$+4>>2]|0;while(!((h|0)==0&(m|0)==0));h=A[y>>2]|0}while(!1);return $=h,L=O,$|0}function xu(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0;if(!(ud(l,h)|0)||(l=T_(l)|0,d=+D[h>>3],m=+D[h+8>>3],m=l&m<0?m+6.283185307179586:m,z=A[u>>2]|0,(z|0)<=0))return z=0,z|0;if(O=A[u+4>>2]|0,l){l=0,M=m,h=-1,u=0;e:for(;;){for(E=u;y=+D[O+(E<<4)>>3],m=+D[O+(E<<4)+8>>3],u=(h+2|0)%(z|0)|0,_=+D[O+(u<<4)>>3],x=+D[O+(u<<4)+8>>3],y>_?(w=y,y=x):(w=_,_=y,y=m,m=x),d=d==_|d==w?d+2220446049250313e-31:d,!!(d<_|d>w);)if(h=E+1|0,(h|0)>=(z|0)){h=22;break e}else u=E,E=h,h=u;if(x=y<0?y+6.283185307179586:y,y=m<0?m+6.283185307179586:m,M=x==M|y==M?M+-2220446049250313e-31:M,w=x+(y-x)*((d-_)/(w-_)),(w<0?w+6.283185307179586:w)>M&&(l=l^1),u=E+1|0,(u|0)>=(z|0)){h=22;break}else h=E}if((h|0)==22)return l|0}else{l=0,M=m,h=-1,u=0;e:for(;;){for(E=u;y=+D[O+(E<<4)>>3],m=+D[O+(E<<4)+8>>3],u=(h+2|0)%(z|0)|0,_=+D[O+(u<<4)>>3],x=+D[O+(u<<4)+8>>3],y>_?(w=y,y=x):(w=_,_=y,y=m,m=x),d=d==_|d==w?d+2220446049250313e-31:d,!!(d<_|d>w);)if(h=E+1|0,(h|0)>=(z|0)){h=22;break e}else u=E,E=h,h=u;if(M=y==M|m==M?M+-2220446049250313e-31:M,y+(m-y)*((d-_)/(w-_))>M&&(l=l^1),u=E+1|0,(u|0)>=(z|0)){h=22;break}else h=E}if((h|0)==22)return l|0}return 0}function Q_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0;if(j=A[u>>2]|0,!j){A[l>>2]=0,A[l+4>>2]=0,A[l+8>>2]=0,A[l+12>>2]=0,A[l+16>>2]=0,A[l+20>>2]=0,A[l+24>>2]=0,A[l+28>>2]=0;return}if(J=l+8|0,D[J>>3]=17976931348623157e292,ie=l+24|0,D[ie>>3]=17976931348623157e292,D[l>>3]=-17976931348623157e292,Ae=l+16|0,D[Ae>>3]=-17976931348623157e292,!((j|0)<=0)){for(z=A[u+4>>2]|0,E=17976931348623157e292,M=-17976931348623157e292,O=0,u=-1,_=17976931348623157e292,y=17976931348623157e292,w=-17976931348623157e292,d=-17976931348623157e292,$=0;h=+D[z+($<<4)>>3],x=+D[z+($<<4)+8>>3],u=u+2|0,m=+D[z+(((u|0)==(j|0)?0:u)<<4)+8>>3],h<_&&(D[J>>3]=h,_=h),x<y&&(D[ie>>3]=x,y=x),h>w?D[l>>3]=h:h=w,x>d&&(D[Ae>>3]=x,d=x),E=x>0&x<E?x:E,M=x<0&x>M?x:M,O=O|+pt(+(x-m))>3.141592653589793,u=$+1|0,(u|0)!=(j|0);)ue=$,w=h,$=u,u=ue;O&&(D[Ae>>3]=M,D[ie>>3]=E)}}function bu(u){return u=u|0,(u>>>0<4?0:15)|0}function Nd(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0,$e=0,ke=0;if(j=A[u>>2]|0,j){if(J=l+8|0,D[J>>3]=17976931348623157e292,ie=l+24|0,D[ie>>3]=17976931348623157e292,D[l>>3]=-17976931348623157e292,Ae=l+16|0,D[Ae>>3]=-17976931348623157e292,(j|0)>0){for(m=A[u+4>>2]|0,z=17976931348623157e292,$=-17976931348623157e292,d=0,h=-1,w=17976931348623157e292,E=17976931348623157e292,O=-17976931348623157e292,y=-17976931348623157e292,ue=0;_=+D[m+(ue<<4)>>3],M=+D[m+(ue<<4)+8>>3],$e=h+2|0,x=+D[m+((($e|0)==(j|0)?0:$e)<<4)+8>>3],_<w&&(D[J>>3]=_,w=_),M<E&&(D[ie>>3]=M,E=M),_>O?D[l>>3]=_:_=O,M>y&&(D[Ae>>3]=M,y=M),z=M>0&M<z?M:z,$=M<0&M>$?M:$,d=d|+pt(+(M-x))>3.141592653589793,h=ue+1|0,(h|0)!=(j|0);)$e=ue,O=_,ue=h,h=$e;d&&(D[Ae>>3]=$,D[ie>>3]=z)}}else A[l>>2]=0,A[l+4>>2]=0,A[l+8>>2]=0,A[l+12>>2]=0,A[l+16>>2]=0,A[l+20>>2]=0,A[l+24>>2]=0,A[l+28>>2]=0;if($e=u+8|0,h=A[$e>>2]|0,!((h|0)<=0)){Re=u+12|0,ne=0;do if(m=A[Re>>2]|0,d=ne,ne=ne+1|0,ie=l+(ne<<5)|0,Ae=A[m+(d<<3)>>2]|0,Ae){if(ue=l+(ne<<5)+8|0,D[ue>>3]=17976931348623157e292,u=l+(ne<<5)+24|0,D[u>>3]=17976931348623157e292,D[ie>>3]=-17976931348623157e292,se=l+(ne<<5)+16|0,D[se>>3]=-17976931348623157e292,(Ae|0)>0){for(j=A[m+(d<<3)+4>>2]|0,z=17976931348623157e292,$=-17976931348623157e292,m=0,d=-1,J=0,w=17976931348623157e292,E=17976931348623157e292,M=-17976931348623157e292,y=-17976931348623157e292;_=+D[j+(J<<4)>>3],O=+D[j+(J<<4)+8>>3],d=d+2|0,x=+D[j+(((d|0)==(Ae|0)?0:d)<<4)+8>>3],_<w&&(D[ue>>3]=_,w=_),O<E&&(D[u>>3]=O,E=O),_>M?D[ie>>3]=_:_=M,O>y&&(D[se>>3]=O,y=O),z=O>0&O<z?O:z,$=O<0&O>$?O:$,m=m|+pt(+(O-x))>3.141592653589793,d=J+1|0,(d|0)!=(Ae|0);)ke=J,J=d,M=_,d=ke;m&&(D[se>>3]=$,D[u>>3]=z)}}else A[ie>>2]=0,A[ie+4>>2]=0,A[ie+8>>2]=0,A[ie+12>>2]=0,A[ie+16>>2]=0,A[ie+20>>2]=0,A[ie+24>>2]=0,A[ie+28>>2]=0,h=A[$e>>2]|0;while((ne|0)<(h|0))}}function Rd(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0;if(!(xu(u,l,h)|0))return m=0,m|0;if(m=u+8|0,(A[m>>2]|0)<=0)return m=1,m|0;for(d=u+12|0,u=0;;){if(_=u,u=u+1|0,xu((A[d>>2]|0)+(_<<3)|0,l+(u<<5)|0,h)|0){u=0,d=6;break}if((u|0)>=(A[m>>2]|0)){u=1,d=6;break}}return(d|0)==6?u|0:0}function Y_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0;if(E=L,L=L+16|0,x=E,y=h+8|0,!(xu(u,l,y)|0))return w=0,L=E,w|0;w=u+8|0;e:do if((A[w>>2]|0)>0){for(_=u+12|0,m=0;;){if(M=m,m=m+1|0,xu((A[_>>2]|0)+(M<<3)|0,l+(m<<5)|0,y)|0){m=0;break}if((m|0)>=(A[w>>2]|0))break e}return L=E,m|0}while(!1);if(mc(u,l,h,d)|0)return M=0,L=E,M|0;A[x>>2]=A[h>>2],A[x+4>>2]=y,m=A[w>>2]|0;e:do if((m|0)>0)for(u=u+12|0,y=0,_=m;;){if(m=A[u>>2]|0,(A[m+(y<<3)>>2]|0)>0){if(xu(x,d,A[m+(y<<3)+4>>2]|0)|0){m=0;break e}if(m=y+1|0,mc((A[u>>2]|0)+(y<<3)|0,l+(m<<5)|0,h,d)|0){m=0;break e}_=A[w>>2]|0}else m=y+1|0;if((m|0)<(_|0))y=m;else{m=1;break}}else m=1;while(!1);return M=m,L=E,M|0}function mc(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0,$e=0,ke=0,at=0;if($e=L,L=L+176|0,ue=$e+172|0,m=$e+168|0,se=$e,!(Ad(l,d)|0))return u=0,L=$e,u|0;if(F7(l,d,ue,m),sl(se|0,h|0,168)|0,(A[h>>2]|0)>0){l=0;do ke=se+8+(l<<4)+8|0,Ae=+Wr(+D[ke>>3],A[m>>2]|0),D[ke>>3]=Ae,l=l+1|0;while((l|0)<(A[h>>2]|0))}J=+D[d>>3],ie=+D[d+8>>3],Ae=+Wr(+D[d+16>>3],A[m>>2]|0),$=+Wr(+D[d+24>>3],A[m>>2]|0);e:do if((A[u>>2]|0)>0){if(d=u+4|0,m=A[se>>2]|0,(m|0)<=0){for(l=0;;)if(l=l+1|0,(l|0)>=(A[u>>2]|0)){l=0;break e}}for(h=0;;){if(l=A[d>>2]|0,z=+D[l+(h<<4)>>3],j=+Wr(+D[l+(h<<4)+8>>3],A[ue>>2]|0),l=A[d>>2]|0,h=h+1|0,ke=(h|0)%(A[u>>2]|0)|0,_=+D[l+(ke<<4)>>3],y=+Wr(+D[l+(ke<<4)+8>>3],A[ue>>2]|0),!(z>=J)|!(_>=J)&&!(z<=ie)|!(_<=ie)&&!(j<=$)|!(y<=$)&&!(j>=Ae)|!(y>=Ae)){O=_-z,E=y-j,l=0;do if(at=l,l=l+1|0,ke=(l|0)==(m|0)?0:l,_=+D[se+8+(at<<4)+8>>3],y=+D[se+8+(ke<<4)+8>>3]-_,x=+D[se+8+(at<<4)>>3],w=+D[se+8+(ke<<4)>>3]-x,M=O*y-E*w,M!=0&&(ne=j-_,Re=z-x,w=(ne*w-y*Re)/M,!(w<0|w>1))&&(M=(O*ne-E*Re)/M,M>=0&M<=1)){l=1;break e}while((l|0)<(m|0))}if((h|0)>=(A[u>>2]|0)){l=0;break}}}else l=0;while(!1);return at=l,L=$e,at|0}function X_(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0;if(mc(u,l,h,d)|0)return _=1,_|0;if(_=u+8|0,(A[_>>2]|0)<=0)return _=0,_|0;for(m=u+12|0,u=0;;){if(y=u,u=u+1|0,mc((A[m>>2]|0)+(y<<3)|0,l+(u<<5)|0,h,d)|0){u=1,m=6;break}if((u|0)>=(A[_>>2]|0)){u=0,m=6;break}}return(m|0)==6?u|0:0}function GE(){return 8}function VE(){return 16}function zE(){return 168}function $E(){return 8}function jE(){return 16}function HE(){return 12}function WE(){return 8}function QE(u){return u=u|0,+(+((A[u>>2]|0)>>>0)+4294967296*+(A[u+4>>2]|0))}function YE(u){u=u|0;var l=0,h=0;return h=+D[u>>3],l=+D[u+8>>3],+ +Mt(+(h*h+l*l))}function K_(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0;E=+D[u>>3],w=+D[l>>3]-E,x=+D[u+8>>3],y=+D[l+8>>3]-x,O=+D[h>>3],_=+D[d>>3]-O,z=+D[h+8>>3],M=+D[d+8>>3]-z,_=(_*(x-z)-(E-O)*M)/(w*M-y*_),D[m>>3]=E+w*_,D[m+8>>3]=x+y*_}function Z_(u,l){return u=u|0,l=l|0,+pt(+(+D[u>>3]-+D[l>>3]))<11920928955078125e-23?(l=+pt(+(+D[u+8>>3]-+D[l+8>>3]))<11920928955078125e-23,l|0):(l=0,l|0)}function Bn(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;return m=+D[u>>3]-+D[l>>3],d=+D[u+8>>3]-+D[l+8>>3],h=+D[u+16>>3]-+D[l+16>>3],+(m*m+d*d+h*h)}function XE(u,l){u=u|0,l=l|0;var h=0,d=0,m=0;h=+D[u>>3],d=+Dt(+h),h=+mt(+h),D[l+16>>3]=h,h=+D[u+8>>3],m=d*+Dt(+h),D[l>>3]=m,h=d*+mt(+h),D[l+8>>3]=h}function KE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0;if(_=L,L=L+16|0,m=_,d=Qt(u,l)|0,(h+-1|0)>>>0>5||(d=(d|0)!=0,(h|0)==1&d))return m=-1,L=_,m|0;do if(Tu(u,l,m)|0)d=-1;else if(d){d=((A[26352+(h<<2)>>2]|0)+5-(A[m>>2]|0)|0)%5|0;break}else{d=((A[26384+(h<<2)>>2]|0)+6-(A[m>>2]|0)|0)%6|0;break}while(!1);return m=d,L=_,m|0}function Tu(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0;if(M=L,L=L+32|0,x=M+16|0,w=M,d=el(u,l,x)|0,d|0)return h=d,L=M,h|0;_=I_(u,l)|0,E=Br(u,l)|0,C7(_,w),d=M7(_,A[x>>2]|0)|0;do if(rn(_)|0){do switch(_|0){case 4:{m=0;break}case 14:{m=1;break}case 24:{m=2;break}case 38:{m=3;break}case 49:{m=4;break}case 58:{m=5;break}case 63:{m=6;break}case 72:{m=7;break}case 83:{m=8;break}case 97:{m=9;break}case 107:{m=10;break}case 117:{m=11;break}default:tt(27795,27797,75,27806)}while(!1);if(y=A[26416+(m*24|0)+8>>2]|0,l=A[26416+(m*24|0)+16>>2]|0,u=A[x>>2]|0,(u|0)!=(A[w>>2]|0)&&(w=od(_)|0,u=A[x>>2]|0,w|(u|0)==(l|0)&&(d=(d+1|0)%6|0)),(E|0)==3&(u|0)==(l|0)){d=(d+5|0)%6|0;break}(E|0)==5&(u|0)==(y|0)&&(d=(d+1|0)%6|0)}while(!1);return A[h>>2]=d,h=0,L=M,h|0}function hi(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0;if(se=L,L=L+32|0,ue=se+24|0,ie=se+20|0,j=se+8|0,$=se+16|0,z=se,w=(Qt(u,l)|0)==0,w=w?6:5,M=ge(u|0,l|0,52)|0,k()|0,M=M&15,w>>>0<=h>>>0)return d=2,L=se,d|0;O=(M|0)==0,!O&&(J=Ee(7,0,(M^15)*3|0)|0,(J&u|0)==0&((k()|0)&l|0)==0)?m=h:_=4;e:do if((_|0)==4){if(m=(Qt(u,l)|0)!=0,((m?4:5)|0)<(h|0)||Tu(u,l,ue)|0||(_=(A[ue>>2]|0)+h|0,m?m=26704+(((_|0)%5|0)<<2)|0:m=26736+(((_|0)%6|0)<<2)|0,J=A[m>>2]|0,(J|0)==7))return d=1,L=se,d|0;A[ie>>2]=0,m=jn(u,l,J,ie,j)|0;do if(!m){if(x=j,E=A[x>>2]|0,x=A[x+4>>2]|0,y=x>>>0<l>>>0|(x|0)==(l|0)&E>>>0<u>>>0,_=y?E:u,y=y?x:l,!O&&(O=Ee(7,0,(M^15)*3|0)|0,(E&O|0)==0&(x&(k()|0)|0)==0))m=h;else{if(x=(h+-1+w|0)%(w|0)|0,m=Qt(u,l)|0,(x|0)<0&&tt(27795,27797,248,27822),w=(m|0)!=0,((w?4:5)|0)<(x|0)&&tt(27795,27797,248,27822),Tu(u,l,ue)|0&&tt(27795,27797,248,27822),m=(A[ue>>2]|0)+x|0,w?m=26704+(((m|0)%5|0)<<2)|0:m=26736+(((m|0)%6|0)<<2)|0,x=A[m>>2]|0,(x|0)==7&&tt(27795,27797,248,27822),A[$>>2]=0,m=jn(u,l,x,$,z)|0,m|0)break;E=z,w=A[E>>2]|0,E=A[E+4>>2]|0;do if(E>>>0<y>>>0|(E|0)==(y|0)&w>>>0<_>>>0){if(Qt(w,E)|0?_=sd(w,E,u,l)|0:_=A[26800+((((A[$>>2]|0)+(A[26768+(x<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,m=Qt(w,E)|0,(_+-1|0)>>>0>5){m=-1,_=w,y=E;break}if(m=(m|0)!=0,(_|0)==1&m){m=-1,_=w,y=E;break}do if(Tu(w,E,ue)|0)m=-1;else if(m){m=((A[26352+(_<<2)>>2]|0)+5-(A[ue>>2]|0)|0)%5|0;break}else{m=((A[26384+(_<<2)>>2]|0)+6-(A[ue>>2]|0)|0)%6|0;break}while(!1);_=w,y=E}else m=h;while(!1);x=j,E=A[x>>2]|0,x=A[x+4>>2]|0}if((_|0)==(E|0)&(y|0)==(x|0)){if(w=(Qt(E,x)|0)!=0,w?u=sd(E,x,u,l)|0:u=A[26800+((((A[ie>>2]|0)+(A[26768+(J<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,m=Qt(E,x)|0,(u+-1|0)>>>0<=5&&(Ae=(m|0)!=0,!((u|0)==1&Ae)))do if(Tu(E,x,ue)|0)m=-1;else if(Ae){m=((A[26352+(u<<2)>>2]|0)+5-(A[ue>>2]|0)|0)%5|0;break}else{m=((A[26384+(u<<2)>>2]|0)+6-(A[ue>>2]|0)|0)%6|0;break}while(!1);else m=-1;m=m+1|0,m=(m|0)==6|w&(m|0)==5?0:m}l=y,u=_;break e}while(!1);return d=m,L=se,d|0}while(!1);return Ae=Ee(m|0,0,56)|0,ue=k()|0|l&-2130706433|536870912,A[d>>2]=Ae|u,A[d+4>>2]=ue,d=0,L=se,d|0}function ZE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0;return _=(Qt(u,l)|0)==0,d=hi(u,l,0,h)|0,m=(d|0)==0,_?!m||(d=hi(u,l,1,h+8|0)|0,d|0)||(d=hi(u,l,2,h+16|0)|0,d|0)||(d=hi(u,l,3,h+24|0)|0,d|0)||(d=hi(u,l,4,h+32|0)|0,d)?(_=d,_|0):hi(u,l,5,h+40|0)|0:!m||(d=hi(u,l,1,h+8|0)|0,d|0)||(d=hi(u,l,2,h+16|0)|0,d|0)||(d=hi(u,l,3,h+24|0)|0,d|0)||(d=hi(u,l,4,h+32|0)|0,d|0)?(_=d,_|0):(_=h+40|0,A[_>>2]=0,A[_+4>>2]=0,_=0,_|0)}function JE(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0,x=0,w=0;return w=L,L=L+192|0,m=w,_=w+168|0,y=ge(u|0,l|0,56)|0,k()|0,y=y&7,x=l&-2130706433|134217728,d=el(u,x,_)|0,d|0?(x=d,L=w,x|0):(l=ge(u|0,l|0,52)|0,k()|0,l=l&15,Qt(u,x)|0?fd(_,l,y,1,m):dd(_,l,y,1,m),x=m+8|0,A[h>>2]=A[x>>2],A[h+4>>2]=A[x+4>>2],A[h+8>>2]=A[x+8>>2],A[h+12>>2]=A[x+12>>2],x=0,L=w,x|0)}function J_(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0;return m=L,L=L+16|0,h=m,!(!0&(l&2013265920|0)==536870912)||(d=l&-2130706433|134217728,!(pd(u,d)|0))?(d=0,L=m,d|0):(_=ge(u|0,l|0,56)|0,k()|0,_=(hi(u,d,_&7,h)|0)==0,d=h,d=_&((A[d>>2]|0)==(u|0)?(A[d+4>>2]|0)==(l|0):0)&1,L=m,d|0)}function ey(u,l,h){u=u|0,l=l|0,h=h|0;var d=0;(l|0)>0?(d=Dr(l,4)|0,A[u>>2]=d,d||tt(27835,27858,40,27872)):A[u>>2]=0,A[u+4>>2]=l,A[u+8>>2]=0,A[u+12>>2]=h}function ty(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0;m=u+4|0,_=u+12|0,y=u+8|0;e:for(;;){for(h=A[m>>2]|0,l=0;;){if((l|0)>=(h|0))break e;if(d=A[u>>2]|0,x=A[d+(l<<2)>>2]|0,!x)l=l+1|0;else break}l=d+(~~(+pt(+(+co(10,+ +(15-(A[_>>2]|0)|0))*(+D[x>>3]+ +D[x+8>>3])))%+(h|0))>>>0<<2)|0,h=A[l>>2]|0;t:do if(h|0){if(d=x+32|0,(h|0)==(x|0))A[l>>2]=A[d>>2];else{if(h=h+32|0,l=A[h>>2]|0,!l)break;for(;(l|0)!=(x|0);)if(h=l+32|0,l=A[h>>2]|0,!l)break t;A[h>>2]=A[d>>2]}We(x),A[y>>2]=(A[y>>2]|0)+-1}while(!1)}We(A[u>>2]|0)}function ny(u){u=u|0;var l=0,h=0,d=0;for(d=A[u+4>>2]|0,h=0;;){if((h|0)>=(d|0)){l=0,h=4;break}if(l=A[(A[u>>2]|0)+(h<<2)>>2]|0,!l)h=h+1|0;else{h=4;break}}return(h|0)==4?l|0:0}function ry(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0;if(h=~~(+pt(+(+co(10,+ +(15-(A[u+12>>2]|0)|0))*(+D[l>>3]+ +D[l+8>>3])))%+(A[u+4>>2]|0))>>>0,h=(A[u>>2]|0)+(h<<2)|0,d=A[h>>2]|0,!d)return _=1,_|0;_=l+32|0;do if((d|0)!=(l|0)){if(h=A[d+32>>2]|0,!h)return _=1,_|0;for(m=h;;){if((m|0)==(l|0)){m=8;break}if(h=A[m+32>>2]|0,h)d=m,m=h;else{h=1,m=10;break}}if((m|0)==8){A[d+32>>2]=A[_>>2];break}else if((m|0)==10)return h|0}else A[h>>2]=A[_>>2];while(!1);return We(l),_=u+8|0,A[_>>2]=(A[_>>2]|0)+-1,_=0,_|0}function eN(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0;_=Ji(40)|0,_||tt(27888,27858,98,27901),A[_>>2]=A[l>>2],A[_+4>>2]=A[l+4>>2],A[_+8>>2]=A[l+8>>2],A[_+12>>2]=A[l+12>>2],m=_+16|0,A[m>>2]=A[h>>2],A[m+4>>2]=A[h+4>>2],A[m+8>>2]=A[h+8>>2],A[m+12>>2]=A[h+12>>2],A[_+32>>2]=0,m=~~(+pt(+(+co(10,+ +(15-(A[u+12>>2]|0)|0))*(+D[l>>3]+ +D[l+8>>3])))%+(A[u+4>>2]|0))>>>0,m=(A[u>>2]|0)+(m<<2)|0,d=A[m>>2]|0;do if(!d)A[m>>2]=_;else{for(;!(nl(d,l)|0&&nl(d+16|0,h)|0);)if(m=A[d+32>>2]|0,d=(m|0)==0?d:m,!(A[d+32>>2]|0)){y=10;break}if((y|0)==10){A[d+32>>2]=_;break}return We(_),y=d,y|0}while(!1);return y=u+8|0,A[y>>2]=(A[y>>2]|0)+1,y=_,y|0}function tN(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0;if(m=~~(+pt(+(+co(10,+ +(15-(A[u+12>>2]|0)|0))*(+D[l>>3]+ +D[l+8>>3])))%+(A[u+4>>2]|0))>>>0,m=A[(A[u>>2]|0)+(m<<2)>>2]|0,!m)return h=0,h|0;if(!h){for(u=m;;){if(nl(u,l)|0){d=10;break}if(u=A[u+32>>2]|0,!u){u=0,d=10;break}}if((d|0)==10)return u|0}for(u=m;;){if(nl(u,l)|0&&nl(u+16|0,h)|0){d=10;break}if(u=A[u+32>>2]|0,!u){u=0,d=10;break}}return(d|0)==10?u|0:0}function nN(u,l){u=u|0,l=l|0;var h=0;if(h=~~(+pt(+(+co(10,+ +(15-(A[u+12>>2]|0)|0))*(+D[l>>3]+ +D[l+8>>3])))%+(A[u+4>>2]|0))>>>0,u=A[(A[u>>2]|0)+(h<<2)>>2]|0,!u)return h=0,h|0;for(;;){if(nl(u,l)|0){l=5;break}if(u=A[u+32>>2]|0,!u){u=0,l=5;break}}return(l|0)==5?u|0:0}function rN(){return 27920}function po(u){return u=+u,~~+ay(+u)|0}function Ji(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0,J=0,ie=0,Ae=0,ue=0,se=0,ne=0,Re=0;Re=L,L=L+16|0,z=Re;do if(u>>>0<245){if(E=u>>>0<11?16:u+11&-8,u=E>>>3,O=A[6981]|0,h=O>>>u,h&3|0)return l=(h&1^1)+u|0,u=27964+(l<<1<<2)|0,h=u+8|0,d=A[h>>2]|0,m=d+8|0,_=A[m>>2]|0,(_|0)==(u|0)?A[6981]=O&~(1<<l):(A[_+12>>2]=u,A[h>>2]=_),ne=l<<3,A[d+4>>2]=ne|3,ne=d+ne+4|0,A[ne>>2]=A[ne>>2]|1,ne=m,L=Re,ne|0;if(M=A[6983]|0,E>>>0>M>>>0){if(h|0)return l=2<<u,l=h<<u&(l|0-l),l=(l&0-l)+-1|0,x=l>>>12&16,l=l>>>x,h=l>>>5&8,l=l>>>h,_=l>>>2&4,l=l>>>_,u=l>>>1&2,l=l>>>u,d=l>>>1&1,d=(h|x|_|u|d)+(l>>>d)|0,l=27964+(d<<1<<2)|0,u=l+8|0,_=A[u>>2]|0,x=_+8|0,h=A[x>>2]|0,(h|0)==(l|0)?(u=O&~(1<<d),A[6981]=u):(A[h+12>>2]=l,A[u>>2]=h,u=O),ne=d<<3,y=ne-E|0,A[_+4>>2]=E|3,m=_+E|0,A[m+4>>2]=y|1,A[_+ne>>2]=y,M|0&&(d=A[6986]|0,l=M>>>3,h=27964+(l<<1<<2)|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=d,A[l+12>>2]=d,A[d+8>>2]=l,A[d+12>>2]=h),A[6983]=y,A[6986]=m,ne=x,L=Re,ne|0;if(_=A[6982]|0,_){for(h=(_&0-_)+-1|0,m=h>>>12&16,h=h>>>m,d=h>>>5&8,h=h>>>d,y=h>>>2&4,h=h>>>y,x=h>>>1&2,h=h>>>x,w=h>>>1&1,w=A[28228+((d|m|y|x|w)+(h>>>w)<<2)>>2]|0,h=w,x=w,w=(A[w+4>>2]&-8)-E|0;u=A[h+16>>2]|0,!(!u&&(u=A[h+20>>2]|0,!u));)y=(A[u+4>>2]&-8)-E|0,m=y>>>0<w>>>0,h=u,x=m?u:x,w=m?y:w;if(y=x+E|0,y>>>0>x>>>0){m=A[x+24>>2]|0,l=A[x+12>>2]|0;do if((l|0)==(x|0)){if(u=x+20|0,l=A[u>>2]|0,!l&&(u=x+16|0,l=A[u>>2]|0,!l)){h=0;break}for(;;)if(d=l+20|0,h=A[d>>2]|0,h)l=h,u=d;else if(d=l+16|0,h=A[d>>2]|0,h)l=h,u=d;else break;A[u>>2]=0,h=l}else h=A[x+8>>2]|0,A[h+12>>2]=l,A[l+8>>2]=h,h=l;while(!1);do if(m|0){if(l=A[x+28>>2]|0,u=28228+(l<<2)|0,(x|0)==(A[u>>2]|0)){if(A[u>>2]=h,!h){A[6982]=_&~(1<<l);break}}else if(ne=m+16|0,A[((A[ne>>2]|0)==(x|0)?ne:m+20|0)>>2]=h,!h)break;A[h+24>>2]=m,l=A[x+16>>2]|0,l|0&&(A[h+16>>2]=l,A[l+24>>2]=h),l=A[x+20>>2]|0,l|0&&(A[h+20>>2]=l,A[l+24>>2]=h)}while(!1);return w>>>0<16?(ne=w+E|0,A[x+4>>2]=ne|3,ne=x+ne+4|0,A[ne>>2]=A[ne>>2]|1):(A[x+4>>2]=E|3,A[y+4>>2]=w|1,A[y+w>>2]=w,M|0&&(d=A[6986]|0,l=M>>>3,h=27964+(l<<1<<2)|0,l=1<<l,l&O?(u=h+8|0,l=A[u>>2]|0):(A[6981]=l|O,l=h,u=h+8|0),A[u>>2]=d,A[l+12>>2]=d,A[d+8>>2]=l,A[d+12>>2]=h),A[6983]=w,A[6986]=y),ne=x+8|0,L=Re,ne|0}else O=E}else O=E}else O=E}else if(u>>>0<=4294967231)if(u=u+11|0,E=u&-8,d=A[6982]|0,d){m=0-E|0,u=u>>>8,u?E>>>0>16777215?w=31:(O=(u+1048320|0)>>>16&8,J=u<<O,x=(J+520192|0)>>>16&4,J=J<<x,w=(J+245760|0)>>>16&2,w=14-(x|O|w)+(J<<w>>>15)|0,w=E>>>(w+7|0)&1|w<<1):w=0,h=A[28228+(w<<2)>>2]|0;e:do if(!h)h=0,u=0,J=61;else for(u=0,x=E<<((w|0)==31?0:25-(w>>>1)|0),_=0;;){if(y=(A[h+4>>2]&-8)-E|0,y>>>0<m>>>0)if(y)u=h,m=y;else{u=h,m=0,J=65;break e}if(J=A[h+20>>2]|0,h=A[h+16+(x>>>31<<2)>>2]|0,_=(J|0)==0|(J|0)==(h|0)?_:J,h)x=x<<1;else{h=_,J=61;break}}while(!1);if((J|0)==61){if((h|0)==0&(u|0)==0){if(u=2<<w,u=(u|0-u)&d,!u){O=E;break}O=(u&0-u)+-1|0,y=O>>>12&16,O=O>>>y,_=O>>>5&8,O=O>>>_,x=O>>>2&4,O=O>>>x,w=O>>>1&2,O=O>>>w,h=O>>>1&1,u=0,h=A[28228+((_|y|x|w|h)+(O>>>h)<<2)>>2]|0}h?J=65:(x=u,y=m)}if((J|0)==65)for(_=h;;)if(O=(A[_+4>>2]&-8)-E|0,h=O>>>0<m>>>0,m=h?O:m,u=h?_:u,h=A[_+16>>2]|0,h||(h=A[_+20>>2]|0),h)_=h;else{x=u,y=m;break}if((x|0)!=0&&y>>>0<((A[6983]|0)-E|0)>>>0&&(M=x+E|0,M>>>0>x>>>0)){_=A[x+24>>2]|0,l=A[x+12>>2]|0;do if((l|0)==(x|0)){if(u=x+20|0,l=A[u>>2]|0,!l&&(u=x+16|0,l=A[u>>2]|0,!l)){l=0;break}for(;;)if(m=l+20|0,h=A[m>>2]|0,h)l=h,u=m;else if(m=l+16|0,h=A[m>>2]|0,h)l=h,u=m;else break;A[u>>2]=0}else ne=A[x+8>>2]|0,A[ne+12>>2]=l,A[l+8>>2]=ne;while(!1);do if(_){if(u=A[x+28>>2]|0,h=28228+(u<<2)|0,(x|0)==(A[h>>2]|0)){if(A[h>>2]=l,!l){d=d&~(1<<u),A[6982]=d;break}}else if(ne=_+16|0,A[((A[ne>>2]|0)==(x|0)?ne:_+20|0)>>2]=l,!l)break;A[l+24>>2]=_,u=A[x+16>>2]|0,u|0&&(A[l+16>>2]=u,A[u+24>>2]=l),u=A[x+20>>2]|0,u&&(A[l+20>>2]=u,A[u+24>>2]=l)}while(!1);e:do if(y>>>0<16)ne=y+E|0,A[x+4>>2]=ne|3,ne=x+ne+4|0,A[ne>>2]=A[ne>>2]|1;else{if(A[x+4>>2]=E|3,A[M+4>>2]=y|1,A[M+y>>2]=y,l=y>>>3,y>>>0<256){h=27964+(l<<1<<2)|0,u=A[6981]|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=M,A[l+12>>2]=M,A[M+8>>2]=l,A[M+12>>2]=h;break}if(l=y>>>8,l?y>>>0>16777215?h=31:(se=(l+1048320|0)>>>16&8,ne=l<<se,ue=(ne+520192|0)>>>16&4,ne=ne<<ue,h=(ne+245760|0)>>>16&2,h=14-(ue|se|h)+(ne<<h>>>15)|0,h=y>>>(h+7|0)&1|h<<1):h=0,l=28228+(h<<2)|0,A[M+28>>2]=h,u=M+16|0,A[u+4>>2]=0,A[u>>2]=0,u=1<<h,!(d&u)){A[6982]=d|u,A[l>>2]=M,A[M+24>>2]=l,A[M+12>>2]=M,A[M+8>>2]=M;break}l=A[l>>2]|0;t:do if((A[l+4>>2]&-8|0)!=(y|0)){for(d=y<<((h|0)==31?0:25-(h>>>1)|0);h=l+16+(d>>>31<<2)|0,u=A[h>>2]|0,!!u;)if((A[u+4>>2]&-8|0)==(y|0)){l=u;break t}else d=d<<1,l=u;A[h>>2]=M,A[M+24>>2]=l,A[M+12>>2]=M,A[M+8>>2]=M;break e}while(!1);se=l+8|0,ne=A[se>>2]|0,A[ne+12>>2]=M,A[se>>2]=M,A[M+8>>2]=ne,A[M+12>>2]=l,A[M+24>>2]=0}while(!1);return ne=x+8|0,L=Re,ne|0}else O=E}else O=E;else O=-1;while(!1);if(h=A[6983]|0,h>>>0>=O>>>0)return l=h-O|0,u=A[6986]|0,l>>>0>15?(ne=u+O|0,A[6986]=ne,A[6983]=l,A[ne+4>>2]=l|1,A[u+h>>2]=l,A[u+4>>2]=O|3):(A[6983]=0,A[6986]=0,A[u+4>>2]=h|3,ne=u+h+4|0,A[ne>>2]=A[ne>>2]|1),ne=u+8|0,L=Re,ne|0;if(y=A[6984]|0,y>>>0>O>>>0)return ue=y-O|0,A[6984]=ue,ne=A[6987]|0,se=ne+O|0,A[6987]=se,A[se+4>>2]=ue|1,A[ne+4>>2]=O|3,ne=ne+8|0,L=Re,ne|0;if(A[7099]|0?u=A[7101]|0:(A[7101]=4096,A[7100]=4096,A[7102]=-1,A[7103]=-1,A[7104]=0,A[7092]=0,A[7099]=z&-16^1431655768,u=4096),x=O+48|0,w=O+47|0,_=u+w|0,m=0-u|0,E=_&m,E>>>0<=O>>>0||(u=A[7091]|0,u|0&&(M=A[7089]|0,z=M+E|0,z>>>0<=M>>>0|z>>>0>u>>>0)))return ne=0,L=Re,ne|0;e:do if(A[7092]&4)l=0,J=143;else{h=A[6987]|0;t:do if(h){for(d=28372;z=A[d>>2]|0,!(z>>>0<=h>>>0&&(z+(A[d+4>>2]|0)|0)>>>0>h>>>0);)if(u=A[d+8>>2]|0,u)d=u;else{J=128;break t}if(l=_-y&m,l>>>0<2147483647)if(u=_o(l|0)|0,(u|0)==((A[d>>2]|0)+(A[d+4>>2]|0)|0)){if((u|0)!=-1){y=l,_=u,J=145;break e}}else d=u,J=136;else l=0}else J=128;while(!1);do if((J|0)==128)if(h=_o(0)|0,(h|0)!=-1&&(l=h,$=A[7100]|0,j=$+-1|0,l=((j&l|0)==0?0:(j+l&0-$)-l|0)+E|0,$=A[7089]|0,j=l+$|0,l>>>0>O>>>0&l>>>0<2147483647)){if(z=A[7091]|0,z|0&&j>>>0<=$>>>0|j>>>0>z>>>0){l=0;break}if(u=_o(l|0)|0,(u|0)==(h|0)){y=l,_=h,J=145;break e}else d=u,J=136}else l=0;while(!1);do if((J|0)==136){if(h=0-l|0,!(x>>>0>l>>>0&(l>>>0<2147483647&(d|0)!=-1)))if((d|0)==-1){l=0;break}else{y=l,_=d,J=145;break e}if(u=A[7101]|0,u=w-l+u&0-u,u>>>0>=2147483647){y=l,_=d,J=145;break e}if((_o(u|0)|0)==-1){_o(h|0)|0,l=0;break}else{y=u+l|0,_=d,J=145;break e}}while(!1);A[7092]=A[7092]|4,J=143}while(!1);if((J|0)==143&&E>>>0<2147483647&&(ue=_o(E|0)|0,j=_o(0)|0,ie=j-ue|0,Ae=ie>>>0>(O+40|0)>>>0,!((ue|0)==-1|Ae^1|ue>>>0<j>>>0&((ue|0)!=-1&(j|0)!=-1)^1))&&(y=Ae?ie:l,_=ue,J=145),(J|0)==145){l=(A[7089]|0)+y|0,A[7089]=l,l>>>0>(A[7090]|0)>>>0&&(A[7090]=l),w=A[6987]|0;e:do if(w){for(l=28372;;){if(u=A[l>>2]|0,h=A[l+4>>2]|0,(_|0)==(u+h|0)){J=154;break}if(d=A[l+8>>2]|0,d)l=d;else break}if((J|0)==154&&(se=l+4|0,(A[l+12>>2]&8|0)==0)&&_>>>0>w>>>0&u>>>0<=w>>>0){A[se>>2]=h+y,ne=(A[6984]|0)+y|0,ue=w+8|0,ue=(ue&7|0)==0?0:0-ue&7,se=w+ue|0,ue=ne-ue|0,A[6987]=se,A[6984]=ue,A[se+4>>2]=ue|1,A[w+ne+4>>2]=40,A[6988]=A[7103];break}for(_>>>0<(A[6985]|0)>>>0&&(A[6985]=_),h=_+y|0,l=28372;;){if((A[l>>2]|0)==(h|0)){J=162;break}if(u=A[l+8>>2]|0,u)l=u;else break}if((J|0)==162&&(A[l+12>>2]&8|0)==0){A[l>>2]=_,M=l+4|0,A[M>>2]=(A[M>>2]|0)+y,M=_+8|0,M=_+((M&7|0)==0?0:0-M&7)|0,l=h+8|0,l=h+((l&7|0)==0?0:0-l&7)|0,E=M+O|0,x=l-M-O|0,A[M+4>>2]=O|3;t:do if((w|0)==(l|0))ne=(A[6984]|0)+x|0,A[6984]=ne,A[6987]=E,A[E+4>>2]=ne|1;else{if((A[6986]|0)==(l|0)){ne=(A[6983]|0)+x|0,A[6983]=ne,A[6986]=E,A[E+4>>2]=ne|1,A[E+ne>>2]=ne;break}if(u=A[l+4>>2]|0,(u&3|0)==1){y=u&-8,d=u>>>3;n:do if(u>>>0<256)if(u=A[l+8>>2]|0,h=A[l+12>>2]|0,(h|0)==(u|0)){A[6981]=A[6981]&~(1<<d);break}else{A[u+12>>2]=h,A[h+8>>2]=u;break}else{_=A[l+24>>2]|0,u=A[l+12>>2]|0;do if((u|0)==(l|0)){if(h=l+16|0,d=h+4|0,u=A[d>>2]|0,u)h=d;else if(u=A[h>>2]|0,!u){u=0;break}for(;;)if(m=u+20|0,d=A[m>>2]|0,d)u=d,h=m;else if(m=u+16|0,d=A[m>>2]|0,d)u=d,h=m;else break;A[h>>2]=0}else ne=A[l+8>>2]|0,A[ne+12>>2]=u,A[u+8>>2]=ne;while(!1);if(!_)break;h=A[l+28>>2]|0,d=28228+(h<<2)|0;do if((A[d>>2]|0)!=(l|0)){if(ne=_+16|0,A[((A[ne>>2]|0)==(l|0)?ne:_+20|0)>>2]=u,!u)break n}else{if(A[d>>2]=u,u|0)break;A[6982]=A[6982]&~(1<<h);break n}while(!1);if(A[u+24>>2]=_,h=l+16|0,d=A[h>>2]|0,d|0&&(A[u+16>>2]=d,A[d+24>>2]=u),h=A[h+4>>2]|0,!h)break;A[u+20>>2]=h,A[h+24>>2]=u}while(!1);l=l+y|0,m=y+x|0}else m=x;if(l=l+4|0,A[l>>2]=A[l>>2]&-2,A[E+4>>2]=m|1,A[E+m>>2]=m,l=m>>>3,m>>>0<256){h=27964+(l<<1<<2)|0,u=A[6981]|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=E,A[l+12>>2]=E,A[E+8>>2]=l,A[E+12>>2]=h;break}l=m>>>8;do if(!l)d=0;else{if(m>>>0>16777215){d=31;break}se=(l+1048320|0)>>>16&8,ne=l<<se,ue=(ne+520192|0)>>>16&4,ne=ne<<ue,d=(ne+245760|0)>>>16&2,d=14-(ue|se|d)+(ne<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1}while(!1);if(l=28228+(d<<2)|0,A[E+28>>2]=d,u=E+16|0,A[u+4>>2]=0,A[u>>2]=0,u=A[6982]|0,h=1<<d,!(u&h)){A[6982]=u|h,A[l>>2]=E,A[E+24>>2]=l,A[E+12>>2]=E,A[E+8>>2]=E;break}l=A[l>>2]|0;n:do if((A[l+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);h=l+16+(d>>>31<<2)|0,u=A[h>>2]|0,!!u;)if((A[u+4>>2]&-8|0)==(m|0)){l=u;break n}else d=d<<1,l=u;A[h>>2]=E,A[E+24>>2]=l,A[E+12>>2]=E,A[E+8>>2]=E;break t}while(!1);se=l+8|0,ne=A[se>>2]|0,A[ne+12>>2]=E,A[se>>2]=E,A[E+8>>2]=ne,A[E+12>>2]=l,A[E+24>>2]=0}while(!1);return ne=M+8|0,L=Re,ne|0}for(l=28372;u=A[l>>2]|0,!(u>>>0<=w>>>0&&(ne=u+(A[l+4>>2]|0)|0,ne>>>0>w>>>0));)l=A[l+8>>2]|0;m=ne+-47|0,u=m+8|0,u=m+((u&7|0)==0?0:0-u&7)|0,m=w+16|0,u=u>>>0<m>>>0?w:u,l=u+8|0,h=y+-40|0,ue=_+8|0,ue=(ue&7|0)==0?0:0-ue&7,se=_+ue|0,ue=h-ue|0,A[6987]=se,A[6984]=ue,A[se+4>>2]=ue|1,A[_+h+4>>2]=40,A[6988]=A[7103],h=u+4|0,A[h>>2]=27,A[l>>2]=A[7093],A[l+4>>2]=A[7094],A[l+8>>2]=A[7095],A[l+12>>2]=A[7096],A[7093]=_,A[7094]=y,A[7096]=0,A[7095]=l,l=u+24|0;do se=l,l=l+4|0,A[l>>2]=7;while((se+8|0)>>>0<ne>>>0);if((u|0)!=(w|0)){if(_=u-w|0,A[h>>2]=A[h>>2]&-2,A[w+4>>2]=_|1,A[u>>2]=_,l=_>>>3,_>>>0<256){h=27964+(l<<1<<2)|0,u=A[6981]|0,l=1<<l,u&l?(u=h+8|0,l=A[u>>2]|0):(A[6981]=u|l,l=h,u=h+8|0),A[u>>2]=w,A[l+12>>2]=w,A[w+8>>2]=l,A[w+12>>2]=h;break}if(l=_>>>8,l?_>>>0>16777215?d=31:(se=(l+1048320|0)>>>16&8,ne=l<<se,ue=(ne+520192|0)>>>16&4,ne=ne<<ue,d=(ne+245760|0)>>>16&2,d=14-(ue|se|d)+(ne<<d>>>15)|0,d=_>>>(d+7|0)&1|d<<1):d=0,h=28228+(d<<2)|0,A[w+28>>2]=d,A[w+20>>2]=0,A[m>>2]=0,l=A[6982]|0,u=1<<d,!(l&u)){A[6982]=l|u,A[h>>2]=w,A[w+24>>2]=h,A[w+12>>2]=w,A[w+8>>2]=w;break}l=A[h>>2]|0;t:do if((A[l+4>>2]&-8|0)!=(_|0)){for(d=_<<((d|0)==31?0:25-(d>>>1)|0);h=l+16+(d>>>31<<2)|0,u=A[h>>2]|0,!!u;)if((A[u+4>>2]&-8|0)==(_|0)){l=u;break t}else d=d<<1,l=u;A[h>>2]=w,A[w+24>>2]=l,A[w+12>>2]=w,A[w+8>>2]=w;break e}while(!1);se=l+8|0,ne=A[se>>2]|0,A[ne+12>>2]=w,A[se>>2]=w,A[w+8>>2]=ne,A[w+12>>2]=l,A[w+24>>2]=0}}else ne=A[6985]|0,(ne|0)==0|_>>>0<ne>>>0&&(A[6985]=_),A[7093]=_,A[7094]=y,A[7096]=0,A[6990]=A[7099],A[6989]=-1,A[6994]=27964,A[6993]=27964,A[6996]=27972,A[6995]=27972,A[6998]=27980,A[6997]=27980,A[7e3]=27988,A[6999]=27988,A[7002]=27996,A[7001]=27996,A[7004]=28004,A[7003]=28004,A[7006]=28012,A[7005]=28012,A[7008]=28020,A[7007]=28020,A[7010]=28028,A[7009]=28028,A[7012]=28036,A[7011]=28036,A[7014]=28044,A[7013]=28044,A[7016]=28052,A[7015]=28052,A[7018]=28060,A[7017]=28060,A[7020]=28068,A[7019]=28068,A[7022]=28076,A[7021]=28076,A[7024]=28084,A[7023]=28084,A[7026]=28092,A[7025]=28092,A[7028]=28100,A[7027]=28100,A[7030]=28108,A[7029]=28108,A[7032]=28116,A[7031]=28116,A[7034]=28124,A[7033]=28124,A[7036]=28132,A[7035]=28132,A[7038]=28140,A[7037]=28140,A[7040]=28148,A[7039]=28148,A[7042]=28156,A[7041]=28156,A[7044]=28164,A[7043]=28164,A[7046]=28172,A[7045]=28172,A[7048]=28180,A[7047]=28180,A[7050]=28188,A[7049]=28188,A[7052]=28196,A[7051]=28196,A[7054]=28204,A[7053]=28204,A[7056]=28212,A[7055]=28212,ne=y+-40|0,ue=_+8|0,ue=(ue&7|0)==0?0:0-ue&7,se=_+ue|0,ue=ne-ue|0,A[6987]=se,A[6984]=ue,A[se+4>>2]=ue|1,A[_+ne+4>>2]=40,A[6988]=A[7103];while(!1);if(l=A[6984]|0,l>>>0>O>>>0)return ue=l-O|0,A[6984]=ue,ne=A[6987]|0,se=ne+O|0,A[6987]=se,A[se+4>>2]=ue|1,A[ne+4>>2]=O|3,ne=ne+8|0,L=Re,ne|0}return ne=rN()|0,A[ne>>2]=12,ne=0,L=Re,ne|0}function We(u){u=u|0;var l=0,h=0,d=0,m=0,_=0,y=0,x=0,w=0;if(u){h=u+-8|0,m=A[6985]|0,u=A[u+-4>>2]|0,l=u&-8,w=h+l|0;do if(u&1)x=h,y=h;else{if(d=A[h>>2]|0,!(u&3)||(y=h+(0-d)|0,_=d+l|0,y>>>0<m>>>0))return;if((A[6986]|0)==(y|0)){if(u=w+4|0,l=A[u>>2]|0,(l&3|0)!=3){x=y,l=_;break}A[6983]=_,A[u>>2]=l&-2,A[y+4>>2]=_|1,A[y+_>>2]=_;return}if(h=d>>>3,d>>>0<256)if(u=A[y+8>>2]|0,l=A[y+12>>2]|0,(l|0)==(u|0)){A[6981]=A[6981]&~(1<<h),x=y,l=_;break}else{A[u+12>>2]=l,A[l+8>>2]=u,x=y,l=_;break}m=A[y+24>>2]|0,u=A[y+12>>2]|0;do if((u|0)==(y|0)){if(l=y+16|0,h=l+4|0,u=A[h>>2]|0,u)l=h;else if(u=A[l>>2]|0,!u){u=0;break}for(;;)if(d=u+20|0,h=A[d>>2]|0,h)u=h,l=d;else if(d=u+16|0,h=A[d>>2]|0,h)u=h,l=d;else break;A[l>>2]=0}else x=A[y+8>>2]|0,A[x+12>>2]=u,A[u+8>>2]=x;while(!1);if(m){if(l=A[y+28>>2]|0,h=28228+(l<<2)|0,(A[h>>2]|0)==(y|0)){if(A[h>>2]=u,!u){A[6982]=A[6982]&~(1<<l),x=y,l=_;break}}else if(x=m+16|0,A[((A[x>>2]|0)==(y|0)?x:m+20|0)>>2]=u,!u){x=y,l=_;break}A[u+24>>2]=m,l=y+16|0,h=A[l>>2]|0,h|0&&(A[u+16>>2]=h,A[h+24>>2]=u),l=A[l+4>>2]|0,l?(A[u+20>>2]=l,A[l+24>>2]=u,x=y,l=_):(x=y,l=_)}else x=y,l=_}while(!1);if(!(y>>>0>=w>>>0)&&(u=w+4|0,d=A[u>>2]|0,!!(d&1))){if(d&2)A[u>>2]=d&-2,A[x+4>>2]=l|1,A[y+l>>2]=l,m=l;else{if((A[6987]|0)==(w|0)){if(w=(A[6984]|0)+l|0,A[6984]=w,A[6987]=x,A[x+4>>2]=w|1,(x|0)!=(A[6986]|0))return;A[6986]=0,A[6983]=0;return}if((A[6986]|0)==(w|0)){w=(A[6983]|0)+l|0,A[6983]=w,A[6986]=y,A[x+4>>2]=w|1,A[y+w>>2]=w;return}m=(d&-8)+l|0,h=d>>>3;do if(d>>>0<256)if(l=A[w+8>>2]|0,u=A[w+12>>2]|0,(u|0)==(l|0)){A[6981]=A[6981]&~(1<<h);break}else{A[l+12>>2]=u,A[u+8>>2]=l;break}else{_=A[w+24>>2]|0,u=A[w+12>>2]|0;do if((u|0)==(w|0)){if(l=w+16|0,h=l+4|0,u=A[h>>2]|0,u)l=h;else if(u=A[l>>2]|0,!u){h=0;break}for(;;)if(d=u+20|0,h=A[d>>2]|0,h)u=h,l=d;else if(d=u+16|0,h=A[d>>2]|0,h)u=h,l=d;else break;A[l>>2]=0,h=u}else h=A[w+8>>2]|0,A[h+12>>2]=u,A[u+8>>2]=h,h=u;while(!1);if(_|0){if(u=A[w+28>>2]|0,l=28228+(u<<2)|0,(A[l>>2]|0)==(w|0)){if(A[l>>2]=h,!h){A[6982]=A[6982]&~(1<<u);break}}else if(d=_+16|0,A[((A[d>>2]|0)==(w|0)?d:_+20|0)>>2]=h,!h)break;A[h+24>>2]=_,u=w+16|0,l=A[u>>2]|0,l|0&&(A[h+16>>2]=l,A[l+24>>2]=h),u=A[u+4>>2]|0,u|0&&(A[h+20>>2]=u,A[u+24>>2]=h)}}while(!1);if(A[x+4>>2]=m|1,A[y+m>>2]=m,(x|0)==(A[6986]|0)){A[6983]=m;return}}if(u=m>>>3,m>>>0<256){h=27964+(u<<1<<2)|0,l=A[6981]|0,u=1<<u,l&u?(l=h+8|0,u=A[l>>2]|0):(A[6981]=l|u,u=h,l=h+8|0),A[l>>2]=x,A[u+12>>2]=x,A[x+8>>2]=u,A[x+12>>2]=h;return}u=m>>>8,u?m>>>0>16777215?d=31:(y=(u+1048320|0)>>>16&8,w=u<<y,_=(w+520192|0)>>>16&4,w=w<<_,d=(w+245760|0)>>>16&2,d=14-(_|y|d)+(w<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1):d=0,u=28228+(d<<2)|0,A[x+28>>2]=d,A[x+20>>2]=0,A[x+16>>2]=0,l=A[6982]|0,h=1<<d;e:do if(!(l&h))A[6982]=l|h,A[u>>2]=x,A[x+24>>2]=u,A[x+12>>2]=x,A[x+8>>2]=x;else{u=A[u>>2]|0;t:do if((A[u+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);h=u+16+(d>>>31<<2)|0,l=A[h>>2]|0,!!l;)if((A[l+4>>2]&-8|0)==(m|0)){u=l;break t}else d=d<<1,u=l;A[h>>2]=x,A[x+24>>2]=u,A[x+12>>2]=x,A[x+8>>2]=x;break e}while(!1);y=u+8|0,w=A[y>>2]|0,A[w+12>>2]=x,A[y>>2]=x,A[x+8>>2]=w,A[x+12>>2]=u,A[x+24>>2]=0}while(!1);if(w=(A[6989]|0)+-1|0,A[6989]=w,!(w|0)){for(u=28380;u=A[u>>2]|0,u;)u=u+8|0;A[6989]=-1}}}}function Dr(u,l){u=u|0,l=l|0;var h=0;return u?(h=Ki(l,u)|0,(l|u)>>>0>65535&&(h=((h>>>0)/(u>>>0)|0|0)==(l|0)?h:-1)):h=0,u=Ji(h)|0,!u||!(A[u+-4>>2]&3)||go(u|0,0,h|0)|0,u|0}function He(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,h=u+h>>>0,lt(l+d+(h>>>0<u>>>0|0)>>>0|0),h|0|0}function Hn(u,l,h,d){return u=u|0,l=l|0,h=h|0,d=d|0,d=l-d-(h>>>0>u>>>0|0)>>>0,lt(d|0),u-h>>>0|0|0}function iy(u){return u=u|0,(u?31-(Ls(u^u-1)|0)|0:32)|0}function Cd(u,l,h,d,m){u=u|0,l=l|0,h=h|0,d=d|0,m=m|0;var _=0,y=0,x=0,w=0,E=0,M=0,O=0,z=0,$=0,j=0;if(M=u,w=l,E=w,y=h,z=d,x=z,!E)return _=(m|0)!=0,x?_?(A[m>>2]=u|0,A[m+4>>2]=l&0,z=0,m=0,lt(z|0),m|0):(z=0,m=0,lt(z|0),m|0):(_&&(A[m>>2]=(M>>>0)%(y>>>0),A[m+4>>2]=0),z=0,m=(M>>>0)/(y>>>0)>>>0,lt(z|0),m|0);_=(x|0)==0;do if(y){if(!_){if(_=(Ls(x|0)|0)-(Ls(E|0)|0)|0,_>>>0<=31){O=_+1|0,x=31-_|0,l=_-31>>31,y=O,u=M>>>(O>>>0)&l|E<<x,l=E>>>(O>>>0)&l,_=0,x=M<<x;break}return m?(A[m>>2]=u|0,A[m+4>>2]=w|l&0,z=0,m=0,lt(z|0),m|0):(z=0,m=0,lt(z|0),m|0)}if(_=y-1|0,_&y|0){x=(Ls(y|0)|0)+33-(Ls(E|0)|0)|0,j=64-x|0,O=32-x|0,w=O>>31,$=x-32|0,l=$>>31,y=x,u=O-1>>31&E>>>($>>>0)|(E<<O|M>>>(x>>>0))&l,l=l&E>>>(x>>>0),_=M<<j&w,x=(E<<j|M>>>($>>>0))&w|M<<O&x-33>>31;break}return m|0&&(A[m>>2]=_&M,A[m+4>>2]=0),(y|0)==1?($=w|l&0,j=u|0|0,lt($|0),j|0):(j=iy(y|0)|0,$=E>>>(j>>>0)|0,j=E<<32-j|M>>>(j>>>0)|0,lt($|0),j|0)}else{if(_)return m|0&&(A[m>>2]=(E>>>0)%(y>>>0),A[m+4>>2]=0),$=0,j=(E>>>0)/(y>>>0)>>>0,lt($|0),j|0;if(!M)return m|0&&(A[m>>2]=0,A[m+4>>2]=(E>>>0)%(x>>>0)),$=0,j=(E>>>0)/(x>>>0)>>>0,lt($|0),j|0;if(_=x-1|0,!(_&x))return m|0&&(A[m>>2]=u|0,A[m+4>>2]=_&E|l&0),$=0,j=E>>>((iy(x|0)|0)>>>0),lt($|0),j|0;if(_=(Ls(x|0)|0)-(Ls(E|0)|0)|0,_>>>0<=30){l=_+1|0,x=31-_|0,y=l,u=E<<x|M>>>(l>>>0),l=E>>>(l>>>0),_=0,x=M<<x;break}return m?(A[m>>2]=u|0,A[m+4>>2]=w|l&0,$=0,j=0,lt($|0),j|0):($=0,j=0,lt($|0),j|0)}while(!1);if(!y)E=x,w=0,x=0;else{O=h|0|0,M=z|d&0,E=He(O|0,M|0,-1,-1)|0,h=k()|0,w=x,x=0;do d=w,w=_>>>31|w<<1,_=x|_<<1,d=u<<1|d>>>31|0,z=u>>>31|l<<1|0,Hn(E|0,h|0,d|0,z|0)|0,j=k()|0,$=j>>31|((j|0)<0?-1:0)<<1,x=$&1,u=Hn(d|0,z|0,$&O|0,(((j|0)<0?-1:0)>>31|((j|0)<0?-1:0)<<1)&M|0)|0,l=k()|0,y=y-1|0;while((y|0)!=0);E=w,w=0}return y=0,m|0&&(A[m>>2]=u,A[m+4>>2]=l),$=(_|0)>>>31|(E|y)<<1|(y<<1|_>>>31)&0|w,j=(_<<1|0)&-2|x,lt($|0),j|0}function mo(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0;return E=l>>31|((l|0)<0?-1:0)<<1,w=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,_=d>>31|((d|0)<0?-1:0)<<1,m=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,x=Hn(E^u|0,w^l|0,E|0,w|0)|0,y=k()|0,u=_^E,l=m^w,Hn((Cd(x,y,Hn(_^h|0,m^d|0,_|0,m|0)|0,k()|0,0)|0)^u|0,(k()|0)^l|0,u|0,l|0)|0}function iN(u,l){u=u|0,l=l|0;var h=0,d=0,m=0,_=0;return _=u&65535,m=l&65535,h=Ki(m,_)|0,d=u>>>16,u=(h>>>16)+(Ki(m,d)|0)|0,m=l>>>16,l=Ki(m,_)|0,lt((u>>>16)+(Ki(m,d)|0)+(((u&65535)+l|0)>>>16)|0),u+l<<16|h&65535|0|0}function Wn(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0;return m=u,_=h,h=iN(m,_)|0,u=k()|0,lt((Ki(l,_)|0)+(Ki(d,m)|0)+u|u&0|0),h|0|0|0}function rl(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0,y=0,x=0,w=0,E=0;return m=L,L=L+16|0,x=m|0,y=l>>31|((l|0)<0?-1:0)<<1,_=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,E=d>>31|((d|0)<0?-1:0)<<1,w=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,u=Hn(y^u|0,_^l|0,y|0,_|0)|0,l=k()|0,Cd(u,l,Hn(E^h|0,w^d|0,E|0,w|0)|0,k()|0,x)|0,d=Hn(A[x>>2]^y|0,A[x+4>>2]^_|0,y|0,_|0)|0,h=k()|0,L=m,lt(h|0),d|0}function il(u,l,h,d){u=u|0,l=l|0,h=h|0,d=d|0;var m=0,_=0;return _=L,L=L+16|0,m=_|0,Cd(u,l,h,d,m)|0,L=_,lt(A[m+4>>2]|0),A[m>>2]|0|0}function sy(u,l,h){return u=u|0,l=l|0,h=h|0,(h|0)<32?(lt(l>>h|0),u>>>h|(l&(1<<h)-1)<<32-h):(lt(((l|0)<0?-1:0)|0),l>>h-32|0)}function ge(u,l,h){return u=u|0,l=l|0,h=h|0,(h|0)<32?(lt(l>>>h|0),u>>>h|(l&(1<<h)-1)<<32-h):(lt(0),l>>>h-32|0)}function Ee(u,l,h){return u=u|0,l=l|0,h=h|0,(h|0)<32?(lt(l<<h|(u&(1<<h)-1<<32-h)>>>32-h|0),u<<h):(lt(u<<h-32|0),0)}function Md(u,l,h){return u=u|0,l=l|0,l=Ls(l)|0,(l|0)==32&&(l=l+(Ls(u)|0)|0),lt(0),l|0}function oy(u,l){return u=+u,l=+l,u!=u?+l:l!=l?+u:+c7(+u,+l)}function gc(u,l){return u=+u,l=+l,u!=u?+l:l!=l?+u:+id(+u,+l)}function _c(u){return u=+u,u>=0?+$n(u+.5):+Za(u-.5)}function sl(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0;if((h|0)>=8192)return f7(u|0,l|0,h|0)|0,u|0;if(_=u|0,m=u+h|0,(u&3)==(l&3)){for(;u&3;){if(!h)return _|0;ve[u>>0]=ve[l>>0]|0,u=u+1|0,l=l+1|0,h=h-1|0}for(h=m&-4|0,d=h-64|0;(u|0)<=(d|0);)A[u>>2]=A[l>>2],A[u+4>>2]=A[l+4>>2],A[u+8>>2]=A[l+8>>2],A[u+12>>2]=A[l+12>>2],A[u+16>>2]=A[l+16>>2],A[u+20>>2]=A[l+20>>2],A[u+24>>2]=A[l+24>>2],A[u+28>>2]=A[l+28>>2],A[u+32>>2]=A[l+32>>2],A[u+36>>2]=A[l+36>>2],A[u+40>>2]=A[l+40>>2],A[u+44>>2]=A[l+44>>2],A[u+48>>2]=A[l+48>>2],A[u+52>>2]=A[l+52>>2],A[u+56>>2]=A[l+56>>2],A[u+60>>2]=A[l+60>>2],u=u+64|0,l=l+64|0;for(;(u|0)<(h|0);)A[u>>2]=A[l>>2],u=u+4|0,l=l+4|0}else for(h=m-4|0;(u|0)<(h|0);)ve[u>>0]=ve[l>>0]|0,ve[u+1>>0]=ve[l+1>>0]|0,ve[u+2>>0]=ve[l+2>>0]|0,ve[u+3>>0]=ve[l+3>>0]|0,u=u+4|0,l=l+4|0;for(;(u|0)<(m|0);)ve[u>>0]=ve[l>>0]|0,u=u+1|0,l=l+1|0;return _|0}function go(u,l,h){u=u|0,l=l|0,h=h|0;var d=0,m=0,_=0,y=0;if(_=u+h|0,l=l&255,(h|0)>=67){for(;u&3;)ve[u>>0]=l,u=u+1|0;for(d=_&-4|0,y=l|l<<8|l<<16|l<<24,m=d-64|0;(u|0)<=(m|0);)A[u>>2]=y,A[u+4>>2]=y,A[u+8>>2]=y,A[u+12>>2]=y,A[u+16>>2]=y,A[u+20>>2]=y,A[u+24>>2]=y,A[u+28>>2]=y,A[u+32>>2]=y,A[u+36>>2]=y,A[u+40>>2]=y,A[u+44>>2]=y,A[u+48>>2]=y,A[u+52>>2]=y,A[u+56>>2]=y,A[u+60>>2]=y,u=u+64|0;for(;(u|0)<(d|0);)A[u>>2]=y,u=u+4|0}for(;(u|0)<(_|0);)ve[u>>0]=l,u=u+1|0;return _-h|0}function ay(u){return u=+u,u>=0?+$n(u+.5):+Za(u-.5)}function _o(u){u=u|0;var l=0,h=0,d=0;return d=h7()|0,h=A[kt>>2]|0,l=h+u|0,(u|0)>0&(l|0)<(h|0)|(l|0)<0?(p7(l|0)|0,p_(12),-1):(l|0)>(d|0)&&!(d7(l|0)|0)?(p_(12),-1):(A[kt>>2]=l,h|0)}return{___divdi3:mo,___muldi3:Wn,___remdi3:rl,___uremdi3:il,_areNeighborCells:H7,_bitshift64Ashr:sy,_bitshift64Lshr:ge,_bitshift64Shl:Ee,_calloc:Dr,_cellAreaKm2:SE,_cellAreaM2:EE,_cellAreaRads2:Sd,_cellToBoundary:tl,_cellToCenterChild:U_,_cellToChildPos:mE,_cellToChildren:aE,_cellToChildrenSize:_u,_cellToLatLng:aa,_cellToLocalIj:DE,_cellToParent:gd,_cellToVertex:hi,_cellToVertexes:ZE,_cellsToDirectedEdge:W7,_cellsToLinkedMultiPolygon:N7,_childPosToCell:gE,_compactCells:lE,_constructCell:sE,_destroyLinkedMultiPolygon:$_,_directedEdgeToBoundary:fc,_directedEdgeToCells:X7,_edgeLengthKm:RE,_edgeLengthM:CE,_edgeLengthRads:NE,_emscripten_replace_memory:m7,_free:We,_getBaseCellNumber:I_,_getDirectedEdgeDestination:Y7,_getDirectedEdgeOrigin:Q7,_getHexagonAreaAvgKm2:V_,_getHexagonAreaAvgM2:bE,_getHexagonEdgeLengthAvgKm:TE,_getHexagonEdgeLengthAvgM:wE,_getIcosahedronFaces:q_,_getIndexDigit:iE,_getNumCells:dc,_getPentagons:bd,_getRes0Cells:B7,_getResolution:rE,_greatCircleDistanceKm:vu,_greatCircleDistanceM:yE,_greatCircleDistanceRads:_E,_gridDisk:m_,_gridDiskDistances:g_,_gridDistance:FE,_gridPathCells:IE,_gridPathCellsSize:OE,_gridRing:b7,_gridRingUnsafe:y_,_i64Add:He,_i64Subtract:Hn,_isPentagon:Qt,_isResClassIII:cE,_isValidCell:pd,_isValidDirectedEdge:L_,_isValidIndex:oE,_isValidVertex:J_,_latLngToCell:vd,_llvm_ctlz_i64:Md,_llvm_maxnum_f64:oy,_llvm_minnum_f64:gc,_llvm_round_f64:_c,_localIjToCell:LE,_malloc:Ji,_maxFaceCount:dE,_maxGridDiskSize:x7,_maxPolygonToCellsSize:w7,_maxPolygonToCellsSizeExperimental:qE,_memcpy:sl,_memset:go,_originToDirectedEdges:K7,_pentagonCount:pE,_polygonToCells:S7,_polygonToCellsExperimental:UE,_readInt64AsDoubleFromPointer:QE,_res0CellCount:P7,_round:ay,_sbrk:_o,_sizeOfCellBoundary:zE,_sizeOfCoordIJ:WE,_sizeOfGeoLoop:$E,_sizeOfGeoPolygon:jE,_sizeOfH3Index:GE,_sizeOfLatLng:VE,_sizeOfLinkedGeoPolygon:HE,_uncompactCells:uE,_uncompactCellsSize:AE,_vertexToLatLng:JE,establishStackSpace:v7,stackAlloc:g7,stackRestore:y7,stackSave:_7}})(s7,o7,W);e.___divdi3=Se.___divdi3,e.___muldi3=Se.___muldi3,e.___remdi3=Se.___remdi3,e.___uremdi3=Se.___uremdi3,e._areNeighborCells=Se._areNeighborCells,e._bitshift64Ashr=Se._bitshift64Ashr,e._bitshift64Lshr=Se._bitshift64Lshr,e._bitshift64Shl=Se._bitshift64Shl,e._calloc=Se._calloc,e._cellAreaKm2=Se._cellAreaKm2,e._cellAreaM2=Se._cellAreaM2,e._cellAreaRads2=Se._cellAreaRads2,e._cellToBoundary=Se._cellToBoundary,e._cellToCenterChild=Se._cellToCenterChild,e._cellToChildPos=Se._cellToChildPos,e._cellToChildren=Se._cellToChildren,e._cellToChildrenSize=Se._cellToChildrenSize,e._cellToLatLng=Se._cellToLatLng,e._cellToLocalIj=Se._cellToLocalIj,e._cellToParent=Se._cellToParent,e._cellToVertex=Se._cellToVertex,e._cellToVertexes=Se._cellToVertexes,e._cellsToDirectedEdge=Se._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=Se._cellsToLinkedMultiPolygon,e._childPosToCell=Se._childPosToCell,e._compactCells=Se._compactCells,e._constructCell=Se._constructCell,e._destroyLinkedMultiPolygon=Se._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=Se._directedEdgeToBoundary,e._directedEdgeToCells=Se._directedEdgeToCells,e._edgeLengthKm=Se._edgeLengthKm,e._edgeLengthM=Se._edgeLengthM,e._edgeLengthRads=Se._edgeLengthRads;var a7=e._emscripten_replace_memory=Se._emscripten_replace_memory;e._free=Se._free,e._getBaseCellNumber=Se._getBaseCellNumber,e._getDirectedEdgeDestination=Se._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=Se._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=Se._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=Se._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=Se._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=Se._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=Se._getIcosahedronFaces,e._getIndexDigit=Se._getIndexDigit,e._getNumCells=Se._getNumCells,e._getPentagons=Se._getPentagons,e._getRes0Cells=Se._getRes0Cells,e._getResolution=Se._getResolution,e._greatCircleDistanceKm=Se._greatCircleDistanceKm,e._greatCircleDistanceM=Se._greatCircleDistanceM,e._greatCircleDistanceRads=Se._greatCircleDistanceRads,e._gridDisk=Se._gridDisk,e._gridDiskDistances=Se._gridDiskDistances,e._gridDistance=Se._gridDistance,e._gridPathCells=Se._gridPathCells,e._gridPathCellsSize=Se._gridPathCellsSize,e._gridRing=Se._gridRing,e._gridRingUnsafe=Se._gridRingUnsafe,e._i64Add=Se._i64Add,e._i64Subtract=Se._i64Subtract,e._isPentagon=Se._isPentagon,e._isResClassIII=Se._isResClassIII,e._isValidCell=Se._isValidCell,e._isValidDirectedEdge=Se._isValidDirectedEdge,e._isValidIndex=Se._isValidIndex,e._isValidVertex=Se._isValidVertex,e._latLngToCell=Se._latLngToCell,e._llvm_ctlz_i64=Se._llvm_ctlz_i64,e._llvm_maxnum_f64=Se._llvm_maxnum_f64,e._llvm_minnum_f64=Se._llvm_minnum_f64,e._llvm_round_f64=Se._llvm_round_f64,e._localIjToCell=Se._localIjToCell,e._malloc=Se._malloc,e._maxFaceCount=Se._maxFaceCount,e._maxGridDiskSize=Se._maxGridDiskSize,e._maxPolygonToCellsSize=Se._maxPolygonToCellsSize,e._maxPolygonToCellsSizeExperimental=Se._maxPolygonToCellsSizeExperimental,e._memcpy=Se._memcpy,e._memset=Se._memset,e._originToDirectedEdges=Se._originToDirectedEdges,e._pentagonCount=Se._pentagonCount,e._polygonToCells=Se._polygonToCells,e._polygonToCellsExperimental=Se._polygonToCellsExperimental,e._readInt64AsDoubleFromPointer=Se._readInt64AsDoubleFromPointer,e._res0CellCount=Se._res0CellCount,e._round=Se._round,e._sbrk=Se._sbrk,e._sizeOfCellBoundary=Se._sizeOfCellBoundary,e._sizeOfCoordIJ=Se._sizeOfCoordIJ,e._sizeOfGeoLoop=Se._sizeOfGeoLoop,e._sizeOfGeoPolygon=Se._sizeOfGeoPolygon,e._sizeOfH3Index=Se._sizeOfH3Index,e._sizeOfLatLng=Se._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=Se._sizeOfLinkedGeoPolygon,e._uncompactCells=Se._uncompactCells,e._uncompactCellsSize=Se._uncompactCellsSize,e._vertexToLatLng=Se._vertexToLatLng,e.establishStackSpace=Se.establishStackSpace;var c_=e.stackAlloc=Se.stackAlloc,l7=e.stackRestore=Se.stackRestore,u7=e.stackSave=Se.stackSave;if(e.asm=Se,e.cwrap=B,e.setValue=b,e.getValue=T,Ds){u_(Ds)||(Ds=s(Ds));{QS();var td=function(ce){ce.byteLength&&(ce=new Uint8Array(ce)),re.set(ce,v),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,YS()},h_=function(){o(Ds,td,function(){throw"could not load memory initializer "+Ds})},f_=ed(Ds);if(f_)td(f_.buffer);else if(e.memoryInitializerRequest){var d_=function(){var ce=e.memoryInitializerRequest,_e=ce.response;if(ce.status!==200&&ce.status!==0){var Fe=ed(e.memoryInitializerRequestURL);if(Fe)_e=Fe.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+ce.status+", retrying "+Ds),h_();return}}td(_e)};e.memoryInitializerRequest.response?setTimeout(d_,0):e.memoryInitializerRequest.addEventListener("load",d_)}else h_()}}var lc;Pi=function ce(){lc||nd(),lc||(Pi=ce)};function nd(ce){if(li>0||(tn(),li>0))return;function _e(){lc||(lc=!0,!S&&(ur(),Zn(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),yr()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),_e()},1)):_e()}e.run=nd;function Ka(ce){throw e.onAbort&&e.onAbort(ce),ce+="",a(ce),c(ce),S=!0,"abort("+ce+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Ka,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return nd(),n})(typeof Et=="object"?Et:{}),Xe="number",Ye=Xe,fl=Xe,nt=Xe,rt=Xe,Qn=Xe,Ie=Xe,qD=[["sizeOfH3Index",Xe],["sizeOfLatLng",Xe],["sizeOfCellBoundary",Xe],["sizeOfGeoLoop",Xe],["sizeOfGeoPolygon",Xe],["sizeOfLinkedGeoPolygon",Xe],["sizeOfCoordIJ",Xe],["readInt64AsDoubleFromPointer",Xe],["isValidCell",fl,[nt,rt]],["isValidIndex",fl,[nt,rt]],["latLngToCell",Ye,[Xe,Xe,Qn,Ie]],["cellToLatLng",Ye,[nt,rt,Ie]],["cellToBoundary",Ye,[nt,rt,Ie]],["maxGridDiskSize",Ye,[Xe,Ie]],["gridDisk",Ye,[nt,rt,Xe,Ie]],["gridDiskDistances",Ye,[nt,rt,Xe,Ie,Ie]],["gridRing",Ye,[nt,rt,Xe,Ie]],["gridRingUnsafe",Ye,[nt,rt,Xe,Ie]],["maxPolygonToCellsSize",Ye,[Ie,Qn,Xe,Ie]],["polygonToCells",Ye,[Ie,Qn,Xe,Ie]],["maxPolygonToCellsSizeExperimental",Ye,[Ie,Qn,Xe,Ie]],["polygonToCellsExperimental",Ye,[Ie,Qn,Xe,Xe,Xe,Ie]],["cellsToLinkedMultiPolygon",Ye,[Ie,Xe,Ie]],["destroyLinkedMultiPolygon",null,[Ie]],["compactCells",Ye,[Ie,Ie,Xe,Xe]],["uncompactCells",Ye,[Ie,Xe,Xe,Ie,Xe,Qn]],["uncompactCellsSize",Ye,[Ie,Xe,Xe,Qn,Ie]],["isPentagon",fl,[nt,rt]],["isResClassIII",fl,[nt,rt]],["getBaseCellNumber",Xe,[nt,rt]],["getResolution",Xe,[nt,rt]],["getIndexDigit",Xe,[nt,rt,Xe]],["constructCell",Ye,[Xe,Xe,Ie,Ie]],["maxFaceCount",Ye,[nt,rt,Ie]],["getIcosahedronFaces",Ye,[nt,rt,Ie]],["cellToParent",Ye,[nt,rt,Qn,Ie]],["cellToChildren",Ye,[nt,rt,Qn,Ie]],["cellToCenterChild",Ye,[nt,rt,Qn,Ie]],["cellToChildrenSize",Ye,[nt,rt,Qn,Ie]],["cellToChildPos",Ye,[nt,rt,Qn,Ie]],["childPosToCell",Ye,[Xe,Xe,nt,rt,Qn,Ie]],["areNeighborCells",Ye,[nt,rt,nt,rt,Ie]],["cellsToDirectedEdge",Ye,[nt,rt,nt,rt,Ie]],["getDirectedEdgeOrigin",Ye,[nt,rt,Ie]],["getDirectedEdgeDestination",Ye,[nt,rt,Ie]],["isValidDirectedEdge",fl,[nt,rt]],["directedEdgeToCells",Ye,[nt,rt,Ie]],["originToDirectedEdges",Ye,[nt,rt,Ie]],["directedEdgeToBoundary",Ye,[nt,rt,Ie]],["gridDistance",Ye,[nt,rt,nt,rt,Ie]],["gridPathCells",Ye,[nt,rt,nt,rt,Ie]],["gridPathCellsSize",Ye,[nt,rt,nt,rt,Ie]],["cellToLocalIj",Ye,[nt,rt,nt,rt,Xe,Ie]],["localIjToCell",Ye,[nt,rt,Ie,Xe,Ie]],["getHexagonAreaAvgM2",Ye,[Qn,Ie]],["getHexagonAreaAvgKm2",Ye,[Qn,Ie]],["getHexagonEdgeLengthAvgM",Ye,[Qn,Ie]],["getHexagonEdgeLengthAvgKm",Ye,[Qn,Ie]],["greatCircleDistanceM",Xe,[Ie,Ie]],["greatCircleDistanceKm",Xe,[Ie,Ie]],["greatCircleDistanceRads",Xe,[Ie,Ie]],["cellAreaM2",Ye,[nt,rt,Ie]],["cellAreaKm2",Ye,[nt,rt,Ie]],["cellAreaRads2",Ye,[nt,rt,Ie]],["edgeLengthM",Ye,[nt,rt,Ie]],["edgeLengthKm",Ye,[nt,rt,Ie]],["edgeLengthRads",Ye,[nt,rt,Ie]],["getNumCells",Ye,[Qn,Ie]],["getRes0Cells",Ye,[Ie]],["res0CellCount",Xe],["getPentagons",Ye,[Xe,Ie]],["pentagonCount",Xe],["cellToVertex",Ye,[nt,rt,Xe,Ie]],["cellToVertexes",Ye,[nt,rt,Ie]],["vertexToLatLng",Ye,[nt,rt,Ie]],["isValidVertex",fl,[nt,rt]]],GD=0,VD=1,zD=2,$D=3,V4=4,jD=5,HD=6,WD=7,QD=8,YD=9,XD=10,KD=11,ZD=12,JD=13,eL=14,tL=15,nL=16,rL=17,iL=18,sL=19,Pn={};Pn[GD]="Success";Pn[VD]="The operation failed but a more specific error is not available";Pn[zD]="Argument was outside of acceptable range";Pn[$D]="Latitude or longitude arguments were outside of acceptable range";Pn[V4]="Resolution argument was outside of acceptable range";Pn[jD]="Cell argument was not valid";Pn[HD]="Directed edge argument was not valid";Pn[WD]="Undirected edge argument was not valid";Pn[QD]="Vertex argument was not valid";Pn[YD]="Pentagon distortion was encountered";Pn[XD]="Duplicate input";Pn[KD]="Cell arguments were not neighbors";Pn[ZD]="Cell arguments had incompatible resolutions";Pn[JD]="Memory allocation failed";Pn[eL]="Bounds of provided memory were insufficient";Pn[tL]="Mode or flags argument was not valid";Pn[nL]="Index argument was not valid";Pn[rL]="Base cell number was outside of acceptable range";Pn[iL]="Child indexing digits invalid";Pn[sL]="Child indexing digits refer to a deleted subsequence";var oL=1e3,z4=1001,$4=1002,uf={};uf[oL]="Unknown unit";uf[z4]="Array length out of bounds";uf[$4]="Got unexpected null value for H3 index";var aL="Unknown error";function j4(n,e,t){var r=t&&"value"in t,i=new Error((n[e]||aL)+" (code: "+e+(r?", value: "+t.value:"")+")");return i.code=e,i}function H4(n,e){var t=arguments.length===2?{value:e}:{};return j4(Pn,n,t)}function W4(n,e){var t=arguments.length===2?{value:e}:{};return j4(uf,n,t)}function BA(n){if(n!==0)throw H4(n)}var Gr={};qD.forEach(function(e){Gr[e[0]]=Et.cwrap.apply(Et,e)});var Dl=16,DA=4,ru=8,lL=8,Nh=Gr.sizeOfH3Index(),y1=Gr.sizeOfLatLng(),uL=Gr.sizeOfCellBoundary(),AL=Gr.sizeOfGeoPolygon(),AA=Gr.sizeOfGeoLoop();Gr.sizeOfLinkedGeoPolygon();Gr.sizeOfCoordIJ();function cL(n){if(typeof n!="number"||n<0||n>15||Math.floor(n)!==n)throw H4(V4,n);return n}function hL(n){if(!n)throw W4($4);return n}var fL=Math.pow(2,32)-1;function dL(n){if(n>fL)throw W4(z4,n);return n}var pL=/[^0-9a-fA-F]/;function Q4(n){if(Array.isArray(n)&&n.length===2&&Number.isInteger(n[0])&&Number.isInteger(n[1]))return n;if(typeof n!="string"||pL.test(n))return[0,0];var e=parseInt(n.substring(0,n.length-8),Dl),t=parseInt(n.substring(n.length-8),Dl);return[t,e]}function G3(n){if(n>=0)return n.toString(Dl);n=n&2147483647;var e=Y4(8,n.toString(Dl)),t=(parseInt(e[0],Dl)+8).toString(Dl);return e=t+e.substring(1),e}function mL(n,e){return G3(e)+Y4(8,G3(n))}function Y4(n,e){for(var t=n-e.length,r="",i=0;i<t;i++)r+="0";return r=r+e,r}function V3(n,e,t){for(var r=n.length,i=Et._calloc(r,y1),s=t?1:0,o=t?0:1,a=0;a<r*2;a+=2)Et.HEAPF64.set([n[a/2][s],n[a/2][o]].map(J4),i/ru+a);return Et.HEAPU32.set([r,i],e/DA),e}function gL(n,e){var t=n.length-1,r=Et._calloc(AL),i=0,s=i+AA,o=s+DA;V3(n[0],r+i,e);var a;if(t>0){a=Et._calloc(t,AA);for(var c=0;c<t;c++)V3(n[c+1],a+AA*c,e)}return Et.setValue(r+s,t,"i32"),Et.setValue(r+o,a,"i32"),r}function _L(n){var e=0,t=e+AA,r=t+DA,i=DA;Et._free(Et.getValue(n+e+i,"i8*"));var s=Et.getValue(n+t,"i32");if(s>0){for(var o=Et.getValue(n+r,"i32"),a=0;a<s;a++)Et._free(Et.getValue(o+AA*a+i,"i8*"));Et._free(o)}Et._free(n)}function X4(n,e){e===void 0&&(e=0);var t=Et.getValue(n+Nh*e,"i32"),r=Et.getValue(n+Nh*e+DA,"i32");return r?mL(t,r):null}function yL(n){return Gr.readInt64AsDoubleFromPointer(n)}function vL(n,e){for(var t=[],r=0;r<e;r++){var i=X4(n,r);i!==null&&t.push(i)}return t}function Rh(n){return SL(Et.getValue(n,"double"))}function xL(n){return[Rh(n),Rh(n+ru)]}function bL(n){return[Rh(n+ru),Rh(n)]}function TL(n,e,t){for(var r=Et.getValue(n,"i32"),i=n+ru,s=[],o=bL,a=0;a<r*2;a+=2)s.push(o(i+ru*a));return s.push(s[0]),s}function wL(n,e,t){var r=Et._malloc(y1);Et.HEAPF64.set([n,e].map(J4),r/ru);var i=Et._malloc(Nh);try{return BA(Gr.latLngToCell(r,t,i)),hL(X4(i))}finally{Et._free(i),Et._free(r)}}function K4(n){var e=Et._malloc(y1),t=Q4(n),r=t[0],i=t[1];try{return BA(Gr.cellToLatLng(r,i,e)),xL(e)}finally{Et._free(e)}}function Z4(n,e){var t=Et._malloc(uL),r=Q4(n),i=r[0],s=r[1];try{return BA(Gr.cellToBoundary(i,s,t)),TL(t,e,e)}finally{Et._free(t)}}function z3(n,e,t){if(cL(e),t=!!t,n.length===0||n[0].length===0)return[];var r=typeof n[0][0]=="number"?[n]:n,i=gL(r,t),s=Et._malloc(lL);try{BA(Gr.maxPolygonToCellsSize(i,e,0,s));var o=dL(yL(s)),a=Et._calloc(o,Nh);try{return BA(Gr.polygonToCells(i,e,0,a)),vL(a,o)}finally{Et._free(a)}}finally{Et._free(s),_L(i)}}function J4(n){return n*Math.PI/180}function SL(n){return n*180/Math.PI}function EL(n){return n=Math.max(0,Math.min(1,n)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+n*(1172.33-n*(10793.56-n*(33300.12-n*(38394.49-n*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+n*(557.33+n*(1225.33-n*(3574.96-n*(1073.77+n*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+n*(3211.1-n*(15327.97-n*(27814-n*(22569.18-n*6838.66)))))))+")"}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const NL=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Wd=new WeakMap;class RL{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=NL,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}needsVelocity(e){const t=e.getMRT();return t!==null&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:r,material:i,object:s}=e;if(t={material:this.getMaterialData(i),geometry:{id:r.id,attributes:this.getAttributesData(r.attributes),indexVersion:r.index?r.index.version:null,drawRange:{start:r.drawRange.start,count:r.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:o,height:a}=e.context;t.bufferWidth=o,t.bufferHeight=a}t.lights=this.getLightsData(e.lightsNode.getLights()),this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const r in e){const i=e[r];t[r]={version:i.version}}return t}containsNode(e){const t=e.material;for(const r in t)if(t[r]&&t[r].isNode)return!0;return!!(e.context.modelViewMatrix||e.context.modelNormalViewMatrix||e.context.getAO||e.context.getShadow)}getMaterialData(e){const t={};for(const r of this.refreshUniforms){const i=e[r];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?t[r]={id:i.id,version:i.version}:t[r]=i.clone():t[r]=i)}return t}equals(e,t){const{object:r,material:i,geometry:s}=e,o=this.getRenderObjectData(e);if(o.worldMatrix.equals(r.matrixWorld)!==!0)return o.worldMatrix.copy(r.matrixWorld),!1;const a=o.material;for(const N in a){const C=a[N],P=i[N];if(C.equals!==void 0){if(C.equals(P)===!1)return C.copy(P),!1}else if(P.isTexture===!0){if(C.id!==P.id||C.version!==P.version)return C.id=P.id,C.version=P.version,!1}else if(C!==P)return a[N]=P,!1}if(a.transmission>0){const{width:N,height:C}=e.context;if(o.bufferWidth!==N||o.bufferHeight!==C)return o.bufferWidth=N,o.bufferHeight=C,!1}const c=o.geometry,f=s.attributes,p=c.attributes,g=Object.keys(p),v=Object.keys(f);if(c.id!==s.id)return c.id=s.id,!1;if(g.length!==v.length)return o.geometry.attributes=this.getAttributesData(f),!1;for(const N of g){const C=p[N],P=f[N];if(P===void 0)return delete p[N],!1;if(C.version!==P.version)return C.version=P.version,!1}const b=s.index,T=c.indexVersion,S=b?b.version:null;if(T!==S)return c.indexVersion=S,!1;if(c.drawRange.start!==s.drawRange.start||c.drawRange.count!==s.drawRange.count)return c.drawRange.start=s.drawRange.start,c.drawRange.count=s.drawRange.count,!1;if(o.morphTargetInfluences){let N=!1;for(let C=0;C<o.morphTargetInfluences.length;C++)o.morphTargetInfluences[C]!==r.morphTargetInfluences[C]&&(o.morphTargetInfluences[C]=r.morphTargetInfluences[C],N=!0);if(N)return!1}if(o.lights){for(let N=0;N<t.length;N++)if(o.lights[N].map!==t[N].map)return!1}return o.center&&o.center.equals(r.center)===!1?(o.center.copy(r.center),!0):(e.bundle!==null&&(o.version=e.bundle.version),!0)}getLightsData(e){const t=[];for(const r of e)r.isSpotLight===!0&&r.map!==null&&t.push({map:r.map.version});return t}getLights(e,t){if(Wd.has(e)){const i=Wd.get(e);if(i.renderId===t)return i.lightsData}const r=this.getLightsData(e.getLights());return Wd.set(e,{renderId:t,lightsData:r}),r}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:r}=t;if(this.renderId!==r)return this.renderId=r,!0;const i=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;if(i||s)return!1;const o=this.getLights(e.lightsNode,r);return this.equals(e,o)!==!0}}function v1(n,e=0){let t=3735928559^e,r=1103547991^e;if(n instanceof Array)for(let i=0,s;i<n.length;i++)s=n[i],t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);else for(let i=0,s;i<n.length;i++)s=n.charCodeAt(i),t=Math.imul(t^s,2654435761),r=Math.imul(r^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&r)+(t>>>0)}const YA=n=>v1(n),cu=n=>v1(n),cA=(...n)=>v1(n),CL=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),$3=new WeakMap;function e8(n){return CL.get(n)}function Ch(n){if(/[iu]?vec\d/.test(n))return n.startsWith("ivec")?Int32Array:n.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(n)||/float/.test(n))return Float32Array;if(/uint/.test(n))return Uint32Array;if(/int/.test(n))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${n}`)}function t8(n){if(/float|int|uint/.test(n))return 1;if(/vec2/.test(n))return 2;if(/vec3/.test(n))return 3;if(/vec4/.test(n)||/mat2/.test(n))return 4;if(/mat3/.test(n))return 9;if(/mat4/.test(n))return 16;Pe("TSL: Unsupported type:",n)}function ML(n){if(/float|int|uint/.test(n))return 1;if(/vec2/.test(n))return 2;if(/vec3/.test(n))return 3;if(/vec4/.test(n)||/mat2/.test(n))return 4;if(/mat3/.test(n))return 12;if(/mat4/.test(n))return 16;Pe("TSL: Unsupported type:",n)}function PL(n){if(/float|int|uint/.test(n))return 4;if(/vec2/.test(n))return 8;if(/vec3/.test(n)||/vec4/.test(n))return 16;if(/mat2/.test(n))return 8;if(/mat3/.test(n)||/mat4/.test(n))return 16;Pe("TSL: Unsupported type:",n)}function Fo(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function x1(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new Gn(...e):t==="vec2"?new gt(...e):t==="vec3"?new we(...e):t==="vec4"?new Vt(...e):t==="mat2"?new Nb(...e):t==="mat3"?new jA(...e):t==="mat4"?new hn(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?i8(e[0]):null}function n8(n){let e=$3.get(n);return e===void 0&&(e={},$3.set(n,e)),e}function r8(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function i8(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const tA={VERTEX:"vertex",FRAGMENT:"fragment"},it={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},BL={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},ir={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},s8=["fragment","vertex"],Qm=["setup","analyze","generate"],Ym=[...s8,"compute"],ja=["x","y","z","w"],DL={analyze:"setup",generate:"analyze"};let LL=0;class Oe extends Zh{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=it.NONE,this.updateBeforeType=it.NONE,this.updateAfterType=it.NONE,this.uuid=Yl.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:LL++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,it.FRAME)}onRenderUpdate(e){return this.onUpdate(e,it.RENDER)}onObjectUpdate(e){return this.onUpdate(e,it.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of this._getChildren())yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}_getChildren(e=new Set){const t=[];e.add(this);for(const r of Object.getOwnPropertyNames(this)){const i=this[r];if(!(r.startsWith("_")===!0||e.has(i))){if(Array.isArray(i)===!0)for(let s=0;s<i.length;s++){const o=i[s];o&&o.isNode===!0&&t.push({property:r,index:s,childNode:o})}else if(i&&i.isNode===!0)t.push({property:r,childNode:i});else if(i&&Object.getPrototypeOf(i)===Object.prototype)for(const s in i){if(s.startsWith("_")===!0)continue;const o=i[s];o&&o.isNode===!0&&t.push({property:r,index:s,childNode:o})}}}return t}getCacheKey(e=!1,t=null){if(e=e||this.version!==this._cacheKeyVersion,e===!0||this._cacheKey===null){t===null&&(t=new Set);const r=[];for(const{property:i,childNode:s}of this._getChildren(t))r.push(YA(i.slice(0,-4)),s.getCacheKey(e,t));this._cacheKey=cA(cu(r),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let r=0;for(const i of this.getChildren())t["node"+r++]=i;return t.outputNode||null}analyze(e,t=null){const r=e.increaseUsage(this);if(this.parents===!0){const i=e.getDataFromNode(this,"any");i.stages=i.stages||{},i.stages[e.shaderStage]=i.stages[e.shaderStage]||[],i.stages[e.shaderStage].push(t)}if(r===1){const i=e.getNodeProperties(this);for(const s of Object.values(i))s&&s.isNode===!0&&s.build(e,this)}}generate(e,t){const{outputNode:r}=e.getNodeProperties(this);if(r&&r.isNode===!0)return r.build(e,t)}updateBefore(){Be("Abstract function.")}updateAfter(){Be("Abstract function.")}update(){Be("Abstract function.")}before(e){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(e),this}build(e,t=null){const r=this.getShared(e);if(this!==r)return r.build(e,t);if(this._beforeNodes!==null){const c=this._beforeNodes;this._beforeNodes=null;for(const f of c)f.build(e,t);this._beforeNodes=c}const i=e.getDataFromNode(this);i.buildStages=i.buildStages||{},i.buildStages[e.buildStage]=!0;const s=DL[e.buildStage];if(s&&i.buildStages[s]!==!0){const c=e.getBuildStage();e.setBuildStage(s),this.build(e),e.setBuildStage(c)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const c=e.getNodeProperties(this);if(c.initialized!==!0){c.initialized=!0,c.outputNode=this.setup(e)||c.outputNode||null;for(const f of Object.values(c))if(f&&f.isNode===!0){if(f.parents===!0){const p=e.getNodeProperties(f);p.parents=p.parents||[],p.parents.push(this)}f.build(e)}}o=c.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate"){if(this.generate.length<2){const f=this.getNodeType(e),p=e.getDataFromNode(this);o=p.snippet,o===void 0?p.generated===void 0?(p.generated=!0,o=this.generate(e)||"",p.snippet=o):(Be("Node: Recursion detected.",this),o="/* Recursion detected. */"):p.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,f,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(Pe(`TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return this._getChildren()}serialize(e){const t=this.getSerializeChildren(),r={};for(const{property:i,index:s,childNode:o}of t)s!==void 0?(r[i]===void 0&&(r[i]=Number.isInteger(s)?[]:{}),r[i][s]=o.toJSON(e.meta).uuid):r[i]=o.toJSON(e.meta).uuid;Object.keys(r).length>0&&(e.inputNodes=r)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const r in e.inputNodes)if(Array.isArray(e.inputNodes[r])){const i=[];for(const s of e.inputNodes[r])i.push(t[s]);this[r]=i}else if(typeof e.inputNodes[r]=="object"){const i={};for(const s in e.inputNodes[r]){const o=e.inputNodes[r][s];i[s]=t[o]}this[r]=i}else{const i=e.inputNodes[r];this[r]=t[i]}}}toJSON(e){const{uuid:t,type:r}=this,i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:r,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},i!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function o(a){const c=[];for(const f in a){const p=a[f];delete p.metadata,c.push(p)}return c}if(i){const a=o(e.textures),c=o(e.images),f=o(e.nodes);a.length>0&&(s.textures=a),c.length>0&&(s.images=c),f.length>0&&(s.nodes=f)}return s}}class Ha extends Oe{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}generate(e){const t=this.indexNode.getNodeType(e),r=this.node.build(e),i=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${r}[ ${i} ]`}}class o8 extends Oe{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let r=null;for(const i of this.convertTo.split("|"))(r===null||e.getTypeLength(t)===e.getTypeLength(i))&&(r=i);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const r=this.node,i=this.getNodeType(e),s=r.build(e,i);return e.format(s,i,t)}}class _n extends Oe{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const i=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,i,t);if(i!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,i),a=e.getVarFromNode(this,null,i),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${o}`,this),s.snippet=o,s.propertyName=c,e.format(s.propertyName,i,t)}}return super.build(e,t)}}class FL extends _n{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,r)=>t+e.getTypeLength(r.getNodeType(e)),0))}generate(e,t){const r=this.getNodeType(e),i=e.getTypeLength(r),s=this.nodes,o=e.getComponentType(r),a=[];let c=0;for(const p of s){if(c>=i){Pe(`TSL: Length of parameters exceeds maximum length of function '${r}()' type.`);break}let g=p.getNodeType(e),v=e.getTypeLength(g),b;if(c+v>i&&(Pe(`TSL: Length of '${r}()' data exceeds maximum length of output type.`),v=i-c,g=e.getTypeFromLength(v)),c+=v,b=p.build(e,g),e.getComponentType(g)!==o){const S=e.getTypeFromLength(v,o);b=e.format(b,g,S)}a.push(b)}const f=`${e.getType(r)}( ${a.join(", ")} )`;return e.format(f,r,t)}}const OL=ja.join("");class a8 extends Oe{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(ja.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const r=this.node,i=e.getTypeLength(r.getNodeType(e));let s=null;if(i>1){let o=null;this.getVectorLength()>=i&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=r.build(e,o);this.components.length===i&&this.components===OL.slice(0,this.components.length)?s=e.format(c,o,t):s=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else s=r.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class IL extends _n{static get type(){return"SetNode"}constructor(e,t,r){super(),this.sourceNode=e,this.components=t,this.targetNode=r}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:r,targetNode:i}=this,s=this.getNodeType(e),o=e.getComponentType(i.getNodeType(e)),a=e.getTypeFromLength(r.length,o),c=i.build(e,a),f=t.build(e,s),p=e.getTypeLength(s),g=[];for(let v=0;v<p;v++){const b=ja[v];b===r[0]?(g.push(c),v+=r.length-1):g.push(f+"."+b)}return`${e.getType(s)}( ${g.join(", ")} )`}}class kL extends _n{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:r}=this,i=this.getNodeType(e),s=r.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+s,this);const c=e.getTypeLength(i),f=[];let p=0;for(let g=0;g<c;g++){const v=ja[g];v===t[p]?(f.push("1.0 - "+(a+"."+v)),p++):f.push(a+"."+v)}return`${e.getType(i)}( ${f.join(", ")} )`}}class b1 extends Oe{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Fo(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Fo(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=r8(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?x1(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){Be("Abstract function.")}}const j3=/float|u?int/;class Ci extends b1{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const r=this.getNodeType(e);return j3.test(r)&&j3.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),r,t)}}class UL extends Oe{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){Be(`TSL: Member "${this.property}" does not exist in struct.`);const r=this.getNodeType(e);return e.generateConst(r)}return this.structNode.build(e)+"."+this.property}}let $o=null;const Xm=new Map;function fe(n,e){if(Xm.has(n)){Be(`TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);Xm.set(n,e),n!=="assign"&&(Oe.prototype[n]=function(...t){return this.isStackNode?this.addToStack(e(...t)):e(this,...t)},Oe.prototype[n+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const qL=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),H3=n=>qL(n).split("").sort().join("");Oe.prototype.assign=function(...n){if(this.isStackNode!==!0)return $o!==null?$o.assign(this,...n):Pe("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=Xm.get("assign");return this.addToStack(e(...n))}};Oe.prototype.toVarIntent=function(){return this};Oe.prototype.get=function(n){return new UL(this,n)};const hA={};function Dc(n,e,t){hA[n]=hA[e]=hA[t]={get(){this._cache=this._cache||{};let o=this._cache[n];return o===void 0&&(o=new a8(this,n),this._cache[n]=o),o},set(o){this[n].assign(Me(o))}};const r=n.toUpperCase(),i=e.toUpperCase(),s=t.toUpperCase();Oe.prototype["set"+r]=Oe.prototype["set"+i]=Oe.prototype["set"+s]=function(o){const a=H3(n);return new IL(this,a,Me(o))},Oe.prototype["flip"+r]=Oe.prototype["flip"+i]=Oe.prototype["flip"+s]=function(){const o=H3(n);return new kL(this,o)}}const es=["x","y","z","w"],ts=["r","g","b","a"],ns=["s","t","p","q"];for(let n=0;n<4;n++){let e=es[n],t=ts[n],r=ns[n];Dc(e,t,r);for(let i=0;i<4;i++){e=es[n]+es[i],t=ts[n]+ts[i],r=ns[n]+ns[i],Dc(e,t,r);for(let s=0;s<4;s++){e=es[n]+es[i]+es[s],t=ts[n]+ts[i]+ts[s],r=ns[n]+ns[i]+ns[s],Dc(e,t,r);for(let o=0;o<4;o++)e=es[n]+es[i]+es[s]+es[o],t=ts[n]+ts[i]+ts[s]+ts[o],r=ns[n]+ns[i]+ns[s]+ns[o],Dc(e,t,r)}}}for(let n=0;n<32;n++)hA[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return e===void 0&&(e=new Ha(this,new Ci(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(Me(e))}};Object.defineProperties(Oe.prototype,hA);const W3=new WeakMap,GL=function(n,e=null){const t=Fo(n);return t==="node"?n:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?Me(Km(n,e)):t==="shader"?n.isFn?n:ee(n):n},VL=function(n,e=null){for(const t in n)n[t]=Me(n[t],e);return n},zL=function(n,e=null){const t=n.length;for(let r=0;r<t;r++)n[r]=Me(n[r],e);return n},l8=function(n,e=null,t=null,r=null){function i(p){return r!==null?(p=Me(Object.assign(p,r)),r.intent===!0&&(p=p.toVarIntent())):p=Me(p),p}let s,o=e,a,c;function f(p){let g;return o?g=/[a-z]/i.test(o)?o+"()":o:g=n.type,a!==void 0&&p.length<a?(Pe(`TSL: "${g}" parameter length is less than minimum required.`),p.concat(new Array(a-p.length).fill(0))):c!==void 0&&p.length>c?(Pe(`TSL: "${g}" parameter length exceeds limit.`),p.slice(0,c)):p}return e===null?s=(...p)=>i(new n(...Ia(f(p)))):t!==null?(t=Me(t),s=(...p)=>i(new n(e,...Ia(f(p)),t))):s=(...p)=>i(new n(e,...Ia(f(p)))),s.setParameterLength=(...p)=>(p.length===1?a=c=p[0]:p.length===2&&([a,c]=p),s),s.setName=p=>(o=p,s),s},$L=function(n,...e){return new n(...Ia(e))};class jL extends Oe{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getElementType(e){return this.getOutputNode(e).getElementType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:r}=this,i=e.getNodeProperties(t),s=e.getClosestSubBuild(t.subBuilds)||"",o=s||"default";if(i[o])return i[o];const a=e.subBuildFn,c=e.fnCall;e.subBuildFn=s,e.fnCall=this;let f=null;if(t.layout){let p=W3.get(e.constructor);p===void 0&&(p=new WeakMap,W3.set(e.constructor,p));let g=p.get(t);g===void 0&&(g=Me(e.buildFunctionNode(t)),p.set(t,g)),e.addInclude(g);const v=r?HL(r):null;f=Me(g.call(v))}else{const p=new Proxy(e,{get:(S,N,C)=>{let P;return Symbol.iterator===N?P=function*(){yield void 0}:P=Reflect.get(S,N,C),P}}),g=r?WL(r):null,v=Array.isArray(r)?r.length>0:r!==null,b=t.jsFunc,T=v||b.length>1?b(g,p):b(p);f=Me(T)}return e.subBuildFn=a,e.fnCall=c,t.once&&(i[o]=f),f}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),r=e.getSubBuildOutput(this);return t[r]=t[r]||this.setupOutput(e),t[r].subBuild=e.getClosestSubBuild(this),t[r]}build(e,t=null){let r=null;const i=e.getBuildStage(),s=e.getNodeProperties(this),o=e.getSubBuildOutput(this),a=this.getOutputNode(e),c=e.fnCall;if(e.fnCall=this,i==="setup"){const f=e.getSubBuildProperty("initialized",this);if(s[f]!==!0&&(s[f]=!0,s[o]=this.getOutputNode(e),s[o].build(e),this.shaderNode.subBuilds))for(const p of e.chaining){const g=e.getDataFromNode(p,"any");g.subBuilds=g.subBuilds||new Set;for(const v of this.shaderNode.subBuilds)g.subBuilds.add(v)}r=s[o]}else i==="analyze"?a.build(e,t):i==="generate"&&(r=a.build(e,t)||"");return e.fnCall=c,r}}function HL(n){let e;return hf(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?e=[...n]:e=n[0],e}function WL(n){let e=0;return hf(n),new Proxy(n,{get:(t,r,i)=>{let s;if(r==="length")return s=n.length,s;if(Symbol.iterator===r)s=function*(){for(const o of n)yield Me(o)};else{if(n.length>0)if(Object.getPrototypeOf(n[0])===Object.prototype){const o=n[0];o[r]===void 0?s=o[e++]:s=Reflect.get(o,r,i)}else n[0]instanceof Oe&&(n[r]===void 0?s=n[e++]:s=Reflect.get(n,r,i));else s=Reflect.get(t,r,i);s=Me(s)}return s}})}class QL extends Oe{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}getLayout(){return this.layout}call(e=null){return new jL(this,e)}setup(){return this.call()}}const YL=[!1,!0],XL=[0,1,2,3],KL=[-1,-2],u8=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],T1=new Map;for(const n of YL)T1.set(n,new Ci(n));const w1=new Map;for(const n of XL)w1.set(n,new Ci(n,"uint"));const S1=new Map([...w1].map(n=>new Ci(n.value,"int")));for(const n of KL)S1.set(n,new Ci(n,"int"));const Af=new Map([...S1].map(n=>new Ci(n.value)));for(const n of u8)Af.set(n,new Ci(n));for(const n of u8)Af.set(-n,new Ci(-n));const cf={bool:T1,uint:w1,ints:S1,float:Af},Q3=new Map([...T1,...Af]),Km=(n,e)=>Q3.has(n)?Q3.get(n):n.isNode===!0?n:new Ci(n,e),In=function(n,e=null){return(...t)=>{for(const i of t)if(i===void 0)return Pe(`TSL: Invalid parameter for the type "${n}".`),new Ci(0,n);if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(i=>{const s=typeof i;return s!=="object"&&s!=="function"}))&&(t=[x1(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return nA(e.get(t[0]));if(t.length===1){const i=Km(t[0],n);return i.nodeType===n?nA(i):nA(new o8(i,n))}const r=t.map(i=>Km(i));return nA(new FL(r,n))}},LA=n=>typeof n=="object"&&n!==null?n.value:n,A8=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function Ll(n,e){return new QL(n,e)}const Me=(n,e=null)=>GL(n,e),nA=(n,e=null)=>Me(n,e).toVarIntent(),hf=(n,e=null)=>new VL(n,e),Ia=(n,e=null)=>new zL(n,e),Ze=(n,e=null,t=null,r=null)=>new l8(n,e,t,r),Ce=(n,...e)=>new $L(n,...e),Te=(n,e=null,t=null,r={})=>new l8(n,e,t,{...r,intent:!0});let ZL=0;class JL extends Oe{constructor(e,t=null){super();let r=null;t!==null&&(typeof t=="object"?r=t.return:(typeof t=="string"?r=t:Pe("TSL: Invalid layout type."),t=null)),this.shaderNode=new Ll(e,r),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const r={name:"fn"+ZL++,type:t,inputs:[]};for(const i in e)i!=="return"&&r.inputs.push({name:i,type:e[i]});e=r}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return Pe('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function ee(n,e=null){const t=new JL(n,e);return new Proxy(()=>{},{apply(r,i,s){return t.call(...s)},get(r,i,s){return Reflect.get(t,i,s)},set(r,i,s,o){return Reflect.set(t,i,s,o)}})}const FA=n=>{$o=n},E1=()=>$o,Ve=(...n)=>$o.If(...n),eF=(...n)=>$o.Switch(...n);function ff(n){return $o&&$o.addToStack(n),n}fe("toStack",ff);const c8=new In("color"),V=new In("float",cf.float),Q=new In("int",cf.ints),me=new In("uint",cf.uint),wi=new In("bool",cf.bool),xe=new In("vec2"),Dn=new In("ivec2"),N1=new In("uvec2"),h8=new In("bvec2"),X=new In("vec3"),R1=new In("ivec3"),Wa=new In("uvec3"),C1=new In("bvec3"),ze=new In("vec4"),M1=new In("ivec4"),P1=new In("uvec4"),f8=new In("bvec4"),df=new In("mat2"),or=new In("mat3"),qo=new In("mat4"),tF=(n="")=>new Ci(n,"string"),nF=n=>new Ci(n,"ArrayBuffer");fe("toColor",c8);fe("toFloat",V);fe("toInt",Q);fe("toUint",me);fe("toBool",wi);fe("toVec2",xe);fe("toIVec2",Dn);fe("toUVec2",N1);fe("toBVec2",h8);fe("toVec3",X);fe("toIVec3",R1);fe("toUVec3",Wa);fe("toBVec3",C1);fe("toVec4",ze);fe("toIVec4",M1);fe("toUVec4",P1);fe("toBVec4",f8);fe("toMat2",df);fe("toMat3",or);fe("toMat4",qo);const d8=Ze(Ha).setParameterLength(2),p8=(n,e)=>Me(new o8(Me(n),e)),rF=(n,e)=>Me(new a8(Me(n),e));fe("element",d8);fe("convert",p8);const iF=n=>(Be("TSL: append() has been renamed to Stack()."),ff(n));fe("append",n=>(Be("TSL: .append() has been renamed to .toStack()."),ff(n)));class Bt extends Oe{static get type(){return"PropertyNode"}constructor(e,t=null,r=!1){super(e),this.name=t,this.varying=r,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return YA(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Qs=(n,e)=>new Bt(n,e),OA=(n,e)=>new Bt(n,e,!0),Ft=Ce(Bt,"vec4","DiffuseColor"),va=Ce(Bt,"vec3","DiffuseContribution"),Zm=Ce(Bt,"vec3","EmissiveColor"),hs=Ce(Bt,"float","Roughness"),$s=Ce(Bt,"float","Metalness"),Mh=Ce(Bt,"float","Clearcoat"),IA=Ce(Bt,"float","ClearcoatRoughness"),Xr=Ce(Bt,"vec3","Sheen"),Po=Ce(Bt,"float","SheenRoughness"),pf=Ce(Bt,"float","Iridescence"),Ph=Ce(Bt,"float","IridescenceIOR"),Bh=Ce(Bt,"float","IridescenceThickness"),Dh=Ce(Bt,"float","AlphaT"),Co=Ce(Bt,"float","Anisotropy"),fA=Ce(Bt,"vec3","AnisotropyT"),ka=Ce(Bt,"vec3","AnisotropyB"),jo=Ce(Bt,"color","SpecularColor"),Pa=Ce(Bt,"color","SpecularColorBlended"),Gl=Ce(Bt,"float","SpecularF90"),Lh=Ce(Bt,"float","Shininess"),Vl=Ce(Bt,"vec4","Output"),M0=Ce(Bt,"float","dashSize"),Jm=Ce(Bt,"float","gapSize"),sF=Ce(Bt,"float","pointWidth"),dA=Ce(Bt,"float","IOR"),Fh=Ce(Bt,"float","Transmission"),B1=Ce(Bt,"float","Thickness"),D1=Ce(Bt,"float","AttenuationDistance"),L1=Ce(Bt,"color","AttenuationColor"),F1=Ce(Bt,"float","Dispersion");class m8 extends Oe{static get type(){return"UniformGroupNode"}constructor(e,t=!1,r=1){super("string"),this.name=e,this.shared=t,this.order=r,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const g8=n=>new m8(n),mf=(n,e=0)=>new m8(n,!0,e),_8=mf("frame"),qe=mf("render"),O1=g8("object");class XA extends b1{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=O1}setName(e){return this.name=e,this}label(e){return Be('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(r=>{const i=e(r,this);i!==void 0&&(this.value=i)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const r=this.getNodeType(e),i=this.getUniformHash(e);let s=e.getNodeFromHash(i);s===void 0&&(e.setHashNode(this,i),s=this);const o=s.getInputType(e),a=e.getUniformFromNode(s,o,e.shaderStage,this.name||e.context.nodeName),c=e.getPropertyName(a);e.context.nodeName!==void 0&&delete e.context.nodeName;let f=c;if(r==="bool"){const p=e.getDataFromNode(this);let g=p.propertyName;if(g===void 0){const v=e.getVarFromNode(this,null,"bool");g=e.getPropertyName(v),p.propertyName=g,f=e.format(c,o,r),e.addLineFlowCode(`${g} = ${f}`,this)}f=g}return e.format(f,r,t)}}const Ge=(n,e)=>{const t=A8(e||n);if(t===n&&(n=x1(t)),n&&n.isNode===!0){let r=n.value;n.traverse(i=>{i.isConstNode===!0&&(r=i.value)}),n=r}return new XA(n,t)};class Y3 extends _n{static get type(){return"ArrayNode"}constructor(e,t,r=null){super(e),this.count=t,this.values=r,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null?this.values[0].getNodeType(e):this.nodeType}getElementType(e){return this.getNodeType(e)}getMemberType(e,t){return this.nodeType===null?this.values[0].getMemberType(e,t):super.getMemberType(e,t)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const y8=(...n)=>{let e;if(n.length===1){const t=n[0];e=new Y3(null,t.length,t)}else{const t=n[0],r=n[1];e=new Y3(t,r)}return Me(e)};fe("toArray",(n,e)=>y8(Array(e).fill(n)));class oF extends _n{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const r=e.getTypeLength(t.node.getNodeType(e));return ja.join("").slice(0,r)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:r}=this,i=t.getScope(),s=e.getDataFromNode(i);s.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=r,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:r,sourceNode:i}=e.getNodeProperties(this),s=this.needsSplitAssign(e),o=r.build(e),a=r.getNodeType(e),c=i.build(e,a),f=i.getNodeType(e),p=e.getDataFromNode(this);let g;if(p.initialized===!0)t!=="void"&&(g=o);else if(s){const v=e.getVarFromNode(this,null,a),b=e.getPropertyName(v);e.addLineFlowCode(`${b} = ${c}`,this);const T=r.node,N=T.node.context({assign:!0}).build(e);for(let C=0;C<T.components.length;C++){const P=T.components[C];e.addLineFlowCode(`${N}.${P} = ${b}[ ${C} ]`,this)}t!=="void"&&(g=o)}else g=`${o} = ${c}`,(t==="void"||f==="void")&&(e.addLineFlowCode(g,this),t!=="void"&&(g=o));return p.initialized=!0,e.format(g,a,t)}}const v8=Ze(oF).setParameterLength(2);fe("assign",v8);class aF extends _n{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],r=this.functionNode,i=r.getInputs(e),s=this.parameters,o=(c,f)=>{const p=f.type,g=p==="pointer";let v;return g?v="&"+c.build(e):v=c.build(e,p),v};if(Array.isArray(s)){if(s.length>i.length)Pe("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=i.length;else if(s.length<i.length)for(Pe("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<i.length;)s.push(V(0));for(let c=0;c<s.length;c++)t.push(o(s[c],i[c]))}else for(const c of i){const f=s[c.name];f!==void 0?t.push(o(f,c)):(Pe(`TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(o(V(0),c)))}return`${r.build(e,"property")}( ${t.join(", ")} )`}}const x8=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Ia(e):hf(e[0]),new aF(Me(n),e));fe("call",x8);const lF={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class mn extends _n{static get type(){return"OperatorNode"}constructor(e,t,r,...i){if(super(),i.length>0){let s=new mn(e,t,r);for(let o=0;o<i.length-1;o++)s=new mn(e,s,i[o]);t=s,r=i[i.length-1]}this.op=e,this.aNode=t,this.bNode=r,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(lF[this.op],t)}getNodeType(e,t=null){const r=this.op,i=this.aNode,s=this.bNode,o=i.getNodeType(e),a=s?s.getNodeType(e):null;if(o==="void"||a==="void")return t||"void";if(r==="%")return o;if(r==="~"||r==="&"||r==="|"||r==="^"||r===">>"||r==="<<")return e.getIntegerType(o);if(r==="!"||r==="&&"||r==="||"||r==="^^")return"bool";if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">="){const c=Math.max(e.getTypeLength(o),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o);if(e.isMatrix(a))return o}else if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(o)?a:o}}generate(e,t){const r=this.op,{aNode:i,bNode:s}=this,o=this.getNodeType(e,t);let a=null,c=null;o!=="void"?(a=i.getNodeType(e),c=s?s.getNodeType(e):null,r==="<"||r===">"||r==="<="||r===">="||r==="=="||r==="!="?e.isVector(a)?c=a:e.isVector(c)?a=c:a!==c&&(a=c="float"):r===">>"||r==="<<"?(a=o,c=e.changeComponentType(c,"uint")):r==="%"?(a=o,c=e.isInteger(a)&&e.isInteger(c)?c:a):e.isMatrix(a)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(a):e.isMatrix(c)||(a=c=o):e.isMatrix(c)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(c):a=c=o:a=c=o):a=c=o;const f=i.build(e,a),p=s?s.build(e,c):null,g=e.getFunctionOperator(r);if(t!=="void"){const v=e.renderer.coordinateSystem===q0;if(r==="=="||r==="!="||r==="<"||r===">"||r==="<="||r===">=")return v?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${f}, ${p} )`,o,t):e.format(`( ${f} ${r} ${p} )`,o,t):e.format(`( ${f} ${r} ${p} )`,o,t);if(r==="%")return e.isInteger(c)?e.format(`( ${f} % ${p} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${f}, ${p} )`,o,t);if(r==="!"||r==="~")return e.format(`(${r}${f})`,a,t);if(g)return e.format(`${g}( ${f}, ${p} )`,o,t);if(e.isMatrix(a)&&c==="float")return e.format(`( ${p} ${r} ${f} )`,o,t);if(a==="float"&&e.isMatrix(c))return e.format(`${f} ${r} ${p}`,o,t);{let b=`( ${f} ${r} ${p} )`;return!v&&o==="bool"&&e.isVector(a)&&e.isVector(c)&&(b=`all${b}`),e.format(b,o,t)}}else if(a!=="void")return g?e.format(`${g}( ${f}, ${p} )`,o,t):e.isMatrix(a)&&c==="float"?e.format(`${p} ${r} ${f}`,o,t):e.format(`${f} ${r} ${p}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Mn=Te(mn,"+").setParameterLength(2,1/0).setName("add"),Tt=Te(mn,"-").setParameterLength(2,1/0).setName("sub"),Ke=Te(mn,"*").setParameterLength(2,1/0).setName("mul"),si=Te(mn,"/").setParameterLength(2,1/0).setName("div"),KA=Te(mn,"%").setParameterLength(2).setName("mod"),I1=Te(mn,"==").setParameterLength(2).setName("equal"),b8=Te(mn,"!=").setParameterLength(2).setName("notEqual"),T8=Te(mn,"<").setParameterLength(2).setName("lessThan"),k1=Te(mn,">").setParameterLength(2).setName("greaterThan"),w8=Te(mn,"<=").setParameterLength(2).setName("lessThanEqual"),S8=Te(mn,">=").setParameterLength(2).setName("greaterThanEqual"),E8=Te(mn,"&&").setParameterLength(2,1/0).setName("and"),N8=Te(mn,"||").setParameterLength(2,1/0).setName("or"),R8=Te(mn,"!").setParameterLength(1).setName("not"),C8=Te(mn,"^^").setParameterLength(2).setName("xor"),M8=Te(mn,"&").setParameterLength(2).setName("bitAnd"),P8=Te(mn,"~").setParameterLength(1).setName("bitNot"),B8=Te(mn,"|").setParameterLength(2).setName("bitOr"),D8=Te(mn,"^").setParameterLength(2).setName("bitXor"),L8=Te(mn,"<<").setParameterLength(2).setName("shiftLeft"),F8=Te(mn,">>").setParameterLength(2).setName("shiftRight"),O8=ee(([n])=>(n.addAssign(1),n)),I8=ee(([n])=>(n.subAssign(1),n)),k8=ee(([n])=>{const e=Q(n).toConst();return n.addAssign(1),e}),U8=ee(([n])=>{const e=Q(n).toConst();return n.subAssign(1),e});fe("add",Mn);fe("sub",Tt);fe("mul",Ke);fe("div",si);fe("mod",KA);fe("equal",I1);fe("notEqual",b8);fe("lessThan",T8);fe("greaterThan",k1);fe("lessThanEqual",w8);fe("greaterThanEqual",S8);fe("and",E8);fe("or",N8);fe("not",R8);fe("xor",C8);fe("bitAnd",M8);fe("bitNot",P8);fe("bitOr",B8);fe("bitXor",D8);fe("shiftLeft",L8);fe("shiftRight",F8);fe("incrementBefore",O8);fe("decrementBefore",I8);fe("increment",k8);fe("decrement",U8);const q8=(n,e)=>(Be('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),KA(Q(n),Q(e)));fe("modInt",q8);class le extends _n{static get type(){return"MathNode"}constructor(e,t,r=null,i=null){if(super(),(e===le.MAX||e===le.MIN)&&arguments.length>3){let s=new le(e,t,r);for(let o=2;o<arguments.length-1;o++)s=new le(e,s,arguments[o]);t=s,r=arguments[arguments.length-1],i=null}this.method=e,this.aNode=t,this.bNode=r,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(r)?0:e.getTypeLength(r),a=e.isMatrix(i)?0:e.getTypeLength(i);return s>o&&s>a?t:o>a?r:a>s?i:t}getNodeType(e){const t=this.method;return t===le.LENGTH||t===le.DISTANCE||t===le.DOT?"float":t===le.CROSS?"vec3":t===le.ALL||t===le.ANY?"bool":t===le.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:r,method:i}=this;let s=null;if(i===le.ONE_MINUS)s=Tt(1,t);else if(i===le.RECIPROCAL)s=si(1,t);else if(i===le.DIFFERENCE)s=Xt(Tt(t,r));else if(i===le.TRANSFORM_DIRECTION){let o=t,a=r;e.isMatrix(o.getNodeType(e))?a=ze(X(a),0):o=ze(X(o),0);const c=Ke(o,a).xyz;s=Mr(c)}return s!==null?s:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let i=this.method;const s=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,c=this.bNode,f=this.cNode,p=e.renderer.coordinateSystem;if(i===le.NEGATE)return e.format("( - "+a.build(e,o)+" )",s,t);{const g=[];return i===le.CROSS?g.push(a.build(e,s),c.build(e,s)):p===q0&&i===le.STEP?g.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),c.build(e,o)):p===q0&&(i===le.MIN||i===le.MAX)?g.push(a.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):i===le.REFRACT?g.push(a.build(e,o),c.build(e,o),f.build(e,"float")):i===le.MIX?g.push(a.build(e,o),c.build(e,o),f.build(e,e.getTypeLength(f.getNodeType(e))===1?"float":o)):(p===Vo&&i===le.ATAN&&c!==null&&(i="atan2"),e.shaderStage!=="fragment"&&(i===le.DFDX||i===le.DFDY)&&(Be(`TSL: '${i}' is not supported in the ${e.shaderStage} stage.`),i="/*"+i+"*/"),g.push(a.build(e,o)),c!==null&&g.push(c.build(e,o)),f!==null&&g.push(f.build(e,o))),e.format(`${e.getMethod(i,s)}( ${g.join(", ")} )`,s,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}le.ALL="all";le.ANY="any";le.RADIANS="radians";le.DEGREES="degrees";le.EXP="exp";le.EXP2="exp2";le.LOG="log";le.LOG2="log2";le.SQRT="sqrt";le.INVERSE_SQRT="inversesqrt";le.FLOOR="floor";le.CEIL="ceil";le.NORMALIZE="normalize";le.FRACT="fract";le.SIN="sin";le.COS="cos";le.TAN="tan";le.ASIN="asin";le.ACOS="acos";le.ATAN="atan";le.ABS="abs";le.SIGN="sign";le.LENGTH="length";le.NEGATE="negate";le.ONE_MINUS="oneMinus";le.DFDX="dFdx";le.DFDY="dFdy";le.ROUND="round";le.RECIPROCAL="reciprocal";le.TRUNC="trunc";le.FWIDTH="fwidth";le.TRANSPOSE="transpose";le.DETERMINANT="determinant";le.INVERSE="inverse";le.EQUALS="equals";le.MIN="min";le.MAX="max";le.STEP="step";le.REFLECT="reflect";le.DISTANCE="distance";le.DIFFERENCE="difference";le.DOT="dot";le.CROSS="cross";le.POW="pow";le.TRANSFORM_DIRECTION="transformDirection";le.MIX="mix";le.CLAMP="clamp";le.REFRACT="refract";le.SMOOTHSTEP="smoothstep";le.FACEFORWARD="faceforward";const U1=V(1e-6),uF=V(1e6),Oh=V(Math.PI),AF=V(Math.PI*2),cF=V(Math.PI*2),hF=V(Math.PI*.5),G8=Te(le,le.ALL).setParameterLength(1),V8=Te(le,le.ANY).setParameterLength(1),z8=Te(le,le.RADIANS).setParameterLength(1),$8=Te(le,le.DEGREES).setParameterLength(1),q1=Te(le,le.EXP).setParameterLength(1),iu=Te(le,le.EXP2).setParameterLength(1),gf=Te(le,le.LOG).setParameterLength(1),ys=Te(le,le.LOG2).setParameterLength(1),pr=Te(le,le.SQRT).setParameterLength(1),G1=Te(le,le.INVERSE_SQRT).setParameterLength(1),vs=Te(le,le.FLOOR).setParameterLength(1),_f=Te(le,le.CEIL).setParameterLength(1),Mr=Te(le,le.NORMALIZE).setParameterLength(1),Wi=Te(le,le.FRACT).setParameterLength(1),Rr=Te(le,le.SIN).setParameterLength(1),Ii=Te(le,le.COS).setParameterLength(1),j8=Te(le,le.TAN).setParameterLength(1),H8=Te(le,le.ASIN).setParameterLength(1),V1=Te(le,le.ACOS).setParameterLength(1),yf=Te(le,le.ATAN).setParameterLength(1,2),Xt=Te(le,le.ABS).setParameterLength(1),z1=Te(le,le.SIGN).setParameterLength(1),xs=Te(le,le.LENGTH).setParameterLength(1),$1=Te(le,le.NEGATE).setParameterLength(1),W8=Te(le,le.ONE_MINUS).setParameterLength(1),j1=Te(le,le.DFDX).setParameterLength(1),H1=Te(le,le.DFDY).setParameterLength(1),Q8=Te(le,le.ROUND).setParameterLength(1),Y8=Te(le,le.RECIPROCAL).setParameterLength(1),W1=Te(le,le.TRUNC).setParameterLength(1),Q1=Te(le,le.FWIDTH).setParameterLength(1),X8=Te(le,le.TRANSPOSE).setParameterLength(1),K8=Te(le,le.DETERMINANT).setParameterLength(1),Z8=Te(le,le.INVERSE).setParameterLength(1),J8=(n,e)=>(Be('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),I1(n,e)),Vr=Te(le,le.MIN).setParameterLength(2,1/0),gn=Te(le,le.MAX).setParameterLength(2,1/0),vf=Te(le,le.STEP).setParameterLength(2),eT=Te(le,le.REFLECT).setParameterLength(2),tT=Te(le,le.DISTANCE).setParameterLength(2),nT=Te(le,le.DIFFERENCE).setParameterLength(2),Si=Te(le,le.DOT).setParameterLength(2),io=Te(le,le.CROSS).setParameterLength(2),gi=Te(le,le.POW).setParameterLength(2),Y1=n=>Ke(n,n),rT=n=>Ke(n,n,n),X1=n=>Ke(n,n,n,n),iT=Te(le,le.TRANSFORM_DIRECTION).setParameterLength(2),sT=n=>Ke(z1(n),gi(Xt(n),1/3)),K1=n=>Si(n,n),xt=Te(le,le.MIX).setParameterLength(3),Qi=(n,e=0,t=1)=>Me(new le(le.CLAMP,Me(n),Me(e),Me(t))),xf=n=>Qi(n),Z1=Te(le,le.REFRACT).setParameterLength(3),Yi=Te(le,le.SMOOTHSTEP).setParameterLength(3),J1=Te(le,le.FACEFORWARD).setParameterLength(3),oT=ee(([n])=>{const r=43758.5453,i=Si(n.xy,xe(12.9898,78.233)),s=KA(i,Oh);return Wi(Rr(s).mul(r))}),aT=(n,e,t)=>xt(e,t,n),lT=(n,e,t)=>Yi(e,t,n),uT=(n,e)=>vf(e,n),AT=(n,e)=>(Be('TSL: "atan2" is overloaded. Use "atan" instead.'),yf(n,e)),fF=J1,dF=G1;fe("all",G8);fe("any",V8);fe("equals",J8);fe("radians",z8);fe("degrees",$8);fe("exp",q1);fe("exp2",iu);fe("log",gf);fe("log2",ys);fe("sqrt",pr);fe("inverseSqrt",G1);fe("floor",vs);fe("ceil",_f);fe("normalize",Mr);fe("fract",Wi);fe("sin",Rr);fe("cos",Ii);fe("tan",j8);fe("asin",H8);fe("acos",V1);fe("atan",yf);fe("abs",Xt);fe("sign",z1);fe("length",xs);fe("lengthSq",K1);fe("negate",$1);fe("oneMinus",W8);fe("dFdx",j1);fe("dFdy",H1);fe("round",Q8);fe("reciprocal",Y8);fe("trunc",W1);fe("fwidth",Q1);fe("atan2",AT);fe("min",Vr);fe("max",gn);fe("step",uT);fe("reflect",eT);fe("distance",tT);fe("dot",Si);fe("cross",io);fe("pow",gi);fe("pow2",Y1);fe("pow3",rT);fe("pow4",X1);fe("transformDirection",iT);fe("mix",aT);fe("clamp",Qi);fe("refract",Z1);fe("smoothstep",lT);fe("faceForward",J1);fe("difference",nT);fe("saturate",xf);fe("cbrt",sT);fe("transpose",X8);fe("determinant",K8);fe("inverse",Z8);fe("rand",oT);class pF extends Oe{static get type(){return"ConditionalNode"}constructor(e,t,r=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=r}getNodeType(e){const{ifNode:t,elseNode:r}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const i=t.getNodeType(e);if(r!==null){const s=r.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(i))return s}return i}setup(e){const t=this.condNode,r=this.ifNode.isolate(),i=this.elseNode?this.elseNode.isolate():null,s=e.context.nodeBlock;e.getDataFromNode(r).parentNodeBlock=s,i!==null&&(e.getDataFromNode(i).parentNodeBlock=s);const o=e.context.uniformFlow,a=e.getNodeProperties(this);a.condNode=t,a.ifNode=o?r:r.context({nodeBlock:r}),a.elseNode=i?o?i:i.context({nodeBlock:i}):null}generate(e,t){const r=this.getNodeType(e),i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:s,ifNode:o,elseNode:a}=e.getNodeProperties(this),c=e.currentFunctionNode,f=t!=="void",p=f?Qs(r).build(e):"";i.nodeProperty=p;const g=s.build(e,"bool");if(e.context.uniformFlow&&a!==null){const T=o.build(e,r),S=a.build(e,r),N=e.getTernary(g,T,S);return e.format(N,r,t)}e.addFlowCode(`
${e.tab}if ( ${g} ) {

`).addFlowTab();let b=o.build(e,r);if(b&&(f?b=p+" = "+b+";":(b="return "+b+";",c===null&&(Be("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),b="// "+b))),e.removeFlowTab().addFlowCode(e.tab+"	"+b+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let T=a.build(e,r);T&&(f?T=p+" = "+T+";":(T="return "+T+";",c===null&&(Be("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),T="// "+T))),e.removeFlowTab().addFlowCode(e.tab+"	"+T+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(p,r,t)}}const sr=Ze(pF).setParameterLength(2,3);fe("select",sr);class cT extends Oe{static get type(){return"ContextNode"}constructor(e=null,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getFlowContextData(){const e=[];return this.traverse(t=>{t.isContextNode===!0&&e.push(t.value)}),Object.assign({},...e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}setup(e){const t=e.addContext(this.value);this.node.build(e),e.setContext(t)}generate(e,t){const r=e.addContext(this.value),i=this.node.build(e,t);return e.setContext(r),i}}const lo=(n=null,e={})=>{let t=n;return(t===null||t.isNode!==!0)&&(e=t||e,t=null),new cT(t,e)},hT=n=>lo(n,{uniformFlow:!0}),e2=(n,e)=>lo(n,{nodeName:e});function fT(n,e,t=null){return lo(t,{getShadow:({light:r,shadowColorNode:i})=>e===r?i.mul(n):i})}function dT(n,e=null){return lo(e,{getAO:(t,{material:r})=>r.transparent===!0?t:t!==null?t.mul(n):n})}function pT(n,e){return Be('TSL: "label()" has been deprecated. Use "setName()" instead.'),e2(n,e)}fe("context",lo);fe("label",pT);fe("uniformFlow",hT);fe("setName",e2);fe("builtinShadowContext",(n,e,t)=>fT(e,t,n));fe("builtinAOContext",(n,e)=>dT(e,n));class P0 extends Oe{static get type(){return"VarNode"}constructor(e,t=null,r=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=r,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}isIntent(e){return e.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}isAssign(e){return e.getDataFromNode(this).assign}build(...e){const t=e[0];if(this._hasStack(t)===!1&&t.buildStage==="setup"&&(t.context.nodeLoop||t.context.nodeBlock)){let r=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&t.fnCall&&t.fnCall.shaderNode&&t.getDataFromNode(this.node.shaderNode).hasLoop){const o=t.getDataFromNode(this);o.forceDeclaration=!0,r=!0}const i=t.getBaseStack();r?i.addToStackBefore(this):i.addToStack(this)}return this.isIntent(t)&&this.isAssign(t)!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:r,readOnly:i}=this,{renderer:s}=e,o=s.backend.isWebGPUBackend===!0;let a=!1,c=!1;i&&(a=e.isDeterministic(t),c=o?i:a);const f=this.getNodeType(e);if(f=="void")return this.isIntent(e)!==!0&&Pe('TSL: ".toVar()" can not be used with void type.'),t.build(e);const p=e.getVectorType(f),g=t.build(e,p),v=e.getVarFromNode(this,r,p,void 0,c),b=e.getPropertyName(v);let T=b;if(c)if(o)T=a?`const ${b}`:`let ${b}`;else{const S=t.getArrayCount(e);T=`const ${e.getVar(v.type,b,S)}`}return e.addLineFlowCode(`${T} = ${g}`,this),b}_hasStack(e){return e.getDataFromNode(this).stack!==void 0}}const t2=Ze(P0),mT=(n,e=null)=>t2(n,e).toStack(),gT=(n,e=null)=>t2(n,e,!0).toStack(),_T=n=>t2(n).setIntent(!0).toStack();fe("toVar",mT);fe("toConst",gT);fe("toVarIntent",_T);class mF extends Oe{static get type(){return"SubBuild"}constructor(e,t,r=null){super(r),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const r=this.node.build(e,...t);return e.removeSubBuild(),r}}const zl=(n,e,t=null)=>Me(new mF(Me(n),e,t));class gF extends Oe{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let r=t.varying;if(r===void 0){const i=this.name,s=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=r=e.getVaryingFromNode(this,i,s,o,a),t.node=zl(this.node,"VERTEX")}return r.needsInterpolation||(r.needsInterpolation=e.shaderStage==="fragment"),r}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(tA.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(tA.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),r=e.getNodeProperties(this),i=this.setupVarying(e);if(r[t]===void 0){const s=this.getNodeType(e),o=e.getPropertyName(i,tA.VERTEX);e.flowNodeFromShaderStage(tA.VERTEX,r.node,s,o),r[t]=o}return e.getPropertyName(i)}}const Ps=Ze(gF).setParameterLength(1,2),yT=n=>Ps(n);fe("toVarying",Ps);fe("toVertexStage",yT);fe("varying",(...n)=>(Be("TSL: .varying() has been renamed to .toVarying()."),Ps(...n)));fe("vertexStage",(...n)=>(Be("TSL: .vertexStage() has been renamed to .toVertexStage()."),Ps(...n)));const vT=ee(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),r=n.lessThanEqual(.04045);return xt(e,t,r)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),xT=ee(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),r=n.lessThanEqual(.0031308);return xt(e,t,r)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),n2="WorkingColorSpace",_F="OutputColorSpace";class r2 extends _n{static get type(){return"ColorSpaceNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this.source=t,this.target=r}resolveColorSpace(e,t){return t===n2?xn.workingColorSpace:t===_F?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,r=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let s=t;return xn.enabled===!1||r===i||!r||!i||(xn.getTransfer(r)===ht&&(s=ze(vT(s.rgb),s.a)),xn.getPrimaries(r)!==xn.getPrimaries(i)&&(s=ze(or(xn._getMatrix(new jA,r,i)).mul(s.rgb),s.a)),xn.getTransfer(i)===ht&&(s=ze(xT(s.rgb),s.a))),s}}const bT=(n,e)=>Me(new r2(Me(n),n2,e)),bf=(n,e)=>Me(new r2(Me(n),e,n2)),yF=(n,e,t)=>Me(new r2(Me(n),e,t));fe("workingToColorSpace",bT);fe("colorSpaceToWorking",bf);let vF=class extends Ha{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}};class TT extends Oe{static get type(){return"ReferenceBaseNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.updateType=it.OBJECT}setGroup(e){return this.group=e,this}element(e){return new vF(this,Me(e))}setNodeType(e){const t=Ge(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const xF=(n,e,t)=>new TT(n,e,t);class bF extends TT{static get type(){return"RendererReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.renderer=r,this.setGroup(qe)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const wT=(n,e,t=null)=>new bF(n,e,t);class TF extends _n{static get type(){return"ToneMappingNode"}constructor(e,t=ET,r=null){super("vec3"),this._toneMapping=e,this.exposureNode=t,this.colorNode=r}customCacheKey(){return cA(this._toneMapping)}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup(e){const t=this.colorNode||e.context.color,r=this._toneMapping;if(r===Ea)return t;let i=null;const s=e.renderer.library.getToneMappingFunction(r);return s!==null?i=ze(s(t.rgb,this.exposureNode),t.a):(Pe("ToneMappingNode: Unsupported Tone Mapping configuration.",r),i=t),i}}const ST=(n,e,t)=>Me(new TF(n,Me(e),Me(t))),ET=wT("toneMappingExposure","float");fe("toneMapping",(n,e,t)=>ST(e,t,n));const X3=new WeakMap;function K3(n,e){let t=X3.get(n);return t===void 0&&(t=new mR(n,e),X3.set(n,t)),t}class xo extends b1{static get type(){return"BufferAttributeNode"}constructor(e,t=null,r=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=r,this.bufferOffset=i,this.usage=Kg,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&e.itemSize<=4&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),r=e.getTypeLength(t),i=this.value,s=this.bufferStride||r,o=this.bufferOffset;let a;i.isInterleavedBuffer===!0?a=i:i.isBufferAttribute===!0?a=K3(i.array,s):a=K3(i,s);const c=new Ra(a,r,o);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),r=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(r);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=i,s=i):s=Ps(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}function Tf(n,e=null,t=0,r=0,i=Kg,s=!1){return e==="mat3"||e===null&&n.itemSize===9?or(new xo(n,"vec3",9,0).setUsage(i).setInstanced(s),new xo(n,"vec3",9,3).setUsage(i).setInstanced(s),new xo(n,"vec3",9,6).setUsage(i).setInstanced(s)):e==="mat4"||e===null&&n.itemSize===16?qo(new xo(n,"vec4",16,0).setUsage(i).setInstanced(s),new xo(n,"vec4",16,4).setUsage(i).setInstanced(s),new xo(n,"vec4",16,8).setUsage(i).setInstanced(s),new xo(n,"vec4",16,12).setUsage(i).setInstanced(s)):new xo(n,e,t,r)}const i2=(n,e=null,t=0,r=0)=>Tf(n,e,t,r),wF=(n,e=null,t=0,r=0)=>Tf(n,e,t,r,Na),Ih=(n,e=null,t=0,r=0)=>Tf(n,e,t,r,Kg,!0),eg=(n,e=null,t=0,r=0)=>Tf(n,e,t,r,Na,!0);fe("toAttribute",n=>i2(n.value));class SF extends Oe{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=it.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return Be('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const r=e.getNodeProperties(this);r.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:r}=e;if(r==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const s2=(n,e=[64])=>{(e.length===0||e.length>3)&&Pe("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const r=e[t];(typeof r!="number"||r<=0||!Number.isInteger(r))&&Pe(`TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return Me(new SF(Me(n),e))},NT=(n,e,t)=>s2(n,t).setCount(e);fe("compute",NT);fe("computeKernel",s2);class EF extends Oe{static get type(){return"IsolateNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isIsolateNode=!0}getNodeType(e){const t=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e,...t){const r=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const s=this.node.build(e,...t);return e.setCache(r),s}setParent(e){return this.parent=e,this}getParent(){return this.parent}}const $l=n=>new EF(Me(n));function RT(n,e=!0){return Be('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),$l(n).setParent(e)}fe("cache",RT);fe("isolate",$l);class NF extends Oe{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const CT=Ze(NF).setParameterLength(2);fe("bypass",CT);class MT extends Oe{static get type(){return"RemapNode"}constructor(e,t,r,i=V(0),s=V(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=r,this.outLowNode=i,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:r,outLowNode:i,outHighNode:s,doClamp:o}=this;let a=e.sub(t).div(r.sub(t));return o===!0&&(a=a.clamp()),a.mul(s.sub(i)).add(i)}}const PT=Ze(MT,null,null,{doClamp:!1}).setParameterLength(3,5),BT=Ze(MT).setParameterLength(3,5);fe("remap",PT);fe("remapClamp",BT);class B0 extends Oe{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const r=this.getNodeType(e),i=this.snippet;if(r==="void")e.addLineFlowCode(i,this);else return e.format(i,r,t)}}const so=Ze(B0).setParameterLength(1,2),DT=n=>(n?sr(n,so("discard")):so("discard")).toStack(),RF=()=>so("return").toStack();fe("discard",DT);class CF extends _n{static get type(){return"RenderOutputNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this._toneMapping=t,this.outputColorSpace=r,this.isRenderOutputNode=!0}setToneMapping(e){return this._toneMapping=e,this}getToneMapping(){return this._toneMapping}setup({context:e}){let t=this.colorNode||e.color;const r=(this._toneMapping!==null?this._toneMapping:e.toneMapping)||Ea,i=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Wl;return r!==Ea&&(t=t.toneMapping(r)),i!==Wl&&i!==xn.workingColorSpace&&(t=t.workingToColorSpace(i)),t}}const LT=(n,e=null,t=null)=>Me(new CF(Me(n),e,t));fe("renderOutput",LT);class MF extends _n{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,r=this.node.build(e),i="--- TSL debug - "+e.shaderStage+" shader ---",s="-".repeat(i.length);let o="";return o+="// #"+i+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+r+` /* ... */
`,o+="// #"+s+`#
`,t!==null?t(e,o):_R(o),r}}const FT=(n,e=null)=>Me(new MF(Me(n),e)).toStack();fe("debug",FT);class OT{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(e){return this._renderer=e,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class PF extends Oe{static get type(){return"InspectorNode"}constructor(e,t="",r=null){super(),this.node=e,this.name=t,this.callback=r,this.updateType=it.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(e){e.renderer.inspector.inspect(this)}getNodeType(e){return this.node.getNodeType(e)}setup(e){let t=this.node;return e.context.inspector===!0&&this.callback!==null&&(t=this.callback(t)),e.renderer.backend.isWebGPUBackend!==!0&&e.renderer.inspector.constructor!==OT&&cn('TSL: ".toInspector()" is only available with WebGPU.'),t}}function IT(n,e="",t=null){return n=Me(n),n.before(new PF(n,e,t))}fe("toInspector",IT);function BF(n){Be("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",n)}class kT extends Oe{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const r=this.getAttributeName(e);if(e.hasGeometryAttribute(r)){const i=e.geometry.getAttribute(r);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),r=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),o=e.getTypeFromAttribute(s),a=e.getAttribute(t,o);return e.shaderStage==="vertex"?e.format(a.name,o,r):Ps(this).build(e,r)}else return Be(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(r)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const oo=(n,e=null)=>new kT(n,e),zt=(n=0)=>oo("uv"+(n>0?n:""),"vec2");class DF extends Oe{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const r=this.textureNode.build(e,"property"),i=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${r}, ${i} )`,this.getNodeType(e),t)}}const Ys=Ze(DF).setParameterLength(1,2);class LF extends XA{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=it.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,r=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(r&&r.width!==void 0){const{width:i,height:s}=r;this.value=Math.log2(Math.max(i,s))}}}const o2=Ze(LF).setParameterLength(1),a2=new Vg;class Es extends XA{static get type(){return"TextureNode"}constructor(e=a2,t=null,r=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=r,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=it.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Fn?"uvec4":this.value.type===wr?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return zt(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Ge(this.value.matrix)),this._matrixUniform.mul(X(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this}setupUV(e,t){return e.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=Ge(!1)),t=t.toVar(),this.sampler?t=this._flipYUniform.select(t.flipY(),t):t=this._flipYUniform.select(t.setY(Q(Ys(this,this.levelNode).y).sub(t.y).sub(1)),t)),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const r=this.value;if(!r||r.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");const i=ee(()=>{let o=this.uvNode;return(o===null||e.context.forceUVContext===!0)&&e.context.getUV&&(o=e.context.getUV(this,e)),o||(o=this.getDefaultUV()),this.updateMatrix===!0&&(o=this.getTransformedUV(o)),o=this.setupUV(e,o),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?it.OBJECT:it.NONE,o})();let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode,t.offsetNode=this.offsetNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateOffset(e,t){return t.build(e,"ivec2")}generateSnippet(e,t,r,i,s,o,a,c,f){const p=this.value;let g;return s?g=e.generateTextureBias(p,t,r,s,o,f):c?g=e.generateTextureGrad(p,t,r,c,o,f):a?g=e.generateTextureCompare(p,t,r,a,o,f):this.sampler===!1?g=e.generateTextureLoad(p,t,r,i,o,f):i?g=e.generateTextureLevel(p,t,r,i,o,f):g=e.generateTexture(p,t,r,o,f),g}generate(e,t){const r=this.value,i=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const o=e.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:p,levelNode:g,biasNode:v,compareNode:b,depthNode:T,gradNode:S,offsetNode:N}=i,C=this.generateUV(e,p),P=g?g.build(e,"float"):null,B=v?v.build(e,"float"):null,F=T?T.build(e,"int"):null,q=b?b.build(e,"float"):null,I=S?[S[0].build(e,"vec2"),S[1].build(e,"vec2")]:null,U=N?this.generateOffset(e,N):null,G=e.getVarFromNode(this);a=e.getPropertyName(G);const H=this.generateSnippet(e,s,C,P,B,F,q,I,U);e.addLineFlowCode(`${a} = ${H}`,this),o.snippet=H,o.propertyName=a}let c=a;const f=this.getNodeType(e);return e.needsToWorkingColorSpace(r)&&(c=bf(so(c,f),r.colorSpace).setup(e).build(e,f)),e.format(c,f,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return Be("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Me(e),t.referenceNode=this.getBase(),Me(t)}load(e){return this.sample(e).setSampler(!1)}blur(e){const t=this.clone();t.biasNode=Me(e).mul(o2(t)),t.referenceNode=this.getBase();const r=t.value;return t.generateMipmaps===!1&&(r&&r.generateMipmaps===!1||r.minFilter===ki||r.magFilter===ki)&&(Be("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Me(t)}level(e){const t=this.clone();return t.levelNode=Me(e),t.referenceNode=this.getBase(),Me(t)}size(e){return Ys(this,e)}bias(e){const t=this.clone();return t.biasNode=Me(e),t.referenceNode=this.getBase(),Me(t)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(e){const t=this.clone();return t.compareNode=Me(e),t.referenceNode=this.getBase(),Me(t)}grad(e,t){const r=this.clone();return r.gradNode=[Me(e),Me(t)],r.referenceNode=this.getBase(),Me(r)}depth(e){const t=this.clone();return t.depthNode=Me(e),t.referenceNode=this.getBase(),Me(t)}offset(e){const t=this.clone();return t.offsetNode=Me(e),t.referenceNode=this.getBase(),Me(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix();const r=this._flipYUniform;r!==null&&(r.value=e.image instanceof ImageBitmap&&e.flipY===!0||e.isRenderTargetTexture===!0||e.isFramebufferTexture===!0||e.isDepthTexture===!0)}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}const FF=Ze(Es).setParameterLength(1,4).setName("texture"),Rt=(n=a2,e=null,t=null,r=null)=>{let i;return n&&n.isTextureNode===!0?(i=Me(n.clone()),i.referenceNode=n.getBase(),e!==null&&(i.uvNode=Me(e)),t!==null&&(i.levelNode=Me(t)),r!==null&&(i.biasNode=Me(r))):i=FF(n,e,t,r),i},OF=(n=a2)=>Rt(n),vn=(...n)=>Rt(...n).setSampler(!1),IF=(n,e,t)=>Rt(n,e).level(t),kF=n=>(n.isNode===!0?n:Rt(n)).convert("sampler"),UF=n=>(n.isNode===!0?n:Rt(n)).convert("samplerComparison");class l2 extends XA{static get type(){return"BufferNode"}constructor(e,t,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=r,this.updateRanges=[]}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const ZA=(n,e,t)=>new l2(n,e,t);class qF extends Ha{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),r=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,r)}}class GF extends l2{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?Fo(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=it.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,r=this.elementType;if(r==="float"||r==="int"||r==="uint")for(let i=0;i<e.length;i++){const s=i*4;t[s]=e[i]}else if(r==="color")for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.r,t[s+1]=o.g,t[s+2]=o.b||0}else if(r==="mat2")for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+3]=o.elements[3]}else if(r==="mat3")for(let i=0;i<e.length;i++){const s=i*16,o=e[i];t[s]=o.elements[0],t[s+1]=o.elements[1],t[s+2]=o.elements[2],t[s+4]=o.elements[3],t[s+5]=o.elements[4],t[s+6]=o.elements[5],t[s+8]=o.elements[6],t[s+9]=o.elements[7],t[s+10]=o.elements[8],t[s+15]=1}else if(r==="mat4")for(let i=0;i<e.length;i++){const s=i*16,o=e[i];for(let a=0;a<o.elements.length;a++)t[s+a]=o.elements[a]}else for(let i=0;i<e.length;i++){const s=i*4,o=e[i];t[s]=o.x,t[s+1]=o.y,t[s+2]=o.z||0,t[s+3]=o.w||0}}setup(e){const t=this.array.length,r=this.elementType;let i=Float32Array;const s=this.paddedType,o=e.getTypeLength(s);return r.charAt(0)==="i"&&(i=Int32Array),r.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*o),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return new qF(this,Me(e))}}const dr=(n,e)=>new GF(n,e);class VF extends Oe{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const uo=Ze(VF).setParameterLength(1);let Mu,Pu;class Jt extends Oe{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Jt.DPR?"float":this.scope===Jt.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=it.NONE;return(this.scope===Jt.SIZE||this.scope===Jt.VIEWPORT||this.scope===Jt.DPR)&&(e=it.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Jt.VIEWPORT?t!==null?Pu.copy(t.viewport):(e.getViewport(Pu),Pu.multiplyScalar(e.getPixelRatio())):this.scope===Jt.DPR?this._output.value=e.getPixelRatio():t!==null?(Mu.width=t.width,Mu.height=t.height):e.getDrawingBufferSize(Mu)}setup(){const e=this.scope;let t=null;return e===Jt.SIZE?t=Ge(Mu||(Mu=new gt)):e===Jt.VIEWPORT?t=Ge(Pu||(Pu=new Vt)):e===Jt.DPR?t=Ge(1):t=xe(Qa.div(za)),this._output=t,t}generate(e){if(this.scope===Jt.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const r=e.getNodeProperties(za).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${r}.y - ${t}.y )`}return t}return super.generate(e)}}Jt.COORDINATE="coordinate";Jt.VIEWPORT="viewport";Jt.SIZE="size";Jt.UV="uv";Jt.DPR="dpr";const UT=Ce(Jt,Jt.DPR),Xs=Ce(Jt,Jt.UV),za=Ce(Jt,Jt.SIZE),Qa=Ce(Jt,Jt.COORDINATE),u2=Ce(Jt,Jt.VIEWPORT),A2=u2.zw,qT=Qa.sub(u2.xy),zF=qT.div(A2),$F=ee(()=>(Be('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),za),"vec2").once()(),Yo=Ge(0,"uint").setName("u_cameraIndex").setGroup(mf("cameraIndex")).toVarying("v_cameraIndex"),Bo=Ge("float").setName("cameraNear").setGroup(qe).onRenderUpdate(({camera:n})=>n.near),Do=Ge("float").setName("cameraFar").setGroup(qe).onRenderUpdate(({camera:n})=>n.far),Ks=ee(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.projectionMatrix);e=dr(t).setGroup(qe).setName("cameraProjectionMatrices").element(n.isMultiViewCamera?uo("gl_ViewID_OVR"):Yo).toConst("cameraProjectionMatrix")}else e=Ge("mat4").setName("cameraProjectionMatrix").setGroup(qe).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),jF=ee(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.projectionMatrixInverse);e=dr(t).setGroup(qe).setName("cameraProjectionMatricesInverse").element(n.isMultiViewCamera?uo("gl_ViewID_OVR"):Yo).toConst("cameraProjectionMatrixInverse")}else e=Ge("mat4").setName("cameraProjectionMatrixInverse").setGroup(qe).onRenderUpdate(({camera:t})=>t.projectionMatrixInverse);return e}).once()(),Mi=ee(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.matrixWorldInverse);e=dr(t).setGroup(qe).setName("cameraViewMatrices").element(n.isMultiViewCamera?uo("gl_ViewID_OVR"):Yo).toConst("cameraViewMatrix")}else e=Ge("mat4").setName("cameraViewMatrix").setGroup(qe).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),HF=ee(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.matrixWorld);e=dr(t).setGroup(qe).setName("cameraWorldMatrices").element(n.isMultiViewCamera?uo("gl_ViewID_OVR"):Yo).toConst("cameraWorldMatrix")}else e=Ge("mat4").setName("cameraWorldMatrix").setGroup(qe).onRenderUpdate(({camera:t})=>t.matrixWorld);return e}).once()(),WF=ee(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.normalMatrix);e=dr(t).setGroup(qe).setName("cameraNormalMatrices").element(n.isMultiViewCamera?uo("gl_ViewID_OVR"):Yo).toConst("cameraNormalMatrix")}else e=Ge("mat3").setName("cameraNormalMatrix").setGroup(qe).onRenderUpdate(({camera:t})=>t.normalMatrix);return e}).once()(),GT=ee(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(let i=0,s=n.cameras.length;i<s;i++)t.push(new we);e=dr(t).setGroup(qe).setName("cameraPositions").onRenderUpdate(({camera:i},s)=>{const o=i.cameras,a=s.array;for(let c=0,f=o.length;c<f;c++)a[c].setFromMatrixPosition(o[c].matrixWorld)}).element(n.isMultiViewCamera?uo("gl_ViewID_OVR"):Yo).toConst("cameraPosition")}else e=Ge(new we).setName("cameraPosition").setGroup(qe).onRenderUpdate(({camera:t},r)=>r.value.setFromMatrixPosition(t.matrixWorld));return e}).once()(),QF=ee(({camera:n})=>{let e;if(n.isArrayCamera&&n.cameras.length>0){const t=[];for(const i of n.cameras)t.push(i.viewport);e=dr(t,"vec4").setGroup(qe).setName("cameraViewports").element(Yo).toConst("cameraViewport")}else e=ze(0,0,za.x,za.y).toConst("cameraViewport");return e}).once()(),Z3=new Xg;class vt extends Oe{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=it.OBJECT,this.uniformNode=new XA(null)}getNodeType(){const e=this.scope;if(e===vt.WORLD_MATRIX)return"mat4";if(e===vt.POSITION||e===vt.VIEW_POSITION||e===vt.DIRECTION||e===vt.SCALE)return"vec3";if(e===vt.RADIUS)return"float"}update(e){const t=this.object3d,r=this.uniformNode,i=this.scope;if(i===vt.WORLD_MATRIX)r.value=t.matrixWorld;else if(i===vt.POSITION)r.value=r.value||new we,r.value.setFromMatrixPosition(t.matrixWorld);else if(i===vt.SCALE)r.value=r.value||new we,r.value.setFromMatrixScale(t.matrixWorld);else if(i===vt.DIRECTION)r.value=r.value||new we,t.getWorldDirection(r.value);else if(i===vt.VIEW_POSITION){const s=e.camera;r.value=r.value||new we,r.value.setFromMatrixPosition(t.matrixWorld),r.value.applyMatrix4(s.matrixWorldInverse)}else if(i===vt.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),Z3.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),r.value=Z3.radius}}generate(e){const t=this.scope;return t===vt.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===vt.POSITION||t===vt.VIEW_POSITION||t===vt.DIRECTION||t===vt.SCALE?this.uniformNode.nodeType="vec3":t===vt.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}vt.WORLD_MATRIX="worldMatrix";vt.POSITION="position";vt.SCALE="scale";vt.VIEW_POSITION="viewPosition";vt.DIRECTION="direction";vt.RADIUS="radius";const YF=Ze(vt,vt.DIRECTION).setParameterLength(1),XF=Ze(vt,vt.WORLD_MATRIX).setParameterLength(1),VT=Ze(vt,vt.POSITION).setParameterLength(1),KF=Ze(vt,vt.SCALE).setParameterLength(1),ZF=Ze(vt,vt.VIEW_POSITION).setParameterLength(1),JF=Ze(vt,vt.RADIUS).setParameterLength(1);class Ei extends vt{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const eO=Ce(Ei,Ei.DIRECTION),_i=Ce(Ei,Ei.WORLD_MATRIX),tO=Ce(Ei,Ei.POSITION),nO=Ce(Ei,Ei.SCALE),rO=Ce(Ei,Ei.VIEW_POSITION),iO=Ce(Ei,Ei.RADIUS),zT=Ge(new jA).onObjectUpdate(({object:n},e)=>e.value.getNormalMatrix(n.matrixWorld)),sO=Ge(new hn).onObjectUpdate(({object:n},e)=>e.value.copy(n.matrixWorld).invert()),Xo=ee(n=>n.context.modelViewMatrix||$T).once()().toVar("modelViewMatrix"),$T=Mi.mul(_i),tg=ee(n=>(n.context.isHighPrecisionModelViewMatrix=!0,Ge("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),ng=ee(n=>{const e=n.context.isHighPrecisionModelViewMatrix;return Ge("mat3").onObjectUpdate(({object:t,camera:r})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),JA=oo("position","vec3"),fn=JA.toVarying("positionLocal"),kh=JA.toVarying("positionPrevious"),bs=ee(n=>_i.mul(fn).xyz.toVarying(n.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),c2=ee(()=>fn.transformDirection(_i).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),Nn=ee(n=>n.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),Ht=ee(n=>{let e;return n.camera.isOrthographicCamera?e=X(0,0,1):e=Nn.negate().toVarying("v_positionViewDirection").normalize(),e.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class oO extends Oe{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){if(e.shaderStage!=="fragment")return"true";const{material:t}=e;return t.side===mr?"false":e.getFrontFacing()}}const jT=Ce(oO),h2=V(jT).mul(2).sub(1),hu=ee(([n],{material:e})=>{const t=e.side;return t===mr?n=n.mul(-1):t===vi&&(n=n.mul(h2)),n}),wf=oo("normal","vec3"),zr=ee(n=>n.geometry.hasAttribute("normal")===!1?(Be('TSL: Vertex attribute "normal" not found on geometry.'),X(0,1,0)):wf,"vec3").once()().toVar("normalLocal"),HT=Nn.dFdx().cross(Nn.dFdy()).normalize().toVar("normalFlat"),su=ee(n=>{let e;return n.material.flatShading===!0?e=HT:e=f2(zr).toVarying("v_normalViewGeometry").normalize(),e},"vec3").once()().toVar("normalViewGeometry"),WT=ee(n=>{let e=su.transformDirection(Mi);return n.material.flatShading!==!0&&(e=e.toVarying("v_normalWorldGeometry")),e.normalize().toVar("normalWorldGeometry")},"vec3").once()(),St=ee(({subBuildFn:n,material:e,context:t})=>{let r;return n==="NORMAL"||n==="VERTEX"?(r=su,e.flatShading!==!0&&(r=hu(r))):r=t.setupNormal().context({getUV:null}),r},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),Ko=St.transformDirection(Mi).toVar("normalWorld"),Ba=ee(({subBuildFn:n,context:e})=>{let t;return n==="NORMAL"||n==="VERTEX"?t=St:t=e.setupClearcoatNormal().context({getUV:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),QT=ee(([n,e=_i])=>{const t=or(e),r=n.div(X(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(r).xyz}),f2=ee(([n],e)=>{const t=e.context.modelNormalViewMatrix;if(t)return t.transformDirection(n);const r=zT.mul(n);return Mi.transformDirection(r)}),aO=ee(()=>(Be('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),St)).once(["NORMAL","VERTEX"])(),lO=ee(()=>(Be('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),Ko)).once(["NORMAL","VERTEX"])(),uO=ee(()=>(Be('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),Ba)).once(["NORMAL","VERTEX"])(),J3=new bA,Qd=new hn,YT=Ge(0).onReference(({material:n})=>n).onObjectUpdate(({material:n})=>n.refractionRatio),D0=Ge(1).onReference(({material:n})=>n).onObjectUpdate(function({material:n,scene:e}){return n.envMap?n.envMapIntensity:e.environmentIntensity}),d2=Ge(new hn).onReference(function(n){return n.material}).onObjectUpdate(function({material:n,scene:e}){const t=e.environment!==null&&n.envMap===null?e.environmentRotation:n.envMapRotation;return t?(J3.copy(t),Qd.makeRotationFromEuler(J3)):Qd.identity(),Qd}),XT=Ht.negate().reflect(St),KT=Ht.negate().refract(St,YT),ZT=XT.transformDirection(Mi).toVar("reflectVector"),JT=KT.transformDirection(Mi).toVar("reflectVector"),e6=new Gg;class AO extends Es{static get type(){return"CubeTextureNode"}constructor(e,t=null,r=null,i=null){super(e,t,r,i),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===W0?ZT:e.mapping===Q0?JT:(Pe('CubeTextureNode: Mapping "%s" not supported.',e.mapping),X(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return r.isDepthTexture===!0?e.renderer.coordinateSystem===Vo?X(t.x,t.y.negate(),t.z):t:((e.renderer.coordinateSystem===Vo||!r.isRenderTargetTexture)&&(t=X(t.x.negate(),t.yz)),d2.mul(t))}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}}const p2=Ze(AO).setParameterLength(1,4).setName("cubeTexture"),Cr=(n=e6,e=null,t=null,r=null)=>{let i;return n&&n.isCubeTextureNode===!0?(i=Me(n.clone()),i.referenceNode=n,e!==null&&(i.uvNode=Me(e)),t!==null&&(i.levelNode=Me(t)),r!==null&&(i.biasNode=Me(r))):i=p2(n,e,t,r),i},cO=(n=e6)=>p2(n);class hO extends Ha{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,r,i)}}class Sf extends Oe{static get type(){return"ReferenceNode"}constructor(e,t,r=null,i=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=i,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.name=null,this.updateType=it.OBJECT}element(e){return new hO(this,Me(e))}setGroup(e){return this.group=e,this}setName(e){return this.name=e,this}label(e){return Be('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setNodeType(e){let t=null;this.count!==null?t=ZA(null,e,this.count):Array.isArray(this.getValueFromReference())?t=dr(null,e):e==="texture"?t=Rt(null):e==="cubeTexture"?t=Cr(null):t=Ge(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.setName(this.name),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let i=1;i<t.length;i++)r=r[t[i]];return r}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const qt=(n,e,t)=>new Sf(n,e,t),rg=(n,e,t,r)=>new Sf(n,e,r,t);class fO extends Sf{static get type(){return"MaterialReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.material=r,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Gs=(n,e,t=null)=>new fO(n,e,t),t6=zt(),dO=Nn.dFdx(),pO=Nn.dFdy(),n6=t6.dFdx(),r6=t6.dFdy(),i6=St,s6=pO.cross(i6),o6=i6.cross(dO),ig=s6.mul(n6.x).add(o6.mul(r6.x)),sg=s6.mul(n6.y).add(o6.mul(r6.y)),ev=ig.dot(ig).max(sg.dot(sg)),a6=ev.equal(0).select(0,ev.inverseSqrt()),mO=ig.mul(a6).toVar("tangentViewFrame"),gO=sg.mul(a6).toVar("bitangentViewFrame"),Ef=oo("tangent","vec4"),ec=Ef.xyz.toVar("tangentLocal"),Nf=ee(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=Xo.mul(ze(ec,0)).xyz.toVarying("v_tangentView").normalize():r=mO,t.flatShading!==!0&&(r=hu(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),l6=Nf.transformDirection(Mi).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),Rf=ee(([n,e],{subBuildFn:t,material:r})=>{let i=n.mul(Ef.w).xyz;return t==="NORMAL"&&r.flatShading!==!0&&(i=i.toVarying(e)),i}).once(["NORMAL"]),_O=Rf(wf.cross(Ef),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),yO=Rf(zr.cross(ec),"v_bitangentLocal").normalize().toVar("bitangentLocal"),u6=ee(({subBuildFn:n,geometry:e,material:t})=>{let r;return n==="VERTEX"||e.hasAttribute("tangent")?r=Rf(St.cross(Nf),"v_bitangentView").normalize():r=gO,t.flatShading!==!0&&(r=hu(r)),r},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),vO=Rf(Ko.cross(l6),"v_bitangentWorld").normalize().toVar("bitangentWorld"),Da=or(Nf,u6,St).toVar("TBNViewMatrix"),A6=Ht.mul(Da),xO=(n,e)=>n.sub(A6.mul(e)),c6=ee(()=>{let n=ka.cross(Ht);return n=n.cross(ka).normalize(),n=xt(n,St,Co.mul(hs.oneMinus()).oneMinus().pow2().pow2()).normalize(),n}).once()(),h6=n=>Me(n).mul(.5).add(.5),bO=n=>Me(n).mul(2).sub(1),og=n=>X(n,pr(xf(V(1).sub(Si(n,n)))));class TO extends _n{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Pd,this.unpackNormalMode=Bd}setup({material:e}){const{normalMapType:t,scaleNode:r,unpackNormalMode:i}=this;let s=this.node.mul(2).sub(1);if(t===Pd?i===Cb?s=og(s.xy):i===fR?s=og(s.yw):i!==Bd&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${i}`):i!==Bd&&console.error(`THREE.NodeMaterial: Normal map type '${t}' is not compatible with unpack normal mode '${i}'`),r!==null){let a=r;e.flatShading===!0&&(a=hu(a)),s=X(s.xy.mul(a),s.z)}let o=null;return t===dR?o=f2(s):t===Pd?o=Da.mul(s).normalize():(Pe(`NodeMaterial: Unsupported normal map type: ${t}`),o=St),o}}const ag=Ze(TO).setParameterLength(1,2),wO=ee(({textureNode:n,bumpScale:e})=>{const t=i=>n.isolate().context({getUV:s=>i(s.uvNode||zt()),forceUVContext:!0}),r=V(t(i=>i));return xe(V(t(i=>i.add(i.dFdx()))).sub(r),V(t(i=>i.add(i.dFdy()))).sub(r)).mul(e)}),SO=ee(n=>{const{surf_pos:e,surf_norm:t,dHdxy:r}=n,i=e.dFdx().normalize(),s=e.dFdy().normalize(),o=t,a=s.cross(o),c=o.cross(i),f=i.dot(a).mul(h2),p=f.sign().mul(r.x.mul(a).add(r.y.mul(c)));return f.abs().mul(t).sub(p).normalize()});class EO extends _n{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=wO({textureNode:this.textureNode,bumpScale:e});return SO({surf_pos:Nn,surf_norm:St,dHdxy:t})}}const m2=Ze(EO).setParameterLength(1,2),tv=new Map;class de extends Oe{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let r=tv.get(e);return r===void 0&&(r=Gs(e,t),tv.set(e,r)),r}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,r=this.scope;let i=null;if(r===de.COLOR){const s=t.color!==void 0?this.getColor(r):X();t.map&&t.map.isTexture===!0?i=s.mul(this.getTexture("map")):i=s}else if(r===de.OPACITY){const s=this.getFloat(r);t.alphaMap&&t.alphaMap.isTexture===!0?i=s.mul(this.getTexture("alpha")):i=s}else if(r===de.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=V(1);else if(r===de.SPECULAR_INTENSITY){const s=this.getFloat(r);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s}else if(r===de.SPECULAR_COLOR){const s=this.getColor(r);t.specularColorMap&&t.specularColorMap.isTexture===!0?i=s.mul(this.getTexture(r).rgb):i=s}else if(r===de.ROUGHNESS){const s=this.getFloat(r);t.roughnessMap&&t.roughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).g):i=s}else if(r===de.METALNESS){const s=this.getFloat(r);t.metalnessMap&&t.metalnessMap.isTexture===!0?i=s.mul(this.getTexture(r).b):i=s}else if(r===de.EMISSIVE){const s=this.getFloat("emissiveIntensity"),o=this.getColor(r).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?i=o.mul(this.getTexture(r)):i=o}else if(r===de.NORMAL)t.normalMap?(i=ag(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType,(t.normalMap.format==zs||t.normalMap.format==H0||t.normalMap.format==j0)&&(i.unpackNormalMode=Cb)):t.bumpMap?i=m2(this.getTexture("bump").r,this.getFloat("bumpScale")):i=St;else if(r===de.CLEARCOAT){const s=this.getFloat(r);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===de.CLEARCOAT_ROUGHNESS){const s=this.getFloat(r);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).r):i=s}else if(r===de.CLEARCOAT_NORMAL)t.clearcoatNormalMap?i=ag(this.getTexture(r),this.getCache(r+"Scale","vec2")):i=St;else if(r===de.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?i=s.mul(this.getTexture("sheenColor").rgb):i=s}else if(r===de.SHEEN_ROUGHNESS){const s=this.getFloat(r);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(r).a):i=s,i=i.clamp(1e-4,1)}else if(r===de.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(r);i=df(El.x,El.y,El.y.negate(),El.x).mul(s.rg.mul(2).sub(xe(1)).normalize().mul(s.b))}else i=El;else if(r===de.IRIDESCENCE_THICKNESS){const s=qt("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const o=qt("0","float",t.iridescenceThicknessRange);i=s.sub(o).mul(this.getTexture(r).g).add(o)}else i=s}else if(r===de.TRANSMISSION){const s=this.getFloat(r);t.transmissionMap?i=s.mul(this.getTexture(r).r):i=s}else if(r===de.THICKNESS){const s=this.getFloat(r);t.thicknessMap?i=s.mul(this.getTexture(r).g):i=s}else if(r===de.IOR)i=this.getFloat(r);else if(r===de.LIGHT_MAP)i=this.getTexture(r).rgb.mul(this.getFloat("lightMapIntensity"));else if(r===de.AO)i=this.getTexture(r).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(r===de.LINE_DASH_OFFSET)i=t.dashOffset?this.getFloat(r):V(0);else{const s=this.getNodeType(e);i=this.getCache(r,s)}return i}}de.ALPHA_TEST="alphaTest";de.COLOR="color";de.OPACITY="opacity";de.SHININESS="shininess";de.SPECULAR="specular";de.SPECULAR_STRENGTH="specularStrength";de.SPECULAR_INTENSITY="specularIntensity";de.SPECULAR_COLOR="specularColor";de.REFLECTIVITY="reflectivity";de.ROUGHNESS="roughness";de.METALNESS="metalness";de.NORMAL="normal";de.CLEARCOAT="clearcoat";de.CLEARCOAT_ROUGHNESS="clearcoatRoughness";de.CLEARCOAT_NORMAL="clearcoatNormal";de.EMISSIVE="emissive";de.ROTATION="rotation";de.SHEEN="sheen";de.SHEEN_ROUGHNESS="sheenRoughness";de.ANISOTROPY="anisotropy";de.IRIDESCENCE="iridescence";de.IRIDESCENCE_IOR="iridescenceIOR";de.IRIDESCENCE_THICKNESS="iridescenceThickness";de.IOR="ior";de.TRANSMISSION="transmission";de.THICKNESS="thickness";de.ATTENUATION_DISTANCE="attenuationDistance";de.ATTENUATION_COLOR="attenuationColor";de.LINE_SCALE="scale";de.LINE_DASH_SIZE="dashSize";de.LINE_GAP_SIZE="gapSize";de.LINE_WIDTH="linewidth";de.LINE_DASH_OFFSET="dashOffset";de.POINT_SIZE="size";de.DISPERSION="dispersion";de.LIGHT_MAP="light";de.AO="ao";const f6=Ce(de,de.ALPHA_TEST),d6=Ce(de,de.COLOR),p6=Ce(de,de.SHININESS),m6=Ce(de,de.EMISSIVE),g2=Ce(de,de.OPACITY),g6=Ce(de,de.SPECULAR),lg=Ce(de,de.SPECULAR_INTENSITY),_6=Ce(de,de.SPECULAR_COLOR),pA=Ce(de,de.SPECULAR_STRENGTH),L0=Ce(de,de.REFLECTIVITY),y6=Ce(de,de.ROUGHNESS),v6=Ce(de,de.METALNESS),x6=Ce(de,de.NORMAL),b6=Ce(de,de.CLEARCOAT),T6=Ce(de,de.CLEARCOAT_ROUGHNESS),w6=Ce(de,de.CLEARCOAT_NORMAL),S6=Ce(de,de.ROTATION),E6=Ce(de,de.SHEEN),N6=Ce(de,de.SHEEN_ROUGHNESS),R6=Ce(de,de.ANISOTROPY),C6=Ce(de,de.IRIDESCENCE),M6=Ce(de,de.IRIDESCENCE_IOR),P6=Ce(de,de.IRIDESCENCE_THICKNESS),B6=Ce(de,de.TRANSMISSION),D6=Ce(de,de.THICKNESS),L6=Ce(de,de.IOR),F6=Ce(de,de.ATTENUATION_DISTANCE),O6=Ce(de,de.ATTENUATION_COLOR),I6=Ce(de,de.LINE_SCALE),k6=Ce(de,de.LINE_DASH_SIZE),U6=Ce(de,de.LINE_GAP_SIZE),NO=Ce(de,de.LINE_WIDTH),q6=Ce(de,de.LINE_DASH_OFFSET),G6=Ce(de,de.POINT_SIZE),V6=Ce(de,de.DISPERSION),_2=Ce(de,de.LIGHT_MAP),z6=Ce(de,de.AO),El=Ge(new gt).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))}),$6=ee(n=>n.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class RO extends Ha{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const r=this.storageBufferNode.structTypeNode;return r?r.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let r;const i=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&i!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?r=e.generatePBO(this):r=this.node.build(e):r=super.generate(e),i!==!0){const s=this.getNodeType(e);r=e.format(r,s,t)}return r}}const CO=Ze(RO).setParameterLength(2);class MO extends l2{static get type(){return"StorageBufferNode"}constructor(e,t=null,r=0){let i,s=null;t&&t.isStruct?(i="struct",s=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(r=e.count)):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(i=e8(e.itemSize),r=e.count):i=t,super(e,i,r),this.isStorageBufferNode=!0,this.structTypeNode=s,this.access=ir.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return CO(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(ir.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=i2(this.value),this._varying=Ps(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return this.structTypeNode!==null?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:r}=this.getAttributeData(),i=r.build(e);return e.registerTransform(i,t),i}}const Zs=(n,e=null,t=0)=>new MO(n,e,t),PO=(n,e,t)=>(Be('TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),Zs(n,e,t).setPBO(!0));class sn extends Oe{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),r=this.scope;let i;if(r===sn.VERTEX)i=e.getVertexIndex();else if(r===sn.INSTANCE)i=e.getInstanceIndex();else if(r===sn.DRAW)i=e.getDrawIndex();else if(r===sn.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(r===sn.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(r===sn.SUBGROUP)i=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+r);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=i:s=Ps(this).build(e,t),s}}sn.VERTEX="vertex";sn.INSTANCE="instance";sn.SUBGROUP="subgroup";sn.INVOCATION_LOCAL="invocationLocal";sn.INVOCATION_SUBGROUP="invocationSubgroup";sn.DRAW="draw";const j6=Ce(sn,sn.VERTEX),Ts=Ce(sn,sn.INSTANCE),BO=Ce(sn,sn.SUBGROUP),DO=Ce(sn,sn.INVOCATION_SUBGROUP),LO=Ce(sn,sn.INVOCATION_LOCAL),H6=Ce(sn,sn.DRAW);class W6 extends Oe{static get type(){return"InstanceNode"}constructor(e,t,r=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=r,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=it.FRAME,this.buffer=null,this.bufferColor=null}get isStorageMatrix(){const{instanceMatrix:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:e}=this;return e&&e.isStorageInstancedBufferAttribute===!0}setup(e){const{instanceMatrix:t,instanceColor:r,isStorageMatrix:i,isStorageColor:s}=this,{count:o}=t;let{instanceMatrixNode:a,instanceColorNode:c}=this;if(a===null){if(i)a=Zs(t,"mat4",Math.max(o,1)).element(Ts);else if(o<=1e3)a=ZA(t.array,"mat4",Math.max(o,1)).element(Ts);else{const p=new Y0(t.array,16,1);this.buffer=p;const g=t.usage===Na?eg:Ih,v=[g(p,"vec4",16,0),g(p,"vec4",16,4),g(p,"vec4",16,8),g(p,"vec4",16,12)];a=qo(...v)}this.instanceMatrixNode=a}if(r&&c===null){if(s)c=Zs(r,"vec3",Math.max(r.count,1)).element(Ts);else{const p=new Ol(r.array,3),g=r.usage===Na?eg:Ih;this.bufferColor=p,c=X(g(p,"vec3",3,0))}this.instanceColorNode=c}const f=a.mul(fn).xyz;if(fn.assign(f),e.hasGeometryAttribute("normal")){const p=QT(zr,a);zr.assign(p)}this.instanceColorNode!==null&&OA("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==Na&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==Na&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}const FO=Ze(W6).setParameterLength(2,3);class OO extends W6{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:r,instanceColor:i}=e;super(t,r,i),this.instancedMesh=e}}const Q6=Ze(OO).setParameterLength(1);class IO extends Oe{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Ts:this.batchingIdNode=H6);const r=ee(([T])=>{const S=Q(Ys(vn(this.batchMesh._indirectTexture),0).x).toConst(),N=Q(T).mod(S).toConst(),C=Q(T).div(S).toConst();return vn(this.batchMesh._indirectTexture,Dn(N,C)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Q(this.batchingIdNode)),i=this.batchMesh._matricesTexture,s=Q(Ys(vn(i),0).x).toConst(),o=V(r).mul(4).toInt().toConst(),a=o.mod(s).toConst(),c=o.div(s).toConst(),f=qo(vn(i,Dn(a,c)),vn(i,Dn(a.add(1),c)),vn(i,Dn(a.add(2),c)),vn(i,Dn(a.add(3),c))),p=this.batchMesh._colorsTexture;if(p!==null){const S=ee(([N])=>{const C=Q(Ys(vn(p),0).x).toConst(),P=N,B=P.mod(C).toConst(),F=P.div(C).toConst();return vn(p,Dn(B,F)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(r);OA("vec3","vBatchColor").assign(S)}const g=or(f);fn.assign(f.mul(fn));const v=zr.div(X(g[0].dot(g[0]),g[1].dot(g[1]),g[2].dot(g[2]))),b=g.mul(v).xyz;zr.assign(b),e.hasGeometryAttribute("tangent")&&ec.mulAssign(g)}}const Y6=Ze(IO).setParameterLength(1),nv=new WeakMap;class X6 extends Oe{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=it.OBJECT,this.skinIndexNode=oo("skinIndex","uvec4"),this.skinWeightNode=oo("skinWeight","vec4"),this.bindMatrixNode=qt("bindMatrix","mat4"),this.bindMatrixInverseNode=qt("bindMatrixInverse","mat4"),this.boneMatricesNode=rg("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=fn,this.toPositionNode=fn,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(r.x),c=e.element(r.y),f=e.element(r.z),p=e.element(r.w),g=s.mul(t),v=Mn(a.mul(i.x).mul(g),c.mul(i.y).mul(g),f.mul(i.z).mul(g),p.mul(i.w).mul(g));return o.mul(v).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=zr){const{skinIndexNode:r,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:o}=this,a=e.element(r.x),c=e.element(r.y),f=e.element(r.z),p=e.element(r.w);let g=Mn(i.x.mul(a),i.y.mul(c),i.z.mul(f),i.w.mul(p));return g=o.mul(g).mul(s),g.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=rg("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,kh)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||n8(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&kh.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const r=this.getSkinnedNormal();zr.assign(r),e.hasGeometryAttribute("tangent")&&ec.assign(r)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;nv.get(t)!==e.frameId&&(nv.set(t,e.frameId),this.previousBoneMatricesNode!==null&&(t.previousBoneMatrices===null&&(t.previousBoneMatrices=new Float32Array(t.boneMatrices)),t.previousBoneMatrices.set(t.boneMatrices)),t.update())}}const K6=n=>new X6(n),kO=(n,e=null)=>{const t=new X6(n);return t.positionNode=Zs(new Ol(n.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(Ts).toVar(),t.skinIndexNode=Zs(new Ol(new Uint32Array(n.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(Ts).toVar(),t.skinWeightNode=Zs(new Ol(n.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(Ts).toVar(),t.bindMatrixNode=Ge(n.bindMatrix,"mat4"),t.bindMatrixInverseNode=Ge(n.bindMatrixInverse,"mat4"),t.boneMatricesNode=ZA(n.skeleton.boneMatrices,"mat4",n.skeleton.bones.length),t.toPositionNode=e,Me(t)};class UO extends Oe{static get type(){return"LoopNode"}constructor(e=[]){super("void"),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const r={};for(let a=0,c=this.params.length-1;a<c;a++){const f=this.params[a],p=f.isNode!==!0&&f.name||this.getVarName(a),g=f.isNode!==!0&&f.type||"int";r[p]=so(p,g)}const i=e.addStack(),s=this.params[this.params.length-1](r);t.returnsNode=s.context({nodeLoop:s}),t.stackNode=i;const o=this.params[0];if(o.isNode!==!0&&typeof o.update=="function"){const a=ee(this.params[0].update)(r);t.updateNode=a.context({nodeLoop:a})}return e.removeStack(),t}setup(e){if(this.getProperties(e),e.fnCall){const t=e.getDataFromNode(e.fnCall.shaderNode);t.hasLoop=!0}}generate(e){const t=this.getProperties(e),r=this.params,i=t.stackNode;for(let o=0,a=r.length-1;o<a;o++){const c=r[o];let f=!1,p=null,g=null,v=null,b=null,T=null,S=null;c.isNode?c.getNodeType(e)==="bool"?(f=!0,b="bool",g=c.build(e,b)):(b="int",v=this.getVarName(o),p="0",g=c.build(e,b),T="<"):(b=c.type||"int",v=c.name||this.getVarName(o),p=c.start,g=c.end,T=c.condition,S=c.update,typeof p=="number"?p=e.generateConst(b,p):p&&p.isNode&&(p=p.build(e,b)),typeof g=="number"?g=e.generateConst(b,g):g&&g.isNode&&(g=g.build(e,b)),p!==void 0&&g===void 0?(p=p+" - 1",g="0",T=">="):g!==void 0&&p===void 0&&(p="0",T="<"),T===void 0&&(Number(p)>Number(g)?T=">=":T="<"));let N;if(f)N=`while ( ${g} )`;else{const C={start:p,end:g},P=C.start,B=C.end;let F;const q=()=>T.includes("<")?"+=":"-=";if(S!=null)switch(typeof S){case"function":F=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":F=v+" "+q()+" "+e.generateConst(b,S);break;case"string":F=v+" "+S;break;default:S.isNode?F=v+" "+q()+" "+S.build(e):(Pe("TSL: 'Loop( { update: ... } )' is not a function, string or number."),F="break /* invalid update */")}else b==="int"||b==="uint"?S=T.includes("<")?"++":"--":S=q()+" 1.",F=v+" "+S;const I=e.getVar(b,v)+" = "+P,U=v+" "+T+" "+B;N=`for ( ${I}; ${U}; ${F} )`}e.addFlowCode((o===0?`
`:"")+e.tab+N+` {

`).addFlowTab()}const s=i.build(e,"void");t.returnsNode.build(e,"void"),e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let o=0,a=this.params.length-1;o<a;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();e.addFlowTab()}}const It=(...n)=>new UO(Ia(n,"int")).toStack(),qO=()=>so("continue").toStack(),Z6=()=>so("break").toStack(),Yd=new WeakMap,Qr=new Vt,rv=ee(({bufferMap:n,influence:e,stride:t,width:r,depth:i,offset:s})=>{const o=Q(j6).mul(t).add(s),a=o.div(r),c=o.sub(a.mul(r));return vn(n,Dn(c,a)).depth(i).xyz.mul(e)});function GO(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,r=n.morphAttributes.color!==void 0,i=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,s=i!==void 0?i.length:0;let o=Yd.get(n);if(o===void 0||o.count!==s){let C=function(){S.dispose(),Yd.delete(n),n.removeEventListener("dispose",C)};o!==void 0&&o.texture.dispose();const a=n.morphAttributes.position||[],c=n.morphAttributes.normal||[],f=n.morphAttributes.color||[];let p=0;e===!0&&(p=1),t===!0&&(p=2),r===!0&&(p=3);let g=n.attributes.position.count*p,v=1;const b=4096;g>b&&(v=Math.ceil(g/b),g=b);const T=new Float32Array(g*v*4*s),S=new pR(T,g,v,s);S.type=mi,S.needsUpdate=!0;const N=p*4;for(let P=0;P<s;P++){const B=a[P],F=c[P],q=f[P],I=g*v*4*P;for(let U=0;U<B.count;U++){const G=U*N;e===!0&&(Qr.fromBufferAttribute(B,U),T[I+G+0]=Qr.x,T[I+G+1]=Qr.y,T[I+G+2]=Qr.z,T[I+G+3]=0),t===!0&&(Qr.fromBufferAttribute(F,U),T[I+G+4]=Qr.x,T[I+G+5]=Qr.y,T[I+G+6]=Qr.z,T[I+G+7]=0),r===!0&&(Qr.fromBufferAttribute(q,U),T[I+G+8]=Qr.x,T[I+G+9]=Qr.y,T[I+G+10]=Qr.z,T[I+G+11]=q.itemSize===4?Qr.w:1)}}o={count:s,texture:S,stride:p,size:new gt(g,v)},Yd.set(n,o),n.addEventListener("dispose",C)}return o}class VO extends Oe{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Ge(1),this.updateType=it.OBJECT}setup(e){const{geometry:t}=e,r=t.morphAttributes.position!==void 0,i=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,o=s!==void 0?s.length:0,{texture:a,stride:c,size:f}=GO(t);r===!0&&fn.mulAssign(this.morphBaseInfluence),i===!0&&zr.mulAssign(this.morphBaseInfluence);const p=Q(f.width);It(o,({i:g})=>{const v=V(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?v.assign(vn(this.mesh.morphTexture,Dn(Q(g).add(1),Q(Ts))).r):v.assign(qt("morphTargetInfluences","float").element(g).toVar()),Ve(v.notEqual(0),()=>{r===!0&&fn.addAssign(rv({bufferMap:a,influence:v,stride:c,width:p,depth:g,offset:Q(0)})),i===!0&&zr.addAssign(rv({bufferMap:a,influence:v,stride:c,width:p,depth:g,offset:Q(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,r)=>t+r,0)}}const J6=Ze(VO).setParameterLength(1);class fu extends Oe{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class zO extends fu{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class $O extends cT{static get type(){return"LightingContextNode"}constructor(e,t=null,r=null,i=null){super(e),this.lightingModel=t,this.backdropNode=r,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,r=X().toVar("directDiffuse"),i=X().toVar("directSpecular"),s=X().toVar("indirectDiffuse"),o=X().toVar("indirectSpecular"),a={directDiffuse:r,directSpecular:i,indirectDiffuse:s,indirectSpecular:o};return{radiance:X().toVar("radiance"),irradiance:X().toVar("irradiance"),iblIrradiance:X().toVar("iblIrradiance"),ambientOcclusion:V(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const e5=Ze($O);class jO extends fu{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}const dl=new gt;class Cf extends Es{static get type(){return"ViewportTextureNode"}constructor(e=Xs,t=null,r=null){let i=null;r===null?(i=new Ig,i.minFilter=Fa,r=i):i=r,super(r,e,t),this.generateMipmaps=!1,this.defaultFramebuffer=i,this.isOutputTextureNode=!0,this.updateBeforeType=it.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(e=null){let t,r;if(this.referenceNode?(t=this.referenceNode.defaultFramebuffer,r=this.referenceNode._cacheTextures):(t=this.defaultFramebuffer,r=this._cacheTextures),e===null)return t;if(r.has(e)===!1){const i=t.clone();r.set(e,i)}return r.get(e)}updateReference(e){const t=e.renderer.getRenderTarget();return this.value=this.getTextureForReference(t),this.value}updateBefore(e){const t=e.renderer,r=t.getRenderTarget();r===null?t.getDrawingBufferSize(dl):dl.set(r.width,r.height);const i=this.getTextureForReference(r);(i.image.width!==dl.width||i.image.height!==dl.height)&&(i.image.width=dl.width,i.image.height=dl.height,i.needsUpdate=!0);const s=i.generateMipmaps;i.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(i),i.generateMipmaps=s}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const HO=Ze(Cf).setParameterLength(0,3),y2=Ze(Cf,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let Lc=null;class WO extends Cf{static get type(){return"ViewportDepthTextureNode"}constructor(e=Xs,t=null){Lc===null&&(Lc=new $i),super(e,t,Lc)}getTextureForReference(){return Lc}}const v2=Ze(WO).setParameterLength(0,2);class kr extends Oe{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===kr.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,r=this.valueNode;let i=null;if(t===kr.DEPTH_BASE)r!==null&&(i=n5().assign(r));else if(t===kr.DEPTH)e.isPerspectiveCamera?i=t5(Nn.z,Bo,Do):i=jl(Nn.z,Bo,Do);else if(t===kr.LINEAR_DEPTH)if(r!==null)if(e.isPerspectiveCamera){const s=x2(r,Bo,Do);i=jl(s,Bo,Do)}else i=r;else i=jl(Nn.z,Bo,Do);return i}}kr.DEPTH_BASE="depthBase";kr.DEPTH="depth";kr.LINEAR_DEPTH="linearDepth";const jl=(n,e,t)=>n.add(e).div(e.sub(t)),QO=(n,e,t)=>e.sub(t).mul(n).sub(e),t5=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),x2=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t)),b2=(n,e,t)=>{e=e.max(1e-6).toVar();const r=ys(n.negate().div(e)),i=ys(t.div(e));return r.div(i)},YO=(n,e,t)=>{const r=n.mul(gf(t.div(e)));return V(Math.E).pow(r).mul(e).negate()},n5=Ze(kr,kr.DEPTH_BASE),T2=Ce(kr,kr.DEPTH),Uh=Ze(kr,kr.LINEAR_DEPTH).setParameterLength(0,1),XO=Uh(v2());T2.assign=n=>n5(n);class bi extends Oe{static get type(){return"ClippingNode"}constructor(e=bi.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:r,unionPlanes:i}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===bi.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(r,i):this.scope===bi.HARDWARE?this.setupHardwareClipping(i,e):this.setupDefault(r,i)}setupAlphaToCoverage(e,t){return ee(()=>{const r=V().toVar("distanceToPlane"),i=V().toVar("distanceToGradient"),s=V(1).toVar("clipOpacity"),o=t.length;if(this.hardwareClipping===!1&&o>0){const c=dr(t).setGroup(qe);It(o,({i:f})=>{const p=c.element(f);r.assign(Nn.dot(p.xyz).negate().add(p.w)),i.assign(r.fwidth().div(2)),s.mulAssign(Yi(i.negate(),i,r))})}const a=e.length;if(a>0){const c=dr(e).setGroup(qe),f=V(1).toVar("intersectionClipOpacity");It(a,({i:p})=>{const g=c.element(p);r.assign(Nn.dot(g.xyz).negate().add(g.w)),i.assign(r.fwidth().div(2)),f.mulAssign(Yi(i.negate(),i,r).oneMinus())}),s.mulAssign(f.oneMinus())}Ft.a.mulAssign(s),Ft.a.equal(0).discard()})()}setupDefault(e,t){return ee(()=>{const r=t.length;if(this.hardwareClipping===!1&&r>0){const s=dr(t).setGroup(qe);It(r,({i:o})=>{const a=s.element(o);Nn.dot(a.xyz).greaterThan(a.w).discard()})}const i=e.length;if(i>0){const s=dr(e).setGroup(qe),o=wi(!0).toVar("clipped");It(i,({i:a})=>{const c=s.element(a);o.assign(Nn.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(e,t){const r=e.length;return t.enableHardwareClipping(r),ee(()=>{const i=dr(e).setGroup(qe),s=uo(t.getClipDistance());It(r,({i:o})=>{const a=i.element(o),c=Nn.dot(a.xyz).sub(a.w).negate();s.element(o).assign(c)})})()}}bi.ALPHA_TO_COVERAGE="alphaToCoverage";bi.DEFAULT="default";bi.HARDWARE="hardware";const KO=()=>new bi,ZO=()=>new bi(bi.ALPHA_TO_COVERAGE),JO=()=>new bi(bi.HARDWARE),eI=.05,iv=ee(([n])=>Wi(Ke(1e4,Rr(Ke(17,n.x).add(Ke(.1,n.y)))).mul(Mn(.1,Xt(Rr(Ke(13,n.y).add(n.x))))))),sv=ee(([n])=>iv(xe(iv(n.xy),n.z))),tI=ee(([n])=>{const e=gn(xs(j1(n.xyz)),xs(H1(n.xyz))),t=V(1).div(V(eI).mul(e)).toVar("pixScale"),r=xe(iu(vs(ys(t))),iu(_f(ys(t)))),i=xe(sv(vs(r.x.mul(n.xyz))),sv(vs(r.y.mul(n.xyz)))),s=Wi(ys(t)),o=Mn(Ke(s.oneMinus(),i.x),Ke(s,i.y)),a=Vr(s,s.oneMinus()),c=X(o.mul(o).div(Ke(2,a).mul(Tt(1,a))),o.sub(Ke(.5,a)).div(Tt(1,a)),Tt(1,Tt(1,o).mul(Tt(1,o)).div(Ke(2,a).mul(Tt(1,a))))),f=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(c.x,c.y),c.z);return Qi(f,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class nI extends kT{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),r=e.hasGeometryAttribute(t);let i;return r===!0?i=super.generate(e):i=e.generateConst(this.nodeType,new Vt(1,1,1,1)),i}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const r5=(n=0)=>new nI(n),i5=ee(([n,e])=>Vr(1,n.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),s5=ee(([n,e])=>Vr(n.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),o5=ee(([n,e])=>n.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),a5=ee(([n,e])=>xt(n.mul(2).mul(e),n.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),vf(.5,n))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),rI=ee(([n,e])=>{const t=e.a.add(n.a.mul(e.a.oneMinus()));return ze(e.rgb.mul(e.a).add(n.rgb.mul(n.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),l5=ee(([n])=>ze(n.rgb.mul(n.a),n.a),{color:"vec4",return:"vec4"}),iI=ee(([n])=>(Ve(n.a.equal(0),()=>ze(0)),ze(n.rgb.div(n.a),n.a)),{color:"vec4",return:"vec4"}),sI=(...n)=>(Be('TSL: "burn" has been renamed. Use "blendBurn" instead.'),i5(n)),oI=(...n)=>(Be('TSL: "dodge" has been renamed. Use "blendDodge" instead.'),s5(n)),aI=(...n)=>(Be('TSL: "screen" has been renamed. Use "blendScreen" instead.'),o5(n)),lI=(...n)=>(Be('TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),a5(n));class Tn extends uy{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{Be('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}_getNodeChildren(){const e=[];for(const t of Object.getOwnPropertyNames(this)){if(t.startsWith("_")===!0)continue;const r=this[t];r&&r.isNode===!0&&e.push({property:t,childNode:r})}return e}customProgramCacheKey(){const e=[];for(const{property:t,childNode:r}of this._getNodeChildren())e.push(YA(t.slice(0,-4)),r.getCacheKey());return this.type+cu(e)}build(e){this.setup(e)}setupObserver(e){return new RL(e)}setup(e){e.context.setupNormal=()=>zl(this.setupNormal(e),"NORMAL","vec3"),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,r=t.getRenderTarget();t.contextNode.isContextNode===!0?e.context={...e.context,...t.contextNode.getFlowContextData()}:Pe('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?e.context={...e.context,...this.contextNode.getFlowContextData()}:Pe('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),e.addStack();const i=zl(this.setupVertex(e),"VERTEX"),s=this.vertexNode||i;e.stack.outputNode=s,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let o;const a=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(r!==null?r.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const c=this.setupLighting(e);a!==null&&e.stack.addToStack(a);const f=ze(c,Ft.a).max(0);o=this.setupOutput(e,f),Vl.assign(o);const p=this.outputNode!==null;if(p&&(o=this.outputNode),e.context.getOutput&&(o=e.context.getOutput(o,e)),r!==null){const g=t.getMRT(),v=this.mrtNode;g!==null?(p&&Vl.assign(o),o=g,v!==null&&(o=g.merge(v))):v!==null&&(o=v)}}else{let c=this.fragmentNode;c.isOutputStructNode!==!0&&(c=ze(c)),o=this.setupOutput(e,c)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:r}=e.clippingContext;let i=null;if(t.length>0||r.length>0){const s=e.renderer.currentSamples;this.alphaToCoverage&&s>1?i=ZO():e.stack.addToStack(KO())}return i}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.addToStack(JO()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:r}=e;let i=this.depthNode;if(i===null){const s=t.getMRT();s&&s.has("depth")?i=s.get("depth"):t.logarithmicDepthBuffer===!0&&(r.isPerspectiveCamera?i=b2(Nn.z,Bo,Do):i=jl(Nn.z,Bo,Do))}i!==null&&T2.assign(i).toStack()}setupPositionView(){return Xo.mul(fn).xyz}setupModelViewProjection(){return Ks.mul(Nn)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),$6}setupPosition(e){const{object:t,geometry:r}=e;if((r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&J6(t).toStack(),t.isSkinnedMesh===!0&&K6(t).toStack(),this.displacementMap){const i=Gs("displacementMap","texture"),s=Gs("displacementScale","float"),o=Gs("displacementBias","float");fn.addAssign(zr.normalize().mul(i.x.mul(s).add(o)))}return t.isBatchedMesh&&Y6(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&Q6(t).toStack(),this.positionNode!==null&&fn.assign(zl(this.positionNode,"POSITION","vec3")),fn}setupDiffuseColor(e){const{object:t,geometry:r}=e;this.maskNode!==null&&wi(this.maskNode).not().discard();let i=this.colorNode?ze(this.colorNode):d6;this.vertexColors===!0&&r.hasAttribute("color")&&(i=i.mul(r5())),t.instanceColor&&(i=OA("vec3","vInstanceColor").mul(i)),t.isBatchedMesh&&t._colorsTexture&&(i=OA("vec3","vBatchColor").mul(i)),Ft.assign(i);const s=this.opacityNode?V(this.opacityNode):g2;Ft.a.assign(Ft.a.mul(s));let o=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(o=this.alphaTestNode!==null?V(this.alphaTestNode):f6,this.alphaToCoverage===!0?(Ft.a=Yi(o,o.add(Q1(Ft.a)),Ft.a),Ft.a.lessThanEqual(0).discard()):Ft.a.lessThanEqual(o).discard()),this.alphaHash===!0&&Ft.a.lessThan(tI(fn)).discard(),e.isOpaque()&&Ft.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?X(0):Ft.rgb}setupNormal(){return this.normalNode?X(this.normalNode):x6}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Gs("envMap","cubeTexture"):Gs("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new jO(_2)),t}setupLights(e){const t=[],r=this.setupEnvironment(e);r&&r.isLightingNode&&t.push(r);const i=this.setupLightMap(e);i&&i.isLightingNode&&t.push(i);let s=this.aoNode;s===null&&e.material.aoMap&&(s=z6),e.context.getAO&&(s=e.context.getAO(s,e)),s&&t.push(new zO(s));let o=this.lightsNode||e.lightsNode;return t.length>0&&(o=e.renderer.lighting.createNode([...o.getLights(),...t])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:r,backdropAlphaNode:i,emissiveNode:s}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(a&&a.getScope().hasLights){const f=this.setupLightingModel(e)||null;c=e5(a,f,r,i)}else r!==null&&(c=X(i!==null?xt(c,r,i):r));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(Zm.assign(X(s||m6)),c=c.add(Zm)),c}setupFog(e,t){const r=e.fogNode;return r&&(Vl.assign(t),t=ze(r.toVar())),t}setupPremultipliedAlpha(e,t){return l5(t)}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),this.premultipliedAlpha===!0&&(t=this.setupPremultipliedAlpha(e,t)),t}setDefaultValues(e){for(const r in e){const i=e[r];this[r]===void 0&&(this[r]=i,i&&i.clone&&(this[r]=i.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const r in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,r)===void 0&&t[r].get!==void 0&&Object.defineProperty(this.constructor.prototype,r,t[r])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const r=uy.prototype.toJSON.call(this,e);r.inputNodes={};for(const{property:s,childNode:o}of this._getNodeChildren())r.inputNodes[s]=o.toJSON(e).uuid;function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(t){const s=i(e.textures),o=i(e.images),a=i(e.nodes);s.length>0&&(r.textures=s),o.length>0&&(r.images=o),a.length>0&&(r.nodes=a)}return r}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.aoNode=e.aoNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,this.contextNode=e.contextNode,super.copy(e)}}const uI=new rf;class AI extends Tn{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(uI),this.setValues(e)}}const cI=new DN;class hI extends Tn{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(cI),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?V(this.offsetNode):q6,t=this.dashScaleNode?V(this.dashScaleNode):I6,r=this.dashSizeNode?V(this.dashSizeNode):k6,i=this.gapSizeNode?V(this.gapSizeNode):U6;M0.assign(r),Jm.assign(i);const s=Ps(oo("lineDistance").mul(t));(e?s.add(e):s).mod(M0.add(Jm)).greaterThan(M0).discard()}}let Fc=null;class fI extends Cf{static get type(){return"ViewportSharedTextureNode"}constructor(e=Xs,t=null){Fc===null&&(Fc=new Ig),super(e,t,Fc)}getTextureForReference(){return Fc}updateReference(){return this}}const dI=Ze(fI).setParameterLength(0,2),pI=new PN;class mI extends Tn{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(pI),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?V(this.opacityNode):g2;Ft.assign(bf(ze(h6(St),e),$A))}}const w2=ee(([n=c2])=>{const e=n.z.atan(n.x).mul(1/(Math.PI*2)).add(.5),t=n.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return xe(e,t)});class u5 extends cR{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const r=t.minFilter,i=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Yg(5,5,5),o=w2(c2),a=new Tn;a.colorNode=Rt(t,o,0),a.side=mr,a.blending=Ql;const c=new pn(s,a),f=new Kh;f.add(c),t.minFilter===Fa&&(t.minFilter=Hi);const p=new hR(1,10,this),g=e.getMRT();return e.setMRT(null),p.update(e,f),e.setMRT(g),t.minFilter=r,t.currentGenerateMipmaps=i,c.geometry.dispose(),c.material.dispose(),this}}const mA=new WeakMap;class gI extends _n{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=Cr(null);const t=new Gg;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=it.RENDER}updateBefore(e){const{renderer:t,material:r}=e,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const s=i.isTextureNode?i.value:r[i.property];if(s&&s.isTexture){const o=s.mapping;if(o===Ug||o===qg){if(mA.has(s)){const a=mA.get(s);ov(a,s.mapping),this._cubeTexture=a}else{const a=s.image;if(_I(a)){const c=new u5(a.height);c.fromEquirectangularTexture(t,s),ov(c.texture,s.mapping),this._cubeTexture=c.texture,mA.set(s,c.texture),s.addEventListener("dispose",A5)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function _I(n){return n==null?!1:n.height>0}function A5(n){const e=n.target;e.removeEventListener("dispose",A5);const t=mA.get(e);t!==void 0&&(mA.delete(e),t.dispose())}function ov(n,e){e===Ug?n.mapping=W0:e===qg&&(n.mapping=Q0)}const c5=Ze(gI).setParameterLength(1);class S2 extends fu{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=c5(this.envNode)}}class yI extends fu{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=V(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Mf{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class h5 extends Mf{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,r=e.reflectedLight,i=e.irradianceLightMap;r.indirectDiffuse.assign(ze(0)),i?r.indirectDiffuse.addAssign(i):r.indirectDiffuse.addAssign(ze(1,1,1,0)),r.indirectDiffuse.mulAssign(t),r.indirectDiffuse.mulAssign(Ft.rgb)}finish(e){const{material:t,context:r}=e,i=r.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case aR:i.rgb.assign(xt(i.rgb,i.rgb.mul(s.rgb),pA.mul(L0)));break;case oR:i.rgb.assign(xt(i.rgb,s.rgb,pA.mul(L0)));break;case sR:i.rgb.addAssign(s.rgb.mul(pA.mul(L0)));break;default:Be("BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const vI=new cs;class xI extends Tn{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(vI),this.setValues(e)}setupNormal(){return hu(su)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new S2(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new yI(_2)),t}setupOutgoingLight(){return Ft.rgb}setupLightingModel(){return new h5}}const ou=ee(({f0:n,f90:e,dotVH:t})=>{const r=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(r.oneMinus()).add(e.mul(r))}),$a=ee(n=>n.diffuseColor.mul(1/Math.PI)),bI=()=>V(.25),TI=ee(({dotNH:n})=>Lh.mul(V(.5)).add(1).mul(V(1/Math.PI)).mul(n.pow(Lh))),wI=ee(({lightDirection:n})=>{const e=n.add(Ht).normalize(),t=St.dot(e).clamp(),r=Ht.dot(e).clamp(),i=ou({f0:jo,f90:1,dotVH:r}),s=bI(),o=TI({dotNH:t});return i.mul(s).mul(o)});class f5 extends h5{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=St.dot(e).clamp().mul(t);r.directDiffuse.addAssign(s.mul($a({diffuseColor:Ft.rgb}))),this.specular===!0&&r.directSpecular.addAssign(s.mul(wI({lightDirection:e})).mul(pA))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul($a({diffuseColor:Ft}))),i.indirectDiffuse.mulAssign(t)}}const SI=new ao;class EI extends Tn{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(SI),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new S2(t):null}setupLightingModel(){return new f5(!1)}}const NI=new Sb;class RI extends Tn{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(NI),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new S2(t):null}setupLightingModel(){return new f5}setupVariants(){const e=(this.shininessNode?V(this.shininessNode):p6).max(1e-4);Lh.assign(e);const t=this.specularNode||g6;jo.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const d5=ee(n=>{if(n.geometry.hasAttribute("normal")===!1)return V(0);const e=su.dFdx().abs().max(su.dFdy().abs());return e.x.max(e.y).max(e.z)}),E2=ee(n=>{const{roughness:e}=n,t=d5();let r=e.max(.0525);return r=r.add(t),r=r.min(1),r}),p5=ee(({alpha:n,dotNL:e,dotNV:t})=>{const r=n.pow2(),i=e.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(r.add(r.oneMinus().mul(e.pow2())).sqrt());return si(.5,i.add(s).max(U1))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),CI=ee(({alphaT:n,alphaB:e,dotTV:t,dotBV:r,dotTL:i,dotBL:s,dotNV:o,dotNL:a})=>{const c=a.mul(X(n.mul(t),e.mul(r),o).length()),f=o.mul(X(n.mul(i),e.mul(s),a).length());return si(.5,c.add(f))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),m5=ee(({alpha:n,dotNH:e})=>{const t=n.pow2(),r=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),MI=V(1/Math.PI),PI=ee(({alphaT:n,alphaB:e,dotNH:t,dotTH:r,dotBH:i})=>{const s=n.mul(e),o=X(e.mul(r),n.mul(i),s.mul(t)),a=o.dot(o),c=s.div(a);return MI.mul(s.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),N2=ee(({lightDirection:n,f0:e,f90:t,roughness:r,f:i,normalView:s=St,USE_IRIDESCENCE:o,USE_ANISOTROPY:a})=>{const c=r.pow2(),f=n.add(Ht).normalize(),p=s.dot(n).clamp(),g=s.dot(Ht).clamp(),v=s.dot(f).clamp(),b=Ht.dot(f).clamp();let T=ou({f0:e,f90:t,dotVH:b}),S,N;if(LA(o)&&(T=pf.mix(T,i)),LA(a)){const C=fA.dot(n),P=fA.dot(Ht),B=fA.dot(f),F=ka.dot(n),q=ka.dot(Ht),I=ka.dot(f);S=CI({alphaT:Dh,alphaB:c,dotTV:P,dotBV:q,dotTL:C,dotBL:F,dotNV:g,dotNL:p}),N=PI({alphaT:Dh,alphaB:c,dotNH:v,dotTH:B,dotBH:I})}else S=p5({alpha:c,dotNL:p,dotNV:g}),N=m5({alpha:c,dotNH:v});return T.mul(S).mul(N)}),BI=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let rs=null;const kA=ee(({roughness:n,dotNV:e})=>{rs===null&&(rs=new wb(BI,16,16,zs,rr),rs.name="DFG_LUT",rs.minFilter=Hi,rs.magFilter=Hi,rs.wrapS=vA,rs.wrapT=vA,rs.generateMipmaps=!1,rs.needsUpdate=!0);const t=xe(n,e);return Rt(rs,t).rg}),DI=ee(({lightDirection:n,f0:e,f90:t,roughness:r,f:i,USE_IRIDESCENCE:s,USE_ANISOTROPY:o})=>{const a=N2({lightDirection:n,f0:e,f90:t,roughness:r,f:i,USE_IRIDESCENCE:s,USE_ANISOTROPY:o}),c=St.dot(n).clamp(),f=St.dot(Ht).clamp(),p=kA({roughness:r,dotNV:f}),g=kA({roughness:r,dotNV:c}),v=e.mul(p.x).add(t.mul(p.y)),b=e.mul(g.x).add(t.mul(g.y)),T=p.x.add(p.y),S=g.x.add(g.y),N=V(1).sub(T),C=V(1).sub(S),P=e.add(e.oneMinus().mul(.047619)),B=v.mul(b).mul(P).div(V(1).sub(N.mul(C).mul(P).mul(P)).add(U1)),F=N.mul(C),q=B.mul(F);return a.add(q)}),g5=ee(n=>{const{dotNV:e,specularColor:t,specularF90:r,roughness:i}=n,s=kA({dotNV:e,roughness:i});return t.mul(s.x).add(r.mul(s.y))}),ug=ee(({f:n,f90:e,dotVH:t})=>{const r=t.oneMinus().saturate(),i=r.mul(r),s=r.mul(i,i).clamp(0,.9999);return n.sub(X(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),LI=ee(({roughness:n,dotNH:e})=>{const t=n.pow2(),r=V(1).div(t),s=e.pow2().oneMinus().max(.0078125);return V(2).add(r).mul(s.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),FI=ee(({dotNV:n,dotNL:e})=>V(1).div(V(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),OI=ee(({lightDirection:n})=>{const e=n.add(Ht).normalize(),t=St.dot(n).clamp(),r=St.dot(Ht).clamp(),i=St.dot(e).clamp(),s=LI({roughness:Po,dotNH:i}),o=FI({dotNV:r,dotNL:t});return Xr.mul(s).mul(o)}),II=ee(({N:n,V:e,roughness:t})=>{const s=.0078125,o=n.dot(e).saturate(),a=xe(t,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(s)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),kI=ee(({f:n})=>{const e=n.length();return gn(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Oc=ee(({v1:n,v2:e})=>{const t=n.dot(e),r=t.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),s=r.add(4.1616724).mul(r).add(3.417594).toVar(),o=i.div(s),a=t.greaterThan(0).select(o,gn(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return n.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),av=ee(({N:n,V:e,P:t,mInv:r,p0:i,p1:s,p2:o,p3:a})=>{const c=s.sub(i).toVar(),f=a.sub(i).toVar(),p=c.cross(f),g=X().toVar();return Ve(p.dot(t.sub(i)).greaterThanEqual(0),()=>{const v=e.sub(n.mul(e.dot(n))).normalize(),b=n.cross(v).negate(),T=r.mul(or(v,b,n).transpose()).toVar(),S=T.mul(i.sub(t)).normalize().toVar(),N=T.mul(s.sub(t)).normalize().toVar(),C=T.mul(o.sub(t)).normalize().toVar(),P=T.mul(a.sub(t)).normalize().toVar(),B=X(0).toVar();B.addAssign(Oc({v1:S,v2:N})),B.addAssign(Oc({v1:N,v2:C})),B.addAssign(Oc({v1:C,v2:P})),B.addAssign(Oc({v1:P,v2:S})),g.assign(X(kI({f:B})))}),g}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Pf=1/6,_5=n=>Ke(Pf,Ke(n,Ke(n,n.negate().add(3)).sub(3)).add(1)),Ag=n=>Ke(Pf,Ke(n,Ke(n,Ke(3,n).sub(6))).add(4)),y5=n=>Ke(Pf,Ke(n,Ke(n,Ke(-3,n).add(3)).add(3)).add(1)),cg=n=>Ke(Pf,gi(n,3)),lv=n=>_5(n).add(Ag(n)),uv=n=>y5(n).add(cg(n)),Av=n=>Mn(-1,Ag(n).div(_5(n).add(Ag(n)))),cv=n=>Mn(1,cg(n).div(y5(n).add(cg(n)))),hv=(n,e,t)=>{const r=n.uvNode,i=Ke(r,e.zw).add(.5),s=vs(i),o=Wi(i),a=lv(o.x),c=uv(o.x),f=Av(o.x),p=cv(o.x),g=Av(o.y),v=cv(o.y),b=xe(s.x.add(f),s.y.add(g)).sub(.5).mul(e.xy),T=xe(s.x.add(p),s.y.add(g)).sub(.5).mul(e.xy),S=xe(s.x.add(f),s.y.add(v)).sub(.5).mul(e.xy),N=xe(s.x.add(p),s.y.add(v)).sub(.5).mul(e.xy),C=lv(o.y).mul(Mn(a.mul(n.sample(b).level(t)),c.mul(n.sample(T).level(t)))),P=uv(o.y).mul(Mn(a.mul(n.sample(S).level(t)),c.mul(n.sample(N).level(t))));return C.add(P)},R2=ee(([n,e])=>{const t=xe(n.size(Q(e))),r=xe(n.size(Q(e.add(1)))),i=si(1,t),s=si(1,r),o=hv(n,ze(i,t),vs(e)),a=hv(n,ze(s,r),_f(e));return Wi(e).mix(o,a)}),UI=ee(([n,e])=>{const t=e.mul(o2(n));return R2(n,t)}),fv=ee(([n,e,t,r,i])=>{const s=X(Z1(e.negate(),Mr(n),si(1,r))),o=X(xs(i[0].xyz),xs(i[1].xyz),xs(i[2].xyz));return Mr(s).mul(t.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),qI=ee(([n,e])=>n.mul(Qi(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),GI=y2(),VI=y2(),dv=ee(([n,e,t],{material:r})=>{const s=(r.side===mr?GI:VI).sample(n),o=ys(za.x).mul(qI(e,t));return R2(s,o)}),pv=ee(([n,e,t])=>(Ve(t.notEqual(0),()=>{const r=gf(e).negate().div(t);return q1(r.negate().mul(n))}),X(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),zI=ee(([n,e,t,r,i,s,o,a,c,f,p,g,v,b,T])=>{let S,N;if(T){S=ze().toVar(),N=X().toVar();const q=p.sub(1).mul(T.mul(.025)),I=X(p.sub(q),p,p.add(q));It({start:0,end:3},({i:U})=>{const G=I.element(U),H=fv(n,e,g,G,a),te=o.add(H),W=f.mul(c.mul(ze(te,1))),Z=xe(W.xy.div(W.w)).toVar();Z.addAssign(1),Z.divAssign(2),Z.assign(xe(Z.x,Z.y.oneMinus()));const re=dv(Z,t,G);S.element(U).assign(re.element(U)),S.a.addAssign(re.a),N.element(U).assign(r.element(U).mul(pv(xs(H),v,b).element(U)))}),S.a.divAssign(3)}else{const q=fv(n,e,g,p,a),I=o.add(q),U=f.mul(c.mul(ze(I,1))),G=xe(U.xy.div(U.w)).toVar();G.addAssign(1),G.divAssign(2),G.assign(xe(G.x,G.y.oneMinus())),S=dv(G,t,p),N=r.mul(pv(xs(q),v,b))}const C=N.rgb.mul(S.rgb),P=n.dot(e).clamp(),B=X(g5({dotNV:P,specularColor:i,specularF90:s,roughness:t})),F=N.r.add(N.g,N.b).div(3);return ze(B.oneMinus().mul(C),S.a.oneMinus().mul(F).oneMinus())}),$I=or(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),jI=n=>{const e=n.sqrt();return X(1).add(e).div(X(1).sub(e))},mv=(n,e)=>n.sub(e).div(n.add(e)).pow2(),HI=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),r=X(54856e-17,44201e-17,52481e-17),i=X(1681e3,1795300,2208400),s=X(43278e5,93046e5,66121e5),o=V(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=r.mul(s.mul(2*Math.PI).sqrt()).mul(i.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return a=X(a.x.add(o),a.y,a.z).div(10685e-11),$I.mul(a)},gv=ee(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:r,baseF0:i})=>{const s=xt(n,e,Yi(0,.03,r)),a=n.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();Ve(a.lessThan(0),()=>X(1));const c=a.sqrt(),f=mv(s,n),p=ou({f0:f,f90:1,dotVH:t}),g=p.oneMinus(),v=s.lessThan(n).select(Math.PI,0),b=V(Math.PI).sub(v),T=jI(i.clamp(0,.9999)),S=mv(T,s.toVec3()),N=ou({f0:S,f90:1,dotVH:c}),C=X(T.x.lessThan(s).select(Math.PI,0),T.y.lessThan(s).select(Math.PI,0),T.z.lessThan(s).select(Math.PI,0)),P=s.mul(r,c,2),B=X(b).add(C),F=p.mul(N).clamp(1e-5,.9999),q=F.sqrt(),I=g.pow2().mul(N).div(X(1).sub(F)),G=p.add(I).toVar(),H=I.sub(g).toVar();return It({start:1,end:2,condition:"<=",name:"m"},({m:te})=>{H.mulAssign(q);const W=HI(V(te).mul(P),V(te).mul(B)).mul(2);G.addAssign(H.mul(W))}),G.max(X(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Bu=ee(({normal:n,viewDir:e,roughness:t})=>{const r=n.dot(e).saturate(),i=t.mul(t),s=t.add(.1).reciprocal(),o=V(-1.9362).add(t.mul(1.0678)).add(i.mul(.4573)).sub(s.mul(.8469)),a=V(-.6014).add(t.mul(.5538)).sub(i.mul(.467)).sub(s.mul(.1255));return o.mul(r).add(a).exp().saturate()}),Xd=X(.04),Kd=V(1);class v5 extends Mf{constructor(e=!1,t=!1,r=!1,i=!1,s=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=r,this.anisotropy=i,this.transmission=s,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=X().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=X().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=X().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=X().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=X().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=St.dot(Ht).clamp(),r=gv({outsideIOR:V(1),eta2:Ph,cosTheta1:t,thinFilmThickness:Bh,baseF0:jo}),i=gv({outsideIOR:V(1),eta2:Ph,cosTheta1:t,thinFilmThickness:Bh,baseF0:Ft.rgb});this.iridescenceFresnel=xt(r,i,$s),this.iridescenceF0Dielectric=ug({f:r,f90:1,dotVH:t}),this.iridescenceF0Metallic=ug({f:i,f90:1,dotVH:t}),this.iridescenceF0=xt(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,$s)}if(this.transmission===!0){const t=bs,r=GT.sub(bs).normalize(),i=Ko,s=e.context;s.backdrop=zI(i,r,hs,va,Pa,Gl,t,_i,Mi,Ks,dA,B1,L1,D1,this.dispersion?F1:null),s.backdropAlpha=Fh,Ft.a.mulAssign(xt(1,s.backdrop.a,Fh))}super.start(e)}computeMultiscattering(e,t,r,i,s=null){const o=St.dot(Ht).clamp(),a=kA({roughness:hs,dotNV:o}),c=s?pf.mix(i,s):i,f=c.mul(a.x).add(r.mul(a.y)),g=a.x.add(a.y).oneMinus(),v=c.add(c.oneMinus().mul(.047619)),b=f.mul(v).div(g.mul(v).oneMinus());e.addAssign(f),t.addAssign(b.mul(g))}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const s=St.dot(e).clamp().mul(t).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(s.mul(OI({lightDirection:e})));const o=Bu({normal:St,viewDir:Ht,roughness:Po}),a=Bu({normal:St,viewDir:e,roughness:Po}),c=Xr.r.max(Xr.g).max(Xr.b).mul(o.max(a)).oneMinus();s.mulAssign(c)}if(this.clearcoat===!0){const a=Ba.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(N2({lightDirection:e,f0:Xd,f90:Kd,roughness:IA,normalView:Ba})))}r.directDiffuse.addAssign(s.mul($a({diffuseColor:va}))),r.directSpecular.addAssign(s.mul(DI({lightDirection:e,f0:Pa,f90:1,roughness:hs,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:r,halfHeight:i,reflectedLight:s,ltc_1:o,ltc_2:a}){const c=t.add(r).sub(i),f=t.sub(r).sub(i),p=t.sub(r).add(i),g=t.add(r).add(i),v=St,b=Ht,T=Nn.toVar(),S=II({N:v,V:b,roughness:hs}),N=o.sample(S).toVar(),C=a.sample(S).toVar(),P=or(X(N.x,0,N.y),X(0,1,0),X(N.z,0,N.w)).toVar(),B=Pa.mul(C.x).add(Pa.oneMinus().mul(C.y)).toVar();s.directSpecular.addAssign(e.mul(B).mul(av({N:v,V:b,P:T,mInv:P,p0:c,p1:f,p2:p,p3:g}))),s.directDiffuse.addAssign(e.mul(va).mul(av({N:v,V:b,P:T,mInv:or(1,0,0,0,1,0,0,0,1),p0:c,p1:f,p2:p,p3:g})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:r}=e.context,i=t.mul($a({diffuseColor:va})).toVar();if(this.sheen===!0){const s=Bu({normal:St,viewDir:Ht,roughness:Po}),o=Xr.r.max(Xr.g).max(Xr.b).mul(s).oneMinus();i.mulAssign(o)}r.indirectDiffuse.addAssign(i)}indirectSpecular(e){const{radiance:t,iblIrradiance:r,reflectedLight:i}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(r.mul(Xr,Bu({normal:St,viewDir:Ht,roughness:Po}))),this.clearcoat===!0){const N=Ba.dot(Ht).clamp(),C=g5({dotNV:N,specularColor:Xd,specularF90:Kd,roughness:IA});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(C))}const s=X().toVar("singleScatteringDielectric"),o=X().toVar("multiScatteringDielectric"),a=X().toVar("singleScatteringMetallic"),c=X().toVar("multiScatteringMetallic");this.computeMultiscattering(s,o,Gl,jo,this.iridescenceF0Dielectric),this.computeMultiscattering(a,c,Gl,Ft.rgb,this.iridescenceF0Metallic);const f=xt(s,a,$s),p=xt(o,c,$s),g=s.add(o),v=va.mul(g.oneMinus()),b=r.mul(1/Math.PI),T=t.mul(f).add(p.mul(b)).toVar(),S=v.mul(b).toVar();if(this.sheen===!0){const N=Bu({normal:St,viewDir:Ht,roughness:Po}),C=Xr.r.max(Xr.g).max(Xr.b).mul(N).oneMinus();T.mulAssign(C),S.mulAssign(C)}i.indirectSpecular.addAssign(T),i.indirectDiffuse.addAssign(S)}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:r}=e.context,s=St.dot(Ht).clamp().add(t),o=hs.mul(-16).oneMinus().negate().exp2(),a=t.sub(s.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),r.indirectDiffuse.mulAssign(t),r.indirectSpecular.mulAssign(a)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const r=Ba.dot(Ht).clamp(),i=ou({dotVH:r,f0:Xd,f90:Kd}),s=t.mul(Mh.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Mh));t.assign(s)}if(this.sheen===!0){const r=t.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));t.assign(r)}}}const _v=V(1),hg=V(-2),Ic=V(.8),Zd=V(-1),kc=V(.4),Jd=V(2),Uc=V(.305),ep=V(3),yv=V(.21),WI=V(4),vv=V(4),QI=V(16),YI=ee(([n])=>{const e=X(Xt(n)).toVar(),t=V(-1).toVar();return Ve(e.x.greaterThan(e.z),()=>{Ve(e.x.greaterThan(e.y),()=>{t.assign(sr(n.x.greaterThan(0),0,3))}).Else(()=>{t.assign(sr(n.y.greaterThan(0),1,4))})}).Else(()=>{Ve(e.z.greaterThan(e.y),()=>{t.assign(sr(n.z.greaterThan(0),2,5))}).Else(()=>{t.assign(sr(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),XI=ee(([n,e])=>{const t=xe().toVar();return Ve(e.equal(0),()=>{t.assign(xe(n.z,n.y).div(Xt(n.x)))}).ElseIf(e.equal(1),()=>{t.assign(xe(n.x.negate(),n.z.negate()).div(Xt(n.y)))}).ElseIf(e.equal(2),()=>{t.assign(xe(n.x.negate(),n.y).div(Xt(n.z)))}).ElseIf(e.equal(3),()=>{t.assign(xe(n.z.negate(),n.y).div(Xt(n.x)))}).ElseIf(e.equal(4),()=>{t.assign(xe(n.x.negate(),n.z).div(Xt(n.y)))}).Else(()=>{t.assign(xe(n.x,n.y).div(Xt(n.z)))}),Ke(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),KI=ee(([n])=>{const e=V(0).toVar();return Ve(n.greaterThanEqual(Ic),()=>{e.assign(_v.sub(n).mul(Zd.sub(hg)).div(_v.sub(Ic)).add(hg))}).ElseIf(n.greaterThanEqual(kc),()=>{e.assign(Ic.sub(n).mul(Jd.sub(Zd)).div(Ic.sub(kc)).add(Zd))}).ElseIf(n.greaterThanEqual(Uc),()=>{e.assign(kc.sub(n).mul(ep.sub(Jd)).div(kc.sub(Uc)).add(Jd))}).ElseIf(n.greaterThanEqual(yv),()=>{e.assign(Uc.sub(n).mul(WI.sub(ep)).div(Uc.sub(yv)).add(ep))}).Else(()=>{e.assign(V(-2).mul(ys(Ke(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),x5=ee(([n,e])=>{const t=n.toVar();t.assign(Ke(2,t).sub(1));const r=X(t,1).toVar();return Ve(e.equal(0),()=>{r.assign(r.zyx)}).ElseIf(e.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),b5=ee(([n,e,t,r,i,s])=>{const o=V(t),a=X(e),c=Qi(KI(o),hg,s),f=Wi(c),p=vs(c),g=X(UA(n,a,p,r,i,s)).toVar();return Ve(f.notEqual(0),()=>{const v=X(UA(n,a,p.add(1),r,i,s)).toVar();g.assign(xt(g,v,f))}),g}),UA=ee(([n,e,t,r,i,s])=>{const o=V(t).toVar(),a=X(e),c=V(YI(a)).toVar(),f=V(gn(vv.sub(o),0)).toVar();o.assign(gn(o,vv));const p=V(iu(o)).toVar(),g=xe(XI(a,c).mul(p.sub(2)).add(1)).toVar();return Ve(c.greaterThan(2),()=>{g.y.addAssign(p),c.subAssign(3)}),g.x.addAssign(c.mul(p)),g.x.addAssign(f.mul(Ke(3,QI))),g.y.addAssign(Ke(4,iu(s).sub(p))),g.x.mulAssign(r),g.y.mulAssign(i),n.sample(g).grad(xe(),xe())}),tp=ee(({envMap:n,mipInt:e,outputDirection:t,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=Ii(r),f=t.mul(c).add(i.cross(t).mul(Rr(r))).add(i.mul(i.dot(t).mul(c.oneMinus())));return UA(n,f,e,s,o,a)}),T5=ee(({n,latitudinal:e,poleAxis:t,outputDirection:r,weights:i,samples:s,dTheta:o,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g})=>{const v=X(sr(e,t,io(t,r))).toVar();Ve(v.equal(X(0)),()=>{v.assign(X(r.z,0,r.x.negate()))}),v.assign(Mr(v));const b=X().toVar();return b.addAssign(i.element(0).mul(tp({theta:0,axis:v,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g}))),It({start:Q(1),end:n},({i:T})=>{Ve(T.greaterThanEqual(s),()=>{Z6()});const S=V(o.mul(V(T))).toVar();b.addAssign(i.element(T).mul(tp({theta:S.mul(-1),axis:v,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g}))),b.addAssign(i.element(T).mul(tp({theta:S,axis:v,outputDirection:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:f,CUBEUV_TEXEL_HEIGHT:p,CUBEUV_MAX_MIP:g})))}),ze(b,1)}),ZI=ee(([n])=>{const e=me(n).toVar();return e.assign(e.shiftLeft(me(16)).bitOr(e.shiftRight(me(16)))),e.assign(e.bitAnd(me(1431655765)).shiftLeft(me(1)).bitOr(e.bitAnd(me(2863311530)).shiftRight(me(1)))),e.assign(e.bitAnd(me(858993459)).shiftLeft(me(2)).bitOr(e.bitAnd(me(3435973836)).shiftRight(me(2)))),e.assign(e.bitAnd(me(252645135)).shiftLeft(me(4)).bitOr(e.bitAnd(me(4042322160)).shiftRight(me(4)))),e.assign(e.bitAnd(me(16711935)).shiftLeft(me(8)).bitOr(e.bitAnd(me(4278255360)).shiftRight(me(8)))),V(e).mul(23283064365386963e-26)}),JI=ee(([n,e])=>xe(V(n).div(V(e)),ZI(n))),ek=ee(([n,e,t])=>{const r=X(e).toVar(),i=V(t),s=i.mul(i).toVar(),o=Mr(X(s.mul(r.x),s.mul(r.y),r.z)).toVar(),a=o.x.mul(o.x).add(o.y.mul(o.y)),c=sr(a.greaterThan(0),X(o.y.negate(),o.x,0).div(pr(a)),X(1,0,0)).toVar(),f=io(o,c).toVar(),p=pr(n.x),g=Ke(2,3.14159265359).mul(n.y),v=p.mul(Ii(g)).toVar(),b=p.mul(Rr(g)).toVar(),T=Ke(.5,o.z.add(1));b.assign(T.oneMinus().mul(pr(v.mul(v).oneMinus())).add(T.mul(b)));const S=c.mul(v).add(f.mul(b)).add(o.mul(pr(gn(0,v.mul(v).add(b.mul(b)).oneMinus()))));return Mr(X(s.mul(S.x),s.mul(S.y),gn(0,S.z)))}),w5=ee(({roughness:n,mipInt:e,envMap:t,N_immutable:r,GGX_SAMPLES:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=X(r).toVar(),f=X(0).toVar(),p=V(0).toVar();return Ve(n.lessThan(.001),()=>{f.assign(UA(t,c,e,s,o,a))}).Else(()=>{const g=sr(Xt(c.z).lessThan(.999),X(0,0,1),X(1,0,0)),v=Mr(io(g,c)).toVar(),b=io(c,v).toVar();It({start:me(0),end:i},({i:T})=>{const S=JI(T,i),N=ek(S,X(0,0,1),n),C=Mr(v.mul(N.x).add(b.mul(N.y)).add(c.mul(N.z))),P=Mr(C.mul(Si(c,C).mul(2)).sub(c)),B=gn(Si(c,P),0);Ve(B.greaterThan(0),()=>{const F=UA(t,P,e,s,o,a);f.addAssign(F.mul(B)),p.addAssign(B)})}),Ve(p.greaterThan(0),()=>{f.assign(f.div(p))})}),ze(f,1)}),Oo=4,xv=[.125,.215,.35,.446,.526,.582],xa=20,tk=512,Du=new kg(-1,1,1,-1,0,1),nk=new yA(90,1),bv=new Gn;let np=null,rp=0,ip=0;const rk=new we,qh=new WeakMap,ik=[3,1,5,0,4,2],sp=x5(zt(),oo("faceIndex")).normalize(),Bf=X(sp.x,sp.y,sp.z);class sk{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,r=.1,i=100,s={}){const{size:o=256,position:a=rk,renderTarget:c=null}=s;if(this._setSize(o),this._hasInitialized===!1){Be('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const p=c||this._allocateTarget();return s.renderTarget=p,this.fromSceneAsync(e,t,r,i,s),p}np=this._renderer.getRenderTarget(),rp=this._renderer.getActiveCubeFace(),ip=this._renderer.getActiveMipmapLevel();const f=c||this._allocateTarget();return f.depthBuffer=!0,this._init(f),this._sceneToCubeUV(e,r,i,f,a),t>0&&this._blur(f,0,0,t),this._applyPMREM(f),this._cleanup(f),f}async fromSceneAsync(e,t=0,r=.1,i=100,s={}){return cn('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(e,t,r,i,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){Be('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromEquirectangularAsync(e,r),r}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return cn('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){Be("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromCubemapAsync(e,t),r}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return cn('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=wv(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Sv(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===W0||e.mapping===Q0?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(np,rp,ip),e.scissorTest=!1,pl(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),np=this._renderer.getRenderTarget(),rp=this._renderer.getActiveCubeFace(),ip=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTarget();return this._init(r),this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTarget(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize;return Tv(e,t)}_init(e){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Tv(e.width,e.height);const{_lodMax:t}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=ok(t)),this._blurMaterial=ak(t,e.width,e.height),this._ggxMaterial=lk(t,e.width,e.height)}}async _compileMaterial(e){const t=new pn(new oi,e);await this._renderer.compile(t,Du)}_sceneToCubeUV(e,t,r,i,s){const o=nk;o.near=t,o.far=r;const a=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],f=this._renderer,p=f.autoClear;f.getClearColor(bv),f.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new pn(new Yg,new cs({name:"PMREM.Background",side:mr,depthWrite:!1,depthTest:!1})));const g=this._backgroundBox,v=g.material;let b=!1;const T=e.background;T?T.isColor&&(v.color.copy(T),e.background=null,b=!0):(v.color.copy(bv),b=!0),f.setRenderTarget(i),f.clear(),b&&f.render(g,o);for(let S=0;S<6;S++){const N=S%3;N===0?(o.up.set(0,a[S],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x+c[S],s.y,s.z)):N===1?(o.up.set(0,0,a[S]),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y+c[S],s.z)):(o.up.set(0,a[S],0),o.position.set(s.x,s.y,s.z),o.lookAt(s.x,s.y,s.z+c[S]));const C=this._cubeSize;pl(i,N*C,S>2?C:0,C,C),f.render(e,o)}f.autoClear=p,e.background=T}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===W0||e.mapping===Q0;i?this._cubemapMaterial===null&&(this._cubemapMaterial=wv(e)):this._equirectMaterial===null&&(this._equirectMaterial=Sv(e));const s=i?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=s;const a=this._cubeSize;pl(t,0,0,3*a,2*a),r.setRenderTarget(t),r.render(o,Du)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let s=1;s<i;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=r}_applyGGXFilter(e,t,r){const i=this._renderer,s=this._pingPongRenderTarget,o=this._ggxMaterial,a=this._lodMeshes[r];a.material=o;const c=qh.get(o),f=r/(this._lodMeshes.length-1),p=t/(this._lodMeshes.length-1),g=Math.sqrt(f*f-p*p),v=0+f*1.25,b=g*v,{_lodMax:T}=this,S=this._sizeLods[r],N=3*S*(r>T-Oo?r-T+Oo:0),C=4*(this._cubeSize-S);e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.roughness.value=b,c.mipInt.value=T-t,pl(s,N,C,3*S,2*S),i.setRenderTarget(s),i.render(a,Du),s.texture.frame=(s.texture.frame||0)+1,c.envMap.value=s.texture,c.roughness.value=0,c.mipInt.value=T-r,pl(e,N,C,3*S,2*S),i.setRenderTarget(e),i.render(a,Du)}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const c=this._renderer,f=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&Pe("blur direction must be either latitudinal or longitudinal!");const p=3,g=this._lodMeshes[i];g.material=f;const v=qh.get(f),b=this._sizeLods[r]-1,T=isFinite(s)?Math.PI/(2*b):2*Math.PI/(2*xa-1),S=s/T,N=isFinite(s)?1+Math.floor(p*S):xa;N>xa&&Be(`sigmaRadians, ${s}, is too large and will clip, as it requested ${N} samples when the maximum is set to ${xa}`);const C=[];let P=0;for(let U=0;U<xa;++U){const G=U/S,H=Math.exp(-G*G/2);C.push(H),U===0?P+=H:U<N&&(P+=2*H)}for(let U=0;U<C.length;U++)C[U]=C[U]/P;e.texture.frame=(e.texture.frame||0)+1,v.envMap.value=e.texture,v.samples.value=N,v.weights.array=C,v.latitudinal.value=o==="latitudinal"?1:0,a&&(v.poleAxis.value=a);const{_lodMax:B}=this;v.dTheta.value=T,v.mipInt.value=B-r;const F=this._sizeLods[i],q=3*F*(i>B-Oo?i-B+Oo:0),I=4*(this._cubeSize-F);pl(t,q,I,3*F,2*F),c.setRenderTarget(t),c.render(g,Du)}}function ok(n){const e=[],t=[],r=[];let i=n;const s=n-Oo+1+xv.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);e.push(a);let c=1/a;o>n-Oo?c=xv[o-n+Oo-1]:o===0&&(c=0),t.push(c);const f=1/(a-2),p=-f,g=1+f,v=[p,p,g,p,g,g,p,p,g,g,p,g],b=6,T=6,S=3,N=2,C=1,P=new Float32Array(S*T*b),B=new Float32Array(N*T*b),F=new Float32Array(C*T*b);for(let I=0;I<b;I++){const U=I%3*2/3-1,G=I>2?0:-1,H=[U,G,0,U+2/3,G,0,U+2/3,G+1,0,U,G,0,U+2/3,G+1,0,U,G+1,0],te=ik[I];P.set(H,S*T*te),B.set(v,N*T*te);const W=[te,te,te,te,te,te];F.set(W,C*T*te)}const q=new oi;q.setAttribute("position",new Il(P,S)),q.setAttribute("uv",new Il(B,N)),q.setAttribute("faceIndex",new Il(F,C)),r.push(new pn(q,null)),i>Oo&&i--}return{lodMeshes:r,sizeLods:e,sigmas:t}}function Tv(n,e){const t={magFilter:Hi,minFilter:Hi,generateMipmaps:!1,type:rr,format:Gi,colorSpace:Mb},r=new Qo(n,e,t);return r.texture.mapping=Up,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function pl(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function Df(n){const e=new Tn;return e.depthTest=!1,e.depthWrite=!1,e.blending=Ql,e.name=`PMREM_${n}`,e}function ak(n,e,t){const r=dr(new Array(xa).fill(0)),i=Ge(new we(0,1,0)),s=Ge(0),o=V(xa),a=Ge(0),c=Ge(1),f=Rt(),p=Ge(0),g=V(1/e),v=V(1/t),b=V(n),T={n:o,latitudinal:a,weights:r,poleAxis:i,outputDirection:Bf,dTheta:s,samples:c,envMap:f,mipInt:p,CUBEUV_TEXEL_WIDTH:g,CUBEUV_TEXEL_HEIGHT:v,CUBEUV_MAX_MIP:b},S=Df("blur");return S.fragmentNode=T5({...T,latitudinal:a.equal(1)}),qh.set(S,T),S}function lk(n,e,t){const r=Rt(),i=Ge(0),s=Ge(0),o=V(1/e),a=V(1/t),c=V(n),f={envMap:r,roughness:i,mipInt:s,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:c},p=Df("ggx");return p.fragmentNode=w5({...f,N_immutable:Bf,GGX_SAMPLES:me(tk)}),qh.set(p,f),p}function wv(n){const e=Df("cubemap");return e.fragmentNode=Cr(n,Bf),e}function Sv(n){const e=Df("equirect");return e.fragmentNode=Rt(n,w2(Bf),0),e}const Ev=new WeakMap;function uk(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),112)),texelHeight:t,maxMip:e}}function Ak(n,e,t){const r=ck(e);let i=r.get(n);if((i!==void 0?i.pmremVersion:-1)!==n.pmremVersion){const o=n.image;if(n.isCubeTexture)if(fk(o))i=t.fromCubemap(n,i);else return null;else if(dk(o))i=t.fromEquirectangular(n,i);else return null;i.pmremVersion=n.pmremVersion,r.set(n,i)}return i.texture}function ck(n){let e=Ev.get(n);return e===void 0&&(e=new WeakMap,Ev.set(n,e)),e}class hk extends _n{static get type(){return"PMREMNode"}constructor(e,t=null,r=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=r,this._generator=null;const i=new Vg;i.isRenderTargetTexture=!0,this._texture=Rt(i),this._width=Ge(0),this._height=Ge(0),this._maxMip=Ge(0),this.updateBeforeType=it.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=uk(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const r=t?t.pmremVersion:-1,i=this._value;r!==i.pmremVersion&&(i.isPMREMTexture===!0?t=i:t=Ak(i,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new sk(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this,e)),t=d2.mul(X(t.x,t.y.negate(),t.z));let r=this.levelNode;return r===null&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),b5(this._texture,t,r,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function fk(n){if(n==null)return!1;let e=0;const t=6;for(let r=0;r<t;r++)n[r]!==void 0&&e++;return e===t}function dk(n){return n==null?!1:n.height>0}const C2=Ze(hk).setParameterLength(1,3),Nv=new WeakMap;class pk extends fu{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const g=r.isTextureNode?r.value:t[r.property];let v=Nv.get(g);v===void 0&&(v=C2(g),Nv.set(g,v)),r=v}const s=t.useAnisotropy===!0||t.anisotropy>0?c6:St,o=r.context(Rv(hs,s)).mul(D0),a=r.context(mk(Ko)).mul(Math.PI).mul(D0),c=$l(o),f=$l(a);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(f);const p=e.context.lightingModel.clearcoatRadiance;if(p){const g=r.context(Rv(IA,Ba)).mul(D0),v=$l(g);p.addAssign(v)}}}const Rv=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Ht.negate().reflect(e),t=X1(n).mix(t,e).normalize(),t=t.transformDirection(Mi)),t),getTextureLevel:()=>n}},mk=n=>({getUV:()=>n,getTextureLevel:()=>V(1)}),gk=new RN;class S5 extends Tn{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(gk),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new pk(t):null}setupLightingModel(){return new v5}setupSpecular(){const e=xt(X(.04),Ft.rgb,$s);jo.assign(X(.04)),Pa.assign(e),Gl.assign(1)}setupVariants(){const e=this.metalnessNode?V(this.metalnessNode):v6;$s.assign(e);let t=this.roughnessNode?V(this.roughnessNode):y6;t=E2({roughness:t}),hs.assign(t),this.setupSpecular(),va.assign(Ft.rgb.mul(e.oneMinus()))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const _k=new CN;class yk extends S5{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(_k),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?V(this.iorNode):L6;dA.assign(e),jo.assign(Vr(Y1(dA.sub(1).div(dA.add(1))).mul(_6),X(1)).mul(lg)),Pa.assign(xt(jo,Ft.rgb,$s)),Gl.assign(xt(lg,1,$s))}setupLightingModel(){return new v5(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?V(this.clearcoatNode):b6,r=this.clearcoatRoughnessNode?V(this.clearcoatRoughnessNode):T6;Mh.assign(t),IA.assign(E2({roughness:r}))}if(this.useSheen){const t=this.sheenNode?X(this.sheenNode):E6,r=this.sheenRoughnessNode?V(this.sheenRoughnessNode):N6;Xr.assign(t),Po.assign(r)}if(this.useIridescence){const t=this.iridescenceNode?V(this.iridescenceNode):C6,r=this.iridescenceIORNode?V(this.iridescenceIORNode):M6,i=this.iridescenceThicknessNode?V(this.iridescenceThicknessNode):P6;pf.assign(t),Ph.assign(r),Bh.assign(i)}if(this.useAnisotropy){const t=(this.anisotropyNode?xe(this.anisotropyNode):R6).toVar();Co.assign(t.length()),Ve(Co.equal(0),()=>{t.assign(xe(1,0))}).Else(()=>{t.divAssign(xe(Co)),Co.assign(Co.saturate())}),Dh.assign(Co.pow2().mix(hs.pow2(),1)),fA.assign(Da[0].mul(t.x).add(Da[1].mul(t.y))),ka.assign(Da[1].mul(t.x).sub(Da[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?V(this.transmissionNode):B6,r=this.thicknessNode?V(this.thicknessNode):D6,i=this.attenuationDistanceNode?V(this.attenuationDistanceNode):F6,s=this.attenuationColorNode?X(this.attenuationColorNode):O6;if(Fh.assign(t),B1.assign(r),D1.assign(i),L1.assign(s),this.useDispersion){const o=this.dispersionNode?V(this.dispersionNode):V6;F1.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?X(this.clearcoatNormalNode):w6}setup(e){e.context.setupClearcoatNormal=()=>zl(this.setupClearcoatNormal(e),"NORMAL","vec3"),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const vk=ee(({normal:n,lightDirection:e,builder:t})=>{const r=n.dot(e),i=xe(r.mul(.5).add(.5),0);if(t.material.gradientMap){const s=Gs("gradientMap","texture").context({getUV:()=>i});return X(s.r)}else{const s=i.fwidth().mul(.5);return xt(X(.7),X(1),Yi(V(.7).sub(s.x),V(.7).add(s.x),i.x))}});class xk extends Mf{direct({lightDirection:e,lightColor:t,reflectedLight:r},i){const s=vk({normal:wf,lightDirection:e,builder:i}).mul(t);r.directDiffuse.addAssign(s.mul($a({diffuseColor:Ft.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(r.mul($a({diffuseColor:Ft}))),i.indirectDiffuse.mulAssign(t)}}const bk=new MN;class Tk extends Tn{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(bk),this.setValues(e)}setupLightingModel(){return new xk}}const E5=ee(()=>{const n=X(Ht.z,0,Ht.x.negate()).normalize(),e=Ht.cross(n);return xe(n.dot(St),e.dot(St)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),wk=new BN;class Sk extends Tn{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(wk),this.setValues(e)}setupVariants(e){const t=E5;let r;e.material.matcap?r=Gs("matcap","texture").context({getUV:()=>t}):r=X(xt(.2,.8,t.y)),Ft.rgb.mulAssign(r.rgb)}}class Ek extends _n{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:r}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),o=t.sin();return df(s,o,o.negate(),s).mul(r)}else{const s=t,o=qo(ze(1,0,0,0),ze(0,Ii(s.x),Rr(s.x).negate(),0),ze(0,Rr(s.x),Ii(s.x),0),ze(0,0,0,1)),a=qo(ze(Ii(s.y),0,Rr(s.y),0),ze(0,1,0,0),ze(Rr(s.y).negate(),0,Ii(s.y),0),ze(0,0,0,1)),c=qo(ze(Ii(s.z),Rr(s.z).negate(),0,0),ze(Rr(s.z),Ii(s.z),0,0),ze(0,0,1,0),ze(0,0,0,1));return o.mul(a).mul(c).mul(ze(r,1)).xyz}}}const tc=Ze(Ek).setParameterLength(2),Nk=new LN;class N5 extends Tn{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(Nk),this.setValues(e)}setupPositionView(e){const{object:t,camera:r}=e,{positionNode:i,rotationNode:s,scaleNode:o,sizeAttenuation:a}=this,c=Xo.mul(X(i||0));let f=xe(_i[0].xyz.length(),_i[1].xyz.length());o!==null&&(f=f.mul(xe(o))),r.isPerspectiveCamera&&a===!1&&(f=f.mul(c.z.negate()));let p=JA.xy;if(t.center&&t.center.isVector2===!0){const b=xF("center","vec2",t);p=p.sub(b.sub(.5))}p=p.mul(f);const g=V(s||S6),v=tc(p,g);return ze(c.xy.add(v),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const Rk=new Eb,Ck=new gt;class Mk extends N5{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(Rk),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Xo.mul(X(e||fn)).xyz}setupVertexSprite(e){const{material:t,camera:r}=e,{rotationNode:i,scaleNode:s,sizeNode:o,sizeAttenuation:a}=this;let c=super.setupVertex(e);if(t.isNodeMaterial!==!0)return c;let f=o!==null?xe(o):G6;f=f.mul(UT),r.isPerspectiveCamera&&a===!0&&(f=f.mul(Pk.div(Nn.z.negate()))),s&&s.isNode&&(f=f.mul(xe(s)));let p=JA.xy;if(i&&i.isNode){const g=V(i);p=tc(p,g)}return p=p.mul(f),p=p.div(A2.div(2)),p=p.mul(c.w),c=c.add(ze(p,0,0)),c}setupVertex(e){return e.object.isPoints?super.setupVertex(e):this.setupVertexSprite(e)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}const Pk=Ge(1).onFrameUpdate(function({renderer:n}){const e=n.getSize(Ck);this.value=.5*e.y});class Bk extends Mf{constructor(){super(),this.shadowNode=V(1).toVar("shadowMask")}direct({lightNode:e}){e.shadowNode!==null&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Ft.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Ft.rgb)}}const Dk=new FN;class Lk extends Tn{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(Dk),this.setValues(e)}setupLightingModel(){return new Bk}}Qs("vec3");Qs("vec3");Qs("vec3");class Fk{constructor(e,t,r){this.renderer=e,this.nodes=t,this.info=r,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,r)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(t,r),this.renderer._inspector.finish()};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class Xi{constructor(){this.weakMaps={}}_getWeakMap(e){const t=e.length;let r=this.weakMaps[t];return r===void 0&&(r=new WeakMap,this.weakMaps[t]=r),r}get(e){let t=this._getWeakMap(e);for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let r=this._getWeakMap(e);for(let i=0;i<e.length-1;i++){const s=e[i];r.has(s)===!1&&r.set(s,new WeakMap),r=r.get(s)}return r.set(e[e.length-1],t),this}delete(e){let t=this._getWeakMap(e);for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),t===void 0)return!1;return t.delete(e[e.length-1])}}let Ok=0;function Ik(n){const e=Object.keys(n);let t=Object.getPrototypeOf(n);for(;t;){const r=Object.getOwnPropertyDescriptors(t);for(const i in r)if(r[i]!==void 0){const s=r[i];s&&typeof s.get=="function"&&e.push(i)}t=Object.getPrototypeOf(t)}return e}class kk{constructor(e,t,r,i,s,o,a,c,f,p){this.id=Ok++,this._nodes=e,this._geometries=t,this.renderer=r,this.object=i,this.material=s,this.scene=o,this.camera=a,this.lightsNode=c,this.context=f,this.geometry=i.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=p,this.clippingContextCacheKey=p!==null?p.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,r=[],i=new Set,s={};for(const o of e){let a;if(o.node&&o.node.attribute?a=o.node.attribute:(a=t.getAttribute(o.name),s[o.name]=a.version),a===void 0)continue;r.push(a);const c=a.isInterleavedBufferAttribute?a.data:a;i.add(c)}return this.attributes=r,this.attributesId=s,this.vertexBuffers=Array.from(i.values()),r}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:r,group:i,drawRange:s}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),c=a!==null;let f=1;if(r.isInstancedBufferGeometry===!0?f=r.instanceCount:e.count!==void 0&&(f=Math.max(0,e.count)),f===0)return null;if(o.instanceCount=f,e.isBatchedMesh===!0)return o;let p=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(p=2);let g=s.start*p,v=(s.start+s.count)*p;i!==null&&(g=Math.max(g,i.start*p),v=Math.min(v,(i.start+i.count)*p));const b=r.attributes.position;let T=1/0;c?T=a.count:b!=null&&(T=b.count),g=Math.max(g,0),v=Math.min(v,T);const S=v-g;return S<0||S===1/0?null:(o.vertexCount=S,o.firstVertex=g,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const r of Object.keys(e.attributes).sort()){const i=e.attributes[r];t+=r+",",i.data&&(t+=i.data.stride+","),i.offset&&(t+=i.offset+","),i.itemSize&&(t+=i.itemSize+","),i.normalized&&(t+="n,")}for(const r of Object.keys(e.morphAttributes).sort()){const i=e.morphAttributes[r];t+="morph-"+r+",";for(let s=0,o=i.length;s<o;s++){const a=i[s];t+=a.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t,renderer:r}=this;let i=t.customProgramCacheKey();for(const s of Ik(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(s))continue;const o=t[s];let a;if(o!==null){const c=typeof o;c==="number"?a=o!==0?"1":"0":c==="object"?(a="{",o.isTexture&&(a+=o.mapping,r.backend.isWebGPUBackend===!0&&(a+=o.magFilter,a+=o.minFilter,a+=o.wrapS,a+=o.wrapT,a+=o.wrapR)),a+="}"):a=String(o)}else a=String(o);i+=a+","}return i+=this.clippingContextCacheKey+",",e.geometry&&(i+=this.getGeometryCacheKey()),e.skeleton&&(i+=e.skeleton.bones.length+","),e.isBatchedMesh&&(i+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(i+=e._colorsTexture.uuid+",")),(e.isInstancedMesh||e.count>1||Array.isArray(e.morphTargetInfluences))&&(i+=e.uuid+","),i+=this.context.id+",",i+=e.receiveShadow+",",YA(i)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const e=this.attributesId;for(const t in e){const r=this.geometry.getAttribute(t);if(r===void 0||e[t]!==r.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=cA(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=cA(e,1)),e=cA(e,this.camera.id,this.renderer.contextNode.id,this.renderer.contextNode.version),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const Aa=[];class Uk{constructor(e,t,r,i,s,o){this.renderer=e,this.nodes=t,this.geometries=r,this.pipelines=i,this.bindings=s,this.info=o,this.chainMaps={}}get(e,t,r,i,s,o,a,c){const f=this.getChainMap(c);Aa[0]=e,Aa[1]=t,Aa[2]=o,Aa[3]=s;let p=f.get(Aa);return p===void 0?(p=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,r,i,s,o,a,c),f.set(Aa,p)):(p.updateClipping(a),p.needsGeometryUpdate&&p.setGeometry(e.geometry),(p.version!==t.version||p.needsUpdate)&&(p.initialCacheKey!==p.getCacheKey()?(p.dispose(),p=this.get(e,t,r,i,s,o,a,c)):p.version=t.version)),Aa.length=0,p}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new Xi)}dispose(){this.chainMaps={}}createRenderObject(e,t,r,i,s,o,a,c,f,p,g){const v=this.getChainMap(g),b=new kk(e,t,r,i,s,o,a,c,f,p);return b.onDispose=()=>{this.pipelines.delete(b),this.bindings.deleteForRender(b),this.nodes.delete(b),v.delete(b.getChainArray())},b}}class Zo{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const yi={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Lo=16,qk=211,Gk=212;class Vk extends Zo{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const r=this.get(e);if(r.version===void 0)t===yi.VERTEX?this.backend.createAttribute(e):t===yi.INDEX?this.backend.createIndexAttribute(e):t===yi.STORAGE?this.backend.createStorageAttribute(e):t===yi.INDIRECT&&this.backend.createIndirectStorageAttribute(e),r.version=this._getBufferAttribute(e).version;else{const i=this._getBufferAttribute(e);(r.version<i.version||i.usage===Na)&&(this.backend.updateAttribute(e),r.version=i.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function R5(n){return n.index!==null?n.index.version:n.attributes.position.version}function Cv(n){const e=[],t=n.index,r=n.attributes.position;if(t!==null){const s=t.array;for(let o=0,a=s.length;o<a;o+=3){const c=s[o+0],f=s[o+1],p=s[o+2];e.push(c,f,f,p,p,c)}}else{const s=r.array;for(let o=0,a=s.length/3-1;o<a;o+=3){const c=o+0,f=o+1,p=o+2;e.push(c,f,f,p,p,c)}}const i=new(UN(e)?IN:kN)(e,1);return i.version=R5(n),i}class zk extends Zo{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,r=this.get(t);r.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const s=t.index,o=e.getAttributes();s!==null&&this.attributes.delete(s);for(const c of o)this.attributes.delete(c);const a=this.wireframes.get(t);a!==void 0&&this.attributes.delete(a),t.removeEventListener("dispose",i),this._geometryDisposeListeners.delete(t)};t.addEventListener("dispose",i),this._geometryDisposeListeners.set(t,i)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,yi.STORAGE):this.updateAttribute(s,yi.VERTEX);const r=this.getIndex(e);r!==null&&this.updateAttribute(r,yi.INDEX);const i=e.geometry.indirect;i!==null&&this.updateAttribute(i,yi.INDIRECT)}updateAttribute(e,t){const r=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,r)):this.attributeCall.get(e.data)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e.data,r),this.attributeCall.set(e,r)):this.attributeCall.get(e)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e,r))}getIndirect(e){return e.geometry.indirect}getIndirectOffset(e){return e.geometry.indirectOffset}getIndex(e){const{geometry:t,material:r}=e;let i=t.index;if(r.wireframe===!0){const s=this.wireframes;let o=s.get(t);o===void 0?(o=Cv(t),s.set(t,o)):o.version!==R5(t)&&(this.attributes.delete(o),o=Cv(t),s.set(t,o)),i=o}return i}dispose(){for(const[e,t]of this._geometryDisposeListeners.entries())e.removeEventListener("dispose",t);this._geometryDisposeListeners.clear()}}class $k{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,r){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=r*(t/3):e.isPoints?this.render.points+=r*t:e.isLineSegments?this.render.lines+=r*(t/2):e.isLine?this.render.lines+=r*(t-1):Pe("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class C5{constructor(e){this.cacheKey=e,this.usedTimes=0}}class jk extends C5{constructor(e,t,r){super(e),this.vertexProgram=t,this.fragmentProgram=r}}class Hk extends C5{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let Wk=0;class op{constructor(e,t,r,i=null,s=null){this.id=Wk++,this.code=e,this.stage=t,this.name=r,this.transforms=i,this.attributes=s,this.usedTimes=0}}class Qk extends Zo{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:r}=this,i=this.get(e);if(this._needsComputeUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let a=this.programs.compute.get(o.computeShader);a===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),a=new op(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),r.createProgram(a));const c=this._getComputeCacheKey(e,a);let f=this.caches.get(c);f===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),f=this._getComputePipeline(e,a,c,t)),f.usedTimes++,a.usedTimes++,i.version=e.version,i.pipeline=f}return i.pipeline}getForRender(e,t=null){const{backend:r}=this,i=this.get(e);if(this._needsRenderUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),a=e.material?e.material.name:"";let c=this.programs.vertex.get(o.vertexShader);c===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),c=new op(o.vertexShader,"vertex",a),this.programs.vertex.set(o.vertexShader,c),r.createProgram(c));let f=this.programs.fragment.get(o.fragmentShader);f===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),f=new op(o.fragmentShader,"fragment",a),this.programs.fragment.set(o.fragmentShader,f),r.createProgram(f));const p=this._getRenderCacheKey(e,c,f);let g=this.caches.get(p);g===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),g=this._getRenderPipeline(e,c,f,p,t)):e.pipeline=g,g.usedTimes++,c.usedTimes++,f.usedTimes++,i.pipeline=g}return i.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,r,i){r=r||this._getComputeCacheKey(e,t);let s=this.caches.get(r);return s===void 0&&(s=new Hk(r,t),this.caches.set(r,s),this.backend.createComputePipeline(s,i)),s}_getRenderPipeline(e,t,r,i,s){i=i||this._getRenderCacheKey(e,t,r);let o=this.caches.get(i);return o===void 0&&(o=new jk(i,t,r),this.caches.set(i,o),e.pipeline=o,this.backend.createRenderPipeline(e,s)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,r){return t.id+","+r.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,r=e.stage;this.programs[r].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class Yk extends Zo{constructor(e,t,r,i,s,o){super(),this.backend=e,this.textures=r,this.pipelines=s,this.attributes=i,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t){const i=this.get(r);i.bindGroup===void 0&&(this._init(r),this.backend.createBindings(r,t,0),i.bindGroup=r)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}deleteForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t)this.backend.deleteBindGroupData(r),this.delete(r)}deleteForRender(e){const t=e.getBindings();for(const r of t)this.backend.deleteBindGroupData(r),this.delete(r)}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isSampler)this.textures.updateSampler(t.texture);else if(t.isStorageBuffer){const r=t.attribute,i=r.isIndirectStorageBufferAttribute?yi.INDIRECT:yi.STORAGE;this.attributes.update(r,i)}}_update(e,t){const{backend:r}=this;let i=!1,s=!0,o=0,a=0;for(const c of e.bindings)if(this.nodes.updateGroup(c)!==!1){if(c.isStorageBuffer){const p=c.attribute,g=p.isIndirectStorageBufferAttribute?yi.INDIRECT:yi.STORAGE;this.attributes.update(p,g)}if(c.isUniformBuffer)c.update()&&r.updateBinding(c);else if(c.isSampledTexture){const p=c.update(),g=c.texture,v=this.textures.get(g);if(p&&(this.textures.updateTexture(g),c.generation!==v.generation&&(c.generation=v.generation,i=!0,s=!1)),r.get(g).externalTexture!==void 0||v.isDefaultTexture?s=!1:(o=o*10+g.id,a+=g.version),g.isStorageTexture===!0&&g.mipmapsAutoUpdate===!0){const T=this.get(g);c.store===!0?T.needsMipmap=!0:this.textures.needsMipmaps(g)&&T.needsMipmap===!0&&(this.backend.generateMipmaps(g),T.needsMipmap=!1)}}else if(c.isSampler&&c.update()){const g=this.textures.updateSampler(c.texture);c.samplerKey!==g&&(c.samplerKey=g,i=!0,s=!1)}}i===!0&&this.backend.updateBindings(e,t,s?o:0,a)}}function Xk(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?n.z-e.z:n.id-e.id}function Mv(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function Pv(n){return(n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode)&&n.side===vi&&n.forceSinglePass===!1}class Kk{constructor(e,t,r){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,r),this.lightsArray=[],this.scene=t,this.camera=r,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,r,i,s,o,a){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:r,groupOrder:i,renderOrder:e.renderOrder,z:s,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=r,c.groupOrder=i,c.renderOrder=e.renderOrder,c.z=s,c.group=o,c.clippingContext=a),this.renderItemsIndex++,c}push(e,t,r,i,s,o,a){const c=this.getNextRenderItem(e,t,r,i,s,o,a);e.occlusionTest===!0&&this.occlusionQueryCount++,r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(Pv(r)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,r,i,s,o,a){const c=this.getNextRenderItem(e,t,r,i,s,o,a);r.transparent===!0||r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode||r.backdropNode&&r.backdropNode.isNode?(Pv(r)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||Xk),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||Mv),this.transparent.length>1&&this.transparent.sort(t||Mv)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const r=this.renderItems[e];if(r.id===null)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.groupOrder=null,r.renderOrder=null,r.z=null,r.group=null,r.clippingContext=null}}}const Lu=[];class Zk{constructor(e){this.lighting=e,this.lists=new Xi}get(e,t){const r=this.lists;Lu[0]=e,Lu[1]=t;let i=r.get(Lu);return i===void 0&&(i=new Kk(this.lighting,e,t),r.set(Lu,i)),Lu.length=0,i}dispose(){this.lists=new Xi}}let Jk=0;class eU{constructor(){this.id=Jk++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Vt,this.scissor=!1,this.scissorValue=new Vt,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return M5(this)}}function M5(n){const{textures:e,activeCubeFace:t,activeMipmapLevel:r}=n,i=[t,r];for(const s of e)i.push(s.id);return cu(i)}const ml=[],tU=new Kh,nU=new Lg;class rU{constructor(){this.chainMaps={}}get(e,t,r=null,i=null){ml[0]=e,ml[1]=t,i!==null&&(ml[2]=i);let s;if(r===null)s="default";else{const c=r.texture.format;s=`${r.textures.length}:${c}:${r.samples}:${r.depthBuffer}:${r.stencilBuffer}`}const o=this._getChainMap(s);let a=o.get(ml);return a===void 0&&(a=new eU,o.set(ml,a)),ml.length=0,r!==null&&(a.sampleCount=r.samples===0?1:r.samples),a}getForClear(e=null){return this.get(tU,nU,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new Xi)}dispose(){this.chainMaps={}}}const iU=new we;class sU extends Zo{constructor(e,t,r){super(),this.renderer=e,this.backend=t,this.info=r}updateRenderTarget(e,t=0){const r=this.get(e),i=e.samples===0?1:e.samples,s=r.depthTextureMips||(r.depthTextureMips={}),o=e.textures,a=this.getSize(o[0]),c=a.width>>t,f=a.height>>t;let p=e.depthTexture||s[t];const g=e.depthBuffer===!0||e.stencilBuffer===!0;let v=!1;p===void 0&&g&&(p=new $i,p.format=e.stencilBuffer?ko:Uo,p.type=e.stencilBuffer?Io:Fn,p.image.width=c,p.image.height=f,p.image.depth=a.depth,p.renderTarget=e,p.isArrayTexture=e.multiview===!0&&a.depth>1,s[t]=p),(r.width!==a.width||a.height!==r.height)&&(v=!0,p&&(p.needsUpdate=!0,p.image.width=c,p.image.height=f,p.image.depth=p.isArrayTexture?p.image.depth:1)),r.width=a.width,r.height=a.height,r.textures=o,r.depthTexture=p||null,r.depth=e.depthBuffer,r.stencil=e.stencilBuffer,r.renderTarget=e,r.sampleCount!==i&&(v=!0,p&&(p.needsUpdate=!0),r.sampleCount=i);const b={sampleCount:i};if(e.isXRRenderTarget!==!0){for(let T=0;T<o.length;T++){const S=o[T];v&&(S.needsUpdate=!0),this.updateTexture(S,b)}p&&this.updateTexture(p,b)}r.initialized!==!0&&(r.initialized=!0,r.onDispose=()=>{this._destroyRenderTarget(e)},e.addEventListener("dispose",r.onDispose))}updateTexture(e,t={}){const r=this.get(e);if(r.initialized===!0&&r.version===e.version)return;const i=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(i&&r.initialized===!0&&s.destroyTexture(e),e.isFramebufferTexture){const f=this.renderer.getRenderTarget();f?e.type=f.texture.type:e.type=ni}const{width:o,height:a,depth:c}=this.getSize(e);if(t.width=o,t.height=a,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,a):1,e.isCubeTexture&&e.mipmaps.length>0&&t.levels++,i||e.isStorageTexture===!0||e.isExternalTexture===!0)s.createTexture(e,t),r.generation=e.version;else if(e.version>0){const f=e.image;if(f===void 0)Be("Renderer: Texture marked for update but image is undefined.");else if(f.complete===!1)Be("Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const g=[];for(const v of e.images)g.push(v);t.images=g}else t.image=f;(r.isDefaultTexture===void 0||r.isDefaultTexture===!0)&&(s.createTexture(e,t),r.isDefaultTexture=!1,r.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t);const p=e.isStorageTexture===!0&&e.mipmapsAutoUpdate===!1;t.needsMipmaps&&e.mipmaps.length===0&&!p&&s.generateMipmaps(e),e.onUpdate&&e.onUpdate(e)}}else s.createDefaultTexture(e),r.isDefaultTexture=!0,r.generation=e.version;r.initialized!==!0&&(r.initialized=!0,r.generation=e.version,this.info.memory.textures++,e.isVideoTexture&&xn.enabled===!0&&xn.getTransfer(e.colorSpace)!==ht&&Be("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),r.onDispose=()=>{this._destroyTexture(e)},e.addEventListener("dispose",r.onDispose)),r.version=e.version}updateSampler(e){return this.backend.updateSampler(e)}getSize(e,t=iU){let r=e.images?e.images[0]:e.image;return r?(r.image!==void 0&&(r=r.image),typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement?(t.width=r.videoWidth||1,t.height=r.videoHeight||1,t.depth=1):typeof VideoFrame<"u"&&r instanceof VideoFrame?(t.width=r.displayWidth||1,t.height=r.displayHeight||1,t.depth=1):(t.width=r.width||1,t.height=r.height||1,t.depth=e.isCubeTexture?6:r.depth||1)):t.width=t.height=t.depth=1,t}getMipLevels(e,t,r){let i;return e.mipmaps.length>0?i=e.mipmaps.length:e.isCompressedTexture===!0?i=1:i=Math.floor(Math.log2(Math.max(t,r)))+1,i}needsMipmaps(e){return e.generateMipmaps===!0||e.mipmaps.length>0}_destroyRenderTarget(e){if(this.has(e)===!0){const t=this.get(e),r=t.textures,i=t.depthTexture;e.removeEventListener("dispose",t.onDispose);for(let s=0;s<r.length;s++)this._destroyTexture(r[s]);i&&this._destroyTexture(i),this.delete(e),this.backend.delete(e)}}_destroyTexture(e){if(this.has(e)===!0){const t=this.get(e);e.removeEventListener("dispose",t.onDispose);const r=t.isDefaultTexture;this.backend.destroyTexture(e,r),this.delete(e),this.info.memory.textures--}}}class M2 extends Gn{constructor(e,t,r,i=1){super(e,t,r),this.a=i}set(e,t,r,i=1){return this.a=i,super.set(e,t,r)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class P5 extends Bt{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getMemberType(e,t){const r=this.getNodeType(e),i=e.getStructTypeNode(r);let s;return i!==null?s=i.getMemberType(e,t):(Pe(`TSL: Member "${t}" not found in struct "${r}".`),s="float"),s}getHash(){return this.uuid}generate(){return this.name}}const oU=(n,e)=>new P5(n,e);class aU extends Oe{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(e){return this.hasOutput?this.outputNode.getElementType(e):"void"}getNodeType(e){return this.hasOutput?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.hasOutput?this.outputNode.getMemberType(e,t):"void"}addToStack(e,t=this.nodes.length){return e.isNode!==!0?(Pe("TSL: Invalid node added to stack."),this):(this.nodes.splice(t,0,e),this)}addToStackBefore(e){const t=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(e,t)}If(e,t){const r=new Ll(t);return this._currentCond=sr(e,r),this.addToStack(this._currentCond)}ElseIf(e,t){const r=new Ll(t),i=sr(e,r);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(e){return this._currentCond.elseNode=new Ll(e),this}Switch(e){return this._expressionNode=Me(e),this}Case(...e){const t=[];if(e.length>=2)for(let a=0;a<e.length-1;a++)t.push(this._expressionNode.equal(Me(e[a])));else Pe("TSL: Invalid parameter length. Case() requires at least two parameters.");const r=e[e.length-1],i=new Ll(r);let s=t[0];for(let a=1;a<t.length;a++)s=s.or(t[a]);const o=sr(s,i);return this._currentCond===null?(this._currentCond=o,this.addToStack(this._currentCond)):(this._currentCond.elseNode=o,this._currentCond=o,this)}Default(e){return this.Else(e),this}setup(e){const t=e.getNodeProperties(this);let r=0;for(const i of this.getChildren())i.isVarNode&&i.isIntent(e)&&i.isAssign(e)!==!0||(t["node"+r++]=i);return t.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(e,...t){const r=E1(),i=e.buildStage;FA(this),e.setActiveStack(this);const s=f=>{if(this._currentNode=f,!(f.isVarNode&&f.isIntent(e)&&f.isAssign(e)!==!0)){if(i==="setup")f.build(e);else if(i==="analyze")f.build(e,this);else if(i==="generate"){const p=e.getDataFromNode(f,"any").stages,g=p&&p[e.shaderStage];if(f.isVarNode&&g&&g.length===1&&g[0]&&g[0].isStackNode)return;f.build(e,"void")}}},o=[...this.nodes];for(const f of o)s(f);this._currentNode=null;const a=this.nodes.filter(f=>o.indexOf(f)===-1);for(const f of a)s(f);let c;return this.hasOutput?c=this.outputNode.build(e,...t):c=super.build(e,...t),FA(r),e.removeActiveStack(this),c}}const F0=Ze(aU).setParameterLength(0,1);function lU(n){return Object.entries(n).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class uU extends Oe{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=lU(e),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=1,r=0;for(const i of this.membersLayout){const s=i.type,o=ML(s),a=PL(s)/e;t=Math.max(t,a);const f=r%t%a;f!==0&&(r+=a-f),r+=o}return Math.ceil(r/t)*t}getMemberType(e,t){const r=this.membersLayout.find(i=>i.name===t);return r?r.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.getStructTypeFromNode(this,this.membersLayout,this.name),e.addInclude(this)}generate(e){return this.getNodeType(e)}}class AU extends Oe{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structTypeNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structTypeNode.getNodeType(e)}getMemberType(e,t){return this.structTypeNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),r=t.type,i=e.getPropertyName(t);return e.addLineFlowCode(`${i} = ${e.generateStruct(r,this.structTypeNode.membersLayout,this.values)}`,this),t.name}}const cU=(n,e=null)=>{const t=new uU(n,e),r=(...i)=>{let s=null;if(i.length>0)if(i[0].isNode){s={};const o=Object.keys(n);for(let a=0;a<i.length;a++)s[o[a]]=i[a]}else s=i[0];return new AU(t,s)};return r.layout=t,r.isStruct=!0,r};class B5 extends Oe{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(t.membersLayout===void 0){const r=this.members,i=[];for(let s=0;s<r.length;s++){const o="m"+s,a=r[s].getNodeType(e);i.push({name:o,type:a,index:s})}t.membersLayout=i,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),r=this.members,i=t!==""?t+".":"";for(let s=0;s<r.length;s++){const o=r[s].build(e);e.addLineFlowCode(`${i}m${s} = ${o}`,this)}return t}}const hU=Ze(B5);function D5(n,e){for(let t=0;t<n.length;t++)if(n[t].name===e)return t;return-1}class fU extends B5{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return L5(t)}setup(e){const t=this.outputNodes,r=e.renderer.getRenderTarget(),i=[],s=r.textures;for(const o in t){const a=D5(s,o);i[a]=ze(t[o])}return this.members=i,super.setup(e)}}const L5=Ze(fU);class nc extends _n{static get type(){return"BitcastNode"}constructor(e,t,r=null){super(),this.valueNode=e,this.conversionType=t,this.inputType=r,this.isBitcastNode=!0}getNodeType(e){if(this.inputType!==null){const t=this.valueNode.getNodeType(e),r=e.getTypeLength(t);return e.getTypeFromLength(r,this.conversionType)}return this.conversionType}generate(e){const t=this.getNodeType(e);let r="";if(this.inputType!==null){const i=this.valueNode.getNodeType(e);r=e.getTypeLength(i)===1?this.inputType:e.changeComponentType(i,this.inputType)}else r=this.valueNode.getNodeType(e);return`${e.getBitcastMethod(t,r)}( ${this.valueNode.build(e,r)} )`}}const F5=Te(nc).setParameterLength(2),dU=n=>new nc(n,"int","float"),O5=n=>new nc(n,"uint","float"),pU=n=>new nc(n,"float","int"),mU=n=>new nc(n,"float","uint"),qc={};class ri extends le{static get type(){return"BitcountNode"}constructor(e,t){super(e,t),this.isBitcountNode=!0}_resolveElementType(e,t,r){r==="int"?t.assign(F5(e,"uint")):t.assign(e)}_returnDataNode(e){switch(e){case"uint":return me;case"int":return Q;case"uvec2":return N1;case"uvec3":return Wa;case"uvec4":return P1;case"ivec2":return Dn;case"ivec3":return R1;case"ivec4":return M1}}_createTrailingZerosBaseLayout(e,t){const r=this._returnDataNode(t);return ee(([s])=>{const o=me(0);this._resolveElementType(s,o,t);const a=V(o.bitAnd($1(o))),f=O5(a).shiftRight(23).sub(127);return r(f)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createLeadingZerosBaseLayout(e,t){const r=this._returnDataNode(t);return ee(([s])=>{Ve(s.equal(me(0)),()=>me(32));const o=me(0),a=me(0);return this._resolveElementType(s,o,t),Ve(o.shiftRight(16).equal(0),()=>{a.addAssign(16),o.shiftLeftAssign(16)}),Ve(o.shiftRight(24).equal(0),()=>{a.addAssign(8),o.shiftLeftAssign(8)}),Ve(o.shiftRight(28).equal(0),()=>{a.addAssign(4),o.shiftLeftAssign(4)}),Ve(o.shiftRight(30).equal(0),()=>{a.addAssign(2),o.shiftLeftAssign(2)}),Ve(o.shiftRight(31).equal(0),()=>{a.addAssign(1)}),r(a)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createOneBitsBaseLayout(e,t){const r=this._returnDataNode(t);return ee(([s])=>{const o=me(0);this._resolveElementType(s,o,t),o.assign(o.sub(o.shiftRight(me(1)).bitAnd(me(1431655765)))),o.assign(o.bitAnd(me(858993459)).add(o.shiftRight(me(2)).bitAnd(me(858993459))));const a=o.add(o.shiftRight(me(4))).bitAnd(me(252645135)).mul(me(16843009)).shiftRight(me(24));return r(a)}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}_createMainLayout(e,t,r,i){const s=this._returnDataNode(t);return ee(([a])=>{if(r===1)return s(i(a));{const c=s(0),f=["x","y","z","w"];for(let p=0;p<r;p++){const g=f[p];c[g].assign(i(a[g]))}return c}}).setLayout({name:e,type:t,inputs:[{name:"value",type:t}]})}setup(e){const{method:t,aNode:r}=this,{renderer:i}=e;if(i.backend.isWebGPUBackend)return super.setup(e);const s=this.getInputType(e),o=e.getElementType(s),a=e.getTypeLength(s),c=`${t}_base_${o}`,f=`${t}_${s}`;let p=qc[c];if(p===void 0){switch(t){case ri.COUNT_LEADING_ZEROS:{p=this._createLeadingZerosBaseLayout(c,o);break}case ri.COUNT_TRAILING_ZEROS:{p=this._createTrailingZerosBaseLayout(c,o);break}case ri.COUNT_ONE_BITS:{p=this._createOneBitsBaseLayout(c,o);break}}qc[c]=p}let g=qc[f];return g===void 0&&(g=this._createMainLayout(f,s,a,p),qc[f]=g),ee(()=>g(r))()}}ri.COUNT_TRAILING_ZEROS="countTrailingZeros";ri.COUNT_LEADING_ZEROS="countLeadingZeros";ri.COUNT_ONE_BITS="countOneBits";const gU=Te(ri,ri.COUNT_TRAILING_ZEROS).setParameterLength(1),_U=Te(ri,ri.COUNT_LEADING_ZEROS).setParameterLength(1),yU=Te(ri,ri.COUNT_ONE_BITS).setParameterLength(1),vU=ee(([n])=>{const e=n.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),fg=(n,e)=>gi(Ke(4,n.mul(Tt(1,n))),e),xU=(n,e)=>n.lessThan(.5)?fg(n.mul(2),e).div(2):Tt(1,fg(Ke(Tt(1,n),2),e).div(2)),bU=(n,e,t)=>gi(si(gi(n,e),Mn(gi(n,e),gi(Tt(1,n),t))),1/e),TU=(n,e)=>Rr(Oh.mul(e.mul(n).sub(1))).div(Oh.mul(e.mul(n).sub(1)));class P2 extends _n{static get type(){return"PackFloatNode"}constructor(e,t){super(),this.vectorNode=t,this.encoding=e,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(e){const t=this.vectorNode.getNodeType(e);return`${e.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(e,t)})`}}const wU=Te(P2,"snorm").setParameterLength(1),SU=Te(P2,"unorm").setParameterLength(1),EU=Te(P2,"float16").setParameterLength(1);class B2 extends _n{static get type(){return"UnpackFloatNode"}constructor(e,t){super(),this.uintNode=t,this.encoding=e,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(e){const t=this.uintNode.getNodeType(e);return`${e.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(e,t)})`}}const NU=Te(B2,"snorm").setParameterLength(1),RU=Te(B2,"unorm").setParameterLength(1),CU=Te(B2,"float16").setParameterLength(1),Us=ee(([n])=>n.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),MU=ee(([n])=>X(Us(n.z.add(Us(n.y.mul(1)))),Us(n.z.add(Us(n.x.mul(1)))),Us(n.y.add(Us(n.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),PU=ee(([n,e,t])=>{const r=X(n).toVar(),i=V(1.4).toVar(),s=V(0).toVar(),o=X(r).toVar();return It({start:V(0),end:V(3),type:"float",condition:"<="},()=>{const a=X(MU(o.mul(2))).toVar();r.addAssign(a.add(t.mul(V(.1).mul(e)))),o.mulAssign(1.8),i.mulAssign(1.5),r.mulAssign(1.2);const c=V(Us(r.z.add(Us(r.x.add(Us(r.y)))))).toVar();s.addAssign(c.div(i)),o.addAssign(.14)}),s}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class BU extends Oe{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFn=null,this.global=!0}getNodeType(e){return this.getCandidateFn(e).shaderNode.layout.type}getCandidateFn(e){const t=this.parametersNodes;let r=this._candidateFn;if(r===null){let i=null,s=-1;for(const o of this.functionNodes){const c=o.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const f=c.inputs;if(t.length===f.length){let p=0;for(let g=0;g<t.length;g++){const v=t[g],b=f[g];v.getNodeType(e)===b.type&&p++}p>s&&(i=o,s=p)}}this._candidateFn=r=i}return r}setup(e){return this.getCandidateFn(e)(...this.parametersNodes)}}const DU=Ze(BU),lr=n=>(...e)=>DU(n,...e),du=Ge(0).setGroup(qe).onRenderUpdate(n=>n.time),LU=Ge(0).setGroup(qe).onRenderUpdate(n=>n.deltaTime),I5=Ge(0,"uint").setGroup(qe).onRenderUpdate(n=>n.frameId),FU=(n=du)=>n.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),OU=(n=du)=>n.fract().round(),IU=(n=du)=>n.add(.5).fract().mul(2).sub(1).abs(),kU=(n=du)=>n.fract();function UU(n,e=null){return lo(e,{getUV:n})}const qU=ee(([n,e,t=xe(.5)])=>tc(n.sub(t),e).add(t)),GU=ee(([n,e,t=xe(.5)])=>{const r=n.sub(t),i=r.dot(r),o=i.mul(i).mul(e);return n.add(r.mul(o))}),VU=ee(({position:n=null,horizontal:e=!0,vertical:t=!1})=>{let r;n!==null?(r=_i.toVar(),r[3][0]=n.x,r[3][1]=n.y,r[3][2]=n.z):r=_i;const i=Mi.mul(r);return LA(e)&&(i[0][0]=_i[0].length(),i[0][1]=0,i[0][2]=0),LA(t)&&(i[1][0]=0,i[1][1]=_i[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,Ks.mul(i).mul(fn)}),zU=ee(([n=null])=>{const e=Uh();return Uh(v2(n)).sub(e).lessThan(0).select(Xs,n)});class $U extends Oe{static get type(){return"SpriteSheetUVNode"}constructor(e,t=zt(),r=V(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=r}setup(){const{frameNode:e,uvNode:t,countNode:r}=this,{width:i,height:s}=r,o=e.mod(i.mul(s)).floor(),a=o.mod(i),c=s.sub(o.add(1).div(i).ceil()),f=r.reciprocal(),p=xe(a,c);return t.add(p).mul(f)}}const jU=Ze($U).setParameterLength(3),k5=ee(([n,e=null,t=null,r=V(1),i=fn,s=zr])=>{let o=s.abs().normalize();o=o.div(o.dot(X(1)));const a=i.yz.mul(r),c=i.zx.mul(r),f=i.xy.mul(r),p=n.value,g=e!==null?e.value:p,v=t!==null?t.value:p,b=Rt(p,a).mul(o.x),T=Rt(g,c).mul(o.y),S=Rt(v,f).mul(o.z);return Mn(b,T,S)}),HU=(...n)=>k5(...n),gl=new zg,ca=new we,_l=new we,ap=new we,Fu=new hn,Gc=new we(0,0,-1),is=new Vt,Ou=new we,Vc=new we,Iu=new Vt,zc=new gt,Gh=new Qo,WU=Xs.flipX();Gh.depthTexture=new $i(1,1);let $c=!1;class D2 extends Es{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||Gh.texture,WU),this._reflectorBaseNode=e.reflector||new QU(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=Me(new D2({defaultTexture:Gh.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class QU extends Oe{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:r=new Xh,resolutionScale:i=1,generateMipmaps:s=!1,bounces:o=!0,depth:a=!1,samples:c=0}=t;this.textureNode=e,this.target=r,this.resolutionScale=i,t.resolution!==void 0&&(cn('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=t.resolution),this.generateMipmaps=s,this.bounces=o,this.depth=a,this.samples=c,this.updateBeforeType=o?it.RENDER:it.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const r=this.resolutionScale;t.getDrawingBufferSize(zc),e.setSize(Math.round(zc.width*r),Math.round(zc.height*r))}setup(e){return this._updateResolution(Gh,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new Qo(0,0,{type:rr,samples:this.samples}),this.generateMipmaps===!0&&(t.texture.minFilter=gR,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new $i),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&$c)return!1;$c=!0;const{scene:t,camera:r,renderer:i,material:s}=e,{target:o}=this,a=this.getVirtualCamera(r),c=this.getRenderTarget(a);i.getDrawingBufferSize(zc),this._updateResolution(c,i),_l.setFromMatrixPosition(o.matrixWorld),ap.setFromMatrixPosition(r.matrixWorld),Fu.extractRotation(o.matrixWorld),ca.set(0,0,1),ca.applyMatrix4(Fu),Ou.subVectors(_l,ap);const f=Ou.dot(ca)>0;let p=!1;if(f===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){$c=!1;return}p=!0}Ou.reflect(ca).negate(),Ou.add(_l),Fu.extractRotation(r.matrixWorld),Gc.set(0,0,-1),Gc.applyMatrix4(Fu),Gc.add(ap),Vc.subVectors(_l,Gc),Vc.reflect(ca).negate(),Vc.add(_l),a.coordinateSystem=r.coordinateSystem,a.position.copy(Ou),a.up.set(0,1,0),a.up.applyMatrix4(Fu),a.up.reflect(ca),a.lookAt(Vc),a.near=r.near,a.far=r.far,a.updateMatrixWorld(),a.projectionMatrix.copy(r.projectionMatrix),gl.setFromNormalAndCoplanarPoint(ca,_l),gl.applyMatrix4(a.matrixWorldInverse),is.set(gl.normal.x,gl.normal.y,gl.normal.z,gl.constant);const g=a.projectionMatrix;Iu.x=(Math.sign(is.x)+g.elements[8])/g.elements[0],Iu.y=(Math.sign(is.y)+g.elements[9])/g.elements[5],Iu.z=-1,Iu.w=(1+g.elements[10])/g.elements[14],is.multiplyScalar(1/is.dot(Iu));const v=0;g.elements[2]=is.x,g.elements[6]=is.y,g.elements[10]=i.coordinateSystem===Vo?is.z-v:is.z+1-v,g.elements[14]=is.w,this.textureNode.value=c.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=c.depthTexture),s.visible=!1;const b=i.getRenderTarget(),T=i.getMRT(),S=i.autoClear;i.setMRT(null),i.setRenderTarget(c),i.autoClear=!0;const N=t.name;t.name=(t.name||"Scene")+" [ Reflector ]",p?(i.clear(),this.hasOutput=!1):(i.render(t,a),this.hasOutput=!0),t.name=N,i.setMRT(T),i.setRenderTarget(b),i.autoClear=S,s.visible=!0,$c=!1,this.forceUpdate=!1}get resolution(){return cn('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(e){cn('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=e}}const YU=n=>new D2(n),lp=new kg(-1,1,1,-1,0,1);class XU extends oi{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Go([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Go(t,2))}}const KU=new XU;class Lf extends pn{constructor(e=null){super(KU,e),this.camera=lp,this.isQuadMesh=!0}async renderAsync(e){cn('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await e.init(),e.render(this,lp)}render(e){e.render(this,lp)}}const ZU=new gt;class JU extends Es{static get type(){return"RTTNode"}constructor(e,t=null,r=null,i={type:rr}){const s=new Qo(t,r,i);super(s.texture,zt()),this.isRTTNode=!0,this.node=e,this.width=t,this.height=r,this.pixelRatio=1,this.renderTarget=s,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new Lf(new Tn),this.updateBeforeType=it.RENDER}get autoResize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const r=e*this.pixelRatio,i=t*this.pixelRatio;this.renderTarget.setSize(r,i),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const i=e.getPixelRatio(),s=e.getSize(ZU),o=Math.floor(s.width*i),a=Math.floor(s.height*i);(o!==this.renderTarget.width||a!==this.renderTarget.height)&&(this.renderTarget.setSize(o,a),this.textureNeedsUpdate=!0)}let t="RTT";this.node.name&&(t=this.node.name+" [ "+t+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=t;const r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(r)}clone(){const e=new Es(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const U5=(n,...e)=>Me(new JU(Me(n),...e)),eq=(n,...e)=>n.isSampleNode||n.isTextureNode?n:n.isPassNode?n.getTextureNode():U5(n,...e),Nl=ee(([n,e,t],r)=>{let i;r.renderer.coordinateSystem===Vo?(n=xe(n.x,n.y.oneMinus()).mul(2).sub(1),i=ze(X(n,e),1)):i=ze(X(n.x,n.y.oneMinus(),e).mul(2).sub(1),1);const s=ze(t.mul(i));return s.xyz.div(s.w)}),tq=ee(([n,e])=>{const t=e.mul(ze(n,1)),r=t.xy.div(t.w).mul(.5).add(.5).toVar();return xe(r.x,r.y.oneMinus())}),nq=ee(([n,e,t])=>{const r=Ys(vn(e)),i=Dn(n.mul(r)).toVar(),s=vn(e,i).toVar(),o=vn(e,i.sub(Dn(2,0))).toVar(),a=vn(e,i.sub(Dn(1,0))).toVar(),c=vn(e,i.add(Dn(1,0))).toVar(),f=vn(e,i.add(Dn(2,0))).toVar(),p=vn(e,i.add(Dn(0,2))).toVar(),g=vn(e,i.add(Dn(0,1))).toVar(),v=vn(e,i.sub(Dn(0,1))).toVar(),b=vn(e,i.sub(Dn(0,2))).toVar(),T=Xt(Tt(V(2).mul(a).sub(o),s)).toVar(),S=Xt(Tt(V(2).mul(c).sub(f),s)).toVar(),N=Xt(Tt(V(2).mul(g).sub(p),s)).toVar(),C=Xt(Tt(V(2).mul(v).sub(b),s)).toVar(),P=Nl(n,s,t).toVar(),B=T.lessThan(S).select(P.sub(Nl(n.sub(xe(V(1).div(r.x),0)),a,t)),P.negate().add(Nl(n.add(xe(V(1).div(r.x),0)),c,t))),F=N.lessThan(C).select(P.sub(Nl(n.add(xe(0,V(1).div(r.y))),g,t)),P.negate().add(Nl(n.sub(xe(0,V(1).div(r.y))),v,t)));return Mr(io(B,F))}),L2=ee(([n])=>Wi(V(52.9829189).mul(Wi(Si(n,xe(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),qi=ee(([n,e,t])=>{const r=V(2.399963229728653),i=pr(V(n).add(.5).div(V(e))),s=V(n).mul(r).add(t);return xe(Ii(s),Rr(s)).mul(i)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class rq extends Oe{static get type(){return"SampleNode"}constructor(e,t=null){super(),this.callback=e,this.uvNode=t,this.isSampleNode=!0}setup(){return this.sample(zt())}sample(e){return this.callback(e)}}const iq=(n,e=null)=>new rq(n,Me(e));class Ur extends Oe{static get type(){return"EventNode"}constructor(e,t){super("void"),this.eventType=e,this.callback=t,e===Ur.OBJECT?this.updateType=it.OBJECT:e===Ur.MATERIAL?this.updateType=it.RENDER:e===Ur.BEFORE_OBJECT?this.updateBeforeType=it.OBJECT:e===Ur.BEFORE_MATERIAL&&(this.updateBeforeType=it.RENDER)}update(e){this.callback(e)}updateBefore(e){this.callback(e)}}Ur.OBJECT="object";Ur.MATERIAL="material";Ur.BEFORE_OBJECT="beforeObject";Ur.BEFORE_MATERIAL="beforeMaterial";const Ff=(n,e)=>new Ur(n,e).toStack(),sq=n=>Ff(Ur.OBJECT,n),oq=n=>Ff(Ur.MATERIAL,n),aq=n=>Ff(Ur.BEFORE_OBJECT,n),lq=n=>Ff(Ur.BEFORE_MATERIAL,n);class O0 extends Ol{constructor(e,t,r=Float32Array){const i=ArrayBuffer.isView(e)?e:new r(e*t);super(i,t),this.isStorageInstancedBufferAttribute=!0}}class uq extends Il{constructor(e,t,r=Float32Array){const i=ArrayBuffer.isView(e)?e:new r(e*t);super(i,t),this.isStorageBufferAttribute=!0}}const Aq=(n,e="float")=>{let t,r;e.isStruct===!0?(t=e.layout.getLength(),r=Ch("float")):(t=t8(e),r=Ch(e));const i=new uq(n,t,r);return Zs(i,e,n)},cq=(n,e="float")=>{let t,r;e.isStruct===!0?(t=e.layout.getLength(),r=Ch("float")):(t=t8(e),r=Ch(e));const i=new O0(n,t,r);return Zs(i,e,n)};class hq extends Oe{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const fq=Ce(hq),ku=new bA,up=new hn;class qr extends Oe{static get type(){return"SceneNode"}constructor(e=qr.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,r=this.scene!==null?this.scene:e.scene;let i;return t===qr.BACKGROUND_BLURRINESS?i=qt("backgroundBlurriness","float",r):t===qr.BACKGROUND_INTENSITY?i=qt("backgroundIntensity","float",r):t===qr.BACKGROUND_ROTATION?i=Ge("mat4").setName("backgroundRotation").setGroup(qe).onRenderUpdate(()=>{const s=r.background;return s!==null&&s.isTexture&&s.mapping!==AR?(ku.copy(r.backgroundRotation),ku.x*=-1,ku.y*=-1,ku.z*=-1,up.makeRotationFromEuler(ku)):up.identity(),up}):Pe("SceneNode: Unknown scope:",t),i}}qr.BACKGROUND_BLURRINESS="backgroundBlurriness";qr.BACKGROUND_INTENSITY="backgroundIntensity";qr.BACKGROUND_ROTATION="backgroundRotation";const q5=Ce(qr,qr.BACKGROUND_BLURRINESS),dg=Ce(qr,qr.BACKGROUND_INTENSITY),G5=Ce(qr,qr.BACKGROUND_ROTATION);class dq extends Es{static get type(){return"StorageTextureNode"}constructor(e,t,r=null){super(e,t),this.storeNode=r,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=ir.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}setMipLevel(e){return this.mipLevel=e,this}generate(e,t){let r;return this.storeNode!==null?r=this.generateStore(e):r=super.generate(e,t),r}toReadWrite(){return this.setAccess(ir.READ_WRITE)}toReadOnly(){return this.setAccess(ir.READ_ONLY)}toWriteOnly(){return this.setAccess(ir.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:r,storeNode:i,depthNode:s}=t,o=super.generate(e,"property"),a=r.build(e,this.value.is3DTexture===!0?"uvec3":"uvec2"),c=i.build(e,"vec4"),f=s?s.build(e,"int"):null,p=e.generateTextureStore(e,o,a,f,c);e.addLineFlowCode(p,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e.mipLevel=this.mipLevel,e}}const V5=Ze(dq).setParameterLength(1,3),pq=(n,e,t)=>{const r=V5(n,e,t);return t!==null&&r.toStack(),r},mq=ee(({texture:n,uv:e})=>{const r=X().toVar();return Ve(e.x.lessThan(1e-4),()=>{r.assign(X(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{r.assign(X(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{r.assign(X(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{r.assign(X(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{r.assign(X(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{r.assign(X(0,0,-1))}).Else(()=>{const s=n.sample(e.add(X(-.01,0,0))).r.sub(n.sample(e.add(X(.01,0,0))).r),o=n.sample(e.add(X(0,-.01,0))).r.sub(n.sample(e.add(X(0,.01,0))).r),a=n.sample(e.add(X(0,0,-.01))).r.sub(n.sample(e.add(X(0,0,.01))).r);r.assign(X(s,o,a))}),r.normalize()});class gq extends Es{static get type(){return"Texture3DNode"}constructor(e,t=null,r=null){super(e,t,r),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return X(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return e.isFlipY()&&(r.isRenderTargetTexture===!0||r.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Q(Ys(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,this.sampler===!0?"vec3":"ivec3")}generateOffset(e,t){return t.build(e,"ivec3")}normal(e){return mq({texture:this,uv:e})}}const Of=Ze(gq).setParameterLength(1,3),_q=(...n)=>Of(...n).setSampler(!1),yq=(n,e,t)=>Of(n,e).level(t);class vq extends Sf{static get type(){return"UserDataNode"}constructor(e,t,r=null){super(e,t,r),this.userData=r}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const xq=(n,e,t)=>new vq(n,e,t),Bv=new WeakMap;class bq extends _n{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=it.OBJECT,this.updateAfterType=it.OBJECT,this.previousModelWorldMatrix=Ge(new hn),this.previousProjectionMatrix=Ge(new hn).setGroup(qe),this.previousCameraViewMatrix=Ge(new hn)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:r}){const i=Dv(r);this.previousModelWorldMatrix.value.copy(i);const s=z5(t);s.frameId!==e&&(s.frameId=e,s.previousProjectionMatrix===void 0?(s.previousProjectionMatrix=new hn,s.previousCameraViewMatrix=new hn,s.currentProjectionMatrix=new hn,s.currentCameraViewMatrix=new hn,s.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(s.previousProjectionMatrix.copy(s.currentProjectionMatrix),s.previousCameraViewMatrix.copy(s.currentCameraViewMatrix)),s.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(s.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(s.previousCameraViewMatrix))}updateAfter({object:e}){Dv(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?Ks:Ge(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),r=e.mul(Xo).mul(fn),i=this.previousProjectionMatrix.mul(t).mul(kh),s=r.xy.div(r.w),o=i.xy.div(i.w);return Tt(s,o)}}function z5(n){let e=Bv.get(n);return e===void 0&&(e={},Bv.set(n,e)),e}function Dv(n,e=0){const t=z5(n);let r=t[e];return r===void 0&&(t[e]=r=new hn,t[e].copy(n.matrixWorld)),r}const Tq=Ce(bq),wq=ee(([n])=>F2(n.rgb)),Sq=ee(([n,e=V(1)])=>e.mix(F2(n.rgb),n.rgb)),Eq=ee(([n,e=V(1)])=>{const t=Mn(n.r,n.g,n.b).div(3),r=n.r.max(n.g.max(n.b)),i=r.sub(t).mul(e).mul(-3);return xt(n.rgb,r,i)}),Nq=ee(([n,e=V(1)])=>{const t=X(.57735,.57735,.57735),r=e.cos();return X(n.rgb.mul(r).add(t.cross(n.rgb).mul(e.sin()).add(t.mul(Si(t,n.rgb).mul(r.oneMinus())))))}),F2=(n,e=X(xn.getLuminanceCoefficients(new we)))=>Si(n,e),Rq=ee(([n,e=X(1),t=X(0),r=X(1),i=V(1),s=X(xn.getLuminanceCoefficients(new we,Mb))])=>{const o=n.rgb.dot(X(s)),a=gn(n.rgb.mul(e).add(t),0).toVar(),c=a.pow(r).toVar();return Ve(a.r.greaterThan(0),()=>{a.r.assign(c.r)}),Ve(a.g.greaterThan(0),()=>{a.g.assign(c.g)}),Ve(a.b.greaterThan(0),()=>{a.b.assign(c.b)}),a.assign(o.add(a.sub(o).mul(i))),ze(a.rgb,n.a)});class Cq extends _n{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const Mq=Ze(Cq).setParameterLength(2),jc=new gt;class $5 extends Es{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Lv extends $5{static get type(){return"PassMultipleTextureNode"}constructor(e,t,r=!1){super(e,null),this.textureName=t,this.previousTexture=r}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){const e=new this.constructor(this.passNode,this.textureName,this.previousTexture);return e.uvNode=this.uvNode,e.levelNode=this.levelNode,e.biasNode=this.biasNode,e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.offsetNode=this.offsetNode,e}}class Ns extends _n{static get type(){return"PassNode"}constructor(e,t,r,i={}){super("vec4"),this.scope=e,this.scene=t,this.camera=r,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const s=new $i;s.isRenderTargetTexture=!0,s.name="depth";const o=new Qo(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:rr,...i});o.texture.name="output",o.depthTexture=s,this.renderTarget=o,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:o.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Ge(0),this._cameraFar=Ge(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=it.FRAME,this.global=!0}setResolutionScale(e){return this._resolutionScale=e,this}getResolutionScale(){return this._resolutionScale}setResolution(e){return Be("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(e)}getResolution(){return Be("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const r=this._textures[e],i=this.renderTarget.textures.indexOf(r);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=r,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=new Lv(this,e),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=new Lv(this,e,!0),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=x2(this.getTextureNode(e),r,i)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const r=this._cameraNear,i=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=jl(s,r,i)}return t}async compileAsync(e){const t=e.getRenderTarget(),r=e.getMRT();e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),await e.compileAsync(this.scene,this.camera),e.setRenderTarget(t),e.setMRT(r)}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,this.renderTarget.texture.type=e.getOutputBufferType(),this.scope===Ns.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:r}=this;let i,s;const o=t.getOutputRenderTarget();o&&o.isXRRenderTarget===!0?(s=1,i=t.xr.getCamera(),t.xr.updateCamera(i),jc.set(o.width,o.height)):(i=this.camera,s=t.getPixelRatio(),t.getSize(jc)),this._pixelRatio=s,this.setSize(jc.width,jc.height);const a=t.getRenderTarget(),c=t.getMRT(),f=t.autoClear,p=t.transparent,g=t.opaque,v=i.layers.mask,b=t.contextNode,T=r.overrideMaterial;this._cameraNear.value=i.near,this._cameraFar.value=i.far,this._layers!==null&&(i.layers.mask=this._layers.mask);for(const N in this._previousTextures)this.toggleTexture(N);this.overrideMaterial!==null&&(r.overrideMaterial=this.overrideMaterial),t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.autoClear=!0,t.transparent=this.transparent,t.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:lo({...t.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),t.contextNode=this._contextNodeCache.context);const S=r.name;r.name=this.name?this.name:r.name,t.render(r,i),r.name=S,r.overrideMaterial=T,t.setRenderTarget(a),t.setMRT(c),t.autoClear=f,t.transparent=p,t.opaque=g,t.contextNode=b,i.layers.mask=v}setSize(e,t){this._width=e,this._height=t;const r=Math.floor(this._width*this._pixelRatio*this._resolutionScale),i=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(r,i),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(e,t,r,i){e===null?this._scissor=null:(this._scissor===null&&(this._scissor=new Vt),e.isVector4?this._scissor.copy(e):this._scissor.set(e,t,r,i),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(e,t,r,i){e===null?this._viewport=null:(this._viewport===null&&(this._viewport=new Vt),e.isVector4?this._viewport.copy(e):this._viewport.set(e,t,r,i),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Ns.COLOR="color";Ns.DEPTH="depth";const Pq=(n,e,t)=>new Ns(Ns.COLOR,n,e,t),Bq=(n,e)=>new $5(n,e),Dq=(n,e,t)=>new Ns(Ns.DEPTH,n,e,t);class Lq extends Ns{static get type(){return"ToonOutlinePassNode"}constructor(e,t,r,i,s){super(Ns.COLOR,e,t),this.colorNode=r,this.thicknessNode=i,this.alphaNode=s,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(e){const{renderer:t}=e,r=t.getRenderObjectFunction();t.setRenderObjectFunction((i,s,o,a,c,f,p,g)=>{if((c.isMeshToonMaterial||c.isMeshToonNodeMaterial)&&c.wireframe===!1){const v=this._getOutlineMaterial(c);t.renderObject(i,s,o,a,v,f,p,g)}t.renderObject(i,s,o,a,c,f,p,g)}),super.updateBefore(e),t.setRenderObjectFunction(r)}_createMaterial(){const e=new Tn;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=mr;const t=zr.negate(),r=Ks.mul(Xo),i=V(1),s=r.mul(ze(fn,1)),o=r.mul(ze(fn.add(t),1)),a=Mr(s.sub(o));return e.vertexNode=s.add(a.mul(this.thicknessNode).mul(s.w).mul(i)),e.colorNode=ze(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const Fq=(n,e,t=new Gn(0,0,0),r=.003,i=1)=>Me(new Lq(n,e,Me(t),Me(r),Me(i))),j5=ee(([n,e])=>n.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),H5=ee(([n,e])=>(n=n.mul(e),n.div(n.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),W5=ee(([n,e])=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),r=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Oq=ee(([n])=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),Q5=ee(([n,e])=>{const t=or(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=or(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=Oq(n),n=r.mul(n),n.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Iq=or(X(1.6605,-.1246,-.0182),X(-.5876,1.1329,-.1006),X(-.0728,-.0083,1.1187)),kq=or(X(.6274,.0691,.0164),X(.3293,.9195,.088),X(.0433,.0113,.8956)),Uq=ee(([n])=>{const e=X(n).toVar(),t=X(e.mul(e)).toVar(),r=X(t.mul(t)).toVar();return V(15.5).mul(r.mul(t)).sub(Ke(40.14,r.mul(e))).add(Ke(31.96,r).sub(Ke(6.868,t.mul(e))).add(Ke(.4298,t).add(Ke(.1191,e).sub(.00232))))}),Y5=ee(([n,e])=>{const t=X(n).toVar(),r=or(X(.856627153315983,.137318972929847,.11189821299995),X(.0951212405381588,.761241990602591,.0767994186031903),X(.0482516061458583,.101439036467562,.811302368396859)),i=or(X(1.1271005818144368,-.1413297634984383,-.14132976349843826),X(-.11060664309660323,1.157823702216272,-.11060664309660294),X(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=V(-12.47393),o=V(4.026069);return t.mulAssign(e),t.assign(kq.mul(t)),t.assign(r.mul(t)),t.assign(gn(t,1e-10)),t.assign(ys(t)),t.assign(t.sub(s).div(o.sub(s))),t.assign(Qi(t,0,1)),t.assign(Uq(t)),t.assign(i.mul(t)),t.assign(gi(gn(X(0),t),X(2.2))),t.assign(Iq.mul(t)),t.assign(Qi(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),X5=ee(([n,e])=>{const t=V(.76),r=V(.15);n=n.mul(e);const i=Vr(n.r,Vr(n.g,n.b)),s=sr(i.lessThan(.08),i.sub(Ke(6.25,i.mul(i))),.04);n.subAssign(s);const o=gn(n.r,gn(n.g,n.b));Ve(o.lessThan(t),()=>n);const a=Tt(1,t),c=Tt(1,a.mul(a).div(o.add(a.sub(t))));n.mulAssign(c.div(o));const f=Tt(1,si(1,r.mul(o.sub(c)).add(1)));return xt(n,X(c),f)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Yn extends Oe{static get type(){return"CodeNode"}constructor(e="",t=[],r=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=r}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const r=e.getCodeFromNode(this,this.getNodeType(e));return r.code=this.code,r.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const If=Ze(Yn).setParameterLength(1,3),qq=(n,e)=>If(n,e,"js"),Gq=(n,e)=>If(n,e,"wgsl"),Vq=(n,e)=>If(n,e,"glsl");class K5 extends Yn{static get type(){return"FunctionNode"}constructor(e="",t=[],r=""){super(e,t,r)}getNodeType(e){return this.getNodeFunction(e).type}getMemberType(e,t){const r=this.getNodeType(e);return e.getStructTypeNode(r).getMemberType(e,t)}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let r=t.nodeFunction;return r===void 0&&(r=e.parser.parseFunction(this.code),t.nodeFunction=r),r}generate(e,t){super.generate(e);const r=this.getNodeFunction(e),i=r.name,s=r.type,o=e.getCodeFromNode(this,s);i!==""&&(o.name=i);const a=e.getPropertyName(o),c=this.getNodeFunction(e).getCode(a);return o.code=c+`
`,t==="property"?a:e.format(`${a}()`,s,t)}}const Z5=(n,e=[],t="")=>{for(let s=0;s<e.length;s++){const o=e[s];typeof o=="function"&&(e[s]=o.functionNode)}const r=new K5(n,e,t),i=(...s)=>r.call(...s);return i.functionNode=r,i},zq=(n,e)=>Z5(n,e,"glsl"),$q=(n,e)=>Z5(n,e,"wgsl");class jq extends Oe{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new Zh,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:V()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=r8(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=i8(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const I0=Ze(jq).setParameterLength(1);class J5 extends Map{get(e,t=null,...r){if(this.has(e))return super.get(e);if(t!==null){const i=t(...r);return this.set(e,i),i}}}class Hq{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const k0=new J5;class Wq extends Oe{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new J5,this._output=I0(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const r=this._outputs;return r[e]===void 0?r[e]=I0(t):r[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const r=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),r[e]=t,r[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),r[e]=t,r[e].events.addEventListener("refresh",this.onRefresh)):r[e]===void 0?(r[e]=I0(t),r[e].events.addEventListener("refresh",this.onRefresh)):r[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i(...t)}async callAsync(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i.constructor.name==="AsyncFunction"?await i(...t):i(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(f,p)=>this.setOutput(f,p),r=new Hq(this),i=k0.get("THREE"),s=k0.get("TSL"),o=this.getMethod(),a=[r,this._local,k0,e,t,i,s];this._object=o(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const f of c.elements){const p=f.id||f.name;f.inputType&&(this.getParameter(p)===void 0&&this.setParameter(p,null),this.getParameter(p).inputType=f.inputType),f.outputType&&(this.getOutput(p)===void 0&&this.setOutput(p,null),this.getOutput(p).outputType=f.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let r=this.parameters[t];r.isScriptableNode&&(r=r.getDefaultOutput()),r.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:V()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],r=["layout","init","main","dispose"].join(", "),i="var "+r+`; var output = {};
`,s=`
return { ...output, `+r+" };",o=i+this.codeNode.code+s;return this._method=new Function(...e,o),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[YA(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const r in this.parameters)t.push(this.parameters[r].getCacheKey(e));return cu(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const Qq=Ze(Wq).setParameterLength(1,2);function ew(n){let e;const t=n.context.getViewZ;return t!==void 0&&(e=t(this)),(e||Nn.z).negate()}const O2=ee(([n,e],t)=>{const r=ew(t);return Yi(n,e,r)}),I2=ee(([n],e)=>{const t=ew(e);return n.mul(n,t,t).negate().exp().oneMinus()}),qA=ee(([n,e])=>ze(e.toFloat().mix(Vl.rgb,n.toVec3()),Vl.a));function Yq(n,e,t){return Be('TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),qA(n,O2(e,t))}function Xq(n,e){return Be('TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),qA(n,I2(e))}let ha=null,fa=null;class Kq extends Oe{static get type(){return"RangeNode"}constructor(e=V(),t=V()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=this.getConstNode(this.minNode),r=this.getConstNode(this.maxNode),i=e.getTypeLength(Fo(t.value)),s=e.getTypeLength(Fo(r.value));return i>s?i:s}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}getConstNode(e){let t=null;if(e.traverse(r=>{r.isConstNode===!0&&(t=r)}),t===null)throw new Error('THREE.TSL: No "ConstNode" found in node graph.');return t}setup(e){const t=e.object;let r=null;if(t.count>1){const i=this.getConstNode(this.minNode),s=this.getConstNode(this.maxNode),o=i.value,a=s.value,c=e.getTypeLength(Fo(o)),f=e.getTypeLength(Fo(a));ha=ha||new Vt,fa=fa||new Vt,ha.setScalar(0),fa.setScalar(0),c===1?ha.setScalar(o):o.isColor?ha.set(o.r,o.g,o.b,1):ha.set(o.x,o.y,o.z||0,o.w||0),f===1?fa.setScalar(a):a.isColor?fa.set(a.r,a.g,a.b,1):fa.set(a.x,a.y,a.z||0,a.w||0);const p=4,g=p*t.count,v=new Float32Array(g);for(let T=0;T<g;T++){const S=T%p,N=ha.getComponent(S),C=fa.getComponent(S);v[T]=Yl.lerp(N,C,Math.random())}const b=this.getNodeType(e);if(t.count<=4096)r=ZA(v,"vec4",t.count).element(Ts).convert(b);else{const T=new Ol(v,4);e.geometry.setAttribute("__range"+this.id,T),r=Ih(T).convert(b)}}else r=V(0);return r}}const Zq=Ze(Kq).setParameterLength(2);class Jq extends Oe{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const r=this.getBuiltinName(e),i=this.getNodeType(e);return e.shaderStage==="compute"?e.format(r,i,t):(Be(`ComputeBuiltinNode: Compute built-in value ${r} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(i))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const rc=(n,e)=>new Jq(n,e),eG=rc("numWorkgroups","uvec3"),tG=rc("workgroupId","uvec3"),nG=rc("globalId","uvec3"),rG=rc("localId","uvec3"),iG=rc("subgroupSize","uint");class sG extends Oe{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:r}=e;r.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const k2=Ze(sG),oG=()=>k2("workgroup").toStack(),aG=()=>k2("storage").toStack(),lG=()=>k2("texture").toStack();class uG extends Ha{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let r;const i=e.context.assign;if(r=super.generate(e),i!==!0){const s=this.getNodeType(e);r=e.format(r,s,t)}return r}}class AG extends Oe{constructor(e,t,r=0){super(t),this.bufferType=t,this.bufferCount=r,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e,this.name=""}setName(e){return this.name=e,this}label(e){return Be('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return new uG(this,e)}generate(e){const t=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return e.getScopedArray(t,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const cG=(n,e)=>new AG("Workgroup",n,e);class zn extends Oe{static get type(){return"AtomicFunctionNode"}constructor(e,t,r){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=r,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),r=t.parents,i=this.method,s=this.getNodeType(e),o=this.getInputType(e),a=this.pointerNode,c=this.valueNode,f=[];f.push(`&${a.build(e,o)}`),c!==null&&f.push(c.build(e,o));const p=`${e.getMethod(i,s)}( ${f.join(", ")} )`;if(r?r.length===1&&r[0].isStackNode===!0:!1)e.addLineFlowCode(p,this);else return t.constNode===void 0&&(t.constNode=so(p,s).toConst()),t.constNode.build(e)}}zn.ATOMIC_LOAD="atomicLoad";zn.ATOMIC_STORE="atomicStore";zn.ATOMIC_ADD="atomicAdd";zn.ATOMIC_SUB="atomicSub";zn.ATOMIC_MAX="atomicMax";zn.ATOMIC_MIN="atomicMin";zn.ATOMIC_AND="atomicAnd";zn.ATOMIC_OR="atomicOr";zn.ATOMIC_XOR="atomicXor";const hG=Ze(zn),Bs=(n,e,t)=>hG(n,e,t).toStack(),fG=n=>Bs(zn.ATOMIC_LOAD,n,null),dG=(n,e)=>Bs(zn.ATOMIC_STORE,n,e),pG=(n,e)=>Bs(zn.ATOMIC_ADD,n,e),mG=(n,e)=>Bs(zn.ATOMIC_SUB,n,e),gG=(n,e)=>Bs(zn.ATOMIC_MAX,n,e),_G=(n,e)=>Bs(zn.ATOMIC_MIN,n,e),yG=(n,e)=>Bs(zn.ATOMIC_AND,n,e),vG=(n,e)=>Bs(zn.ATOMIC_OR,n,e),xG=(n,e)=>Bs(zn.ATOMIC_XOR,n,e);class De extends _n{static get type(){return"SubgroupFunctionNode"}constructor(e,t=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=r}getInputType(e){const t=this.aNode?this.aNode.getNodeType(e):null,r=this.bNode?this.bNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(r)?0:e.getTypeLength(r);return i>s?t:r}getNodeType(e){const t=this.method;return t===De.SUBGROUP_ELECT?"bool":t===De.SUBGROUP_BALLOT?"uvec4":this.getInputType(e)}generate(e,t){const r=this.method,i=this.getNodeType(e),s=this.getInputType(e),o=this.aNode,a=this.bNode,c=[];if(r===De.SUBGROUP_BROADCAST||r===De.SUBGROUP_SHUFFLE||r===De.QUAD_BROADCAST){const p=a.getNodeType(e);c.push(o.build(e,i),a.build(e,p==="float"?"int":i))}else r===De.SUBGROUP_SHUFFLE_XOR||r===De.SUBGROUP_SHUFFLE_DOWN||r===De.SUBGROUP_SHUFFLE_UP?c.push(o.build(e,i),a.build(e,"uint")):(o!==null&&c.push(o.build(e,s)),a!==null&&c.push(a.build(e,s)));const f=c.length===0?"()":`( ${c.join(", ")} )`;return e.format(`${e.getMethod(r,i)}${f}`,i,t)}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}De.SUBGROUP_ELECT="subgroupElect";De.SUBGROUP_BALLOT="subgroupBallot";De.SUBGROUP_ADD="subgroupAdd";De.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";De.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";De.SUBGROUP_MUL="subgroupMul";De.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";De.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";De.SUBGROUP_AND="subgroupAnd";De.SUBGROUP_OR="subgroupOr";De.SUBGROUP_XOR="subgroupXor";De.SUBGROUP_MIN="subgroupMin";De.SUBGROUP_MAX="subgroupMax";De.SUBGROUP_ALL="subgroupAll";De.SUBGROUP_ANY="subgroupAny";De.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";De.QUAD_SWAP_X="quadSwapX";De.QUAD_SWAP_Y="quadSwapY";De.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";De.SUBGROUP_BROADCAST="subgroupBroadcast";De.SUBGROUP_SHUFFLE="subgroupShuffle";De.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";De.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";De.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";De.QUAD_BROADCAST="quadBroadcast";const bG=Te(De,De.SUBGROUP_ELECT).setParameterLength(0),TG=Te(De,De.SUBGROUP_BALLOT).setParameterLength(1),wG=Te(De,De.SUBGROUP_ADD).setParameterLength(1),SG=Te(De,De.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),EG=Te(De,De.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),NG=Te(De,De.SUBGROUP_MUL).setParameterLength(1),RG=Te(De,De.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),CG=Te(De,De.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),MG=Te(De,De.SUBGROUP_AND).setParameterLength(1),PG=Te(De,De.SUBGROUP_OR).setParameterLength(1),BG=Te(De,De.SUBGROUP_XOR).setParameterLength(1),DG=Te(De,De.SUBGROUP_MIN).setParameterLength(1),LG=Te(De,De.SUBGROUP_MAX).setParameterLength(1),FG=Te(De,De.SUBGROUP_ALL).setParameterLength(0),OG=Te(De,De.SUBGROUP_ANY).setParameterLength(0),IG=Te(De,De.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),kG=Te(De,De.QUAD_SWAP_X).setParameterLength(1),UG=Te(De,De.QUAD_SWAP_Y).setParameterLength(1),qG=Te(De,De.QUAD_SWAP_DIAGONAL).setParameterLength(1),GG=Te(De,De.SUBGROUP_BROADCAST).setParameterLength(2),VG=Te(De,De.SUBGROUP_SHUFFLE).setParameterLength(2),zG=Te(De,De.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),$G=Te(De,De.SUBGROUP_SHUFFLE_UP).setParameterLength(2),jG=Te(De,De.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),HG=Te(De,De.QUAD_BROADCAST).setParameterLength(1);let Hc;function kf(n){Hc=Hc||new WeakMap;let e=Hc.get(n);return e===void 0&&Hc.set(n,e={}),e}function Uf(n){const e=kf(n);return e.shadowMatrix||(e.shadowMatrix=Ge("mat4").setGroup(qe).onRenderUpdate(t=>((n.castShadow!==!0||t.renderer.shadowMap.enabled===!1)&&(n.shadow.camera.coordinateSystem!==t.camera.coordinateSystem&&(n.shadow.camera.coordinateSystem=t.camera.coordinateSystem,n.shadow.camera.updateProjectionMatrix()),n.shadow.updateMatrices(n)),n.shadow.matrix)))}function tw(n,e=bs){const t=Uf(n).mul(e);return t.xyz.div(t.w)}function U2(n){const e=kf(n);return e.position||(e.position=Ge(new we).setGroup(qe).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.matrixWorld)))}function nw(n){const e=kf(n);return e.targetPosition||(e.targetPosition=Ge(new we).setGroup(qe).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(n.target.matrixWorld)))}function q2(n){const e=kf(n);return e.viewPosition||(e.viewPosition=Ge(new we).setGroup(qe).onRenderUpdate(({camera:t},r)=>{r.value=r.value||new we,r.value.setFromMatrixPosition(n.matrixWorld),r.value.applyMatrix4(t.matrixWorldInverse)}))}const G2=n=>Mi.transformDirection(U2(n).sub(nw(n))),WG=n=>n.sort((e,t)=>e.id-t.id),QG=(n,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===n)return t;return null},Ap=new WeakMap,Uu=[];class V2 extends Oe{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Qs("vec3","totalDiffuse"),this.totalSpecularNode=Qs("vec3","totalSpecular"),this.outgoingLightNode=Qs("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let r=0;r<e.length;r++){const i=e[r];if(Uu.push(i.id),Uu.push(i.castShadow?1:0),i.isSpotLight===!0){const s=i.map!==null?i.map.id:-1,o=i.colorNode?i.colorNode.getCacheKey():-1;Uu.push(s,o)}}const t=cu(Uu);return Uu.length=0,t}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const r of this._lightNodes)t.push(r.getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const r of t.nodes)r.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],r=this._lightNodes,i=WG(this._lights),s=e.renderer.library;for(const o of i)if(o.isNode)t.push(Me(o));else{let a=null;if(r!==null&&(a=QG(o.id,r)),a===null){const c=s.getLightNodeClass(o.constructor);if(c===null){Be(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let f=null;Ap.has(o)?f=Ap.get(o):(f=new c(o),Ap.set(o,f)),t.push(f)}}this._lightNodes=t}setupDirectLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.direct({...r,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,r){const{lightingModel:i,reflectedLight:s}=e.context;i.directRectArea({...r,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const r of t)r.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let r=this.outgoingLightNode;const i=e.context,s=i.lightingModel,o=e.getNodeProperties(this);if(s){const{totalDiffuseNode:a,totalSpecularNode:c}=this;i.outgoingLight=r;const f=e.addStack();o.nodes=f.nodes,s.start(e);const{backdrop:p,backdropAlpha:g}=i,{directDiffuse:v,directSpecular:b,indirectDiffuse:T,indirectSpecular:S}=i.reflectedLight;let N=v.add(T);p!==null&&(g!==null?N=X(g.mix(N,p)):N=X(p)),a.assign(N),c.assign(b.add(S)),r.assign(a.add(c)),s.finish(e),r=r.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const YG=(n=[])=>new V2().setLights(n);class XG extends Oe{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=it.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){z2.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||bs)}}const z2=Qs("vec3","shadowPositionWorld");function KG(n,e={}){return e.toneMapping=n.toneMapping,e.toneMappingExposure=n.toneMappingExposure,e.outputColorSpace=n.outputColorSpace,e.renderTarget=n.getRenderTarget(),e.activeCubeFace=n.getActiveCubeFace(),e.activeMipmapLevel=n.getActiveMipmapLevel(),e.renderObjectFunction=n.getRenderObjectFunction(),e.pixelRatio=n.getPixelRatio(),e.mrt=n.getMRT(),e.clearColor=n.getClearColor(e.clearColor||new Gn),e.clearAlpha=n.getClearAlpha(),e.autoClear=n.autoClear,e.scissorTest=n.getScissorTest(),e}function ZG(n,e){return e=KG(n,e),n.setMRT(null),n.setRenderObjectFunction(null),n.setClearColor(0,1),n.autoClear=!0,e}function JG(n,e){n.toneMapping=e.toneMapping,n.toneMappingExposure=e.toneMappingExposure,n.outputColorSpace=e.outputColorSpace,n.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),n.setRenderObjectFunction(e.renderObjectFunction),n.setPixelRatio(e.pixelRatio),n.setMRT(e.mrt),n.setClearColor(e.clearColor,e.clearAlpha),n.autoClear=e.autoClear,n.setScissorTest(e.scissorTest)}function eV(n,e={}){return e.background=n.background,e.backgroundNode=n.backgroundNode,e.overrideMaterial=n.overrideMaterial,e}function tV(n,e){return e=eV(n,e),n.background=null,n.backgroundNode=null,n.overrideMaterial=null,e}function nV(n,e){n.background=e.background,n.backgroundNode=e.backgroundNode,n.overrideMaterial=e.overrideMaterial}function rV(n,e,t){return t=ZG(n,t),t=tV(e,t),t}function iV(n,e,t){JG(n,t),nV(e,t)}const Vh=new WeakMap,rw=ee(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let r=Rt(n,e.xy).setName("t_basic");return n.isArrayTexture&&(r=r.depth(t)),r.compare(e.z)}),iw=ee(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(p,g)=>{let v=Rt(n,p);return n.isArrayTexture&&(v=v.depth(r)),v.compare(g)},s=qt("mapSize","vec2",t).setGroup(qe),o=qt("radius","float",t).setGroup(qe),a=xe(1).div(s),c=o.mul(a.x),f=L2(Qa.xy).mul(6.28318530718);return Mn(i(e.xy.add(qi(0,5,f).mul(c)),e.z),i(e.xy.add(qi(1,5,f).mul(c)),e.z),i(e.xy.add(qi(2,5,f).mul(c)),e.z),i(e.xy.add(qi(3,5,f).mul(c)),e.z),i(e.xy.add(qi(4,5,f).mul(c)),e.z)).mul(1/5)}),sw=ee(({depthTexture:n,shadowCoord:e,shadow:t,depthLayer:r})=>{const i=(g,v)=>{let b=Rt(n,g);return n.isArrayTexture&&(b=b.depth(r)),b.compare(v)},s=qt("mapSize","vec2",t).setGroup(qe),o=xe(1).div(s),a=o.x,c=o.y,f=e.xy,p=Wi(f.mul(s).add(.5));return f.subAssign(p.mul(o)),Mn(i(f,e.z),i(f.add(xe(a,0)),e.z),i(f.add(xe(0,c)),e.z),i(f.add(o),e.z),xt(i(f.add(xe(a.negate(),0)),e.z),i(f.add(xe(a.mul(2),0)),e.z),p.x),xt(i(f.add(xe(a.negate(),c)),e.z),i(f.add(xe(a.mul(2),c)),e.z),p.x),xt(i(f.add(xe(0,c.negate())),e.z),i(f.add(xe(0,c.mul(2))),e.z),p.y),xt(i(f.add(xe(a,c.negate())),e.z),i(f.add(xe(a,c.mul(2))),e.z),p.y),xt(xt(i(f.add(xe(a.negate(),c.negate())),e.z),i(f.add(xe(a.mul(2),c.negate())),e.z),p.x),xt(i(f.add(xe(a.negate(),c.mul(2))),e.z),i(f.add(xe(a.mul(2),c.mul(2))),e.z),p.x),p.y)).mul(1/9)}),ow=ee(({depthTexture:n,shadowCoord:e,depthLayer:t})=>{let r=Rt(n).sample(e.xy);n.isArrayTexture&&(r=r.depth(t)),r=r.rg;const i=r.x,s=gn(1e-7,r.y.mul(r.y)),o=vf(e.z,i);Ve(o.equal(1),()=>V(1));const a=e.z.sub(i);let c=s.div(s.add(a.mul(a)));return c=Qi(Tt(c,.3).div(.65)),gn(o,c)}),sV=ee(([n,e,t])=>{let r=bs.sub(n).length();return r=r.sub(e).div(t.sub(e)),r=r.saturate(),r}),oV=n=>{const e=n.shadow.camera,t=qt("near","float",e).setGroup(qe),r=qt("far","float",e).setGroup(qe),i=VT(n);return sV(i,t,r)},aw=n=>{let e=Vh.get(n);if(e===void 0){const t=n.isPointLight?oV(n):null;e=new Tn,e.colorNode=ze(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,Vh.set(n,e)}return e},lw=n=>{const e=Vh.get(n);e!==void 0&&(e.dispose(),Vh.delete(n))},Fv=new Xi,yl=[],uw=(n,e,t,r)=>{yl[0]=n,yl[1]=e;let i=Fv.get(yl);return(i===void 0||i.shadowType!==t||i.useVelocity!==r)&&(i=(s,o,a,c,f,p,...g)=>{(s.castShadow===!0||s.receiveShadow&&t===v0)&&(r&&(n8(s).useVelocity=!0),s.onBeforeShadow(n,s,a,e.camera,c,o.overrideMaterial,p),n.renderObject(s,o,a,c,f,p,...g),s.onAfterShadow(n,s,a,e.camera,c,o.overrideMaterial,p))},i.shadowType=t,i.useVelocity=r,Fv.set(yl,i)),yl[0]=null,yl[1]=null,i},aV=ee(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=V(0).toVar("meanVertical"),o=V(0).toVar("squareMeanVertical"),a=n.lessThanEqual(V(1)).select(V(0),V(2).div(n.sub(1))),c=n.lessThanEqual(V(1)).select(V(0),V(-1));It({start:Q(0),end:Q(n),type:"int",condition:"<"},({i:p})=>{const g=c.add(V(p).mul(a));let v=r.sample(Mn(Qa.xy,xe(0,g).mul(e)).div(t));r.value.isArrayTexture&&(v=v.depth(i)),v=v.x,s.addAssign(v),o.addAssign(v.mul(v))}),s.divAssign(n),o.divAssign(n);const f=pr(o.sub(s.mul(s)).max(0));return xe(s,f)}),lV=ee(({samples:n,radius:e,size:t,shadowPass:r,depthLayer:i})=>{const s=V(0).toVar("meanHorizontal"),o=V(0).toVar("squareMeanHorizontal"),a=n.lessThanEqual(V(1)).select(V(0),V(2).div(n.sub(1))),c=n.lessThanEqual(V(1)).select(V(0),V(-1));It({start:Q(0),end:Q(n),type:"int",condition:"<"},({i:p})=>{const g=c.add(V(p).mul(a));let v=r.sample(Mn(Qa.xy,xe(g,0).mul(e)).div(t));r.value.isArrayTexture&&(v=v.depth(i)),s.addAssign(v.x),o.addAssign(Mn(v.y.mul(v.y),v.x.mul(v.x)))}),s.divAssign(n),o.divAssign(n);const f=pr(o.sub(s.mul(s)).max(0));return xe(s,f)}),uV=[rw,iw,sw,ow];let cp;const Wc=new Lf;class Aw extends XG{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:i,shadow:s,depthLayer:o}){const a=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),c=t({depthTexture:r,shadowCoord:i,shadow:s,depthLayer:o});return a.select(c,V(1))}setupShadowCoord(e,t){const{shadow:r}=this,{renderer:i}=e,s=qt("bias","float",r).setGroup(qe);let o=t,a;if(r.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,i.coordinateSystem===Vo&&(a=a.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const f=qt("near","float",r.camera).setGroup(qe),p=qt("far","float",r.camera).setGroup(qe);a=b2(c.negate(),f,p)}return o=X(o.x,o.y.oneMinus(),a.add(s)),o}getShadowFilterFn(e){return uV[e]}setupRenderTarget(e,t){const r=new $i(e.mapSize.width,e.mapSize.height);r.name="ShadowDepthTexture",r.compareFunction=nf;const i=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return i.texture.name="ShadowMap",i.texture.type=e.mapType,i.depthTexture=r,{shadowMap:i,depthTexture:r}}setupShadow(e){const{renderer:t,camera:r}=e,{light:i,shadow:s}=this,o=t.shadowMap.type,{depthTexture:a,shadowMap:c}=this.setupRenderTarget(s,e);if(s.camera.coordinateSystem=r.coordinateSystem,s.camera.updateProjectionMatrix(),o===v0&&s.isPointLightShadow!==!0){a.compareFunction=null,c.depth>1?(c._vsmShadowMapVertical||(c._vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:zs,type:rr,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=c._vsmShadowMapVertical,c._vsmShadowMapHorizontal||(c._vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:zs,type:rr,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=c._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:zs,type:rr,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(s.mapSize.width,s.mapSize.height,{format:zs,type:rr,depthBuffer:!1}));let B=Rt(a);a.isArrayTexture&&(B=B.depth(this.depthLayer));let F=Rt(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(F=F.depth(this.depthLayer));const q=qt("blurSamples","float",s).setGroup(qe),I=qt("radius","float",s).setGroup(qe),U=qt("mapSize","vec2",s).setGroup(qe);let G=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Tn);G.fragmentNode=aV({samples:q,radius:I,size:U,shadowPass:B,depthLayer:this.depthLayer}).context(e.getSharedContext()),G.name="VSMVertical",G=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Tn),G.fragmentNode=lV({samples:q,radius:I,size:U,shadowPass:F,depthLayer:this.depthLayer}).context(e.getSharedContext()),G.name="VSMHorizontal"}const f=qt("intensity","float",s).setGroup(qe),p=qt("normalBias","float",s).setGroup(qe),g=Uf(i).mul(z2.add(Ko.mul(p))),v=this.setupShadowCoord(e,g),b=s.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(b===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const T=o===v0&&s.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,S=this.setupShadowFilter(e,{filterFn:b,shadowTexture:c.texture,depthTexture:T,shadowCoord:v,shadow:s,depthLayer:this.depthLayer});let N;c.texture.isCubeTexture?N=Cr(c.texture,v.xyz):(N=Rt(c.texture,v),a.isArrayTexture&&(N=N.depth(this.depthLayer)));const C=xt(1,S.rgb.mix(N,1),f.mul(N.a)).toVar();this.shadowMap=c,this.shadow.map=c;const P=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return C.toInspector(`${P} / Color`,()=>this.shadowMap.texture.isCubeTexture?Cr(this.shadowMap.texture):Rt(this.shadowMap.texture)).toInspector(`${P} / Depth`,()=>this.shadowMap.texture.isCubeTexture?Cr(this.shadowMap.texture).r.oneMinus():vn(this.shadowMap.depthTexture,zt().mul(Ys(Rt(this.shadowMap.depthTexture)))).r.oneMinus())}setup(e){if(e.renderer.shadowMap.enabled!==!1)return ee(()=>{const t=e.renderer.shadowMap.type;this._currentShadowType!==t&&(this._reset(),this._node=null);let r=this._node;return this.setupShadowPosition(e),r===null&&(this._node=r=this.setupShadow(e),this._currentShadowType=t),e.material.shadowNode&&Be('NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(r=e.material.receivedShadowNode(r)),r})()}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:o}=e;t.updateMatrices(i),r.setSize(t.mapSize.width,t.mapSize.height,r.depth);const a=o.name;o.name=`Shadow Map [ ${i.name||"ID: "+i.id} ]`,s.render(o,t.camera),o.name=a}updateShadow(e){const{shadowMap:t,light:r,shadow:i}=this,{renderer:s,scene:o,camera:a}=e,c=s.shadowMap.type,f=t.depthTexture.version;this._depthVersionCached=f;const p=i.camera.layers.mask;(i.camera.layers.mask&4294967294)===0&&(i.camera.layers.mask=a.layers.mask);const g=s.getRenderObjectFunction(),v=s.getMRT(),b=v?v.has("velocity"):!1;cp=rV(s,o,cp),o.overrideMaterial=aw(r),s.setRenderObjectFunction(uw(s,i,c,b)),s.setClearColor(0,0),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(g),c===v0&&i.isPointLightShadow!==!0&&this.vsmPass(s),i.camera.layers.mask=p,iV(s,o,cp)}vsmPass(e){const{shadow:t}=this,r=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,r),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,r),e.setRenderTarget(this.vsmShadowMapVertical),Wc.material=this.vsmMaterialVertical,Wc.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),Wc.material=this.vsmMaterialHorizontal,Wc.render(e)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,lw(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(e){const{shadow:t}=this;let r=t.needsUpdate||t.autoUpdate;r&&(this._cameraFrameId[e.camera]===e.frameId&&(r=!1),this._cameraFrameId[e.camera]=e.frameId),r&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const cw=(n,e)=>new Aw(n,e),AV=new Gn,Ov=new hn,qu=new we,hp=new we,cV=[new we(1,0,0),new we(-1,0,0),new we(0,-1,0),new we(0,1,0),new we(0,0,1),new we(0,0,-1)],hV=[new we(0,-1,0),new we(0,-1,0),new we(0,0,-1),new we(0,0,1),new we(0,-1,0),new we(0,-1,0)],fV=[new we(1,0,0),new we(-1,0,0),new we(0,1,0),new we(0,-1,0),new we(0,0,1),new we(0,0,-1)],dV=[new we(0,-1,0),new we(0,-1,0),new we(0,0,1),new we(0,0,-1),new we(0,-1,0),new we(0,-1,0)],hw=ee(({depthTexture:n,bd3D:e,dp:t})=>Cr(n,e).compare(t)),fw=ee(({depthTexture:n,bd3D:e,dp:t,shadow:r})=>{const i=qt("radius","float",r).setGroup(qe),s=qt("mapSize","vec2",r).setGroup(qe),o=i.div(s.x),a=Xt(e),c=Mr(io(e,a.x.greaterThan(a.z).select(X(0,1,0),X(1,0,0)))),f=io(e,c),p=L2(Qa.xy).mul(6.28318530718),g=qi(0,5,p),v=qi(1,5,p),b=qi(2,5,p),T=qi(3,5,p),S=qi(4,5,p);return Cr(n,e.add(c.mul(g.x).add(f.mul(g.y)).mul(o))).compare(t).add(Cr(n,e.add(c.mul(v.x).add(f.mul(v.y)).mul(o))).compare(t)).add(Cr(n,e.add(c.mul(b.x).add(f.mul(b.y)).mul(o))).compare(t)).add(Cr(n,e.add(c.mul(T.x).add(f.mul(T.y)).mul(o))).compare(t)).add(Cr(n,e.add(c.mul(S.x).add(f.mul(S.y)).mul(o))).compare(t)).mul(1/5)}),pV=ee(({filterFn:n,depthTexture:e,shadowCoord:t,shadow:r})=>{const i=t.xyz.toVar(),s=i.length(),o=Ge("float").setGroup(qe).onRenderUpdate(()=>r.camera.near),a=Ge("float").setGroup(qe).onRenderUpdate(()=>r.camera.far),c=qt("bias","float",r).setGroup(qe),f=V(1).toVar();return Ve(s.sub(a).lessThanEqual(0).and(s.sub(o).greaterThanEqual(0)),()=>{const p=s.sub(o).div(a.sub(o)).toVar();p.addAssign(c);const g=i.normalize();f.assign(n({depthTexture:e,bd3D:g,dp:p,shadow:r}))}),f});class mV extends Aw{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===lR?hw:fw}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:i,shadow:s}){return pV({filterFn:t,depthTexture:r,shadowCoord:i,shadow:s})}setupRenderTarget(e,t){const r=new uR(e.mapSize.width);r.name="PointShadowDepthTexture",r.compareFunction=nf;const i=t.createCubeRenderTarget(e.mapSize.width);return i.texture.name="PointShadowMap",i.depthTexture=r,{shadowMap:i,depthTexture:r}}renderShadow(e){const{shadow:t,shadowMap:r,light:i}=this,{renderer:s,scene:o}=e,a=t.camera,c=t.matrix,f=s.coordinateSystem===Vo,p=f?cV:fV,g=f?hV:dV;r.setSize(t.mapSize.width,t.mapSize.width);const v=s.autoClear,b=s.getClearColor(AV),T=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha);for(let S=0;S<6;S++){s.setRenderTarget(r,S),s.clear();const N=i.distance||a.far;N!==a.far&&(a.far=N,a.updateProjectionMatrix()),qu.setFromMatrixPosition(i.matrixWorld),a.position.copy(qu),hp.copy(a.position),hp.add(p[S]),a.up.copy(g[S]),a.lookAt(hp),a.updateMatrixWorld(),c.makeTranslation(-qu.x,-qu.y,-qu.z),Ov.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),t._frustum.setFromProjectionMatrix(Ov,a.coordinateSystem,a.reversedDepth);const C=o.name;o.name=`Point Light Shadow [ ${i.name||"ID: "+i.id} ] - Face ${S+1}`,s.render(o,a),o.name=C}s.autoClear=v,s.setClearColor(b,T)}}const dw=(n,e)=>new mV(n,e);class Ya extends fu{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new Gn,this.colorNode=e&&e.colorNode||Ge(this.color).setGroup(qe),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=it.FRAME,e&&e.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},e.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(e){return q2(this.light).sub(e.context.positionView||Nn)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return cw(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let r=this.shadowColorNode;if(r===null){const i=this.light.shadow.shadowNode;let s;i!==void 0?s=Me(i):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=r=this.colorNode.mul(s),this.baseColorNode=this.colorNode}e.context.getShadow&&(r=e.context.getShadow(this,e)),this.colorNode=r}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),r=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),r&&e.lightsNode.setupDirectRectAreaLight(e,this,r)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const $2=ee(({lightDistance:n,cutoffDistance:e,decayExponent:t})=>{const r=n.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(r.mul(n.div(e).pow4().oneMinus().clamp().pow2()),r)}),pw=({color:n,lightVector:e,cutoffDistance:t,decayExponent:r})=>{const i=e.normalize(),s=e.length(),o=$2({lightDistance:s,cutoffDistance:t,decayExponent:r}),a=n.mul(o);return{lightDirection:i,lightColor:a}};class gV extends Ya{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Ge(0).setGroup(qe),this.decayExponentNode=Ge(2).setGroup(qe)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return dw(this.light)}setupDirect(e){return pw({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const _V=ee(([n=zt()])=>{const e=n.mul(2),t=e.x.floor(),r=e.y.floor();return t.add(r).mod(2).sign()}),yV=ee(([n=zt()],{renderer:e,material:t})=>{const r=K1(n.mul(2).sub(1));let i;if(t.alphaToCoverage&&e.currentSamples>0){const s=V(r.fwidth()).toVar();i=Yi(s.oneMinus(),s.add(1),r).oneMinus()}else i=sr(r.greaterThan(1),0,1);return i}),gA=ee(([n,e,t])=>{const r=V(t).toVar(),i=V(e).toVar(),s=wi(n).toVar();return sr(s,i,r)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),zh=ee(([n,e])=>{const t=wi(e).toVar(),r=V(n).toVar();return sr(t,r.negate(),r)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Cn=ee(([n])=>{const e=V(n).toVar();return Q(vs(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),an=ee(([n,e])=>{const t=V(n).toVar();return e.assign(Cn(t)),t.sub(V(e))}),vV=ee(([n,e,t,r,i,s])=>{const o=V(s).toVar(),a=V(i).toVar(),c=V(r).toVar(),f=V(t).toVar(),p=V(e).toVar(),g=V(n).toVar(),v=V(Tt(1,a)).toVar();return Tt(1,o).mul(g.mul(v).add(p.mul(a))).add(o.mul(f.mul(v).add(c.mul(a))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),xV=ee(([n,e,t,r,i,s])=>{const o=V(s).toVar(),a=V(i).toVar(),c=X(r).toVar(),f=X(t).toVar(),p=X(e).toVar(),g=X(n).toVar(),v=V(Tt(1,a)).toVar();return Tt(1,o).mul(g.mul(v).add(p.mul(a))).add(o.mul(f.mul(v).add(c.mul(a))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),mw=lr([vV,xV]),bV=ee(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=V(p).toVar(),v=V(f).toVar(),b=V(c).toVar(),T=V(a).toVar(),S=V(o).toVar(),N=V(s).toVar(),C=V(i).toVar(),P=V(r).toVar(),B=V(t).toVar(),F=V(e).toVar(),q=V(n).toVar(),I=V(Tt(1,b)).toVar(),U=V(Tt(1,v)).toVar();return V(Tt(1,g)).toVar().mul(U.mul(q.mul(I).add(F.mul(b))).add(v.mul(B.mul(I).add(P.mul(b))))).add(g.mul(U.mul(C.mul(I).add(N.mul(b))).add(v.mul(S.mul(I).add(T.mul(b))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),TV=ee(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=V(p).toVar(),v=V(f).toVar(),b=V(c).toVar(),T=X(a).toVar(),S=X(o).toVar(),N=X(s).toVar(),C=X(i).toVar(),P=X(r).toVar(),B=X(t).toVar(),F=X(e).toVar(),q=X(n).toVar(),I=V(Tt(1,b)).toVar(),U=V(Tt(1,v)).toVar();return V(Tt(1,g)).toVar().mul(U.mul(q.mul(I).add(F.mul(b))).add(v.mul(B.mul(I).add(P.mul(b))))).add(g.mul(U.mul(C.mul(I).add(N.mul(b))).add(v.mul(S.mul(I).add(T.mul(b))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),gw=lr([bV,TV]),wV=ee(([n,e,t])=>{const r=V(t).toVar(),i=V(e).toVar(),s=me(n).toVar(),o=me(s.bitAnd(me(7))).toVar(),a=V(gA(o.lessThan(me(4)),i,r)).toVar(),c=V(Ke(2,gA(o.lessThan(me(4)),r,i))).toVar();return zh(a,wi(o.bitAnd(me(1)))).add(zh(c,wi(o.bitAnd(me(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),SV=ee(([n,e,t,r])=>{const i=V(r).toVar(),s=V(t).toVar(),o=V(e).toVar(),a=me(n).toVar(),c=me(a.bitAnd(me(15))).toVar(),f=V(gA(c.lessThan(me(8)),o,s)).toVar(),p=V(gA(c.lessThan(me(4)),s,gA(c.equal(me(12)).or(c.equal(me(14))),o,i))).toVar();return zh(f,wi(c.bitAnd(me(1)))).add(zh(p,wi(c.bitAnd(me(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Xn=lr([wV,SV]),EV=ee(([n,e,t])=>{const r=V(t).toVar(),i=V(e).toVar(),s=Wa(n).toVar();return X(Xn(s.x,i,r),Xn(s.y,i,r),Xn(s.z,i,r))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),NV=ee(([n,e,t,r])=>{const i=V(r).toVar(),s=V(t).toVar(),o=V(e).toVar(),a=Wa(n).toVar();return X(Xn(a.x,o,s,i),Xn(a.y,o,s,i),Xn(a.z,o,s,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),di=lr([EV,NV]),RV=ee(([n])=>{const e=V(n).toVar();return Ke(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),CV=ee(([n])=>{const e=V(n).toVar();return Ke(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),MV=ee(([n])=>{const e=X(n).toVar();return Ke(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),_w=lr([RV,MV]),PV=ee(([n])=>{const e=X(n).toVar();return Ke(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),yw=lr([CV,PV]),ei=ee(([n,e])=>{const t=Q(e).toVar(),r=me(n).toVar();return r.shiftLeft(t).bitOr(r.shiftRight(Q(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),vw=ee(([n,e,t])=>{n.subAssign(t),n.bitXorAssign(ei(t,Q(4))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(ei(n,Q(6))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ei(e,Q(8))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(ei(t,Q(16))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(ei(n,Q(19))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(ei(e,Q(4))),e.addAssign(n)}),ic=ee(([n,e,t])=>{const r=me(t).toVar(),i=me(e).toVar(),s=me(n).toVar();return r.bitXorAssign(i),r.subAssign(ei(i,Q(14))),s.bitXorAssign(r),s.subAssign(ei(r,Q(11))),i.bitXorAssign(s),i.subAssign(ei(s,Q(25))),r.bitXorAssign(i),r.subAssign(ei(i,Q(16))),s.bitXorAssign(r),s.subAssign(ei(r,Q(4))),i.bitXorAssign(s),i.subAssign(ei(s,Q(14))),r.bitXorAssign(i),r.subAssign(ei(i,Q(24))),r}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),gr=ee(([n])=>{const e=me(n).toVar();return V(e).div(V(me(Q(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),ws=ee(([n])=>{const e=V(n).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),BV=ee(([n])=>{const e=Q(n).toVar(),t=me(me(1)).toVar(),r=me(me(Q(3735928559)).add(t.shiftLeft(me(2))).add(me(13))).toVar();return ic(r.add(me(e)),r,r)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),DV=ee(([n,e])=>{const t=Q(e).toVar(),r=Q(n).toVar(),i=me(me(2)).toVar(),s=me().toVar(),o=me().toVar(),a=me().toVar();return s.assign(o.assign(a.assign(me(Q(3735928559)).add(i.shiftLeft(me(2))).add(me(13))))),s.addAssign(me(r)),o.addAssign(me(t)),ic(s,o,a)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),LV=ee(([n,e,t])=>{const r=Q(t).toVar(),i=Q(e).toVar(),s=Q(n).toVar(),o=me(me(3)).toVar(),a=me().toVar(),c=me().toVar(),f=me().toVar();return a.assign(c.assign(f.assign(me(Q(3735928559)).add(o.shiftLeft(me(2))).add(me(13))))),a.addAssign(me(s)),c.addAssign(me(i)),f.addAssign(me(r)),ic(a,c,f)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),FV=ee(([n,e,t,r])=>{const i=Q(r).toVar(),s=Q(t).toVar(),o=Q(e).toVar(),a=Q(n).toVar(),c=me(me(4)).toVar(),f=me().toVar(),p=me().toVar(),g=me().toVar();return f.assign(p.assign(g.assign(me(Q(3735928559)).add(c.shiftLeft(me(2))).add(me(13))))),f.addAssign(me(a)),p.addAssign(me(o)),g.addAssign(me(s)),vw(f,p,g),f.addAssign(me(i)),ic(f,p,g)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),OV=ee(([n,e,t,r,i])=>{const s=Q(i).toVar(),o=Q(r).toVar(),a=Q(t).toVar(),c=Q(e).toVar(),f=Q(n).toVar(),p=me(me(5)).toVar(),g=me().toVar(),v=me().toVar(),b=me().toVar();return g.assign(v.assign(b.assign(me(Q(3735928559)).add(p.shiftLeft(me(2))).add(me(13))))),g.addAssign(me(f)),v.addAssign(me(c)),b.addAssign(me(a)),vw(g,v,b),g.addAssign(me(o)),v.addAssign(me(s)),ic(g,v,b)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),Gt=lr([BV,DV,LV,FV,OV]),IV=ee(([n,e])=>{const t=Q(e).toVar(),r=Q(n).toVar(),i=me(Gt(r,t)).toVar(),s=Wa().toVar();return s.x.assign(i.bitAnd(Q(255))),s.y.assign(i.shiftRight(Q(8)).bitAnd(Q(255))),s.z.assign(i.shiftRight(Q(16)).bitAnd(Q(255))),s}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),kV=ee(([n,e,t])=>{const r=Q(t).toVar(),i=Q(e).toVar(),s=Q(n).toVar(),o=me(Gt(s,i,r)).toVar(),a=Wa().toVar();return a.x.assign(o.bitAnd(Q(255))),a.y.assign(o.shiftRight(Q(8)).bitAnd(Q(255))),a.z.assign(o.shiftRight(Q(16)).bitAnd(Q(255))),a}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),pi=lr([IV,kV]),UV=ee(([n])=>{const e=xe(n).toVar(),t=Q().toVar(),r=Q().toVar(),i=V(an(e.x,t)).toVar(),s=V(an(e.y,r)).toVar(),o=V(ws(i)).toVar(),a=V(ws(s)).toVar(),c=V(mw(Xn(Gt(t,r),i,s),Xn(Gt(t.add(Q(1)),r),i.sub(1),s),Xn(Gt(t,r.add(Q(1))),i,s.sub(1)),Xn(Gt(t.add(Q(1)),r.add(Q(1))),i.sub(1),s.sub(1)),o,a)).toVar();return _w(c)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),qV=ee(([n])=>{const e=X(n).toVar(),t=Q().toVar(),r=Q().toVar(),i=Q().toVar(),s=V(an(e.x,t)).toVar(),o=V(an(e.y,r)).toVar(),a=V(an(e.z,i)).toVar(),c=V(ws(s)).toVar(),f=V(ws(o)).toVar(),p=V(ws(a)).toVar(),g=V(gw(Xn(Gt(t,r,i),s,o,a),Xn(Gt(t.add(Q(1)),r,i),s.sub(1),o,a),Xn(Gt(t,r.add(Q(1)),i),s,o.sub(1),a),Xn(Gt(t.add(Q(1)),r.add(Q(1)),i),s.sub(1),o.sub(1),a),Xn(Gt(t,r,i.add(Q(1))),s,o,a.sub(1)),Xn(Gt(t.add(Q(1)),r,i.add(Q(1))),s.sub(1),o,a.sub(1)),Xn(Gt(t,r.add(Q(1)),i.add(Q(1))),s,o.sub(1),a.sub(1)),Xn(Gt(t.add(Q(1)),r.add(Q(1)),i.add(Q(1))),s.sub(1),o.sub(1),a.sub(1)),c,f,p)).toVar();return yw(g)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),j2=lr([UV,qV]),GV=ee(([n])=>{const e=xe(n).toVar(),t=Q().toVar(),r=Q().toVar(),i=V(an(e.x,t)).toVar(),s=V(an(e.y,r)).toVar(),o=V(ws(i)).toVar(),a=V(ws(s)).toVar(),c=X(mw(di(pi(t,r),i,s),di(pi(t.add(Q(1)),r),i.sub(1),s),di(pi(t,r.add(Q(1))),i,s.sub(1)),di(pi(t.add(Q(1)),r.add(Q(1))),i.sub(1),s.sub(1)),o,a)).toVar();return _w(c)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),VV=ee(([n])=>{const e=X(n).toVar(),t=Q().toVar(),r=Q().toVar(),i=Q().toVar(),s=V(an(e.x,t)).toVar(),o=V(an(e.y,r)).toVar(),a=V(an(e.z,i)).toVar(),c=V(ws(s)).toVar(),f=V(ws(o)).toVar(),p=V(ws(a)).toVar(),g=X(gw(di(pi(t,r,i),s,o,a),di(pi(t.add(Q(1)),r,i),s.sub(1),o,a),di(pi(t,r.add(Q(1)),i),s,o.sub(1),a),di(pi(t.add(Q(1)),r.add(Q(1)),i),s.sub(1),o.sub(1),a),di(pi(t,r,i.add(Q(1))),s,o,a.sub(1)),di(pi(t.add(Q(1)),r,i.add(Q(1))),s.sub(1),o,a.sub(1)),di(pi(t,r.add(Q(1)),i.add(Q(1))),s,o.sub(1),a.sub(1)),di(pi(t.add(Q(1)),r.add(Q(1)),i.add(Q(1))),s.sub(1),o.sub(1),a.sub(1)),c,f,p)).toVar();return yw(g)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),sc=lr([GV,VV]),zV=ee(([n])=>{const e=V(n).toVar(),t=Q(Cn(e)).toVar();return gr(Gt(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),$V=ee(([n])=>{const e=xe(n).toVar(),t=Q(Cn(e.x)).toVar(),r=Q(Cn(e.y)).toVar();return gr(Gt(t,r))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),jV=ee(([n])=>{const e=X(n).toVar(),t=Q(Cn(e.x)).toVar(),r=Q(Cn(e.y)).toVar(),i=Q(Cn(e.z)).toVar();return gr(Gt(t,r,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),HV=ee(([n])=>{const e=ze(n).toVar(),t=Q(Cn(e.x)).toVar(),r=Q(Cn(e.y)).toVar(),i=Q(Cn(e.z)).toVar(),s=Q(Cn(e.w)).toVar();return gr(Gt(t,r,i,s))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),WV=lr([zV,$V,jV,HV]),QV=ee(([n])=>{const e=V(n).toVar(),t=Q(Cn(e)).toVar();return X(gr(Gt(t,Q(0))),gr(Gt(t,Q(1))),gr(Gt(t,Q(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),YV=ee(([n])=>{const e=xe(n).toVar(),t=Q(Cn(e.x)).toVar(),r=Q(Cn(e.y)).toVar();return X(gr(Gt(t,r,Q(0))),gr(Gt(t,r,Q(1))),gr(Gt(t,r,Q(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),XV=ee(([n])=>{const e=X(n).toVar(),t=Q(Cn(e.x)).toVar(),r=Q(Cn(e.y)).toVar(),i=Q(Cn(e.z)).toVar();return X(gr(Gt(t,r,i,Q(0))),gr(Gt(t,r,i,Q(1))),gr(Gt(t,r,i,Q(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),KV=ee(([n])=>{const e=ze(n).toVar(),t=Q(Cn(e.x)).toVar(),r=Q(Cn(e.y)).toVar(),i=Q(Cn(e.z)).toVar(),s=Q(Cn(e.w)).toVar();return X(gr(Gt(t,r,i,s,Q(0))),gr(Gt(t,r,i,s,Q(1))),gr(Gt(t,r,i,s,Q(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),qf=lr([QV,YV,XV,KV]),$h=ee(([n,e,t,r])=>{const i=V(r).toVar(),s=V(t).toVar(),o=Q(e).toVar(),a=X(n).toVar(),c=V(0).toVar(),f=V(1).toVar();return It(o,()=>{c.addAssign(f.mul(j2(a))),f.mulAssign(i),a.mulAssign(s)}),c}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Gf=ee(([n,e,t,r])=>{const i=V(r).toVar(),s=V(t).toVar(),o=Q(e).toVar(),a=X(n).toVar(),c=X(0).toVar(),f=V(1).toVar();return It(o,()=>{c.addAssign(f.mul(sc(a))),f.mulAssign(i),a.mulAssign(s)}),c}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ZV=ee(([n,e,t,r])=>{const i=V(r).toVar(),s=V(t).toVar(),o=Q(e).toVar(),a=X(n).toVar();return xe($h(a,o,s,i),$h(a.add(X(Q(19),Q(193),Q(17))),o,s,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),JV=ee(([n,e,t,r])=>{const i=V(r).toVar(),s=V(t).toVar(),o=Q(e).toVar(),a=X(n).toVar(),c=X(Gf(a,o,s,i)).toVar(),f=V($h(a.add(X(Q(19),Q(193),Q(17))),o,s,i)).toVar();return ze(c,f)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ez=ee(([n,e,t,r,i,s,o])=>{const a=Q(o).toVar(),c=V(s).toVar(),f=Q(i).toVar(),p=Q(r).toVar(),g=Q(t).toVar(),v=Q(e).toVar(),b=xe(n).toVar(),T=X(qf(xe(v.add(p),g.add(f)))).toVar(),S=xe(T.x,T.y).toVar();S.subAssign(.5),S.mulAssign(c),S.addAssign(.5);const N=xe(xe(V(v),V(g)).add(S)).toVar(),C=xe(N.sub(b)).toVar();return Ve(a.equal(Q(2)),()=>Xt(C.x).add(Xt(C.y))),Ve(a.equal(Q(3)),()=>gn(Xt(C.x),Xt(C.y))),Si(C,C)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),tz=ee(([n,e,t,r,i,s,o,a,c])=>{const f=Q(c).toVar(),p=V(a).toVar(),g=Q(o).toVar(),v=Q(s).toVar(),b=Q(i).toVar(),T=Q(r).toVar(),S=Q(t).toVar(),N=Q(e).toVar(),C=X(n).toVar(),P=X(qf(X(N.add(b),S.add(v),T.add(g)))).toVar();P.subAssign(.5),P.mulAssign(p),P.addAssign(.5);const B=X(X(V(N),V(S),V(T)).add(P)).toVar(),F=X(B.sub(C)).toVar();return Ve(f.equal(Q(2)),()=>Xt(F.x).add(Xt(F.y)).add(Xt(F.z))),Ve(f.equal(Q(3)),()=>gn(Xt(F.x),Xt(F.y),Xt(F.z))),Si(F,F)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),pu=lr([ez,tz]),nz=ee(([n,e,t])=>{const r=Q(t).toVar(),i=V(e).toVar(),s=xe(n).toVar(),o=Q().toVar(),a=Q().toVar(),c=xe(an(s.x,o),an(s.y,a)).toVar(),f=V(1e6).toVar();return It({start:-1,end:Q(1),name:"x",condition:"<="},({x:p})=>{It({start:-1,end:Q(1),name:"y",condition:"<="},({y:g})=>{const v=V(pu(c,p,g,o,a,i,r)).toVar();f.assign(Vr(f,v))})}),Ve(r.equal(Q(0)),()=>{f.assign(pr(f))}),f}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),rz=ee(([n,e,t])=>{const r=Q(t).toVar(),i=V(e).toVar(),s=xe(n).toVar(),o=Q().toVar(),a=Q().toVar(),c=xe(an(s.x,o),an(s.y,a)).toVar(),f=xe(1e6,1e6).toVar();return It({start:-1,end:Q(1),name:"x",condition:"<="},({x:p})=>{It({start:-1,end:Q(1),name:"y",condition:"<="},({y:g})=>{const v=V(pu(c,p,g,o,a,i,r)).toVar();Ve(v.lessThan(f.x),()=>{f.y.assign(f.x),f.x.assign(v)}).ElseIf(v.lessThan(f.y),()=>{f.y.assign(v)})})}),Ve(r.equal(Q(0)),()=>{f.assign(pr(f))}),f}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),iz=ee(([n,e,t])=>{const r=Q(t).toVar(),i=V(e).toVar(),s=xe(n).toVar(),o=Q().toVar(),a=Q().toVar(),c=xe(an(s.x,o),an(s.y,a)).toVar(),f=X(1e6,1e6,1e6).toVar();return It({start:-1,end:Q(1),name:"x",condition:"<="},({x:p})=>{It({start:-1,end:Q(1),name:"y",condition:"<="},({y:g})=>{const v=V(pu(c,p,g,o,a,i,r)).toVar();Ve(v.lessThan(f.x),()=>{f.z.assign(f.y),f.y.assign(f.x),f.x.assign(v)}).ElseIf(v.lessThan(f.y),()=>{f.z.assign(f.y),f.y.assign(v)}).ElseIf(v.lessThan(f.z),()=>{f.z.assign(v)})})}),Ve(r.equal(Q(0)),()=>{f.assign(pr(f))}),f}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),sz=ee(([n,e,t])=>{const r=Q(t).toVar(),i=V(e).toVar(),s=X(n).toVar(),o=Q().toVar(),a=Q().toVar(),c=Q().toVar(),f=X(an(s.x,o),an(s.y,a),an(s.z,c)).toVar(),p=V(1e6).toVar();return It({start:-1,end:Q(1),name:"x",condition:"<="},({x:g})=>{It({start:-1,end:Q(1),name:"y",condition:"<="},({y:v})=>{It({start:-1,end:Q(1),name:"z",condition:"<="},({z:b})=>{const T=V(pu(f,g,v,b,o,a,c,i,r)).toVar();p.assign(Vr(p,T))})})}),Ve(r.equal(Q(0)),()=>{p.assign(pr(p))}),p}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),oz=lr([nz,sz]),az=ee(([n,e,t])=>{const r=Q(t).toVar(),i=V(e).toVar(),s=X(n).toVar(),o=Q().toVar(),a=Q().toVar(),c=Q().toVar(),f=X(an(s.x,o),an(s.y,a),an(s.z,c)).toVar(),p=xe(1e6,1e6).toVar();return It({start:-1,end:Q(1),name:"x",condition:"<="},({x:g})=>{It({start:-1,end:Q(1),name:"y",condition:"<="},({y:v})=>{It({start:-1,end:Q(1),name:"z",condition:"<="},({z:b})=>{const T=V(pu(f,g,v,b,o,a,c,i,r)).toVar();Ve(T.lessThan(p.x),()=>{p.y.assign(p.x),p.x.assign(T)}).ElseIf(T.lessThan(p.y),()=>{p.y.assign(T)})})})}),Ve(r.equal(Q(0)),()=>{p.assign(pr(p))}),p}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),lz=lr([rz,az]),uz=ee(([n,e,t])=>{const r=Q(t).toVar(),i=V(e).toVar(),s=X(n).toVar(),o=Q().toVar(),a=Q().toVar(),c=Q().toVar(),f=X(an(s.x,o),an(s.y,a),an(s.z,c)).toVar(),p=X(1e6,1e6,1e6).toVar();return It({start:-1,end:Q(1),name:"x",condition:"<="},({x:g})=>{It({start:-1,end:Q(1),name:"y",condition:"<="},({y:v})=>{It({start:-1,end:Q(1),name:"z",condition:"<="},({z:b})=>{const T=V(pu(f,g,v,b,o,a,c,i,r)).toVar();Ve(T.lessThan(p.x),()=>{p.z.assign(p.y),p.y.assign(p.x),p.x.assign(T)}).ElseIf(T.lessThan(p.y),()=>{p.z.assign(p.y),p.y.assign(T)}).ElseIf(T.lessThan(p.z),()=>{p.z.assign(T)})})})}),Ve(r.equal(Q(0)),()=>{p.assign(pr(p))}),p}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),H2=lr([iz,uz]),Az=ee(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=Q(n).toVar(),v=xe(e).toVar(),b=xe(t).toVar(),T=xe(r).toVar(),S=V(i).toVar(),N=V(s).toVar(),C=V(o).toVar(),P=wi(a).toVar(),B=Q(c).toVar(),F=V(f).toVar(),q=V(p).toVar(),I=v.mul(b).add(T),U=V(0).toVar();return Ve(g.equal(Q(0)),()=>{U.assign(sc(I))}),Ve(g.equal(Q(1)),()=>{U.assign(qf(I))}),Ve(g.equal(Q(2)),()=>{U.assign(H2(I,S,Q(0)))}),Ve(g.equal(Q(3)),()=>{U.assign(Gf(X(I,0),B,F,q))}),U.assign(U.mul(C.sub(N)).add(N)),Ve(P,()=>{U.assign(Qi(U,N,C))}),U}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),cz=ee(([n,e,t,r,i,s,o,a,c,f,p])=>{const g=Q(n).toVar(),v=X(e).toVar(),b=X(t).toVar(),T=X(r).toVar(),S=V(i).toVar(),N=V(s).toVar(),C=V(o).toVar(),P=wi(a).toVar(),B=Q(c).toVar(),F=V(f).toVar(),q=V(p).toVar(),I=v.mul(b).add(T),U=V(0).toVar();return Ve(g.equal(Q(0)),()=>{U.assign(sc(I))}),Ve(g.equal(Q(1)),()=>{U.assign(qf(I))}),Ve(g.equal(Q(2)),()=>{U.assign(H2(I,S,Q(0)))}),Ve(g.equal(Q(3)),()=>{U.assign(Gf(I,B,F,q))}),U.assign(U.mul(C.sub(N)).add(N)),Ve(P,()=>{U.assign(Qi(U,N,C))}),U}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),hz=ee(([n])=>{const e=n.y,t=n.z,r=X().toVar();return Ve(e.lessThan(1e-4),()=>{r.assign(X(t,t,t))}).Else(()=>{let i=n.x;i=i.sub(vs(i)).mul(6).toVar();const s=Q(W1(i)),o=i.sub(V(s)),a=t.mul(e.oneMinus()),c=t.mul(e.mul(o).oneMinus()),f=t.mul(e.mul(o.oneMinus()).oneMinus());Ve(s.equal(Q(0)),()=>{r.assign(X(t,f,a))}).ElseIf(s.equal(Q(1)),()=>{r.assign(X(c,t,a))}).ElseIf(s.equal(Q(2)),()=>{r.assign(X(a,t,f))}).ElseIf(s.equal(Q(3)),()=>{r.assign(X(a,c,t))}).ElseIf(s.equal(Q(4)),()=>{r.assign(X(f,a,t))}).Else(()=>{r.assign(X(t,a,c))})}),r}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),fz=ee(([n])=>{const e=X(n).toVar(),t=V(e.x).toVar(),r=V(e.y).toVar(),i=V(e.z).toVar(),s=V(Vr(t,Vr(r,i))).toVar(),o=V(gn(t,gn(r,i))).toVar(),a=V(o.sub(s)).toVar(),c=V().toVar(),f=V().toVar(),p=V().toVar();return p.assign(o),Ve(o.greaterThan(0),()=>{f.assign(a.div(o))}).Else(()=>{f.assign(0)}),Ve(f.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{Ve(t.greaterThanEqual(o),()=>{c.assign(r.sub(i).div(a))}).ElseIf(r.greaterThanEqual(o),()=>{c.assign(Mn(2,i.sub(t).div(a)))}).Else(()=>{c.assign(Mn(4,t.sub(r).div(a)))}),c.mulAssign(1/6),Ve(c.lessThan(0),()=>{c.addAssign(1)})}),X(c,f,p)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),dz=ee(([n])=>{const e=X(n).toVar(),t=C1(k1(e,X(.04045))).toVar(),r=X(e.div(12.92)).toVar(),i=X(gi(gn(e.add(X(.055)),X(0)).div(1.055),X(2.4))).toVar();return xt(r,i,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),xw=(n,e)=>{n=V(n),e=V(e);const t=xe(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Yi(n.sub(t),n.add(t),e)},bw=(n,e,t,r)=>xt(n,e,t[r].clamp()),pz=(n,e,t=zt())=>bw(n,e,t,"x"),mz=(n,e,t=zt())=>bw(n,e,t,"y"),gz=(n,e,t,r,i=zt())=>{const s=i.x.clamp(),o=i.y.clamp(),a=xt(n,e,s),c=xt(t,r,s);return xt(a,c,o)},Tw=(n,e,t,r,i)=>xt(n,e,xw(t,r[i])),_z=(n,e,t,r=zt())=>Tw(n,e,t,r,"x"),yz=(n,e,t,r=zt())=>Tw(n,e,t,r,"y"),vz=(n=1,e=0,t=zt())=>t.mul(n).add(e),xz=(n,e=1)=>(n=V(n),n.abs().pow(e).mul(n.sign())),bz=(n,e=1,t=.5)=>V(n).sub(t).mul(e).add(t),Tz=(n=zt(),e=1,t=0)=>j2(n.convert("vec2|vec3")).mul(e).add(t),wz=(n=zt(),e=1,t=0)=>sc(n.convert("vec2|vec3")).mul(e).add(t),Sz=(n=zt(),e=1,t=0)=>(n=n.convert("vec2|vec3"),ze(sc(n),j2(n.add(xe(19,73)))).mul(e).add(t)),Ez=(n,e=zt(),t=xe(1,1),r=xe(0,0),i=1,s=0,o=1,a=!1,c=1,f=2,p=.5)=>Az(n,e.convert("vec2|vec3"),t,r,i,s,o,a,c,f,p),Nz=(n,e=zt(),t=xe(1,1),r=xe(0,0),i=1,s=0,o=1,a=!1,c=1,f=2,p=.5)=>cz(n,e.convert("vec2|vec3"),t,r,i,s,o,a,c,f,p),Rz=(n=zt(),e=1)=>oz(n.convert("vec2|vec3"),e,Q(1)),Cz=(n=zt(),e=1)=>lz(n.convert("vec2|vec3"),e,Q(1)),Mz=(n=zt(),e=1)=>H2(n.convert("vec2|vec3"),e,Q(1)),Pz=(n=zt())=>WV(n.convert("vec2|vec3")),Bz=(n=zt(),e=3,t=2,r=.5,i=1)=>$h(n,Q(e),t,r).mul(i),Dz=(n=zt(),e=3,t=2,r=.5,i=1)=>ZV(n,Q(e),t,r).mul(i),Lz=(n=zt(),e=3,t=2,r=.5,i=1)=>Gf(n,Q(e),t,r).mul(i),Fz=(n=zt(),e=3,t=2,r=.5,i=1)=>JV(n,Q(e),t,r).mul(i),Oz=(n,e=V(0))=>Mn(n,e),Iz=(n,e=V(0))=>Tt(n,e),kz=(n,e=V(1))=>Ke(n,e),Uz=(n,e=V(1))=>si(n,e),qz=(n,e=V(1))=>KA(n,e),Gz=(n,e=V(1))=>gi(n,e),Vz=(n=V(0),e=V(1))=>yf(n,e),zz=()=>du,$z=()=>I5,jz=(n,e=V(1))=>Tt(e,n),Hz=(n,e,t,r)=>n.greaterThan(e).mix(t,r),Wz=(n,e,t,r)=>n.greaterThanEqual(e).mix(t,r),Qz=(n,e,t,r)=>n.equal(e).mix(t,r),Yz=(n,e=null)=>{if(typeof e=="string"){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},r=e.replace(/^out/,"").toLowerCase();if(t[r]!==void 0)return n.element(t[r])}if(typeof e=="number")return n.element(e);if(typeof e=="string"&&e.length===1){const t={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(t[e]!==void 0)return n.element(t[e])}return n},Xz=(n,e=xe(.5,.5),t=xe(1,1),r=V(0),i=xe(0,0))=>{let s=n;if(e&&(s=s.sub(e)),t&&(s=s.mul(t)),r){const o=r.mul(Math.PI/180),a=o.cos(),c=o.sin();s=xe(s.x.mul(a).sub(s.y.mul(c)),s.x.mul(c).add(s.y.mul(a)))}return e&&(s=s.add(e)),i&&(s=s.add(i)),s},Kz=(n,e)=>{n=xe(n),e=V(e);const t=e.mul(Math.PI/180);return tc(n,t)},Zz=(n,e,t)=>{n=X(n),e=V(e),t=X(t);const r=e.mul(Math.PI/180),i=t.normalize(),s=r.cos(),o=r.sin(),a=V(1).sub(s);return n.mul(s).add(i.cross(n).mul(o)).add(i.mul(i.dot(n)).mul(a))},Jz=(n,e)=>(n=X(n),e=V(e),m2(n,e)),e$=ee(([n,e,t])=>{const r=Mr(n).toVar(),i=Tt(V(.5).mul(e.sub(t)),bs).div(r).toVar(),s=Tt(V(-.5).mul(e.sub(t)),bs).div(r).toVar(),o=X().toVar();o.x=r.x.greaterThan(V(0)).select(i.x,s.x),o.y=r.y.greaterThan(V(0)).select(i.y,s.y),o.z=r.z.greaterThan(V(0)).select(i.z,s.z);const a=Vr(o.x,o.y,o.z).toVar();return bs.add(r.mul(a)).toVar().sub(t)}),ww=ee(([n,e])=>{const t=n.x,r=n.y,i=n.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(r)),s=s.add(e.element(2).mul(2*.511664).mul(i)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(r)),s=s.add(e.element(5).mul(2*.429043).mul(r).mul(i)),s=s.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(8).mul(.429043).mul(Ke(t,t).sub(Ke(r,r)))),s});var R=Object.freeze({__proto__:null,BRDF_GGX:N2,BRDF_Lambert:$a,BasicPointShadowFilter:hw,BasicShadowFilter:rw,Break:Z6,Const:gT,Continue:qO,DFGLUT:kA,D_GGX:m5,Discard:DT,EPSILON:U1,F_Schlick:ou,Fn:ee,HALF_PI:hF,INFINITY:uF,If:Ve,Loop:It,NodeAccess:ir,NodeShaderStage:tA,NodeType:BL,NodeUpdateType:it,OnBeforeMaterialUpdate:lq,OnBeforeObjectUpdate:aq,OnMaterialUpdate:oq,OnObjectUpdate:sq,PCFShadowFilter:iw,PCFSoftShadowFilter:sw,PI:Oh,PI2:AF,PointShadowFilter:fw,Return:RF,Schlick_to_F0:ug,ScriptableNodeResources:k0,ShaderNode:Ll,Stack:ff,Switch:eF,TBNViewMatrix:Da,TWO_PI:cF,VSMShadowFilter:ow,V_GGX_SmithCorrelated:p5,Var:mT,VarIntent:_T,abs:Xt,acesFilmicToneMapping:Q5,acos:V1,add:Mn,addMethodChaining:fe,addNodeElement:BF,agxToneMapping:Y5,all:G8,alphaT:Dh,and:E8,anisotropy:Co,anisotropyB:ka,anisotropyT:fA,any:V8,append:iF,array:y8,arrayBuffer:nF,asin:H8,assign:v8,atan:yf,atan2:AT,atomicAdd:pG,atomicAnd:yG,atomicFunc:Bs,atomicLoad:fG,atomicMax:gG,atomicMin:_G,atomicOr:vG,atomicStore:dG,atomicSub:mG,atomicXor:xG,attenuationColor:L1,attenuationDistance:D1,attribute:oo,attributeArray:Aq,backgroundBlurriness:q5,backgroundIntensity:dg,backgroundRotation:G5,batch:Y6,bentNormalView:c6,billboarding:VU,bitAnd:M8,bitNot:P8,bitOr:B8,bitXor:D8,bitangentGeometry:_O,bitangentLocal:yO,bitangentView:u6,bitangentWorld:vO,bitcast:F5,blendBurn:i5,blendColor:rI,blendDodge:s5,blendOverlay:a5,blendScreen:o5,blur:T5,bool:wi,buffer:ZA,bufferAttribute:i2,builtin:uo,builtinAOContext:dT,builtinShadowContext:fT,bumpMap:m2,burn:sI,bvec2:h8,bvec3:C1,bvec4:f8,bypass:CT,cache:RT,call:x8,cameraFar:Do,cameraIndex:Yo,cameraNear:Bo,cameraNormalMatrix:WF,cameraPosition:GT,cameraProjectionMatrix:Ks,cameraProjectionMatrixInverse:jF,cameraViewMatrix:Mi,cameraViewport:QF,cameraWorldMatrix:HF,cbrt:sT,cdl:Rq,ceil:_f,checker:_V,cineonToneMapping:W5,clamp:Qi,clearcoat:Mh,clearcoatNormalView:Ba,clearcoatRoughness:IA,code:If,color:c8,colorSpaceToWorking:bf,colorToDirection:bO,compute:NT,computeKernel:s2,computeSkinning:kO,context:lo,convert:p8,convertColorSpace:yF,convertToTexture:eq,cos:Ii,countLeadingZeros:_U,countOneBits:yU,countTrailingZeros:gU,cross:io,cubeTexture:Cr,cubeTextureBase:p2,dFdx:j1,dFdy:H1,dashSize:M0,debug:FT,decrement:U8,decrementBefore:I8,defaultBuildStages:Qm,defaultShaderStages:s8,defined:LA,degrees:$8,deltaTime:LU,densityFog:Xq,densityFogFactor:I2,depth:T2,depthPass:Dq,determinant:K8,difference:nT,diffuseColor:Ft,diffuseContribution:va,directPointLight:pw,directionToColor:h6,directionToFaceDirection:hu,dispersion:F1,disposeShadowMaterial:lw,distance:tT,div:si,dodge:oI,dot:Si,drawIndex:H6,dynamicBufferAttribute:wF,element:d8,emissive:Zm,equal:I1,equals:J8,equirectUV:w2,exp:q1,exp2:iu,expression:so,faceDirection:h2,faceForward:J1,faceforward:fF,float:V,floatBitsToInt:dU,floatBitsToUint:O5,floor:vs,fog:qA,fract:Wi,frameGroup:_8,frameId:I5,frontFacing:jT,fwidth:Q1,gain:xU,gapSize:Jm,getConstNodeType:A8,getCurrentStack:E1,getDirection:x5,getDistanceAttenuation:$2,getGeometryRoughness:d5,getNormalFromDepth:nq,getParallaxCorrectNormal:e$,getRoughness:E2,getScreenPosition:tq,getShIrradianceAt:ww,getShadowMaterial:aw,getShadowRenderObjectFunction:uw,getTextureIndex:D5,getViewPosition:Nl,ggxConvolution:w5,globalId:nG,glsl:Vq,glslFn:zq,grayscale:wq,greaterThan:k1,greaterThanEqual:S8,hash:vU,highpModelNormalViewMatrix:ng,highpModelViewMatrix:tg,hue:Nq,increment:k8,incrementBefore:O8,inspector:IT,instance:FO,instanceIndex:Ts,instancedArray:cq,instancedBufferAttribute:Ih,instancedDynamicBufferAttribute:eg,instancedMesh:Q6,int:Q,intBitsToFloat:pU,interleavedGradientNoise:L2,inverse:Z8,inverseSqrt:G1,inversesqrt:dF,invocationLocalIndex:LO,invocationSubgroupIndex:DO,ior:dA,iridescence:pf,iridescenceIOR:Ph,iridescenceThickness:Bh,isolate:$l,ivec2:Dn,ivec3:R1,ivec4:M1,js:qq,label:pT,length:xs,lengthSq:K1,lessThan:T8,lessThanEqual:w8,lightPosition:U2,lightProjectionUV:tw,lightShadowMatrix:Uf,lightTargetDirection:G2,lightTargetPosition:nw,lightViewPosition:q2,lightingContext:e5,lights:YG,linearDepth:Uh,linearToneMapping:j5,localId:rG,log:gf,log2:ys,logarithmicDepthToViewZ:YO,luminance:F2,mat2:df,mat3:or,mat4:qo,matcapUV:E5,materialAO:z6,materialAlphaTest:f6,materialAnisotropy:R6,materialAnisotropyVector:El,materialAttenuationColor:O6,materialAttenuationDistance:F6,materialClearcoat:b6,materialClearcoatNormal:w6,materialClearcoatRoughness:T6,materialColor:d6,materialDispersion:V6,materialEmissive:m6,materialEnvIntensity:D0,materialEnvRotation:d2,materialIOR:L6,materialIridescence:C6,materialIridescenceIOR:M6,materialIridescenceThickness:P6,materialLightMap:_2,materialLineDashOffset:q6,materialLineDashSize:k6,materialLineGapSize:U6,materialLineScale:I6,materialLineWidth:NO,materialMetalness:v6,materialNormal:x6,materialOpacity:g2,materialPointSize:G6,materialReference:Gs,materialReflectivity:L0,materialRefractionRatio:YT,materialRotation:S6,materialRoughness:y6,materialSheen:E6,materialSheenRoughness:N6,materialShininess:p6,materialSpecular:g6,materialSpecularColor:_6,materialSpecularIntensity:lg,materialSpecularStrength:pA,materialThickness:D6,materialTransmission:B6,max:gn,maxMipLevel:o2,mediumpModelViewMatrix:$T,metalness:$s,min:Vr,mix:xt,mixElement:aT,mod:KA,modInt:q8,modelDirection:eO,modelNormalMatrix:zT,modelPosition:tO,modelRadius:iO,modelScale:nO,modelViewMatrix:Xo,modelViewPosition:rO,modelViewProjection:$6,modelWorldMatrix:_i,modelWorldMatrixInverse:sO,morphReference:J6,mrt:L5,mul:Ke,mx_aastep:xw,mx_add:Oz,mx_atan2:Vz,mx_cell_noise_float:Pz,mx_contrast:bz,mx_divide:Uz,mx_fractal_noise_float:Bz,mx_fractal_noise_vec2:Dz,mx_fractal_noise_vec3:Lz,mx_fractal_noise_vec4:Fz,mx_frame:$z,mx_heighttonormal:Jz,mx_hsvtorgb:hz,mx_ifequal:Qz,mx_ifgreater:Hz,mx_ifgreatereq:Wz,mx_invert:jz,mx_modulo:qz,mx_multiply:kz,mx_noise_float:Tz,mx_noise_vec3:wz,mx_noise_vec4:Sz,mx_place2d:Xz,mx_power:Gz,mx_ramp4:gz,mx_ramplr:pz,mx_ramptb:mz,mx_rgbtohsv:fz,mx_rotate2d:Kz,mx_rotate3d:Zz,mx_safepower:xz,mx_separate:Yz,mx_splitlr:_z,mx_splittb:yz,mx_srgb_texture_to_lin_rec709:dz,mx_subtract:Iz,mx_timer:zz,mx_transform_uv:vz,mx_unifiednoise2d:Ez,mx_unifiednoise3d:Nz,mx_worley_noise_float:Rz,mx_worley_noise_vec2:Cz,mx_worley_noise_vec3:Mz,negate:$1,neutralToneMapping:X5,nodeArray:Ia,nodeImmutable:Ce,nodeObject:Me,nodeObjectIntent:nA,nodeObjects:hf,nodeProxy:Ze,nodeProxyIntent:Te,normalFlat:HT,normalGeometry:wf,normalLocal:zr,normalMap:ag,normalView:St,normalViewGeometry:su,normalWorld:Ko,normalWorldGeometry:WT,normalize:Mr,not:R8,notEqual:b8,numWorkgroups:eG,objectDirection:YF,objectGroup:O1,objectPosition:VT,objectRadius:JF,objectScale:KF,objectViewPosition:ZF,objectWorldMatrix:XF,oneMinus:W8,or:N8,orthographicDepthToViewZ:QO,oscSawtooth:kU,oscSine:FU,oscSquare:OU,oscTriangle:IU,output:Vl,outputStruct:hU,overlay:lI,overloadingFn:lr,packHalf2x16:EU,packSnorm2x16:wU,packUnorm2x16:SU,parabola:fg,parallaxDirection:A6,parallaxUV:xO,parameter:oU,pass:Pq,passTexture:Bq,pcurve:bU,perspectiveDepthToViewZ:x2,pmremTexture:C2,pointShadow:dw,pointUV:fq,pointWidth:sF,positionGeometry:JA,positionLocal:fn,positionPrevious:kh,positionView:Nn,positionViewDirection:Ht,positionWorld:bs,positionWorldDirection:c2,posterize:Mq,pow:gi,pow2:Y1,pow3:rT,pow4:X1,premultiplyAlpha:l5,property:Qs,quadBroadcast:HG,quadSwapDiagonal:qG,quadSwapX:kG,quadSwapY:UG,radians:z8,rand:oT,range:Zq,rangeFog:Yq,rangeFogFactor:O2,reciprocal:Y8,reference:qt,referenceBuffer:rg,reflect:eT,reflectVector:ZT,reflectView:XT,reflector:YU,refract:Z1,refractVector:JT,refractView:KT,reinhardToneMapping:H5,remap:PT,remapClamp:BT,renderGroup:qe,renderOutput:LT,rendererReference:wT,replaceDefaultUV:UU,rotate:tc,rotateUV:qU,roughness:hs,round:Q8,rtt:U5,sRGBTransferEOTF:vT,sRGBTransferOETF:xT,sample:iq,sampler:kF,samplerComparison:UF,saturate:xf,saturation:Sq,screen:aI,screenCoordinate:Qa,screenDPR:UT,screenSize:za,screenUV:Xs,scriptable:Qq,scriptableValue:I0,select:sr,setCurrentStack:FA,setName:e2,shaderStages:Ym,shadow:cw,shadowPositionWorld:z2,shapeCircle:yV,sharedUniformGroup:mf,sheen:Xr,sheenRoughness:Po,shiftLeft:L8,shiftRight:F8,shininess:Lh,sign:z1,sin:Rr,sinc:TU,skinning:K6,smoothstep:Yi,smoothstepElement:lT,specularColor:jo,specularColorBlended:Pa,specularF90:Gl,spherizeUV:GU,split:rF,spritesheetUV:jU,sqrt:pr,stack:F0,step:vf,stepElement:uT,storage:Zs,storageBarrier:aG,storageObject:PO,storageTexture:V5,string:tF,struct:cU,sub:Tt,subBuild:zl,subgroupAdd:wG,subgroupAll:FG,subgroupAnd:MG,subgroupAny:OG,subgroupBallot:TG,subgroupBroadcast:GG,subgroupBroadcastFirst:IG,subgroupElect:bG,subgroupExclusiveAdd:EG,subgroupExclusiveMul:CG,subgroupInclusiveAdd:SG,subgroupInclusiveMul:RG,subgroupIndex:BO,subgroupMax:LG,subgroupMin:DG,subgroupMul:NG,subgroupOr:PG,subgroupShuffle:VG,subgroupShuffleDown:jG,subgroupShuffleUp:$G,subgroupShuffleXor:zG,subgroupSize:iG,subgroupXor:BG,tan:j8,tangentGeometry:Ef,tangentLocal:ec,tangentView:Nf,tangentWorld:l6,texture:Rt,texture3D:Of,texture3DLevel:yq,texture3DLoad:_q,textureBarrier:lG,textureBicubic:UI,textureBicubicLevel:R2,textureCubeUV:b5,textureLevel:IF,textureLoad:vn,textureSize:Ys,textureStore:pq,thickness:B1,time:du,toneMapping:ST,toneMappingExposure:ET,toonOutlinePass:Fq,transformDirection:iT,transformNormal:QT,transformNormalToView:f2,transformedClearcoatNormalView:uO,transformedNormalView:aO,transformedNormalWorld:lO,transmission:Fh,transpose:X8,triNoise3D:PU,triplanarTexture:HU,triplanarTextures:k5,trunc:W1,uint:me,uintBitsToFloat:mU,uniform:Ge,uniformArray:dr,uniformCubeTexture:cO,uniformFlow:hT,uniformGroup:g8,uniformTexture:OF,unpackHalf2x16:CU,unpackNormal:og,unpackSnorm2x16:NU,unpackUnorm2x16:RU,unpremultiplyAlpha:iI,userData:xq,uv:zt,uvec2:N1,uvec3:Wa,uvec4:P1,varying:Ps,varyingProperty:OA,vec2:xe,vec3:X,vec4:ze,vectorComponents:ja,velocity:Tq,vertexColor:r5,vertexIndex:j6,vertexStage:yT,vibrance:Eq,viewZToLogarithmicDepth:b2,viewZToOrthographicDepth:jl,viewZToPerspectiveDepth:t5,viewport:u2,viewportCoordinate:qT,viewportDepthTexture:v2,viewportLinearDepth:XO,viewportMipTexture:y2,viewportResolution:$F,viewportSafeUV:zU,viewportSharedTexture:dI,viewportSize:A2,viewportTexture:HO,viewportUV:zF,vogelDiskSample:qi,wgsl:Gq,wgslFn:$q,workgroupArray:cG,workgroupBarrier:oG,workgroupId:tG,workingToColorSpace:bT,xor:C8});const Bi=new M2;class t$ extends Zo{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,r){const i=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(s===null)i._clearColor.getRGB(Bi),Bi.a=i._clearColor.a;else if(s.isColor===!0)s.getRGB(Bi),Bi.a=1,o=!0;else if(s.isNode===!0){const c=this.get(e),f=s;Bi.copy(i._clearColor);let p=c.backgroundMesh;if(p===void 0){let P=function(){s.removeEventListener("dispose",P),p.material.dispose(),p.geometry.dispose()};const v=ze(f).mul(dg).context({getUV:()=>G5.mul(WT),getTextureLevel:()=>q5}),b=Ks.element(3).element(3).equal(1),T=si(1,Ks.element(1).element(1)).mul(3),S=b.select(fn.mul(T),fn);let N=Ks.mul(Xo.mul(ze(S,0)));N=N.setZ(N.w);const C=new Tn;C.name="Background.material",C.side=mr,C.depthTest=!1,C.depthWrite=!1,C.allowOverride=!1,C.fog=!1,C.lights=!1,C.vertexNode=N,C.colorNode=v,c.backgroundMeshNode=v,c.backgroundMesh=p=new pn(new Wo(1,32,32),C),p.frustumCulled=!1,p.name="Background.mesh",s.addEventListener("dispose",P)}const g=f.getCacheKey();c.backgroundCacheKey!==g&&(c.backgroundMeshNode.node=ze(f).mul(dg),c.backgroundMeshNode.needsUpdate=!0,p.material.needsUpdate=!0,c.backgroundCacheKey=g),t.unshift(p,p.geometry,p.material,0,0,null,null)}else Pe("Renderer: Unsupported background configuration.",s);const a=i.xr.getEnvironmentBlendMode();if(a==="additive"?Bi.set(0,0,0,1):a==="alpha-blend"&&Bi.set(0,0,0,0),i.autoClear===!0||o===!0){const c=r.clearColorValue;c.r=Bi.r,c.g=Bi.g,c.b=Bi.b,c.a=Bi.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(c.r*=c.a,c.g*=c.a,c.b*=c.a),r.depthClearValue=i._clearDepth,r.stencilClearValue=i._clearStencil,r.clearColor=i.autoClearColor===!0,r.clearDepth=i.autoClearDepth===!0,r.clearStencil=i.autoClearStencil===!0}else r.clearColor=!1,r.clearDepth=!1,r.clearStencil=!1}}let n$=0;class pg{constructor(e="",t=[],r=0,i=[]){this.name=e,this.bindings=t,this.index=r,this.bindingsReference=i,this.id=n$++}}class r${constructor(e,t,r,i,s,o,a,c,f,p=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=r,this.transforms=p,this.nodeAttributes=i,this.bindings=s,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=c,this.observer=f,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const i=new pg(t.name,[],t.index,t.bindingsReference);e.push(i);for(const s of t.bindings)i.bindings.push(s.clone())}else e.push(t);return e}}class Iv{constructor(e,t,r=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=r}}class i${constructor(e,t,r){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=r}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class Sw{constructor(e,t,r=!1,i=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=r,this.count=i}}class s$ extends Sw{constructor(e,t,r=null,i=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=r,this.interpolationSampling=i}}class o${constructor(e,t,r=""){this.name=e,this.type=t,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}}let a$=0;class fp{constructor(e=null){this.id=a$++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class l${constructor(e,t){this.name=e,this.members=t,this.output=!1}}class Jo{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class u$ extends Jo{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class A$ extends Jo{constructor(e,t=new gt){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class c$ extends Jo{constructor(e,t=new we){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class h$ extends Jo{constructor(e,t=new Vt){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class f$ extends Jo{constructor(e,t=new Gn){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class d$ extends Jo{constructor(e,t=new Nb){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class p$ extends Jo{constructor(e,t=new jA){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class m$ extends Jo{constructor(e,t=new hn){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class g$ extends u${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class _$ extends A${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class y$ extends c${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class v$ extends h${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class x$ extends f${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class b$ extends d${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class T$ extends p${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class w$ extends m${constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let S$=0;const E$=new WeakMap,kv=new WeakMap,N$=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Qc=n=>/e/g.test(n)?String(n).replace(/\+/g,""):(n=Number(n),n+(n%1?"":".0"));class Ew{constructor(e,t,r){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=r,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=F0(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new fp,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:S$++})}isOpaque(){const e=this.material;return e.transparent===!1&&e.blending===js&&e.alphaToCoverage===!1}getBindGroupsCache(){let e=kv.get(this.renderer);return e===void 0&&(e=new Xi,kv.set(this.renderer,e)),e}createRenderTarget(e,t,r){return new Qo(e,t,r)}createCubeRenderTarget(e,t){return new u5(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const r=this.getBindGroupsCache(),i=[];let s=!0;for(const a of t)i.push(a),s=s&&a.groupNode.shared!==!0;let o;return s?(o=r.get(i),o===void 0&&(o=new pg(e,i,this.bindingsIndexes[e].group,i),r.set(i,o))):o=new pg(e,i,this.bindingsIndexes[e].group,i),o}getBindGroupArray(e,t){const r=this.bindings[t];let i=r[e];return i===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),r[e]=i=[]),i}getBindings(){let e=this.bindGroups;if(e===null){const t={},r=this.bindings;for(const i of Ym)for(const s in r[i]){const o=r[i][s];(t[s]||(t[s]=[])).push(...o)}e=[];for(const i in t){const s=t[i],o=this._getBindGroup(i,s);e.push(o)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,r)=>t.bindings[0].groupNode.order-r.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const r=e[t];this.bindingsIndexes[r.name].group=t,r.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==it.NONE&&this.updateNodes.push(e);for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),r=e.getUpdateAfterType();t!==it.NONE&&this.updateBeforeNodes.push(e),r!==it.NONE&&this.updateAfterNodes.push(e)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Hi||e.magFilter===qp||e.magFilter===xA||e.magFilter===Fa||e.minFilter===Hi||e.minFilter===qp||e.minFilter===xA||e.minFilter===Fa}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getTernary(){return null}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}addContext(e){const t=this.getContext();return this.setContext({...this.context,...e}),t}getSharedContext(){const e={...this.context};return delete e.material,delete e.getUV,delete e.getOutput,delete e.getTextureLevel,delete e.getAO,delete e.getShadow,e}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const r=this.getDataFromNode(e);return r.cache===void 0&&(r.cache=new fp(t?this.getCache():null)),r.cache}isAvailable(){return!1}getVertexIndex(){Be("Abstract function.")}getInstanceIndex(){Be("Abstract function.")}getDrawIndex(){Be("Abstract function.")}getFrontFacing(){Be("Abstract function.")}getFragCoord(){Be("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){Be("Abstract function.")}generateTextureLod(){Be("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,r=null){let i=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const o=r?r[s]:null;o!==null?i+=o.build(this,e):i+=this.generateConst(e),s<t-1&&(i+=", ")}return i+=" )",i}generateStruct(e,t,r=null){const i=[];for(const s of t){const{name:o,type:a}=s;r&&r[o]&&r[o].isNode?i.push(r[o].build(this,a)):i.push(this.generateConst(a))}return e+"( "+i.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new Gn:e==="vec2"||e==="uvec2"||e==="ivec2"?t=new gt:e==="vec3"||e==="uvec3"||e==="ivec3"?t=new we:(e==="vec4"||e==="uvec4"||e==="ivec4")&&(t=new Vt)),e==="float")return Qc(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${Qc(t.r)}, ${Qc(t.g)}, ${Qc(t.b)} )`;const r=this.getTypeLength(e),i=this.getComponentType(e),s=o=>this.generateConst(i,o);if(r===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(r===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(r===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(r>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(r>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const r=this.attributes;for(const s of r)if(s.name===e)return s;const i=new Iv(e,t);return this.registerDeclaration(i),r.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===wr)return"int";if(t===Fn)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let r=e8(e);const i=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(r=r.replace("vec","mat")),i+r}getTypeFromArray(e){return N$.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const r=t.array,i=e.itemSize,s=e.normalized;let o;return!(e instanceof Rb)&&s!==!0&&(o=this.getTypeFromArray(r)),this.getTypeFromLength(i,o)}getTypeLength(e){const t=this.getVectorType(e),r=/vec([2-4])/.exec(t);return r!==null?Number(r[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}setActiveStack(e){this.activeStacks.push(e)}removeActiveStack(e){if(this.activeStacks[this.activeStacks.length-1]===e)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=F0(this.stack);const e=E1();return this.stacks.push(e),FA(this.stack),this.stack}removeStack(){const e=this.stack;for(const t of e.nodes){const r=this.getDataFromNode(t);r.stack=e}return this.stack=e.parent,FA(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,r=null){r=r===null?e.isGlobal(this)?this.globalCache:this.cache:r;let i=r.getData(e);i===void 0&&(i={},r.setData(e,i)),i[t]===void 0&&(i[t]={});let s=i[t];const o=i.any?i.any.subBuilds:null,a=this.getClosestSubBuild(o);return a&&(s.subBuildsCache===void 0&&(s.subBuildsCache={}),s=s.subBuildsCache[a]||(s.subBuildsCache[a]={}),s.subBuilds=o),s}getNodeProperties(e,t="any"){const r=this.getDataFromNode(e,t);return r.properties||(r.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const r=this.getDataFromNode(e,"vertex");let i=r.bufferAttribute;if(i===void 0){const s=this.uniforms.index++;i=new Iv("nodeAttribute"+s,t,e),this.bufferAttributes.push(i),r.bufferAttribute=i}return i}getStructTypeNode(e,t=this.shaderStage){return this.types[t][e]||null}getStructTypeFromNode(e,t,r=null,i=this.shaderStage){const s=this.getDataFromNode(e,i,this.globalCache);let o=s.structType;if(o===void 0){const a=this.structs.index++;r===null&&(r="StructType"+a),o=new l$(r,t),this.structs[i].push(o),this.types[i][r]=e,s.structType=o}return o}getOutputStructTypeFromNode(e,t){const r=this.getStructTypeFromNode(e,t,"OutputType","fragment");return r.output=!0,r}getUniformFromNode(e,t,r=this.shaderStage,i=null){const s=this.getDataFromNode(e,r,this.globalCache);let o=s.uniform;if(o===void 0){const a=this.uniforms.index++;o=new i$(i||"nodeUniform"+a,t,e),this.uniforms[r].push(o),this.registerDeclaration(o),s.uniform=o}return o}getVarFromNode(e,t=null,r=e.getNodeType(this),i=this.shaderStage,s=!1){const o=this.getDataFromNode(e,i),a=this.getSubBuildProperty("variable",o.subBuilds);let c=o[a];if(c===void 0){const f=s?"_const":"_var",p=this.vars[i]||(this.vars[i]=[]),g=this.vars[f]||(this.vars[f]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+g,this.vars[f]++),a!=="variable"&&(t=this.getSubBuildProperty(t,o.subBuilds));const v=e.getArrayCount(this);c=new Sw(t,r,s,v),s||p.push(c),this.registerDeclaration(c),o[a]=c}return c}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,r=e.getNodeType(this),i=null,s=null){const o=this.getDataFromNode(e,"any"),a=this.getSubBuildProperty("varying",o.subBuilds);let c=o[a];if(c===void 0){const f=this.varyings,p=f.length;t===null&&(t="nodeVarying"+p),a!=="varying"&&(t=this.getSubBuildProperty(t,o.subBuilds)),c=new s$(t,r,i,s),f.push(c),this.registerDeclaration(c),o[a]=c}return c}registerDeclaration(e){const t=this.shaderStage,r=this.declarations[t]||(this.declarations[t]={}),i=this.getPropertyName(e);let s=1,o=i;for(;r[o]!==void 0;)o=i+"_"+s++;s>1&&(e.name=o,Be(`TSL: Declaration name '${i}' of '${e.type}' already in use. Renamed to '${o}'.`)),r[o]=e}getCodeFromNode(e,t,r=this.shaderStage){const i=this.getDataFromNode(e);let s=i.code;if(s===void 0){const o=this.codes[r]||(this.codes[r]=[]),a=o.length;s=new o$("nodeCode"+a,t),o.push(s),i.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:r,flowCodeBlock:i}=this.getDataFromNode(e);let s=!0,o=t;for(;o;){if(i.get(o)===!0){s=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(s)for(const a of r)this.addLineFlowCode(a)}addLineFlowCodeBlock(e,t,r){const i=this.getDataFromNode(e),s=i.flowCodes||(i.flowCodes=[]),o=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);s.push(t),o.set(r,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),r=this.flowChildNode(e,t);return this.flowsData.set(e,r),r}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new K5,r=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=r,t}flowShaderNode(e){const t=e.layout,r={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of t.inputs)r[o.name]=new P5(o.type,o.name);e.layout=null;const i=e.call(r),s=this.flowStagesNode(i,t.type);return e.layout=t,s}flowBuildStage(e,t,r=null){const i=this.getBuildStage();this.setBuildStage(t);const s=e.build(this,r);return this.setBuildStage(i),s}flowStagesNode(e,t=null){const r=this.flow,i=this.vars,s=this.declarations,o=this.cache,a=this.buildStage,c=this.stack,f={code:""};this.flow=f,this.vars={},this.declarations={},this.cache=new fp,this.stack=F0();for(const p of Qm)this.setBuildStage(p),f.result=e.build(this,t);return f.vars=this.getVars(this.shaderStage),this.flow=r,this.vars=i,this.declarations=s,this.cache=o,this.stack=c,this.setBuildStage(a),f}getFunctionOperator(){return null}buildFunctionCode(){Be("Abstract function.")}flowChildNode(e,t=null){const r=this.flow,i={code:""};return this.flow=i,i.result=e.build(this,t),this.flow=r,i}flowNodeFromShaderStage(e,t,r=null,i=null){const s=this.tab,o=this.cache,a=this.shaderStage,c=this.context;this.setShaderStage(e);const f={...this.context};delete f.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=f;let p=null;if(this.buildStage==="generate"){const g=this.flowChildNode(t,r);i!==null&&(g.code+=`${this.tab+i} = ${g.result};
`),this.flowCode[e]=this.flowCode[e]+g.code,p=g}else p=t.build(this);return this.setShaderStage(a),this.cache=o,this.tab=s,this.context=c,p}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){Be("Abstract function.")}getVaryings(){Be("Abstract function.")}getVar(e,t,r=null){return`${r!==null?this.generateArrayDeclaration(e,r):this.getType(e)} ${t}`}getVars(e){let t="";const r=this.vars[e];if(r!==void 0)for(const i of r)t+=`${this.getVar(i.type,i.name)}; `;return t}getUniforms(){Be("Abstract function.")}getCodes(e){const t=this.codes[e];let r="";if(t!==void 0)for(const i of t)r+=i.code+`
`;return r}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){Be("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(e){this.subBuildLayers.push(e)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(e){let t;if(e&&e.isNode?e.isShaderCallNodeInternal?t=e.shaderNode.subBuilds:e.isStackNode?t=[e.subBuild]:t=this.getDataFromNode(e,"any").subBuilds:e instanceof Set?t=[...e]:t=e,!t)return null;const r=this.subBuildLayers;for(let i=t.length-1;i>=0;i--){const s=t[i];if(r.includes(s))return s}return null}getSubBuildOutput(e){return this.getSubBuildProperty("outputNode",e)}getSubBuildProperty(e="",t=null){let r;t!==null?r=this.getClosestSubBuild(t):r=this.subBuildFn;let i;return r?i=e?r+"_"+e:r:i=e,i}build(){const{object:e,material:t,renderer:r}=this;if(t!==null){let i=r.library.fromMaterial(t);i===null&&(Pe(`NodeMaterial: Material "${t.type}" is not compatible.`),i=new Tn),i.build(this)}else this.addFlow("compute",e);for(const i of Qm){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of Ym){this.setShaderStage(s);const o=this.flowNodes[s];for(const a of o)i==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(e){let t=E$.get(e);return t===void 0&&(t={}),t}getNodeUniform(e,t){const r=this.getSharedDataFromNode(e);let i=r.cache;if(i===void 0){if(t==="float"||t==="int"||t==="uint")i=new g$(e);else if(t==="vec2"||t==="ivec2"||t==="uvec2")i=new _$(e);else if(t==="vec3"||t==="ivec3"||t==="uvec3")i=new y$(e);else if(t==="vec4"||t==="ivec4"||t==="uvec4")i=new v$(e);else if(t==="color")i=new x$(e);else if(t==="mat2")i=new b$(e);else if(t==="mat3")i=new T$(e);else if(t==="mat4")i=new w$(e);else throw new Error(`Uniform "${t}" not implemented.`);r.cache=i}return i}format(e,t,r){if(t=this.getVectorType(t),r=this.getVectorType(r),t===r||r===null||this.isReference(r))return e;const i=this.getTypeLength(t),s=this.getTypeLength(r);return i===16&&s===9?`${this.getType(r)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:i===9&&s===4?`${this.getType(r)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:i>4||s>4||s===0?e:i===s?`${this.getType(r)}( ${e} )`:i>s?(e=r==="bool"?`all( ${e} )`:`${e}.${"xyz".slice(0,s)}`,this.format(e,this.getTypeFromLength(s,this.getComponentType(t)),r)):s===4&&i>1?`${this.getType(r)}( ${this.format(e,t,"vec3")}, 1.0 )`:i===2?`${this.getType(r)}( ${this.format(e,t,"vec2")}, 0.0 )`:(i===1&&s>1&&t!==this.getComponentType(r)&&(e=`${this.getType(this.getComponentType(r))}( ${e} )`),`${this.getType(r)}( ${e} )`)}getSignature(){return`// Three.js r${Jh} - Node System
`}}class Uv{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let r=e.get(t);return r===void 0&&(r={renderId:0,frameId:0},e.set(t,r)),r}updateBeforeNode(e){const t=e.getUpdateBeforeType(),r=e.updateReference(this);if(t===it.FRAME){const i=this._getMaps(this.updateBeforeMap,r);if(i.frameId!==this.frameId){const s=i.frameId;i.frameId=this.frameId,e.updateBefore(this)===!1&&(i.frameId=s)}}else if(t===it.RENDER){const i=this._getMaps(this.updateBeforeMap,r);if(i.renderId!==this.renderId){const s=i.renderId;i.renderId=this.renderId,e.updateBefore(this)===!1&&(i.renderId=s)}}else t===it.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),r=e.updateReference(this);if(t===it.FRAME){const i=this._getMaps(this.updateAfterMap,r);i.frameId!==this.frameId&&e.updateAfter(this)!==!1&&(i.frameId=this.frameId)}else if(t===it.RENDER){const i=this._getMaps(this.updateAfterMap,r);i.renderId!==this.renderId&&e.updateAfter(this)!==!1&&(i.renderId=this.renderId)}else t===it.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),r=e.updateReference(this);if(t===it.FRAME){const i=this._getMaps(this.updateMap,r);i.frameId!==this.frameId&&e.update(this)!==!1&&(i.frameId=this.frameId)}else if(t===it.RENDER){const i=this._getMaps(this.updateMap,r);i.renderId!==this.renderId&&e.update(this)!==!1&&(i.renderId=this.renderId)}else t===it.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class W2{constructor(e,t,r=null,i="",s=!1){this.type=e,this.name=t,this.count=r,this.qualifier=i,this.isConst=s}}W2.isNodeFunctionInput=!0;class R$ extends Ya{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:G2(this.light),lightColor:e}}}const dp=new hn,Yc=new hn;let Gu=null;class C$ extends Ya{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Ge(new we).setGroup(qe),this.halfWidth=Ge(new we).setGroup(qe),this.updateType=it.RENDER}update(e){super.update(e);const{light:t}=this,r=e.camera.matrixWorldInverse;Yc.identity(),dp.copy(t.matrixWorld),dp.premultiply(r),Yc.extractRotation(dp),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Yc),this.halfHeight.value.applyMatrix4(Yc)}setupDirectRectArea(e){let t,r;e.isAvailable("float32Filterable")?(t=Rt(Gu.LTC_FLOAT_1),r=Rt(Gu.LTC_FLOAT_2)):(t=Rt(Gu.LTC_HALF_1),r=Rt(Gu.LTC_HALF_2));const{colorNode:i,light:s}=this,o=q2(s);return{lightColor:i,lightPosition:o,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:r}}static setLTC(e){Gu=e}}class Q2 extends Ya{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Ge(0).setGroup(qe),this.penumbraCosNode=Ge(0).setGroup(qe),this.cutoffDistanceNode=Ge(0).setGroup(qe),this.decayExponentNode=Ge(0).setGroup(qe),this.colorNode=Ge(this.color).setGroup(qe)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:r,penumbraCosNode:i}=this;return Yi(r,i,t)}getLightCoord(e){const t=e.getNodeProperties(this);let r=t.projectionUV;return r===void 0&&(r=tw(this.light,e.context.positionWorld),t.projectionUV=r),r}setupDirect(e){const{colorNode:t,cutoffDistanceNode:r,decayExponentNode:i,light:s}=this,o=this.getLightVector(e),a=o.normalize(),c=a.dot(G2(s)),f=this.getSpotAttenuation(e,c),p=o.length(),g=$2({lightDistance:p,cutoffDistance:r,decayExponent:i});let v=t.mul(f).mul(g),b,T;return s.colorNode?(T=this.getLightCoord(e),b=s.colorNode(T)):s.map&&(T=this.getLightCoord(e),b=Rt(s.map,T.xy).onRenderUpdate(()=>s.map)),b&&(v=T.mul(2).sub(1).abs().lessThan(1).all().select(v.mul(b),v)),{lightColor:v,lightDirection:a}}}class M$ extends Q2{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const r=this.light.iesMap;let i=null;if(r&&r.isTexture===!0){const s=t.acos().mul(1/Math.PI);i=Rt(r,xe(s,0),0).r}else i=super.getSpotAttenuation(t);return i}}const P$=ee(([n,e])=>{const t=n.abs().sub(e);return xs(gn(t,0)).add(Vr(gn(t.x,t.y),0))});class B$ extends Q2{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),t.aspect===null){let r=1;t.map!==null&&(r=t.map.width/t.map.height),t.shadow.aspect=r}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=V(0),r=this.penumbraCosNode,i=Uf(this.light).mul(e.context.positionWorld||bs);return Ve(i.w.greaterThan(0),()=>{const s=i.xyz.div(i.w),o=P$(s.xy.sub(xe(.5)),xe(.5)),a=si(-1,Tt(1,V1(r)).sub(1));t.assign(xf(o.mul(-2).mul(a)))}),t}}class D$ extends Ya{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class L$ extends Ya{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=U2(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Ge(new Gn).setGroup(qe)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:r,lightDirectionNode:i}=this,o=Ko.dot(i).mul(.5).add(.5),a=xt(r,t,o);e.context.irradiance.addAssign(a)}}class F$ extends Ya{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let r=0;r<9;r++)t.push(new we);this.lightProbe=dr(t)}update(e){const{light:t}=this;super.update(e);for(let r=0;r<9;r++)this.lightProbe.array[r].copy(t.sh.coefficients[r]).multiplyScalar(t.intensity)}setup(e){const t=ww(Ko,this.lightProbe);e.context.irradiance.addAssign(t)}}class Nw{parseFunction(){Be("Abstract function.")}}class Y2{constructor(e,t,r="",i=""){this.type=e,this.inputs=t,this.name=r,this.precision=i}getCode(){Be("Abstract function.")}}Y2.isNodeFunction=!0;const O$=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,I$=/[a-z_0-9]+/ig,qv="#pragma main",k$=n=>{n=n.trim();const e=n.indexOf(qv),t=e!==-1?n.slice(e+qv.length):n,r=t.match(O$);if(r!==null&&r.length===5){const i=r[4],s=[];let o=null;for(;(o=I$.exec(i))!==null;)s.push(o);const a=[];let c=0;for(;c<s.length;){const T=s[c][0]==="const";T===!0&&c++;let S=s[c][0];S==="in"||S==="out"||S==="inout"?c++:S="";const N=s[c++][0];let C=Number.parseInt(s[c][0]);Number.isNaN(C)===!1?c++:C=null;const P=s[c++][0];a.push(new W2(N,P,C,S,T))}const f=t.substring(r[0].length),p=r[3]!==void 0?r[3]:"",g=r[2],v=r[1]!==void 0?r[1]:"",b=e!==-1?n.slice(0,e):"";return{type:g,inputs:a,name:p,precision:v,inputsCode:i,blockCode:f,headerCode:b}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class U$ extends Y2{constructor(e){const{type:t,inputs:r,name:i,precision:s,inputsCode:o,blockCode:a,headerCode:c}=k$(e);super(t,r,i,s),this.inputsCode=o,this.blockCode=a,this.headerCode=c}getCode(e=this.name){let t;const r=this.blockCode;if(r!==""){const{type:i,inputsCode:s,headerCode:o,precision:a}=this;let c=`${i} ${e} ( ${s.trim()} )`;a!==""&&(c=`${a} ${c}`),t=o+c+r}else t="";return t}}class q$ extends Nw{parseFunction(e){return new U$(e)}}const Gv=new WeakMap,ss=[],bo=[];class G$ extends Zo{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new Uv,this.nodeBuilderCache=new Map,this.callHashCache=new Xi,this.groupsData=new Xi,this.cacheLib={}}updateGroup(e){const t=e.groupNode,r=t.name;if(r===O1.name)return!0;if(r===qe.name){const s=this.get(e),o=this.nodeFrame.renderId;return s.renderId!==o?(s.renderId=o,!0):!1}if(r===_8.name){const s=this.get(e),o=this.nodeFrame.frameId;return s.frameId!==o?(s.frameId=o,!0):!1}ss[0]=t,ss[1]=e;let i=this.groupsData.get(ss);return i===void 0&&this.groupsData.set(ss,i={}),ss.length=0,i.version!==t.version?(i.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const{nodeBuilderCache:i}=this,s=this.getForRenderCacheKey(e);if(r=i.get(s),r===void 0){const o=c=>{const f=this.backend.createNodeBuilder(e.object,this.renderer);return f.scene=e.scene,f.material=c,f.camera=e.camera,f.context.material=c,f.lightsNode=e.lightsNode,f.environmentNode=this.getEnvironmentNode(e.scene),f.fogNode=this.getFogNode(e.scene),f.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&f.enableMultiview(),f};let a=o(e.material);try{a.build()}catch(c){a=o(new Tn),a.build(),Pe("TSL: "+c)}r=this._createNodeBuilderState(a),i.set(s,r)}r.usedTimes++,t.nodeBuilderState=r}return r}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let r=t.nodeBuilderState;if(r===void 0){const i=this.backend.createNodeBuilder(e,this.renderer);i.build(),r=this._createNodeBuilderState(i),t.nodeBuilderState=r}return r}_createNodeBuilderState(e){return new r$(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const r=this.get(e);r.environmentNode&&(t=r.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const r=this.get(e);r.backgroundNode&&(t=r.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){ss[0]=e,ss[1]=t;const r=this.renderer.info.calls,i=this.callHashCache.get(ss)||{};if(i.callId!==r){const s=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&bo.push(t.getCacheKey(!0)),s&&bo.push(s.getCacheKey()),o&&bo.push(o.getCacheKey()),bo.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),bo.push(this.renderer.shadowMap.enabled?1:0),bo.push(this.renderer.shadowMap.type),i.callId=r,i.cacheKey=cu(bo),this.callHashCache.set(ss,i),bo.length=0}return ss.length=0,i.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),r=e.background;if(r){const i=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==r||i){const s=this.getCacheNode("background",r,()=>{if(r.isCubeTexture===!0||r.mapping===Ug||r.mapping===qg||r.mapping===Up){if(e.backgroundBlurriness>0||r.mapping===Up)return C2(r);{let o;return r.isCubeTexture===!0?o=Cr(r):o=Rt(r),c5(o)}}else{if(r.isTexture===!0)return Rt(r,Xs.flipY()).setUpdateMatrix(!0);r.isColor!==!0&&Pe("WebGPUNodes: Unsupported background configuration.",r)}},i);t.backgroundNode=s,t.background=r,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,r,i=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=s.get(t);return(o===void 0||i)&&(o=r(),s.set(t,o)),o}updateFog(e){const t=this.get(e),r=e.fog;if(r){if(t.fog!==r){const i=this.getCacheNode("fog",r,()=>{if(r.isFogExp2){const s=qt("color","color",r).setGroup(qe),o=qt("density","float",r).setGroup(qe);return qA(s,I2(o))}else if(r.isFog){const s=qt("color","color",r).setGroup(qe),o=qt("near","float",r).setGroup(qe),a=qt("far","float",r).setGroup(qe);return qA(s,O2(o,a))}else Pe("Renderer: Unsupported fog configuration.",r)});t.fogNode=i,t.fog=r}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),r=e.environment;if(r){if(t.environment!==r){const i=this.getCacheNode("environment",r,()=>{if(r.isCubeTexture===!0)return Cr(r);if(r.isTexture===!0)return Rt(r);Pe("Nodes: Unsupported environment configuration.",r)});t.environmentNode=i,t.environment=r}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,r=null,i=null,s=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=r,o.camera=i,o.material=s,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return Gv.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,r=this.getOutputCacheKey(),i=e.isArrayTexture?Of(e,X(Xs,uo("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):Rt(e,Xs).renderOutput(t.toneMapping,t.currentColorSpace);return Gv.set(e,r),i}updateBefore(e){const t=e.getNodeBuilderState();for(const r of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(r)}updateAfter(e){const t=e.getNodeBuilderState();for(const r of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(r)}updateForCompute(e){const t=this.getNodeFrame(),r=this.getForCompute(e);for(const i of r.updateNodes)t.updateNode(i)}updateForRender(e){const t=this.getNodeFrameForRender(e),r=e.getNodeBuilderState();for(const i of r.updateNodes)t.updateNode(i)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new Uv,this.nodeBuilderCache=new Map,this.cacheLib={}}}const pp=new zg;class jh{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new jA,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,r){const i=e.length;for(let s=0;s<i;s++){pp.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=t[r+s],a=pp.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=pp.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let r=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const i=t.clippingPlanes,s=i.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=e.intersectionPlanes.length):(o=this.unionPlanes,a=e.unionPlanes.length),o.length!==a+s){o.length=a+s;for(let c=0;c<s;c++)o[a+c]=new Vt;r=!0}this.projectPlanes(i,o,a),r&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new jh(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class V${constructor(e,t){this.bundleGroup=e,this.camera=t}}const Vu=[];class z${constructor(){this.bundles=new Xi}get(e,t){const r=this.bundles;Vu[0]=e,Vu[1]=t;let i=r.get(Vu);return i===void 0&&(i=new V$(e,t),r.set(Vu,i)),Vu.length=0,i}dispose(){this.bundles=new Xi}}class Rw{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const r=this.getMaterialNodeClass(e.type);if(r!==null){t=new r;for(const i in e)t[i]=e[i]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,r){if(r.has(t)){Be(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);r.set(t,e)}addClass(e,t,r){if(r.has(t)){Be(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);r.set(t,e)}}const $$=new V2,zu=[];class j$ extends Xi{constructor(){super()}createNode(e=[]){return new V2().setLights(e)}getNode(e,t){if(e.isQuadMesh)return $$;zu[0]=e,zu[1]=t;let r=this.get(zu);return r===void 0&&(r=this.createNode(),this.set(zu,r)),zu.length=0,r}}class rA extends Qo{constructor(e=1,t=1,r={}){super(e,t,r),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(e){return super.copy(e),this._hasExternalTextures=e._hasExternalTextures,this._autoAllocateDepthBuffer=e._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=e._isOpaqueFramebuffer,this}}const Vv=new we,zv=new we;class H$ extends Zh{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new yA,this._cameraL.viewport=new Vt,this._cameraR=new yA,this._cameraR.viewport=new Vt,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new gN,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=Z$.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new gt,this._onSessionEvent=Y$.bind(this),this._onSessionEnd=X$.bind(this),this._onInputSourcesChange=K$.bind(this),this._onAnimationFrame=J$.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&Be("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&Be("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,r,i,s,o,a,c={}){const f=new _N(e,t),p=new rA(s,o,{format:Gi,type:ni,depthTexture:new $i(s,o,c.stencil?Io:Fn,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?ko:Uo),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p._autoAllocateDepthBuffer=!0;const g=new cs({color:16777215,side:iA});g.map=p.texture,g.map.offset.y=1,g.map.repeat.y=-1;const v=new pn(f,g);v.position.copy(r),v.quaternion.copy(i);const b={type:"quad",width:e,height:t,translation:r,quaternion:i,pixelwidth:s,pixelheight:o,plane:v,material:g,rendercall:a,renderTarget:p};if(this._layers.push(b),this._session!==null){b.plane.material=new cs({color:16777215,side:iA}),b.plane.material.blending=sA,b.plane.material.blendEquation=qs,b.plane.material.blendSrc=No,b.plane.material.blendDst=No,b.xrlayer=this._createXRLayer(b);const T=this._session.renderState.layers;T.unshift(b.xrlayer),this._session.updateRenderState({layers:T})}else p.isXRRenderTarget=!1;return v}createCylinderLayer(e,t,r,i,s,o,a,c,f={}){const p=new Wx(e,e,e*t/r,64,64,!0,Math.PI-t/2,t),g=new rA(o,a,{format:Gi,type:ni,depthTexture:new $i(o,a,f.stencil?Io:Fn,void 0,void 0,void 0,void 0,void 0,void 0,f.stencil?ko:Uo),stencilBuffer:f.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});g._autoAllocateDepthBuffer=!0;const v=new cs({color:16777215,side:mr});v.map=g.texture,v.map.offset.y=1,v.map.repeat.y=-1;const b=new pn(p,v);b.position.copy(i),b.quaternion.copy(s);const T={type:"cylinder",radius:e,centralAngle:t,aspectratio:r,translation:i,quaternion:s,pixelwidth:o,pixelheight:a,plane:b,material:v,rendercall:c,renderTarget:g};if(this._layers.push(T),this._session!==null){T.plane.material=new cs({color:16777215,side:mr}),T.plane.material.blending=sA,T.plane.material.blendEquation=qs,T.plane.material.blendSrc=No,T.plane.material.blendDst=No,T.xrlayer=this._createXRLayer(T);const S=this._session.renderState.layers;S.unshift(T.xrlayer),this._session.updateRenderState({layers:S})}else g.isXRRenderTarget=!1;return b}renderLayers(){const e=new we,t=new Hl,r=this._renderer,i=this.isPresenting,s=r.getOutputRenderTarget(),o=r._frameBufferTarget;this.isPresenting=!1;const a=new gt;r.getSize(a);const c=r._quad;for(const f of this._layers)if(f.renderTarget.isXRRenderTarget=this._session!==null,f.renderTarget._hasExternalTextures=f.renderTarget.isXRRenderTarget,f.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){f.xrlayer.transform=new XRRigidTransform(f.plane.getWorldPosition(e),f.plane.getWorldQuaternion(t));const p=this._glBinding.getSubImage(f.xrlayer,this._xrFrame);r.backend.setXRRenderTargetTextures(f.renderTarget,p.colorTexture,void 0),r._setXRLayerSize(f.renderTarget.width,f.renderTarget.height),r.setOutputRenderTarget(f.renderTarget),r.setRenderTarget(null),r._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:g,quad:v}=this._frameBufferTargets.get(f.renderTarget)||{frameBufferTarget:null,quad:null};g?(r._frameBufferTarget=g,r._quad=v):(r._quad=new Lf(new Tn),this._frameBufferTargets.set(f.renderTarget,{frameBufferTarget:r._getFrameBufferTarget(),quad:r._quad})),f.rendercall(),r._frameBufferTarget=null}else r.setRenderTarget(f.renderTarget),f.rendercall();r.setRenderTarget(null),r.setOutputRenderTarget(s),r._frameBufferTarget=o,r._setXRLayerSize(a.x,a.y),r._quad=c,this.isPresenting=i}getSession(){return this._session}async setSession(e){const t=this._renderer,r=t.backend;this._gl=t.getContext();const i=this._gl,s=i.getContextAttributes();if(this._session=e,e!==null){if(r.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await r.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._supportsLayers===!0){let o=null,a=null,c=null;t.depth&&(c=t.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,o=t.stencil?ko:Uo,a=t.stencil?Io:Fn);const f={colorFormat:i.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(f.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const p=this._glBinding.createProjectionLayer(f),g=[p];this._glProjLayer=p,t.setPixelRatio(1),t._setXRLayerSize(p.textureWidth,p.textureHeight);const v=this._useMultiview?2:1,b=new $i(p.textureWidth,p.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,o,v);if(this._xrRenderTarget=new rA(p.textureWidth,p.textureHeight,{format:Gi,type:ni,colorSpace:t.outputColorSpace,depthTexture:b,stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const T of this._layers)T.plane.material=new cs({color:16777215,side:T.type==="cylinder"?mr:iA}),T.plane.material.blending=sA,T.plane.material.blendEquation=qs,T.plane.material.blendSrc=No,T.plane.material.blendDst=No,T.xrlayer=this._createXRLayer(T),g.unshift(T.xrlayer);e.updateRenderState({layers:g})}else{const o={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},a=new XRWebGLLayer(e,i,o);this._glBaseLayer=a,e.updateRenderState({baseLayer:a}),t.setPixelRatio(1),t._setXRLayerSize(a.framebufferWidth,a.framebufferHeight),this._xrRenderTarget=new rA(a.framebufferWidth,a.framebufferHeight,{format:Gi,type:ni,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:a.ignoreDepthValues===!1,resolveStencilBuffer:a.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const r=e.near,i=e.far,s=this._cameraXR,o=this._cameraL,a=this._cameraR;s.near=a.near=o.near=r,s.far=a.far=o.far=i,s.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),s.layers.mask=e.layers.mask|6,o.layers.mask=s.layers.mask&3,a.layers.mask=s.layers.mask&5;const c=e.parent,f=s.cameras;$v(s,c);for(let p=0;p<f.length;p++)$v(f[p],c);f.length===2?W$(s,o,a):s.projectionMatrix.copy(o.projectionMatrix),Q$(e,s,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new yN,this._controllers[e]=t),t}}function W$(n,e,t){Vv.setFromMatrixPosition(e.matrixWorld),zv.setFromMatrixPosition(t.matrixWorld);const r=Vv.distanceTo(zv),i=e.projectionMatrix.elements,s=t.projectionMatrix.elements,o=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],f=(i[9]-1)/i[5],p=(i[8]-1)/i[0],g=(s[8]+1)/s[0],v=o*p,b=o*g,T=r/(-p+g),S=T*-p;if(e.matrixWorld.decompose(n.position,n.quaternion,n.scale),n.translateX(S),n.translateZ(T),n.matrixWorld.compose(n.position,n.quaternion,n.scale),n.matrixWorldInverse.copy(n.matrixWorld).invert(),i[10]===-1)n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const N=o+T,C=a+T,P=v-S,B=b+(r-S),F=c*a/C*N,q=f*a/C*N;n.projectionMatrix.makePerspective(P,B,F,q,N,C),n.projectionMatrixInverse.copy(n.projectionMatrix).invert()}}function $v(n,e){e===null?n.matrixWorld.copy(n.matrix):n.matrixWorld.multiplyMatrices(e.matrixWorld,n.matrix),n.matrixWorldInverse.copy(n.matrixWorld).invert()}function Q$(n,e,t){t===null?n.matrix.copy(e.matrixWorld):(n.matrix.copy(t.matrixWorld),n.matrix.invert(),n.matrix.multiply(e.matrixWorld)),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),n.projectionMatrix.copy(e.projectionMatrix),n.projectionMatrixInverse.copy(e.projectionMatrixInverse),n.isPerspectiveCamera&&(n.fov=ON*2*Math.atan(1/n.projectionMatrix.elements[5]),n.zoom=1)}function Y$(n){const e=this._controllerInputSources.indexOf(n.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const r=this.getReferenceSpace();t.update(n.inputSource,n.frame,r),t.dispatchEvent({type:n.type,data:n.inputSource})}}function X$(){const n=this._session,e=this._renderer;n.removeEventListener("select",this._onSessionEvent),n.removeEventListener("selectstart",this._onSessionEvent),n.removeEventListener("selectend",this._onSessionEvent),n.removeEventListener("squeeze",this._onSessionEvent),n.removeEventListener("squeezestart",this._onSessionEvent),n.removeEventListener("squeezeend",this._onSessionEvent),n.removeEventListener("end",this._onSessionEnd),n.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const r=this._controllerInputSources[t];r!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(r))}if(this._currentDepthNear=null,this._currentDepthFar=null,e._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const t of this._layers)t.renderTarget=new rA(t.pixelwidth,t.pixelheight,{format:Gi,type:ni,depthTexture:new $i(t.pixelwidth,t.pixelheight,t.stencilBuffer?Io:Fn,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?ko:Uo),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,t.material.map.offset.y=1,t.material.map.repeat.y=-1,delete t.xrlayer;this.isPresenting=!1,this._useMultiview=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function K$(n){const e=this._controllers,t=this._controllerInputSources;for(let r=0;r<n.removed.length;r++){const i=n.removed[r],s=t.indexOf(i);s>=0&&(t[s]=null,e[s].disconnect(i))}for(let r=0;r<n.added.length;r++){const i=n.added[r];let s=t.indexOf(i);if(s===-1){for(let a=0;a<e.length;a++)if(a>=t.length){t.push(i),s=a;break}else if(t[a]===null){t[a]=i,s=a;break}if(s===-1)break}const o=e[s];o&&o.connect(i)}}function Z$(n){return n.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(n.translation,n.quaternion),width:n.width/2,height:n.height/2,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(n.translation,n.quaternion),radius:n.radius,centralAngle:n.centralAngle,aspectRatio:n.aspectRatio,space:this._referenceSpace,viewPixelWidth:n.pixelwidth,viewPixelHeight:n.pixelheight,clearOnAccess:!1})}function J$(n,e){if(e===void 0)return;const t=this._cameraXR,r=this._renderer,i=r.backend,s=this._glBaseLayer,o=this.getReferenceSpace(),a=e.getViewerPose(o);if(this._xrFrame=e,a!==null){const c=a.views;this._glBaseLayer!==null&&i.setXRTarget(s.framebuffer);let f=!1;c.length!==t.cameras.length&&(t.cameras.length=0,f=!0);for(let p=0;p<c.length;p++){const g=c[p];let v;if(this._supportsLayers===!0){const T=this._glBinding.getViewSubImage(this._glProjLayer,g);v=T.viewport,p===0&&i.setXRRenderTargetTextures(this._xrRenderTarget,T.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:T.depthStencilTexture)}else v=s.getViewport(g);let b=this._cameras[p];b===void 0&&(b=new yA,b.layers.enable(p),b.viewport=new Vt,this._cameras[p]=b),b.matrix.fromArray(g.transform.matrix),b.matrix.decompose(b.position,b.quaternion,b.scale),b.projectionMatrix.fromArray(g.projectionMatrix),b.projectionMatrixInverse.copy(b.projectionMatrix).invert(),b.viewport.set(v.x,v.y,v.width,v.height),p===0&&(t.matrix.copy(b.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),f===!0&&t.cameras.push(b)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const f=this._controllerInputSources[c],p=this._controllers[c];f!==null&&p!==void 0&&p.update(f,e,o)}this._currentAnimationLoop&&this._currentAnimationLoop(n,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}class ej extends Zh{constructor(e){super(),this.domElement=e,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Vt(0,0,this._width,this._height),this._scissor=new Vt(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new Ig,this.depthTexture=new $i}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=r,this.domElement.width=Math.floor(e*r),this.domElement.height=Math.floor(t*r),this.setViewport(0,0,e,t),this._dispatchResize())}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),r===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._dispatchResize())}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,r,i){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,r,i)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,r,i,s=0,o=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,r,i),a.minDepth=s,a.maxDepth=o}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const jv=new Kh,vl=new gt,mp=new Vt,gp=new $x,_p=new oN,Xc=new hn,Is=new Vt;class tj{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:r=!1,alpha:i=!0,depth:s=!0,stencil:o=!1,antialias:a=!1,samples:c=0,getFallback:f=null,outputBufferType:p=rr,multiview:g=!1}=t;this.backend=e,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=r,this.outputColorSpace=$A,this.toneMapping=Ea,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=o,this.info=new $k,this.contextNode=lo(),this.library=new Rw,this.lighting=new j$,this._samples=c||a===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new ej(e.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new OT,this._inspector.setRenderer(this),this._getFallback=f,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Lf(new Tn),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const v=this.alpha===!0?0:1;this._clearColor=new M2(0,0,0,v),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=p,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:sN},this.xr=new H$(this,g),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(b,T,S)=>{await this.compileAsync(b,T);const N=this._renderLists.get(b,T),C=this._renderContexts.get(b,T,this._renderTarget,this._mrt),P=b.overrideMaterial||S.material,B=this._objects.get(S,P,b,T,N.lightsNode,C,C.clippingContext),{fragmentShader:F,vertexShader:q}=B.getNodeBuilderState();return{fragmentShader:F,vertexShader:q}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let r=this.backend;try{await r.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=r=this._getFallback(i),await r.init(this)}catch(s){t(s);return}else{t(i);return}}this._nodes=new G$(this,r),this._animation=new Fk(this,this._nodes,this.info),this._attributes=new Vk(r),this._background=new t$(this,this._nodes),this._geometries=new zk(this._attributes,this.info),this._textures=new sU(this,r,this.info),this._pipelines=new Qk(r,this._nodes),this._bindings=new Yk(r,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Uk(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new Zk(this.lighting),this._bundles=new z$,this._renderContexts=new rU,this._animation.start(),this._initialized=!0,this._inspector.init(),e(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,r=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,s=i.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,c=this._compilationPromises,f=e.isScene===!0?e:jv;r===null&&(r=e);const p=this._renderTarget,g=this._renderContexts.get(r,t,p,this._mrt),v=this._activeMipmapLevel,b=[];this._currentRenderContext=g,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=b,i.renderId++,i.update(),g.depth=this.depth,g.stencil=this.stencil,g.clippingContext||(g.clippingContext=new jh),g.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,p);const T=this._renderLists.get(e,t);if(T.begin(),this._projectObject(e,t,0,T,g.clippingContext),r!==e&&r.traverseVisible(function(B){B.isLight&&B.layers.test(t.layers)&&T.pushLight(B)}),T.finish(),p!==null){this._textures.updateRenderTarget(p,v);const B=this._textures.get(p);g.textures=B.textures,g.depthTexture=B.depthTexture}else g.textures=null,g.depthTexture=null;this._background.update(f,T,g);const S=T.opaque,N=T.transparent,C=T.transparentDoublePass,P=T.lightsNode;this.opaque===!0&&S.length>0&&this._renderObjects(S,t,f,P),this.transparent===!0&&N.length>0&&this._renderTransparents(N,C,t,f,P),i.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(b)}async renderAsync(e,t){cn('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(e,t)}async waitForGPU(){Pe("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(e){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=e,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(e){const t=this.contextNode.value;e===!0?(t.modelViewMatrix=tg,t.modelNormalViewMatrix=ng):this.highPrecision&&(delete t.modelViewMatrix,delete t.modelNormalViewMatrix)}get highPrecision(){const e=this.contextNode.value;return e.modelViewMatrix===tg&&e.modelNormalViewMatrix===ng}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return cn('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),Pe(t),this._isDeviceLost=!0}_renderBundle(e,t,r){const{bundleGroup:i,camera:s,renderList:o}=e,a=this._currentRenderContext,c=this._bundles.get(i,s),f=this.backend.get(c);f.renderContexts===void 0&&(f.renderContexts=new Set);const p=i.version!==f.version,g=f.renderContexts.has(a)===!1||p;if(f.renderContexts.add(a),g){this.backend.beginBundle(a),(f.renderObjects===void 0||p)&&(f.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:v,transparent:b,opaque:T}=o;this.opaque===!0&&T.length>0&&this._renderObjects(T,s,t,r),this.transparent===!0&&b.length>0&&this._renderTransparents(b,v,s,t,r),this._currentRenderBundle=null,this.backend.finishBundle(a,c),f.version=i.version}else{const{renderObjects:v}=f;for(let b=0,T=v.length;b<T;b++){const S=v[b];this._nodes.needsRefresh(S)&&(this._nodes.updateBefore(S),this._nodes.updateForRender(S),this._bindings.updateForRender(S),this._nodes.updateAfter(S))}}this.backend.addBundle(a,c)}render(e,t){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(e,t)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this,r=e!==Ea,i=t!==xn.workingColorSpace;if(r===!1&&i===!1)return null;const{width:s,height:o}=this.getDrawingBufferSize(vl),{depth:a,stencil:c}=this;let f=this._frameBufferTarget;f===null&&(f=new Qo(s,o,{depthBuffer:a,stencilBuffer:c,type:this._outputBufferType,format:Gi,colorSpace:xn.workingColorSpace,generateMipmaps:!1,minFilter:Hi,magFilter:Hi,samples:this.samples}),f.isPostProcessingRenderTarget=!0,this._frameBufferTarget=f);const p=this.getOutputRenderTarget();f.depthBuffer=a,f.stencilBuffer=c,p!==null?f.setSize(p.width,p.height,p.depth):f.setSize(s,o,1);const g=this._canvasTarget;return f.viewport.copy(g._viewport),f.scissor.copy(g._scissor),f.viewport.multiplyScalar(g._pixelRatio),f.scissor.multiplyScalar(g._pixelRatio),f.scissorTest=g._scissorTest,f.multiview=p!==null?p.multiview:!1,f.resolveDepthBuffer=p!==null?p.resolveDepthBuffer:!0,f._autoAllocateDepthBuffer=p!==null?p._autoAllocateDepthBuffer:!1,f}_renderScene(e,t,r=!0){if(this._isDeviceLost===!0)return;const i=r?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,o=s.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,f=e.isScene===!0?e:jv,p=this._renderTarget||this._outputRenderTarget,g=this._activeCubeFace,v=this._activeMipmapLevel;let b;i!==null?(b=i,this.setRenderTarget(b)):b=p;const T=this._renderContexts.get(e,t,b,this._mrt);this._currentRenderContext=T,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls,this.backend.updateTimeStampUID(T),this.inspector.beginRender(this.backend.getTimestampUID(T),e,t,b);const S=this.coordinateSystem,N=this.xr;if(t.coordinateSystem!==S&&N.isPresenting===!1&&(t.coordinateSystem=S,t.updateProjectionMatrix(),t.isArrayCamera))for(const oe of t.cameras)oe.coordinateSystem=S,oe.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),N.enabled===!0&&N.isPresenting===!0&&(N.cameraAutoUpdate===!0&&N.updateCamera(t),t=N.getCamera());const C=this._canvasTarget;let P=C._viewport,B=C._scissor,F=C._pixelRatio;b!==null&&(P=b.viewport,B=b.scissor,F=1),this.getDrawingBufferSize(vl),mp.set(0,0,vl.width,vl.height);const q=P.minDepth===void 0?0:P.minDepth,I=P.maxDepth===void 0?1:P.maxDepth;T.viewportValue.copy(P).multiplyScalar(F).floor(),T.viewportValue.width>>=v,T.viewportValue.height>>=v,T.viewportValue.minDepth=q,T.viewportValue.maxDepth=I,T.viewport=T.viewportValue.equals(mp)===!1,T.scissorValue.copy(B).multiplyScalar(F).floor(),T.scissor=C._scissorTest&&T.scissorValue.equals(mp)===!1,T.scissorValue.width>>=v,T.scissorValue.height>>=v,T.clippingContext||(T.clippingContext=new jh),T.clippingContext.updateGlobal(f,t),f.onBeforeRender(this,e,t,b);const U=t.isArrayCamera?_p:gp;t.isArrayCamera||(Xc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(Xc,t.coordinateSystem,t.reversedDepth));const G=this._renderLists.get(e,t);if(G.begin(),this._projectObject(e,t,0,G,T.clippingContext),G.finish(),this.sortObjects===!0&&G.sort(this._opaqueSort,this._transparentSort),b!==null){this._textures.updateRenderTarget(b,v);const oe=this._textures.get(b);T.textures=oe.textures,T.depthTexture=oe.depthTexture,T.width=oe.width,T.height=oe.height,T.renderTarget=b,T.depth=b.depthBuffer,T.stencil=b.stencilBuffer}else T.textures=null,T.depthTexture=null,T.width=vl.width,T.height=vl.height,T.depth=this.depth,T.stencil=this.stencil;T.width>>=v,T.height>>=v,T.activeCubeFace=g,T.activeMipmapLevel=v,T.occlusionQueryCount=G.occlusionQueryCount,T.scissorValue.max(Is.set(0,0,0,0)),T.scissorValue.x+T.scissorValue.width>T.width&&(T.scissorValue.width=Math.max(T.width-T.scissorValue.x,0)),T.scissorValue.y+T.scissorValue.height>T.height&&(T.scissorValue.height=Math.max(T.height-T.scissorValue.y,0)),this._background.update(f,G,T),T.camera=t,this.backend.beginRender(T);const{bundles:H,lightsNode:te,transparentDoublePass:W,transparent:Z,opaque:re}=G;return H.length>0&&this._renderBundles(H,f,te),this.opaque===!0&&re.length>0&&this._renderObjects(re,t,f,te),this.transparent===!0&&Z.length>0&&this._renderTransparents(Z,W,t,f,te),this.backend.finishRender(T),s.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=c,i!==null&&(this.setRenderTarget(p,g,v),this._renderOutput(b)),f.onAfterRender(this,e,t,b),this.inspector.finishRender(this.backend.getTimestampUID(T)),T}_setXRLayerSize(e,t){this._canvasTarget._width=e,this._canvasTarget._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const r=this.autoClear,i=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=r,this.xr.enabled=i}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(e){return this._canvasTarget.getDrawingBufferSize(e)}getSize(e){return this._canvasTarget.getSize(e)}setPixelRatio(e=1){this._canvasTarget.setPixelRatio(e)}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(e,t,r)}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(e,t,r)}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){return this._canvasTarget.getScissor(e)}setScissor(e,t,r,i){this._canvasTarget.setScissor(e,t,r,i)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(e){this._canvasTarget.setScissorTest(e),this.backend.setScissorTest(e)}getViewport(e){return this._canvasTarget.getViewport(e)}setViewport(e,t,r,i,s=0,o=1){this._canvasTarget.setViewport(e,t,r,i,s,o)}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,r=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const i=this._renderTarget||this._getFrameBufferTarget();let s=null;if(i!==null){this._textures.updateRenderTarget(i);const o=this._textures.get(i);s=this._renderContexts.getForClear(i),s.textures=o.textures,s.depthTexture=o.depthTexture,s.width=o.width,s.height=o.height,s.renderTarget=i,s.depth=i.depthBuffer,s.stencil=i.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,r,s),i!==null&&this._renderTarget===null&&this._renderOutput(i)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,r=!0){cn('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(e,t,r)}async clearColorAsync(){cn('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){cn('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){cn('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const e=this.currentToneMapping!==Ea,t=this.currentColorSpace!==xn.workingColorSpace;return e||t}get samples(){return this._samples}get currentSamples(){let e=this._samples;return this._renderTarget!==null?e=this._renderTarget.samples:this.needsFrameBufferTarget&&(e=0),e}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Ea}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:xn.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,r=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=r}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(e){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=e,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e,t=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return Be("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e,t);const r=this._nodes.nodeFrame,i=r.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,r.renderId=this.info.calls,this.backend.updateTimeStampUID(e),this.inspector.beginCompute(this.backend.getTimestampUID(e),e);const s=this.backend,o=this._pipelines,a=this._bindings,c=this._nodes,f=Array.isArray(e)?e:[e];if(f[0]===void 0||f[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");s.beginCompute(e);for(const p of f){if(o.has(p)===!1){const b=()=>{p.removeEventListener("dispose",b),o.delete(p),a.deleteForCompute(p),c.delete(p)};p.addEventListener("dispose",b);const T=p.onInitFunction;T!==null&&T.call(p,{renderer:this})}c.updateForCompute(p),a.updateForCompute(p);const g=a.getForCompute(p),v=o.getForCompute(p,g);s.compute(e,p,g,v,t)}s.finishCompute(e),r.renderId=i,this.inspector.finishCompute(this.backend.getTimestampUID(e))}async computeAsync(e,t=null){this._initialized===!1&&await this.init(),this.compute(e,t)}async hasFeatureAsync(e){return cn('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){cn('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(e)}initTexture(e){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=Is.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=Is.copy(t).floor();else{Pe("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=Is.set(0,0,e.image.width,e.image.height);let r=this._currentRenderContext,i;r!==null?i=r.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),r=this._textures.get(i))),this._textures.updateTexture(e,{renderTarget:i}),this.backend.copyFramebufferToTexture(e,r,t),this._inspector.copyFramebufferToTexture(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,r,i,s,o),this._inspector.copyTextureToTexture(e,t)}async readRenderTargetPixelsAsync(e,t,r,i,s,o=0,a=0){return this.backend.copyTextureToBuffer(e.textures[o],t,r,i,s,a)}_projectObject(e,t,r,i,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)r=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)i.pushLight(e);else if(e.isSprite){const c=t.isArrayCamera?_p:gp;if(!e.frustumCulled||c.intersectsSprite(e,t)){this.sortObjects===!0&&Is.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Xc);const{geometry:f,material:p}=e;p.visible&&i.push(e,f,p,r,Is.z,null,s)}}else if(e.isLineLoop)Pe("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const c=t.isArrayCamera?_p:gp;if(!e.frustumCulled||c.intersectsObject(e,t)){const{geometry:f,material:p}=e;if(this.sortObjects===!0&&(f.boundingSphere===null&&f.computeBoundingSphere(),Is.copy(f.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(Xc)),Array.isArray(p)){const g=f.groups;for(let v=0,b=g.length;v<b;v++){const T=g[v],S=p[T.materialIndex];S&&S.visible&&i.push(e,f,S,r,Is.z,T,s)}}else p.visible&&i.push(e,f,p,r,Is.z,null,s)}}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=i;i=this._renderLists.get(e,t),i.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:i}),i.finish()}const a=e.children;for(let c=0,f=a.length;c<f;c++)this._projectObject(a[c],t,r,i,s)}_renderBundles(e,t,r){for(const i of e)this._renderBundle(i,t,r)}_renderTransparents(e,t,r,i,s){if(t.length>0){for(const{material:o}of t)o.side=mr;this._renderObjects(t,r,i,s,"backSide");for(const{material:o}of t)o.side=iA;this._renderObjects(e,r,i,s);for(const{material:o}of t)o.side=vi}else this._renderObjects(e,r,i,s)}_renderObjects(e,t,r,i,s=null){for(let o=0,a=e.length;o<a;o++){const{object:c,geometry:f,material:p,group:g,clippingContext:v}=e[o];this._currentRenderObjectFunction(c,r,t,f,p,g,i,v,s)}}_getShadowNodes(e){const t=e.version;let r=this._cacheShadowNodes.get(e);if(r===void 0||r.version!==t){const i=e.map!==null,s=e.colorNode&&e.colorNode.isNode,o=e.castShadowNode&&e.castShadowNode.isNode;let a=null,c=null,f=null;if(i||s||o){let p,g;o?(p=e.castShadowNode.rgb,g=e.castShadowNode.a):(p=X(0),g=V(1)),i&&(g=g.mul(qt("map","texture",e).a)),s&&(g=g.mul(e.colorNode.a)),c=ze(p,g)}e.depthNode&&e.depthNode.isNode&&(f=e.depthNode),e.castShadowPositionNode&&e.castShadowPositionNode.isNode?a=e.castShadowPositionNode:e.positionNode&&e.positionNode.isNode&&(a=e.positionNode),r={version:t,colorNode:c,depthNode:f,positionNode:a},this._cacheShadowNodes.set(e,r)}return r}renderObject(e,t,r,i,s,o,a,c=null,f=null){let p=!1,g,v,b,T;if(e.onBeforeRender(this,t,r,i,s,o),s.allowOverride===!0&&t.overrideMaterial!==null){const S=t.overrideMaterial;if(p=!0,g=t.overrideMaterial.colorNode,v=t.overrideMaterial.depthNode,b=t.overrideMaterial.positionNode,T=t.overrideMaterial.side,s.positionNode&&s.positionNode.isNode&&(S.positionNode=s.positionNode),S.alphaTest=s.alphaTest,S.alphaMap=s.alphaMap,S.transparent=s.transparent||s.transmission>0||s.transmissionNode&&s.transmissionNode.isNode||s.backdropNode&&s.backdropNode.isNode,S.isShadowPassMaterial){const{colorNode:N,depthNode:C,positionNode:P}=this._getShadowNodes(s);S.side=s.shadowSide===null?s.side:s.shadowSide,N!==null&&(S.colorNode=N),C!==null&&(S.depthNode=C),P!==null&&(S.positionNode=P)}s=S}s.transparent===!0&&s.side===vi&&s.forceSinglePass===!1?(s.side=mr,this._handleObjectFunction(e,s,t,r,a,o,c,"backSide"),s.side=iA,this._handleObjectFunction(e,s,t,r,a,o,c,f),s.side=vi):this._handleObjectFunction(e,s,t,r,a,o,c,f),p&&(t.overrideMaterial.colorNode=g,t.overrideMaterial.depthNode=v,t.overrideMaterial.positionNode=b,t.overrideMaterial.side=T),e.onAfterRender(this,t,r,i,s,o)}_renderObjectDirect(e,t,r,i,s,o,a,c){const f=this._objects.get(e,t,r,i,s,this._currentRenderContext,a,c);f.drawRange=e.geometry.drawRange,f.group=o;const p=this._nodes.needsRefresh(f);p&&(this._nodes.updateBefore(f),this._geometries.updateForRender(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f)),this._pipelines.updateForRender(f),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(f),f.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(f,this.info),p&&this._nodes.updateAfter(f)}_createObjectPipeline(e,t,r,i,s,o,a,c){const f=this._objects.get(e,t,r,i,s,this._currentRenderContext,a,c);f.drawRange=e.geometry.drawRange,f.group=o,this._nodes.updateBefore(f),this._geometries.updateForRender(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f),this._pipelines.getForRender(f,this._compilationPromises),this._nodes.updateAfter(f)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class Cw{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function nj(n){return n+(Lo-n%Lo)%Lo}class Mw extends Cw{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return nj(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class Pw extends Mw{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let rj=0;class Bw extends Pw{constructor(e,t){super("UniformBuffer_"+rj++,e?e.value:null),this.nodeUniform=e,this.groupNode=t,this.isNodeUniformBuffer=!0}set updateRanges(e){this.nodeUniform.updateRanges=e}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(e,t){this.nodeUniform.addUpdateRange(e,t)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class ij extends Pw{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let r=0,i=this.uniforms.length;r<i;r++){const s=this.uniforms[r],o=s.boundary,a=s.itemSize*e,c=t%Lo,f=c%o,p=c+f;t+=f,p!==0&&Lo-p<a&&(t+=Lo-p),s.offset=t/e,t+=a}return Math.ceil(t/Lo)*Lo}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);Pe("WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s]!==i){const a=this._getBufferForType(o);a[s]=r[s]=i,t=!0}return t}updateVector2(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,t=!0}return t}updateVector3(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,a[s+2]=r[s+2]=i.z,t=!0}return t}updateVector4(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset,o=e.getType();if(r[s+0]!==i.x||r[s+1]!==i.y||r[s+2]!==i.z||r[s+4]!==i.w){const a=this._getBufferForType(o);a[s+0]=r[s+0]=i.x,a[s+1]=r[s+1]=i.y,a[s+2]=r[s+2]=i.z,a[s+3]=r[s+3]=i.w,t=!0}return t}updateColor(e){let t=!1;const r=this.values,i=e.getValue(),s=e.offset;if(r[s+0]!==i.r||r[s+1]!==i.g||r[s+2]!==i.b){const o=this.buffer;o[s+0]=r[s+0]=i.r,o[s+1]=r[s+1]=i.g,o[s+2]=r[s+2]=i.b,t=!0}return t}updateMatrix3(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;if(r[s+0]!==i[0]||r[s+1]!==i[1]||r[s+2]!==i[2]||r[s+4]!==i[3]||r[s+5]!==i[4]||r[s+6]!==i[5]||r[s+8]!==i[6]||r[s+9]!==i[7]||r[s+10]!==i[8]){const o=this.buffer;o[s+0]=r[s+0]=i[0],o[s+1]=r[s+1]=i[1],o[s+2]=r[s+2]=i[2],o[s+4]=r[s+4]=i[3],o[s+5]=r[s+5]=i[4],o[s+6]=r[s+6]=i[5],o[s+8]=r[s+8]=i[6],o[s+9]=r[s+9]=i[7],o[s+10]=r[s+10]=i[8],t=!0}return t}updateMatrix4(e){let t=!1;const r=this.values,i=e.getValue().elements,s=e.offset;return oj(r,i,s)===!1&&(this.buffer.set(i,s),sj(r,i,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function sj(n,e,t){for(let r=0,i=e.length;r<i;r++)n[t+r]=e[r]}function oj(n,e,t){for(let r=0,i=e.length;r<i;r++)if(n[t+r]!==e[r])return!1;return!0}let aj=0;class Dw extends ij{constructor(e,t){super(e),this.id=aj++,this.groupNode=t,this.isNodeUniformsGroup=!0}}class Lw extends Cw{constructor(e,t){super(e),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=t,this.version=t?t.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(e){this._texture!==e&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=e,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}clone(){const e=super.clone();return e._texture=null,e._onTextureDispose=()=>{e.generation=null,e.version=0},e.texture=this.texture,e}}let lj=0;class uj extends Lw{constructor(e,t){super(e,t),this.id=lj++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class Vf extends uj{constructor(e,t,r,i=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r,this.access=i}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Fw extends Vf{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledCubeTexture=!0}}class mg extends Vf{constructor(e,t,r,i=null){super(e,t,r,i),this.isSampledTexture3D=!0}}const Hv={bitcast_int_uint:new Yn("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new Yn("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},Aj={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},cj={low:"lowp",medium:"mediump",high:"highp"},Wv={swizzleAssign:!0,storageBuffer:!1},Qv={perspective:"smooth",linear:"noperspective"},Yv={centroid:"centroid"},Xv=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
precision lowp sampler2DArrayShadow;
precision lowp samplerCubeShadow;
`;class hj extends Ew{constructor(e,t){super(e,t,new q$),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Wl}_include(e){const t=Hv[e];return t.build(this),this.addInclude(t),t}getMethod(e){return Hv[e]!==void 0&&this._include(e),Aj[e]||e}getBitcastMethod(e,t){return this.getMethod(`bitcast_${t}_${e}`)}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,r){return`${e} ? ${t} : ${r}`}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(this.getType(o.type)+" "+o.name);return`${this.getType(t.type)} ${t.name}( ${i.join(", ")} ) {

	${r.vars}

${r.code}
	return ${r.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const r=t.array,i=t.count*t.itemSize,{itemSize:s}=t,o=t.array.constructor.name.toLowerCase().includes("int");let a=o?Hg:jg;s===2?a=o?Wg:zs:s===3?a=o?iR:$g:s===4&&(a=o?Qg:Gi);const c={Float32Array:mi,Uint8Array:ni,Uint16Array:Rl,Uint32Array:Fn,Int8Array:oA,Int16Array:aA,Int32Array:wr,Uint8ClampedArray:ni},f=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/s))));let p=Math.ceil(i/s/f);f*p*s<i&&p++;const g=f*p*s,v=new r.constructor(g);v.set(r,0),t.array=v;const b=new wb(t.array,f,p,a,c[t.array.constructor.name]||mi);b.needsUpdate=!0,b.isPBOTexture=!0;const T=new Es(b,null,null);T.setPrecision("high"),t.pboNode=T,t.pbo=T.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:r}=e,i=t.value;if(this.renderer.backend.has(i)){const p=this.renderer.backend.get(i);p.pbo=i.pbo}const s=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.nodeName),o=this.getPropertyName(s);this.increaseUsage(r);const a=r.build(this,"uint"),c=this.getDataFromNode(e);let f=c.propertyName;if(f===void 0){const p=this.getVarFromNode(e);f=this.getPropertyName(p);const g=this.getDataFromNode(t);let v=g.propertySizeName;v===void 0&&(v=f+"Size",this.getVarFromNode(t,v,"uint"),this.addLineFlowCode(`${v} = uint( textureSize( ${o}, 0 ).x )`,e),g.propertySizeName=v);const{itemSize:b}=i,T="."+ja.join("").slice(0,b),S=`ivec2(${a} % ${v}, ${a} / ${v})`,N=this.generateTextureLoad(null,o,S,"0",null,null);let C="vec4";i.pbo.type===Fn?C="uvec4":i.pbo.type===wr&&(C="ivec4"),this.addLineFlowCode(`${f} = ${C}(${N})${T}`,e),c.propertyName=f}return f}generateTextureLoad(e,t,r,i,s,o){i===null&&(i="0");let a;return s?o?a=`texelFetchOffset( ${t}, ivec3( ${r}, ${s} ), ${i}, ${o} )`:a=`texelFetch( ${t}, ivec3( ${r}, ${s} ), ${i} )`:o?a=`texelFetchOffset( ${t}, ${r}, ${i}, ${o} )`:a=`texelFetch( ${t}, ${r}, ${i} )`,e!==null&&e.isDepthTexture&&(a+=".x"),a}generateTexture(e,t,r,i,s){return i&&(r=`vec3( ${r}, ${i} )`),e.isDepthTexture?s?`textureOffset( ${t}, ${r}, ${s} ).x`:`texture( ${t}, ${r} ).x`:s?`textureOffset( ${t}, ${r}, ${s} )`:`texture( ${t}, ${r} )`}generateTextureLevel(e,t,r,i,s){return s?`textureLodOffset( ${t}, ${r}, ${i}, ${s} )`:`textureLod( ${t}, ${r}, ${i} )`}generateTextureBias(e,t,r,i,s){return s?`textureOffset( ${t}, ${r}, ${s}, ${i} )`:`texture( ${t}, ${r}, ${i} )`}generateTextureGrad(e,t,r,i,s){return s?`textureGradOffset( ${t}, ${r}, ${i[0]}, ${i[1]}, ${s} )`:`textureGrad( ${t}, ${r}, ${i[0]}, ${i[1]} )`}generateTextureCompare(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return e.isCubeTexture?`texture( ${t}, vec4( ${r}, ${i} ) )`:s?o?`textureOffset( ${t}, vec4( ${r}, ${s}, ${i} ), ${o} )`:`texture( ${t}, vec4( ${r}, ${s}, ${i} ) )`:o?`textureOffset( ${t}, vec3( ${r}, ${i} ), ${o} )`:`texture( ${t}, vec3( ${r}, ${i} ) )`;Pe(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`${this.getVar(i.type,i.name,i.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],r=[],i={};for(const o of t){let a=null,c=!1;if(o.type==="texture"||o.type==="texture3D"){const p=o.node.value;let g="";(p.isDataTexture===!0||p.isData3DTexture===!0)&&(p.type===Fn?g="u":p.type===wr&&(g="i")),o.type==="texture3D"&&p.isArrayTexture===!1?a=`${g}sampler3D ${o.name};`:p.compareFunction?p.isArrayTexture===!0?a=`sampler2DArrayShadow ${o.name};`:a=`sampler2DShadow ${o.name};`:p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0?a=`${g}sampler2DArray ${o.name};`:a=`${g}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="cubeDepthTexture")a=`samplerCubeShadow ${o.name};`;else if(o.type==="buffer"){const p=o.node,g=this.getType(p.bufferType),v=p.bufferCount,b=v>0?v:"";a=`${p.name} {
	${g} ${o.name}[${b}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,c=!0;const f=o.node.precision;if(f!==null&&(a=cj[f]+" "+a),c){a="	"+a;const p=o.groupNode.name;(i[p]||(i[p]=[])).push(a)}else a="uniform "+a,r.push(a)}let s="";for(const o in i){const a=i[o];s+=this._getGLSLUniformStruct(e+"_"+o,a.join(`
`))+`
`}return s+=r.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==wr){let r=e;e.isInterleavedBufferAttribute&&(r=e.data);const i=r.array;i instanceof Uint32Array||i instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const r=this.getAttributesArray();let i=0;for(const s of r)t+=`layout( location = ${i++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const r of e.members)t.push(`	${r.type} ${r.name};`);return t.join(`
`)}getStructs(e){const t=[],r=this.structs[e],i=[];for(const s of r)if(s.output)for(const o of s.members)i.push(`layout( location = ${o.index} ) out ${o.type} ${o.name};`);else{let o="struct "+s.name+` {
`;o+=this.getStructMembers(s),o+=`
};
`,t.push(o)}return i.length===0&&i.push("layout( location = 0 ) out vec4 fragColor;"),`
`+i.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const r=this.varyings;if(e==="vertex"||e==="compute")for(const i of r){e==="compute"&&(i.needsInterpolation=!0);const s=this.getType(i.type);if(i.needsInterpolation)if(i.interpolationType){const o=Qv[i.interpolationType]||i.interpolationType,a=Yv[i.interpolationSampling]||"";t+=`${o} ${a} out ${s} ${i.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}out ${s} ${i.name};
`}else t+=`${s} ${i.name};
`}else if(e==="fragment"){for(const i of r)if(i.needsInterpolation){const s=this.getType(i.type);if(i.interpolationType){const o=Qv[i.interpolationType]||i.interpolationType,a=Yv[i.interpolationSampling]||"";t+=`${o} ${a} in ${s} ${i.name};
`}else{const o=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${o}in ${s} ${i.name};
`}}}for(const i of this.builtins[e])t+=`${i};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((r,i)=>r*i,1)}u`}getSubgroupSize(){Pe("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){Pe("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){Pe("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,r=this.shaderStage){const i=this.extensions[r]||(this.extensions[r]=new Map);i.has(e)===!1&&i.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const r=this.extensions[e];if(r!==void 0)for(const{name:i,behavior:s}of r.values())t.push(`#extension ${i} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=Wv[e];if(t===void 0){let r;switch(t=!1,e){case"float32Filterable":r="OES_texture_float_linear";break;case"clipDistance":r="WEBGL_clip_cull_distance";break}if(r!==void 0){const i=this.renderer.backend.extensions;i.has(r)&&(i.get(r),t=!0)}Wv[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let r=0;r<e.length;r++){const i=e[r],s=this.getPropertyName(i.attributeNode);s&&(t+=`${i.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${Xv}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${Xv}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let r=`// code

`;r+=this.flowCode[t];const i=this.flowNodes[t],s=i[i.length-1];for(const a of i){const c=this.getFlowData(a),f=a.name;f&&(r.length>0&&(r+=`
`),r+=`	// flow -> ${f}
	`),r+=`${c.code}
	`,a===s&&t!=="compute"&&(r+=`// result
	`,t==="vertex"?(r+="gl_Position = ",r+=`${c.result};`):t==="fragment"&&(a.outputNode.isOutputStructNode||(r+="fragColor = ",r+=`${c.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=r}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),o=this.getDataFromNode(e,r,this.globalCache);let a=o.uniformGPU;if(a===void 0){const c=e.groupNode,f=c.name,p=this.getBindGroupArray(f,r);if(t==="texture")a=new Vf(s.name,s.node,c),p.push(a);else if(t==="cubeTexture"||t==="cubeDepthTexture")a=new Fw(s.name,s.node,c),p.push(a);else if(t==="texture3D")a=new mg(s.name,s.node,c),p.push(a);else if(t==="buffer"){s.name=`buffer${e.id}`;const g=this.getSharedDataFromNode(e);let v=g.buffer;v===void 0&&(e.name=`NodeBuffer_${e.id}`,v=new Bw(e,c),v.name=e.name,g.buffer=v),p.push(v),a=v}else{const g=this.uniformGroups[r]||(this.uniformGroups[r]={});let v=g[f];v===void 0&&(v=new Dw(r+"_"+f,c),g[f]=v,p.push(v)),a=this.getNodeUniform(s,t),v.addUniform(a)}o.uniformGPU=a}return s}}let yp=null,xl=null;class Ow{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[ds.RENDER]:null,[ds.COMPUTE]:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(e){const t=this.get(e),r=this.renderer.info.frame;let i;e.isComputeNode===!0?i="c:"+this.renderer.info.compute.frameCalls:i="r:"+this.renderer.info.render.frameCalls,t.timestampUID=i+":"+e.id+":f"+r}getTimestampUID(e){return this.get(e).timestampUID}getTimestampFrames(e){const t=this.timestampQueryPool[e];return t?t.getTimestampFrames():[]}_getQueryPool(e){const t=e.startsWith("c:")?ds.COMPUTE:ds.RENDER;return this.timestampQueryPool[t]}getTimestamp(e){return this._getQueryPool(e).getTimestamp(e)}hasTimestamp(e){return this._getQueryPool(e).hasTimestamp(e)}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){cn("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t)return;const r=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=r,r}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return yp=yp||new gt,this.renderer.getDrawingBufferSize(yp)}setScissorTest(){}getClearColor(){const e=this.renderer;return xl=xl||new M2,e.getClearColor(xl),xl.getRGB(xl),xl}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:vN(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Jh} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}deleteBindGroupData(){}dispose(){}}let fj=0;class dj{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class pj{constructor(e){this.backend=e}createAttribute(e,t){const r=this.backend,{gl:i}=r,s=e.array,o=e.usage||i.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,c=r.get(a);let f=c.bufferGPU;f===void 0&&(f=this._createBuffer(i,t,s,o),c.bufferGPU=f,c.bufferType=t,c.version=a.version);let p;if(s instanceof Float32Array)p=i.FLOAT;else if(typeof Float16Array<"u"&&s instanceof Float16Array)p=i.HALF_FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?p=i.HALF_FLOAT:p=i.UNSIGNED_SHORT;else if(s instanceof Int16Array)p=i.SHORT;else if(s instanceof Uint32Array)p=i.UNSIGNED_INT;else if(s instanceof Int32Array)p=i.INT;else if(s instanceof Int8Array)p=i.BYTE;else if(s instanceof Uint8Array)p=i.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)p=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let g={bufferGPU:f,bufferType:t,type:p,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:p===i.INT||p===i.UNSIGNED_INT||e.gpuType===wr,id:fj++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const v=this._createBuffer(i,t,s,o);g=new dj(g,v)}r.set(e,g)}updateAttribute(e){const t=this.backend,{gl:r}=t,i=e.array,s=e.isInterleavedBufferAttribute?e.data:e,o=t.get(s),a=o.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(r.bindBuffer(a,o.bufferGPU),c.length===0)r.bufferSubData(a,0,i);else{for(let f=0,p=c.length;f<p;f++){const g=c[f];r.bufferSubData(a,g.start*i.BYTES_PER_ELEMENT,i,g.start,g.count)}s.clearUpdateRanges()}r.bindBuffer(a,null),o.version=s.version}destroyAttribute(e){const t=this.backend,{gl:r}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const i=t.get(e);r.deleteBuffer(i.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:r}=t,i=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(i),o=e.array,a=o.byteLength;r.bindBuffer(r.COPY_READ_BUFFER,s);const c=r.createBuffer();r.bindBuffer(r.COPY_WRITE_BUFFER,c),r.bufferData(r.COPY_WRITE_BUFFER,a,r.STREAM_READ),r.copyBufferSubData(r.COPY_READ_BUFFER,r.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const f=new e.array.constructor(o.length);return r.bindBuffer(r.COPY_WRITE_BUFFER,c),r.getBufferSubData(r.COPY_WRITE_BUFFER,0,f),r.deleteBuffer(c),r.bindBuffer(r.COPY_READ_BUFFER,null),r.bindBuffer(r.COPY_WRITE_BUFFER,null),f.buffer}_createBuffer(e,t,r,i){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,r,i),e.bindBuffer(t,null),s}}let vp,$u;class mj{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;vp={[qs]:e.FUNC_ADD,[rb]:e.FUNC_SUBTRACT,[nb]:e.FUNC_REVERSE_SUBTRACT},$u={[No]:e.ZERO,[fb]:e.ONE,[hb]:e.SRC_COLOR,[cb]:e.SRC_ALPHA,[Ab]:e.SRC_ALPHA_SATURATE,[ub]:e.DST_COLOR,[lb]:e.DST_ALPHA,[ab]:e.ONE_MINUS_SRC_COLOR,[ob]:e.ONE_MINUS_SRC_ALPHA,[sb]:e.ONE_MINUS_DST_COLOR,[ib]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),r=e.getParameter(e.VIEWPORT);this.currentScissor=new Vt().fromArray(t),this.currentViewport=new Vt().fromArray(r),this._tempVec4=new Vt}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==bN?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===TN?t.cullFace(t.BACK):e===wN?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:r}=this;e!==t&&(r.lineWidth(e),this.currentLineWidth=e)}setMRTBlending(e){const t=this.gl,r=this.backend.drawBuffersIndexedExt;if(r)for(let i=1;i<e.length;i++)r.blendFuncSeparateiOES(i,t.ONE,t.ZERO,t.ONE,t.ZERO)}setBlending(e,t,r,i,s,o,a,c){const{gl:f}=this;if(e===Ql){this.currentBlendingEnabled===!0&&(this.disable(f.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(f.BLEND),this.currentBlendingEnabled=!0),e!==sA){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==qs||this.currentBlendEquationAlpha!==qs)&&(f.blendEquation(f.FUNC_ADD),this.currentBlendEquation=qs,this.currentBlendEquationAlpha=qs),c)switch(e){case js:f.blendFuncSeparate(f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case $0:f.blendFunc(f.ONE,f.ONE);break;case z0:f.blendFuncSeparate(f.ZERO,f.ONE_MINUS_SRC_COLOR,f.ZERO,f.ONE);break;case V0:f.blendFuncSeparate(f.DST_COLOR,f.ONE_MINUS_SRC_ALPHA,f.ZERO,f.ONE);break;default:Pe("WebGLState: Invalid blending: ",e);break}else switch(e){case js:f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);break;case $0:f.blendFuncSeparate(f.SRC_ALPHA,f.ONE,f.ONE,f.ONE);break;case z0:Pe("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case V0:Pe("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Pe("WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}s=s||t,o=o||r,a=a||i,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(f.blendEquationSeparate(vp[t],vp[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(r!==this.currentBlendSrc||i!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(f.blendFuncSeparate($u[r],$u[i],$u[o],$u[a]),this.currentBlendSrc=r,this.currentBlendDst=i,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case xb:t.depthFunc(t.NEVER);break;case vb:t.depthFunc(t.ALWAYS);break;case yb:t.depthFunc(t.LESS);break;case _b:t.depthFunc(t.LEQUAL);break;case gb:t.depthFunc(t.EQUAL);break;case mb:t.depthFunc(t.GEQUAL);break;case pb:t.depthFunc(t.GREATER);break;case db:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentScissor.equals(s)===!1){const{gl:o}=this;o.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,r,i){const s=this._tempVec4.set(e,t,r,i);if(this.currentViewport.equals(s)===!1){const{gl:o}=this;o.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?this.enable(t.SCISSOR_TEST):this.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,r){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==r)&&(this.gl.stencilFunc(e,t,r),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=r)}setStencilOp(e,t,r){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==r)&&(this.gl.stencilOp(e,t,r),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=r)}setMaterial(e,t,r){const{gl:i}=this;e.side===vi?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let s=e.side===mr;t&&(s=!s),this.setFlipSided(s),e.blending===js&&e.transparent===!1?this.setBlending(Ql):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),r>0&&this.currentClippingPlanes!==r)for(let c=0;c<8;c++)c<r?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,r){const{gl:i}=this;e?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==r)&&(i.polygonOffset(t,r),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=r)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const r=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(r.bindVertexArray(e),t!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:r,currentBoundFramebuffers:i}=this;return i[e]!==t?(r.bindFramebuffer(e,t),i[e]=t,e===r.DRAW_FRAMEBUFFER&&(i[r.FRAMEBUFFER]=t),e===r.FRAMEBUFFER&&(i[r.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:r}=this;let i=[],s=!1;if(e.textures!==null){i=this.currentDrawbuffers.get(t),i===void 0&&(i=[],this.currentDrawbuffers.set(t,i));const o=e.textures;if(i.length!==o.length||i[0]!==r.COLOR_ATTACHMENT0){for(let a=0,c=o.length;a<c;a++)i[a]=r.COLOR_ATTACHMENT0+a;i.length=o.length,s=!0}}else i[0]!==r.BACK&&(i[0]=r.BACK,s=!0);s&&r.drawBuffers(i)}activeTexture(e){const{gl:t,currentTextureSlot:r,maxTextures:i}=this;e===void 0&&(e=t.TEXTURE0+i-1),r!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,r){const{gl:i,currentTextureSlot:s,currentBoundTextures:o,maxTextures:a}=this;r===void 0&&(s===null?r=i.TEXTURE0+a-1:r=s);let c=o[r];c===void 0&&(c={type:void 0,texture:void 0},o[r]=c),(c.type!==e||c.texture!==t)&&(s!==r&&(i.activeTexture(r),this.currentTextureSlot=r),i.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,r){const{gl:i}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==r?(i.bindBufferBase(e,t,r),this.currentBoundBufferBases[s]=r,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:r}=this,i=r[t];i!==void 0&&i.type!==void 0&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class gj{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Wl){const{gl:r,extensions:i}=this;let s;const o=xn.getTransfer(t);if(e===ni)return r.UNSIGNED_BYTE;if(e===SN)return r.UNSIGNED_SHORT_4_4_4_4;if(e===EN)return r.UNSIGNED_SHORT_5_5_5_1;if(e===bb)return r.UNSIGNED_INT_5_9_9_9_REV;if(e===Tb)return r.UNSIGNED_INT_10F_11F_11F_REV;if(e===oA)return r.BYTE;if(e===aA)return r.SHORT;if(e===Rl)return r.UNSIGNED_SHORT;if(e===wr)return r.INT;if(e===Fn)return r.UNSIGNED_INT;if(e===mi)return r.FLOAT;if(e===rr)return r.HALF_FLOAT;if(e===NN)return r.ALPHA;if(e===$g)return r.RGB;if(e===Gi)return r.RGBA;if(e===Uo)return r.DEPTH_COMPONENT;if(e===ko)return r.DEPTH_STENCIL;if(e===jg)return r.RED;if(e===Hg)return r.RED_INTEGER;if(e===zs)return r.RG;if(e===Wg)return r.RG_INTEGER;if(e===Qg)return r.RGBA_INTEGER;if(e===m0||e===g0||e===_0||e===y0)if(o===ht)if(s=i.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===m0)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===g0)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===_0)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===y0)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=i.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===m0)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===g0)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===_0)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===y0)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===cy||e===hy||e===fy||e===dy)if(s=i.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===cy)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===hy)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===fy)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===dy)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===Gp||e===Vp||e===zp||e===$p||e===jp||e===j0||e===Hp)if(s=i.get("WEBGL_compressed_texture_etc"),s!==null){if(e===Gp||e===Vp)return o===ht?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===zp)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(e===$p)return s.COMPRESSED_R11_EAC;if(e===jp)return s.COMPRESSED_SIGNED_R11_EAC;if(e===j0)return s.COMPRESSED_RG11_EAC;if(e===Hp)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(e===Wp||e===Qp||e===Yp||e===Xp||e===Kp||e===Zp||e===Jp||e===em||e===tm||e===nm||e===rm||e===im||e===sm||e===om)if(s=i.get("WEBGL_compressed_texture_astc"),s!==null){if(e===Wp)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Qp)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Yp)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Xp)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Kp)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Zp)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Jp)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===em)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===tm)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===nm)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===rm)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===im)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===sm)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===om)return o===ht?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===am)if(s=i.get("EXT_texture_compression_bptc"),s!==null){if(e===am)return o===ht?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===lm||e===um||e===H0||e===Am)if(s=i.get("EXT_texture_compression_rgtc"),s!==null){if(e===lm)return s.COMPRESSED_RED_RGTC1_EXT;if(e===um)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===H0)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Am)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Io?r.UNSIGNED_INT_24_8:r[e]!==void 0?r[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((r,i)=>{function s(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED){e.deleteSync(t),i();return}if(o===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),r()}s()})}}let Kv=!1,Kc,xp,Zv;class _j{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,Kv===!1&&(this._init(),Kv=!0)}_init(){const e=this.gl;Kc={[tf]:e.REPEAT,[vA]:e.CLAMP_TO_EDGE,[ef]:e.MIRRORED_REPEAT},xp={[ki]:e.NEAREST,[Qx]:e.NEAREST_MIPMAP_NEAREST,[xA]:e.NEAREST_MIPMAP_LINEAR,[Hi]:e.LINEAR,[qp]:e.LINEAR_MIPMAP_NEAREST,[Fa]:e.LINEAR_MIPMAP_LINEAR},Zv={[tb]:e.NEVER,[eb]:e.ALWAYS,[nf]:e.LESS,[Jx]:e.LEQUAL,[Zx]:e.EQUAL,[Kx]:e.GEQUAL,[Xx]:e.GREATER,[Yx]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let r;return e.isCubeTexture===!0?r=t.TEXTURE_CUBE_MAP:e.isArrayTexture===!0||e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?r=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?r=t.TEXTURE_3D:r=t.TEXTURE_2D,r}getInternalFormat(e,t,r,i,s=!1){const{gl:o,extensions:a}=this;if(e!==null){if(o[e]!==void 0)return o[e];Be("WebGLBackend: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;if(t===o.RED&&(r===o.FLOAT&&(c=o.R32F),r===o.HALF_FLOAT&&(c=o.R16F),r===o.UNSIGNED_BYTE&&(c=o.R8),r===o.UNSIGNED_SHORT&&(c=o.R16),r===o.UNSIGNED_INT&&(c=o.R32UI),r===o.BYTE&&(c=o.R8I),r===o.SHORT&&(c=o.R16I),r===o.INT&&(c=o.R32I)),t===o.RED_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.R8UI),r===o.UNSIGNED_SHORT&&(c=o.R16UI),r===o.UNSIGNED_INT&&(c=o.R32UI),r===o.BYTE&&(c=o.R8I),r===o.SHORT&&(c=o.R16I),r===o.INT&&(c=o.R32I)),t===o.RG&&(r===o.FLOAT&&(c=o.RG32F),r===o.HALF_FLOAT&&(c=o.RG16F),r===o.UNSIGNED_BYTE&&(c=o.RG8),r===o.UNSIGNED_SHORT&&(c=o.RG16),r===o.UNSIGNED_INT&&(c=o.RG32UI),r===o.BYTE&&(c=o.RG8I),r===o.SHORT&&(c=o.RG16I),r===o.INT&&(c=o.RG32I)),t===o.RG_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RG8UI),r===o.UNSIGNED_SHORT&&(c=o.RG16UI),r===o.UNSIGNED_INT&&(c=o.RG32UI),r===o.BYTE&&(c=o.RG8I),r===o.SHORT&&(c=o.RG16I),r===o.INT&&(c=o.RG32I)),t===o.RGB){const f=s?Ay:xn.getTransfer(i);r===o.FLOAT&&(c=o.RGB32F),r===o.HALF_FLOAT&&(c=o.RGB16F),r===o.UNSIGNED_BYTE&&(c=o.RGB8),r===o.UNSIGNED_SHORT&&(c=o.RGB16),r===o.UNSIGNED_INT&&(c=o.RGB32UI),r===o.BYTE&&(c=o.RGB8I),r===o.SHORT&&(c=o.RGB16I),r===o.INT&&(c=o.RGB32I),r===o.UNSIGNED_BYTE&&(c=f===ht?o.SRGB8:o.RGB8),r===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),r===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),r===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),r===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5),r===o.UNSIGNED_INT_10F_11F_11F_REV&&(c=o.R11F_G11F_B10F)}if(t===o.RGB_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RGB8UI),r===o.UNSIGNED_SHORT&&(c=o.RGB16UI),r===o.UNSIGNED_INT&&(c=o.RGB32UI),r===o.BYTE&&(c=o.RGB8I),r===o.SHORT&&(c=o.RGB16I),r===o.INT&&(c=o.RGB32I)),t===o.RGBA){const f=s?Ay:xn.getTransfer(i);r===o.FLOAT&&(c=o.RGBA32F),r===o.HALF_FLOAT&&(c=o.RGBA16F),r===o.UNSIGNED_BYTE&&(c=o.RGBA8),r===o.UNSIGNED_SHORT&&(c=o.RGBA16),r===o.UNSIGNED_INT&&(c=o.RGBA32UI),r===o.BYTE&&(c=o.RGBA8I),r===o.SHORT&&(c=o.RGBA16I),r===o.INT&&(c=o.RGBA32I),r===o.UNSIGNED_BYTE&&(c=f===ht?o.SRGB8_ALPHA8:o.RGBA8),r===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),r===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(r===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),r===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),r===o.UNSIGNED_INT&&(c=o.RGBA32UI),r===o.BYTE&&(c=o.RGBA8I),r===o.SHORT&&(c=o.RGBA16I),r===o.INT&&(c=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(r===o.UNSIGNED_SHORT&&(c=o.DEPTH_COMPONENT16),r===o.UNSIGNED_INT&&(c=o.DEPTH_COMPONENT24),r===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&r===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&a.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:r,extensions:i,backend:s}=this,o=xn.getPrimaries(xn.workingColorSpace),a=t.colorSpace===Wl?null:xn.getPrimaries(t.colorSpace),c=t.colorSpace===Wl||o===a?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,t.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,c),r.texParameteri(e,r.TEXTURE_WRAP_S,Kc[t.wrapS]),r.texParameteri(e,r.TEXTURE_WRAP_T,Kc[t.wrapT]),(e===r.TEXTURE_3D||e===r.TEXTURE_2D_ARRAY)&&(t.isArrayTexture||r.texParameteri(e,r.TEXTURE_WRAP_R,Kc[t.wrapR])),r.texParameteri(e,r.TEXTURE_MAG_FILTER,xp[t.magFilter]);const f=t.mipmaps!==void 0&&t.mipmaps.length>0,p=t.minFilter===Hi&&f?Fa:t.minFilter;if(r.texParameteri(e,r.TEXTURE_MIN_FILTER,xp[p]),t.compareFunction&&(r.texParameteri(e,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(e,r.TEXTURE_COMPARE_FUNC,Zv[t.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===ki||t.minFilter!==xA&&t.minFilter!==Fa||t.type===mi&&i.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const g=i.get("EXT_texture_filter_anisotropic");r.texParameterf(e,g.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:r,defaultTextures:i}=this,s=this.getGLTextureType(e);let o=i[s];o===void 0&&(o=t.createTexture(),r.state.bindTexture(s,o),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),i[s]=o),r.set(e,{textureGPU:o,glTextureType:s})}createTexture(e,t){const{gl:r,backend:i}=this,{levels:s,width:o,height:a,depth:c}=t,f=i.utils.convert(e.format,e.colorSpace),p=i.utils.convert(e.type),g=this.getInternalFormat(e.internalFormat,f,p,e.colorSpace,e.isVideoTexture),v=r.createTexture(),b=this.getGLTextureType(e);i.state.bindTexture(b,v),this.setTextureParameters(b,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?r.texStorage3D(r.TEXTURE_2D_ARRAY,s,g,o,a,c):e.isData3DTexture?r.texStorage3D(r.TEXTURE_3D,s,g,o,a,c):e.isVideoTexture||r.texStorage2D(b,s,g,o,a),i.set(e,{textureGPU:v,glTextureType:b,glFormat:f,glType:p,glInternalFormat:g})}copyBufferToTexture(e,t){const{gl:r,backend:i}=this,{textureGPU:s,glTextureType:o,glFormat:a,glType:c}=i.get(t),{width:f,height:p}=t.source.data;r.bindBuffer(r.PIXEL_UNPACK_BUFFER,e),i.state.bindTexture(o,s),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texSubImage2D(o,0,0,0,f,p,a,c,0),r.bindBuffer(r.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(e,t){const{gl:r}=this,{width:i,height:s}=t,{textureGPU:o,glTextureType:a,glFormat:c,glType:f,glInternalFormat:p}=this.backend.get(e);if(!(e.isRenderTargetTexture||o===void 0))if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,e),e.isCompressedTexture){const g=e.mipmaps,v=t.image;for(let b=0;b<g.length;b++){const T=g[b];e.isCompressedArrayTexture?e.format!==r.RGBA?c!==null?r.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,b,0,0,0,T.width,T.height,v.depth,c,T.data):Be("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texSubImage3D(r.TEXTURE_2D_ARRAY,b,0,0,0,T.width,T.height,v.depth,c,f,T.data):c!==null?r.compressedTexSubImage2D(r.TEXTURE_2D,b,0,0,T.width,T.height,c,T.data):Be("WebGLBackend: Unsupported compressed texture format")}}else if(e.isCubeTexture){const g=t.images,v=e.mipmaps;for(let b=0;b<6;b++){const T=Zc(g[b]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+b,0,0,0,i,s,c,f,T);for(let S=0;S<v.length;S++){const N=v[S],C=Zc(N.images[b]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+b,S+1,0,0,C.width,C.height,c,f,C)}}}else if(e.isDataArrayTexture||e.isArrayTexture){const g=t.image;if(e.layerUpdates.size>0){const v=xN(g.width,g.height,e.format,e.type);for(const b of e.layerUpdates){const T=g.data.subarray(b*v/g.data.BYTES_PER_ELEMENT,(b+1)*v/g.data.BYTES_PER_ELEMENT);r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,b,g.width,g.height,1,c,f,T)}e.clearLayerUpdates()}else r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,g.width,g.height,g.depth,c,f,g.data)}else if(e.isData3DTexture){const g=t.image;r.texSubImage3D(r.TEXTURE_3D,0,0,0,0,g.width,g.height,g.depth,c,f,g.data)}else if(e.isVideoTexture)e.update(),r.texImage2D(a,0,p,c,f,t.image);else{const g=e.mipmaps;if(g.length>0)for(let v=0,b=g.length;v<b;v++){const T=g[v],S=Zc(T);r.texSubImage2D(a,v,0,0,T.width,T.height,c,f,S)}else{const v=Zc(t.image);r.texSubImage2D(a,0,0,0,i,s,c,f,v)}}}generateMipmaps(e){const{gl:t,backend:r}=this,{textureGPU:i,glTextureType:s}=r.get(e);r.state.bindTexture(s,i),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:r}=this;if(e){const i=r.get(e);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const s in i.framebuffers)t.deleteFramebuffer(i.framebuffers[s]);delete i.framebuffers}if(i.depthRenderbuffer&&(t.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(t.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(t.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let s=0;s<i.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(i.msaaRenderbuffers[s]);delete i.msaaRenderbuffers}}}destroyTexture(e,t=!1){const{gl:r,backend:i}=this,{textureGPU:s,renderTarget:o}=i.get(e);this.deallocateRenderBuffers(o),t===!1&&r.deleteTexture(s),i.delete(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){const{gl:a,backend:c}=this,{state:f}=this.backend,{textureGPU:p,glTextureType:g,glType:v,glFormat:b}=c.get(t);f.bindTexture(g,p);let T,S,N,C,P,B,F,q,I;const U=e.isCompressedTexture?e.mipmaps[o]:e.image;if(r!==null)T=r.max.x-r.min.x,S=r.max.y-r.min.y,N=r.isBox3?r.max.z-r.min.z:1,C=r.min.x,P=r.min.y,B=r.isBox3?r.min.z:0;else{const Y=Math.pow(2,-s);T=Math.floor(U.width*Y),S=Math.floor(U.height*Y),e.isDataArrayTexture||e.isArrayTexture?N=U.depth:e.isData3DTexture?N=Math.floor(U.depth*Y):N=1,C=0,P=0,B=0}i!==null?(F=i.x,q=i.y,I=i.z):(F=0,q=0,I=0),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,t.unpackAlignment);const G=a.getParameter(a.UNPACK_ROW_LENGTH),H=a.getParameter(a.UNPACK_IMAGE_HEIGHT),te=a.getParameter(a.UNPACK_SKIP_PIXELS),W=a.getParameter(a.UNPACK_SKIP_ROWS),Z=a.getParameter(a.UNPACK_SKIP_IMAGES);a.pixelStorei(a.UNPACK_ROW_LENGTH,U.width),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,U.height),a.pixelStorei(a.UNPACK_SKIP_PIXELS,C),a.pixelStorei(a.UNPACK_SKIP_ROWS,P),a.pixelStorei(a.UNPACK_SKIP_IMAGES,B);const re=e.isDataArrayTexture||e.isData3DTexture||t.isArrayTexture,oe=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isDepthTexture){const Y=c.get(e),ae=c.get(t),he=c.get(Y.renderTarget),be=c.get(ae.renderTarget),pe=he.framebuffers[Y.cacheKey],Le=be.framebuffers[ae.cacheKey];f.bindFramebuffer(a.READ_FRAMEBUFFER,pe),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,Le);for(let Ue=0;Ue<N;Ue++)re&&(a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,Y.textureGPU,s,B+Ue),a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,p,o,I+Ue)),a.blitFramebuffer(C,P,T,S,F,q,T,S,a.DEPTH_BUFFER_BIT,a.NEAREST);f.bindFramebuffer(a.READ_FRAMEBUFFER,null),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else if(s!==0||e.isRenderTargetTexture||c.has(e)){const Y=c.get(e);this._srcFramebuffer===null&&(this._srcFramebuffer=a.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=a.createFramebuffer()),f.bindFramebuffer(a.READ_FRAMEBUFFER,this._srcFramebuffer),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let ae=0;ae<N;ae++)re?a.framebufferTextureLayer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,Y.textureGPU,s,B+ae):a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,Y.textureGPU,s),oe?a.framebufferTextureLayer(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,p,o,I+ae):a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,p,o),s!==0?a.blitFramebuffer(C,P,T,S,F,q,T,S,a.COLOR_BUFFER_BIT,a.NEAREST):oe?a.copyTexSubImage3D(g,o,F,q,I+ae,C,P,T,S):a.copyTexSubImage2D(g,o,F,q,C,P,T,S);f.bindFramebuffer(a.READ_FRAMEBUFFER,null),f.bindFramebuffer(a.DRAW_FRAMEBUFFER,null)}else oe?e.isDataTexture||e.isData3DTexture?a.texSubImage3D(g,o,F,q,I,T,S,N,b,v,U.data):t.isCompressedArrayTexture?a.compressedTexSubImage3D(g,o,F,q,I,T,S,N,b,U.data):a.texSubImage3D(g,o,F,q,I,T,S,N,b,v,U):e.isDataTexture?a.texSubImage2D(a.TEXTURE_2D,o,F,q,T,S,b,v,U.data):e.isCompressedTexture?a.compressedTexSubImage2D(a.TEXTURE_2D,o,F,q,U.width,U.height,b,U.data):a.texSubImage2D(a.TEXTURE_2D,o,F,q,T,S,b,v,U);a.pixelStorei(a.UNPACK_ROW_LENGTH,G),a.pixelStorei(a.UNPACK_IMAGE_HEIGHT,H),a.pixelStorei(a.UNPACK_SKIP_PIXELS,te),a.pixelStorei(a.UNPACK_SKIP_ROWS,W),a.pixelStorei(a.UNPACK_SKIP_IMAGES,Z),o===0&&t.generateMipmaps&&a.generateMipmap(g),f.unbindTexture()}copyFramebufferToTexture(e,t,r){const{gl:i}=this,{state:s}=this.backend,{textureGPU:o}=this.backend.get(e),{x:a,y:c,z:f,w:p}=r,g=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,v=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(g){const b=a!==0||c!==0;let T,S;if(e.isDepthTexture===!0?(T=i.DEPTH_BUFFER_BIT,S=i.DEPTH_ATTACHMENT,t.stencil&&(T|=i.STENCIL_BUFFER_BIT)):(T=i.COLOR_BUFFER_BIT,S=i.COLOR_ATTACHMENT0),b){const N=this.backend.get(t.renderTarget),C=N.framebuffers[t.getCacheKey()],P=N.msaaFrameBuffer;s.bindFramebuffer(i.DRAW_FRAMEBUFFER,C),s.bindFramebuffer(i.READ_FRAMEBUFFER,P);const B=v-c-p;i.blitFramebuffer(a,B,a+f,B+p,a,B,a+f,B+p,T,i.NEAREST),s.bindFramebuffer(i.READ_FRAMEBUFFER,C),s.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,B,f,p),s.unbindTexture()}else{const N=i.createFramebuffer();s.bindFramebuffer(i.DRAW_FRAMEBUFFER,N),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,S,i.TEXTURE_2D,o,0),i.blitFramebuffer(0,0,f,p,0,0,f,p,T,i.NEAREST),i.deleteFramebuffer(N)}}else s.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,v-p-c,f,p),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,r,i=!1){const{gl:s}=this,o=t.renderTarget,{depthTexture:a,depthBuffer:c,stencilBuffer:f,width:p,height:g}=o;if(s.bindRenderbuffer(s.RENDERBUFFER,e),c&&!f){let v=s.DEPTH_COMPONENT24;i===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,o.samples,v,p,g):r>0?(a&&a.isDepthTexture&&a.type===s.FLOAT&&(v=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,r,v,p,g)):s.renderbufferStorage(s.RENDERBUFFER,v,p,g),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else c&&f&&(r>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,r,s.DEPTH24_STENCIL8,p,g):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,p,g),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e));s.bindRenderbuffer(s.RENDERBUFFER,null)}async copyTextureToBuffer(e,t,r,i,s,o){const{backend:a,gl:c}=this,{textureGPU:f,glFormat:p,glType:g}=this.backend.get(e),v=c.createFramebuffer();a.state.bindFramebuffer(c.READ_FRAMEBUFFER,v);const b=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,b,f,0);const T=this._getTypedArrayType(g),S=this._getBytesPerTexel(g,p),C=i*s*S,P=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,P),c.bufferData(c.PIXEL_PACK_BUFFER,C,c.STREAM_READ),c.readPixels(t,r,i,s,p,g,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const B=new T(C/T.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,P),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,B),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),a.state.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.deleteFramebuffer(v),B}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:r}=this;let i=0;if(e===r.UNSIGNED_BYTE&&(i=1),(e===r.UNSIGNED_SHORT_4_4_4_4||e===r.UNSIGNED_SHORT_5_5_5_1||e===r.UNSIGNED_SHORT_5_6_5||e===r.UNSIGNED_SHORT||e===r.HALF_FLOAT)&&(i=2),(e===r.UNSIGNED_INT||e===r.FLOAT)&&(i=4),t===r.RGBA)return i*4;if(t===r.RGB)return i*3;if(t===r.ALPHA)return i}dispose(){const{gl:e}=this;this._srcFramebuffer!==null&&e.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&e.deleteFramebuffer(this._dstFramebuffer)}}function Zc(n){return n.isDataTexture?n.image.data:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?n:n.data}class yj{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class vj{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const r=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const Jv={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class xj{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:r,mode:i,object:s,type:o,info:a,index:c}=this;c!==0?r.drawElements(i,t,o,e):r.drawArrays(i,e,t),a.update(s,t,1)}renderInstances(e,t,r){const{gl:i,mode:s,type:o,index:a,object:c,info:f}=this;r!==0&&(a!==0?i.drawElementsInstanced(s,t,o,e,r):i.drawArraysInstanced(s,e,t,r),f.update(c,t,r))}renderMultiDraw(e,t,r){const{extensions:i,mode:s,object:o,info:a}=this;if(r===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let f=0;f<r;f++)this.render(e[f],t[f]);else{this.index!==0?c.multiDrawElementsWEBGL(s,t,0,this.type,e,0,r):c.multiDrawArraysWEBGL(s,e,0,t,0,r);let f=0;for(let p=0;p<r;p++)f+=t[p];a.update(o,f,1)}}renderMultiDrawInstances(e,t,r,i){const{extensions:s,mode:o,object:a,info:c}=this;if(r===0)return;const f=s.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<r;p++)this.renderInstances(e[p],t[p],i[p]);else{this.index!==0?f.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,i,0,r):f.multiDrawArraysInstancedWEBGL(o,e,0,t,0,i,0,r);let p=0;for(let g=0;g<r;g++)p+=t[g]*i[g];c.update(a,p,1)}}}class Iw{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(e){let t=this.timestamps.get(e);return t===void 0&&(Be(`TimestampQueryPool: No timestamp available for uid ${e}.`),t=0),t}hasTimestamp(e){return this.timestamps.has(e)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class bj extends Iw{constructor(e,t,r=2048){if(super(r),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){Be("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let i=0;i<this.maxQueries;i++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return cn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t==null||this.activeQuery!==null)return;const r=this.queries[t];if(r)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,r),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(i){Pe("Error in beginQuery:",i),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(r){Pe("Error in endQuery:",r),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=new Map;for(const[s,o]of this.queryOffsets)if(this.queryStates.get(o)==="ended"){const c=this.queries[o];e.set(s,this.resolveQuery(c))}if(e.size===0)return this.lastValue;const t={},r=[];for(const[s,o]of e){const a=s.match(/^(.*):f(\d+)$/),c=parseInt(a[2]);r.includes(c)===!1&&r.push(c),t[c]===void 0&&(t[c]=0);const f=await o;this.timestamps.set(s,f),t[c]+=f}const i=t[r[r.length-1]];return this.lastValue=i,this.frames=r,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,i}catch(e){return Pe("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let r,i=!1;const s=()=>{r&&(clearTimeout(r),r=null)},o=c=>{i||(i=!0,s(),t(c))},a=()=>{if(this.isDisposed){o(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){o(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){r=setTimeout(a,1);return}const p=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(p)/1e6)}catch(c){Pe("Error checking query:",c),t(this.lastValue)}};a()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class ex extends Ow{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,r={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil},i=t.context!==void 0?t.context:e.domElement.getContext("webgl2",r);function s(o){o.preventDefault();const a={api:"WebGL",message:o.statusMessage||"Unknown reason",reason:null,originalEvent:o};e.onDeviceLost(a)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=i,this.extensions=new yj(this),this.capabilities=new vj(this),this.attributeUtils=new pj(this),this.textureUtils=new _j(this),this.bufferRenderer=new xj(this),this.state=new mj(this),this.utils=new gj(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed")}get coordinateSystem(){return q0}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,r=null){const i=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:i.RGBA8}),r!==null){const s=e.stencilBuffer?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:r,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer===!0&&e.multiview===!1&&Be("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e._autoAllocateDepthBuffer=!1}}initTimestampQuery(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new bj(this.gl,e,2048));const r=this.timestampQueryPool[e];r.allocateQueriesForContext(t)!==null&&r.beginQuery(t)}prepareTimestampBuffer(e,t){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[e].endQuery(t)}getContext(){return this.gl}beginRender(e){const{state:t}=this,r=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:s,height:o}=this.getDrawingBufferSize();t.viewport(0,0,s,o)}if(e.scissor){const{x:s,y:o,width:a,height:c}=e.scissorValue;t.scissor(s,e.height-c-o,a,c)}this.initTimestampQuery(ds.RENDER,this.getTimestampUID(e)),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const i=e.occlusionQueryCount;i>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(i),r.occlusionQueryObjects=new Array(i),r.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:r}=this,i=this.get(e),s=i.previousContext;r.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>i.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(a!==null)for(let c=0;c<a.length;c++){const f=a[c];f.generateMipmaps&&this.generateMipmaps(f)}if(this._currentContext=s,this._resolveRenderTarget(e),s!==null)if(this._setFramebuffer(s),s.viewport)this.updateViewport(s);else{const{width:c,height:f}=this.getDrawingBufferSize();r.viewport(0,0,c,f)}this.prepareTimestampBuffer(ds.RENDER,this.getTimestampUID(e))}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet,{gl:o}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const a=()=>{let c=0;for(let f=0;f<r.length;f++){const p=r[f];p!==null&&o.getQueryParameter(p,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(p,o.QUERY_RESULT)===0&&s.add(i[f]),r[f]=null,o.deleteQuery(p),c++)}c<r.length?requestAnimationFrame(a):t.occluded=s};a()}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:r,y:i,width:s,height:o}=e.viewportValue;t.viewport(r,e.height-o-i,s,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,r,i=null,s=!0,o=!0){const{gl:a,renderer:c}=this;i===null&&(i={textures:null,clearColorValue:this.getClearColor()});let f=0;if(e&&(f|=a.COLOR_BUFFER_BIT),t&&(f|=a.DEPTH_BUFFER_BIT),r&&(f|=a.STENCIL_BUFFER_BIT),f!==0){let p;i.clearColorValue?p=i.clearColorValue:p=this.getClearColor();const g=c.getClearDepth(),v=c.getClearStencil();if(t&&this.state.setDepthMask(!0),i.textures===null)a.clearColor(p.r,p.g,p.b,p.a),a.clear(f);else{if(s&&this._setFramebuffer(i),e)for(let b=0;b<i.textures.length;b++)b===0?a.clearBufferfv(a.COLOR,b,[p.r,p.g,p.b,p.a]):a.clearBufferfv(a.COLOR,b,[0,0,0,1]);t&&r?a.clearBufferfi(a.DEPTH_STENCIL,0,g,v):t?a.clearBufferfv(a.DEPTH,0,[g]):r&&a.clearBufferiv(a.STENCIL,0,[v]),s&&o&&this._resolveRenderTarget(i)}}}beginCompute(e){const{state:t,gl:r}=this;t.bindFramebuffer(r.FRAMEBUFFER,null),this.initTimestampQuery(ds.COMPUTE,this.getTimestampUID(e))}compute(e,t,r,i,s=null){const{state:o,gl:a}=this;this.discard===!1&&(o.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:c,transformBuffers:f,attributes:p}=this.get(i),g=this._getVaoKey(p),v=this.vaoCache[g];v===void 0?this.vaoCache[g]=this._createVao(p):o.setVertexState(v),o.useProgram(c),this._bindUniforms(r);const b=this._getTransformFeedback(f);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,b),a.beginTransformFeedback(a.POINTS),s=s!==null?s:t.count,Array.isArray(s)?(cn("WebGLBackend.compute(): The count parameter must be a single number, not an array."),s=s[0]):s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute&&(cn("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),s=t.count),p[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,s):a.drawArrays(a.POINTS,0,s),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let T=0;T<f.length;T++){const S=f[T];S.pbo&&this.has(S.pbo)&&this.textureUtils.copyBufferToTexture(S.transformBuffer,S.pbo),S.switchBuffers()}}finishCompute(e){const{state:t,gl:r}=this;this.discard=!1,t.disable(r.RASTERIZER_DISCARD),this.prepareTimestampBuffer(ds.COMPUTE,this.getTimestampUID(e)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:r,material:i,context:s,hardwareClippingPlanes:o}=e,{programGPU:a}=this.get(r),{gl:c,state:f}=this,p=this.get(s),g=e.getDrawParameters();if(g===null)return;this._bindUniforms(e.getBindings());const v=t.isMesh&&t.matrixWorld.determinant()<0;f.setMaterial(i,v,o),s.textures!==null&&s.textures.length>1&&f.setMRTBlending(s.textures),f.useProgram(a);const b=e.getAttributes(),T=this.get(b);let S=T.vaoGPU;if(S===void 0){const G=this._getVaoKey(b);S=this.vaoCache[G],S===void 0&&(S=this._createVao(b),this.vaoCache[G]=S,T.vaoGPU=S)}const N=e.getIndex(),C=N!==null?this.get(N).bufferGPU:null;f.setVertexState(S,C);const P=p.lastOcclusionObject;if(P!==t&&P!==void 0){if(P!==null&&P.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),p.occlusionQueryIndex++),t.occlusionTest===!0){const G=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,G),p.occlusionQueries[p.occlusionQueryIndex]=G,p.occlusionQueryObjects[p.occlusionQueryIndex]=t}p.lastOcclusionObject=t}const B=this.bufferRenderer;t.isPoints?B.mode=c.POINTS:t.isLineSegments?B.mode=c.LINES:t.isLine?B.mode=c.LINE_STRIP:t.isLineLoop?B.mode=c.LINE_LOOP:i.wireframe===!0?(f.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),B.mode=c.LINES):B.mode=c.TRIANGLES;const{vertexCount:F,instanceCount:q}=g;let{firstVertex:I}=g;if(B.object=t,N!==null){I*=N.array.BYTES_PER_ELEMENT;const G=this.get(N);B.index=N.count,B.type=G.type}else B.index=0;const U=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(cn("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),B.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?B.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):cn("WebGLBackend: WEBGL_multi_draw not supported."):q>1?B.renderInstances(I,F,q):B.render(I,F)};if(e.camera.isArrayCamera===!0&&e.camera.cameras.length>0&&e.camera.isMultiViewCamera===!1){const G=this.get(e.camera),H=e.camera.cameras,te=e.getBindingGroup("cameraIndex").bindings[0];if(G.indexesGPU===void 0||G.indexesGPU.length!==H.length){const ae=new Uint32Array([0,0,0,0]),he=[];for(let be=0,pe=H.length;be<pe;be++){const Le=c.createBuffer();ae[0]=be,c.bindBuffer(c.UNIFORM_BUFFER,Le),c.bufferData(c.UNIFORM_BUFFER,ae,c.STATIC_DRAW),he.push(Le)}G.indexesGPU=he}const W=this.get(te),Z=this.renderer.getPixelRatio(),re=this._currentContext.renderTarget,oe=this._isRenderCameraDepthArray(this._currentContext),Y=this._currentContext.activeCubeFace;if(oe){const ae=this.get(re.depthTexture);if(ae.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){ae.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:he}=re;for(let be=0,pe=H.length;be<pe;be++)this.renderer._activeCubeFace=be,this._currentContext.activeCubeFace=be,this._setFramebuffer(this._currentContext),this.clear(!1,!0,he,this._currentContext,!1,!1);this.renderer._activeCubeFace=Y,this._currentContext.activeCubeFace=Y}}for(let ae=0,he=H.length;ae<he;ae++){const be=H[ae];if(t.layers.test(be.layers)){oe&&(this.renderer._activeCubeFace=ae,this._currentContext.activeCubeFace=ae,this._setFramebuffer(this._currentContext));const pe=be.viewport;if(pe!==void 0){const Le=pe.x*Z,Ue=pe.y*Z,Je=pe.width*Z,st=pe.height*Z;f.viewport(Math.floor(Le),Math.floor(e.context.height-st-Ue),Math.floor(Je),Math.floor(st))}f.bindBufferBase(c.UNIFORM_BUFFER,W.index,G.indexesGPU[ae]),U()}this._currentContext.activeCubeFace=Y,this.renderer._activeCubeFace=Y}}else U()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,i,s,o){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,o)}updateSampler(){return""}createNodeBuilder(e,t){return new hj(e,t)}createProgram(e){const t=this.gl,{stage:r,code:i}=e,s=r==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const r=this.gl,i=e.pipeline,{fragmentProgram:s,vertexProgram:o}=i,a=r.createProgram(),c=this.get(s).shaderGPU,f=this.get(o).shaderGPU;if(r.attachShader(a,c),r.attachShader(a,f),r.linkProgram(a),this.set(i,{programGPU:a,fragmentShader:c,vertexShader:f}),t!==null&&this.parallel){const p=new Promise(g=>{const v=this.parallel,b=()=>{r.getProgramParameter(a,v.COMPLETION_STATUS_KHR)?(this._completeCompile(e,i),g()):requestAnimationFrame(b)};b()});t.push(p);return}this._completeCompile(e,i)}_handleSource(e,t){const r=e.split(`
`),i=[],s=Math.max(t-6,0),o=Math.min(t+6,r.length);for(let a=s;a<o;a++){const c=a+1;i.push(`${c===t?">":" "} ${c}: ${r[a]}`)}return i.join(`
`)}_getShaderErrors(e,t,r){const i=e.getShaderParameter(t,e.COMPILE_STATUS),o=(e.getShaderInfoLog(t)||"").trim();if(i&&o==="")return"";const a=/ERROR: 0:(\d+)/.exec(o);if(a){const c=parseInt(a[1]);return r.toUpperCase()+`

`+o+`

`+this._handleSource(e.getShaderSource(t),c)}else return o}_logProgramError(e,t,r){if(this.renderer.debug.checkShaderErrors){const i=this.gl,o=(i.getProgramInfoLog(e)||"").trim();if(i.getProgramParameter(e,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,e,r,t);else{const a=this._getShaderErrors(i,r,"vertex"),c=this._getShaderErrors(i,t,"fragment");Pe("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(e,i.VALIDATE_STATUS)+`

Program Info Log: `+o+`
`+a+`
`+c)}else o!==""&&Be("WebGLProgram: Program Info Log:",o)}}_completeCompile(e,t){const{state:r,gl:i}=this,s=this.get(t),{programGPU:o,fragmentShader:a,vertexShader:c}=s;i.getProgramParameter(o,i.LINK_STATUS)===!1&&this._logProgramError(o,a,c),r.useProgram(o);const f=e.getBindings();this._setupBindings(f,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:r,gl:i}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:o}=e,a=i.createProgram(),c=this.get(s).shaderGPU,f=this.get(o).shaderGPU,p=o.transforms,g=[],v=[];for(let N=0;N<p.length;N++){const C=p[N];g.push(C.varyingName),v.push(C.attributeNode)}i.attachShader(a,c),i.attachShader(a,f),i.transformFeedbackVaryings(a,g,i.SEPARATE_ATTRIBS),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)===!1&&this._logProgramError(a,c,f),r.useProgram(a),this._setupBindings(t,a);const b=o.attributes,T=[],S=[];for(let N=0;N<b.length;N++){const C=b[N].node.attribute;T.push(C),this.has(C)||this.attributeUtils.createAttribute(C,i.ARRAY_BUFFER)}for(let N=0;N<v.length;N++){const C=v[N].attribute;this.has(C)||this.attributeUtils.createAttribute(C,i.ARRAY_BUFFER);const P=this.get(C);S.push(P)}this.set(e,{programGPU:a,transformBuffers:S,attributes:T})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let r=0,i=0;for(const s of t){this.set(s,{textures:i,uniformBuffers:r});for(const o of s.bindings)o.isUniformBuffer&&r++,o.isSampledTexture&&i++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,r=this.get(e);let i=r.uniformBuffers,s=r.textures;for(const o of e.bindings){const a=this.get(o);if(o.isUniformsGroup||o.isUniformBuffer){const c=o.buffer;let{bufferGPU:f}=this.get(c);f===void 0?(f=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,f),t.bufferData(t.UNIFORM_BUFFER,c.byteLength,t.DYNAMIC_DRAW),this.set(c,{bufferGPU:f})):t.bindBuffer(t.UNIFORM_BUFFER,f);const p=o.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,f),p.length===0)t.bufferData(t.UNIFORM_BUFFER,c,t.DYNAMIC_DRAW);else{const g=G0(c),v=g?1:c.BYTES_PER_ELEMENT;for(let b=0,T=p.length;b<T;b++){const S=p[b],N=S.start*v,C=S.count*v,P=N*(g?c.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,P,c,N,C)}}a.index=i++,a.bufferGPU=f,this.set(o,a)}else if(o.isSampledTexture){const{textureGPU:c,glTextureType:f}=this.get(o.texture);a.index=s++,a.textureGPU=c,a.glTextureType=f,this.set(o,a)}}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const i=this.get(e).bufferGPU,s=e.buffer,o=e.updateRanges;if(t.bindBuffer(t.UNIFORM_BUFFER,i),o.length===0)t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW);else{const a=G0(s),c=a?1:s.BYTES_PER_ELEMENT;for(let f=0,p=o.length;f<p;f++){const g=o[f],v=g.start*c,b=g.count*c,T=v*(a?s.BYTES_PER_ELEMENT:1);t.bufferSubData(t.UNIFORM_BUFFER,T,s,v,b)}}}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(Jv).filter(i=>Jv[i]===e),r=this.extensions;for(let i=0;i<t.length;i++)if(r.has(t[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){this.textureUtils.copyTextureToTexture(e,t,r,i,s,o)}copyFramebufferToTexture(e,t,r){this.textureUtils.copyFramebufferToTexture(e,t,r)}_setFramebuffer(e){const{gl:t,state:r}=this;let i=null;if(e.textures!==null){const s=e.renderTarget,o=this.get(s),{samples:a,depthBuffer:c,stencilBuffer:f}=s,p=s.isWebGLCubeRenderTarget===!0,g=s.isRenderTarget3D===!0,v=s.depth>1,b=s.isXRRenderTarget===!0,T=b===!0&&s._hasExternalTextures===!0;let S=o.msaaFrameBuffer,N=o.depthRenderbuffer;const C=this.extensions.get("WEBGL_multisampled_render_to_texture"),P=this.extensions.get("OVR_multiview2"),B=this._useMultisampledExtension(s),F=M5(e);let q;if(p?(o.cubeFramebuffers||(o.cubeFramebuffers={}),q=o.cubeFramebuffers[F]):b&&T===!1?q=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),q=o.framebuffers[F]),q===void 0){q=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,q);const I=e.textures,U=[];if(p){o.cubeFramebuffers[F]=q;const{textureGPU:H}=this.get(I[0]),te=this.renderer._activeCubeFace,W=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+te,H,W)}else{o.framebuffers[F]=q;for(let H=0;H<I.length;H++){const te=I[H],W=this.get(te);W.renderTarget=e.renderTarget,W.cacheKey=F;const Z=t.COLOR_ATTACHMENT0+H;if(s.multiview)P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,Z,W.textureGPU,0,a,0,2);else if(g||v){const re=this.renderer._activeCubeFace,oe=this.renderer._activeMipmapLevel;t.framebufferTextureLayer(t.FRAMEBUFFER,Z,W.textureGPU,oe,re)}else if(B)C.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Z,t.TEXTURE_2D,W.textureGPU,0,a);else{const re=this.renderer._activeMipmapLevel;t.framebufferTexture2D(t.FRAMEBUFFER,Z,t.TEXTURE_2D,W.textureGPU,re)}}}const G=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const H=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(H,e,0,B),o.xrDepthRenderbuffer=H,U.push(f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,H),t.framebufferRenderbuffer(t.FRAMEBUFFER,G,t.RENDERBUFFER,H)}else if(e.depthTexture!==null){U.push(f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const H=this.get(e.depthTexture);if(H.renderTarget=e.renderTarget,H.cacheKey=F,s.multiview)P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,G,H.textureGPU,0,a,0,2);else if(T&&B)C.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,G,t.TEXTURE_2D,H.textureGPU,0,a);else if(e.depthTexture.isArrayTexture){const te=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,G,H.textureGPU,0,te)}else if(e.depthTexture.isCubeTexture){const te=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,G,t.TEXTURE_CUBE_MAP_POSITIVE_X+te,H.textureGPU,0)}else t.framebufferTexture2D(t.FRAMEBUFFER,G,t.TEXTURE_2D,H.textureGPU,0)}o.depthInvalidationArray=U}else{if(this._isRenderCameraDepthArray(e)){r.bindFramebuffer(t.FRAMEBUFFER,q);const U=this.renderer._activeCubeFace,G=this.get(e.depthTexture),H=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,H,G.textureGPU,0,U)}if((b||B||s.multiview)&&s._isOpaqueFramebuffer!==!0){r.bindFramebuffer(t.FRAMEBUFFER,q);const U=this.get(e.textures[0]);s.multiview?P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,U.textureGPU,0,a,0,2):B?C.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,U.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,U.textureGPU,0);const G=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s._autoAllocateDepthBuffer===!0){const H=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,H),t.framebufferRenderbuffer(t.FRAMEBUFFER,G,t.RENDERBUFFER,H)}else{const H=this.get(e.depthTexture);s.multiview?P.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,G,H.textureGPU,0,a,0,2):B?C.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,G,t.TEXTURE_2D,H.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,G,t.TEXTURE_2D,H.textureGPU,0)}}}if(a>0&&B===!1&&!s.multiview){if(S===void 0){const I=[];S=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,S);const U=[],G=e.textures;for(let H=0;H<G.length;H++){U[H]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,U[H]),I.push(t.COLOR_ATTACHMENT0+H);const te=e.textures[H],W=this.get(te);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,W.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+H,t.RENDERBUFFER,U[H])}if(t.bindRenderbuffer(t.RENDERBUFFER,null),o.msaaFrameBuffer=S,o.msaaRenderbuffers=U,c&&N===void 0){N=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(N,e,a),o.depthRenderbuffer=N;const H=f?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;I.push(H)}o.invalidationArray=I}i=o.msaaFrameBuffer}else i=q;r.drawBuffers(e,q)}r.bindFramebuffer(t.FRAMEBUFFER,i)}_getVaoKey(e){let t="";for(let r=0;r<e.length;r++){const i=this.get(e[r]);t+=":"+i.id}return t}_createVao(e){const{gl:t}=this,r=t.createVertexArray();t.bindVertexArray(r);for(let i=0;i<e.length;i++){const s=e[i],o=this.get(s);t.bindBuffer(t.ARRAY_BUFFER,o.bufferGPU),t.enableVertexAttribArray(i);let a,c;s.isInterleavedBufferAttribute===!0?(a=s.data.stride*o.bytesPerElement,c=s.offset*o.bytesPerElement):(a=0,c=0),o.isInteger?t.vertexAttribIPointer(i,s.itemSize,o.type,a,c):t.vertexAttribPointer(i,s.itemSize,o.type,s.normalized,a,c),s.isInstancedBufferAttribute&&!s.isInterleavedBufferAttribute?t.vertexAttribDivisor(i,s.meshPerAttribute):s.isInterleavedBufferAttribute&&s.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(i,s.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),r}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let r=this.transformFeedbackCache[t];if(r!==void 0)return r;const{gl:i}=this;r=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r);for(let s=0;s<e.length;s++){const o=e[s];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,s,o.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=r,r}_setupBindings(e,t){const r=this.gl;for(const i of e)for(const s of i.bindings){const a=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const c=r.getUniformBlockIndex(t,s.name);r.uniformBlockBinding(t,c,a)}else if(s.isSampledTexture){const c=r.getUniformLocation(t,s.name);r.uniform1i(c,a)}}}_bindUniforms(e){const{gl:t,state:r}=this;for(const i of e)for(const s of i.bindings){const o=this.get(s),a=o.index;s.isUniformsGroup||s.isUniformBuffer?r.bindBufferBase(t.UNIFORM_BUFFER,a,o.bufferGPU):s.isSampledTexture&&r.bindTexture(o.glTextureType,o.textureGPU,t.TEXTURE0+a)}}_resolveRenderTarget(e){const{gl:t,state:r}=this,i=e.renderTarget;if(e.textures!==null&&i){const s=this.get(i);if(i.samples>0&&this._useMultisampledExtension(i)===!1){const o=s.framebuffers[e.getCacheKey()];let a=t.COLOR_BUFFER_BIT;i.resolveDepthBuffer&&(i.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),i.stencilBuffer&&i.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT));const c=s.msaaFrameBuffer,f=s.msaaRenderbuffers,p=e.textures,g=p.length>1;if(r.bindFramebuffer(t.READ_FRAMEBUFFER,c),r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),g)for(let v=0;v<p.length;v++)t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+v,t.RENDERBUFFER,null),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+v,t.TEXTURE_2D,null,0);for(let v=0;v<p.length;v++){if(g){const{textureGPU:b}=this.get(p[v]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,f[v]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,b,0)}if(e.scissor){const{x:b,y:T,width:S,height:N}=e.scissorValue,C=e.height-N-T;t.blitFramebuffer(b,C,b+S,C+N,b,C,b+S,C+N,a,t.NEAREST)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,a,t.NEAREST)}if(g)for(let v=0;v<p.length;v++){const{textureGPU:b}=this.get(p[v]);t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0+v,t.RENDERBUFFER,f[v]),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+v,t.TEXTURE_2D,b,0)}this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,s.invalidationArray)}else if(i.resolveDepthBuffer===!1&&s.framebuffers){const o=s.framebuffers[e.getCacheKey()];r.bindFramebuffer(t.DRAW_FRAMEBUFFER,o),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,s.depthInvalidationArray)}}}_useMultisampledExtension(e){return e.multiview===!0?!0:e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Fl={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},La=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},Jn={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Tr={Store:"store"},Lt={Load:"load",Clear:"clear"},tx={CCW:"ccw",CW:"cw"},nx={None:"none",Back:"back"},au={Uint16:"uint16",Uint32:"uint32"},K={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},bp={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},ba={Linear:"linear",Nearest:"nearest"},wt={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},da={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},rx={None:0,All:15},To={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},Tp={Storage:"storage",ReadOnlyStorage:"read-only-storage"},wp={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},ix={NonFiltering:"non-filtering",Comparison:"comparison"},pa={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},sx={TwoD:"2d",ThreeD:"3d"},Ln={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},Tj={All:"all"},Jc={Vertex:"vertex",Instance:"instance"},gg={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},ox={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class wj extends Lw{constructor(e,t,r){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class Sj extends Mw{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let Ej=0;class Nj extends Sj{constructor(e,t){super("StorageBuffer_"+Ej++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:ir.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class Rj extends Zo{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,r=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:ba.Linear}),this.flipYSampler=e.createSampler({minFilter:ba.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:r}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Fl.TriangleStrip,stripIndexFormat:au.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Fl.TriangleStrip,stripIndexFormat:au.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,r=0){const i=t.format,{width:s,height:o}=t.size,a=this.getTransferPipeline(i),c=this.getFlipYPipeline(i),f=this.device.createTexture({size:{width:s,height:o,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),p=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Ln.TwoD,baseArrayLayer:r}),g=f.createView({baseMipLevel:0,mipLevelCount:1,dimension:Ln.TwoD,baseArrayLayer:0}),v=this.device.createCommandEncoder({}),b=(T,S,N)=>{const C=T.getBindGroupLayout(0),P=this.device.createBindGroup({layout:C,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:S}]}),B=v.beginRenderPass({colorAttachments:[{view:N,loadOp:Lt.Clear,storeOp:Tr.Store,clearValue:[0,0,0,0]}]});B.setPipeline(T),B.setBindGroup(0,P),B.draw(4,1,0,0),B.end()};b(a,p,g),b(c,g,p),this.device.queue.submit([v.finish()]),f.destroy()}generateMipmaps(e,t,r=0,i=null){const s=this.get(e);s.layers===void 0&&(s.layers=[]);const o=s.layers[r]||this._mipmapCreateBundles(e,t,r),a=i||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(a,o),i===null&&this.device.queue.submit([a.finish()]),s.layers[r]=o}_mipmapCreateBundles(e,t,r){const i=this.getTransferPipeline(t.format),s=i.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Ln.TwoD,baseArrayLayer:r});const a=[];for(let c=1;c<t.mipLevelCount;c++){const f=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),p=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:Ln.TwoD,baseArrayLayer:r}),g={colorAttachments:[{view:p,loadOp:Lt.Clear,storeOp:Tr.Store,clearValue:[0,0,0,0]}]},v=this.device.createRenderBundleEncoder({colorFormats:[t.format]});v.setPipeline(i),v.setBindGroup(0,f),v.draw(4,1,0,0),a.push({renderBundles:[v.finish()],passDescriptor:g}),o=p}return a}_mipmapRunBundles(e,t){const r=t.length;for(let i=0;i<r;i++){const s=t[i],o=e.beginRenderPass(s.passDescriptor);o.executeBundles(s.renderBundles),o.end()}}}const Cj={[tb]:"never",[nf]:"less",[Zx]:"equal",[Jx]:"less-equal",[Xx]:"greater",[Kx]:"greater-equal",[eb]:"always",[Yx]:"not-equal"},Mj=[0,1,3,2,4,5];class Pj{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(e){const t=this.backend,r=e.minFilter+"-"+e.magFilter+"-"+e.wrapS+"-"+e.wrapT+"-"+(e.wrapR||"0")+"-"+e.anisotropy+"-"+(e.compareFunction||0);let i=this._samplerCache.get(r);if(i===void 0){const o={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};o.magFilter===ba.Linear&&o.minFilter===ba.Linear&&o.mipmapFilter===ba.Linear&&(o.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(o.compare=Cj[e.compareFunction]),i={sampler:t.device.createSampler(o),usedTimes:0},this._samplerCache.set(r,i)}const s=t.get(e);if(s.sampler!==i.sampler){if(s.sampler!==void 0){const o=this._samplerCache.get(s.samplerKey);o.usedTimes--,o.usedTimes===0&&this._samplerCache.delete(s.samplerKey)}s.samplerKey=r,s.sampler=i.sampler,i.usedTimes++}return r}createDefaultTexture(e){let t;const r=_g(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(r):t=this._getDefaultTextureGPU(r),this.backend.get(e).texture=t}createTexture(e,t={}){const r=this.backend,i=r.get(e);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(e.isExternalTexture){i.texture=e.sourceTexture,i.initialized=!0;return}t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:o,depth:a,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const f=this._getDimension(e),p=e.internalFormat||t.format||_g(e,r.device);i.format=p;const{samples:g,primarySamples:v,isMSAA:b}=r.utils.getTextureSampleData(e);let T=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(T|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&p!==K.RGB9E5UFloat&&(T|=GPUTextureUsage.RENDER_ATTACHMENT);const S={label:e.name,size:{width:s,height:o,depthOrArrayLayers:a},mipLevelCount:c,sampleCount:v,dimension:f,format:p,usage:T};if(p===void 0){Be("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}if(e.isCubeTexture&&(S.textureBindingViewDimension=Ln.Cube),i.texture=r.device.createTexture(S),b){const N=Object.assign({},S);N.label=N.label+"-msaa",N.sampleCount=g,N.mipLevelCount=1,i.msaaTexture=r.device.createTexture(N)}i.initialized=!0,i.textureDescriptorGPU=S}destroyTexture(e,t=!1){const r=this.backend,i=r.get(e);i.texture!==void 0&&t===!1&&i.texture.destroy(),i.msaaTexture!==void 0&&i.msaaTexture.destroy(),r.delete(e)}generateMipmaps(e,t=null){const r=this.backend.get(e);if(e.isCubeTexture)for(let i=0;i<6;i++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,i,t);else{const i=e.image.depth||1;for(let s=0;s<i;s++)this._generateMipmaps(r.texture,r.textureDescriptorGPU,s,t)}}getColorBuffer(){const e=this.backend,t=e.renderer.getCanvasTarget(),{width:r,height:i}=e.getDrawingBufferSize(),s=e.renderer.currentSamples,o=t.colorTexture,a=e.get(o);if(o.width===r&&o.height===i&&o.samples===s)return a.texture;let c=a.texture;return c&&c.destroy(),c=e.device.createTexture({label:"colorBuffer",size:{width:r,height:i,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.currentSamples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),o.source.width=r,o.source.height=i,o.samples=s,a.texture=c,c}getDepthBuffer(e=!0,t=!1){const r=this.backend,i=r.renderer.getCanvasTarget(),{width:s,height:o}=r.getDrawingBufferSize(),a=r.renderer.currentSamples,c=i.depthTexture;if(c.width===s&&c.height===o&&c.samples===a&&c.depth===e&&c.stencil===t)return r.get(c).texture;const f=r.get(c).texture;let p,g;if(t?(p=ko,g=Io):e&&(p=Uo,g=Fn),f!==void 0){if(c.image.width===s&&c.image.height===o&&c.format===p&&c.type===g&&c.samples===a)return f;this.destroyTexture(c)}return c.name="depthBuffer",c.format=p,c.type=g,c.image.width=s,c.image.height=o,c.samples=a,this.createTexture(c,{width:s,height:o}),r.get(c).texture}updateTexture(e,t){const r=this.backend.get(e),i=e.mipmaps,{textureDescriptorGPU:s}=r;if(!(e.isRenderTargetTexture||s===void 0)){if(e.isDataTexture)if(i.length>0)for(let o=0,a=i.length;o<a;o++){const c=i[o];this._copyBufferToTexture(c,r.texture,s,0,e.flipY,0,o)}else this._copyBufferToTexture(t.image,r.texture,s,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let o=0;o<t.image.depth;o++)this._copyBufferToTexture(t.image,r.texture,s,o,e.flipY,o);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,r.texture,s);else if(e.isCubeTexture)this._copyCubeMapToTexture(e,r.texture,s);else if(i.length>0)for(let o=0,a=i.length;o<a;o++){const c=i[o];this._copyImageToTexture(c,r.texture,s,0,e.flipY,e.premultiplyAlpha,o)}else this._copyImageToTexture(t.image,r.texture,s,0,e.flipY,e.premultiplyAlpha);r.version=e.version}}async copyTextureToBuffer(e,t,r,i,s,o){const a=this.backend.device,c=this.backend.get(e),f=c.texture,p=c.textureDescriptorGPU.format,g=this._getBytesPerTexel(p);let v=i*g;v=Math.ceil(v/256)*256;const b=a.createBuffer({size:(s-1)*v+i*g,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),T=a.createCommandEncoder();T.copyTextureToBuffer({texture:f,origin:{x:t,y:r,z:o}},{buffer:b,bytesPerRow:v},{width:i,height:s});const S=this._getTypedArrayType(p);a.queue.submit([T.finish()]),await b.mapAsync(GPUMapMode.READ);const N=b.getMappedRange();return new S(N)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const r=new Vg;r.minFilter=ki,r.magFilter=ki,this.createTexture(r,{width:1,height:1,format:e}),this.defaultTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultCubeTexture[e];if(t===void 0){const r=new Gg;r.minFilter=ki,r.magFilter=ki,this.createTexture(r,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=r}return this.backend.get(t).texture}_copyCubeMapToTexture(e,t,r){const i=e.images,s=e.mipmaps;for(let o=0;o<6;o++){const a=i[o],c=e.flipY===!0?Mj[o]:o;a.isDataTexture?this._copyBufferToTexture(a.image,t,r,c,e.flipY):this._copyImageToTexture(a,t,r,c,e.flipY,e.premultiplyAlpha);for(let f=0;f<s.length;f++){const g=s[f].images[o];g.isDataTexture?this._copyBufferToTexture(g.image,t,r,c,e.flipY,0,f+1):this._copyImageToTexture(g,t,r,c,e.flipY,e.premultiplyAlpha,f+1)}}}_copyImageToTexture(e,t,r,i,s,o,a=0){const c=this.backend.device,f=a>0?e.width:r.size.width,p=a>0?e.height:r.size.height;try{c.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:a,origin:{x:0,y:0,z:i},premultipliedAlpha:o},{width:f,height:p,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new Rj(this.backend.device)),e}_generateMipmaps(e,t,r=0,i=null){this._getPassUtils().generateMipmaps(e,t,r,i)}_flipY(e,t,r=0){this._getPassUtils().flipY(e,t,r)}_copyBufferToTexture(e,t,r,i,s,o=0,a=0){const c=this.backend.device,f=e.data,p=this._getBytesPerTexel(r.format),g=e.width*p;c.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:i}},f,{offset:e.width*e.height*p*o,bytesPerRow:g},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,r,i)}_copyCompressedBufferToTexture(e,t,r){const i=this.backend.device,s=this._getBlockData(r.format),o=r.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const c=e[a],f=c.width,p=c.height,g=o?r.size.depthOrArrayLayers:1,v=Math.ceil(f/s.width)*s.byteLength,b=v*Math.ceil(p/s.height);for(let T=0;T<g;T++)i.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:T}},c.data,{offset:T*b,bytesPerRow:v,rowsPerImage:Math.ceil(p/s.height)},{width:Math.ceil(f/s.width)*s.width,height:Math.ceil(p/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===K.BC1RGBAUnorm||e===K.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===K.BC2RGBAUnorm||e===K.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.BC3RGBAUnorm||e===K.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.BC4RUnorm||e===K.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===K.BC5RGUnorm||e===K.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===K.BC6HRGBUFloat||e===K.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===K.BC7RGBAUnorm||e===K.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.ETC2RGB8Unorm||e===K.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===K.ETC2RGB8A1Unorm||e===K.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===K.ETC2RGBA8Unorm||e===K.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===K.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===K.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===K.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===K.ASTC4x4Unorm||e===K.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===K.ASTC5x4Unorm||e===K.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===K.ASTC5x5Unorm||e===K.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===K.ASTC6x5Unorm||e===K.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===K.ASTC6x6Unorm||e===K.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===K.ASTC8x5Unorm||e===K.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===K.ASTC8x6Unorm||e===K.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===K.ASTC8x8Unorm||e===K.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===K.ASTC10x5Unorm||e===K.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===K.ASTC10x6Unorm||e===K.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===K.ASTC10x8Unorm||e===K.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===K.ASTC10x10Unorm||e===K.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===K.ASTC12x10Unorm||e===K.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===K.ASTC12x12Unorm||e===K.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=bp.ClampToEdge;return e===tf?t=bp.Repeat:e===ef&&(t=bp.MirrorRepeat),t}_convertFilterMode(e){let t=ba.Linear;return(e===ki||e===Qx||e===xA)&&(t=ba.Nearest),t}_getBytesPerTexel(e){if(e===K.R8Unorm||e===K.R8Snorm||e===K.R8Uint||e===K.R8Sint)return 1;if(e===K.R16Uint||e===K.R16Sint||e===K.R16Float||e===K.RG8Unorm||e===K.RG8Snorm||e===K.RG8Uint||e===K.RG8Sint)return 2;if(e===K.R32Uint||e===K.R32Sint||e===K.R32Float||e===K.RG16Uint||e===K.RG16Sint||e===K.RG16Float||e===K.RGBA8Unorm||e===K.RGBA8UnormSRGB||e===K.RGBA8Snorm||e===K.RGBA8Uint||e===K.RGBA8Sint||e===K.BGRA8Unorm||e===K.BGRA8UnormSRGB||e===K.RGB9E5UFloat||e===K.RGB10A2Unorm||e===K.RG11B10UFloat||e===K.Depth32Float||e===K.Depth24Plus||e===K.Depth24PlusStencil8||e===K.Depth32FloatStencil8)return 4;if(e===K.RG32Uint||e===K.RG32Sint||e===K.RG32Float||e===K.RGBA16Uint||e===K.RGBA16Sint||e===K.RGBA16Float)return 8;if(e===K.RGBA32Uint||e===K.RGBA32Sint||e===K.RGBA32Float)return 16}_getTypedArrayType(e){if(e===K.R8Uint)return Uint8Array;if(e===K.R8Sint)return Int8Array;if(e===K.R8Unorm)return Uint8Array;if(e===K.R8Snorm)return Int8Array;if(e===K.RG8Uint)return Uint8Array;if(e===K.RG8Sint)return Int8Array;if(e===K.RG8Unorm)return Uint8Array;if(e===K.RG8Snorm)return Int8Array;if(e===K.RGBA8Uint)return Uint8Array;if(e===K.RGBA8Sint)return Int8Array;if(e===K.RGBA8Unorm||e===K.RGBA8UnormSRGB)return Uint8Array;if(e===K.RGBA8Snorm)return Int8Array;if(e===K.R16Uint)return Uint16Array;if(e===K.R16Sint)return Int16Array;if(e===K.RG16Uint)return Uint16Array;if(e===K.RG16Sint)return Int16Array;if(e===K.RGBA16Uint)return Uint16Array;if(e===K.RGBA16Sint)return Int16Array;if(e===K.R16Float||e===K.RG16Float||e===K.RGBA16Float)return Uint16Array;if(e===K.R32Uint)return Uint32Array;if(e===K.R32Sint)return Int32Array;if(e===K.R32Float)return Float32Array;if(e===K.RG32Uint)return Uint32Array;if(e===K.RG32Sint)return Int32Array;if(e===K.RG32Float)return Float32Array;if(e===K.RGBA32Uint)return Uint32Array;if(e===K.RGBA32Sint)return Int32Array;if(e===K.RGBA32Float)return Float32Array;if(e===K.BGRA8Unorm||e===K.BGRA8UnormSRGB)return Uint8Array;if(e===K.RGB10A2Unorm||e===K.RGB9E5UFloat||e===K.RG11B10UFloat)return Uint32Array;if(e===K.Depth32Float)return Float32Array;if(e===K.Depth24Plus||e===K.Depth24PlusStencil8)return Uint32Array;if(e===K.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.is3DTexture||e.isData3DTexture?t=sx.ThreeD:t=sx.TwoD,t}}function _g(n,e=null){const t=n.format,r=n.type,i=n.colorSpace,s=xn.getTransfer(i);let o;if(n.isCompressedTexture===!0||n.isCompressedArrayTexture===!0)switch(t){case m0:case g0:o=s===ht?K.BC1RGBAUnormSRGB:K.BC1RGBAUnorm;break;case _0:o=s===ht?K.BC2RGBAUnormSRGB:K.BC2RGBAUnorm;break;case y0:o=s===ht?K.BC3RGBAUnormSRGB:K.BC3RGBAUnorm;break;case lm:o=K.BC4RUnorm;break;case um:o=K.BC4RSnorm;break;case H0:o=K.BC5RGUnorm;break;case Am:o=K.BC5RGSnorm;break;case am:o=s===ht?K.BC7RGBAUnormSRGB:K.BC7RGBAUnorm;break;case Vp:case Gp:o=s===ht?K.ETC2RGB8UnormSRGB:K.ETC2RGB8Unorm;break;case zp:o=s===ht?K.ETC2RGBA8UnormSRGB:K.ETC2RGBA8Unorm;break;case $p:o=K.EACR11Unorm;break;case jp:o=K.EACR11Snorm;break;case j0:o=K.EACRG11Unorm;break;case Hp:o=K.EACRG11Snorm;break;case Wp:o=s===ht?K.ASTC4x4UnormSRGB:K.ASTC4x4Unorm;break;case Qp:o=s===ht?K.ASTC5x4UnormSRGB:K.ASTC5x4Unorm;break;case Yp:o=s===ht?K.ASTC5x5UnormSRGB:K.ASTC5x5Unorm;break;case Xp:o=s===ht?K.ASTC6x5UnormSRGB:K.ASTC6x5Unorm;break;case Kp:o=s===ht?K.ASTC6x6UnormSRGB:K.ASTC6x6Unorm;break;case Zp:o=s===ht?K.ASTC8x5UnormSRGB:K.ASTC8x5Unorm;break;case Jp:o=s===ht?K.ASTC8x6UnormSRGB:K.ASTC8x6Unorm;break;case em:o=s===ht?K.ASTC8x8UnormSRGB:K.ASTC8x8Unorm;break;case tm:o=s===ht?K.ASTC10x5UnormSRGB:K.ASTC10x5Unorm;break;case nm:o=s===ht?K.ASTC10x6UnormSRGB:K.ASTC10x6Unorm;break;case rm:o=s===ht?K.ASTC10x8UnormSRGB:K.ASTC10x8Unorm;break;case im:o=s===ht?K.ASTC10x10UnormSRGB:K.ASTC10x10Unorm;break;case sm:o=s===ht?K.ASTC12x10UnormSRGB:K.ASTC12x10Unorm;break;case om:o=s===ht?K.ASTC12x12UnormSRGB:K.ASTC12x12Unorm;break;case Gi:o=s===ht?K.RGBA8UnormSRGB:K.RGBA8Unorm;break;default:Pe("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Gi:switch(r){case oA:o=K.RGBA8Snorm;break;case aA:o=K.RGBA16Sint;break;case Rl:o=K.RGBA16Uint;break;case Fn:o=K.RGBA32Uint;break;case wr:o=K.RGBA32Sint;break;case ni:o=s===ht?K.RGBA8UnormSRGB:K.RGBA8Unorm;break;case rr:o=K.RGBA16Float;break;case mi:o=K.RGBA32Float;break;default:Pe("WebGPURenderer: Unsupported texture type with RGBAFormat.",r)}break;case $g:switch(r){case bb:o=K.RGB9E5UFloat;break;case Tb:o=K.RG11B10UFloat;break;default:Pe("WebGPURenderer: Unsupported texture type with RGBFormat.",r)}break;case jg:switch(r){case oA:o=K.R8Snorm;break;case aA:o=K.R16Sint;break;case Rl:o=K.R16Uint;break;case Fn:o=K.R32Uint;break;case wr:o=K.R32Sint;break;case ni:o=K.R8Unorm;break;case rr:o=K.R16Float;break;case mi:o=K.R32Float;break;default:Pe("WebGPURenderer: Unsupported texture type with RedFormat.",r)}break;case zs:switch(r){case oA:o=K.RG8Snorm;break;case aA:o=K.RG16Sint;break;case Rl:o=K.RG16Uint;break;case Fn:o=K.RG32Uint;break;case wr:o=K.RG32Sint;break;case ni:o=K.RG8Unorm;break;case rr:o=K.RG16Float;break;case mi:o=K.RG32Float;break;default:Pe("WebGPURenderer: Unsupported texture type with RGFormat.",r)}break;case Uo:switch(r){case Rl:o=K.Depth16Unorm;break;case Fn:o=K.Depth24Plus;break;case mi:o=K.Depth32Float;break;default:Pe("WebGPURenderer: Unsupported texture type with DepthFormat.",r)}break;case ko:switch(r){case Io:o=K.Depth24PlusStencil8;break;case mi:e&&e.features.has(gg.Depth32FloatStencil8)===!1&&Pe('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),o=K.Depth32FloatStencil8;break;default:Pe("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",r)}break;case Hg:switch(r){case wr:o=K.R32Sint;break;case Fn:o=K.R32Uint;break;default:Pe("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",r)}break;case Wg:switch(r){case wr:o=K.RG32Sint;break;case Fn:o=K.RG32Uint;break;default:Pe("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",r)}break;case Qg:switch(r){case wr:o=K.RGBA32Sint;break;case Fn:o=K.RGBA32Uint;break;default:Pe("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",r)}break;default:Pe("WebGPURenderer: Unsupported texture format.",t)}return o}const Bj=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,Dj=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,ax={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},Lj=n=>{n=n.trim();const e=n.match(Bj);if(e!==null&&e.length===4){const t=e[2],r=[];let i=null;for(;(i=Dj.exec(t))!==null;)r.push({name:i[1],type:i[2]});const s=[];for(let p=0;p<r.length;p++){const{name:g,type:v}=r[p];let b=v;b.startsWith("ptr")?b="pointer":(b.startsWith("texture")&&(b=v.split("<")[0]),b=ax[b]),s.push(new W2(b,g))}const o=n.substring(e[0].length),a=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:ax[a]||a,inputs:s,name:c,inputsCode:t,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class Fj extends Y2{constructor(e){const{type:t,inputs:r,name:i,inputsCode:s,blockCode:o,outputType:a}=Lj(e);super(t,r,i),this.inputsCode=s,this.blockCode=o,this.outputType=a}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class Oj extends Nw{parseFunction(e){return new Fj(e)}}const Ij={[ir.READ_ONLY]:"read",[ir.WRITE_ONLY]:"write",[ir.READ_WRITE]:"read_write"},lx={[tf]:"repeat",[vA]:"clamp",[ef]:"mirror"},e0={vertex:La.VERTEX,fragment:La.FRAGMENT,compute:La.COMPUTE},ux={instance:!0,swizzleAssign:!1,storageBuffer:!0},kj={"^^":"tsl_xor"},Uj={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},Ax={},ju={tsl_xor:new Yn("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Yn("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Yn("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Yn("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Yn("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Yn("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Yn("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Yn("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Yn("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Yn("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Yn("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Yn("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Yn(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},qj={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let kw="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(kw+=`diagnostic( off, derivative_uniformity );
`);class Gj extends Ew{constructor(e,t){super(e,t,new Oj),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(e,t,r,i,s,o=this.shaderStage){return o==="fragment"?i?s?`textureSample( ${t}, ${t}_sampler, ${r}, ${i}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${r}, ${i} )`:s?`textureSample( ${t}, ${t}_sampler, ${r}, ${s} )`:`textureSample( ${t}, ${t}_sampler, ${r} )`:this.generateTextureSampleLevel(e,t,r,"0",i)}generateTextureSampleLevel(e,t,r,i,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,i):this.generateTextureLod(e,t,r,s,o,i)}generateWrapFunction(e){const t=`tsl_coord_${lx[e.wrapS]}S_${lx[e.wrapT]}_${e.is3DTexture||e.isData3DTexture?"3d":"2d"}T`;let r=Ax[t];if(r===void 0){const i=[],s=e.is3DTexture||e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const a=(c,f)=>{c===tf?(i.push(ju.repeatWrapping_float),o+=`		tsl_repeatWrapping_float( coord.${f} )`):c===vA?(i.push(ju.clampWrapping_float),o+=`		tsl_clampWrapping_float( coord.${f} )`):c===ef?(i.push(ju.mirrorWrapping_float),o+=`		tsl_mirrorWrapping_float( coord.${f} )`):(o+=`		coord.${f}`,Be(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};a(e.wrapS,"x"),o+=`,
`,a(e.wrapT,"y"),(e.is3DTexture||e.isData3DTexture)&&(o+=`,
`,a(e.wrapR,"z")),o+=`
	);

}
`,Ax[t]=r=new Yn(o,i)}return r.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,r){const i=this.getDataFromNode(e,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let s=i.dimensionsSnippet[r];if(i.dimensionsSnippet[r]===void 0){let o,a;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),f=c>1;e.is3DTexture||e.isData3DTexture?a="vec3<u32>":a="vec2<u32>",f||e.isStorageTexture?o=t:o=`${t}${r?`, u32( ${r} )`:""}`,s=new P0(new B0(`textureDimensions( ${o} )`,a)),i.dimensionsSnippet[r]=s,(e.isArrayTexture||e.isDataArrayTexture||e.is3DTexture||e.isData3DTexture)&&(i.arrayLayerCount=new P0(new B0(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(i.cubeFaceCount=new P0(new B0("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,r,i,s="0u"){this._include("biquadraticTexture");const o=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,s);return i&&(r=`${r} + vec2<f32>(${i}) / ${a}`),`tsl_biquadraticTexture( ${t}, ${o}( ${r} ), ${a}, u32( ${s} ) )`}generateTextureLod(e,t,r,i,s,o="0u"){const a=this.generateWrapFunction(e),c=this.generateTextureDimension(e,t,o),f=e.is3DTexture||e.isData3DTexture?"vec3":"vec2";s&&(r=`${r} + ${f}<f32>(${s}) / ${f}<f32>( ${c} )`);const p=`${f}<u32>( ${a}( ${r} ) * ${f}<f32>( ${c} ) )`;return this.generateTextureLoad(e,t,p,o,i,null)}generateTextureLoad(e,t,r,i,s,o){i===null&&(i="0u"),o&&(r=`${r} + ${o}`);let a;return s?a=`textureLoad( ${t}, ${r}, ${s}, u32( ${i} ) )`:(a=`textureLoad( ${t}, ${r}, u32( ${i} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(a+=".x")),a}generateTextureStore(e,t,r,i,s){let o;return i?o=`textureStore( ${t}, ${r}, ${i}, ${s} )`:o=`textureStore( ${t}, ${r}, ${s} )`,o}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===mi||this.isSampleCompare(e)===!1&&e.minFilter===ki&&e.magFilter===ki||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,r,i,s,o=this.shaderStage){let a=null;return this.isUnfilterable(e)?a=this.generateTextureLod(e,t,r,i,s,"0",o):a=this._generateTextureSample(e,t,r,i,s,o),a}generateTextureGrad(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${i[0]}, ${i[1]}, ${o} )`:`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${i[0]}, ${i[1]} )`;Pe(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return e.isDepthTexture===!0&&e.isArrayTexture===!0?o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${s}, ${i} )`:o?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i} )`;Pe(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,t,r,i,s,o){return this.isUnfilterable(e)===!1?o?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,o,i):this.generateTextureLod(e,t,r,s,o,i)}generateTextureBias(e,t,r,i,s,o,a=this.shaderStage){if(a==="fragment")return o?`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${i}, ${o} )`:`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${i} )`;Pe(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const r=e.name,i=e.type;return i==="texture"||i==="cubeTexture"||i==="cubeDepthTexture"||i==="storageTexture"||i==="texture3D"?r:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?this.isCustomStruct(e)?r:r+".value":e.groupNode.name+"."+r}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=kj[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?e.isAtomic===!0?(Be("WebGPURenderer: Atomic operations are only supported in compute shaders."),ir.READ_WRITE):ir.READ_ONLY:e.access}getStorageAccess(e,t){return Ij[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,r,i=null){const s=super.getUniformFromNode(e,t,r,i),o=this.getDataFromNode(e,r,this.globalCache);if(o.uniformGPU===void 0){let a;const c=e.groupNode,f=c.name,p=this.getBindGroupArray(f,r);if(t==="texture"||t==="cubeTexture"||t==="cubeDepthTexture"||t==="storageTexture"||t==="texture3D"){let g=null;const v=this.getNodeAccess(e,r);if(t==="texture"||t==="storageTexture"?e.value.is3DTexture===!0?g=new mg(s.name,s.node,c,v):g=new Vf(s.name,s.node,c,v):t==="cubeTexture"||t==="cubeDepthTexture"?g=new Fw(s.name,s.node,c,v):t==="texture3D"&&(g=new mg(s.name,s.node,c,v)),g.store=e.isStorageTextureNode===!0,g.mipLevel=g.store?e.mipLevel:0,g.setVisibility(e0[r]),this.isUnfilterable(e.value)===!1&&g.store===!1){const b=new wj(`${s.name}_sampler`,s.node,c);b.setVisibility(e0[r]),p.push(b,g),a=[b,g]}else p.push(g),a=[g]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const g=this.getSharedDataFromNode(e);let v=g.buffer;if(v===void 0){const b=t==="buffer"?Bw:Nj;v=new b(e,c),g.buffer=v}v.setVisibility(v.getVisibility()|e0[r]),p.push(v),a=v,s.name=i||"NodeBuffer_"+s.id}else{const g=this.uniformGroups[r]||(this.uniformGroups[r]={});let v=g[f];v===void 0&&(v=new Dw(f,c),v.setVisibility(e0[r]),g[f]=v,p.push(v)),a=this.getNodeUniform(s,t),v.addUniform(a)}o.uniformGPU=a}return s}getBuiltin(e,t,r,i=this.shaderStage){const s=this.builtins[i]||(this.builtins[i]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:r}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),i=[];for(const o of t.inputs)i.push(o.name+" : "+this.getType(o.type));let s=`fn ${t.name}( ${i.join(", ")} ) -> ${this.getType(t.type)} {
${r.vars}
${r.code}
`;return r.result&&(s+=`	return ${r.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],r=this.directives[e];if(r!==void 0)for(const i of r)t.push(`enable ${i};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],r=this.builtins[e];if(r!==void 0)for(const{name:i,property:s,type:o}of r.values())t.push(`@builtin( ${i} ) ${s} : ${o}`);return t.join(`,
	`)}getScopedArray(e,t,r,i){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:r,bufferCount:i}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:r,scope:i,bufferType:s,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(s);t.push(`var<${i}> ${r}: array< ${a}, ${o} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const r=this.getBuiltins("attribute");r&&t.push(r);const i=this.getAttributesArray();for(let s=0,o=i.length;s<o;s++){const a=i[s],c=a.name,f=this.getType(a.type);t.push(`@location( ${s} ) ${c} : ${f}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const r of e.members){const i=e.output?"@location( "+r.index+" ) ":"";let s=this.getType(r.type);r.atomic&&(s="atomic< "+s+" >"),t.push(`	${i+r.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const r=this.structs[e];if(r.length>0){const i=[];for(const s of r){let o=`struct ${s.name} {
`;o+=this.getStructMembers(s),o+=`
};`,i.push(o)}t=`
`+i.join(`

`)+`
`}return t}getVar(e,t,r=null){let i=`var ${t} : `;return r!==null?i+=this.generateArrayDeclaration(e,r):i+=this.getType(e),i}getVars(e){const t=[],r=this.vars[e];if(r!==void 0)for(const i of r)t.push(`	${this.getVar(i.type,i.name,i.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,o=this.vars[e];for(let a=0;a<s.length;a++){const c=s[a];if(c.needsInterpolation){let f=`@location( ${a} )`;if(c.interpolationType){const p=c.interpolationSampling!==null?`, ${c.interpolationSampling} )`:" )";f+=` @interpolate( ${c.interpolationType}${p}`}else/^(int|uint|ivec|uvec)/.test(c.type)&&(f+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${f} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&o.includes(c)===!1&&o.push(c)}}const r=this.getBuiltins(e);r&&t.push(r);const i=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}isCustomStruct(e){const t=e.value,r=e.node,i=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&r.structTypeNode!==null,s=r.value&&r.value.array&&typeof r.value.itemSize=="number"&&r.value.array.length>r.value.itemSize;return i&&!s}getUniforms(e){const t=this.uniforms[e],r=[],i=[],s=[],o={};for(const c of t){const f=c.groupNode.name,p=this.bindingsIndexes[f];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="cubeDepthTexture"||c.type==="storageTexture"||c.type==="texture3D"){const g=c.node.value;this.isUnfilterable(g)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(g)?r.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler_comparison;`):r.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name}_sampler : sampler;`));let v,b="";const{primarySamples:T}=this.renderer.backend.utils.getTextureSampleData(g);if(T>1&&(b="_multisampled"),g.isCubeTexture===!0&&g.isDepthTexture===!0)v="texture_depth_cube";else if(g.isCubeTexture===!0)v="texture_cube<f32>";else if(g.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&g.compareFunction===null?v=`texture${b}_2d<f32>`:v=`texture_depth${b}_2d${g.isArrayTexture===!0?"_array":""}`;else if(c.node.isStorageTextureNode===!0){const S=_g(g),N=this.getStorageAccess(c.node,e),C=c.node.value.is3DTexture,P=c.node.value.isArrayTexture;v=`texture_storage_${C?"3d":`2d${P?"_array":""}`}<${S}, ${N}>`}else if(g.isArrayTexture===!0||g.isDataArrayTexture===!0||g.isCompressedArrayTexture===!0)v="texture_2d_array<f32>";else if(g.is3DTexture===!0||g.isData3DTexture===!0)v="texture_3d<f32>";else{const S=this.getComponentTypeFromTexture(g).charAt(0);v=`texture${b}_2d<${S}32>`}r.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var ${c.name} : ${v};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const g=c.node,v=this.getType(g.getNodeType(this)),b=g.bufferCount,T=b>0&&c.type==="buffer"?", "+b:"",S=g.isStorageBufferNode?`storage, ${this.getStorageAccess(g,e)}`:"uniform";if(this.isCustomStruct(c))i.push(`@binding( ${p.binding++} ) @group( ${p.group} ) var<${S}> ${c.name} : ${v};`);else{const C=`	value : array< ${g.isAtomic?`atomic<${v}>`:`${v}`}${T} >`;i.push(this._getWGSLStructBinding(c.name,C,S,p.binding++,p.group))}}else{const g=this.getType(this.getVectorType(c.type)),v=c.groupNode.name;(o[v]||(o[v]={index:p.binding++,id:p.group,snippets:[]})).snippets.push(`	${c.name} : ${g}`)}}for(const c in o){const f=o[c];s.push(this._getWGSLStructBinding(c,f.snippets.join(`,
`),"uniform",f.index,f.id))}return[...r,...i,...s].join(`
`)}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const r=e[t];r.uniforms=this.getUniforms(t),r.attributes=this.getAttributes(t),r.varyings=this.getVaryings(t),r.structs=this.getStructs(t),r.vars=this.getVars(t),r.codes=this.getCodes(t),r.directives=this.getDirectives(t),r.scopedArrays=this.getScopedArrays(t);let i=`// code

`;i+=this.flowCode[t];const s=this.flowNodes[t],o=s[s.length-1],a=o.outputNode,c=a!==void 0&&a.isOutputStructNode===!0;for(const f of s){const p=this.getFlowData(f),g=f.name;if(g&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${g}
`),i+=`${p.code}
	`,f===o&&t!=="compute"){if(i+=`// result

	`,t==="vertex")i+=`varyings.Vertex = ${p.result};`;else if(t==="fragment")if(c)r.returnType=a.getNodeType(this),r.structs+="var<private> output : "+r.returnType+";",i+=`return ${p.result};`;else{let v="	@location(0) color: vec4<f32>";const b=this.getBuiltins("output");b&&(v+=`,
	`+b),r.returnType="OutputStruct",r.structs+=this._getWGSLStruct("OutputStruct",v),r.structs+=`
var<private> output : OutputStruct;`,i+=`output.color = ${p.result};

	return output;`}}}r.flow=i}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment);else{const t=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(e.compute,t)}}getMethod(e,t=null){let r;return t!==null&&(r=this._getWGSLMethod(e+"_"+t)),r===void 0&&(r=this._getWGSLMethod(e)),r||e}getBitcastMethod(e){return`bitcast<${this.getType(e)}>`}getFloatPackingMethod(e){return this.getMethod(`floatpack_${e}_2x16`)}getFloatUnpackingMethod(e){return this.getMethod(`floatunpack_${e}_2x16`)}getTernary(e,t,r){return`select( ${r}, ${t}, ${e} )`}getType(e){return Uj[e]||e}isAvailable(e){let t=ux[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),ux[e]=t),t}_getWGSLMethod(e){return ju[e]!==void 0&&this._include(e),qj[e]}_include(e){const t=ju[e];return t.build(this),this.addInclude(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${kw}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){const[r,i,s]=t;return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${r}, ${i}, ${s} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${r} * numWorkgroups.x )
		+ globalId.z * ( ${r} * numWorkgroups.x ) * ( ${i} * numWorkgroups.y );

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,r,i=0,s=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}
@binding( ${i} ) @group( ${s} )
var<${r}> ${e} : ${o};`}}class Vj{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=K.Depth24PlusStencil8:e.depth&&(t=K.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,o=s.getRenderTarget();t=o?o.samples:s.currentSamples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const r=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:r?1:t,isMSAA:r}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorFormats(e){return e.textures!==null?e.textures.map(t=>this.getTextureFormatGPU(t)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return Fl.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return Fl.LineList;if(e.isLine)return Fl.LineStrip;if(e.isMesh)return Fl.TriangleList}getSampleCount(e){return e>=4?4:1}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const t=this.backend.parameters.outputType;if(t===void 0)return navigator.gpu.getPreferredCanvasFormat();if(t===ni)return K.BGRA8Unorm;if(t===rr)return K.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const Uw=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&Uw.set(Float16Array,["float16"]);const zj=new Map([[Rb,["float16"]]]),$j=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class jj{constructor(e){this.backend=e}createAttribute(e,t){const r=this._getBufferAttribute(e),i=this.backend,s=i.get(r);let o=s.buffer;if(o===void 0){const a=i.device;let c=r.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let g=0;g<c.length;g++)c[g]===65535&&(c[g]=4294967295)}if(r.array=c,(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&r.itemSize===3){c=new c.constructor(r.count*4);for(let g=0;g<r.count;g++)c.set(r.array.subarray(g*3,g*3+3),g*4);r.itemSize=4,r.array=c,s._force3to4BytesAlignment=!0}const f=c.byteLength,p=f+(4-f%4)%4;o=a.createBuffer({label:r.name,size:p,usage:t,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),s.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),r=this.backend,i=r.device,s=r.get(t),o=r.get(t).buffer;let a=t.array;if(s._force3to4BytesAlignment===!0){a=new a.constructor(t.count*4);for(let f=0;f<t.count;f++)a.set(t.array.subarray(f*3,f*3+3),f*4);t.array=a}const c=t.updateRanges;if(c.length===0)i.queue.writeBuffer(o,0,a,0);else{const f=G0(a),p=f?1:a.BYTES_PER_ELEMENT;for(let g=0,v=c.length;g<v;g++){const b=c[g];let T,S;if(s._force3to4BytesAlignment===!0){const C=Math.floor(b.start/3),P=Math.ceil(b.count/3);T=C*4*p,S=P*4*p}else T=b.start*p,S=b.count*p;const N=T*(f?a.BYTES_PER_ELEMENT:1);i.queue.writeBuffer(o,N,a,T,S)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),r=new Map;for(let i=0;i<t.length;i++){const s=t[i],o=s.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(s);let c=r.get(a);if(c===void 0){let g,v;s.isInterleavedBufferAttribute===!0?(g=s.data.stride*o,v=s.data.isInstancedInterleavedBuffer?Jc.Instance:Jc.Vertex):(g=s.itemSize*o,v=s.isInstancedBufferAttribute?Jc.Instance:Jc.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(g=4),c={arrayStride:g,attributes:[],stepMode:v},r.set(a,c)}const f=this._getVertexFormat(s),p=s.isInterleavedBufferAttribute===!0?s.offset*o:0;c.attributes.push({shaderLocation:i,offset:p,format:f})}return Array.from(r.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,r=t.device,s=t.get(this._getBufferAttribute(e)).buffer,o=s.size,a=r.createBuffer({label:`${e.name}_readback`,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=r.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(s,0,a,0,o);const f=c.finish();r.queue.submit([f]),await a.mapAsync(GPUMapMode.READ);const p=a.getMappedRange(),g=new e.array.constructor(p.slice(0));return a.unmap(),g.buffer}_getVertexFormat(e){const{itemSize:t,normalized:r}=e,i=e.array.constructor,s=e.constructor;let o;if(t===1)o=$j.get(i);else{const c=(zj.get(s)||Uw.get(i))[r?1:0];if(c){const f=i.BYTES_PER_ELEMENT*t,g=Math.floor((f+3)/4)*4/i.BYTES_PER_ELEMENT;if(g%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${g}`}}return o||Pe("WebGPUAttributeUtils: Vertex format not supported yet."),o}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class Hj{constructor(e){this.layoutGPU=e,this.usedTimes=0}}class Wj{constructor(e){this.backend=e,this._bindGroupLayoutCache=new Map}createBindingsLayout(e){const t=this.backend,r=t.device,i=t.get(e);if(i.layout)return i.layout.layoutGPU;const s=this._createLayoutEntries(e),o=JSON.stringify(s);let a=this._bindGroupLayoutCache.get(o);return a===void 0&&(a=new Hj(r.createBindGroupLayout({entries:s})),this._bindGroupLayoutCache.set(o,a)),a.usedTimes++,i.layout=a,i.layoutKey=o,a.layoutGPU}createBindings(e,t,r,i=0){const{backend:s}=this,o=s.get(e),a=this.createBindingsLayout(e);let c;r>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[r]===i&&(c=o.groups[r])),c===void 0&&(c=this.createBindGroup(e,a),r>0&&(o.groups[r]=c,o.versions[r]=i)),o.group=c}updateBinding(e){const t=this.backend,r=t.device,i=e.buffer,s=t.get(e).buffer,o=e.updateRanges;if(o.length===0)r.queue.writeBuffer(s,0,i,0);else{const a=G0(i),c=a?1:i.BYTES_PER_ELEMENT;for(let f=0,p=o.length;f<p;f++){const g=o[f],v=g.start*c,b=g.count*c,T=v*(a?i.BYTES_PER_ELEMENT:1);r.queue.writeBuffer(s,T,i,v,b)}e.clearUpdateRanges()}}createBindGroupIndex(e,t){const i=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,o=e[0],a=i.createBuffer({label:"bindingCameraIndex_"+o,size:16,usage:s});i.queue.writeBuffer(a,0,e,0);const c=[{binding:0,resource:{buffer:a}}];return i.createBindGroup({label:"bindGroupCameraIndex_"+o,layout:t,entries:c})}createBindGroup(e,t){const r=this.backend,i=r.device;let s=0;const o=[];for(const a of e.bindings){if(a.isUniformBuffer){const c=r.get(a);if(c.buffer===void 0){const f=a.byteLength,p=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,g=[];a.visibility&La.VERTEX&&g.push("vertex"),a.visibility&La.FRAGMENT&&g.push("fragment"),a.visibility&La.COMPUTE&&g.push("compute");const v=`(${g.join(",")})`,b=i.createBuffer({label:`bindingBuffer${a.id}_${a.name}_${v}`,size:f,usage:p});c.buffer=b}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isStorageBuffer){const c=r.get(a);if(c.buffer===void 0){const f=a.attribute;c.buffer=r.get(f).buffer}o.push({binding:s,resource:{buffer:c.buffer}})}else if(a.isSampledTexture){const c=r.get(a.texture);let f;if(c.externalTexture!==void 0)f=i.importExternalTexture({source:c.externalTexture});else{const p=a.store?1:c.texture.mipLevelCount,g=a.store?a.mipLevel:0;let v=`view-${c.texture.width}-${c.texture.height}`;if(c.texture.depthOrArrayLayers>1&&(v+=`-${c.texture.depthOrArrayLayers}`),v+=`-${p}-${g}`,f=c[v],f===void 0){const b=Tj.All;let T;a.isSampledCubeTexture?T=Ln.Cube:a.isSampledTexture3D?T=Ln.ThreeD:a.texture.isArrayTexture||a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?T=Ln.TwoDArray:T=Ln.TwoD,f=c[v]=c.texture.createView({aspect:b,dimension:T,mipLevelCount:p,baseMipLevel:g})}}o.push({binding:s,resource:f})}else if(a.isSampler){const c=r.get(a.texture);o.push({binding:s,resource:c.sampler})}s++}return i.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}_createLayoutEntries(e){const t=[];let r=0;for(const i of e.bindings){const s=this.backend,o={binding:r,visibility:i.visibility};if(i.isUniformBuffer||i.isStorageBuffer){const a={};i.isStorageBuffer&&(i.visibility&La.COMPUTE&&(i.access===ir.READ_WRITE||i.access===ir.WRITE_ONLY)?a.type=Tp.Storage:a.type=Tp.ReadOnlyStorage),o.buffer=a}else if(i.isSampledTexture&&i.store){const a={};a.format=this.backend.get(i.texture).texture.format;const c=i.access;c===ir.READ_WRITE?a.access=wp.ReadWrite:c===ir.WRITE_ONLY?a.access=wp.WriteOnly:a.access=wp.ReadOnly,i.texture.isArrayTexture?a.viewDimension=Ln.TwoDArray:i.texture.is3DTexture&&(a.viewDimension=Ln.ThreeD),o.storageTexture=a}else if(i.isSampledTexture){const a={},{primarySamples:c}=s.utils.getTextureSampleData(i.texture);if(c>1&&(a.multisampled=!0,i.texture.isDepthTexture||(a.sampleType=pa.UnfilterableFloat)),i.texture.isDepthTexture)s.compatibilityMode&&i.texture.compareFunction===null?a.sampleType=pa.UnfilterableFloat:a.sampleType=pa.Depth;else if(i.texture.isDataTexture||i.texture.isDataArrayTexture||i.texture.isData3DTexture){const f=i.texture.type;f===wr?a.sampleType=pa.SInt:f===Fn?a.sampleType=pa.UInt:f===mi&&(this.backend.hasFeature("float32-filterable")?a.sampleType=pa.Float:a.sampleType=pa.UnfilterableFloat)}i.isSampledCubeTexture?a.viewDimension=Ln.Cube:i.texture.isArrayTexture||i.texture.isDataArrayTexture||i.texture.isCompressedArrayTexture?a.viewDimension=Ln.TwoDArray:i.isSampledTexture3D&&(a.viewDimension=Ln.ThreeD),o.texture=a}else if(i.isSampler){const a={};i.texture.isDepthTexture&&(i.texture.compareFunction!==null?a.type=ix.Comparison:s.compatibilityMode&&(a.type=ix.NonFiltering)),o.sampler=a}else Pe(`WebGPUBindingUtils: Unsupported binding "${i}".`);t.push(o),r++}return t}deleteBindGroupData(e){const{backend:t}=this,r=t.get(e);r.layout&&(r.layout.usedTimes--,r.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(r.layoutKey),r.layout=void 0,r.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class Qj{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:r,material:i,geometry:s,pipeline:o}=e,{vertexProgram:a,fragmentProgram:c}=o,f=this.backend,p=f.device,g=f.utils,v=f.get(o),b=[];for(const re of e.getBindings()){const oe=f.get(re),{layoutGPU:Y}=oe.layout;b.push(Y)}const T=f.attributeUtils.createShaderVertexBuffers(e);let S;i.blending!==Ql&&(i.blending!==js||i.transparent!==!1)&&(S=this._getBlending(i));let N={};i.stencilWrite===!0&&(N={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const C=this._getColorWriteMask(i),P=[];if(e.context.textures!==null){const re=e.context.textures;for(let oe=0;oe<re.length;oe++){const Y=g.getTextureFormatGPU(re[oe]);oe===0?P.push({format:Y,blend:S,writeMask:C}):P.push({format:Y,writeMask:C})}}else{const re=g.getCurrentColorFormat(e.context);P.push({format:re,blend:S,writeMask:C})}const B=f.get(a).module,F=f.get(c).module,q=this._getPrimitiveState(r,s,i),I=this._getDepthCompare(i),U=g.getCurrentDepthStencilFormat(e.context),G=this._getSampleCount(e.context),H={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},B,{buffers:T}),fragment:Object.assign({},F,{targets:P}),primitive:q,multisample:{count:G,alphaToCoverageEnabled:i.alphaToCoverage&&G>1},layout:p.createPipelineLayout({bindGroupLayouts:b})},te={},W=e.context.depth,Z=e.context.stencil;if((W===!0||Z===!0)&&(W===!0&&(te.format=U,te.depthWriteEnabled=i.depthWrite,te.depthCompare=I),Z===!0&&(te.stencilFront=N,te.stencilBack={},te.stencilReadMask=i.stencilFuncMask,te.stencilWriteMask=i.stencilWriteMask),i.polygonOffset===!0&&(te.depthBias=i.polygonOffsetUnits,te.depthBiasSlopeScale=i.polygonOffsetFactor,te.depthBiasClamp=0),H.depthStencil=te),p.pushErrorScope("validation"),t===null)v.pipeline=p.createRenderPipeline(H),p.popErrorScope().then(re=>{re!==null&&(v.error=!0,Pe(re.message))});else{const re=new Promise(async oe=>{try{v.pipeline=await p.createRenderPipelineAsync(H)}catch{}const Y=await p.popErrorScope();Y!==null&&(v.error=!0,Pe(Y.message)),oe()});t.push(re)}}createBundleEncoder(e,t="renderBundleEncoder"){const r=this.backend,{utils:i,device:s}=r,o=i.getCurrentDepthStencilFormat(e),a=i.getCurrentColorFormats(e),c=this._getSampleCount(e),f={label:t,colorFormats:a,depthStencilFormat:o,sampleCount:c};return s.createRenderBundleEncoder(f)}createComputePipeline(e,t){const r=this.backend,i=r.device,s=r.get(e.computeProgram).module,o=r.get(e),a=[];for(const c of t){const f=r.get(c),{layoutGPU:p}=f.layout;a.push(p)}o.pipeline=i.createComputePipeline({compute:s,layout:i.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,r;const i=e.blending,s=e.blendSrc,o=e.blendDst,a=e.blendEquation;if(i===sA){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,f=e.blendDstAlpha!==null?e.blendDstAlpha:o,p=e.blendEquationAlpha!==null?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},r={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(f),operation:this._getBlendOperation(p)}}else{const c=e.premultipliedAlpha,f=(p,g,v,b)=>{t={srcFactor:p,dstFactor:g,operation:da.Add},r={srcFactor:v,dstFactor:b,operation:da.Add}};if(c)switch(i){case js:f(wt.One,wt.OneMinusSrcAlpha,wt.One,wt.OneMinusSrcAlpha);break;case $0:f(wt.One,wt.One,wt.One,wt.One);break;case z0:f(wt.Zero,wt.OneMinusSrc,wt.Zero,wt.One);break;case V0:f(wt.Dst,wt.OneMinusSrcAlpha,wt.Zero,wt.One);break}else switch(i){case js:f(wt.SrcAlpha,wt.OneMinusSrcAlpha,wt.One,wt.OneMinusSrcAlpha);break;case $0:f(wt.SrcAlpha,wt.One,wt.One,wt.One);break;case z0:Pe("WebGPURenderer: SubtractiveBlending requires material.premultipliedAlpha = true");break;case V0:Pe("WebGPURenderer: MultiplyBlending requires material.premultipliedAlpha = true");break}}if(t!==void 0&&r!==void 0)return{color:t,alpha:r};Pe("WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(e){let t;switch(e){case No:t=wt.Zero;break;case fb:t=wt.One;break;case hb:t=wt.Src;break;case ab:t=wt.OneMinusSrc;break;case cb:t=wt.SrcAlpha;break;case ob:t=wt.OneMinusSrcAlpha;break;case ub:t=wt.Dst;break;case sb:t=wt.OneMinusDst;break;case lb:t=wt.DstAlpha;break;case ib:t=wt.OneMinusDstAlpha;break;case Ab:t=wt.SrcAlphaSaturated;break;case qk:t=wt.Constant;break;case Gk:t=wt.OneMinusConstant;break;default:Pe("WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const r=e.stencilFunc;switch(r){case WN:t=Jn.Never;break;case HN:t=Jn.Always;break;case jN:t=Jn.Less;break;case $N:t=Jn.LessEqual;break;case zN:t=Jn.Equal;break;case VN:t=Jn.GreaterEqual;break;case GN:t=Jn.Greater;break;case qN:t=Jn.NotEqual;break;default:Pe("WebGPURenderer: Invalid stencil function.",r)}return t}_getStencilOperation(e){let t;switch(e){case tR:t=To.Keep;break;case eR:t=To.Zero;break;case JN:t=To.Replace;break;case ZN:t=To.Invert;break;case KN:t=To.IncrementClamp;break;case XN:t=To.DecrementClamp;break;case YN:t=To.IncrementWrap;break;case QN:t=To.DecrementWrap;break;default:Pe("WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case qs:t=da.Add;break;case rb:t=da.Subtract;break;case nb:t=da.ReverseSubtract;break;case rR:t=da.Min;break;case nR:t=da.Max;break;default:Pe("WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,r){const i={},s=this.backend.utils;i.topology=s.getPrimitiveTopology(e,r),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(i.stripIndexFormat=t.index.array instanceof Uint16Array?au.Uint16:au.Uint32);let o=r.side===mr;return e.isMesh&&e.matrixWorld.determinant()<0&&(o=!o),i.frontFace=o===!0?tx.CW:tx.CCW,i.cullMode=r.side===vi?nx.None:nx.Back,i}_getColorWriteMask(e){return e.colorWrite===!0?rx.All:rx.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=Jn.Always;else{const r=e.depthFunc;switch(r){case xb:t=Jn.Never;break;case vb:t=Jn.Always;break;case yb:t=Jn.Less;break;case _b:t=Jn.LessEqual;break;case gb:t=Jn.Equal;break;case mb:t=Jn.GreaterEqual;break;case pb:t=Jn.Greater;break;case db:t=Jn.NotEqual;break;default:Pe("WebGPUPipelineUtils: Invalid depth function.",r)}}return t}}class Yj extends Iw{constructor(e,t,r=2048){super(r),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const i=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return cn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,r=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const i=this.device.createCommandEncoder();i.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),i.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,r);const s=i.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,r),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,r)),a={},c=[];for(const[p,g]of e){const v=p.match(/^(.*):f(\d+)$/),b=parseInt(v[2]);c.includes(b)===!1&&c.push(b),a[b]===void 0&&(a[b]=0);const T=o[g],S=o[g+1],N=Number(S-T)/1e6;this.timestamps.set(p,N),a[b]+=N}const f=a[c[c.length-1]];return this.resultBuffer.unmap(),this.lastValue=f,this.frames=c,f}catch(e){return Pe("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){Pe("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){Pe("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class Xj extends Ow{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.compatibilityMode=e.compatibilityMode===void 0?!1:e.compatibilityMode,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new Vj(this),this.attributeUtils=new jj(this),this.bindingUtils=new Wj(this),this.pipelineUtils=new Qj(this),this.textureUtils=new Pj(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let r;if(t.device===void 0){const i={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},s=typeof navigator<"u"?await navigator.gpu.requestAdapter(i):null;if(s===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const o=Object.values(gg),a=[];for(const f of o)s.features.has(f)&&a.push(f);const c={requiredFeatures:a,requiredLimits:t.requiredLimits};r=await s.requestDevice(c)}else r=t.device;r.lost.then(i=>{if(i.reason==="destroyed")return;const s={api:"WebGPU",message:i.message||"Unknown reason",reason:i.reason||null,originalEvent:i};e.onDeviceLost(s)}),this.device=r,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(gg.TimestampQuery),this.updateSize()}get context(){const e=this.renderer.getCanvasTarget(),t=this.get(e);let r=t.context;if(r===void 0){const i=this.parameters;e.isDefaultCanvasTarget===!0&&i.context!==void 0?r=i.context:r=e.domElement.getContext("webgpu"),"setAttribute"in e.domElement&&e.domElement.setAttribute("data-engine",`three.js r${Jh} webgpu`);const s=i.alpha?"premultiplied":"opaque",o=i.outputType===rr?"extended":"standard";r.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s,toneMapping:{mode:o}}),t.context=r}return r}get coordinateSystem(){return Vo}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const e=this.renderer,t=e.getCanvasTarget(),r=this.get(t),i=e.currentSamples;let s=r.descriptor;if(s===void 0||r.samples!==i){s={colorAttachments:[{view:null}]},(e.depth===!0||e.stencil===!0)&&(s.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(e.depth,e.stencil).createView()});const a=s.colorAttachments[0];i>0?a.view=this.textureUtils.getColorBuffer().createView():a.resolveTarget=void 0,r.descriptor=s,r.samples=i}const o=s.colorAttachments[0];return i>0?o.resolveTarget=this.context.getCurrentTexture().createView():o.view=this.context.getCurrentTexture().createView(),s}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const r=e.renderTarget,i=this.get(r);let s=i.descriptors;(s===void 0||i.width!==r.width||i.height!==r.height||i.samples!==r.samples)&&(s={},i.descriptors=s);const o=e.getCacheKey();let a=s[o];if(a===void 0){const f=e.textures,p=[];let g;const v=this._isRenderCameraDepthArray(e);for(let b=0;b<f.length;b++){const T=this.get(f[b]),S={label:`colorAttachment_${b}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Ln.TwoD};if(r.isRenderTarget3D)g=e.activeCubeFace,S.baseArrayLayer=0,S.dimension=Ln.ThreeD,S.depthOrArrayLayers=f[b].image.depth;else if(r.isRenderTarget&&f[b].image.depth>1)if(v===!0){const N=e.camera.cameras;for(let C=0;C<N.length;C++){const P={...S,baseArrayLayer:C,arrayLayerCount:1,dimension:Ln.TwoD},B=T.texture.createView(P);p.push({view:B,resolveTarget:void 0,depthSlice:void 0})}}else S.dimension=Ln.TwoDArray,S.depthOrArrayLayers=f[b].image.depth;if(v!==!0){const N=T.texture.createView(S);let C,P;T.msaaTexture!==void 0?(C=T.msaaTexture.createView(),P=N):(C=N,P=void 0),p.push({view:C,resolveTarget:P,depthSlice:g})}}if(a={textureViews:p},e.depth){const b=this.get(e.depthTexture),T={};(e.depthTexture.isArrayTexture||e.depthTexture.isCubeTexture)&&(T.dimension=Ln.TwoD,T.arrayLayerCount=1,T.baseArrayLayer=e.activeCubeFace),a.depthStencilView=b.texture.createView(T)}s[o]=a,i.width=r.width,i.height=r.height,i.samples=r.samples,i.activeMipmapLevel=e.activeMipmapLevel,i.activeCubeFace=e.activeCubeFace}const c={colorAttachments:[]};for(let f=0;f<a.textureViews.length;f++){const p=a.textureViews[f];let g={r:0,g:0,b:0,a:1};f===0&&t.clearValue&&(g=t.clearValue),c.colorAttachments.push({view:p.view,depthSlice:p.depthSlice,resolveTarget:p.resolveTarget,loadOp:t.loadOp||Lt.Load,storeOp:t.storeOp||Tr.Store,clearValue:g})}return a.depthStencilView&&(c.depthStencilAttachment={view:a.depthStencilView}),c}beginRender(e){const t=this.get(e),r=this.device,i=e.occlusionQueryCount;let s;i>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=r.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(i),t.lastOcclusionObject=null);let o;e.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(e,{loadOp:Lt.Load}),this.initTimestampQuery(ds.RENDER,this.getTimestampUID(e),o),o.occlusionQuerySet=s;const a=o.depthStencilAttachment;if(e.textures!==null){const f=o.colorAttachments;for(let p=0;p<f.length;p++){const g=f[p];e.clearColor?(g.clearValue=p===0?e.clearColorValue:{r:0,g:0,b:0,a:1},g.loadOp=Lt.Clear):g.loadOp=Lt.Load,g.storeOp=Tr.Store}}else{const f=o.colorAttachments[0];e.clearColor?(f.clearValue=e.clearColorValue,f.loadOp=Lt.Clear):f.loadOp=Lt.Load,f.storeOp=Tr.Store}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=Lt.Clear):a.depthLoadOp=Lt.Load,a.depthStoreOp=Tr.Store),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=Lt.Clear):a.stencilLoadOp=Lt.Load,a.stencilStoreOp=Tr.Store);const c=r.createCommandEncoder({label:"renderContext_"+e.id});if(this._isRenderCameraDepthArray(e)===!0){const f=e.camera.cameras;!t.layerDescriptors||t.layerDescriptors.length!==f.length?this._createDepthLayerDescriptors(e,t,o,f):this._updateDepthLayerDescriptors(e,t,f),t.bundleEncoders=[],t.bundleSets=[];for(let p=0;p<f.length;p++){const g=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+p),v={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(g),t.bundleSets.push(v)}t.currentPass=null}else{const f=c.beginRenderPass(o);t.currentPass=f,e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}t.descriptor=o,t.encoder=c,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,r,i){const s=r.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let a=0;a<i.length;a++){const c={...r,colorAttachments:[{...r.colorAttachments[0],view:r.colorAttachments[a].view}]};if(r.depthStencilAttachment){const f=a;o.viewCache[f]||(o.viewCache[f]=o.texture.createView({dimension:Ln.TwoD,baseArrayLayer:a,arrayLayerCount:1})),c.depthStencilAttachment={view:o.viewCache[f],depthLoadOp:s.depthLoadOp||Lt.Clear,depthStoreOp:s.depthStoreOp||Tr.Store,depthClearValue:s.depthClearValue||1},e.stencil&&(c.depthStencilAttachment.stencilLoadOp=s.stencilLoadOp,c.depthStencilAttachment.stencilStoreOp=s.stencilStoreOp,c.depthStencilAttachment.stencilClearValue=s.stencilClearValue)}else c.depthStencilAttachment={...s};t.layerDescriptors.push(c)}}_updateDepthLayerDescriptors(e,t,r){for(let i=0;i<r.length;i++){const s=t.layerDescriptors[i];if(s.depthStencilAttachment){const o=s.depthStencilAttachment;e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=Lt.Clear):o.depthLoadOp=Lt.Load),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=Lt.Clear):o.stencilLoadOp=Lt.Load)}}}finishRender(e){const t=this.get(e),r=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),r>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const i=t.encoder;if(this._isRenderCameraDepthArray(e)===!0){const s=[];for(let o=0;o<t.bundleEncoders.length;o++){const a=t.bundleEncoders[o];s.push(a.finish())}for(let o=0;o<t.layerDescriptors.length;o++)if(o<s.length){const a=t.layerDescriptors[o],c=i.beginRenderPass(a);if(e.viewport){const{x:f,y:p,width:g,height:v,minDepth:b,maxDepth:T}=e.viewportValue;c.setViewport(f,p,g,v,b,T)}if(e.scissor){const{x:f,y:p,width:g,height:v}=e.scissorValue;c.setScissorRect(f,p,g,v)}c.executeBundles([s[o]]),c.end()}}else t.currentPass&&t.currentPass.end();if(r>0){const s=r*8;let o=this.occludedResolveCache.get(s);o===void 0&&(o=this.device.createBuffer({size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(s,o));const a=this.device.createBuffer({size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,r,o,0),t.encoder.copyBufferToBuffer(o,0,a,0,s),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const s=e.textures;for(let o=0;o<s.length;o++){const a=s[o];a.generateMipmaps===!0&&this.textureUtils.generateMipmaps(a)}}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:r,currentOcclusionQueryObjects:i}=t;if(r&&i){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await r.mapAsync(GPUMapMode.READ);const o=r.getMappedRange(),a=new BigUint64Array(o);for(let c=0;c<i.length;c++)a[c]===BigInt(0)&&s.add(i[c]);r.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:r,y:i,width:s,height:o,minDepth:a,maxDepth:c}=e.viewportValue;t.setViewport(r,i,s,o,a,c)}updateScissor(e){const{currentPass:t}=this.get(e),{x:r,y:i,width:s,height:o}=e.scissorValue;t.setScissorRect(r,i,s,o)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,r,i=null){const s=this.device,o=this.renderer;let a=[],c,f,p,g;if(e){const T=this.getClearColor();f={r:T.r,g:T.g,b:T.b,a:T.a}}if(i===null){p=o.depth,g=o.stencil;const T=this._getDefaultRenderPassDescriptor();if(e){a=T.colorAttachments;const S=a[0];S.clearValue=f,S.loadOp=Lt.Clear,S.storeOp=Tr.Store}(p||g)&&(c=T.depthStencilAttachment)}else{p=i.depth,g=i.stencil;const T={loadOp:e?Lt.Clear:Lt.Load,clearValue:e?f:void 0};p&&(T.depthLoadOp=t?Lt.Clear:Lt.Load,T.depthClearValue=t?o.getClearDepth():void 0,T.depthStoreOp=Tr.Store),g&&(T.stencilLoadOp=r?Lt.Clear:Lt.Load,T.stencilClearValue=r?o.getClearStencil():void 0,T.stencilStoreOp=Tr.Store);const S=this._getRenderPassDescriptor(i,T);a=S.colorAttachments,c=S.depthStencilAttachment}p&&c&&(t?(c.depthLoadOp=Lt.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=Tr.Store):(c.depthLoadOp=Lt.Load,c.depthStoreOp=Tr.Store)),g&&c&&(r?(c.stencilLoadOp=Lt.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=Tr.Store):(c.stencilLoadOp=Lt.Load,c.stencilStoreOp=Tr.Store));const v=s.createCommandEncoder({label:"clear"});v.beginRenderPass({colorAttachments:a,depthStencilAttachment:c}).end(),s.queue.submit([v.finish()])}beginCompute(e){const t=this.get(e),r={label:"computeGroup_"+e.id};this.initTimestampQuery(ds.COMPUTE,this.getTimestampUID(e),r),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(r)}compute(e,t,r,i,s=null){const o=this.get(t),{passEncoderGPU:a}=this.get(e),c=this.get(i).pipeline;this.pipelineUtils.setPipeline(a,c);for(let f=0,p=r.length;f<p;f++){const g=r[f],v=this.get(g);a.setBindGroup(f,v.group)}if(s===null&&(s=t.count),s&&typeof s=="object"&&s.isIndirectStorageBufferAttribute){const f=this.get(s).buffer;a.dispatchWorkgroupsIndirect(f,0);return}if(typeof s=="number"){const f=s;if(o.dispatchSize===void 0||o.count!==f){o.dispatchSize=[0,1,1],o.count=f;const p=t.workgroupSize;let g=p[0];for(let T=1;T<p.length;T++)g*=p[T];const v=Math.ceil(f/g),b=this.device.limits.maxComputeWorkgroupsPerDimension;s=[v,1,1],v>b&&(s[0]=Math.min(v,b),s[1]=Math.ceil(v/b)),o.dispatchSize=s}s=o.dispatchSize}a.dispatchWorkgroups(s[0],s[1]||1,s[2]||1)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}draw(e,t){const{object:r,material:i,context:s,pipeline:o}=e,a=e.getBindings(),c=this.get(s),f=this.get(o),p=f.pipeline;if(f.error===!0)return;const g=e.getIndex(),v=g!==null,b=e.getDrawParameters();if(b===null)return;const T=(N,C)=>{this.pipelineUtils.setPipeline(N,p),C.pipeline=p;const P=C.bindingGroups;for(let F=0,q=a.length;F<q;F++){const I=a[F],U=this.get(I);P[I.index]!==I.id&&(N.setBindGroup(I.index,U.group),P[I.index]=I.id)}if(v===!0&&C.index!==g){const F=this.get(g).buffer,q=g.array instanceof Uint16Array?au.Uint16:au.Uint32;N.setIndexBuffer(F,q),C.index=g}const B=e.getVertexBuffers();for(let F=0,q=B.length;F<q;F++){const I=B[F];if(C.attributes[F]!==I){const U=this.get(I).buffer;N.setVertexBuffer(F,U),C.attributes[F]=I}}s.stencil===!0&&i.stencilWrite===!0&&c.currentStencilRef!==i.stencilRef&&(N.setStencilReference(i.stencilRef),c.currentStencilRef=i.stencilRef)},S=(N,C)=>{if(T(N,C),r.isBatchedMesh===!0){const P=r._multiDrawStarts,B=r._multiDrawCounts,F=r._multiDrawCount,q=r._multiDrawInstances;q!==null&&cn("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let I=0;I<F;I++){const U=q?q[I]:1,G=U>1?0:I;v===!0?N.drawIndexed(B[I],U,P[I]/g.array.BYTES_PER_ELEMENT,0,G):N.draw(B[I],U,P[I],G),t.update(r,B[I],U)}}else if(v===!0){const{vertexCount:P,instanceCount:B,firstVertex:F}=b,q=e.getIndirect();if(q!==null){const I=this.get(q).buffer,U=e.getIndirectOffset(),G=Array.isArray(U)?U:[U];for(let H=0;H<G.length;H++)N.drawIndexedIndirect(I,G[H])}else N.drawIndexed(P,B,F,0,0);t.update(r,P,B)}else{const{vertexCount:P,instanceCount:B,firstVertex:F}=b,q=e.getIndirect();if(q!==null){const I=this.get(q).buffer,U=e.getIndirectOffset(),G=Array.isArray(U)?U:[U];for(let H=0;H<G.length;H++)N.drawIndirect(I,G[H])}else N.draw(P,B,F,0);t.update(r,P,B)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const N=this.get(e.camera),C=e.camera.cameras,P=e.getBindingGroup("cameraIndex");if(N.indexesGPU===void 0||N.indexesGPU.length!==C.length){const F=this.get(P),q=[],I=new Uint32Array([0,0,0,0]);for(let U=0,G=C.length;U<G;U++){I[0]=U;const{layoutGPU:H}=F.layout,te=this.bindingUtils.createBindGroupIndex(I,H);q.push(te)}N.indexesGPU=q}const B=this.renderer.getPixelRatio();for(let F=0,q=C.length;F<q;F++){const I=C[F];if(r.layers.test(I.layers)){const U=I.viewport;let G=c.currentPass,H=c.currentSets;if(c.bundleEncoders){const te=c.bundleEncoders[F],W=c.bundleSets[F];G=te,H=W}U&&G.setViewport(Math.floor(U.x*B),Math.floor(U.y*B),Math.floor(U.width*B),Math.floor(U.height*B),s.viewportValue.minDepth,s.viewportValue.maxDepth),P&&N.indexesGPU&&(G.setBindGroup(P.index,N.indexesGPU[F]),H.bindingGroups[P.index]=P.id),S(G,H)}}}else if(c.currentPass){if(c.occlusionQuerySet!==void 0){const N=c.lastOcclusionObject;N!==r&&(N!==null&&N.occlusionTest===!0&&(c.currentPass.endOcclusionQuery(),c.occlusionQueryIndex++),r.occlusionTest===!0&&(c.currentPass.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=r),c.lastOcclusionObject=r)}S(c.currentPass,c.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:r,material:i}=e,s=this.utils,o=s.getSampleCountRenderContext(e.context),a=s.getCurrentColorSpace(e.context),c=s.getCurrentColorFormat(e.context),f=s.getCurrentDepthStencilFormat(e.context),p=s.getPrimitiveTopology(r,i);let g=!1;return(t.material!==i||t.materialVersion!==i.version||t.transparent!==i.transparent||t.blending!==i.blending||t.premultipliedAlpha!==i.premultipliedAlpha||t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst||t.blendEquation!==i.blendEquation||t.blendSrcAlpha!==i.blendSrcAlpha||t.blendDstAlpha!==i.blendDstAlpha||t.blendEquationAlpha!==i.blendEquationAlpha||t.colorWrite!==i.colorWrite||t.depthWrite!==i.depthWrite||t.depthTest!==i.depthTest||t.depthFunc!==i.depthFunc||t.stencilWrite!==i.stencilWrite||t.stencilFunc!==i.stencilFunc||t.stencilFail!==i.stencilFail||t.stencilZFail!==i.stencilZFail||t.stencilZPass!==i.stencilZPass||t.stencilFuncMask!==i.stencilFuncMask||t.stencilWriteMask!==i.stencilWriteMask||t.side!==i.side||t.alphaToCoverage!==i.alphaToCoverage||t.sampleCount!==o||t.colorSpace!==a||t.colorFormat!==c||t.depthStencilFormat!==f||t.primitiveTopology!==p||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=i,t.materialVersion=i.version,t.transparent=i.transparent,t.blending=i.blending,t.premultipliedAlpha=i.premultipliedAlpha,t.blendSrc=i.blendSrc,t.blendDst=i.blendDst,t.blendEquation=i.blendEquation,t.blendSrcAlpha=i.blendSrcAlpha,t.blendDstAlpha=i.blendDstAlpha,t.blendEquationAlpha=i.blendEquationAlpha,t.colorWrite=i.colorWrite,t.depthWrite=i.depthWrite,t.depthTest=i.depthTest,t.depthFunc=i.depthFunc,t.stencilWrite=i.stencilWrite,t.stencilFunc=i.stencilFunc,t.stencilFail=i.stencilFail,t.stencilZFail=i.stencilZFail,t.stencilZPass=i.stencilZPass,t.stencilFuncMask=i.stencilFuncMask,t.stencilWriteMask=i.stencilWriteMask,t.side=i.side,t.alphaToCoverage=i.alphaToCoverage,t.sampleCount=o,t.colorSpace=a,t.colorFormat=c,t.depthStencilFormat=f,t.primitiveTopology=p,t.clippingContextCacheKey=e.clippingContextCacheKey,g=!0),g}getRenderCacheKey(e){const{object:t,material:r}=e,i=this.utils,s=e.context,o=t.isMesh&&t.matrixWorld.determinant()<0;return[r.transparent,r.blending,r.premultipliedAlpha,r.blendSrc,r.blendDst,r.blendEquation,r.blendSrcAlpha,r.blendDstAlpha,r.blendEquationAlpha,r.colorWrite,r.depthWrite,r.depthTest,r.depthFunc,r.stencilWrite,r.stencilFunc,r.stencilFail,r.stencilZFail,r.stencilZPass,r.stencilFuncMask,r.stencilWriteMask,r.side,o,i.getSampleCountRenderContext(s),i.getCurrentColorSpace(s),i.getCurrentColorFormat(s),i.getCurrentDepthStencilFormat(s),i.getPrimitiveTopology(t,r),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}updateSampler(e){return this.textureUtils.updateSampler(e)}createDefaultTexture(e){return this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e,t=!1){this.textureUtils.destroyTexture(e,t)}async copyTextureToBuffer(e,t,r,i,s,o){return this.textureUtils.copyTextureToBuffer(e,t,r,i,s,o)}initTimestampQuery(e,t,r){if(!this.trackTimestamp)return;this.timestampQueryPool[e]||(this.timestampQueryPool[e]=new Yj(this.device,e,2048));const i=this.timestampQueryPool[e],s=i.allocateQueriesForContext(t);r.timestampWrites={querySet:i.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new Gj(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const r=this.get(e),s=r.currentPass.finish();this.get(t).bundleGPU=s,r.currentSets=r._currentSets,r.currentPass=r._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBindings(e,t,r,i){this.bindingUtils.createBindings(e,t,r,i)}updateBinding(e){this.bindingUtils.updateBinding(e)}deleteBindGroupData(e){this.bindingUtils.deleteBindGroupData(e)}createIndexAttribute(e){let t=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(t|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(e,t)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(e){return ox[e]!==void 0&&(e=ox[e]),this.device.features.has(e)}copyTextureToTexture(e,t,r=null,i=null,s=0,o=0){let a=0,c=0,f=0,p=0,g=0,v=0,b=e.image.width,T=e.image.height,S=1;r!==null&&(r.isBox3===!0?(p=r.min.x,g=r.min.y,v=r.min.z,b=r.max.x-r.min.x,T=r.max.y-r.min.y,S=r.max.z-r.min.z):(p=r.min.x,g=r.min.y,b=r.max.x-r.min.x,T=r.max.y-r.min.y,S=1)),i!==null&&(a=i.x,c=i.y,f=i.z||0);const N=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),C=this.get(e).texture,P=this.get(t).texture;N.copyTextureToTexture({texture:C,mipLevel:s,origin:{x:p,y:g,z:v}},{texture:P,mipLevel:o,origin:{x:a,y:c,z:f}},[b,T,S]),this.device.queue.submit([N.finish()]),o===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,r){const i=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const o=this.get(e).texture;if(s.format!==o.format){Pe("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,o.format);return}let a;if(i.currentPass?(i.currentPass.end(),a=i.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:s,origin:[r.x,r.y,0]},{texture:o},[r.z,r.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e,a),i.currentPass){const{descriptor:c}=i;for(let f=0;f<c.colorAttachments.length;f++)c.colorAttachments[f].loadOp=Lt.Load;t.depth&&(c.depthStencilAttachment.depthLoadOp=Lt.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=Lt.Load),i.currentPass=a.beginRenderPass(c),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}else this.device.queue.submit([a.finish()])}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const e of this.occludedResolveCache.values())e.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const e of Object.values(this.timestampQueryPool))e!==null&&e.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class Kj extends Og{constructor(e,t,r,i,s,o){super(e,t,r,i,s,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Zj extends Og{constructor(e,t,r,i,s,o){super(e,t,r,i,s,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class Jj extends Rw{constructor(){super(),this.addMaterial(RI,"MeshPhongMaterial"),this.addMaterial(S5,"MeshStandardMaterial"),this.addMaterial(yk,"MeshPhysicalMaterial"),this.addMaterial(Tk,"MeshToonMaterial"),this.addMaterial(xI,"MeshBasicMaterial"),this.addMaterial(EI,"MeshLambertMaterial"),this.addMaterial(mI,"MeshNormalMaterial"),this.addMaterial(Sk,"MeshMatcapMaterial"),this.addMaterial(AI,"LineBasicMaterial"),this.addMaterial(hI,"LineDashedMaterial"),this.addMaterial(Mk,"PointsMaterial"),this.addMaterial(N5,"SpriteMaterial"),this.addMaterial(Lk,"ShadowMaterial"),this.addLight(gV,aN),this.addLight(R$,jx),this.addLight(C$,lN),this.addLight(Q2,Og),this.addLight(D$,Hx),this.addLight(L$,uN),this.addLight(F$,AN),this.addLight(M$,Kj),this.addLight(B$,Zj),this.addToneMapping(j5,cN),this.addToneMapping(H5,hN),this.addToneMapping(W5,fN),this.addToneMapping(Q5,dN),this.addToneMapping(Y5,pN),this.addToneMapping(X5,mN)}}class qw extends tj{constructor(e={}){let t;e.forceWebGL?t=ex:(t=Xj,e.getFallback=()=>(Be("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new ex(e)));const r=new t(e);super(r,e),this.library=new Jj,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */R.BRDF_GGX;R.BRDF_Lambert;R.BasicPointShadowFilter;R.BasicShadowFilter;R.Break;R.Const;R.Continue;R.DFGLUT;R.D_GGX;R.Discard;R.EPSILON;R.F_Schlick;const eH=R.Fn;R.INFINITY;const tH=R.If,nH=R.Loop;R.NodeAccess;R.NodeShaderStage;R.NodeType;R.NodeUpdateType;R.PCFShadowFilter;R.PCFSoftShadowFilter;R.PI;R.PI2;R.TWO_PI;R.HALF_PI;R.PointShadowFilter;R.Return;R.Schlick_to_F0;R.ScriptableNodeResources;R.ShaderNode;R.Stack;R.Switch;R.TBNViewMatrix;R.VSMShadowFilter;R.V_GGX_SmithCorrelated;R.Var;R.VarIntent;R.abs;R.acesFilmicToneMapping;R.acos;R.add;R.addMethodChaining;R.addNodeElement;R.agxToneMapping;R.all;R.alphaT;R.and;R.anisotropy;R.anisotropyB;R.anisotropyT;R.any;R.append;R.array;R.arrayBuffer;const rH=R.asin;R.assign;R.atan;R.atan2;R.atomicAdd;R.atomicAnd;R.atomicFunc;R.atomicLoad;R.atomicMax;R.atomicMin;R.atomicOr;R.atomicStore;R.atomicSub;R.atomicXor;R.attenuationColor;R.attenuationDistance;R.attribute;R.attributeArray;R.backgroundBlurriness;R.backgroundIntensity;R.backgroundRotation;R.batch;R.bentNormalView;R.billboarding;R.bitAnd;R.bitNot;R.bitOr;R.bitXor;R.bitangentGeometry;R.bitangentLocal;R.bitangentView;R.bitangentWorld;R.bitcast;R.blendBurn;R.blendColor;R.blendDodge;R.blendOverlay;R.blendScreen;R.blur;R.bool;R.buffer;R.bufferAttribute;R.bumpMap;R.burn;R.builtin;R.builtinAOContext;R.builtinShadowContext;R.bvec2;R.bvec3;R.bvec4;R.bypass;R.cache;R.call;R.cameraFar;R.cameraIndex;R.cameraNear;R.cameraNormalMatrix;R.cameraPosition;R.cameraProjectionMatrix;R.cameraProjectionMatrixInverse;R.cameraViewMatrix;R.cameraViewport;R.cameraWorldMatrix;R.cbrt;R.cdl;R.ceil;R.checker;R.cineonToneMapping;R.clamp;R.clearcoat;R.clearcoatNormalView;R.clearcoatRoughness;R.code;R.color;R.colorSpaceToWorking;R.colorToDirection;R.compute;R.computeKernel;R.computeSkinning;R.context;R.convert;R.convertColorSpace;R.convertToTexture;R.countLeadingZeros;R.countOneBits;R.countTrailingZeros;const iH=R.cos;R.cross;R.cubeTexture;R.cubeTextureBase;R.dFdx;R.dFdy;R.dashSize;R.debug;R.decrement;R.decrementBefore;R.defaultBuildStages;R.defaultShaderStages;R.defined;R.degrees;R.deltaTime;R.densityFog;R.densityFogFactor;R.depth;R.depthPass;R.determinant;R.difference;R.diffuseColor;R.directPointLight;R.directionToColor;R.directionToFaceDirection;R.dispersion;R.distance;R.div;R.dodge;R.dot;R.drawIndex;R.dynamicBufferAttribute;R.element;R.emissive;R.equal;R.equals;R.equirectUV;const sH=R.exp;R.exp2;R.expression;R.faceDirection;R.faceForward;R.faceforward;const oH=R.float;R.floatBitsToInt;R.floatBitsToUint;R.floor;R.fog;R.fract;R.frameGroup;R.frameId;R.frontFacing;R.fwidth;R.gain;R.gapSize;R.getConstNodeType;R.getCurrentStack;R.getDirection;R.getDistanceAttenuation;R.getGeometryRoughness;R.getNormalFromDepth;R.interleavedGradientNoise;R.vogelDiskSample;R.getParallaxCorrectNormal;R.getRoughness;R.getScreenPosition;R.getShIrradianceAt;R.getShadowMaterial;R.getShadowRenderObjectFunction;R.getTextureIndex;R.getViewPosition;R.globalId;R.glsl;R.glslFn;R.grayscale;R.greaterThan;R.greaterThanEqual;R.hash;R.highpModelNormalViewMatrix;R.highpModelViewMatrix;R.hue;R.increment;R.incrementBefore;R.instance;const aH=R.instanceIndex;R.instancedArray;R.instancedBufferAttribute;R.instancedDynamicBufferAttribute;R.instancedMesh;R.int;R.intBitsToFloat;R.inverse;R.inverseSqrt;R.inversesqrt;R.invocationLocalIndex;R.invocationSubgroupIndex;R.ior;R.iridescence;R.iridescenceIOR;R.iridescenceThickness;R.ivec2;R.ivec3;R.ivec4;R.js;R.label;R.length;R.lengthSq;R.lessThan;R.lessThanEqual;R.lightPosition;R.lightProjectionUV;R.lightShadowMatrix;R.lightTargetDirection;R.lightTargetPosition;R.lightViewPosition;R.lightingContext;R.lights;R.linearDepth;R.linearToneMapping;R.localId;R.log;R.log2;R.logarithmicDepthToViewZ;R.luminance;R.mat2;R.mat3;R.mat4;R.matcapUV;R.materialAO;R.materialAlphaTest;R.materialAnisotropy;R.materialAnisotropyVector;R.materialAttenuationColor;R.materialAttenuationDistance;R.materialClearcoat;R.materialClearcoatNormal;R.materialClearcoatRoughness;R.materialColor;R.materialDispersion;R.materialEmissive;R.materialEnvIntensity;R.materialEnvRotation;R.materialIOR;R.materialIridescence;R.materialIridescenceIOR;R.materialIridescenceThickness;R.materialLightMap;R.materialLineDashOffset;R.materialLineDashSize;R.materialLineGapSize;R.materialLineScale;R.materialLineWidth;R.materialMetalness;R.materialNormal;R.materialOpacity;R.materialPointSize;R.materialReference;R.materialReflectivity;R.materialRefractionRatio;R.materialRotation;R.materialRoughness;R.materialSheen;R.materialSheenRoughness;R.materialShininess;R.materialSpecular;R.materialSpecularColor;R.materialSpecularIntensity;R.materialSpecularStrength;R.materialThickness;R.materialTransmission;R.max;R.maxMipLevel;R.mediumpModelViewMatrix;R.metalness;R.min;R.mix;R.mixElement;R.mod;R.modInt;R.modelDirection;R.modelNormalMatrix;R.modelPosition;R.modelRadius;R.modelScale;R.modelViewMatrix;R.modelViewPosition;R.modelViewProjection;R.modelWorldMatrix;R.modelWorldMatrixInverse;R.morphReference;R.mrt;R.mul;R.mx_aastep;R.mx_add;R.mx_atan2;R.mx_cell_noise_float;R.mx_contrast;R.mx_divide;R.mx_fractal_noise_float;R.mx_fractal_noise_vec2;R.mx_fractal_noise_vec3;R.mx_fractal_noise_vec4;R.mx_frame;R.mx_heighttonormal;R.mx_hsvtorgb;R.mx_ifequal;R.mx_ifgreater;R.mx_ifgreatereq;R.mx_invert;R.mx_modulo;R.mx_multiply;R.mx_noise_float;R.mx_noise_vec3;R.mx_noise_vec4;R.mx_place2d;R.mx_power;R.mx_ramp4;R.mx_ramplr;R.mx_ramptb;R.mx_rgbtohsv;R.mx_rotate2d;R.mx_rotate3d;R.mx_safepower;R.mx_separate;R.mx_splitlr;R.mx_splittb;R.mx_srgb_texture_to_lin_rec709;R.mx_subtract;R.mx_timer;R.mx_transform_uv;R.mx_unifiednoise2d;R.mx_unifiednoise3d;R.mx_worley_noise_float;R.mx_worley_noise_vec2;R.mx_worley_noise_vec3;const lH=R.negate;R.neutralToneMapping;R.nodeArray;R.nodeImmutable;R.nodeObject;R.nodeObjectIntent;R.nodeObjects;R.nodeProxy;R.nodeProxyIntent;R.normalFlat;R.normalGeometry;R.normalLocal;R.normalMap;R.normalView;R.normalViewGeometry;R.normalWorld;R.normalWorldGeometry;R.normalize;R.not;R.notEqual;R.numWorkgroups;R.objectDirection;R.objectGroup;R.objectPosition;R.objectRadius;R.objectScale;R.objectViewPosition;R.objectWorldMatrix;R.OnBeforeObjectUpdate;R.OnBeforeMaterialUpdate;R.OnObjectUpdate;R.OnMaterialUpdate;R.oneMinus;R.or;R.orthographicDepthToViewZ;R.oscSawtooth;R.oscSine;R.oscSquare;R.oscTriangle;R.output;R.outputStruct;R.overlay;R.overloadingFn;R.packHalf2x16;R.packSnorm2x16;R.packUnorm2x16;R.parabola;R.parallaxDirection;R.parallaxUV;R.parameter;R.pass;R.passTexture;R.pcurve;R.perspectiveDepthToViewZ;R.pmremTexture;R.pointShadow;R.pointUV;R.pointWidth;R.positionGeometry;R.positionLocal;R.positionPrevious;R.positionView;R.positionViewDirection;R.positionWorld;R.positionWorldDirection;R.posterize;R.pow;R.pow2;R.pow3;R.pow4;R.premultiplyAlpha;R.property;R.radians;R.rand;R.range;R.rangeFog;R.rangeFogFactor;R.reciprocal;R.reference;R.referenceBuffer;R.reflect;R.reflectVector;R.reflectView;R.reflector;R.refract;R.refractVector;R.refractView;R.reinhardToneMapping;R.remap;R.remapClamp;R.renderGroup;R.renderOutput;R.rendererReference;R.replaceDefaultUV;R.rotate;R.rotateUV;R.roughness;R.round;R.rtt;R.sRGBTransferEOTF;R.sRGBTransferOETF;R.sample;R.sampler;R.samplerComparison;R.saturate;R.saturation;R.screen;R.screenCoordinate;R.screenDPR;R.screenSize;R.screenUV;R.scriptable;R.scriptableValue;R.select;R.setCurrentStack;R.setName;R.shaderStages;R.shadow;R.shadowPositionWorld;R.shapeCircle;R.sharedUniformGroup;R.sheen;R.sheenRoughness;R.shiftLeft;R.shiftRight;R.shininess;R.sign;const uH=R.sin;R.sinc;R.skinning;R.smoothstep;R.smoothstepElement;R.specularColor;R.specularF90;R.spherizeUV;R.split;R.spritesheetUV;const AH=R.sqrt;R.stack;R.step;R.stepElement;const cH=R.storage;R.storageBarrier;R.storageObject;R.storageTexture;R.string;R.struct;R.sub;R.subgroupAdd;R.subgroupAll;R.subgroupAnd;R.subgroupAny;R.subgroupBallot;R.subgroupBroadcast;R.subgroupBroadcastFirst;R.subBuild;R.subgroupElect;R.subgroupExclusiveAdd;R.subgroupExclusiveMul;R.subgroupInclusiveAdd;R.subgroupInclusiveMul;R.subgroupIndex;R.subgroupMax;R.subgroupMin;R.subgroupMul;R.subgroupOr;R.subgroupShuffle;R.subgroupShuffleDown;R.subgroupShuffleUp;R.subgroupShuffleXor;R.subgroupSize;R.subgroupXor;R.tan;R.tangentGeometry;R.tangentLocal;R.tangentView;R.tangentWorld;R.texture;R.texture3D;R.textureBarrier;R.textureBicubic;R.textureBicubicLevel;R.textureCubeUV;R.textureLoad;R.textureSize;R.textureLevel;R.textureStore;R.thickness;R.time;R.toneMapping;R.toneMappingExposure;R.toonOutlinePass;R.transformDirection;R.transformNormal;R.transformNormalToView;R.transformedClearcoatNormalView;R.transformedNormalView;R.transformedNormalWorld;R.transmission;R.transpose;R.triNoise3D;R.triplanarTexture;R.triplanarTextures;R.trunc;R.uint;R.uintBitsToFloat;const hH=R.uniform;R.uniformArray;R.uniformCubeTexture;R.uniformGroup;R.uniformFlow;R.uniformTexture;R.unpackHalf2x16;R.unpackSnorm2x16;R.unpackUnorm2x16;R.unpremultiplyAlpha;R.userData;R.uv;R.uvec2;R.uvec3;R.uvec4;R.varying;R.varyingProperty;R.vec2;R.vec3;R.vec4;R.vectorComponents;R.velocity;R.vertexColor;R.vertexIndex;R.vertexStage;R.vibrance;R.viewZToLogarithmicDepth;R.viewZToOrthographicDepth;R.viewZToPerspectiveDepth;R.viewport;R.viewportCoordinate;R.viewportDepthTexture;R.viewportLinearDepth;R.viewportMipTexture;R.viewportResolution;R.viewportSafeUV;R.viewportSharedTexture;R.viewportSize;R.viewportTexture;R.viewportUV;R.wgsl;R.wgslFn;R.workgroupArray;R.workgroupBarrier;R.workgroupId;R.workingToColorSpace;R.xor;const cx=new sf,t0=new we;class Gw extends yR{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new Go(e,3)),this.setAttribute("uv",new Go(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new Y0(t,6,1);return this.setAttribute("instanceStart",new Ra(r,3,0)),this.setAttribute("instanceEnd",new Ra(r,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new Y0(t,6,1);return this.setAttribute("instanceColorStart",new Ra(r,3,0)),this.setAttribute("instanceColorEnd",new Ra(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new vR(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new sf);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),cx.setFromBufferAttribute(t),this.boundingBox.union(cx))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xg),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)t0.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(t0)),t0.fromBufferAttribute(t,s),i=Math.max(i,r.distanceToSquared(t0));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}b0.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new gt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};x0.line={uniforms:Zg.merge([b0.common,b0.fog,b0.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			float alpha = opacity;
			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class X2 extends Xl{constructor(e){super({type:"LineMaterial",uniforms:Zg.clone(x0.line.uniforms),vertexShader:x0.line.vertexShader,fragmentShader:x0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Sp=new Vt,hx=new we,fx=new we,er=new Vt,tr=new Vt,os=new Vt,Ep=new we,Np=new hn,nr=new xR,dx=new we,n0=new sf,r0=new Xg,as=new Vt;let fs,Ua;function px(n,e,t){return as.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),as.multiplyScalar(1/as.w),as.x=Ua/t.width,as.y=Ua/t.height,as.applyMatrix4(n.projectionMatrixInverse),as.multiplyScalar(1/as.w),Math.abs(Math.max(as.x,as.y))}function fH(n,e){const t=n.matrixWorld,r=n.geometry,i=r.attributes.instanceStart,s=r.attributes.instanceEnd,o=Math.min(r.instanceCount,i.count);for(let a=0,c=o;a<c;a++){nr.start.fromBufferAttribute(i,a),nr.end.fromBufferAttribute(s,a),nr.applyMatrix4(t);const f=new we,p=new we;fs.distanceSqToSegment(nr.start,nr.end,p,f),p.distanceTo(f)<Ua*.5&&e.push({point:p,pointOnLine:f,distance:fs.origin.distanceTo(p),object:n,face:null,faceIndex:a,uv:null,uv1:null})}}function dH(n,e,t){const r=e.projectionMatrix,s=n.material.resolution,o=n.matrixWorld,a=n.geometry,c=a.attributes.instanceStart,f=a.attributes.instanceEnd,p=Math.min(a.instanceCount,c.count),g=-e.near;fs.at(1,os),os.w=1,os.applyMatrix4(e.matrixWorldInverse),os.applyMatrix4(r),os.multiplyScalar(1/os.w),os.x*=s.x/2,os.y*=s.y/2,os.z=0,Ep.copy(os),Np.multiplyMatrices(e.matrixWorldInverse,o);for(let v=0,b=p;v<b;v++){if(er.fromBufferAttribute(c,v),tr.fromBufferAttribute(f,v),er.w=1,tr.w=1,er.applyMatrix4(Np),tr.applyMatrix4(Np),er.z>g&&tr.z>g)continue;if(er.z>g){const B=er.z-tr.z,F=(er.z-g)/B;er.lerp(tr,F)}else if(tr.z>g){const B=tr.z-er.z,F=(tr.z-g)/B;tr.lerp(er,F)}er.applyMatrix4(r),tr.applyMatrix4(r),er.multiplyScalar(1/er.w),tr.multiplyScalar(1/tr.w),er.x*=s.x/2,er.y*=s.y/2,tr.x*=s.x/2,tr.y*=s.y/2,nr.start.copy(er),nr.start.z=0,nr.end.copy(tr),nr.end.z=0;const S=nr.closestPointToPointParameter(Ep,!0);nr.at(S,dx);const N=Yl.lerp(er.z,tr.z,S),C=N>=-1&&N<=1,P=Ep.distanceTo(dx)<Ua*.5;if(C&&P){nr.start.fromBufferAttribute(c,v),nr.end.fromBufferAttribute(f,v),nr.start.applyMatrix4(o),nr.end.applyMatrix4(o);const B=new we,F=new we;fs.distanceSqToSegment(nr.start,nr.end,F,B),t.push({point:F,pointOnLine:B,distance:fs.origin.distanceTo(F),object:n,face:null,faceIndex:v,uv:null,uv1:null})}}}class pH extends pn{constructor(e=new Gw,t=new X2({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let o=0,a=0,c=t.count;o<c;o++,a+=2)hx.fromBufferAttribute(t,o),fx.fromBufferAttribute(r,o),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+hx.distanceTo(fx);const s=new Y0(i,2,1);return e.setAttribute("instanceDistanceStart",new Ra(s,1,0)),e.setAttribute("instanceDistanceEnd",new Ra(s,1,1)),this}raycast(e,t){const r=this.material.worldUnits,i=e.camera;i===null&&!r&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;fs=e.ray;const o=this.matrixWorld,a=this.geometry,c=this.material;Ua=c.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),r0.copy(a.boundingSphere).applyMatrix4(o);let f;if(r)f=Ua*.5;else{const g=Math.max(i.near,r0.distanceToPoint(fs.origin));f=px(i,g,c.resolution)}if(r0.radius+=f,fs.intersectsSphere(r0)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),n0.copy(a.boundingBox).applyMatrix4(o);let p;if(r)p=Ua*.5;else{const g=Math.max(i.near,n0.distanceToPoint(fs.origin));p=px(i,g,c.resolution)}n0.expandByScalar(p),fs.intersectsBox(n0)!==!1&&(r?fH(this,t):dH(this,i,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(Sp),this.material.uniforms.resolution.value.set(Sp.z,Sp.w))}}class Vw extends Gw{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,r=new Float32Array(2*t);for(let i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setPositions(r),this}setColors(e){const t=e.length-3,r=new Float32Array(2*t);for(let i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setColors(r),this}setFromPoints(e){const t=e.length-1,r=new Float32Array(6*t);for(let i=0;i<t;i++)r[6*i]=e[i].x,r[6*i+1]=e[i].y,r[6*i+2]=e[i].z||0,r[6*i+3]=e[i+1].x,r[6*i+4]=e[i+1].y,r[6*i+5]=e[i+1].z||0;return super.setPositions(r),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class mH extends pH{constructor(e=new Vw,t=new X2({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}class mx extends bR{constructor(e,t={}){const r=t.font;if(r===void 0)super();else{const i=r.generateShapes(e,t.size,t.direction);t.depth===void 0&&(t.depth=50),t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(i,t)}this.type="TextGeometry"}}class gH{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100,r="ltr"){const i=[],s=_H(e,t,this.data,r);for(let o=0,a=s.length;o<a;o++)i.push(...s[o].toShapes());return i}}function _H(n,e,t,r){const i=Array.from(n),s=e/t.resolution,o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*s,a=[];let c=0,f=0;(r=="rtl"||r=="tb")&&i.reverse();for(let p=0;p<i.length;p++){const g=i[p];if(g===`
`)c=0,f-=o;else{const v=yH(g,s,c,f,t);r=="tb"?(c=0,f+=t.ascender*s):c+=v.offsetX,a.push(v.path)}}return a}function yH(n,e,t,r,i){const s=i.glyphs[n]||i.glyphs["?"];if(!s){console.error('THREE.Font: character "'+n+'" does not exists in font family '+i.familyName+".");return}const o=new TR;let a,c,f,p,g,v,b,T;if(s.o){const S=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let N=0,C=S.length;N<C;)switch(S[N++]){case"m":a=S[N++]*e+t,c=S[N++]*e+r,o.moveTo(a,c);break;case"l":a=S[N++]*e+t,c=S[N++]*e+r,o.lineTo(a,c);break;case"q":f=S[N++]*e+t,p=S[N++]*e+r,g=S[N++]*e+t,v=S[N++]*e+r,o.quadraticCurveTo(g,v,f,p);break;case"b":f=S[N++]*e+t,p=S[N++]*e+r,g=S[N++]*e+t,v=S[N++]*e+r,b=S[N++]*e+t,T=S[N++]*e+r,o.bezierCurveTo(g,v,b,T,f,p);break}}return{offsetX:s.ha*e,path:o}}function yg(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function vH(n){if(Array.isArray(n))return n}function xH(n){if(Array.isArray(n))return yg(n)}function zw(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function bH(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function gx(n,e,t,r,i,s,o){try{var a=n[s](o),c=a.value}catch(f){return void t(f)}a.done?e(c):Promise.resolve(c).then(r,i)}function TH(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var s=n.apply(e,t);function o(c){gx(s,r,i,o,a,"next",c)}function a(c){gx(s,r,i,o,a,"throw",c)}o(void 0)})}}function zf(n,e,t){return e=lu(e),BH(n,Z2()?Reflect.construct(e,t||[],lu(n).constructor):e.apply(n,t))}function wH(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function $f(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Hu(n,e){return n.get(zw(n,e))}function Rp(n,e,t){wH(n,e),e.set(n,t)}function Cp(n,e,t){return n.set(zw(n,e),t),t}function K2(n,e,t){if(Z2())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return i}function SH(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,$w(r.key),r)}}function jf(n,e,t){return e&&SH(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n}function Kn(n,e,t){return(e=$w(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function vg(){return vg=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,e,t){var r=DH(n,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?n:t):i.value}},vg.apply(null,arguments)}function lu(n){return lu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},lu(n)}function Hf(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&bg(n,e)}function Z2(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Z2=function(){return!!n})()}function EH(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function NH(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function RH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CH(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _x(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Ut(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_x(Object(t),!0).forEach(function(r){Kn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):_x(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function MH(n,e){if(n==null)return{};var t,r,i=PH(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function PH(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function BH(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bH(n)}function xg(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var n,e,t=typeof Symbol=="function"?Symbol:{},r=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function s(b,T,S,N){var C=T&&T.prototype instanceof a?T:a,P=Object.create(C.prototype);return Kr(P,"_invoke",(function(B,F,q){var I,U,G,H=0,te=q||[],W=!1,Z={p:0,n:0,v:n,a:re,f:re.bind(n,4),d:function(oe,Y){return I=oe,U=0,G=n,Z.n=Y,o}};function re(oe,Y){for(U=oe,G=Y,e=0;!W&&H&&!ae&&e<te.length;e++){var ae,he=te[e],be=Z.p,pe=he[2];oe>3?(ae=pe===Y)&&(G=he[(U=he[4])?5:(U=3,3)],he[4]=he[5]=n):he[0]<=be&&((ae=oe<2&&be<he[1])?(U=0,Z.v=Y,Z.n=he[1]):be<pe&&(ae=oe<3||he[0]>Y||Y>pe)&&(he[4]=oe,he[5]=Y,Z.n=pe,U=0))}if(ae||oe>1)return o;throw W=!0,Y}return function(oe,Y,ae){if(H>1)throw TypeError("Generator is already running");for(W&&Y===1&&re(Y,ae),U=Y,G=ae;(e=U<2?n:G)||!W;){I||(U?U<3?(U>1&&(Z.n=-1),re(U,G)):Z.n=G:Z.v=G);try{if(H=2,I){if(U||(oe="next"),e=I[oe]){if(!(e=e.call(I,G)))throw TypeError("iterator result is not an object");if(!e.done)return e;G=e.value,U<2&&(U=0)}else U===1&&(e=I.return)&&e.call(I),U<2&&(G=TypeError("The iterator does not provide a '"+oe+"' method"),U=1);I=n}else if((e=(W=Z.n<0)?G:B.call(F,Z))!==o)break}catch(he){I=n,U=1,G=he}finally{H=1}}return{value:e,done:W}}})(b,S,N),!0),P}var o={};function a(){}function c(){}function f(){}e=Object.getPrototypeOf;var p=[][r]?e(e([][r]())):(Kr(e={},r,function(){return this}),e),g=f.prototype=a.prototype=Object.create(p);function v(b){return Object.setPrototypeOf?Object.setPrototypeOf(b,f):(b.__proto__=f,Kr(b,i,"GeneratorFunction")),b.prototype=Object.create(g),b}return c.prototype=f,Kr(g,"constructor",f),Kr(f,"constructor",c),c.displayName="GeneratorFunction",Kr(f,i,"GeneratorFunction"),Kr(g),Kr(g,i,"Generator"),Kr(g,r,function(){return this}),Kr(g,"toString",function(){return"[object Generator]"}),(xg=function(){return{w:s,m:v}})()}function Kr(n,e,t,r){var i=Object.defineProperty;try{i({},"",{})}catch{i=0}Kr=function(s,o,a,c){function f(p,g){Kr(s,p,function(v){return this._invoke(p,g,v)})}o?i?i(s,o,{value:a,enumerable:!c,configurable:!c,writable:!c}):s[o]=a:(f("next",0),f("throw",1),f("return",2))},Kr(n,e,t,r)}function bg(n,e){return bg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},bg(n,e)}function on(n,e){return vH(n)||NH(n,e)||jw(n,e)||RH()}function DH(n,e){for(;!{}.hasOwnProperty.call(n,e)&&(n=lu(n))!==null;);return n}function Mp(n,e,t,r){var i=vg(lu(n.prototype),e,t);return typeof i=="function"?function(s){return i.apply(t,s)}:i}function Wt(n){return xH(n)||EH(n)||jw(n)||CH()}function LH(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function $w(n){var e=LH(n,"string");return typeof e=="symbol"?e:e+""}function jw(n,e){if(n){if(typeof n=="string")return yg(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?yg(n,e):void 0}}var Hw=function(e){e instanceof Array?e.forEach(Hw):(e.map&&e.map.dispose(),e.dispose())},J2=function(e){e.geometry&&e.geometry.dispose(),e.material&&Hw(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(J2)},Kt=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),J2(t)}};function Pr(n,e){var t=new e;return{linkProp:function(i){return{default:t[i](),onChange:function(o,a){a[n][i](o)},triggerUpdate:!1}},linkMethod:function(i){return function(s){for(var o=s[n],a=arguments.length,c=new Array(a>1?a-1:0),f=1;f<a;f++)c[f-1]=arguments[f];var p=o[i].apply(o,c);return p===o?this:p}}}}var nn=100;function yx(){return nn}function Ni(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(90-n)*Math.PI/180,i=(90-e)*Math.PI/180,s=nn*(1+t),o=Math.sin(r);return{x:s*o*Math.cos(i),y:s*Math.cos(r),z:s*o*Math.sin(i)}}function Ww(n){var e=n.x,t=n.y,r=n.z,i=Math.sqrt(e*e+t*t+r*r),s=Math.acos(t/i),o=Math.atan2(r,e);return{lat:90-s*180/Math.PI,lng:90-o*180/Math.PI-(o<-Math.PI/2?360:0),altitude:i/nn-1}}function Ta(n){return n*Math.PI/180}var GA=window.THREE?window.THREE:{BackSide:mr,BufferAttribute:Il,Color:Gn,Mesh:pn,ShaderMaterial:Xl},FH=`
uniform float hollowRadius;

varying vec3 vVertexWorldPosition;
varying vec3 vVertexNormal;
varying float vCameraDistanceToObjCenter;
varying float vVertexAngularDistanceToHollowRadius;

void main() {    
  vVertexNormal	= normalize(normalMatrix * normal);
  vVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;
  
  vec4 objCenterViewPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);
  vCameraDistanceToObjCenter = length(objCenterViewPosition);
  
  float edgeAngle = atan(hollowRadius / vCameraDistanceToObjCenter);
  float vertexAngle = acos(dot(normalize(modelViewMatrix * vec4(position, 1.0)), normalize(objCenterViewPosition)));
  vVertexAngularDistanceToHollowRadius = vertexAngle - edgeAngle;

  gl_Position	= projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,OH=`
uniform vec3 color;
uniform float coefficient;
uniform float power;
uniform float hollowRadius;

varying vec3 vVertexNormal;
varying vec3 vVertexWorldPosition;
varying float vCameraDistanceToObjCenter;
varying float vVertexAngularDistanceToHollowRadius;

void main() {
  if (vCameraDistanceToObjCenter < hollowRadius) discard; // inside the hollowRadius
  if (vVertexAngularDistanceToHollowRadius < 0.0) discard; // frag position is within the hollow radius

  vec3 worldCameraToVertex = vVertexWorldPosition - cameraPosition;
  vec3 viewCameraToVertex	= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;
  viewCameraToVertex = normalize(viewCameraToVertex);
  float intensity	= pow(
    coefficient + dot(vVertexNormal, viewCameraToVertex),
    power
  );
  gl_FragColor = vec4(color, intensity);
}`;function IH(n,e,t,r){return new GA.ShaderMaterial({depthWrite:!1,transparent:!0,vertexShader:FH,fragmentShader:OH,uniforms:{coefficient:{value:n},color:{value:new GA.Color(e)},power:{value:t},hollowRadius:{value:r}}})}function kH(n,e){for(var t=n.clone(),r=new Float32Array(n.attributes.position.count*3),i=0,s=r.length;i<s;i++){var o=n.attributes.normal.array[i],a=n.attributes.position.array[i];r[i]=a+o*e}return t.setAttribute("position",new GA.BufferAttribute(r,3)),t}var UH=(function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.color,o=s===void 0?"gold":s,a=i.size,c=a===void 0?2:a,f=i.coefficient,p=f===void 0?.5:f,g=i.power,v=g===void 0?1:g,b=i.hollowRadius,T=b===void 0?0:b,S=i.backside,N=S===void 0?!0:S;$f(this,e),r=zf(this,e);var C=kH(t,c),P=IH(p,o,v,T);return N&&(P.side=GA.BackSide),r.geometry=C,r.material=P,r}return Hf(e,n),jf(e)})(GA.Mesh),ls=window.THREE?window.THREE:{Color:Gn,Group:Ms,LineBasicMaterial:rf,LineSegments:Pb,Mesh:pn,MeshPhongMaterial:Sb,SphereGeometry:Wo,SRGBColorSpace:$A,TextureLoader:Fg},Qw=Vn({props:{globeImageUrl:{},bumpImageUrl:{},showGlobe:{default:!0,onChange:function(e,t){t.globeGroup.visible=!!e},triggerUpdate:!1},showGraticules:{default:!1,onChange:function(e,t){t.graticulesObj.visible=!!e},triggerUpdate:!1},showAtmosphere:{default:!0,onChange:function(e,t){t.atmosphereObj&&(t.atmosphereObj.visible=!!e)},triggerUpdate:!1},atmosphereColor:{default:"lightskyblue"},atmosphereAltitude:{default:.15},globeCurvatureResolution:{default:4},globeTileEngineUrl:{onChange:function(e,t){t.tileEngine.tileUrl=e}},globeTileEngineMaxLevel:{default:17,onChange:function(e,t){t.tileEngine.maxLevel=e},triggerUpdate:!1},updatePov:{onChange:function(e,t){t.tileEngine.updatePov(e)},triggerUpdate:!1},onReady:{default:function(){},triggerUpdate:!1}},methods:{globeMaterial:function(e,t){return t!==void 0?(e.globeObj.material=t||e.defaultGlobeMaterial,this):e.globeObj.material},globeTileEngineClearCache:function(e){e.tileEngine.clearTiles()},_destructor:function(e){Kt(e.globeObj),Kt(e.tileEngine),Kt(e.graticulesObj)}},stateInit:function(){var e=new ls.MeshPhongMaterial({color:0}),t=new ls.Mesh(void 0,e);t.rotation.y=-Math.PI/2;var r=new JM(nn),i=new ls.Group;i.__globeObjType="globe",i.add(t),i.add(r);var s=new ls.LineSegments(new B4(gM(),nn,2),new ls.LineBasicMaterial({color:"lightgrey",transparent:!0,opacity:.1}));return{globeGroup:i,globeObj:t,graticulesObj:s,defaultGlobeMaterial:e,tileEngine:r}},init:function(e,t){Kt(e),t.scene=e,t.scene.add(t.globeGroup),t.scene.add(t.graticulesObj),t.ready=!1},update:function(e,t){var r=e.globeObj.material;if(e.tileEngine.visible=!(e.globeObj.visible=!e.globeTileEngineUrl),t.hasOwnProperty("globeCurvatureResolution")){var i;(i=e.globeObj.geometry)===null||i===void 0||i.dispose();var s=Math.max(4,Math.round(360/e.globeCurvatureResolution));e.globeObj.geometry=new ls.SphereGeometry(nn,s,s/2),e.tileEngine.curvatureResolution=e.globeCurvatureResolution}if(t.hasOwnProperty("globeImageUrl")&&(e.globeImageUrl?new ls.TextureLoader().load(e.globeImageUrl,function(a){a.colorSpace=ls.SRGBColorSpace,r.map=a,r.color=null,r.needsUpdate=!0,!e.ready&&(e.ready=!0)&&setTimeout(e.onReady)}):!r.color&&(r.color=new ls.Color(0))),t.hasOwnProperty("bumpImageUrl")&&(e.bumpImageUrl?e.bumpImageUrl&&new ls.TextureLoader().load(e.bumpImageUrl,function(a){r.bumpMap=a,r.needsUpdate=!0}):(r.bumpMap=null,r.needsUpdate=!0)),(t.hasOwnProperty("atmosphereColor")||t.hasOwnProperty("atmosphereAltitude"))&&(e.atmosphereObj&&(e.scene.remove(e.atmosphereObj),Kt(e.atmosphereObj)),e.atmosphereColor&&e.atmosphereAltitude)){var o=e.atmosphereObj=new UH(e.globeObj.geometry,{color:e.atmosphereColor,size:nn*e.atmosphereAltitude,hollowRadius:nn,coefficient:.1,power:3.5});o.visible=!!e.showAtmosphere,o.__globeObjType="atmosphere",e.scene.add(o)}!e.ready&&(!e.globeImageUrl||e.globeTileEngineUrl)&&(e.ready=!0,e.onReady())}}),Rs=function(e){return isNaN(e)?parseInt(Qe(e).toHex(),16):e},ji=function(e){return e&&isNaN(e)?qa(e).opacity:1},Ho=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i,s=1,o=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.eE+-]+)\s*\)$/.exec(e.trim().toLowerCase());if(o){var a=o.slice(1),c=on(a,4),f=c[0],p=c[1],g=c[2],v=c[3];i=new Gn("rgb(".concat(+f,",").concat(+p,",").concat(+g,")")),s=Math.min(+v,1)}else i=new Gn(e);r&&i.convertLinearToSRGB();var b=i.toArray();return t?[].concat(Wt(b),[s]):b};function qH(n,e,t){return n.opacity=e,n.transparent=e<1,n.depthWrite=e>=1,n}var vx=window.THREE?window.THREE:{BufferAttribute:Il};function Cs(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float32Array;if(e===1)return new vx.BufferAttribute(new t(n),e);for(var r=new vx.BufferAttribute(new t(n.length*e),e),i=0,s=n.length;i<s;i++)r.set(n[i],i*e);return r}function GH(n){for(var e=n.itemSize,t=[],r=0;r<n.count;r++)t.push(n.array.slice(r*e,(r+1)*e));return t}var Pp=new WeakMap,i0=new WeakMap,s0=new WeakMap,jr=(function(n){function e(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=i.dataBindAttr,o=s===void 0?"__data":s,a=i.objBindAttr,c=a===void 0?"__threeObj":a,f=i.removeDelay,p=f===void 0?0:f;return $f(this,e),r=zf(this,e),Kn(r,"scene",void 0),Rp(r,Pp,void 0),Rp(r,i0,void 0),Rp(r,s0,void 0),r.scene=t,Cp(Pp,r,o),Cp(i0,r,c),Cp(s0,r,p),r.onRemoveObj(function(){}),r}return Hf(e,n),jf(e,[{key:"onCreateObj",value:function(r){var i=this;return Mp(e,"onCreateObj",this)([function(s){var o=r(s);return s[Hu(i0,i)]=o,o[Hu(Pp,i)]=s,i.scene.add(o),o}]),this}},{key:"onRemoveObj",value:function(r){var i=this;return Mp(e,"onRemoveObj",this)([function(s,o){var a=Mp(e,"getData",i)([s]);r(s,o);var c=function(){i.scene.remove(s),Kt(s),delete a[Hu(i0,i)]};Hu(s0,i)?setTimeout(c,Hu(s0,i)):c()}]),this}}])})(gB),Di=window.THREE?window.THREE:{BufferGeometry:oi,CylinderGeometry:Wx,Matrix4:hn,Mesh:pn,MeshLambertMaterial:ao,Object3D:Xh,Vector3:we},xx=Object.assign({},Jg),bx=xx.BufferGeometryUtils||xx,Yw=Vn({props:{pointsData:{default:[]},pointLat:{default:"lat"},pointLng:{default:"lng"},pointColor:{default:function(){return"#ffffaa"}},pointAltitude:{default:.1},pointRadius:{default:.25},pointResolution:{default:12,triggerUpdate:!1},pointsMerge:{default:!1},pointsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;Kt(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new jr(e,{objBindAttr:"__threeObjPoint"})},update:function(e,t){var r=ye(e.pointLat),i=ye(e.pointLng),s=ye(e.pointAltitude),o=ye(e.pointRadius),a=ye(e.pointColor),c=new Di.CylinderGeometry(1,1,1,e.pointResolution);c.applyMatrix4(new Di.Matrix4().makeRotationX(Math.PI/2)),c.applyMatrix4(new Di.Matrix4().makeTranslation(0,0,-.5));var f=2*Math.PI*nn/360,p={};if(!e.pointsMerge&&t.hasOwnProperty("pointsMerge")&&Kt(e.scene),e.dataMapper.scene=e.pointsMerge?new Di.Object3D:e.scene,e.dataMapper.onCreateObj(b).onUpdateObj(T).digest(e.pointsData),e.pointsMerge){var g=e.pointsData.length?(bx.mergeGeometries||bx.mergeBufferGeometries)(e.pointsData.map(function(S){var N=e.dataMapper.getObj(S),C=N.geometry.clone();N.updateMatrix(),C.applyMatrix4(N.matrix);var P=Ho(a(S));return C.setAttribute("color",Cs(Array(C.getAttribute("position").count).fill(P),4)),C})):new Di.BufferGeometry,v=new Di.Mesh(g,new Di.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0}));v.__globeObjType="points",v.__data=e.pointsData,e.dataMapper.clear(),Kt(e.scene),e.scene.add(v)}function b(){var S=new Di.Mesh(c);return S.__globeObjType="point",S}function T(S,N){var C=function(G){var H=S.__currentTargetD=G,te=H.r,W=H.alt,Z=H.lat,re=H.lng;Object.assign(S.position,Ni(Z,re));var oe=e.pointsMerge?new Di.Vector3(0,0,0):e.scene.localToWorld(new Di.Vector3(0,0,0));S.lookAt(oe),S.scale.x=S.scale.y=Math.min(30,te)*f,S.scale.z=Math.max(W*nn,.1)},P={alt:+s(N),r:+o(N),lat:+r(N),lng:+i(N)},B=S.__currentTargetD||Object.assign({},P,{alt:-.001});if(Object.keys(P).some(function(U){return B[U]!==P[U]})&&(e.pointsMerge||!e.pointsTransitionDuration||e.pointsTransitionDuration<0?C(P):e.tweenGroup.add(new _r(B).to(P,e.pointsTransitionDuration).easing(On.Quadratic.InOut).onUpdate(C).start())),!e.pointsMerge){var F=a(N),q=F?ji(F):0,I=!!q;S.visible=I,I&&(p.hasOwnProperty(F)||(p[F]=new Di.MeshLambertMaterial({color:Rs(F),transparent:q<1,opacity:q})),S.material=p[F])}}}}),Xw=function(){return{uniforms:{dashOffset:{value:0},dashSize:{value:1},gapSize:{value:0},dashTranslate:{value:0}},vertexShader:`
    `.concat(wu.common,`
    `).concat(wu.logdepthbuf_pars_vertex,`
  
    uniform float dashTranslate; 

    attribute vec4 color;
    varying vec4 vColor;
    
    attribute float relDistance;
    varying float vRelDistance;

    void main() {
      // pass through colors and distances
      vColor = color;
      vRelDistance = relDistance + dashTranslate;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  
      `).concat(wu.logdepthbuf_vertex,`
    }
  `),fragmentShader:`
    `.concat(wu.logdepthbuf_pars_fragment,`

    uniform float dashOffset; 
    uniform float dashSize;
    uniform float gapSize; 
    
    varying vec4 vColor;
    varying float vRelDistance;
    
    void main() {
      // ignore pixels in the gap
      if (vRelDistance < dashOffset) discard;
      if (mod(vRelDistance - dashOffset, dashSize + gapSize) > dashSize) discard;
    
      // set px color: [r, g, b, a], interpolated between vertices 
      gl_FragColor = vColor; 
  
      `).concat(wu.logdepthbuf_fragment,`
    }
  `)}},Tg=function(e){return e.uniforms.uSurfaceRadius={type:"float",value:0},e.vertexShader=(`attribute float surfaceRadius;
varying float vSurfaceRadius;
varying vec3 vPos;
`+e.vertexShader).replace("void main() {",["void main() {","vSurfaceRadius = surfaceRadius;","vPos = position;"].join(`
`)),e.fragmentShader=(`uniform float uSurfaceRadius;
varying float vSurfaceRadius;
varying vec3 vPos;
`+e.fragmentShader).replace("void main() {",["void main() {","if (length(vPos) < max(uSurfaceRadius, vSurfaceRadius)) discard;"].join(`
`)),e},VH=function(e){return e.vertexShader=`
    attribute float r;
    
    const float PI = 3.1415926535897932384626433832795;
    float toRad(in float a) {
      return a * PI / 180.0;
    }
    
    vec3 Polar2Cartesian(in vec3 c) { // [lat, lng, r]
      float phi = toRad(90.0 - c.x);
      float theta = toRad(90.0 - c.y);
      float r = c.z;
      return vec3( // x,y,z
        r * sin(phi) * cos(theta),
        r * cos(phi),
        r * sin(phi) * sin(theta)
      );
    }
    
    vec2 Cartesian2Polar(in vec3 p) {
      float r = sqrt(p.x * p.x + p.y * p.y + p.z * p.z);
      float phi = acos(p.y / r);
      float theta = atan(p.z, p.x);
      return vec2( // lat,lng
        90.0 - phi * 180.0 / PI,
        90.0 - theta * 180.0 / PI - (theta < -PI / 2.0 ? 360.0 : 0.0)
      );
    }
    `.concat(e.vertexShader.replace("}",`                  
        vec3 pos = Polar2Cartesian(vec3(Cartesian2Polar(position), r));
        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
      }
    `),`
  `),e},e_=function(e,t){return e.onBeforeCompile=function(r){e.userData.shader=t(r)},e},zH=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(i){return i};if(e.userData.shader)t(e.userData.shader.uniforms);else{var r=e.onBeforeCompile;e.onBeforeCompile=function(i){r(i),t(i.uniforms)}}},$H=["stroke"],Li=window.THREE?window.THREE:{BufferGeometry:oi,CubicBezierCurve3:SR,Curve:ER,Group:Ms,Line:e1,Mesh:pn,NormalBlending:js,ShaderMaterial:Xl,TubeGeometry:wR,Vector3:we},jH=nu.default||nu,Kw=Vn({props:{arcsData:{default:[]},arcStartLat:{default:"startLat"},arcStartLng:{default:"startLng"},arcStartAltitude:{default:0},arcEndLat:{default:"endLat"},arcEndLng:{default:"endLng"},arcEndAltitude:{default:0},arcColor:{default:function(){return"#ffffaa"}},arcAltitude:{},arcAltitudeAutoScale:{default:.5},arcStroke:{},arcCurveResolution:{default:64,triggerUpdate:!1},arcCircularResolution:{default:6,triggerUpdate:!1},arcDashLength:{default:1},arcDashGap:{default:0},arcDashInitialGap:{default:0},arcDashAnimateTime:{default:0},arcsTransitionDuration:{default:1e3,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.resume()},_destructor:function(e){var t;e.sharedMaterial.dispose(),(t=e.ticker)===null||t===void 0||t.dispose()}},stateInit:function(e){var t=e.tweenGroup;return{tweenGroup:t,ticker:new jH,sharedMaterial:new Li.ShaderMaterial(Ut(Ut({},Xw()),{},{transparent:!0,blending:Li.NormalBlending}))}},init:function(e,t){Kt(e),t.scene=e,t.dataMapper=new jr(e,{objBindAttr:"__threeObjArc"}).onCreateObj(function(){var r=new Li.Group;return r.__globeObjType="arc",r}),t.ticker.onTick.add(function(r,i){t.dataMapper.entries().map(function(s){var o=on(s,2),a=o[1];return a}).filter(function(s){return s.children.length&&s.children[0].material&&s.children[0].__dashAnimateStep}).forEach(function(s){var o=s.children[0],a=o.__dashAnimateStep*i,c=o.material.uniforms.dashTranslate.value%1e9;o.material.uniforms.dashTranslate.value=c+a})})},update:function(e){var t=ye(e.arcStartLat),r=ye(e.arcStartLng),i=ye(e.arcStartAltitude),s=ye(e.arcEndLat),o=ye(e.arcEndLng),a=ye(e.arcEndAltitude),c=ye(e.arcAltitude),f=ye(e.arcAltitudeAutoScale),p=ye(e.arcStroke),g=ye(e.arcColor),v=ye(e.arcDashLength),b=ye(e.arcDashGap),T=ye(e.arcDashInitialGap),S=ye(e.arcDashAnimateTime);e.dataMapper.onUpdateObj(function(B,F){var q=p(F),I=q!=null;if(!B.children.length||I!==(B.children[0].type==="Mesh")){Kt(B);var U=I?new Li.Mesh:new Li.Line(new Li.BufferGeometry);U.material=e.sharedMaterial.clone(),B.add(U)}var G=B.children[0];Object.assign(G.material.uniforms,{dashSize:{value:v(F)},gapSize:{value:b(F)},dashOffset:{value:T(F)}});var H=S(F);G.__dashAnimateStep=H>0?1e3/H:0;var te=C(g(F),e.arcCurveResolution,I?e.arcCircularResolution+1:1),W=P(e.arcCurveResolution,I?e.arcCircularResolution+1:1,!0);G.geometry.setAttribute("color",te),G.geometry.setAttribute("relDistance",W);var Z=function(ae){var he=B.__currentTargetD=ae,be=he.stroke,pe=MH(he,$H),Le=N(pe);I?(G.geometry&&G.geometry.dispose(),G.geometry=new Li.TubeGeometry(Le,e.arcCurveResolution,be/2,e.arcCircularResolution),G.geometry.setAttribute("color",te),G.geometry.setAttribute("relDistance",W)):G.geometry.setFromPoints(Le.getPoints(e.arcCurveResolution))},re={stroke:q,alt:c(F),altAutoScale:+f(F),startLat:+t(F),startLng:+r(F),startAlt:+i(F),endLat:+s(F),endLng:+o(F),endAlt:+a(F)},oe=B.__currentTargetD||Object.assign({},re,{altAutoScale:-.001});Object.keys(re).some(function(Y){return oe[Y]!==re[Y]})&&(!e.arcsTransitionDuration||e.arcsTransitionDuration<0?Z(re):e.tweenGroup.add(new _r(oe).to(re,e.arcsTransitionDuration).easing(On.Quadratic.InOut).onUpdate(Z).start()))}).digest(e.arcsData);function N(B){var F=B.alt,q=B.altAutoScale,I=B.startLat,U=B.startLng,G=B.startAlt,H=B.endLat,te=B.endLng,W=B.endAlt,Z=function(wn){var tn=on(wn,3),ur=tn[0],Zn=tn[1],yr=tn[2],kn=Ni(Zn,ur,yr),Rn=kn.x,Un=kn.y,Hr=kn.z;return new Li.Vector3(Rn,Un,Hr)},re=[U,I],oe=[te,H],Y=F;if(Y==null&&(Y=zo(re,oe)/2*q+Math.max(G,W)),Y||G||W){var ae=u1(re,oe),he=function(wn,tn){return tn+(tn-wn)*(wn<tn?.5:.25)},be=[.25,.75].map(function(Nt){return[].concat(Wt(ae(Nt)),[he(Nt<.5?G:W,Y)])}),pe=on(be,2),Le=pe[0],Ue=pe[1],Je=K2(Li.CubicBezierCurve3,Wt([[].concat(re,[G]),Le,Ue,[].concat(oe,[W])].map(Z)));return Je}else{var st=.001;return ln.apply(void 0,Wt([[].concat(re,[st]),[].concat(oe,[st])].map(Z)))}function ln(Nt,wn){var tn=Nt.angleTo(wn),ur=tn===0?function(){return Nt.clone()}:function(yr){return new Li.Vector3().addVectors(Nt.clone().multiplyScalar(Math.sin((1-yr)*tn)),wn.clone().multiplyScalar(Math.sin(yr*tn))).divideScalar(Math.sin(tn))},Zn=new Li.Curve;return Zn.getPoint=ur,Zn}}function C(B,F){var q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,I=F+1,U;if(B instanceof Array||B instanceof Function){var G=B instanceof Array?Js().domain(B.map(function(Y,ae){return ae/(B.length-1)})).range(B):B;U=function(ae){return Ho(G(ae),!0,!0)}}else{var H=Ho(B,!0,!0);U=function(){return H}}for(var te=[],W=0,Z=I;W<Z;W++)for(var re=U(W/(Z-1)),oe=0;oe<q;oe++)te.push(re);return Cs(te,4)}function P(B){for(var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,I=B+1,U=[],G=0,H=I;G<H;G++)for(var te=G/(H-1),W=0;W<F;W++)U.push(te);return q&&U.reverse(),Cs(U,1)}}}),wo=window.THREE?window.THREE:{BufferGeometry:oi,DoubleSide:vi,Mesh:pn,MeshLambertMaterial:ao,Object3D:Xh},Tx=Object.assign({},Jg),wx=Tx.BufferGeometryUtils||Tx,Zw=Vn({props:{hexBinPointsData:{default:[]},hexBinPointLat:{default:"lat"},hexBinPointLng:{default:"lng"},hexBinPointWeight:{default:1},hexBinResolution:{default:4},hexMargin:{default:.2},hexTopCurvatureResolution:{default:5},hexTopColor:{default:function(){return"#ffffaa"}},hexSideColor:{default:function(){return"#ffffaa"}},hexAltitude:{default:function(e){var t=e.sumWeight;return t*.01}},hexBinMerge:{default:!1},hexTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;Kt(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new jr(e,{objBindAttr:"__threeObjHexbin"})},update:function(e,t){var r=ye(e.hexBinPointLat),i=ye(e.hexBinPointLng),s=ye(e.hexBinPointWeight),o=ye(e.hexAltitude),a=ye(e.hexTopColor),c=ye(e.hexSideColor),f=ye(e.hexMargin),p=UD(e.hexBinPointsData.map(function(P){return Ut(Ut({},P),{},{h3Idx:wL(r(P),i(P),e.hexBinResolution)})}),"h3Idx"),g=Object.entries(p).map(function(P){var B=on(P,2),F=B[0],q=B[1];return{h3Idx:F,points:q,sumWeight:q.reduce(function(I,U){return I+ +s(U)},0)}}),v={};if(!e.hexBinMerge&&t.hasOwnProperty("hexBinMerge")&&Kt(e.scene),e.dataMapper.scene=e.hexBinMerge?new wo.Object3D:e.scene,e.dataMapper.id(function(P){return P.h3Idx}).onCreateObj(N).onUpdateObj(C).digest(g),e.hexBinMerge){var b=g.length?(wx.mergeGeometries||wx.mergeBufferGeometries)(g.map(function(P){var B=e.dataMapper.getObj(P),F=B.geometry.toNonIndexed();B.updateMatrix(),F.applyMatrix4(B.matrix);var q=Ho(a(P)),I=Ho(c(P)),U=F.getAttribute("position").count,G=F.groups[0].count;return F.setAttribute("color",Cs(Wt(new Array(U)).map(function(H,te){return te>=G?q:I}),4)),F})):new wo.BufferGeometry,T=new wo.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0,side:wo.DoubleSide});T.onBeforeCompile=function(P){T.userData.shader=Tg(P)};var S=new wo.Mesh(b,T);S.__globeObjType="hexBinPoints",S.__data=g,e.dataMapper.clear(),Kt(e.scene),e.scene.add(S)}function N(P){var B=new wo.Mesh;B.__hexCenter=K4(P.h3Idx),B.__hexGeoJson=Z4(P.h3Idx,!0).reverse();var F=B.__hexCenter[1];return B.__hexGeoJson.forEach(function(q){var I=q[0];Math.abs(F-I)>170&&(q[0]+=F>I?360:-360)}),B.__globeObjType="hexbin",B}function C(P,B){var F=function(he,be,pe){return he-(he-be)*pe},q=Math.max(0,Math.min(1,+f(B))),I=on(P.__hexCenter,2),U=I[0],G=I[1],H=q===0?P.__hexGeoJson:P.__hexGeoJson.map(function(ae){var he=on(ae,2),be=he[0],pe=he[1];return[[be,G],[pe,U]].map(function(Le){var Ue=on(Le,2),Je=Ue[0],st=Ue[1];return F(Je,st,q)})}),te=e.hexTopCurvatureResolution;P.geometry&&P.geometry.dispose(),P.geometry=new _1([H],0,nn,!1,!0,!0,te);var W={alt:+o(B)},Z=function(he){var be=P.__currentTargetD=he,pe=be.alt;P.scale.x=P.scale.y=P.scale.z=1+pe;var Le=nn/(pe+1);P.geometry.setAttribute("surfaceRadius",Cs(Array(P.geometry.getAttribute("position").count).fill(Le),1))},re=P.__currentTargetD||Object.assign({},W,{alt:-.001});if(Object.keys(W).some(function(ae){return re[ae]!==W[ae]})&&(e.hexBinMerge||!e.hexTransitionDuration||e.hexTransitionDuration<0?Z(W):e.tweenGroup.add(new _r(re).to(W,e.hexTransitionDuration).easing(On.Quadratic.InOut).onUpdate(Z).start())),!e.hexBinMerge){var oe=c(B),Y=a(B);[oe,Y].forEach(function(ae){if(!v.hasOwnProperty(ae)){var he=ji(ae);v[ae]=e_(new wo.MeshLambertMaterial({color:Rs(ae),transparent:he<1,opacity:he,side:wo.DoubleSide}),Tg)}}),P.material=[oe,Y].map(function(ae){return v[ae]})}}}}),Jw=function(e){return e*e},Vs=function(e){return e*Math.PI/180};function HH(n,e){var t=Math.sqrt,r=Math.cos,i=function(p){return Jw(Math.sin(p/2))},s=Vs(n[1]),o=Vs(e[1]),a=Vs(n[0]),c=Vs(e[0]);return 2*Math.asin(t(i(o-s)+r(s)*r(o)*i(c-a)))}var WH=Math.sqrt(2*Math.PI);function QH(n,e){return Math.exp(-Jw(n/e)/2)/(e*WH)}var YH=function(e){var t=on(e,2),r=t[0],i=t[1],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=o.lngAccessor,c=a===void 0?function(N){return N[0]}:a,f=o.latAccessor,p=f===void 0?function(N){return N[1]}:f,g=o.weightAccessor,v=g===void 0?function(){return 1}:g,b=o.bandwidth,T=[r,i],S=b*Math.PI/180;return WC(s.map(function(N){var C=v(N);if(!C)return 0;var P=HH(T,[c(N),p(N)]);return QH(P,S)*C}))},XH=(function(){var n=TH(xg().m(function e(t){var r,i,s,o,a,c,f,p,g,v,b,T,S,N,C,P,B,F,q,I,U,G,H,te,W,Z,re,oe,Y,ae,he,be,pe,Le,Ue,Je,st,ln,Nt,wn,tn=arguments,ur,Zn,yr;return xg().w(function(kn){for(;;)switch(kn.n){case 0:if(i=tn.length>1&&tn[1]!==void 0?tn[1]:[],s=tn.length>2&&tn[2]!==void 0?tn[2]:{},o=s.lngAccessor,a=o===void 0?function(Rn){return Rn[0]}:o,c=s.latAccessor,f=c===void 0?function(Rn){return Rn[1]}:c,p=s.weightAccessor,g=p===void 0?function(){return 1}:p,v=s.bandwidth,(r=navigator)!==null&&r!==void 0&&r.gpu){kn.n=1;break}return console.warn("WebGPU not enabled in browser. Please consider enabling it to improve performance."),kn.a(2,t.map(function(Rn){return YH(Rn,i,{lngAccessor:a,latAccessor:f,weightAccessor:g,bandwidth:v})}));case 1:return b=4,T=eH,S=tH,N=hH,C=cH,P=oH,B=aH,F=nH,q=AH,I=uH,U=iH,G=rH,H=sH,te=lH,W=C(new O0(new Float32Array(t.flat().map(Vs)),2),"vec2",t.length),Z=C(new O0(new Float32Array(i.map(function(Rn){return[Vs(a(Rn)),Vs(f(Rn)),g(Rn)]}).flat()),3),"vec3",i.length),re=new O0(t.length,1),oe=C(re,"float",t.length),Y=P(Math.PI),ae=q(Y.mul(2)),he=function(Un){return Un.mul(Un)},be=function(Un){return he(I(Un.div(2)))},pe=function(Un,Hr){var Ao=P(Un[1]),na=P(Hr[1]),li=P(Un[0]),Pi=P(Hr[0]);return P(2).mul(G(q(be(na.sub(Ao)).add(U(Ao).mul(U(na)).mul(be(Pi.sub(li)))))))},Le=function(Un,Hr){return H(te(he(Un.div(Hr)).div(2))).div(Hr.mul(ae))},Ue=N(Vs(v)),Je=N(Vs(v*b)),st=N(i.length),ln=T(function(){var Rn=W.element(B),Un=oe.element(B);Un.assign(0),F(st,function(Hr){var Ao=Hr.i,na=Z.element(Ao),li=na.z;S(li,function(){var Pi=pe(na.xy,Rn.xy);S(Pi&&Pi.lessThan(Je),function(){Un.addAssign(Le(Pi,Ue).mul(li))})})})}),Nt=ln().compute(t.length),wn=new qw,kn.n=2,wn.computeAsync(Nt);case 2:return ur=Array,Zn=Float32Array,kn.n=3,wn.getArrayBufferAsync(re);case 3:return yr=kn.v,kn.a(2,ur.from.call(ur,new Zn(yr)))}},e)}));return function(t){return n.apply(this,arguments)}})(),o0=window.THREE?window.THREE:{Mesh:pn,MeshLambertMaterial:ao,SphereGeometry:Wo},KH=3.5,ZH=.1,Sx=100,JH=function(e){var t=qa(EL(e));return t.opacity=Math.cbrt(e),t.formatRgb()},eS=Vn({props:{heatmapsData:{default:[]},heatmapPoints:{default:function(e){return e}},heatmapPointLat:{default:function(e){return e[0]}},heatmapPointLng:{default:function(e){return e[1]}},heatmapPointWeight:{default:1},heatmapBandwidth:{default:2.5},heatmapColorFn:{default:function(){return JH}},heatmapColorSaturation:{default:1.5},heatmapBaseAltitude:{default:.01},heatmapTopAltitude:{},heatmapsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;Kt(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new jr(e,{objBindAttr:"__threeObjHeatmap"}).onCreateObj(function(){var s=new o0.Mesh(new o0.SphereGeometry(nn),e_(new o0.MeshLambertMaterial({vertexColors:!0,transparent:!0}),VH));return s.__globeObjType="heatmap",s})},update:function(e){var t=ye(e.heatmapPoints),r=ye(e.heatmapPointLat),i=ye(e.heatmapPointLng),s=ye(e.heatmapPointWeight),o=ye(e.heatmapBandwidth),a=ye(e.heatmapColorFn),c=ye(e.heatmapColorSaturation),f=ye(e.heatmapBaseAltitude),p=ye(e.heatmapTopAltitude);e.dataMapper.onUpdateObj(function(g,v){var b=o(v),T=a(v),S=c(v),N=f(v),C=p(v),P=t(v).map(function(U){var G=r(U),H=i(U),te=Ni(G,H),W=te.x,Z=te.y,re=te.z;return{x:W,y:Z,z:re,lat:G,lng:H,weight:s(U)}}),B=Math.max(ZH,b/KH),F=Math.ceil(360/(B||-1));g.geometry.parameters.widthSegments!==F&&(g.geometry.dispose(),g.geometry=new o0.SphereGeometry(nn,F,F/2));var q=GH(g.geometry.getAttribute("position")),I=q.map(function(U){var G=on(U,3),H=G[0],te=G[1],W=G[2],Z=Ww({x:H,y:te,z:W}),re=Z.lng,oe=Z.lat;return[re,oe]});XH(I,P,{latAccessor:function(G){return G.lat},lngAccessor:function(G){return G.lng},weightAccessor:function(G){return G.weight},bandwidth:b}).then(function(U){var G=Wt(new Array(Sx)).map(function(Z,re){return Ho(T(re/(Sx-1)))}),H=function(re){var oe=g.__currentTargetD=re,Y=oe.kdeVals,ae=oe.topAlt,he=oe.saturation,be=$C(Y.map(Math.abs))||1e-15,pe=Zb([0,be/he],G);g.geometry.setAttribute("color",Cs(Y.map(function(Ue){return pe(Math.abs(Ue))}),4));var Le=Js([0,be],[nn*(1+N),nn*(1+(ae||N))]);g.geometry.setAttribute("r",Cs(Y.map(Le)))},te={kdeVals:U,topAlt:C,saturation:S},W=g.__currentTargetD||Object.assign({},te,{kdeVals:U.map(function(){return 0}),topAlt:C&&N,saturation:.5});W.kdeVals.length!==U.length&&(W.kdeVals=U.slice()),Object.keys(te).some(function(Z){return W[Z]!==te[Z]})&&(!e.heatmapsTransitionDuration||e.heatmapsTransitionDuration<0?H(te):e.tweenGroup.add(new _r(W).to(te,e.heatmapsTransitionDuration).easing(On.Quadratic.InOut).onUpdate(H).start()))})}).digest(e.heatmapsData)}}),So=window.THREE?window.THREE:{DoubleSide:vi,Group:Ms,LineBasicMaterial:rf,LineSegments:Pb,Mesh:pn,MeshBasicMaterial:cs},tS=Vn({props:{polygonsData:{default:[]},polygonGeoJsonGeometry:{default:"geometry"},polygonSideColor:{default:function(){return"#ffffaa"}},polygonSideMaterial:{},polygonCapColor:{default:function(){return"#ffffaa"}},polygonCapMaterial:{},polygonStrokeColor:{},polygonAltitude:{default:.01},polygonCapCurvatureResolution:{default:5},polygonsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;Kt(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new jr(e,{objBindAttr:"__threeObjPolygon"}).id(function(s){return s.id}).onCreateObj(function(){var s=new So.Group;return s.__defaultSideMaterial=e_(new So.MeshBasicMaterial({side:So.DoubleSide,depthWrite:!0}),Tg),s.__defaultCapMaterial=new So.MeshBasicMaterial({side:So.DoubleSide,depthWrite:!0}),s.add(new So.Mesh(void 0,[s.__defaultSideMaterial,s.__defaultCapMaterial])),s.add(new So.LineSegments(void 0,new So.LineBasicMaterial)),s.__globeObjType="polygon",s})},update:function(e){var t=ye(e.polygonGeoJsonGeometry),r=ye(e.polygonAltitude),i=ye(e.polygonCapCurvatureResolution),s=ye(e.polygonCapColor),o=ye(e.polygonCapMaterial),a=ye(e.polygonSideColor),c=ye(e.polygonSideMaterial),f=ye(e.polygonStrokeColor),p=[];e.polygonsData.forEach(function(g){var v={data:g,capColor:s(g),capMaterial:o(g),sideColor:a(g),sideMaterial:c(g),strokeColor:f(g),altitude:+r(g),capCurvatureResolution:+i(g)},b=t(g),T=g.__id||"".concat(Math.round(Math.random()*1e9));g.__id=T,b.type==="Polygon"?p.push(Ut({id:"".concat(T,"_0"),coords:b.coordinates},v)):b.type==="MultiPolygon"?p.push.apply(p,Wt(b.coordinates.map(function(S,N){return Ut({id:"".concat(T,"_").concat(N),coords:S},v)}))):console.warn("Unsupported GeoJson geometry type: ".concat(b.type,". Skipping geometry..."))}),e.dataMapper.onUpdateObj(function(g,v){var b=v.coords,T=v.capColor,S=v.capMaterial,N=v.sideColor,C=v.sideMaterial,P=v.strokeColor,B=v.altitude,F=v.capCurvatureResolution,q=on(g.children,2),I=q[0],U=q[1],G=!!P;U.visible=G;var H=!!(T||S),te=!!(N||C);eW(I.geometry.parameters||{},{polygonGeoJson:b,curvatureResolution:F,closedTop:H,includeSides:te})||(I.geometry&&I.geometry.dispose(),I.geometry=new _1(b,0,nn,!1,H,te,F)),G&&(!U.geometry.parameters||U.geometry.parameters.geoJson.coordinates!==b||U.geometry.parameters.resolution!==F)&&(U.geometry&&U.geometry.dispose(),U.geometry=new B4({type:"Polygon",coordinates:b},nn,F));var W=te?0:-1,Z=H?te?1:0:-1;if(W>=0&&(I.material[W]=C||g.__defaultSideMaterial),Z>=0&&(I.material[Z]=S||g.__defaultCapMaterial),[[!C&&N,W],[!S&&T,Z]].forEach(function(be){var pe=on(be,2),Le=pe[0],Ue=pe[1];if(!(!Le||Ue<0)){var Je=I.material[Ue],st=ji(Le);Je.color.set(Rs(Le)),Je.transparent=st<1,Je.opacity=st}}),G){var re=U.material,oe=ji(P);re.color.set(Rs(P)),re.transparent=oe<1,re.opacity=oe}var Y={alt:B},ae=function(pe){var Le=g.__currentTargetD=pe,Ue=Le.alt;I.scale.x=I.scale.y=I.scale.z=1+Ue,G&&(U.scale.x=U.scale.y=U.scale.z=1+Ue+1e-4),zH(g.__defaultSideMaterial,function(Je){return Je.uSurfaceRadius.value=nn/(Ue+1)})},he=g.__currentTargetD||Object.assign({},Y,{alt:-.001});Object.keys(Y).some(function(be){return he[be]!==Y[be]})&&(!e.polygonsTransitionDuration||e.polygonsTransitionDuration<0||he.alt===Y.alt?ae(Y):e.tweenGroup.add(new _r(he).to(Y,e.polygonsTransitionDuration).easing(On.Quadratic.InOut).onUpdate(ae).start()))}).digest(p)}});function eW(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){return function(r,i){return r===i}};return Object.entries(e).every(function(r){var i=on(r,2),s=i[0],o=i[1];return n.hasOwnProperty(s)&&t(s)(n[s],o)})}var bl=window.THREE?window.THREE:{BufferGeometry:oi,DoubleSide:vi,Mesh:pn,MeshLambertMaterial:ao,Vector3:we},Ex=Object.assign({},Jg),Nx=Ex.BufferGeometryUtils||Ex,nS=Vn({props:{hexPolygonsData:{default:[]},hexPolygonGeoJsonGeometry:{default:"geometry"},hexPolygonColor:{default:function(){return"#ffffaa"}},hexPolygonAltitude:{default:.001},hexPolygonResolution:{default:3},hexPolygonMargin:{default:.2},hexPolygonUseDots:{default:!1},hexPolygonCurvatureResolution:{default:5},hexPolygonDotResolution:{default:12},hexPolygonsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;Kt(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new jr(e,{objBindAttr:"__threeObjHexPolygon"}).onCreateObj(function(){var s=new bl.Mesh(void 0,new bl.MeshLambertMaterial({side:bl.DoubleSide}));return s.__globeObjType="hexPolygon",s})},update:function(e){var t=ye(e.hexPolygonGeoJsonGeometry),r=ye(e.hexPolygonColor),i=ye(e.hexPolygonAltitude),s=ye(e.hexPolygonResolution),o=ye(e.hexPolygonMargin),a=ye(e.hexPolygonUseDots),c=ye(e.hexPolygonCurvatureResolution),f=ye(e.hexPolygonDotResolution);e.dataMapper.onUpdateObj(function(p,g){var v=t(g),b=s(g),T=i(g),S=Math.max(0,Math.min(1,+o(g))),N=a(g),C=c(g),P=f(g),B=r(g),F=ji(B);p.material.color.set(Rs(B)),p.material.transparent=F<1,p.material.opacity=F;var q={alt:T,margin:S,curvatureResolution:C},I={geoJson:v,h3Res:b},U=p.__currentTargetD||Object.assign({},q,{alt:-.001}),G=p.__currentMemD||I;if(Object.keys(q).some(function(Z){return U[Z]!==q[Z]})||Object.keys(I).some(function(Z){return G[Z]!==I[Z]})){p.__currentMemD=I;var H=[];v.type==="Polygon"?z3(v.coordinates,b,!0).forEach(function(Z){return H.push(Z)}):v.type==="MultiPolygon"?v.coordinates.forEach(function(Z){return z3(Z,b,!0).forEach(function(re){return H.push(re)})}):console.warn("Unsupported GeoJson geometry type: ".concat(v.type,". Skipping geometry..."));var te=H.map(function(Z){var re=K4(Z),oe=Z4(Z,!0).reverse(),Y=re[1];return oe.forEach(function(ae){var he=ae[0];Math.abs(Y-he)>170&&(ae[0]+=Y>he?360:-360)}),{h3Idx:Z,hexCenter:re,hexGeoJson:oe}}),W=function(re){var oe=p.__currentTargetD=re,Y=oe.alt,ae=oe.margin,he=oe.curvatureResolution;p.geometry&&p.geometry.dispose(),p.geometry=te.length?(Nx.mergeGeometries||Nx.mergeBufferGeometries)(te.map(function(be){var pe=on(be.hexCenter,2),Le=pe[0],Ue=pe[1];if(N){var Je=Ni(Le,Ue,Y),st=Ni(be.hexGeoJson[0][1],be.hexGeoJson[0][0],Y),ln=.85*(1-ae)*new bl.Vector3(Je.x,Je.y,Je.z).distanceTo(new bl.Vector3(st.x,st.y,st.z)),Nt=new Bb(ln,P);return Nt.rotateX(Ta(-Le)),Nt.rotateY(Ta(Ue)),Nt.translate(Je.x,Je.y,Je.z),Nt}else{var wn=function(Zn,yr,kn){return Zn-(Zn-yr)*kn},tn=ae===0?be.hexGeoJson:be.hexGeoJson.map(function(ur){var Zn=on(ur,2),yr=Zn[0],kn=Zn[1];return[[yr,Ue],[kn,Le]].map(function(Rn){var Un=on(Rn,2),Hr=Un[0],Ao=Un[1];return wn(Hr,Ao,ae)})});return new _1([tn],nn,nn*(1+Y),!1,!0,!1,he)}})):new bl.BufferGeometry};!e.hexPolygonsTransitionDuration||e.hexPolygonsTransitionDuration<0?W(q):e.tweenGroup.add(new _r(U).to(q,e.hexPolygonsTransitionDuration).easing(On.Quadratic.InOut).onUpdate(W).start())}}).digest(e.hexPolygonsData)}}),tW=window.THREE?window.THREE:{Vector3:we};function nW(n,e){var t=function(o,a){var c=o[o.length-1];return[].concat(Wt(o),Wt(Array(a-o.length).fill(c)))},r=Math.max(n.length,e.length),i=u9.apply(void 0,Wt([n,e].map(function(s){return s.map(function(o){var a=o.x,c=o.y,f=o.z;return[a,c,f]})}).map(function(s){return t(s,r)})));return function(s){return s===0?n:s===1?e:i(s).map(function(o){var a=on(o,3),c=a[0],f=a[1],p=a[2];return new tW.Vector3(c,f,p)})}}var ma=window.THREE?window.THREE:{BufferGeometry:oi,Color:Gn,Group:Ms,Line:e1,NormalBlending:js,ShaderMaterial:Xl,Vector3:we},rW=nu.default||nu,rS=Vn({props:{pathsData:{default:[]},pathPoints:{default:function(e){return e}},pathPointLat:{default:function(e){return e[0]}},pathPointLng:{default:function(e){return e[1]}},pathPointAlt:{default:.001},pathResolution:{default:2},pathColor:{default:function(){return"#ffffaa"}},pathStroke:{},pathDashLength:{default:1},pathDashGap:{default:0},pathDashInitialGap:{default:0},pathDashAnimateTime:{default:0},pathTransitionDuration:{default:1e3,triggerUpdate:!1},rendererSize:{}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.resume()},_destructor:function(e){var t;(t=e.ticker)===null||t===void 0||t.dispose()}},stateInit:function(e){var t=e.tweenGroup;return{tweenGroup:t,ticker:new rW,sharedMaterial:new ma.ShaderMaterial(Ut(Ut({},Xw()),{},{transparent:!0,blending:ma.NormalBlending}))}},init:function(e,t){Kt(e),t.scene=e,t.dataMapper=new jr(e,{objBindAttr:"__threeObjPath"}).onCreateObj(function(){var r=new ma.Group;return r.__globeObjType="path",r}),t.ticker.onTick.add(function(r,i){t.dataMapper.entries().map(function(s){var o=on(s,2),a=o[1];return a}).filter(function(s){return s.children.length&&s.children[0].material&&s.children[0].__dashAnimateStep}).forEach(function(s){var o=s.children[0],a=o.__dashAnimateStep*i;if(o.type==="Line"){var c=o.material.uniforms.dashTranslate.value%1e9;o.material.uniforms.dashTranslate.value=c+a}else if(o.type==="Line2"){for(var f=o.material.dashOffset-a,p=o.material.dashSize+o.material.gapSize;f<=-p;)f+=p;o.material.dashOffset=f}})})},update:function(e){var t=ye(e.pathPoints),r=ye(e.pathPointLat),i=ye(e.pathPointLng),s=ye(e.pathPointAlt),o=ye(e.pathStroke),a=ye(e.pathColor),c=ye(e.pathDashLength),f=ye(e.pathDashGap),p=ye(e.pathDashInitialGap),g=ye(e.pathDashAnimateTime);e.dataMapper.onUpdateObj(function(N,C){var P=o(C),B=P!=null;if(!N.children.length||B===(N.children[0].type==="Line")){Kt(N);var F=B?new mH(new Vw,new X2):new ma.Line(new ma.BufferGeometry,e.sharedMaterial.clone());N.add(F)}var q=N.children[0],I=b(t(C),r,i,s,e.pathResolution),U=g(C);if(q.__dashAnimateStep=U>0?1e3/U:0,B){q.material.resolution=e.rendererSize;{var te=c(C),W=f(C),Z=p(C);q.material.dashed=W>0,q.material.dashed?q.material.defines.USE_DASH="":delete q.material.defines.USE_DASH,q.material.dashed&&(q.material.dashScale=1/v(I),q.material.dashSize=te,q.material.gapSize=W,q.material.dashOffset=-Z)}{var re=a(C);if(re instanceof Array){var oe=T(a(C),I.length-1,1,!1);q.geometry.setColors(oe.array),q.material.vertexColors=!0}else{var Y=re,ae=ji(Y);q.material.color=new ma.Color(Rs(Y)),q.material.transparent=ae<1,q.material.opacity=ae,q.material.vertexColors=!1}}q.material.needsUpdate=!0}else{Object.assign(q.material.uniforms,{dashSize:{value:c(C)},gapSize:{value:f(C)},dashOffset:{value:p(C)}});var G=T(a(C),I.length),H=S(I.length,1,!0);q.geometry.setAttribute("color",G),q.geometry.setAttribute("relDistance",H)}var he=nW(N.__currentTargetD&&N.__currentTargetD.points||[I[0]],I),be=function(Je){var st=N.__currentTargetD=Je,ln=st.stroke,Nt=st.interpolK,wn=N.__currentTargetD.points=he(Nt);if(B){var tn;q.geometry.setPositions((tn=[]).concat.apply(tn,Wt(wn.map(function(ur){var Zn=ur.x,yr=ur.y,kn=ur.z;return[Zn,yr,kn]})))),q.material.linewidth=ln,q.material.dashed&&q.computeLineDistances()}else q.geometry.setFromPoints(wn),q.geometry.computeBoundingSphere()},pe={stroke:P,interpolK:1},Le=Object.assign({},N.__currentTargetD||pe,{interpolK:0});Object.keys(pe).some(function(Ue){return Le[Ue]!==pe[Ue]})&&(!e.pathTransitionDuration||e.pathTransitionDuration<0?be(pe):e.tweenGroup.add(new _r(Le).to(pe,e.pathTransitionDuration).easing(On.Quadratic.InOut).onUpdate(be).start()))}).digest(e.pathsData);function v(N){var C=0,P;return N.forEach(function(B){P&&(C+=P.distanceTo(B)),P=B}),C}function b(N,C,P,B,F){var q=function(H,te,W){for(var Z=[],re=1;re<=W;re++)Z.push(H+(te-H)*re/(W+1));return Z},I=function(){var H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],te=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,W=[],Z=null;return H.forEach(function(re){if(Z){for(;Math.abs(Z[1]-re[1])>180;)Z[1]+=360*(Z[1]<re[1]?1:-1);var oe=Math.sqrt(Math.pow(re[0]-Z[0],2)+Math.pow(re[1]-Z[1],2));if(oe>te)for(var Y=Math.floor(oe/te),ae=q(Z[0],re[0],Y),he=q(Z[1],re[1],Y),be=q(Z[2],re[2],Y),pe=0,Le=ae.length;pe<Le;pe++)W.push([ae[pe],he[pe],be[pe]])}W.push(Z=re)}),W},U=function(H){var te=on(H,3),W=te[0],Z=te[1],re=te[2],oe=Ni(W,Z,re),Y=oe.x,ae=oe.y,he=oe.z;return new ma.Vector3(Y,ae,he)};return I(N.map(function(G){return[C(G),P(G),B(G)]}),F).map(U)}function T(N,C){var P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,F=C+1,q;if(N instanceof Array||N instanceof Function){var I=N instanceof Array?Js().domain(N.map(function(re,oe){return oe/(N.length-1)})).range(N):N;q=function(oe){return Ho(I(oe),B,!0)}}else{var U=Ho(N,B,!0);q=function(){return U}}for(var G=[],H=0,te=F;H<te;H++)for(var W=q(H/(te-1)),Z=0;Z<P;Z++)G.push(W);return Cs(G,B?4:3)}function S(N){for(var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,B=N+1,F=[],q=0,I=B;q<I;q++)for(var U=q/(I-1),G=0;G<C;G++)F.push(U);return P&&F.reverse(),Cs(F,1)}}}),a0=window.THREE?window.THREE:{Euler:bA,Mesh:pn,MeshLambertMaterial:ao,SphereGeometry:Wo},iS=Vn({props:{tilesData:{default:[]},tileLat:{default:"lat"},tileLng:{default:"lng"},tileAltitude:{default:.01},tileWidth:{default:1},tileHeight:{default:1},tileUseGlobeProjection:{default:!0},tileMaterial:{default:function(){return new a0.MeshLambertMaterial({color:"#ffbb88",opacity:.4,transparent:!0})}},tileCurvatureResolution:{default:5},tilesTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;Kt(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new jr(e,{objBindAttr:"__threeObjTile"}).onCreateObj(function(){var s=new a0.Mesh;return s.__globeObjType="tile",s})},update:function(e){var t=ye(e.tileLat),r=ye(e.tileLng),i=ye(e.tileAltitude),s=ye(e.tileWidth),o=ye(e.tileHeight),a=ye(e.tileUseGlobeProjection),c=ye(e.tileMaterial),f=ye(e.tileCurvatureResolution);e.dataMapper.onUpdateObj(function(p,g){p.material=c(g);var v=a(g),b=f(g),T=function(P){var B=p.__currentTargetD=P,F=B.lat,q=B.lng,I=B.alt,U=B.width,G=B.height,H=Tl(q),te=Tl(-F);p.geometry&&p.geometry.dispose(),p.geometry=new a0.SphereGeometry(nn*(1+I),Math.ceil(U/(b||-1)),Math.ceil(G/(b||-1)),Tl(90-U/2)+(v?H:0),Tl(U),Tl(90-G/2)+(v?te:0),Tl(G)),v||p.setRotationFromEuler(new a0.Euler(te,H,0,"YXZ"))},S={lat:+t(g),lng:+r(g),alt:+i(g),width:+s(g),height:+o(g)},N=p.__currentTargetD||Object.assign({},S,{width:0,height:0});Object.keys(S).some(function(C){return N[C]!==S[C]})&&(!e.tilesTransitionDuration||e.tilesTransitionDuration<0?T(S):e.tweenGroup.add(new _r(N).to(S,e.tilesTransitionDuration).easing(On.Quadratic.InOut).onUpdate(T).start()))}).digest(e.tilesData)}}),Tl=function(e){return e*Math.PI/180},Wu=window.THREE?window.THREE:{BufferGeometry:oi,Color:Gn,Points:NR,PointsMaterial:Eb},sS=Vn({props:{particlesData:{default:[]},particlesList:{default:function(e){return e}},particleLat:{default:"lat"},particleLng:{default:"lng"},particleAltitude:{default:.01},particlesSize:{default:.5},particlesSizeAttenuation:{default:!0},particlesColor:{default:function(){return"white"}},particlesTexture:{}},init:function(e,t){Kt(e),t.scene=e,t.dataMapper=new jr(e,{objBindAttr:"__threeObjParticles"}).onCreateObj(function(){var r=new Wu.Points(new Wu.BufferGeometry,new Wu.PointsMaterial);return r.__globeObjType="particles",r}).onUpdateObj(function(r,i){var s=ye(t.particlesList),o=ye(t.particleLat),a=ye(t.particleLng),c=ye(t.particleAltitude);r.geometry.setAttribute("position",Cs(s(i).map(function(f){return Object.values(Ni(o(f),a(f),c(f)))}),3))})},update:function(e,t){["particlesData","particlesList","particleLat","particleLng","particleAltitude"].some(function(a){return t.hasOwnProperty(a)})&&e.dataMapper.digest(e.particlesData);var r=ye(e.particlesColor),i=ye(e.particlesSize),s=ye(e.particlesSizeAttenuation),o=ye(e.particlesTexture);e.dataMapper.entries().forEach(function(a){var c=on(a,2),f=c[0],p=c[1];if(p.material.size=i(f),p.material.sizeAttenuation=s(f),e.particlesTexture)p.material.color=new Wu.Color(16777215),p.material.transparent=!1,p.material.alphaTest=.5,p.material.map=o(f);else{var g=r(f),v=ji(g);p.material.color=new Wu.Color(Rs(g)),p.material.transparent=v<1,p.material.opacity=v,p.material.alphaTest=0}})}}),iW=window.THREE?window.THREE:{BufferGeometry:oi},sW=(function(n){function e(){var t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:32;$f(this,e),t=zf(this,e),t.type="CircleLineGeometry",t.parameters={radius:r,segmentCount:i};for(var s=[],o=0;o<=i;o++){var a=(o/i-.25)*Math.PI*2;s.push({x:Math.cos(a)*r,y:Math.sin(a)*r,z:0})}return t.setFromPoints(s),t}return Hf(e,n),jf(e)})(iW.BufferGeometry),wl=window.THREE?window.THREE:{Color:Gn,Group:Ms,Line:e1,LineBasicMaterial:rf,Vector3:we},oW=nu.default||nu,oS=Vn({props:{ringsData:{default:[]},ringLat:{default:"lat"},ringLng:{default:"lng"},ringAltitude:{default:.0015},ringColor:{default:function(){return"#ffffaa"},triggerUpdate:!1},ringResolution:{default:64,triggerUpdate:!1},ringMaxRadius:{default:2,triggerUpdate:!1},ringPropagationSpeed:{default:1,triggerUpdate:!1},ringRepeatPeriod:{default:700,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.pause()},resumeAnimation:function(e){var t;(t=e.ticker)===null||t===void 0||t.resume()},_destructor:function(e){var t;(t=e.ticker)===null||t===void 0||t.dispose()}},init:function(e,t,r){var i=r.tweenGroup;Kt(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new jr(e,{objBindAttr:"__threeObjRing",removeDelay:3e4}).onCreateObj(function(){var s=new wl.Group;return s.__globeObjType="ring",s}),t.ticker=new oW,t.ticker.onTick.add(function(s){if(t.ringsData.length){var o=ye(t.ringColor),a=ye(t.ringAltitude),c=ye(t.ringMaxRadius),f=ye(t.ringPropagationSpeed),p=ye(t.ringRepeatPeriod);t.dataMapper.entries().filter(function(g){var v=on(g,2),b=v[1];return b}).forEach(function(g){var v=on(g,2),b=v[0],T=v[1];if((T.__nextRingTime||0)<=s){var S=p(b)/1e3;T.__nextRingTime=s+(S<=0?1/0:S);var N=new wl.Line(new sW(1,t.ringResolution),new wl.LineBasicMaterial),C=o(b),P=C instanceof Array||C instanceof Function,B;P?C instanceof Array?(B=Js().domain(C.map(function(W,Z){return Z/(C.length-1)})).range(C),N.material.transparent=C.some(function(W){return ji(W)<1})):(B=C,N.material.transparent=!0):(N.material.color=new wl.Color(Rs(C)),qH(N.material,ji(C)));var F=nn*(1+a(b)),q=c(b),I=q*Math.PI/180,U=f(b),G=U<=0,H=function(Z){var re=Z.t,oe=(G?1-re:re)*I;if(N.scale.x=N.scale.y=F*Math.sin(oe),N.position.z=F*(1-Math.cos(oe)),P){var Y=B(re);N.material.color=new wl.Color(Rs(Y)),N.material.transparent&&(N.material.opacity=ji(Y))}};if(U===0)H({t:0}),T.add(N);else{var te=Math.abs(q/U)*1e3;t.tweenGroup.add(new _r({t:0}).to({t:1},te).onUpdate(H).onStart(function(){return T.add(N)}).onComplete(function(){T.remove(N),J2(N)}).start())}}})}})},update:function(e){var t=ye(e.ringLat),r=ye(e.ringLng),i=ye(e.ringAltitude),s=e.scene.localToWorld(new wl.Vector3(0,0,0));e.dataMapper.onUpdateObj(function(o,a){var c=t(a),f=r(a),p=i(a);Object.assign(o.position,Ni(c,f,p)),o.lookAt(s)}).digest(e.ringsData)}}),aW={0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},ο:{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"¦":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},Τ:{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},Π:{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},ΐ:{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"²":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"–":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},Κ:{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},ƒ:{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},ό:{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"»":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"©":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},ώ:{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"«":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"∙":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},ÿ:{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},µ:{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},Ι:{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},Ύ:{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"’":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},Ν:{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},ς:{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},Ψ:{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},ι:{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},Ά:{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},ε:{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},Δ:{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"‰":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"—":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},ρ:{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},"¯":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},Η:{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},Α:{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"…":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},ν:{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"¶":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},β:{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},Μ:{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},Ό:{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},Ή:{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"•":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"¥":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},γ:{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},α:{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"­":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},Χ:{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"†":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"°":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},Ξ:{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "}," ":{x_min:0,x_max:0,ha:853},Ϋ:{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},"”":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},Ί:{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},Β:{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},υ:{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},χ:{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},ί:{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},Ζ:{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"¨":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"‹":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"„":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},δ:{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},έ:{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},ω:{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"´":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"±":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},ϋ:{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"§":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},Ω:{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},ύ:{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"™":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},ή:{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},Θ:{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"®":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},Ε:{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"³":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},σ:{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},ζ:{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},θ:{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},Ο:{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},Γ:{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},Έ:{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},Ώ:{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},Ϊ:{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"½":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},Ρ:{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},ª:{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"΅":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},Φ:{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"⁋":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},Σ:{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},"›":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"£":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"¬":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},λ:{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},τ:{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},ξ:{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},Λ:{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},ΰ:{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"·":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},Υ:{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},μ:{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},φ:{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"“":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},"‘":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},ϊ:{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},π:{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},ά:{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"¤":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},κ:{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"‡":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},ψ:{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},η:{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},lW="normal",uW=1189,AW=-100,cW="normal",hW={yMin:-334,xMin:-111,yMax:1189,xMax:1672},fW=1e3,dW={postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) Μagenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"Μagenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:`Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r
\r
Permission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r
\r
The above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r
\r
The Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r
\r
This License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r
\r
The Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r
\r
THE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.`,manufacturer_name:"Μagenta ltd",font_sub_family_name:"Regular"},pW=-334,mW="Helvetiker",gW=1522,_W=50,yW={glyphs:aW,cssFontWeight:lW,ascender:uW,underlinePosition:AW,cssFontStyle:cW,boundingBox:hW,resolution:fW,original_font_information:dW,descender:pW,familyName:mW,lineHeight:gW,underlineThickness:_W},Fi=Ut(Ut({},window.THREE?window.THREE:{BoxGeometry:Yg,CircleGeometry:Bb,DoubleSide:vi,Group:Ms,Mesh:pn,MeshLambertMaterial:ao,TextGeometry:mx,Vector3:we}),{},{Font:gH,TextGeometry:mx}),aS=Vn({props:{labelsData:{default:[]},labelLat:{default:"lat"},labelLng:{default:"lng"},labelAltitude:{default:.002},labelText:{default:"text"},labelSize:{default:.5},labelTypeFace:{default:yW,onChange:function(e,t){t.font=new Fi.Font(e)}},labelColor:{default:function(){return"lightgrey"}},labelRotation:{default:0},labelResolution:{default:3},labelIncludeDot:{default:!0},labelDotRadius:{default:.1},labelDotOrientation:{default:function(){return"bottom"}},labelsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var i=r.tweenGroup;Kt(e),t.scene=e,t.tweenGroup=i;var s=new Fi.CircleGeometry(1,32);t.dataMapper=new jr(e,{objBindAttr:"__threeObjLabel"}).onCreateObj(function(){var o=new Fi.MeshLambertMaterial;o.side=vi;var a=new Fi.Group;a.add(new Fi.Mesh(s,o));var c=new Fi.Mesh(void 0,o);a.add(c);var f=new Fi.Mesh;return f.visible=!1,c.add(f),a.__globeObjType="label",a})},update:function(e){var t=ye(e.labelLat),r=ye(e.labelLng),i=ye(e.labelAltitude),s=ye(e.labelText),o=ye(e.labelSize),a=ye(e.labelRotation),c=ye(e.labelColor),f=ye(e.labelIncludeDot),p=ye(e.labelDotRadius),g=ye(e.labelDotOrientation),v=new Set(["right","top","bottom"]),b=2*Math.PI*nn/360;e.dataMapper.onUpdateObj(function(T,S){var N=on(T.children,2),C=N[0],P=N[1],B=on(P.children,1),F=B[0],q=c(S),I=ji(q);P.material.color.set(Rs(q)),P.material.transparent=I<1,P.material.opacity=I;var U=f(S),G=g(S);!U||!v.has(G)&&(G="bottom");var H=U?+p(S)*b:1e-12;C.scale.x=C.scale.y=H;var te=+o(S)*b;if(P.geometry&&P.geometry.dispose(),P.geometry=new Fi.TextGeometry(s(S),{font:e.font,size:te,depth:0,bevelEnabled:!0,bevelThickness:0,bevelSize:0,curveSegments:e.labelResolution}),F.geometry&&F.geometry.dispose(),P.geometry.computeBoundingBox(),F.geometry=K2(Fi.BoxGeometry,Wt(new Fi.Vector3().subVectors(P.geometry.boundingBox.max,P.geometry.boundingBox.min).clampScalar(0,1/0).toArray())),G!=="right"&&P.geometry.center(),U){var W=H+te/2;G==="right"&&(P.position.x=W),P.position.y={right:-te/2,top:W+te/2,bottom:-W-te/2}[G]}var Z=function(ae){var he=T.__currentTargetD=ae,be=he.lat,pe=he.lng,Le=he.alt,Ue=he.rot,Je=he.scale;Object.assign(T.position,Ni(be,pe,Le)),T.lookAt(e.scene.localToWorld(new Fi.Vector3(0,0,0))),T.rotateY(Math.PI),T.rotateZ(-Ue*Math.PI/180),T.scale.x=T.scale.y=T.scale.z=Je},re={lat:+t(S),lng:+r(S),alt:+i(S),rot:+a(S),scale:1},oe=T.__currentTargetD||Object.assign({},re,{scale:1e-12});Object.keys(re).some(function(Y){return oe[Y]!==re[Y]})&&(!e.labelsTransitionDuration||e.labelsTransitionDuration<0?Z(re):e.tweenGroup.add(new _r(oe).to(re,e.labelsTransitionDuration).easing(On.Quadratic.InOut).onUpdate(Z).start()))}).digest(e.labelsData)}}),vW=Ut(Ut({},window.THREE?window.THREE:{}),{},{CSS2DObject:DR}),lS=Vn({props:{htmlElementsData:{default:[]},htmlLat:{default:"lat"},htmlLng:{default:"lng"},htmlAltitude:{default:0},htmlElement:{},htmlElementVisibilityModifier:{triggerUpdate:!1},htmlTransitionDuration:{default:1e3,triggerUpdate:!1},isBehindGlobe:{onChange:function(){this.updateObjVisibility()},triggerUpdate:!1}},methods:{updateObjVisibility:function(e,t){if(e.dataMapper){var r=t?[t]:e.dataMapper.entries().map(function(i){var s=on(i,2),o=s[1];return o}).filter(function(i){return i});r.forEach(function(i){var s=!e.isBehindGlobe||!e.isBehindGlobe(i.position);e.htmlElementVisibilityModifier?(i.visible=!0,e.htmlElementVisibilityModifier(i.element,s)):i.visible=s})}}},init:function(e,t,r){var i=r.tweenGroup;Kt(e),t.scene=e,t.tweenGroup=i,t.dataMapper=new jr(e,{objBindAttr:"__threeObjHtml"}).onCreateObj(function(s){var o=ye(t.htmlElement)(s),a=new vW.CSS2DObject(o);return a.__globeObjType="html",a})},update:function(e,t){var r=this,i=ye(e.htmlLat),s=ye(e.htmlLng),o=ye(e.htmlAltitude);t.hasOwnProperty("htmlElement")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(a,c){var f=function(v){var b=a.__currentTargetD=v,T=b.alt,S=b.lat,N=b.lng;Object.assign(a.position,Ni(S,N,T)),r.updateObjVisibility(a)},p={lat:+i(c),lng:+s(c),alt:+o(c)};!e.htmlTransitionDuration||e.htmlTransitionDuration<0||!a.__currentTargetD?f(p):e.tweenGroup.add(new _r(a.__currentTargetD).to(p,e.htmlTransitionDuration).easing(On.Quadratic.InOut).onUpdate(f).start())}).digest(e.htmlElementsData)}}),l0=window.THREE?window.THREE:{Group:Ms,Mesh:pn,MeshLambertMaterial:ao,SphereGeometry:Wo},uS=Vn({props:{objectsData:{default:[]},objectLat:{default:"lat"},objectLng:{default:"lng"},objectAltitude:{default:.01},objectFacesSurface:{default:!0},objectRotation:{},objectThreeObject:{default:new l0.Mesh(new l0.SphereGeometry(1,16,8),new l0.MeshLambertMaterial({color:"#ffffaa",transparent:!0,opacity:.7}))}},init:function(e,t){Kt(e),t.scene=e,t.dataMapper=new jr(e,{objBindAttr:"__threeObjObject"}).onCreateObj(function(r){var i=ye(t.objectThreeObject)(r);t.objectThreeObject===i&&(i=i.clone());var s=new l0.Group;return s.add(i),s.__globeObjType="object",s})},update:function(e,t){var r=ye(e.objectLat),i=ye(e.objectLng),s=ye(e.objectAltitude),o=ye(e.objectFacesSurface),a=ye(e.objectRotation);t.hasOwnProperty("objectThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(c,f){var p=+r(f),g=+i(f),v=+s(f);Object.assign(c.position,Ni(p,g,v)),o(f)?c.setRotationFromEuler(new bA(Ta(-p),Ta(g),0,"YXZ")):c.rotation.set(0,0,0);var b=c.children[0],T=a(f);T&&b.setRotationFromEuler(new bA(Ta(T.x||0),Ta(T.y||0),Ta(T.z||0)))}).digest(e.objectsData)}}),AS=Vn({props:{customLayerData:{default:[]},customThreeObject:{},customThreeObjectUpdate:{triggerUpdate:!1}},init:function(e,t){Kt(e),t.scene=e,t.dataMapper=new jr(e,{objBindAttr:"__threeObjCustom"}).onCreateObj(function(r){var i=ye(t.customThreeObject)(r,nn);return i&&(t.customThreeObject===i&&(i=i.clone()),i.__globeObjType="custom"),i})},update:function(e,t){e.customThreeObjectUpdate||Kt(e.scene);var r=ye(e.customThreeObjectUpdate);t.hasOwnProperty("customThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(i,s){return r(i,s,nn)}).digest(e.customLayerData)}}),u0=window.THREE?window.THREE:{Camera:Lg,Group:Ms,Vector2:gt,Vector3:we},xW=["globeLayer","pointsLayer","arcsLayer","hexBinLayer","heatmapsLayer","polygonsLayer","hexedPolygonsLayer","pathsLayer","tilesLayer","particlesLayer","ringsLayer","labelsLayer","htmlElementsLayer","objectsLayer","customLayer"],cS=Pr("globeLayer",Qw),bW=Object.assign.apply(Object,Wt(["globeImageUrl","bumpImageUrl","globeCurvatureResolution","globeTileEngineUrl","globeTileEngineMaxLevel","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude"].map(function(n){return Kn({},n,cS.linkProp(n))}))),TW=Object.assign.apply(Object,Wt(["globeMaterial","globeTileEngineClearCache"].map(function(n){return Kn({},n,cS.linkMethod(n))}))),wW=Pr("pointsLayer",Yw),SW=Object.assign.apply(Object,Wt(["pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration"].map(function(n){return Kn({},n,wW.linkProp(n))}))),EW=Pr("arcsLayer",Kw),NW=Object.assign.apply(Object,Wt(["arcsData","arcStartLat","arcStartLng","arcStartAltitude","arcEndLat","arcEndLng","arcEndAltitude","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration"].map(function(n){return Kn({},n,EW.linkProp(n))}))),RW=Pr("hexBinLayer",Zw),CW=Object.assign.apply(Object,Wt(["hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration"].map(function(n){return Kn({},n,RW.linkProp(n))}))),MW=Pr("heatmapsLayer",eS),PW=Object.assign.apply(Object,Wt(["heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration"].map(function(n){return Kn({},n,MW.linkProp(n))}))),BW=Pr("hexedPolygonsLayer",nS),DW=Object.assign.apply(Object,Wt(["hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration"].map(function(n){return Kn({},n,BW.linkProp(n))}))),LW=Pr("polygonsLayer",tS),FW=Object.assign.apply(Object,Wt(["polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration"].map(function(n){return Kn({},n,LW.linkProp(n))}))),OW=Pr("pathsLayer",rS),IW=Object.assign.apply(Object,Wt(["pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration"].map(function(n){return Kn({},n,OW.linkProp(n))}))),kW=Pr("tilesLayer",iS),UW=Object.assign.apply(Object,Wt(["tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration"].map(function(n){return Kn({},n,kW.linkProp(n))}))),qW=Pr("particlesLayer",sS),GW=Object.assign.apply(Object,Wt(["particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture"].map(function(n){return Kn({},n,qW.linkProp(n))}))),VW=Pr("ringsLayer",oS),zW=Object.assign.apply(Object,Wt(["ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod"].map(function(n){return Kn({},n,VW.linkProp(n))}))),$W=Pr("labelsLayer",aS),jW=Object.assign.apply(Object,Wt(["labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration"].map(function(n){return Kn({},n,$W.linkProp(n))}))),HW=Pr("htmlElementsLayer",lS),WW=Object.assign.apply(Object,Wt(["htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration"].map(function(n){return Kn({},n,HW.linkProp(n))}))),QW=Pr("objectsLayer",uS),YW=Object.assign.apply(Object,Wt(["objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject"].map(function(n){return Kn({},n,QW.linkProp(n))}))),XW=Pr("customLayer",AS),KW=Object.assign.apply(Object,Wt(["customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(n){return Kn({},n,XW.linkProp(n))}))),ZW=Vn({props:Ut(Ut(Ut(Ut(Ut(Ut(Ut(Ut(Ut(Ut(Ut(Ut(Ut(Ut(Ut({onGlobeReady:{triggerUpdate:!1},rendererSize:{default:new u0.Vector2(window.innerWidth,window.innerHeight),onChange:function(e,t){t.pathsLayer.rendererSize(e)},triggerUpdate:!1}},bW),SW),NW),CW),PW),FW),DW),IW),UW),GW),zW),jW),WW),YW),KW),methods:Ut({getGlobeRadius:yx,getCoords:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ni.apply(void 0,r)},toGeoCoords:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Ww.apply(void 0,r)},setPointOfView:function(e,t){var r=t instanceof u0.Camera?t.position:t,i=yx(),s=void 0;if(e.scene&&r){var o,a,c,f;s=function(g){o===void 0&&(o=r.clone().applyMatrix4(e.scene.matrixWorld.clone().invert())),a===void 0&&(a=o.length()),c===void 0&&(c=Math.sqrt(Math.pow(a,2)-Math.pow(i,2))),f===void 0&&(f=Math.acos(c/a));var v=o.distanceTo(g);if(v<c)return!1;var b=g.length(),T=Math.acos((Math.pow(a,2)+Math.pow(v,2)-Math.pow(b,2))/(2*a*v));return T<f}}e.layersThatNeedUpdatePov.forEach(function(p){return p.updatePov(t)}),e.layersThatNeedBehindGlobeChecker.forEach(function(p){return p.isBehindGlobe(s)})},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),e.pausableLayers.forEach(function(t){var r;return(r=t.pauseAnimation)===null||r===void 0?void 0:r.call(t)}),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),e.pausableLayers.forEach(function(t){var r;return(r=t.resumeAnimation)===null||r===void 0?void 0:r.call(t)}),this},_animationCycle:function(e){e.animationFrameRequestId=requestAnimationFrame(this._animationCycle),e.tweenGroup.update()},_destructor:function(e){this.pauseAnimation(),e.destructableLayers.forEach(function(t){return t._destructor()})}},TW),stateInit:function(){var e=new of,t={tweenGroup:e},r={globeLayer:Qw(t),pointsLayer:Yw(t),arcsLayer:Kw(t),hexBinLayer:Zw(t),heatmapsLayer:eS(t),polygonsLayer:tS(t),hexedPolygonsLayer:nS(t),pathsLayer:rS(t),tilesLayer:iS(t),particlesLayer:sS(t),ringsLayer:oS(t),labelsLayer:aS(t),htmlElementsLayer:lS(t),objectsLayer:uS(t),customLayer:AS(t)};return Ut(Ut({tweenGroup:e},r),{},{layersThatNeedUpdatePov:Object.values(r).filter(function(i){return i.hasOwnProperty("updatePov")}),layersThatNeedBehindGlobeChecker:Object.values(r).filter(function(i){return i.hasOwnProperty("isBehindGlobe")}),destructableLayers:Object.values(r).filter(function(i){return i.hasOwnProperty("_destructor")}),pausableLayers:Object.values(r).filter(function(i){return i.hasOwnProperty("pauseAnimation")})})},init:function(e,t,r){var i=r.animateIn,s=i===void 0?!0:i,o=r.waitForGlobeReady,a=o===void 0?!0:o;Kt(e),t.scene=e,t.scene.visible=!1,xW.forEach(function(f){var p=new u0.Group;t.scene.add(p),t[f](p)});var c=function(){if(s){t.scene.scale.set(1e-6,1e-6,1e-6),t.tweenGroup.add(new _r({k:1e-6}).to({k:1},600).easing(On.Quadratic.Out).onUpdate(function(g){var v=g.k;return t.scene.scale.set(v,v,v)}).start());var p=new u0.Vector3(0,1,0);t.tweenGroup.add(new _r({rot:Math.PI*2}).to({rot:0},1200).easing(On.Quintic.Out).onUpdate(function(g){var v=g.rot;return t.scene.setRotationFromAxisAngle(p,v)}).start())}t.scene.visible=!0,t.onGlobeReady&&t.onGlobeReady()};a?t.globeLayer.onReady(c):c(),this._animationCycle()},update:function(e){}});function JW(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=(function(i){function s(){var o;$f(this,s);for(var a=arguments.length,c=new Array(a),f=0;f<a;f++)c[f]=arguments[f];return o=zf(this,s,[].concat(c)),o.__kapsuleInstance=K2(n,[].concat(Wt(t?[o]:[]),c)),o}return Hf(s,i),jf(s)})(e);return Object.keys(n()).forEach(function(i){return r.prototype[i]=function(){var s,o=(s=this.__kapsuleInstance)[i].apply(s,arguments);return o===this.__kapsuleInstance?this:o}}),r}var eQ=window.THREE?window.THREE:{Group:Ms},hS=JW(ZW,eQ.Group,!0);const Bp={type:"change"},t_={type:"start"},n_={type:"end"},Rx=1e-6,Ot={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},A0=new gt,Eo=new gt,tQ=new we,c0=new we,Dp=new we,Sl=new Hl,Cx=new we,h0=new we,Lp=new we,f0=new we;class nQ extends t1{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:xi.ROTATE,MIDDLE:xi.DOLLY,RIGHT:xi.PAN},this.target=new we,this.state=Ot.NONE,this.keyState=Ot.NONE,this._lastPosition=new we,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new we,this._movePrev=new gt,this._moveCurr=new gt,this._lastAxis=new we,this._zoomStart=new gt,this._zoomEnd=new gt,this._panStart=new gt,this._panEnd=new gt,this._pointers=[],this._pointerPositions={},this._onPointerMove=iQ.bind(this),this._onPointerDown=rQ.bind(this),this._onPointerUp=sQ.bind(this),this._onPointerCancel=oQ.bind(this),this._onContextMenu=fQ.bind(this),this._onMouseWheel=hQ.bind(this),this._onKeyDown=lQ.bind(this),this._onKeyUp=aQ.bind(this),this._onTouchStart=dQ.bind(this),this._onTouchMove=pQ.bind(this),this._onTouchEnd=mQ.bind(this),this._onMouseDown=uQ.bind(this),this._onMouseMove=AQ.bind(this),this._onMouseUp=cQ.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>Rx&&(this.dispatchEvent(Bp),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>Rx||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(Bp),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Ot.NONE,this.keyState=Ot.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(Bp),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(Eo.copy(this._panEnd).sub(this._panStart),Eo.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;Eo.x*=e,Eo.y*=t}Eo.multiplyScalar(this._eye.length()*this.panSpeed),c0.copy(this._eye).cross(this.object.up).setLength(Eo.x),c0.add(tQ.copy(this.object.up).setLength(Eo.y)),this.object.position.add(c0),this.target.add(c0),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(Eo.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){f0.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=f0.length();e?(this._eye.copy(this.object.position).sub(this.target),Cx.copy(this._eye).normalize(),h0.copy(this.object.up).normalize(),Lp.crossVectors(h0,Cx).normalize(),h0.setLength(this._moveCurr.y-this._movePrev.y),Lp.setLength(this._moveCurr.x-this._movePrev.x),f0.copy(h0.add(Lp)),Dp.crossVectors(f0,this._eye).normalize(),e*=this.rotateSpeed,Sl.setFromAxisAngle(Dp,e),this._eye.applyQuaternion(Sl),this.object.up.applyQuaternion(Sl),this._lastAxis.copy(Dp),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Sl.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Sl),this.object.up.applyQuaternion(Sl)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Ot.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Yl.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Yl.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return A0.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),A0}_getMouseOnCircle(e,t){return A0.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),A0}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new gt,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function rQ(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n))}function iQ(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function sQ(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchEnd(n):this._onMouseUp(),this._removePointer(n),this._pointers.length===0&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp)))}function oQ(n){this._removePointer(n)}function aQ(){this.enabled!==!1&&(this.keyState=Ot.NONE,window.addEventListener("keydown",this._onKeyDown))}function lQ(n){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Ot.NONE&&(n.code===this.keys[Ot.ROTATE]&&!this.noRotate?this.keyState=Ot.ROTATE:n.code===this.keys[Ot.ZOOM]&&!this.noZoom?this.keyState=Ot.ZOOM:n.code===this.keys[Ot.PAN]&&!this.noPan&&(this.keyState=Ot.PAN)))}function uQ(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case xi.DOLLY:this.state=Ot.ZOOM;break;case xi.ROTATE:this.state=Ot.ROTATE;break;case xi.PAN:this.state=Ot.PAN;break;default:this.state=Ot.NONE}const t=this.keyState!==Ot.NONE?this.keyState:this.state;t===Ot.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr)):t===Ot.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Ot.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(n.pageX,n.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(t_)}function AQ(n){const e=this.keyState!==Ot.NONE?this.keyState:this.state;e===Ot.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY))):e===Ot.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY)):e===Ot.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(n.pageX,n.pageY))}function cQ(){this.state=Ot.NONE,this.dispatchEvent(n_)}function hQ(n){if(this.enabled!==!1&&this.noZoom!==!0){switch(n.preventDefault(),n.deltaMode){case 2:this._zoomStart.y-=n.deltaY*.025;break;case 1:this._zoomStart.y-=n.deltaY*.01;break;default:this._zoomStart.y-=n.deltaY*25e-5;break}this.dispatchEvent(t_),this.dispatchEvent(n_)}}function fQ(n){this.enabled!==!1&&n.preventDefault()}function dQ(n){switch(this._trackPointer(n),this._pointers.length){case 1:this.state=Ot.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Ot.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const r=(this._pointers[0].pageX+this._pointers[1].pageX)/2,i=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(r,i)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(t_)}function pQ(n){switch(this._trackPointer(n),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY));break;default:const e=this._getSecondPointerPosition(n),t=n.pageX-e.x,r=n.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);const i=(n.pageX+e.x)/2,s=(n.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,s));break}}function mQ(n){switch(this._pointers.length){case 0:this.state=Ot.NONE;break;case 1:this.state=Ot.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(n.pageX,n.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Ot.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==n.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(n_)}const Mx={type:"change"},r_={type:"start"},fS={type:"end"},d0=new RR,Px=new zg,gQ=Math.cos(70*Yl.DEG2RAD),qn=new we,Lr=2*Math.PI,Yt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Fp=1e-6;class _Q extends t1{constructor(e,t=null){super(e,t),this.state=Yt.NONE,this.target=new we,this.cursor=new we,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:xi.ROTATE,MIDDLE:xi.DOLLY,RIGHT:xi.PAN},this.touches={ONE:Cl.ROTATE,TWO:Cl.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new we,this._lastQuaternion=new Hl,this._lastTargetPosition=new we,this._quat=new Hl().setFromUnitVectors(e.up,new we(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new py,this._sphericalDelta=new py,this._scale=1,this._panOffset=new we,this._rotateStart=new gt,this._rotateEnd=new gt,this._rotateDelta=new gt,this._panStart=new gt,this._panEnd=new gt,this._panDelta=new gt,this._dollyStart=new gt,this._dollyEnd=new gt,this._dollyDelta=new gt,this._dollyDirection=new we,this._mouse=new gt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=vQ.bind(this),this._onPointerDown=yQ.bind(this),this._onPointerUp=xQ.bind(this),this._onContextMenu=RQ.bind(this),this._onMouseWheel=wQ.bind(this),this._onKeyDown=SQ.bind(this),this._onTouchStart=EQ.bind(this),this._onTouchMove=NQ.bind(this),this._onMouseDown=bQ.bind(this),this._onMouseMove=TQ.bind(this),this._interceptControlDown=CQ.bind(this),this._interceptControlUp=MQ.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Mx),this.update(),this.state=Yt.NONE}update(e=null){const t=this.object.position;qn.copy(t).sub(this.target),qn.applyQuaternion(this._quat),this._spherical.setFromVector3(qn),this.autoRotate&&this.state===Yt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(r)&&isFinite(i)&&(r<-Math.PI?r+=Lr:r>Math.PI&&(r-=Lr),i<-Math.PI?i+=Lr:i>Math.PI&&(i-=Lr),r<=i?this._spherical.theta=Math.max(r,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(r+i)/2?Math.max(r,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(qn.setFromSpherical(this._spherical),qn.applyQuaternion(this._quatInverse),t.copy(this.target).add(qn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=qn.length();o=this._clampDistance(a*this._scale);const c=a-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const a=new we(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const f=new we(this._mouse.x,this._mouse.y,0);f.unproject(this.object),this.object.position.sub(f).add(a),this.object.updateMatrixWorld(),o=qn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(d0.origin.copy(this.object.position),d0.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(d0.direction))<gQ?this.object.lookAt(this.target):(Px.setFromNormalAndCoplanarPoint(this.object.up,this.target),d0.intersectPlane(Px,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>Fp||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Fp||this._lastTargetPosition.distanceToSquared(this.target)>Fp?(this.dispatchEvent(Mx),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Lr/60*this.autoRotateSpeed*e:Lr/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){qn.setFromMatrixColumn(t,0),qn.multiplyScalar(-e),this._panOffset.add(qn)}_panUp(e,t){this.screenSpacePanning===!0?qn.setFromMatrixColumn(t,1):(qn.setFromMatrixColumn(t,0),qn.crossVectors(this.object.up,qn)),qn.multiplyScalar(e),this._panOffset.add(qn)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;qn.copy(i).sub(this.target);let s=qn.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/r.clientHeight,this.object.matrix),this._panUp(2*t*s/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),i=e-r.left,s=t-r.top,o=r.width,a=r.height;this._mouse.x=i/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Lr*this._rotateDelta.x/t.clientHeight),this._rotateUp(Lr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Lr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Lr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Lr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Lr*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(r,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(r,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const r=this._getSecondPointerPosition(e),i=.5*(e.pageX+r.x),s=.5*(e.pageY+r.y);this._rotateEnd.set(i,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Lr*this._rotateDelta.x/t.clientHeight),this._rotateUp(Lr*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(r,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(r*r+i*i);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new gt,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function yQ(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function vQ(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function xQ(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(fS),this.state=Yt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function bQ(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case xi.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Yt.DOLLY;break;case xi.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Yt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Yt.ROTATE}break;case xi.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Yt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Yt.PAN}break;default:this.state=Yt.NONE}this.state!==Yt.NONE&&this.dispatchEvent(r_)}function TQ(n){switch(this.state){case Yt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Yt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Yt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function wQ(n){this.enabled===!1||this.enableZoom===!1||this.state!==Yt.NONE||(n.preventDefault(),this.dispatchEvent(r_),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(fS))}function SQ(n){this.enabled!==!1&&this._handleKeyDown(n)}function EQ(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case Cl.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Yt.TOUCH_ROTATE;break;case Cl.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Yt.TOUCH_PAN;break;default:this.state=Yt.NONE}break;case 2:switch(this.touches.TWO){case Cl.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Yt.TOUCH_DOLLY_PAN;break;case Cl.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Yt.TOUCH_DOLLY_ROTATE;break;default:this.state=Yt.NONE}break;default:this.state=Yt.NONE}this.state!==Yt.NONE&&this.dispatchEvent(r_)}function NQ(n){switch(this._trackPointer(n),this.state){case Yt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Yt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Yt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Yt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Yt.NONE}}function RQ(n){this.enabled!==!1&&n.preventDefault()}function CQ(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function MQ(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const PQ={type:"change"},Bx=1e-6,Dx=new Hl;class BQ extends t1{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new we(0,0,0),this._rotationVector=new we(0,0,0),this._lastQuaternion=new Hl,this._lastPosition=new we,this._status=0,this._onKeyDown=DQ.bind(this),this._onKeyUp=LQ.bind(this),this._onPointerMove=OQ.bind(this),this._onPointerDown=FQ.bind(this),this._onPointerUp=IQ.bind(this),this._onPointerCancel=kQ.bind(this),this._onContextMenu=UQ.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,r=e*this.movementSpeed,i=e*this.rollSpeed;t.translateX(this._moveVector.x*r),t.translateY(this._moveVector.y*r),t.translateZ(this._moveVector.z*r),Dx.set(this._rotationVector.x*i,this._rotationVector.y*i,this._rotationVector.z*i,1).normalize(),t.quaternion.multiply(Dx),(this._lastPosition.distanceToSquared(t.position)>Bx||8*(1-this._lastQuaternion.dot(t.quaternion))>Bx)&&(this.dispatchEvent(PQ),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function DQ(n){if(!(n.altKey||this.enabled===!1)){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function LQ(n){if(this.enabled!==!1){switch(n.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function FQ(n){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(n.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function OQ(n){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,r=e.size[1]/2;this._moveState.yawLeft=-(n.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(n.pageY-e.offset[1]-r)/r,this._updateRotationVector()}}function IQ(n){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(n.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function kQ(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function UQ(n){this.enabled!==!1&&n.preventDefault()}const qQ={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Wf{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const GQ=new kg(-1,1,1,-1,0,1);class VQ extends oi{constructor(){super(),this.setAttribute("position",new Go([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Go([0,2,0,0,2,0],2))}}const zQ=new VQ;class $Q{constructor(e){this._mesh=new pn(zQ,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,GQ)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class jQ extends Wf{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof Xl?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Zg.clone(e.uniforms),this.material=new Xl({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new $Q(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class Lx extends Wf{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class HQ extends Wf{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class WQ{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new gt);this._width=r.width,this._height=r.height,t=new CR(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:rr}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new jQ(qQ),this.copyPass.material.blending=Ql,this.clock=new Db}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let i=0,s=this.passes.length;i<s;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),o.needsSwap){if(r){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Lx!==void 0&&(o instanceof Lx?r=!0:o instanceof HQ&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new gt);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class QQ extends Wf{constructor(e,t,r=null,i=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this.isRenderPass=!0,this._oldClearColor=new Gn}render(e,t,r){const i=e.autoClear;e.autoClear=!1;let s,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=i}}function $r(){return $r=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},$r.apply(null,arguments)}function YQ(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function VA(n,e){return VA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},VA(n,e)}function XQ(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,VA(n,e)}function wg(n){return wg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},wg(n)}function KQ(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch{return typeof n=="function"}}function dS(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dS=function(){return!!n})()}function ZQ(n,e,t){if(dS())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return t&&VA(i,t.prototype),i}function Sg(n){var e=typeof Map=="function"?new Map:void 0;return Sg=function(r){if(r===null||!KQ(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return ZQ(r,arguments,wg(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),VA(i,r)},Sg(n)}var ps=(function(n){XQ(e,n);function e(t){var r;return r=n.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,YQ(r)}return e})(Sg(Error));function Op(n){return Math.round(n*255)}function JQ(n,e,t){return Op(n)+","+Op(e)+","+Op(t)}function Hh(n,e,t,r){if(r===void 0&&(r=JQ),e===0)return r(t,t,t);var i=(n%360+360)%360/60,s=(1-Math.abs(2*t-1))*e,o=s*(1-Math.abs(i%2-1)),a=0,c=0,f=0;i>=0&&i<1?(a=s,c=o):i>=1&&i<2?(a=o,c=s):i>=2&&i<3?(c=s,f=o):i>=3&&i<4?(c=o,f=s):i>=4&&i<5?(a=o,f=s):i>=5&&i<6&&(a=s,f=o);var p=t-s/2,g=a+p,v=c+p,b=f+p;return r(g,v,b)}var Fx={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function eY(n){if(typeof n!="string")return n;var e=n.toLowerCase();return Fx[e]?"#"+Fx[e]:n}var tY=/^#[a-fA-F0-9]{6}$/,nY=/^#[a-fA-F0-9]{8}$/,rY=/^#[a-fA-F0-9]{3}$/,iY=/^#[a-fA-F0-9]{4}$/,Ip=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,sY=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,oY=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,aY=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function uu(n){if(typeof n!="string")throw new ps(3);var e=eY(n);if(e.match(tY))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(nY)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(rY))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(iY)){var r=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:r}}var i=Ip.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var s=sY.exec(e.substring(0,50));if(s)return{red:parseInt(""+s[1],10),green:parseInt(""+s[2],10),blue:parseInt(""+s[3],10),alpha:parseFloat(""+s[4])>1?parseFloat(""+s[4])/100:parseFloat(""+s[4])};var o=oY.exec(e);if(o){var a=parseInt(""+o[1],10),c=parseInt(""+o[2],10)/100,f=parseInt(""+o[3],10)/100,p="rgb("+Hh(a,c,f)+")",g=Ip.exec(p);if(!g)throw new ps(4,e,p);return{red:parseInt(""+g[1],10),green:parseInt(""+g[2],10),blue:parseInt(""+g[3],10)}}var v=aY.exec(e.substring(0,50));if(v){var b=parseInt(""+v[1],10),T=parseInt(""+v[2],10)/100,S=parseInt(""+v[3],10)/100,N="rgb("+Hh(b,T,S)+")",C=Ip.exec(N);if(!C)throw new ps(4,e,N);return{red:parseInt(""+C[1],10),green:parseInt(""+C[2],10),blue:parseInt(""+C[3],10),alpha:parseFloat(""+v[4])>1?parseFloat(""+v[4])/100:parseFloat(""+v[4])}}throw new ps(5)}function lY(n){var e=n.red/255,t=n.green/255,r=n.blue/255,i=Math.max(e,t,r),s=Math.min(e,t,r),o=(i+s)/2;if(i===s)return n.alpha!==void 0?{hue:0,saturation:0,lightness:o,alpha:n.alpha}:{hue:0,saturation:0,lightness:o};var a,c=i-s,f=o>.5?c/(2-i-s):c/(i+s);switch(i){case e:a=(t-r)/c+(t<r?6:0);break;case t:a=(r-e)/c+2;break;default:a=(e-t)/c+4;break}return a*=60,n.alpha!==void 0?{hue:a,saturation:f,lightness:o,alpha:n.alpha}:{hue:a,saturation:f,lightness:o}}function ea(n){return lY(uu(n))}var uY=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},Eg=uY;function ya(n){var e=n.toString(16);return e.length===1?"0"+e:e}function kp(n){return ya(Math.round(n*255))}function AY(n,e,t){return Eg("#"+kp(n)+kp(e)+kp(t))}function pS(n,e,t){return Hh(n,e,t,AY)}function cY(n,e,t){if(typeof n=="object"&&e===void 0&&t===void 0)return pS(n.hue,n.saturation,n.lightness);throw new ps(1)}function hY(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?pS(n.hue,n.saturation,n.lightness):"rgba("+Hh(n.hue,n.saturation,n.lightness)+","+n.alpha+")";throw new ps(2)}function mS(n,e,t){if(typeof n=="number"&&typeof e=="number"&&typeof t=="number")return Eg("#"+ya(n)+ya(e)+ya(t));if(typeof n=="object"&&e===void 0&&t===void 0)return Eg("#"+ya(n.red)+ya(n.green)+ya(n.blue));throw new ps(6)}function Qf(n,e,t,r){if(typeof n=="object"&&e===void 0&&t===void 0&&r===void 0)return n.alpha>=1?mS(n.red,n.green,n.blue):"rgba("+n.red+","+n.green+","+n.blue+","+n.alpha+")";throw new ps(7)}var fY=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},dY=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},pY=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},mY=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function ta(n){if(typeof n!="object")throw new ps(8);if(dY(n))return Qf(n);if(fY(n))return mS(n);if(mY(n))return hY(n);if(pY(n))return cY(n);throw new ps(8)}function gS(n,e,t){return function(){var i=t.concat(Array.prototype.slice.call(arguments));return i.length>=e?n.apply(this,i):gS(n,e,i)}}function ai(n){return gS(n,n.length,[])}function gY(n,e){if(e==="transparent")return e;var t=ea(e);return ta($r({},t,{hue:t.hue+parseFloat(n)}))}ai(gY);function mu(n,e,t){return Math.max(n,Math.min(e,t))}function _Y(n,e){if(e==="transparent")return e;var t=ea(e);return ta($r({},t,{lightness:mu(0,1,t.lightness-parseFloat(n))}))}ai(_Y);function yY(n,e){if(e==="transparent")return e;var t=ea(e);return ta($r({},t,{saturation:mu(0,1,t.saturation-parseFloat(n))}))}ai(yY);function vY(n,e){if(e==="transparent")return e;var t=ea(e);return ta($r({},t,{lightness:mu(0,1,t.lightness+parseFloat(n))}))}ai(vY);function xY(n,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(n===0)return t;var r=uu(e),i=$r({},r,{alpha:typeof r.alpha=="number"?r.alpha:1}),s=uu(t),o=$r({},s,{alpha:typeof s.alpha=="number"?s.alpha:1}),a=i.alpha-o.alpha,c=parseFloat(n)*2-1,f=c*a===-1?c:c+a,p=1+c*a,g=(f/p+1)/2,v=1-g,b={red:Math.floor(i.red*g+o.red*v),green:Math.floor(i.green*g+o.green*v),blue:Math.floor(i.blue*g+o.blue*v),alpha:i.alpha*parseFloat(n)+o.alpha*(1-parseFloat(n))};return Qf(b)}var bY=ai(xY),_S=bY;function TY(n,e){if(e==="transparent")return e;var t=uu(e),r=typeof t.alpha=="number"?t.alpha:1,i=$r({},t,{alpha:mu(0,1,(r*100+parseFloat(n)*100)/100)});return Qf(i)}var wY=ai(TY),SY=wY;function EY(n,e){if(e==="transparent")return e;var t=ea(e);return ta($r({},t,{saturation:mu(0,1,t.saturation+parseFloat(n))}))}ai(EY);function NY(n,e){return e==="transparent"?e:ta($r({},ea(e),{hue:parseFloat(n)}))}ai(NY);function RY(n,e){return e==="transparent"?e:ta($r({},ea(e),{lightness:parseFloat(n)}))}ai(RY);function CY(n,e){return e==="transparent"?e:ta($r({},ea(e),{saturation:parseFloat(n)}))}ai(CY);function MY(n,e){return e==="transparent"?e:_S(parseFloat(n),"rgb(0, 0, 0)",e)}ai(MY);function PY(n,e){return e==="transparent"?e:_S(parseFloat(n),"rgb(255, 255, 255)",e)}ai(PY);function BY(n,e){if(e==="transparent")return e;var t=uu(e),r=typeof t.alpha=="number"?t.alpha:1,i=$r({},t,{alpha:mu(0,1,+(r*100-parseFloat(n)*100).toFixed(2)/100)});return Qf(i)}ai(BY);var Ng="http://www.w3.org/1999/xhtml";const Ox={svg:"http://www.w3.org/2000/svg",xhtml:Ng,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function yS(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),Ox.hasOwnProperty(e)?{space:Ox[e],local:n}:n}function DY(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Ng&&e.documentElement.namespaceURI===Ng?e.createElement(n):e.createElementNS(t,n)}}function LY(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function vS(n){var e=yS(n);return(e.local?LY:DY)(e)}function FY(){}function xS(n){return n==null?FY:function(){return this.querySelector(n)}}function OY(n){typeof n!="function"&&(n=xS(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=new Array(o),c,f,p=0;p<o;++p)(c=s[p])&&(f=n.call(c,c.__data__,p,s))&&("__data__"in c&&(f.__data__=c.__data__),a[p]=f);return new Ri(r,this._parents)}function IY(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function kY(){return[]}function UY(n){return n==null?kY:function(){return this.querySelectorAll(n)}}function qY(n){return function(){return IY(n.apply(this,arguments))}}function GY(n){typeof n=="function"?n=qY(n):n=UY(n);for(var e=this._groups,t=e.length,r=[],i=[],s=0;s<t;++s)for(var o=e[s],a=o.length,c,f=0;f<a;++f)(c=o[f])&&(r.push(n.call(c,c.__data__,f,o)),i.push(c));return new Ri(r,i)}function VY(n){return function(){return this.matches(n)}}function bS(n){return function(e){return e.matches(n)}}var zY=Array.prototype.find;function $Y(n){return function(){return zY.call(this.children,n)}}function jY(){return this.firstElementChild}function HY(n){return this.select(n==null?jY:$Y(typeof n=="function"?n:bS(n)))}var WY=Array.prototype.filter;function QY(){return Array.from(this.children)}function YY(n){return function(){return WY.call(this.children,n)}}function XY(n){return this.selectAll(n==null?QY:YY(typeof n=="function"?n:bS(n)))}function KY(n){typeof n!="function"&&(n=VY(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],c,f=0;f<o;++f)(c=s[f])&&n.call(c,c.__data__,f,s)&&a.push(c);return new Ri(r,this._parents)}function TS(n){return new Array(n.length)}function ZY(){return new Ri(this._enter||this._groups.map(TS),this._parents)}function Wh(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}Wh.prototype={constructor:Wh,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function JY(n){return function(){return n}}function eX(n,e,t,r,i,s){for(var o=0,a,c=e.length,f=s.length;o<f;++o)(a=e[o])?(a.__data__=s[o],r[o]=a):t[o]=new Wh(n,s[o]);for(;o<c;++o)(a=e[o])&&(i[o]=a)}function tX(n,e,t,r,i,s,o){var a,c,f=new Map,p=e.length,g=s.length,v=new Array(p),b;for(a=0;a<p;++a)(c=e[a])&&(v[a]=b=o.call(c,c.__data__,a,e)+"",f.has(b)?i[a]=c:f.set(b,c));for(a=0;a<g;++a)b=o.call(n,s[a],a,s)+"",(c=f.get(b))?(r[a]=c,c.__data__=s[a],f.delete(b)):t[a]=new Wh(n,s[a]);for(a=0;a<p;++a)(c=e[a])&&f.get(v[a])===c&&(i[a]=c)}function nX(n){return n.__data__}function rX(n,e){if(!arguments.length)return Array.from(this,nX);var t=e?tX:eX,r=this._parents,i=this._groups;typeof n!="function"&&(n=JY(n));for(var s=i.length,o=new Array(s),a=new Array(s),c=new Array(s),f=0;f<s;++f){var p=r[f],g=i[f],v=g.length,b=iX(n.call(p,p&&p.__data__,f,r)),T=b.length,S=a[f]=new Array(T),N=o[f]=new Array(T),C=c[f]=new Array(v);t(p,g,S,N,C,b,e);for(var P=0,B=0,F,q;P<T;++P)if(F=S[P]){for(P>=B&&(B=P+1);!(q=N[B])&&++B<T;);F._next=q||null}}return o=new Ri(o,r),o._enter=a,o._exit=c,o}function iX(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function sX(){return new Ri(this._exit||this._groups.map(TS),this._parents)}function oX(n,e,t){var r=this.enter(),i=this,s=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?s.remove():t(s),r&&i?r.merge(i).order():i}function aX(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,i=t.length,s=r.length,o=Math.min(i,s),a=new Array(i),c=0;c<o;++c)for(var f=t[c],p=r[c],g=f.length,v=a[c]=new Array(g),b,T=0;T<g;++T)(b=f[T]||p[T])&&(v[T]=b);for(;c<i;++c)a[c]=t[c];return new Ri(a,this._parents)}function lX(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function uX(n){n||(n=AX);function e(g,v){return g&&v?n(g.__data__,v.__data__):!g-!v}for(var t=this._groups,r=t.length,i=new Array(r),s=0;s<r;++s){for(var o=t[s],a=o.length,c=i[s]=new Array(a),f,p=0;p<a;++p)(f=o[p])&&(c[p]=f);c.sort(e)}return new Ri(i,this._parents).order()}function AX(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function cX(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function hX(){return Array.from(this)}function fX(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function dX(){let n=0;for(const e of this)++n;return n}function pX(){return!this.node()}function mX(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],s=0,o=i.length,a;s<o;++s)(a=i[s])&&n.call(a,a.__data__,s,i);return this}function gX(n){return function(){this.removeAttribute(n)}}function _X(n){return function(){this.removeAttributeNS(n.space,n.local)}}function yX(n,e){return function(){this.setAttribute(n,e)}}function vX(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function xX(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function bX(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function TX(n,e){var t=yS(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?_X:gX:typeof e=="function"?t.local?bX:xX:t.local?vX:yX)(t,e))}function wS(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function wX(n){return function(){this.style.removeProperty(n)}}function SX(n,e,t){return function(){this.style.setProperty(n,e,t)}}function EX(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function NX(n,e,t){return arguments.length>1?this.each((e==null?wX:typeof e=="function"?EX:SX)(n,e,t??"")):RX(this.node(),n)}function RX(n,e){return n.style.getPropertyValue(e)||wS(n).getComputedStyle(n,null).getPropertyValue(e)}function CX(n){return function(){delete this[n]}}function MX(n,e){return function(){this[n]=e}}function PX(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function BX(n,e){return arguments.length>1?this.each((e==null?CX:typeof e=="function"?PX:MX)(n,e)):this.node()[n]}function SS(n){return n.trim().split(/^|\s+/)}function i_(n){return n.classList||new ES(n)}function ES(n){this._node=n,this._names=SS(n.getAttribute("class")||"")}ES.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function NS(n,e){for(var t=i_(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function RS(n,e){for(var t=i_(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function DX(n){return function(){NS(this,n)}}function LX(n){return function(){RS(this,n)}}function FX(n,e){return function(){(e.apply(this,arguments)?NS:RS)(this,n)}}function OX(n,e){var t=SS(n+"");if(arguments.length<2){for(var r=i_(this.node()),i=-1,s=t.length;++i<s;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?FX:e?DX:LX)(t,e))}function IX(){this.textContent=""}function kX(n){return function(){this.textContent=n}}function UX(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function qX(n){return arguments.length?this.each(n==null?IX:(typeof n=="function"?UX:kX)(n)):this.node().textContent}function GX(){this.innerHTML=""}function VX(n){return function(){this.innerHTML=n}}function zX(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function $X(n){return arguments.length?this.each(n==null?GX:(typeof n=="function"?zX:VX)(n)):this.node().innerHTML}function jX(){this.nextSibling&&this.parentNode.appendChild(this)}function HX(){return this.each(jX)}function WX(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function QX(){return this.each(WX)}function YX(n){var e=typeof n=="function"?n:vS(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function XX(){return null}function KX(n,e){var t=typeof n=="function"?n:vS(n),r=e==null?XX:typeof e=="function"?e:xS(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function ZX(){var n=this.parentNode;n&&n.removeChild(this)}function JX(){return this.each(ZX)}function eK(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function tK(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function nK(n){return this.select(n?tK:eK)}function rK(n){return arguments.length?this.property("__data__",n):this.node().__data__}function iK(n){return function(e){n.call(this,e,this.__data__)}}function sK(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function oK(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,s;t<i;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function aK(n,e,t){return function(){var r=this.__on,i,s=iK(e);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=t),i.value=e;return}}this.addEventListener(n.type,s,t),i={type:n.type,name:n.name,value:e,listener:s,options:t},r?r.push(i):this.__on=[i]}}function lK(n,e,t){var r=sK(n+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,f=a.length,p;c<f;++c)for(i=0,p=a[c];i<s;++i)if((o=r[i]).type===p.type&&o.name===p.name)return p.value}return}for(a=e?aK:oK,i=0;i<s;++i)this.each(a(r[i],e,t));return this}function CS(n,e,t){var r=wS(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function uK(n,e){return function(){return CS(this,n,e)}}function AK(n,e){return function(){return CS(this,n,e.apply(this,arguments))}}function cK(n,e){return this.each((typeof e=="function"?AK:uK)(n,e))}function*hK(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var fK=[null];function Ri(n,e){this._groups=n,this._parents=e}function dK(){return this}Ri.prototype={constructor:Ri,select:OY,selectAll:GY,selectChild:HY,selectChildren:XY,filter:KY,data:rX,enter:ZY,exit:sX,join:oX,merge:aX,selection:dK,order:lX,sort:uX,call:cX,nodes:hX,node:fX,size:dX,empty:pX,each:mX,attr:TX,style:NX,property:BX,classed:OX,text:qX,html:$X,raise:HX,lower:QX,append:YX,insert:KX,remove:JX,clone:nK,datum:rK,on:lK,dispatch:cK,[Symbol.iterator]:hK};function pK(n){return typeof n=="string"?new Ri([[document.querySelector(n)]],[document.documentElement]):new Ri([[n]],fK)}function mK(n){let e;for(;e=n.sourceEvent;)n=e;return n}function gK(n,e){if(n=mK(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[n.clientX-i.left-e.clientLeft,n.clientY-i.top-e.clientTop]}}return[n.pageX,n.pageY]}var oc,dn,MS,PS,wa,Ix,BS,DS,LS,s_,Rg,Cg,zA={},FS=[],_K=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Yf=Array.isArray;function ms(n,e){for(var t in e)n[t]=e[t];return n}function o_(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function yK(n,e,t){var r,i,s,o={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:o[s]=e[s];if(arguments.length>2&&(o.children=arguments.length>3?oc.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(s in n.defaultProps)o[s]===void 0&&(o[s]=n.defaultProps[s]);return _A(n,o,r,i,null)}function _A(n,e,t,r,i){var s={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++MS,__i:-1,__u:0};return i==null&&dn.vnode!=null&&dn.vnode(s),s}function Xf(n){return n.children}function U0(n,e){this.props=n,this.context=e}function Au(n,e){if(e==null)return n.__?Au(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?Au(n):null}function OS(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return OS(n)}}function kx(n){(!n.__d&&(n.__d=!0)&&wa.push(n)&&!Qh.__r++||Ix!=dn.debounceRendering)&&((Ix=dn.debounceRendering)||BS)(Qh)}function Qh(){for(var n,e,t,r,i,s,o,a=1;wa.length;)wa.length>a&&wa.sort(DS),n=wa.shift(),a=wa.length,n.__d&&(t=void 0,r=void 0,i=(r=(e=n).__v).__e,s=[],o=[],e.__P&&((t=ms({},r)).__v=r.__v+1,dn.vnode&&dn.vnode(t),a_(e.__P,t,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??Au(r),!!(32&r.__u),o),t.__v=r.__v,t.__.__k[t.__i]=t,US(s,t,o),r.__e=r.__=null,t.__e!=i&&OS(t)));Qh.__r=0}function IS(n,e,t,r,i,s,o,a,c,f,p){var g,v,b,T,S,N,C,P=r&&r.__k||FS,B=e.length;for(c=vK(t,e,P,c,B),g=0;g<B;g++)(b=t.__k[g])!=null&&(v=b.__i==-1?zA:P[b.__i]||zA,b.__i=g,N=a_(n,b,v,i,s,o,a,c,f,p),T=b.__e,b.ref&&v.ref!=b.ref&&(v.ref&&l_(v.ref,null,b),p.push(b.ref,b.__c||T,b)),S==null&&T!=null&&(S=T),(C=!!(4&b.__u))||v.__k===b.__k?c=kS(b,c,n,C):typeof b.type=="function"&&N!==void 0?c=N:T&&(c=T.nextSibling),b.__u&=-7);return t.__e=S,c}function vK(n,e,t,r,i){var s,o,a,c,f,p=t.length,g=p,v=0;for(n.__k=new Array(i),s=0;s<i;s++)(o=e[s])!=null&&typeof o!="boolean"&&typeof o!="function"?(typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?o=n.__k[s]=_A(null,o,null,null,null):Yf(o)?o=n.__k[s]=_A(Xf,{children:o},null,null,null):o.constructor==null&&o.__b>0?o=n.__k[s]=_A(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):n.__k[s]=o,c=s+v,o.__=n,o.__b=n.__b+1,(f=o.__i=xK(o,t,c,g))!=-1&&(g--,(a=t[f])&&(a.__u|=2)),a==null||a.__v==null?(f==-1&&(i>p?v--:i<p&&v++),typeof o.type!="function"&&(o.__u|=4)):f!=c&&(f==c-1?v--:f==c+1?v++:(f>c?v--:v++,o.__u|=4))):n.__k[s]=null;if(g)for(s=0;s<p;s++)(a=t[s])!=null&&(2&a.__u)==0&&(a.__e==r&&(r=Au(a)),GS(a,a));return r}function kS(n,e,t,r){var i,s;if(typeof n.type=="function"){for(i=n.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=n,e=kS(i[s],e,t,r));return e}n.__e!=e&&(r&&(e&&n.type&&!e.parentNode&&(e=Au(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function xK(n,e,t,r){var i,s,o,a=n.key,c=n.type,f=e[t],p=f!=null&&(2&f.__u)==0;if(f===null&&a==null||p&&a==f.key&&c==f.type)return t;if(r>(p?1:0)){for(i=t-1,s=t+1;i>=0||s<e.length;)if((f=e[o=i>=0?i--:s++])!=null&&(2&f.__u)==0&&a==f.key&&c==f.type)return o}return-1}function Ux(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||_K.test(e)?t:t+"px"}function p0(n,e,t,r,i){var s,o;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||Ux(n.style,e,"");if(t)for(e in t)r&&t[e]==r[e]||Ux(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(LS,"$1")),o=e.toLowerCase(),e=o in n||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+s]=t,t?r?t.u=r.u:(t.u=s_,n.addEventListener(e,s?Cg:Rg,s)):n.removeEventListener(e,s?Cg:Rg,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function qx(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=s_++;else if(e.t<t.u)return;return t(dn.event?dn.event(e):e)}}}function a_(n,e,t,r,i,s,o,a,c,f){var p,g,v,b,T,S,N,C,P,B,F,q,I,U,G,H,te,W=e.type;if(e.constructor!=null)return null;128&t.__u&&(c=!!(32&t.__u),s=[a=e.__e=t.__e]),(p=dn.__b)&&p(e);e:if(typeof W=="function")try{if(C=e.props,P="prototype"in W&&W.prototype.render,B=(p=W.contextType)&&r[p.__c],F=p?B?B.props.value:p.__:r,t.__c?N=(g=e.__c=t.__c).__=g.__E:(P?e.__c=g=new W(C,F):(e.__c=g=new U0(C,F),g.constructor=W,g.render=TK),B&&B.sub(g),g.state||(g.state={}),g.__n=r,v=g.__d=!0,g.__h=[],g._sb=[]),P&&g.__s==null&&(g.__s=g.state),P&&W.getDerivedStateFromProps!=null&&(g.__s==g.state&&(g.__s=ms({},g.__s)),ms(g.__s,W.getDerivedStateFromProps(C,g.__s))),b=g.props,T=g.state,g.__v=e,v)P&&W.getDerivedStateFromProps==null&&g.componentWillMount!=null&&g.componentWillMount(),P&&g.componentDidMount!=null&&g.__h.push(g.componentDidMount);else{if(P&&W.getDerivedStateFromProps==null&&C!==b&&g.componentWillReceiveProps!=null&&g.componentWillReceiveProps(C,F),e.__v==t.__v||!g.__e&&g.shouldComponentUpdate!=null&&g.shouldComponentUpdate(C,g.__s,F)===!1){for(e.__v!=t.__v&&(g.props=C,g.state=g.__s,g.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(Z){Z&&(Z.__=e)}),q=0;q<g._sb.length;q++)g.__h.push(g._sb[q]);g._sb=[],g.__h.length&&o.push(g);break e}g.componentWillUpdate!=null&&g.componentWillUpdate(C,g.__s,F),P&&g.componentDidUpdate!=null&&g.__h.push(function(){g.componentDidUpdate(b,T,S)})}if(g.context=F,g.props=C,g.__P=n,g.__e=!1,I=dn.__r,U=0,P){for(g.state=g.__s,g.__d=!1,I&&I(e),p=g.render(g.props,g.state,g.context),G=0;G<g._sb.length;G++)g.__h.push(g._sb[G]);g._sb=[]}else do g.__d=!1,I&&I(e),p=g.render(g.props,g.state,g.context),g.state=g.__s;while(g.__d&&++U<25);g.state=g.__s,g.getChildContext!=null&&(r=ms(ms({},r),g.getChildContext())),P&&!v&&g.getSnapshotBeforeUpdate!=null&&(S=g.getSnapshotBeforeUpdate(b,T)),H=p,p!=null&&p.type===Xf&&p.key==null&&(H=qS(p.props.children)),a=IS(n,Yf(H)?H:[H],e,t,r,i,s,o,a,c,f),g.base=e.__e,e.__u&=-161,g.__h.length&&o.push(g),N&&(g.__E=g.__=null)}catch(Z){if(e.__v=null,c||s!=null)if(Z.then){for(e.__u|=c?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;s[s.indexOf(a)]=null,e.__e=a}else{for(te=s.length;te--;)o_(s[te]);Mg(e)}else e.__e=t.__e,e.__k=t.__k,Z.then||Mg(e);dn.__e(Z,e,t)}else s==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=bK(t.__e,e,t,r,i,s,o,c,f);return(p=dn.diffed)&&p(e),128&e.__u?void 0:a}function Mg(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Mg)}function US(n,e,t){for(var r=0;r<t.length;r++)l_(t[r],t[++r],t[++r]);dn.__c&&dn.__c(e,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(s){s.call(i)})}catch(s){dn.__e(s,i.__v)}})}function qS(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:Yf(n)?n.map(qS):ms({},n)}function bK(n,e,t,r,i,s,o,a,c){var f,p,g,v,b,T,S,N=t.props||zA,C=e.props,P=e.type;if(P=="svg"?i="http://www.w3.org/2000/svg":P=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(f=0;f<s.length;f++)if((b=s[f])&&"setAttribute"in b==!!P&&(P?b.localName==P:b.nodeType==3)){n=b,s[f]=null;break}}if(n==null){if(P==null)return document.createTextNode(C);n=document.createElementNS(i,P,C.is&&C),a&&(dn.__m&&dn.__m(e,s),a=!1),s=null}if(P==null)N===C||a&&n.data==C||(n.data=C);else{if(s=s&&oc.call(n.childNodes),!a&&s!=null)for(N={},f=0;f<n.attributes.length;f++)N[(b=n.attributes[f]).name]=b.value;for(f in N)if(b=N[f],f!="children"){if(f=="dangerouslySetInnerHTML")g=b;else if(!(f in C)){if(f=="value"&&"defaultValue"in C||f=="checked"&&"defaultChecked"in C)continue;p0(n,f,null,b,i)}}for(f in C)b=C[f],f=="children"?v=b:f=="dangerouslySetInnerHTML"?p=b:f=="value"?T=b:f=="checked"?S=b:a&&typeof b!="function"||N[f]===b||p0(n,f,b,N[f],i);if(p)a||g&&(p.__html==g.__html||p.__html==n.innerHTML)||(n.innerHTML=p.__html),e.__k=[];else if(g&&(n.innerHTML=""),IS(e.type=="template"?n.content:n,Yf(v)?v:[v],e,t,r,P=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,o,s?s[0]:t.__k&&Au(t,0),a,c),s!=null)for(f=s.length;f--;)o_(s[f]);a||(f="value",P=="progress"&&T==null?n.removeAttribute("value"):T!=null&&(T!==n[f]||P=="progress"&&!T||P=="option"&&T!=N[f])&&p0(n,f,T,N[f],i),f="checked",S!=null&&S!=n[f]&&p0(n,f,S,N[f],i))}return n}function l_(n,e,t){try{if(typeof n=="function"){var r=typeof n.__u=="function";r&&n.__u(),r&&e==null||(n.__u=n(e))}else n.current=e}catch(i){dn.__e(i,t)}}function GS(n,e,t){var r,i;if(dn.unmount&&dn.unmount(n),(r=n.ref)&&(r.current&&r.current!=n.__e||l_(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){dn.__e(s,e)}r.base=r.__P=null}if(r=n.__k)for(i=0;i<r.length;i++)r[i]&&GS(r[i],e,t||typeof n.type!="function");t||o_(n.__e),n.__c=n.__=n.__e=void 0}function TK(n,e,t){return this.constructor(n,t)}function wK(n,e,t){var r,i,s,o;e==document&&(e=document.documentElement),dn.__&&dn.__(n,e),i=(r=!1)?null:e.__k,s=[],o=[],a_(e,n=e.__k=yK(Xf,null,[n]),i||zA,zA,e.namespaceURI,i?null:e.firstChild?oc.call(e.childNodes):null,s,i?i.__e:e.firstChild,r,o),US(s,n,o)}function VS(n,e,t){var r,i,s,o,a=ms({},n.props);for(s in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)s=="key"?r=e[s]:s=="ref"?i=e[s]:a[s]=e[s]===void 0&&o!=null?o[s]:e[s];return arguments.length>2&&(a.children=arguments.length>3?oc.call(arguments,2):t),_A(n.type,a,r||n.key,i||n.ref,null)}oc=FS.slice,dn={__e:function(n,e,t,r){for(var i,s,o;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(n)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,r||{}),o=i.__d),o)return i.__E=i}catch(a){n=a}throw n}},MS=0,PS=function(n){return n!=null&&n.constructor==null},U0.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ms({},this.state),typeof n=="function"&&(n=n(ms({},t),this.props)),n&&ms(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),kx(this))},U0.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),kx(this))},U0.prototype.render=Xf,wa=[],BS=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,DS=function(n,e){return n.__v.__b-e.__v.__b},Qh.__r=0,LS=/(PointerCapture)$|Capture$/i,s_=0,Rg=qx(!1),Cg=qx(!0);function Gx(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function SK(n){if(Array.isArray(n))return n}function EK(n,e,t){return(e=BK(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function NK(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function RK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vx(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function CK(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vx(Object(t),!0).forEach(function(r){EK(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Vx(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function MK(n,e){return SK(n)||NK(n,e)||DK(n,e)||RK()}function PK(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function BK(n){var e=PK(n,"string");return typeof e=="symbol"?e:e+""}function Yh(n){"@babel/helpers - typeof";return Yh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yh(n)}function DK(n,e){if(n){if(typeof n=="string")return Gx(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Gx(n,e):void 0}}var Pg=function(e){if(Yh(e)!=="object")return e;var t=VS(e);if(t.props){var r;t.props=CK({},t.props),t!=null&&(r=t.props)!==null&&r!==void 0&&r.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(Pg):Pg(t.props.children))}return t},LK=function(e){return PS(VS(e))},FK=function(e,t){delete t.__k,wK(Pg(e),t)};function OK(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var IK=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;OK(IK);var kK=Vn({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.style,s=i===void 0?{}:i,o=!!e&&Yh(e)==="object"&&!!e.node&&typeof e.node=="function",a=pK(o?e.node():e);a.style("position")==="static"&&a.style("position","relative"),t.tooltipEl=a.append("div").attr("class","float-tooltip-kap"),Object.entries(s).forEach(function(f){var p=MK(f,2),g=p[0],v=p[1];return t.tooltipEl.style(g,v)}),t.tooltipEl.style("left","-10000px").style("display","none");var c="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,a.on("mousemove.".concat(c),function(f){t.mouseInside=!0;var p=gK(f),g=a.node(),v=g.offsetWidth,b=g.offsetHeight,T=[t.offsetX===null||t.offsetX===void 0?"-".concat(p[0]/v*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?b>130&&b-p[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",p[0]+"px").style("top",p[1]+"px").style("transform","translate(".concat(T.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseover.".concat(c),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),a.on("mouseout.".concat(c),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):LK(e.content)?(e.tooltipEl.text(""),FK(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function UK(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var qK=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;UK(qK);function Bg(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function GK(n){if(Array.isArray(n))return n}function VK(n){if(Array.isArray(n))return Bg(n)}function zK(n,e,t){return(e=XK(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function $K(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function jK(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,f=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(p){f=!0,i=p}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(f)throw i}}return a}}function HK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QK(n,e){return GK(n)||jK(n,e)||zS(n,e)||HK()}function ga(n){return VK(n)||$K(n)||zS(n)||WK()}function YK(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function XK(n){var e=YK(n,"string");return typeof e=="symbol"?e:e+""}function zS(n,e){if(n){if(typeof n=="string")return Bg(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Bg(n,e):void 0}}var un=window.THREE?window.THREE:{WebGLRenderer:MR,Scene:Kh,PerspectiveCamera:yA,Raycaster:PR,SRGBColorSpace:$A,TextureLoader:Fg,Vector2:gt,Vector3:we,Box3:sf,Color:Gn,Mesh:pn,SphereGeometry:Wo,MeshBasicMaterial:cs,BackSide:mr,Clock:Db},$S=Vn({props:{width:{default:window.innerWidth,onChange:function(e,t,r){isNaN(e)&&(t.width=r)}},height:{default:window.innerHeight,onChange:function(e,t,r){isNaN(e)&&(t.height=r)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(o){return o.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var r=null;if(e.hoverDuringDrag||!e.isPointerDragging){var i=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&i.sort(function(o,a){return e.hoverOrderComparator(o.object,a.object)});var s=i.find(function(o){return e.hoverFilter(o.object)})||null;r=s?s.object:null,e.intersection=s||null}r!==e.hoverObj&&(e.onHover(r,e.hoverObj,e.intersection),e.tooltip.content(r&&ye(e.tooltipContent)(r,e.intersection)||null),e.hoverObj=r)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,r=t.x,i=t.y;return{x:r,y:i}},cameraPosition:function(e,t,r,i){var s=e.camera;if(t&&e.initialised){var o=t,a=r||{x:0,y:0,z:0};if(!i)p(o),g(a);else{var c=Object.assign({},s.position),f=v();e.tweenGroup.add(new _r(c).to(o,i).easing(On.Quadratic.Out).onUpdate(p).start()),e.tweenGroup.add(new _r(f).to(a,i/3).easing(On.Quadratic.Out).onUpdate(g).start())}return this}return Object.assign({},s.position,{lookAt:v()});function p(b){var T=b.x,S=b.y,N=b.z;T!==void 0&&(s.position.x=T),S!==void 0&&(s.position.y=S),N!==void 0&&(s.position.z=N)}function g(b){var T=new un.Vector3(b.x,b.y,b.z);e.controls.enabled&&e.controls.target?e.controls.target=T:s.lookAt(T)}function v(){return Object.assign(new un.Vector3(0,0,-1e3).applyQuaternion(s.quaternion).add(s.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,i=arguments.length,s=new Array(i>3?i-3:0),o=3;o<i;o++)s[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,s),t,r)},fitToBbox:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,s=e.camera;if(t){var o=new un.Vector3(0,0,0),a=Math.max.apply(Math,ga(Object.entries(t).map(function(b){var T=QK(b,2),S=T[0],N=T[1];return Math.max.apply(Math,ga(N.map(function(C){return Math.abs(o[S]-C)})))})))*2,c=(1-i*2/e.height)*s.fov,f=a/Math.atan(c*Math.PI/180),p=f/s.aspect,g=Math.max(f,p);if(g>0){var v=o.clone().sub(s.position).normalize().multiplyScalar(-g);this.cameraPosition(v,o,r)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},r=new un.Box3(new un.Vector3(0,0,0),new un.Vector3(0,0,0)),i=e.objects.filter(t);return i.length?(i.forEach(function(s){return r.expandByObject(s)}),Object.assign.apply(Object,ga(["x","y","z"].map(function(s){return zK({},s,[r.min[s],r.max[s]])})))):null},getScreenCoords:function(e,t,r,i){var s=new un.Vector3(t,r,i);return s.project(this.camera()),{x:(s.x+1)*e.width/2,y:-(s.y-1)*e.height/2}},getSceneCoords:function(e,t,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=new un.Vector2(t/e.width*2-1,-(r/e.height)*2+1),o=new un.Raycaster;return o.setFromCamera(s,e.camera),Object.assign({},o.ray.at(i,new un.Vector3))},intersectingObjects:function(e,t,r){var i=new un.Vector2(t/e.width*2-1,-(r/e.height)*2+1),s=new un.Raycaster;return s.params.Line.threshold=e.lineHoverPrecision,s.params.Points.threshold=e.pointsHoverPrecision,s.setFromCamera(i,e.camera),s.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new un.Scene,camera:new un.PerspectiveCamera,clock:new un.Clock,tweenGroup:new of,lastRaycasterCheck:0}},init:function(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=r.controlType,s=i===void 0?"trackball":i,o=r.useWebGPU,a=o===void 0?!1:o,c=r.rendererConfig,f=c===void 0?{}:c,p=r.extraRenderers,g=p===void 0?[]:p,v=r.waitForLoadComplete,b=v===void 0?!0:v;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[s]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new kK(t.container),t.pointerPos=new un.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(T){return t.container.addEventListener(T,function(S){if(T==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&S.type==="pointermove"&&(S.pressure>0||t.isPointerPressed)&&(S.pointerType==="mouse"||S.movementX===void 0||[S.movementX,S.movementY].some(function(P){return Math.abs(P)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var N=C(t.container);t.pointerPos.x=S.pageX-N.left,t.pointerPos.y=S.pageY-N.top}function C(P){var B=P.getBoundingClientRect(),F=window.pageXOffset||document.documentElement.scrollLeft,q=window.pageYOffset||document.documentElement.scrollTop;return{top:B.top+q,left:B.left+F}}},{passive:!0})}),t.container.addEventListener("pointerup",function(T){t.isPointerPressed&&(t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){T.button===0&&t.onClick(t.hoverObj||null,T,t.intersection),T.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,T,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(T){t.onRightClick&&T.preventDefault()}),t.renderer=new(a?qw:un.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},f)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=g,t.extraRenderers.forEach(function(T){T.domElement.style.position="absolute",T.domElement.style.top="0px",T.domElement.style.pointerEvents="none",t.container.appendChild(T.domElement)}),t.postProcessingComposer=new WQ(t.renderer),t.postProcessingComposer.addPass(new QQ(t.scene,t.camera)),t.controls=new{trackball:nQ,orbit:_Q,fly:BQ}[s](t.camera,t.renderer.domElement),s==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(s==="trackball"||s==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(ga(t.extraRenderers)).forEach(function(T){return T.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new un.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!b,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var r,i=e.width,s=e.height;e.container.style.width="".concat(i,"px"),e.container.style.height="".concat(s,"px"),[e.renderer,e.postProcessingComposer].concat(ga(e.extraRenderers)).forEach(function(b){return b.setSize(i,s)}),e.camera.aspect=i/s;var o=e.viewOffset.slice(0,2);o.some(function(b){return b})&&(r=e.camera).setViewOffset.apply(r,[i,s].concat(ga(o),[i,s])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var a,c=e.width,f=e.height,p=e.viewOffset.slice(0,2);p.some(function(b){return b})?(a=e.camera).setViewOffset.apply(a,[c,f].concat(ga(p),[c,f])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new un.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var g=uu(e.backgroundColor).alpha;g===void 0&&(g=1),e.renderer.setClearColor(new un.Color(SY(1,e.backgroundColor)),g)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new un.TextureLoader().load(e.backgroundImageUrl,function(b){b.colorSpace=un.SRGBColorSpace,e.skysphere.material=new un.MeshBasicMaterial({map:b,side:un.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&v()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&v())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(b){return e.scene.remove(b)}),e.lights.forEach(function(b){return e.scene.add(b)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(b){return e.scene.remove(b)}),e.objects.forEach(function(b){return e.scene.add(b)}));function v(){e.loadComplete=e.scene.visible=!0}}});function KK(n,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var ZK=`.scene-container .clickable {
  cursor: pointer;
}`;KK(ZK);function Dg(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function JK(n){if(Array.isArray(n))return Dg(n)}function ac(n,e,t){return(e=sZ(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function eZ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function tZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zx(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Sa(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zx(Object(t),!0).forEach(function(r){ac(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):zx(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function nZ(n,e){if(n==null)return{};var t,r,i=rZ(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function rZ(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)!==-1)continue;t[r]=n[r]}return t}function Kf(n){return JK(n)||eZ(n)||oZ(n)||tZ()}function iZ(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function sZ(n){var e=iZ(n,"string");return typeof e=="symbol"?e:e+""}function oZ(n,e){if(n){if(typeof n=="string")return Dg(n,e);var t={}.toString.call(n).slice(8,-1);return t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Dg(n,e):void 0}}function jS(n,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(i){return{default:t[i](),onChange:function(o,a){a[n][i](o)},triggerUpdate:!1}},linkMethod:function(i){return function(s){for(var o=s[n],a=arguments.length,c=new Array(a>1?a-1:0),f=1;f<a;f++)c[f-1]=arguments[f];var p=o[i].apply(o,c);return p===o?this:p}}}}var aZ=["rendererConfig","waitForGlobeReady"],Qu=Sa(Sa({},window.THREE?window.THREE:{AmbientLight:Hx,DirectionalLight:jx,Vector2:gt,REVISION:Jh}),{},{CSS2DRenderer:LR}),HS=jS("globe",hS),lZ=Object.assign.apply(Object,Kf(["globeImageUrl","bumpImageUrl","globeTileEngineUrl","globeTileEngineMaxLevel","globeCurvatureResolution","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude","onGlobeReady","pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration","arcsData","arcStartLat","arcStartLng","arcStartAltitude","arcEndLat","arcEndLng","arcEndAltitude","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration","polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration","pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration","heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration","hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration","hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration","tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration","particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture","ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod","labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration","htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration","objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject","customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(n){return ac({},n,HS.linkProp(n))}))),uZ=Object.assign.apply(Object,Kf(["globeMaterial","globeTileEngineClearCache","getGlobeRadius","getCoords","toGeoCoords"].map(function(n){return ac({},n,HS.linkMethod(n))}))),WS=jS("renderObjs",$S),AZ=Object.assign.apply(Object,Kf(["width","height","backgroundColor","backgroundImageUrl","enablePointerInteraction"].map(function(n){return ac({},n,WS.linkProp(n))}))),cZ=Object.assign.apply(Object,Kf(["lights","postProcessingComposer"].map(function(n){return ac({},n,WS.linkMethod(n))}))),pZ=Vn({props:Sa(Sa({onZoom:{triggerUpdate:!1},onGlobeClick:{triggerUpdate:!1},onGlobeRightClick:{triggerUpdate:!1},pointLabel:{default:"name",triggerUpdate:!1},onPointClick:{triggerUpdate:!1},onPointRightClick:{triggerUpdate:!1},onPointHover:{triggerUpdate:!1},arcLabel:{default:"name",triggerUpdate:!1},onArcClick:{triggerUpdate:!1},onArcRightClick:{triggerUpdate:!1},onArcHover:{triggerUpdate:!1},polygonLabel:{default:"name",triggerUpdate:!1},onPolygonClick:{triggerUpdate:!1},onPolygonRightClick:{triggerUpdate:!1},onPolygonHover:{triggerUpdate:!1},pathLabel:{default:"name",triggerUpdate:!1},onPathClick:{triggerUpdate:!1},onPathRightClick:{triggerUpdate:!1},onPathHover:{triggerUpdate:!1},onHeatmapClick:{triggerUpdate:!1},onHeatmapRightClick:{triggerUpdate:!1},onHeatmapHover:{triggerUpdate:!1},hexLabel:{triggerUpdate:!1},onHexClick:{triggerUpdate:!1},onHexRightClick:{triggerUpdate:!1},onHexHover:{triggerUpdate:!1},hexPolygonLabel:{triggerUpdate:!1},onHexPolygonClick:{triggerUpdate:!1},onHexPolygonRightClick:{triggerUpdate:!1},onHexPolygonHover:{triggerUpdate:!1},tileLabel:{default:"name",triggerUpdate:!1},onTileClick:{triggerUpdate:!1},onTileRightClick:{triggerUpdate:!1},onTileHover:{triggerUpdate:!1},particleLabel:{default:"name",triggerUpdate:!1},onParticleClick:{triggerUpdate:!1},onParticleRightClick:{triggerUpdate:!1},onParticleHover:{triggerUpdate:!1},labelLabel:{triggerUpdate:!1},onLabelClick:{triggerUpdate:!1},onLabelRightClick:{triggerUpdate:!1},onLabelHover:{triggerUpdate:!1},objectLabel:{default:"name",triggerUpdate:!1},onObjectClick:{triggerUpdate:!1},onObjectRightClick:{triggerUpdate:!1},onObjectHover:{triggerUpdate:!1},customLayerLabel:{default:"name",triggerUpdate:!1},onCustomLayerClick:{triggerUpdate:!1},onCustomLayerRightClick:{triggerUpdate:!1},onCustomLayerHover:{triggerUpdate:!1},pointerEventsFilter:{default:function(){return!0},triggerUpdate:!1},lineHoverPrecision:{default:.2,triggerUpdate:!1,onChange:function(e,t){t.renderObjs.lineHoverPrecision(e),t.renderObjs.pointsHoverPrecision(e)}},showPointerCursor:{default:!0,triggerUpdate:!1},globeOffset:{default:[0,0],triggerUpdate:!1,onChange:function(e,t){return Array.isArray(e)&&e.length===2&&t.renderObjs.viewOffset(e.map(function(r){return-r}))}}},lZ),AZ),methods:Sa(Sa({pauseAnimation:function(e){var t;return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),(t=e.globe)===null||t===void 0||t.pauseAnimation(),this},resumeAnimation:function(e){var t;return e.animationFrameRequestId===null&&this._animationCycle(),(t=e.globe)===null||t===void 0||t.resumeAnimation(),this},_animationCycle:function(e){e.renderObjs.tick(),e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},pointOfView:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=o();if(t.lat===void 0&&t.lng===void 0&&t.altitude===void 0)return i;var s=Object.assign({},i,t);if(["lat","lng","altitude"].forEach(function(c){return s[c]=+s[c]}),!r)a(s);else{for(;i.lng-s.lng>180;)i.lng-=360;for(;i.lng-s.lng<-180;)i.lng+=360;e.tweenGroup.add(new _r(i).to(s,r).easing(On.Cubic.InOut).onUpdate(a).start())}return this;function o(){return e.globe.toGeoCoords(e.renderObjs.cameraPosition())}function a(c){var f=c.lat,p=c.lng,g=c.altitude;e.renderObjs.cameraPosition(e.globe.getCoords(f,p,g)),e.globe.setPointOfView(e.renderObjs.camera())}},getScreenCoords:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];var o=(t=e.globe).getCoords.apply(t,i);return e.renderObjs.getScreenCoords(o.x,o.y,o.z)},toGlobeCoords:function(e,t,r){var i=e.renderObjs.intersectingObjects(t,r).find(function(c){return(c.object.__globeObjType||c.object.parent.__globeObjType)==="globe"});if(!i)return null;var s=e.globe.toGeoCoords(i.point),o=s.lat,a=s.lng;return{lat:o,lng:a}},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},_destructor:function(e){e.globe._destructor(),this.pauseAnimation(),this.pointsData([]),this.arcsData([]),this.polygonsData([]),this.pathsData([]),this.heatmapsData([]),this.hexBinPointsData([]),this.hexPolygonsData([]),this.tilesData([]),this.particlesData([]),this.labelsData([]),this.htmlElementsData([]),this.objectsData([]),this.customLayerData([])}},uZ),cZ),stateInit:function(e){var t=e.rendererConfig,r=e.waitForGlobeReady,i=r===void 0?!0:r,s=nZ(e,aZ),o=new hS(Sa({waitForGlobeReady:i},s));return{globe:o,renderObjs:$S({controlType:"orbit",rendererConfig:t,waitForLoadComplete:i,extraRenderers:[new Qu.CSS2DRenderer]}).skyRadius(o.getGlobeRadius()*500).showNavInfo(!1).objects([o]).lights([new Qu.AmbientLight(13421772,Math.PI),new Qu.DirectionalLight(16777215,.6*Math.PI)]),tweenGroup:new of}},init:function(e,t){var r=this;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var i=document.createElement("div");t.container.appendChild(i),t.renderObjs(i),t.globe.rendererSize(t.renderObjs.renderer().getSize(new Qu.Vector2)),this.pointOfView({altitude:2.5});var s=t.globe.getGlobeRadius(),o=t.renderObjs.controls();t.renderObjs.camera().near=.05,o.minDistance=s+Math.max(.001,t.renderObjs.camera().near*1.1),o.maxDistance=s*100,o.enablePan=!1,o.enableDamping=!0,o.dampingFactor=.1,o.rotateSpeed=.3,o.zoomSpeed=.3,o.zoomToCursor=!0,o.addEventListener("change",function(){o.target.setScalar(0);var f=r.pointOfView();o.rotateSpeed=f.altitude*.3,o.zoomSpeed=Math.sqrt(f.altitude)*.5,t.globe.setPointOfView(t.renderObjs.camera()),t.onZoom&&t.onZoom(f)});var a=function(p){for(var g=p;g&&!g.hasOwnProperty("__globeObjType");)g=g.parent;return g},c={point:function(p){return p},arc:function(p){return p},polygon:function(p){return p.data},path:function(p){return p},heatmap:function(p){return p},hexbin:function(p){return p},hexPolygon:function(p){return p},tile:function(p){return p},particles:function(p,g){return!g||!g.hasOwnProperty("index")||p.length<=g.index?p:p[g.index]},label:function(p){return p},object:function(p){return p},custom:function(p){return p}};Qu.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverFilter(function(f){var p=a(f);if(!p)return!1;var g=p.__globeObjType;if(g!=="globe"&&!c.hasOwnProperty(g))return!1;var v=c.hasOwnProperty(g)&&p.__data?c[g](p.__data):null;return["points","hexBinPoints"].some(function(b){return b===g})&&Array.isArray(v)?!1:t.pointerEventsFilter(p,v)}).tooltipContent(function(f,p){var g={point:t.pointLabel,arc:t.arcLabel,polygon:t.polygonLabel,path:t.pathLabel,hexbin:t.hexLabel,hexPolygon:t.hexPolygonLabel,tile:t.tileLabel,particles:t.particleLabel,label:t.labelLabel,object:t.objectLabel,custom:t.customLayerLabel},v=a(f),b=v&&v.__globeObjType;return v&&b&&g.hasOwnProperty(b)&&c.hasOwnProperty(b)&&ye(g[b])(c[b](v.__data,p))||""}).onHover(function(f,p,g){var v={point:t.onPointHover,arc:t.onArcHover,polygon:t.onPolygonHover,path:t.onPathHover,heatmap:t.onHeatmapHover,hexbin:t.onHexHover,hexPolygon:t.onHexPolygonHover,tile:t.onTileHover,particles:t.onParticleHover,label:t.onLabelHover,object:t.onObjectHover,custom:t.onCustomLayerHover},b={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},T=a(f);if(T&&!v.hasOwnProperty(T.__globeObjType)&&(T=null),T!==t.hoverObj){var S,N=t.hoverObj?t.hoverObj.__globeObjType:null,C=t.hoverData,P=T?T.__globeObjType:null,B=(S=T)!==null&&S!==void 0&&S.__data?c[P](T.__data,g):null;N&&N!==P&&v[N]&&v[N](null,C||null),P&&v[P]&&v[P](B,N===P?C:null),t.renderObjs.renderer().domElement.classList[P&&b[P]&&ye(t.showPointerCursor)(P,B)?"add":"remove"]("clickable"),t.hoverObj=T,t.hoverData=B}}).onClick(function(f,p,g){if(f){var v={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},b=a(f),T=b.__globeObjType;if(b&&v.hasOwnProperty(T)&&v[T]){var S=[p],N=g!=null&&g.isVector3?g:g==null?void 0:g.point;if(T==="globe"){var C=r.toGeoCoords(N),P=C.lat,B=C.lng;S.unshift({lat:P,lng:B})}else S.push(r.toGeoCoords(N));c.hasOwnProperty(T)&&S.unshift(c[T](b.__data,g)),v[T].apply(v,S)}}}).onRightClick(function(f,p,g){if(f){var v={globe:t.onGlobeRightClick,point:t.onPointRightClick,arc:t.onArcRightClick,polygon:t.onPolygonRightClick,path:t.onPathRightClick,heatmap:t.onHeatmapRightClick,hexbin:t.onHexRightClick,hexPolygon:t.onHexPolygonRightClick,tile:t.onTileRightClick,particles:t.onParticleRightClick,label:t.onLabelRightClick,object:t.onObjectRightClick,custom:t.onCustomLayerRightClick},b=a(f),T=b.__globeObjType;if(b&&v.hasOwnProperty(T)&&v[T]){var S=[p],N=g!=null&&g.isVector3?g:g==null?void 0:g.point;if(T==="globe"){var C=r.toGeoCoords(N),P=C.lat,B=C.lng;S.unshift({lat:P,lng:B})}else S.push(r.toGeoCoords(N));c.hasOwnProperty(T)&&S.unshift(c[T](b.__data,g)),v[T].apply(v,S)}}}),this._animationCycle()}});export{pZ as default};
