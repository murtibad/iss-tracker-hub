var KE=Object.defineProperty;var XE=(a,n,o)=>n in a?KE(a,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[n]=o;var hn=(a,n,o)=>XE(a,typeof n!="symbol"?n+"":n,o);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))h(g);new MutationObserver(g=>{for(const w of g)if(w.type==="childList")for(const x of w.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&h(x)}).observe(document,{childList:!0,subtree:!0});function o(g){const w={};return g.integrity&&(w.integrity=g.integrity),g.referrerPolicy&&(w.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?w.credentials="include":g.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function h(g){if(g.ep)return;g.ep=!0;const w=o(g);fetch(g.href,w)}})();const dn={VERSION:"v1.0.0",VERSION_DATE:"2025-01",VERSION_CODENAME:"Orbital",MIN_ELEVATION:20,PASS_LOOKAHEAD_HOURS:36,PASS_STEP_SECONDS:10,INTERVAL_TELEMETRY_FETCH:3e3,INTERVAL_PREDICTION_REFRESH:6e4,INTERVAL_WEATHER_REFRESH_MS:45e3,INTERVAL_TRAJECTORY_REFRESH:6e4,INTERVAL_UI_TICK:1e3,TERMINAL_TELEMETRY_LOG_INTERVAL_MS:1e4,FOLLOW_PAN_INTERVAL_MS:4e3,FOLLOW_PAN_MIN_DISTANCE_M:3e4,MOTION:{SMOOTH_FACTOR:.06,DATA_INTERVAL:3e3,POSITION_THRESHOLD:.001},STORAGE_KEYS:{THEME:"isshub:theme",SKIN:"isshub:skin",LANGUAGE:"isshub:language",PLACE:"isshub:place_v2",VIEW_MODE:"isshub:viewMode",FOCUS_MODE:"isshub:focusMode"},THEME_STORAGE_KEY:"isshub:theme",API:{ISS_PRIMARY:"https://api.wheretheiss.at/v1/satellites/25544",ISS_SECONDARY:"https://api.open-notify.org/iss-now.json",CREW:"https://api.open-notify.org/astros.json",WEATHER:"https://api.open-meteo.com/v1/forecast",TLE_CELESTRAK:"https://celestrak.org/NORAD/elements/gp.php",TLE_N2YO:"https://tle.ivanstanojevic.me/api/tle/25544",NOMINATIM:"https://nominatim.openstreetmap.org"},ISS:{NORAD_ID:25544,NAME:"ZARYA (ISS)",DEFAULT_ALTITUDE_KM:408,DEFAULT_VELOCITY_KMH:27580,ORBITAL_PERIOD_MINUTES:93,INCLINATION_DEGREES:51.6},GLOBE:{ORBIT_ALTITUDE:.15,EARTH_RADIUS_KM:6371,ATMOSPHERE_ALTITUDE:.2,DEFAULT_POV:{lat:20,lng:0,altitude:2.5},ISS_FOCUS_POV:{altitude:.25}},MAP:{DEFAULT_CENTER:[35,39],DEFAULT_ZOOM:4,MIN_ZOOM:2,MAX_ZOOM:18,TRAJECTORY_PAST_MINUTES:45,TRAJECTORY_FUTURE_MINUTES:90,TRAJECTORY_STEP_SECONDS:30},UI:{TOAST_DURATION_MS:3e3,MODAL_ANIMATION_MS:300,LOADING_TIMEOUT_MS:1e4,DEBOUNCE_SEARCH_MS:250},COLORS:{ACCENT_DEFAULT:"#00d4ff",ACCENT_REALISTIC:"#0099cc",ACCENT_CYBERPUNK:"#ff00ff",TRAJECTORY_PAST:"#00d4ff",TRAJECTORY_FUTURE:"#ffa500"}};Object.freeze(dn);Object.freeze(dn.MOTION);Object.freeze(dn.STORAGE_KEYS);Object.freeze(dn.API);Object.freeze(dn.ISS);Object.freeze(dn.GLOBE);Object.freeze(dn.MAP);Object.freeze(dn.UI);Object.freeze(dn.COLORS);function YE(){const a={app:{version:dn.VERSION,errors:[]},location:{status:"idle",permission:"unknown",mode:null,coords:null,accuracy:null,cityName:null,districtName:null,neighborhoodName:null},iss:{status:"loading",lastUpdatedAt:null,telemetry:null,lightText:null},pass:{next:null},ui:{follow:!0},apis:{wheretheiss:{status:"idle",lastCall:null,responseTime:null,error:null},opennotify:{status:"idle",lastCall:null,responseTime:null,error:null},celestrak:{status:"idle",lastCall:null,responseTime:null,error:null},openmeteo:{status:"idle",lastCall:null,responseTime:null,error:null},nominatim:{status:"idle",lastCall:null,responseTime:null,error:null},wikipedia:{status:"idle",lastCall:null,responseTime:null,error:null}},session:{startedAt:Date.now(),apiCallCount:0,lastActivity:Date.now()}},n=new Set;function o(){for(const U of n)U(h())}function h(){return a}function g(U){Object.keys(a).forEach(Y=>delete a[Y]),Object.assign(a,U),o()}function w(U){Object.assign(a,U),o()}function x(U){U(a),o()}function c(U){return n.add(U),U(h()),()=>n.delete(U)}function k(U,Y){a.apis[U]&&(Object.assign(a.apis[U],Y),a.session.lastActivity=Date.now(),o())}function O(){a.session.apiCallCount++,a.session.lastActivity=Date.now()}return{getState:h,setState:g,patch:w,update:x,subscribe:c,updateApiStatus:k,incrementApiCalls:O}}const QE="modulepreload",JE=function(a){return"/iss-tracker-hub/"+a},N0={},eI=function(n,o,h){let g=Promise.resolve();if(o&&o.length>0){let x=function(O){return Promise.all(O.map(U=>Promise.resolve(U).then(Y=>({status:"fulfilled",value:Y}),Y=>({status:"rejected",reason:Y}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),k=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));g=x(o.map(O=>{if(O=JE(O),O in N0)return;N0[O]=!0;const U=O.endsWith(".css"),Y=U?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${O}"]${Y}`))return;const se=document.createElement("link");if(se.rel=U?"stylesheet":QE,U||(se.as="script"),se.crossOrigin="",se.href=O,k&&se.setAttribute("nonce",k),document.head.appendChild(se),U)return new Promise((xe,$e)=>{se.addEventListener("load",xe),se.addEventListener("error",()=>$e(new Error(`Unable to preload CSS for ${O}`)))})}))}function w(x){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=x,window.dispatchEvent(c),!c.defaultPrevented)throw x}return g.then(x=>{for(const c of x||[])c.status==="rejected"&&w(c.reason);return n().catch(w)})};function tI(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var sf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.15.0/LICENSE.txt
 */var nI=sf.exports,V0;function rI(){return V0||(V0=1,(function(a,n){(function(o,h){a.exports=h()})(nI,(function(){var o={},h={};function g(x,c,k){if(h[x]=k,x==="index"){var O="var sharedModule = {}; ("+h.shared+")(sharedModule); ("+h.worker+")(sharedModule);",U={};return h.shared(U),h.index(o,U),typeof window<"u"&&o.setWorkerUrl(window.URL.createObjectURL(new Blob([O],{type:"text/javascript"}))),o}}g("shared",["exports"],(function(x){function c(i,e,r,l){return new(r||(r=Promise))((function(d,f){function m(S){try{T(l.next(S))}catch(P){f(P)}}function v(S){try{T(l.throw(S))}catch(P){f(P)}}function T(S){var P;S.done?d(S.value):(P=S.value,P instanceof r?P:new r((function(M){M(P)}))).then(m,v)}T((l=l.apply(i,e||[])).next())}))}function k(i,e){this.x=i,this.y=e}function O(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var U,Y;typeof SuppressedError=="function"&&SuppressedError,k.prototype={clone(){return new k(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),r=Math.sin(i),l=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=l,this},_rotateAround(i,e){const r=Math.cos(i),l=Math.sin(i),d=e.y+l*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-l*(this.y-e.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:k},k.convert=function(i){if(i instanceof k)return i;if(Array.isArray(i))return new k(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new k(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var se=(function(){if(Y)return U;function i(e,r,l,d){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=d}return Y=1,U=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,d=0;d<8;d++){var f=this.sampleCurveX(l)-e;if(Math.abs(f)<r)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=f/m}var v=0,T=1;for(l=e,d=0;d<20&&(f=this.sampleCurveX(l),!(Math.abs(f-e)<r));d++)e>f?v=l:T=l,l=.5*(T-v)+v;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},U})(),xe=O(se);let $e,Ce;function J(){return $e==null&&($e=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),$e}function Ye(){if(Ce==null&&(Ce=!1,J())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<25;l++){const d=4*l;e.fillStyle=`rgb(${d},${d+1},${d+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&r[l]!==l){Ce=!0;break}}}return Ce||!1}var qe=1e-6,He=typeof Float32Array<"u"?Float32Array:Array;function et(){var i=new He(9);return He!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function at(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Qe(){var i=new He(3);return He!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function he(i){var e=i[0],r=i[1],l=i[2];return Math.sqrt(e*e+r*r+l*l)}function oe(i,e,r){var l=new He(3);return l[0]=i,l[1]=e,l[2]=r,l}function ae(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function Ee(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function be(i,e,r){var l=e[0],d=e[1],f=e[2],m=r[0],v=r[1],T=r[2];return i[0]=d*T-f*v,i[1]=f*m-l*T,i[2]=l*v-d*m,i}var Se,de=he;function Qt(i,e,r){var l=e[0],d=e[1],f=e[2],m=e[3];return i[0]=r[0]*l+r[4]*d+r[8]*f+r[12]*m,i[1]=r[1]*l+r[5]*d+r[9]*f+r[13]*m,i[2]=r[2]*l+r[6]*d+r[10]*f+r[14]*m,i[3]=r[3]*l+r[7]*d+r[11]*f+r[15]*m,i}function mn(){var i=new He(4);return He!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function gt(i,e,r,l){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",f=Math.PI/360;e*=f,l*=f,r*=f;var m=Math.sin(e),v=Math.cos(e),T=Math.sin(r),S=Math.cos(r),P=Math.sin(l),M=Math.cos(l);switch(d){case"xyz":i[0]=m*S*M+v*T*P,i[1]=v*T*M-m*S*P,i[2]=v*S*P+m*T*M,i[3]=v*S*M-m*T*P;break;case"xzy":i[0]=m*S*M-v*T*P,i[1]=v*T*M-m*S*P,i[2]=v*S*P+m*T*M,i[3]=v*S*M+m*T*P;break;case"yxz":i[0]=m*S*M+v*T*P,i[1]=v*T*M-m*S*P,i[2]=v*S*P-m*T*M,i[3]=v*S*M+m*T*P;break;case"yzx":i[0]=m*S*M+v*T*P,i[1]=v*T*M+m*S*P,i[2]=v*S*P-m*T*M,i[3]=v*S*M-m*T*P;break;case"zxy":i[0]=m*S*M-v*T*P,i[1]=v*T*M+m*S*P,i[2]=v*S*P+m*T*M,i[3]=v*S*M-m*T*P;break;case"zyx":i[0]=m*S*M-v*T*P,i[1]=v*T*M+m*S*P,i[2]=v*S*P-m*T*M,i[3]=v*S*M+m*T*P;break;default:throw new Error("Unknown angle order "+d)}return i}function vn(){var i=new He(2);return He!=Float32Array&&(i[0]=0,i[1]=0),i}function gn(i,e){var r=new He(2);return r[0]=i,r[1]=e,r}Qe(),Se=new He(4),He!=Float32Array&&(Se[0]=0,Se[1]=0,Se[2]=0,Se[3]=0),Qe(),oe(1,0,0),oe(0,1,0),mn(),mn(),et(),vn();const St=8192;function In(i,e,r){return e*(St/(i.tileSize*Math.pow(2,r-i.tileID.overscaledZ)))}function jt(i,e){return(i%e+e)%e}function Ht(i,e,r){return i*(1-r)+e*r}function Qn(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function kn(i,e,r,l){const d=new xe(i,e,r,l);return f=>d.solve(f)}const Et=kn(.25,.1,.25,1);function xt(i,e,r){return Math.min(r,Math.max(e,i))}function At(i,e,r){const l=r-e,d=((i-e)%l+l)%l+e;return d===e?r:d}function Wt(i,...e){for(const r of e)for(const l in r)i[l]=r[l];return i}let pn=1;function Zt(i,e,r){const l={};for(const d in i)l[d]=e.call(this,i[d],d,i);return l}function ur(i,e,r){const l={};for(const d in i)e.call(this,i[d],d,i)&&(l[d]=i[d]);return l}function Sn(i){return Array.isArray(i)?i.map(Sn):typeof i=="object"&&i?Zt(i,Sn):i}const Fn={};function Vt(i){Fn[i]||(typeof console<"u"&&console.warn(i),Fn[i]=!0)}function Jt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Cn(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Mt=null;function Kt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ot(i,e,r,l,d){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(i,{timestamp:0});try{const m=f==null?void 0:f.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const v=m.startsWith("BGR"),T=new Uint8ClampedArray(l*d*4);if(yield f.copyTo(T,(function(S,P,M,D,z){const B=4*Math.max(-P,0),j=(Math.max(0,M)-M)*D*4+B,G=4*D,K=Math.max(0,P),ce=Math.max(0,M);return{rect:{x:K,y:ce,width:Math.min(S.width,P+D)-K,height:Math.min(S.height,M+z)-ce},layout:[{offset:j,stride:G}]}})(i,e,r,l,d)),v)for(let S=0;S<T.length;S+=4){const P=T[S];T[S]=T[S+2],T[S+2]=P}return T}finally{f.close()}}))}let tn,nn;function Rn(i,e,r,l){return i.addEventListener(e,r,l),{unsubscribe:()=>{i.removeEventListener(e,r,l)}}}function xn(i){return i*Math.PI/180}function Xt(i){return i/Math.PI*180}const Pe={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},W={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},H="AbortError";class X extends Error{constructor(e=H){super(e instanceof Error?e.message:e),this.name=H,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function fe(i){return i.name===H}const ge={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function V(i){return ge.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Ie="global-dispatcher";class we extends Error{constructor(e,r,l,d){super(`AJAXError: ${r} (${e}): ${l}`),this.status=e,this.statusText=r,this.url=l,this.body=d}}const ke=()=>Cn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ge=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=V(i.url);if(l)return l(i,e);if(Cn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Ie},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(ke())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,d){return c(this,void 0,void 0,(function*(){const f=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:ke(),signal:d.signal});let m,v;l.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{m=yield fetch(f)}catch(S){throw fe(S)?S:new we(0,S.message,l.url,new Blob)}if(!m.ok){const S=yield m.blob();throw new we(m.status,m.statusText,l.url,S)}v=l.type==="arrayBuffer"||l.type==="image"?m.arrayBuffer():l.type==="json"?m.json():m.text();const T=yield v;return d.signal.throwIfAborted(),{data:T,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}}))})(i,e);if(Cn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Ie},e)}var r;return(function(l,d){return new Promise(((f,m)=>{var v;const T=new XMLHttpRequest;T.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(T.responseType="arraybuffer");for(const S in l.headers)T.setRequestHeader(S,l.headers[S]);l.type==="json"&&(T.responseType="text",!((v=l.headers)===null||v===void 0)&&v.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=l.credentials==="include",T.onerror=()=>{m(new Error(T.statusText))},T.onload=()=>{if(!d.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let S=T.response;if(l.type==="json")try{S=JSON.parse(T.response)}catch(P){return void m(P)}f({data:S,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const S=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});m(new we(T.status,T.statusText,l.url,S))}},d.signal.addEventListener("abort",(()=>{T.abort(),m(new X(d.signal.reason))})),T.send(l.body)}))})(i,e)};function Be(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function it(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function ft(i,e,r){if(r&&r[i]){const l=r[i].indexOf(e);l!==-1&&r[i].splice(l,1)}}class It{constructor(e,r={}){Wt(this,r),this.type=e}}class kt extends It{constructor(e,r={}){super("error",Wt({error:e},r))}}class Ft{on(e,r){return this._listeners=this._listeners||{},it(e,r,this._listeners),{unsubscribe:()=>{this.off(e,r)}}}off(e,r){return ft(e,r,this._listeners),ft(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},it(e,r,this._oneTimeListeners),this):new Promise((l=>this.once(e,l)))}fire(e,r){typeof e=="string"&&(e=new It(e,r||{}));const l=e.type;if(this.listens(l)){e.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of d)v.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of f)ft(l,v,this._oneTimeListeners),v.call(this,e);const m=this._eventedParent;m&&(Wt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof kt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const rn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function An(i,e){const r={};for(const l in i)l!=="ref"&&(r[l]=i[l]);return rn.forEach((l=>{l in e&&(r[l]=e[l])})),r}function Ct(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Ct(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!Ct(i[r],e[r]))return!1;return!0}return i===e}function Yt(i,e){i.push(e)}function _n(i,e,r){Yt(r,{command:"addSource",args:[i,e[i]]})}function je(i,e,r){Yt(e,{command:"removeSource",args:[i]}),r[i]=!0}function dt(i,e,r,l){je(i,r,l),_n(i,e,r)}function Fe(i,e,r){let l;for(l in i[r])if(Object.prototype.hasOwnProperty.call(i[r],l)&&l!=="data"&&!Ct(i[r][l],e[r][l]))return!1;for(l in e[r])if(Object.prototype.hasOwnProperty.call(e[r],l)&&l!=="data"&&!Ct(i[r][l],e[r][l]))return!1;return!0}function wt(i,e,r,l,d,f){i=i||{},e=e||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(Ct(i[m],e[m])||r.push({command:f,args:[l,m,e[m],d]}));for(const m in e)Object.prototype.hasOwnProperty.call(e,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(Ct(i[m],e[m])||r.push({command:f,args:[l,m,e[m],d]}))}function Nt(i){return i.id}function jn(i,e){return i[e.id]=e,i}class Ue{constructor(e,r,l,d){this.message=(e?`${e}: `:"")+l,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)}}function $n(i,...e){for(const r of e)for(const l in r)i[l]=r[l];return i}class Jn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Wi{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[l,d]of r)this.bindings[l]=d}concat(e){return new Wi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const mr={kind:"null"},lt={kind:"number"},Rt={kind:"string"},Ut={kind:"boolean"},Cr={kind:"color"},Di={kind:"projectionDefinition"},nr={kind:"object"},Dt={kind:"value"},Xn={kind:"collator"},ci={kind:"formatted"},Li={kind:"padding"},Kr={kind:"colorArray"},Zi={kind:"numberArray"},ls={kind:"resolvedImage"},zi={kind:"variableAnchorOffsetCollection"};function br(i,e){return{kind:"array",itemType:i,N:e}}function Ln(i){if(i.kind==="array"){const e=Ln(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const cs=[mr,lt,Rt,Ut,Cr,Di,ci,nr,br(Dt),Li,Zi,Kr,ls,zi];function Xr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Xr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of cs)if(!Xr(r,e))return null}}return`Expected ${Ln(i)} but found ${Ln(e)} instead.`}function yi(i,e){return e.some((r=>r.kind===i.kind))}function Oi(i,e){return e.some((r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i))}function Yr(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const vo=.96422,Ur=.82521,Mr=4/29,qn=6/29,us=3*qn*qn,hs=qn*qn*qn,zn=Math.PI/180,Ki=180/Math.PI;function ds(i){return(i%=360)<0&&(i+=360),i}function ps([i,e,r,l]){let d,f;const m=bo((.2225045*(i=xo(i))+.7168786*(e=xo(e))+.0606169*(r=xo(r)))/1);i===e&&e===r?d=f=m:(d=bo((.4360747*i+.3850649*e+.1430804*r)/vo),f=bo((.0139322*i+.0971045*e+.7141733*r)/Ur));const v=116*m-16;return[v<0?0:v,500*(d-m),200*(m-f),l]}function xo(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function bo(i){return i>hs?Math.pow(i,1/3):i/us+Mr}function Yo([i,e,r,l]){let d=(i+16)/116,f=isNaN(e)?d:d+e/500,m=isNaN(r)?d:d-r/200;return d=1*Jo(d),f=vo*Jo(f),m=Ur*Jo(m),[Qo(3.1338561*f-1.6168667*d-.4906146*m),Qo(-.9787684*f+1.9161415*d+.033454*m),Qo(.0719453*f-.2289914*d+1.4052427*m),l]}function Qo(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Jo(i){return i>qn?i*i*i:us*(i-Mr)}const vl=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Xi(i,e){return vl(i,e)?i[e]:void 0}function Fi(i){return parseInt(i.padEnd(2,i),16)/255}function ea(i,e){return to(e?i/100:i,0,1)}function to(i,e,r){return Math.min(Math.max(e,i),r)}function Ma(i){return!i.some(Number.isNaN)}const wo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Es(i,e,r){return i+r*(e-i)}function Yi(i,e,r){return i.map(((l,d)=>Es(l,e[d],r)))}class fn{constructor(e,r,l,d=1,f=!0){this.r=e,this.g=r,this.b=l,this.a=d,f||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[e,r,l,d]))}static parse(e){if(e instanceof fn)return e;if(typeof e!="string")return;const r=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=Xi(wo,l);if(d){const[m,v,T]=d;return[m/255,v/255,T/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const m=l.length<6?1:2;let v=1;return[Fi(l.slice(v,v+=m)),Fi(l.slice(v,v+=m)),Fi(l.slice(v,v+=m)),Fi(l.slice(v,v+m)||"ff")]}if(l.startsWith("rgb")){const m=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[v,T,S,P,M,D,z,B,j,G,K,ce]=m,Q=[P||" ",z||" ",G].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const ee=[S,D,j].join(""),pe=ee==="%%%"?100:ee===""?255:0;if(pe){const ye=[to(+T/pe,0,1),to(+M/pe,0,1),to(+B/pe,0,1),K?ea(+K,ce):1];if(Ma(ye))return ye}}return}}const f=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,v,T,S,P,M,D,z,B]=f,j=[T||" ",P||" ",D].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){const G=[+v,to(+S,0,100),to(+M,0,100),z?ea(+z,B):1];if(Ma(G))return(function([K,ce,Q,ee]){function pe(ye){const Re=(ye+K/30)%12,Xe=ce*Math.min(Q,1-Q);return Q-Xe*Math.max(-1,Math.min(Re-3,9-Re,1))}return K=ds(K),ce/=100,Q/=100,[pe(0),pe(8),pe(4),ee]})(G)}}})(e);return r?new fn(...r,!1):void 0}get rgb(){const{r:e,g:r,b:l,a:d}=this,f=d||1/0;return this.overwriteGetter("rgb",[e/f,r/f,l/f,d])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[r,l,d,f]=ps(e),m=Math.sqrt(l*l+d*d);return[Math.round(1e4*m)?ds(Math.atan2(d,l)*Ki):NaN,m,r,f]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ps(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,l,d]=this.rgb;return`rgba(${[e,r,l].map((f=>Math.round(255*f))).join(",")},${d})`}static interpolate(e,r,l,d="rgb"){switch(d){case"rgb":{const[f,m,v,T]=Yi(e.rgb,r.rgb,l);return new fn(f,m,v,T,!1)}case"hcl":{const[f,m,v,T]=e.hcl,[S,P,M,D]=r.hcl;let z,B;if(isNaN(f)||isNaN(S))isNaN(f)?isNaN(S)?z=NaN:(z=S,v!==1&&v!==0||(B=P)):(z=f,M!==1&&M!==0||(B=m));else{let Q=S-f;S>f&&Q>180?Q-=360:S<f&&f-S>180&&(Q+=360),z=f+l*Q}const[j,G,K,ce]=(function([Q,ee,pe,ye]){return Q=isNaN(Q)?0:Q*zn,Yo([pe,Math.cos(Q)*ee,Math.sin(Q)*ee,ye])})([z,B??Es(m,P,l),Es(v,M,l),Es(T,D,l)]);return new fn(j,G,K,ce,!1)}case"lab":{const[f,m,v,T]=Yo(Yi(e.lab,r.lab,l));return new fn(f,m,v,T,!1)}}}}fn.black=new fn(0,0,0,1),fn.white=new fn(1,1,1,1),fn.transparent=new fn(0,0,0,0),fn.red=new fn(1,0,0,1);class xl{constructor(e,r,l){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Wu=["bottom","center","top"];class fs{constructor(e,r,l,d,f,m){this.text=e,this.image=r,this.scale=l,this.fontStack=d,this.textColor=f,this.verticalAlign=m}}class vi{constructor(e){this.sections=e}static fromString(e){return new vi([new fs(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof vi?e:vi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class jr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof jr)return e;if(typeof e=="number")return new jr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new jr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,l){return new jr(Yi(e.values,r.values,l))}}class er{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof er)return e;if(typeof e=="number")return new er([e]);if(Array.isArray(e)){for(const r of e)if(typeof r!="number")return;return new er(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,l){return new er(Yi(e.values,r.values,l))}}class qt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof qt)return e;if(typeof e=="string"){const l=fn.parse(e);return l?new qt([l]):void 0}if(!Array.isArray(e))return;const r=[];for(const l of e){if(typeof l!="string")return;const d=fn.parse(l);if(!d)return;r.push(d)}return new qt(r)}toString(){return JSON.stringify(this.values)}static interpolate(e,r,l,d="rgb"){const f=[];if(e.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let m=0;m<e.values.length;m++)f.push(fn.interpolate(e.values[m],r.values[m],l,d));return new qt(f)}}class Nn extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Ni=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Qr)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const l=e[r],d=e[r+1];if(typeof l!="string"||!Ni.has(l)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new Qr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,r,l){const d=e.values,f=r.values;if(d.length!==f.length)throw new Nn(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${r.toString()}`);const m=[];for(let v=0;v<d.length;v+=2){if(d[v]!==f[v])throw new Nn(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${d[v]}, to[${v}]: ${f[v]}`);m.push(d[v]);const[T,S]=d[v+1],[P,M]=f[v+1];m.push([Es(T,P,l),Es(S,M,l)])}return new Qr(m)}}class ui{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ui({name:e,available:!1}):null}}class Dn{constructor(e,r,l){this.from=e,this.to=r,this.transition=l}static interpolate(e,r,l){return new Dn(e,r,l)}static parse(e){return e instanceof Dn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Dn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Dn(e.from,e.to,e.transition):typeof e=="string"?new Dn(e,e,1):void 0}}function To(i,e,r,l){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,e,r,l]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Dn||i instanceof fn||i instanceof xl||i instanceof vi||i instanceof jr||i instanceof er||i instanceof qt||i instanceof Qr||i instanceof ui)return!0;if(Array.isArray(i)){for(const e of i)if(!Bs(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Bs(i[e]))return!1;return!0}return!1}function gr(i){if(i===null)return mr;if(typeof i=="string")return Rt;if(typeof i=="boolean")return Ut;if(typeof i=="number")return lt;if(i instanceof fn)return Cr;if(i instanceof Dn)return Di;if(i instanceof xl)return Xn;if(i instanceof vi)return ci;if(i instanceof jr)return Li;if(i instanceof er)return Zi;if(i instanceof qt)return Kr;if(i instanceof Qr)return zi;if(i instanceof ui)return ls;if(Array.isArray(i)){const e=i.length;let r;for(const l of i){const d=gr(l);if(r){if(r===d)continue;r=Dt;break}r=d}return br(r||Dt,e)}return nr}function Us(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof fn||i instanceof Dn||i instanceof vi||i instanceof jr||i instanceof er||i instanceof qt||i instanceof Qr||i instanceof ui?i.toString():JSON.stringify(i)}class Qi{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Bs(e[1]))return r.error("invalid value");const l=e[1];let d=gr(l);const f=r.expectedType;return d.kind!=="array"||d.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(d=f),new Qi(d,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const no={string:Rt,number:lt,boolean:Ut,object:nr};class Er{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l,d=1;const f=e[0];if(f==="array"){let v,T;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in no)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=no[S],d++}else v=Dt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);T=e[2],d++}l=br(v,T)}else{if(!no[f])throw new Error(`Types doesn't contain name = ${f}`);l=no[f]}const m=[];for(;d<e.length;d++){const v=r.parse(e[d],d,Dt);if(!v)return null;m.push(v)}return new Er(l,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(e);if(!Xr(this.type,gr(l)))return l;if(r===this.args.length-1)throw new Nn(`Expected value to be of type ${Ln(this.type)}, but found ${Ln(gr(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const js={"to-boolean":Ut,"to-color":Cr,"to-number":lt,"to-string":Rt};class Is{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[0];if(!js[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return r.error("Expected one argument.");const d=js[l],f=[];for(let m=1;m<e.length;m++){const v=r.parse(e[m],m,Dt);if(!v)return null;f.push(v)}return new Is(d,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,l;for(const d of this.args){if(r=d.evaluate(e),l=null,r instanceof fn)return r;if(typeof r=="string"){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:To(r[0],r[1],r[2],r[3]),!l))return new fn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Nn(l||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const l of this.args){r=l.evaluate(e);const d=jr.parse(r);if(d)return d}throw new Nn(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const l of this.args){r=l.evaluate(e);const d=er.parse(r);if(d)return d}throw new Nn(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const l of this.args){r=l.evaluate(e);const d=qt.parse(r);if(d)return d}throw new Nn(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const l of this.args){r=l.evaluate(e);const d=Qr.parse(r);if(d)return d}throw new Nn(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const l of this.args){if(r=l.evaluate(e),r===null)return 0;const d=Number(r);if(!isNaN(d))return d}throw new Nn(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return vi.fromString(Us(this.args[0].evaluate(e)));case"resolvedImage":return ui.fromString(Us(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Us(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Eo=["Unknown","Point","LineString","Polygon"];class ka{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Eo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache.get(e);return r||(r=fn.parse(e),this._parseColorCache.set(e,r)),r}}class Ss{constructor(e,r,l=[],d,f=new Wi,m=[]){this.registry=e,this.path=l,this.key=l.map((v=>`[${v}]`)).join(""),this.scope=f,this.errors=m,this.expectedType=d,this._isConstant=r}parse(e,r,l,d,f={}){return r?this.concat(r,l,d)._parse(e,f):this._parse(e,f)}_parse(e,r){function l(d,f,m){return m==="assert"?new Er(f,[d]):m==="coerce"?new Is(f,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[d];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){const v=this.expectedType,T=m.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||T.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(T.kind)||v.kind==="colorArray"&&["value","string","array"].includes(T.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))m=l(m,v,r.typeAnnotation||"coerce");else if(this.checkSubtype(v,T))return null}else m=l(m,v,r.typeAnnotation||"assert")}if(!(m instanceof Qi)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const v=new ka;try{m=new Qi(m.type,m.evaluate(v))}catch(T){return this.error(T.message),null}}return m}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,l){const d=typeof e=="number"?this.path.concat(e):this.path,f=l?this.scope.concat(l):this.scope;return new Ss(this.registry,this._isConstant,d,r||null,f,this.errors)}error(e,...r){const l=`${this.key}${r.map((d=>`[${d}]`)).join("")}`;this.errors.push(new Jn(l,e))}checkSubtype(e,r){const l=Xr(e,r);return l&&this.error(l),l}}class Gn{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const v=r.parse(e[f+1],f+1);if(!v)return null;l.push([m,v])}const d=r.parse(e[e.length-1],e.length-1,r.expectedType,l);return d?new Gn(l,d):null}outputDefined(){return this.result.outputDefined()}}class ro{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=e[1];return r.scope.has(l)?new ro(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class bn{constructor(e,r,l){this.type=e,this.index=r,this.input=l}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,lt),d=r.parse(e[2],2,br(r.expectedType||Dt));return l&&d?new bn(d.type.itemType,l,d):null}evaluate(e){const r=this.index.evaluate(e),l=this.input.evaluate(e);if(r<0)throw new Nn(`Array index out of bounds: ${r} < 0.`);if(r>=l.length)throw new Nn(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r!==Math.floor(r))throw new Nn(`Array index must be an integer, but found ${r} instead.`);return l[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class an{constructor(e,r){this.type=Ut,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Dt),d=r.parse(e[2],2,Dt);return l&&d?yi(l.type,[Ut,Rt,lt,mr,Dt])?new an(l,d):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(l.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!Oi(r,["boolean","string","number","null"]))throw new Nn(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(gr(r))} instead.`);if(!Oi(l,["string","array"]))throw new Nn(`Expected second argument to be of type array or string, but found ${Ln(gr(l))} instead.`);return l.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class io{constructor(e,r,l){this.type=lt,this.needle=e,this.haystack=r,this.fromIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Dt),d=r.parse(e[2],2,Dt);if(!l||!d)return null;if(!yi(l.type,[Ut,Rt,lt,mr,Dt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(l.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,lt);return f?new io(l,d,f):null}return new io(l,d)}evaluate(e){const r=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Oi(r,["boolean","string","number","null"]))throw new Nn(`Expected first argument to be of type boolean, string, number or null, but found ${Ln(gr(r))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(e)),Oi(l,["string"])){const f=l.indexOf(r,d);return f===-1?-1:[...l.slice(0,f)].length}if(Oi(l,["array"]))return l.indexOf(r,d);throw new Nn(`Expected second argument to be of type array or string, but found ${Ln(gr(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class wn{constructor(e,r,l,d,f,m){this.inputType=e,this.type=r,this.input=l,this.cases=d,this.outputs=f,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let l,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);const f={},m=[];for(let S=2;S<e.length-1;S+=2){let P=e[S];const M=e[S+1];Array.isArray(P)||(P=[P]);const D=r.concat(S);if(P.length===0)return D.error("Expected at least one branch label.");for(const B of P){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(l){if(D.checkSubtype(l,gr(B)))return null}else l=gr(B);if(f[String(B)]!==void 0)return D.error("Branch labels must be unique.");f[String(B)]=m.length}const z=r.parse(M,S,d);if(!z)return null;d=d||z.type,m.push(z)}const v=r.parse(e[1],1,Dt);if(!v)return null;const T=r.parse(e[e.length-1],e.length-1,d);return T?v.type.kind!=="value"&&r.concat(1).checkSubtype(l,v.type)?null:new wn(l,d,v,f,m,T):null}evaluate(e){const r=this.input.evaluate(e);return(gr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Io{constructor(e,r,l){this.type=e,this.branches=r,this.otherwise=l}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const d=[];for(let m=1;m<e.length-1;m+=2){const v=r.parse(e[m],m,Ut);if(!v)return null;const T=r.parse(e[m+1],m+1,l);if(!T)return null;d.push([v,T]),l=l||T.type}const f=r.parse(e[e.length-1],e.length-1,l);if(!f)return null;if(!l)throw new Error("Can't infer output type");return new Io(l,d,f)}evaluate(e){for(const[r,l]of this.branches)if(r.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,l]of this.branches)e(r),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class Si{constructor(e,r,l,d){this.type=e,this.input=r,this.beginIndex=l,this.endIndex=d}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=r.parse(e[1],1,Dt),d=r.parse(e[2],2,lt);if(!l||!d)return null;if(!yi(l.type,[br(Dt),Rt,Dt]))return r.error(`Expected first argument to be of type array or string, but found ${Ln(l.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,lt);return f?new Si(l.type,l,d,f):null}return new Si(l.type,l,d)}evaluate(e){const r=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let d;if(this.endIndex&&(d=this.endIndex.evaluate(e)),Oi(r,["string"]))return[...r].slice(l,d).join("");if(Oi(r,["array"]))return r.slice(l,d);throw new Nn(`Expected first argument to be of type array or string, but found ${Ln(gr(r))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function $s(i,e){const r=i.length-1;let l,d,f=0,m=r,v=0;for(;f<=m;)if(v=Math.floor((f+m)/2),l=i[v],d=i[v+1],l<=e){if(v===r||e<d)return v;f=v+1}else{if(!(l>e))throw new Nn("Input is not a number.");m=v-1}return 0}class ms{constructor(e,r,l){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[d,f]of l)this.labels.push(d),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(e[1],1,lt);if(!l)return null;const d=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let m=1;m<e.length;m+=2){const v=m===1?-1/0:e[m],T=e[m+1],S=m,P=m+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(d.length&&d[d.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const M=r.parse(T,P,f);if(!M)return null;f=f||M.type,d.push([v,M])}return new ms(f,l,d)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return l[0].evaluate(e);const f=r.length;return d>=r[f-1]?l[f-1].evaluate(e):l[$s(r,d)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function bl(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var qs,Ra,Ec=(function(){if(Ra)return qs;function i(e,r,l,d){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=l,this.p2y=d}return Ra=1,qs=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,d=0;d<8;d++){var f=this.sampleCurveX(l)-e;if(Math.abs(f)<r)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=f/m}var v=0,T=1;for(l=e,d=0;d<20&&(f=this.sampleCurveX(l),!(Math.abs(f-e)<r));d++)e>f?v=l:T=l,l=.5*(T-v)+v;return l},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},qs})(),Gs=bl(Ec);class Jr{constructor(e,r,l,d,f){this.type=e,this.operator=r,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(const[m,v]of f)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(e,r,l,d){let f=0;if(e.name==="exponential")f=Ji(r,e.base,l,d);else if(e.name==="linear")f=Ji(r,1,l,d);else if(e.name==="cubic-bezier"){const m=e.controlPoints;f=new Gs(m[0],m[1],m[2],m[3]).solve(Ji(r,1,l,d))}return f}static parse(e,r){let[l,d,f,...m]=e;if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const S=d[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:S}}else{if(d[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const S=d.slice(1);if(S.length!==4||S.some((P=>typeof P!="number"||P<0||P>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,lt),!f)return null;const v=[];let T=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||r.expectedType==Kr?r.expectedType&&r.expectedType.kind!=="value"&&(T=r.expectedType):T=Cr;for(let S=0;S<m.length;S+=2){const P=m[S],M=m[S+1],D=S+3,z=S+4;if(typeof P!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=P)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=r.parse(M,z,T);if(!B)return null;T=T||B.type,v.push([P,B])}return Yr(T,lt)||Yr(T,Di)||Yr(T,Cr)||Yr(T,Li)||Yr(T,Zi)||Yr(T,Kr)||Yr(T,zi)||Yr(T,br(lt))?new Jr(T,l,d,f,v):r.error(`Type ${Ln(T)} is not interpolatable.`)}evaluate(e){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return l[0].evaluate(e);const f=r.length;if(d>=r[f-1])return l[f-1].evaluate(e);const m=$s(r,d),v=Jr.interpolationFactor(this.interpolation,d,r[m],r[m+1]),T=l[m].evaluate(e),S=l[m+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Es(T,S,v);case"color":return fn.interpolate(T,S,v);case"padding":return jr.interpolate(T,S,v);case"colorArray":return qt.interpolate(T,S,v);case"numberArray":return er.interpolate(T,S,v);case"variableAnchorOffsetCollection":return Qr.interpolate(T,S,v);case"array":return Yi(T,S,v);case"projectionDefinition":return Dn.interpolate(T,S,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return fn.interpolate(T,S,v,"hcl");case"colorArray":return qt.interpolate(T,S,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return fn.interpolate(T,S,v,"lab");case"colorArray":return qt.interpolate(T,S,v,"lab")}}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Ji(i,e,r,l){const d=l-r,f=i-r;return d===0?0:e===1?f/d:(Math.pow(e,f)-1)/(Math.pow(e,d)-1)}const rr={color:fn.interpolate,number:Es,padding:jr.interpolate,numberArray:er.interpolate,colorArray:qt.interpolate,variableAnchorOffsetCollection:Qr.interpolate,array:Yi};class Hs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let l=null;const d=r.expectedType;d&&d.kind!=="value"&&(l=d);const f=[];for(const v of e.slice(1)){const T=r.parse(v,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!T)return null;l=l||T.type,f.push(T)}if(!l)throw new Error("No output type");const m=d&&f.some((v=>Xr(d,v.type)));return new Hs(m?Dt:l,f)}evaluate(e){let r,l=null,d=0;for(const f of this.args)if(d++,l=f.evaluate(e),l&&l instanceof ui&&!l.available&&(r||(r=l.name),l=null,d===this.args.length&&(l=r)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function So(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Gr(i,e,r,l){return l.compare(e,r)===0}function hr(i,e,r){const l=i!=="=="&&i!=="!=";return class Ob{constructor(f,m,v){this.type=Ut,this.lhs=f,this.rhs=m,this.collator=v,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const v=f[0];let T=m.parse(f[1],1,Dt);if(!T)return null;if(!So(v,T.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Ln(T.type)}'.`);let S=m.parse(f[2],2,Dt);if(!S)return null;if(!So(v,S.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Ln(S.type)}'.`);if(T.type.kind!==S.type.kind&&T.type.kind!=="value"&&S.type.kind!=="value")return m.error(`Cannot compare types '${Ln(T.type)}' and '${Ln(S.type)}'.`);l&&(T.type.kind==="value"&&S.type.kind!=="value"?T=new Er(S.type,[T]):T.type.kind!=="value"&&S.type.kind==="value"&&(S=new Er(T.type,[S])));let P=null;if(f.length===4){if(T.type.kind!=="string"&&S.type.kind!=="string"&&T.type.kind!=="value"&&S.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(P=m.parse(f[3],3,Xn),!P)return null}return new Ob(T,S,P)}evaluate(f){const m=this.lhs.evaluate(f),v=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const T=gr(m),S=gr(v);if(T.kind!==S.kind||T.kind!=="string"&&T.kind!=="number")throw new Nn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${T.kind}, ${S.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const T=gr(m),S=gr(v);if(T.kind!=="string"||S.kind!=="string")return e(f,m,v)}return this.collator?r(f,m,v,this.collator.evaluate(f)):e(f,m,v)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const wl=hr("==",(function(i,e,r){return e===r}),Gr),Ws=hr("!=",(function(i,e,r){return e!==r}),(function(i,e,r,l){return!Gr(0,e,r,l)})),E=hr("<",(function(i,e,r){return e<r}),(function(i,e,r,l){return l.compare(e,r)<0})),L=hr(">",(function(i,e,r){return e>r}),(function(i,e,r,l){return l.compare(e,r)>0})),$=hr("<=",(function(i,e,r){return e<=r}),(function(i,e,r,l){return l.compare(e,r)<=0})),ne=hr(">=",(function(i,e,r){return e>=r}),(function(i,e,r,l){return l.compare(e,r)>=0}));class De{constructor(e,r,l){this.type=Xn,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const d=r.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Ut);if(!d)return null;const f=r.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Ut);if(!f)return null;let m=null;return l.locale&&(m=r.parse(l.locale,1,Rt),!m)?null:new De(d,f,m)}evaluate(e){return new xl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Ze{constructor(e,r,l,d,f){this.type=Rt,this.number=e,this.locale=r,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const l=r.parse(e[1],1,lt);if(!l)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");let f=null;if(d.locale&&(f=r.parse(d.locale,1,Rt),!f))return null;let m=null;if(d.currency&&(m=r.parse(d.currency,1,Rt),!m))return null;let v=null;if(d["min-fraction-digits"]&&(v=r.parse(d["min-fraction-digits"],1,lt),!v))return null;let T=null;return d["max-fraction-digits"]&&(T=r.parse(d["max-fraction-digits"],1,lt),!T)?null:new Ze(l,f,m,v,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class _t{constructor(e){this.type=ci,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const d=[];let f=!1;for(let m=1;m<=e.length-1;++m){const v=e[m];if(f&&typeof v=="object"&&!Array.isArray(v)){f=!1;let T=null;if(v["font-scale"]&&(T=r.parse(v["font-scale"],1,lt),!T))return null;let S=null;if(v["text-font"]&&(S=r.parse(v["text-font"],1,br(Rt)),!S))return null;let P=null;if(v["text-color"]&&(P=r.parse(v["text-color"],1,Cr),!P))return null;let M=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!Wu.includes(v["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(M=r.parse(v["vertical-align"],1,Rt),!M)return null}const D=d[d.length-1];D.scale=T,D.font=S,D.textColor=P,D.verticalAlign=M}else{const T=r.parse(e[m],1,Dt);if(!T)return null;const S=T.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,d.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new _t(d)}evaluate(e){return new vi(this.sections.map((r=>{const l=r.content.evaluate(e);return gr(l)===ls?new fs("",l,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(e):null):new fs(Us(l),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null,r.verticalAlign?r.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor),r.verticalAlign&&e(r.verticalAlign)}outputDefined(){return!1}}class ln{constructor(e){this.type=ls,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const l=r.parse(e[1],1,Rt);return l?new ln(l):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),l=ui.fromString(r);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(r)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class dr{constructor(e){this.type=lt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=r.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ln(l.type)} instead.`):new dr(l):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Nn(`Expected value to be of type string or array, but found ${Ln(gr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const on=8192;function Or(i,e){const r=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(r*d*on),Math.round(l*d*on)]}function hi(i,e){const r=Math.pow(2,e.z);return[(d=(i[0]/on+e.x)/r,360*d-180),(l=(i[1]/on+e.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,d}function es(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function xi(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Zs(i,e,r){const l=i[0]-e[0],d=i[1]-e[1],f=i[0]-r[0],m=i[1]-r[1];return l*m-f*d==0&&l*f<=0&&d*m<=0}function so(i,e,r,l){return(d=[l[0]-r[0],l[1]-r[1]])[0]*(f=[e[0]-i[0],e[1]-i[1]])[1]-d[1]*f[0]!=0&&!(!Zu(i,e,r,l)||!Zu(r,l,i,e));var d,f}function Tl(i,e,r){for(const l of r)for(let d=0;d<l.length-1;++d)if(so(i,e,l[d],l[d+1]))return!0;return!1}function Da(i,e,r=!1){let l=!1;for(const v of e)for(let T=0;T<v.length-1;T++){if(Zs(i,v[T],v[T+1]))return r;(f=v[T])[1]>(d=i)[1]!=(m=v[T+1])[1]>d[1]&&d[0]<(m[0]-f[0])*(d[1]-f[1])/(m[1]-f[1])+f[0]&&(l=!l)}var d,f,m;return l}function Ic(i,e){for(const r of e)if(Da(i,r))return!0;return!1}function Rd(i,e){for(const r of i)if(!Da(r,e))return!1;for(let r=0;r<i.length-1;++r)if(Tl(i[r],i[r+1],e))return!1;return!0}function Dd(i,e){for(const r of e)if(Rd(i,r))return!0;return!1}function Zu(i,e,r,l){const d=l[0]-r[0],f=l[1]-r[1],m=(i[0]-r[0])*f-d*(i[1]-r[1]),v=(e[0]-r[0])*f-d*(e[1]-r[1]);return m>0&&v<0||m<0&&v>0}function Ku(i,e,r){const l=[];for(let d=0;d<i.length;d++){const f=[];for(let m=0;m<i[d].length;m++){const v=Or(i[d][m],r);es(e,v),f.push(v)}l.push(f)}return l}function Xu(i,e,r){const l=[];for(let d=0;d<i.length;d++){const f=Ku(i[d],e,r);l.push(f)}return l}function Ld(i,e,r,l){if(i[0]<r[0]||i[0]>r[2]){const d=.5*l;let f=i[0]-r[0]>d?-l:r[0]-i[0]>d?l:0;f===0&&(f=i[0]-r[2]>d?-l:r[2]-i[0]>d?l:0),i[0]+=f}es(e,i)}function zd(i,e,r,l){const d=Math.pow(2,l.z)*on,f=[l.x*on,l.y*on],m=[];for(const v of i)for(const T of v){const S=[T.x+f[0],T.y+f[1]];Ld(S,e,r,d),m.push(S)}return m}function Od(i,e,r,l){const d=Math.pow(2,l.z)*on,f=[l.x*on,l.y*on],m=[];for(const T of i){const S=[];for(const P of T){const M=[P.x+f[0],P.y+f[1]];es(e,M),S.push(M)}m.push(S)}if(e[2]-e[0]<=d/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of m)for(const S of T)Ld(S,e,r,d)}var v;return m}class ta{constructor(e,r){this.type=Ut,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Bs(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const d=[];for(const f of l.features){const{type:m,coordinates:v}=f.geometry;m==="Polygon"&&d.push(v),m==="MultiPolygon"&&d.push(...v)}if(d.length)return new ta(l,{type:"MultiPolygon",coordinates:d})}else if(l.type==="Feature"){const d=l.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ta(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new ta(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,l){const d=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(l.type==="Polygon"){const v=Ku(l.coordinates,f,m),T=zd(r.geometry(),d,f,m);if(!xi(d,f))return!1;for(const S of T)if(!Da(S,v))return!1}if(l.type==="MultiPolygon"){const v=Xu(l.coordinates,f,m),T=zd(r.geometry(),d,f,m);if(!xi(d,f))return!1;for(const S of T)if(!Ic(S,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,l){const d=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(l.type==="Polygon"){const v=Ku(l.coordinates,f,m),T=Od(r.geometry(),d,f,m);if(!xi(d,f))return!1;for(const S of T)if(!Rd(S,v))return!1}if(l.type==="MultiPolygon"){const v=Xu(l.coordinates,f,m),T=Od(r.geometry(),d,f,m);if(!xi(d,f))return!1;for(const S of T)if(!Dd(S,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Fd=class{constructor(i=[],e=(r,l)=>r<l?-1:r>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:r}=this,l=e[i];for(;i>0;){const d=i-1>>1,f=e[d];if(r(l,f)>=0)break;e[i]=f,i=d}e[i]=l}_down(i){const{data:e,compare:r}=this,l=this.length>>1,d=e[i];for(;i<l;){let f=1+(i<<1);const m=f+1;if(m<this.length&&r(e[m],e[f])<0&&(f=m),r(e[f],d)>=0)break;e[i]=e[f],i=f}e[i]=d}};function Yu(i,e,r=0,l=i.length-1,d=Nd){for(;l>r;){if(l-r>600){const T=l-r+1,S=e-r+1,P=Math.log(T),M=.5*Math.exp(2*P/3),D=.5*Math.sqrt(P*M*(T-M)/T)*(S-T/2<0?-1:1);Yu(i,e,Math.max(r,Math.floor(e-S*M/T+D)),Math.min(l,Math.floor(e+(T-S)*M/T+D)),d)}const f=i[e];let m=r,v=l;for(La(i,r,e),d(i[l],f)>0&&La(i,r,l);m<v;){for(La(i,m,v),m++,v--;d(i[m],f)<0;)m++;for(;d(i[v],f)>0;)v--}d(i[r],f)===0?La(i,r,v):(v++,La(i,v,l)),v<=e&&(r=v+1),e<=v&&(l=v-1)}}function La(i,e,r){const l=i[e];i[e]=i[r],i[r]=l}function Nd(i,e){return i<e?-1:i>e?1:0}function Sc(i,e){if(i.length<=1)return[i];const r=[];let l,d;for(const f of i){const m=dm(f);m!==0&&(f.area=Math.abs(m),d===void 0&&(d=m<0),d===m<0?(l&&r.push(l),l=[f]):l.push(f))}if(l&&r.push(l),e>1)for(let f=0;f<r.length;f++)r[f].length<=e||(Yu(r[f],e,1,r[f].length-1,hm),r[f]=r[f].slice(0,e));return r}function hm(i,e){return e.area-i.area}function dm(i){let e=0;for(let r,l,d=0,f=i.length,m=f-1;d<f;m=d++)r=i[d],l=i[m],e+=(l.x-r.x)*(r.y+l.y);return e}const Vd=1/298.257223563,El=Vd*(2-Vd),Bd=Math.PI/180;class Qu{constructor(e){const r=6378.137*Bd*1e3,l=Math.cos(e*Bd),d=1/(1-El*(1-l*l)),f=Math.sqrt(d);this.kx=r*f*l,this.ky=r*f*d*(1-El)}distance(e,r){const l=this.wrap(e[0]-r[0])*this.kx,d=(e[1]-r[1])*this.ky;return Math.sqrt(l*l+d*d)}pointOnLine(e,r){let l,d,f,m,v=1/0;for(let T=0;T<e.length-1;T++){let S=e[T][0],P=e[T][1],M=this.wrap(e[T+1][0]-S)*this.kx,D=(e[T+1][1]-P)*this.ky,z=0;M===0&&D===0||(z=(this.wrap(r[0]-S)*this.kx*M+(r[1]-P)*this.ky*D)/(M*M+D*D),z>1?(S=e[T+1][0],P=e[T+1][1]):z>0&&(S+=M/this.kx*z,P+=D/this.ky*z)),M=this.wrap(r[0]-S)*this.kx,D=(r[1]-P)*this.ky;const B=M*M+D*D;B<v&&(v=B,l=S,d=P,f=T,m=z)}return{point:[l,d],index:f,t:Math.max(0,Math.min(1,m))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Ud(i,e){return e[0]-i[0]}function Ac(i){return i[1]-i[0]+1}function As(i,e){return i[1]>=i[0]&&i[1]<e}function Pc(i,e){if(i[0]>i[1])return[null,null];const r=Ac(i);if(e){if(r===2)return[i,null];const d=Math.floor(r/2);return[[i[0],i[0]+d],[i[0]+d,i[1]]]}if(r===1)return[i,null];const l=Math.floor(r/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function Ju(i,e){if(!As(e,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)es(r,i[l]);return r}function eh(i){const e=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const l of r)es(e,l);return e}function th(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Cc(i,e,r){if(!th(i)||!th(e))return NaN;let l=0,d=0;return i[2]<e[0]&&(l=e[0]-i[2]),i[0]>e[2]&&(l=i[0]-e[2]),i[1]>e[3]&&(d=i[1]-e[3]),i[3]<e[1]&&(d=e[1]-i[3]),r.distance([0,0],[l,d])}function na(i,e,r){const l=r.pointOnLine(e,i);return r.distance(i,l.point)}function nh(i,e,r,l,d){const f=Math.min(na(i,[r,l],d),na(e,[r,l],d)),m=Math.min(na(r,[i,e],d),na(l,[i,e],d));return Math.min(f,m)}function pm(i,e,r,l,d){if(!As(e,i.length)||!As(l,r.length))return 1/0;let f=1/0;for(let m=e[0];m<e[1];++m){const v=i[m],T=i[m+1];for(let S=l[0];S<l[1];++S){const P=r[S],M=r[S+1];if(so(v,T,P,M))return 0;f=Math.min(f,nh(v,T,P,M,d))}}return f}function jd(i,e,r,l,d){if(!As(e,i.length)||!As(l,r.length))return NaN;let f=1/0;for(let m=e[0];m<=e[1];++m)for(let v=l[0];v<=l[1];++v)if(f=Math.min(f,d.distance(i[m],r[v])),f===0)return f;return f}function fm(i,e,r){if(Da(i,e,!0))return 0;let l=1/0;for(const d of e){const f=d[0],m=d[d.length-1];if(f!==m&&(l=Math.min(l,na(i,[m,f],r)),l===0))return l;const v=r.pointOnLine(d,i);if(l=Math.min(l,r.distance(i,v.point)),l===0)return l}return l}function mm(i,e,r,l){if(!As(e,i.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Da(i[f],r,!0))return 0;let d=1/0;for(let f=e[0];f<e[1];++f){const m=i[f],v=i[f+1];for(const T of r)for(let S=0,P=T.length,M=P-1;S<P;M=S++){const D=T[M],z=T[S];if(so(m,v,D,z))return 0;d=Math.min(d,nh(m,v,D,z,l))}}return d}function $d(i,e){for(const r of i)for(const l of r)if(Da(l,e,!0))return!0;return!1}function gm(i,e,r,l=1/0){const d=eh(i),f=eh(e);if(l!==1/0&&Cc(d,f,r)>=l)return l;if(xi(d,f)){if($d(i,e))return 0}else if($d(e,i))return 0;let m=1/0;for(const v of i)for(let T=0,S=v.length,P=S-1;T<S;P=T++){const M=v[P],D=v[T];for(const z of e)for(let B=0,j=z.length,G=j-1;B<j;G=B++){const K=z[G],ce=z[B];if(so(M,D,K,ce))return 0;m=Math.min(m,nh(M,D,K,ce,r))}}return m}function Hn(i,e,r,l,d,f){if(!f)return;const m=Cc(Ju(l,f),d,r);m<e&&i.push([m,f,[0,0]])}function Mc(i,e,r,l,d,f,m){if(!f||!m)return;const v=Cc(Ju(l,f),Ju(d,m),r);v<e&&i.push([v,f,m])}function kc(i,e,r,l,d=1/0){let f=Math.min(l.distance(i[0],r[0][0]),d);if(f===0)return f;const m=new Fd([[0,[0,i.length-1],[0,0]]],Ud),v=eh(r);for(;m.length>0;){const T=m.pop();if(T[0]>=f)continue;const S=T[1],P=e?50:100;if(Ac(S)<=P){if(!As(S,i.length))return NaN;if(e){const M=mm(i,S,r,l);if(isNaN(M)||M===0)return M;f=Math.min(f,M)}else for(let M=S[0];M<=S[1];++M){const D=fm(i[M],r,l);if(f=Math.min(f,D),f===0)return 0}}else{const M=Pc(S,e);Hn(m,f,l,i,v,M[0]),Hn(m,f,l,i,v,M[1])}}return f}function Rc(i,e,r,l,d,f=1/0){let m=Math.min(f,d.distance(i[0],r[0]));if(m===0)return m;const v=new Fd([[0,[0,i.length-1],[0,r.length-1]]],Ud);for(;v.length>0;){const T=v.pop();if(T[0]>=m)continue;const S=T[1],P=T[2],M=e?50:100,D=l?50:100;if(Ac(S)<=M&&Ac(P)<=D){if(!As(S,i.length)&&As(P,r.length))return NaN;let z;if(e&&l)z=pm(i,S,r,P,d),m=Math.min(m,z);else if(e&&!l){const B=i.slice(S[0],S[1]+1);for(let j=P[0];j<=P[1];++j)if(z=na(r[j],B,d),m=Math.min(m,z),m===0)return m}else if(!e&&l){const B=r.slice(P[0],P[1]+1);for(let j=S[0];j<=S[1];++j)if(z=na(i[j],B,d),m=Math.min(m,z),m===0)return m}else z=jd(i,S,r,P,d),m=Math.min(m,z)}else{const z=Pc(S,e),B=Pc(P,l);Mc(v,m,d,i,r,z[0],B[0]),Mc(v,m,d,i,r,z[0],B[1]),Mc(v,m,d,i,r,z[1],B[0]),Mc(v,m,d,i,r,z[1],B[1])}}return m}function rh(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class ra{constructor(e,r){this.type=lt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Bs(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new ra(l,l.features.map((d=>rh(d.geometry))).flat());if(l.type==="Feature")return new ra(l,rh(l.geometry));if("type"in l&&"coordinates"in l)return new ra(l,rh(l))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(r,l){const d=r.geometry(),f=d.flat().map((T=>hi([T.x,T.y],r.canonical)));if(d.length===0)return NaN;const m=new Qu(f[0][1]);let v=1/0;for(const T of l){switch(T.type){case"Point":v=Math.min(v,Rc(f,!1,[T.coordinates],!1,m,v));break;case"LineString":v=Math.min(v,Rc(f,!1,T.coordinates,!0,m,v));break;case"Polygon":v=Math.min(v,kc(f,!1,T.coordinates,m,v))}if(v===0)return v}return v})(e,this.geometries);if(e.geometryType()==="LineString")return(function(r,l){const d=r.geometry(),f=d.flat().map((T=>hi([T.x,T.y],r.canonical)));if(d.length===0)return NaN;const m=new Qu(f[0][1]);let v=1/0;for(const T of l){switch(T.type){case"Point":v=Math.min(v,Rc(f,!0,[T.coordinates],!1,m,v));break;case"LineString":v=Math.min(v,Rc(f,!0,T.coordinates,!0,m,v));break;case"Polygon":v=Math.min(v,kc(f,!0,T.coordinates,m,v))}if(v===0)return v}return v})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(r,l){const d=r.geometry();if(d.length===0||d[0].length===0)return NaN;const f=Sc(d,0).map((T=>T.map((S=>S.map((P=>hi([P.x,P.y],r.canonical))))))),m=new Qu(f[0][0][0][1]);let v=1/0;for(const T of l)for(const S of f){switch(T.type){case"Point":v=Math.min(v,kc([T.coordinates],!1,S,m,v));break;case"LineString":v=Math.min(v,kc(T.coordinates,!0,S,m,v));break;case"Polygon":v=Math.min(v,gm(S,T.coordinates,m,v))}if(v===0)return v}return v})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Il{constructor(e){this.type=Dt,this.key=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=e[1];return l==null?r.error("Global state property must be defined."):typeof l!="string"?r.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Il(l)}evaluate(e){var r;const l=(r=e.globals)===null||r===void 0?void 0:r.globalState;return l&&Object.keys(l).length!==0?Xi(l,this.key):null}eachChild(){}outputDefined(){return!1}}const za={"==":wl,"!=":Ws,">":L,"<":E,">=":ne,"<=":$,array:Er,at:bn,boolean:Er,case:Io,coalesce:Hs,collator:De,format:_t,image:ln,in:an,"index-of":io,interpolate:Jr,"interpolate-hcl":Jr,"interpolate-lab":Jr,length:dr,let:Gn,literal:Qi,match:wn,number:Er,"number-format":Ze,object:Er,slice:Si,step:ms,string:Er,"to-boolean":Is,"to-color":Is,"to-number":Is,"to-string":Is,var:ro,within:ta,distance:ra,"global-state":Il};class gs{constructor(e,r,l,d){this.name=e,this.type=r,this._evaluate=l,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const l=e[0],d=gs.definitions[l];if(!d)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(d)?d[0]:d.type,m=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,v=m.filter((([S])=>!Array.isArray(S)||S.length===e.length-1));let T=null;for(const[S,P]of v){T=new Ss(r.registry,Dc,r.path,null,r.scope);const M=[];let D=!1;for(let z=1;z<e.length;z++){const B=e[z],j=Array.isArray(S)?S[z-1]:S.type,G=T.parse(B,1+M.length,j);if(!G){D=!0;break}M.push(G)}if(!D)if(Array.isArray(S)&&S.length!==M.length)T.error(`Expected ${S.length} arguments, but found ${M.length} instead.`);else{for(let z=0;z<M.length;z++){const B=Array.isArray(S)?S[z]:S.type,j=M[z];T.concat(z+1).checkSubtype(B,j.type)}if(T.errors.length===0)return new gs(l,f,P,M)}}if(v.length===1)r.errors.push(...T.errors);else{const S=(v.length?v:m).map((([M])=>{return D=M,Array.isArray(D)?`(${D.map(Ln).join(", ")})`:`(${Ln(D.type)}...)`;var D})).join(" | "),P=[];for(let M=1;M<e.length;M++){const D=r.parse(e[M],1+P.length);if(!D)return null;P.push(Ln(D.type))}r.error(`Expected arguments of type ${S}, but found (${P.join(", ")}) instead.`)}return null}static register(e,r){gs.definitions=r;for(const l in r)e[l]=gs}}function qd(i,[e,r,l,d]){e=e.evaluate(i),r=r.evaluate(i),l=l.evaluate(i);const f=d?d.evaluate(i):1,m=To(e,r,l,f);if(m)throw new Nn(m);return new fn(e/255,r/255,l/255,f,!1)}function Gd(i,e){return i in e}function ih(i,e){const r=e[i];return r===void 0?null:r}function ia(i){return{type:i}}function Dc(i){if(i instanceof ro)return Dc(i.boundExpression);if(i instanceof gs&&i.name==="error"||i instanceof De||i instanceof ta||i instanceof ra||i instanceof Il)return!1;const e=i instanceof Is||i instanceof Er;let r=!0;return i.eachChild((l=>{r=e?r&&Dc(l):r&&l instanceof Qi})),!!r&&Lc(i)&&zc(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Lc(i){if(i instanceof gs&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ta||i instanceof ra)return!1;let e=!0;return i.eachChild((r=>{e&&!Lc(r)&&(e=!1)})),e}function Sl(i){if(i instanceof gs&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((r=>{e&&!Sl(r)&&(e=!1)})),e}function zc(i,e){if(i instanceof gs&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild((l=>{r&&!zc(l,e)&&(r=!1)})),r}function Hd(i){return{result:"success",value:i}}function Oa(i){return{result:"error",value:i}}function Fa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Wd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function sh(i){return!!i.expression&&i.expression.interpolated}function Tn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Oc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&gr(i)===nr}function _m(i){return i}function Zd(i,e){const r=i.stops&&typeof i.stops[0][0]=="object",l=r||!(r||i.property!==void 0),d=i.type||(sh(e)?"exponential":"interval"),f=(function(P){switch(P.type){case"color":return fn.parse;case"padding":return jr.parse;case"numberArray":return er.parse;case"colorArray":return qt.parse;default:return null}})(e);if(f&&((i=$n({},i)).stops&&(i.stops=i.stops.map((P=>[P[0],f(P[1])]))),i.default=f(i.default?i.default:e.default)),i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;const v=(function(P){switch(P){case"exponential":return Kd;case"interval":return vm;case"categorical":return ym;case"identity":return xm;default:throw new Error(`Unknown function type "${P}"`)}})(d);let T,S;if(d==="categorical"){T=Object.create(null);for(const P of i.stops)T[P[0]]=P[1];S=typeof i.stops[0][0]}if(r){const P={},M=[];for(let B=0;B<i.stops.length;B++){const j=i.stops[B],G=j[0].zoom;P[G]===void 0&&(P[G]={zoom:G,type:i.type,property:i.property,default:i.default,stops:[]},M.push(G)),P[G].stops.push([j[0].value,j[1]])}const D=[];for(const B of M)D.push([P[B].zoom,Zd(P[B],e)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Jr.interpolationFactor.bind(void 0,z),zoomStops:D.map((B=>B[0])),evaluate:({zoom:B},j)=>Kd({stops:D,base:i.base},e,B).evaluate(B,j)}}if(l){const P=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Jr.interpolationFactor.bind(void 0,P),zoomStops:i.stops.map((M=>M[0])),evaluate:({zoom:M})=>v(i,e,M,T,S)}}return{kind:"source",evaluate(P,M){const D=M&&M.properties?M.properties[i.property]:void 0;return D===void 0?Al(i.default,e.default):v(i,e,D,T,S)}}}function Al(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function ym(i,e,r,l,d){return Al(typeof r===d?l[r]:void 0,i.default,e.default)}function vm(i,e,r){if(Tn(r)!=="number")return Al(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const d=$s(i.stops.map((f=>f[0])),r);return i.stops[d][1]}function Kd(i,e,r){const l=i.base!==void 0?i.base:1;if(Tn(r)!=="number")return Al(i.default,e.default);const d=i.stops.length;if(d===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[d-1][0])return i.stops[d-1][1];const f=$s(i.stops.map((P=>P[0])),r),m=(function(P,M,D,z){const B=z-D,j=P-D;return B===0?0:M===1?j/B:(Math.pow(M,j)-1)/(Math.pow(M,B)-1)})(r,l,i.stops[f][0],i.stops[f+1][0]),v=i.stops[f][1],T=i.stops[f+1][1],S=rr[e.type]||_m;return typeof v.evaluate=="function"?{evaluate(...P){const M=v.evaluate.apply(void 0,P),D=T.evaluate.apply(void 0,P);if(M!==void 0&&D!==void 0)return S(M,D,m,i.colorSpace)}}:S(v,T,m,i.colorSpace)}function xm(i,e,r){switch(e.type){case"color":r=fn.parse(r);break;case"formatted":r=vi.fromString(r.toString());break;case"resolvedImage":r=ui.fromString(r.toString());break;case"padding":r=jr.parse(r);break;case"colorArray":r=qt.parse(r);break;case"numberArray":r=er.parse(r);break;default:Tn(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Al(r,i.default,e.default)}gs.register(za,{error:[{kind:"error"},[Rt],(i,[e])=>{throw new Nn(e.evaluate(i))}],typeof:[Rt,[Dt],(i,[e])=>Ln(gr(e.evaluate(i)))],"to-rgba":[br(lt,4),[Cr],(i,[e])=>{const[r,l,d,f]=e.evaluate(i).rgb;return[255*r,255*l,255*d,f]}],rgb:[Cr,[lt,lt,lt],qd],rgba:[Cr,[lt,lt,lt,lt],qd],has:{type:Ut,overloads:[[[Rt],(i,[e])=>Gd(e.evaluate(i),i.properties())],[[Rt,nr],(i,[e,r])=>Gd(e.evaluate(i),r.evaluate(i))]]},get:{type:Dt,overloads:[[[Rt],(i,[e])=>ih(e.evaluate(i),i.properties())],[[Rt,nr],(i,[e,r])=>ih(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Dt,[Rt],(i,[e])=>ih(e.evaluate(i),i.featureState||{})],properties:[nr,[],i=>i.properties()],"geometry-type":[Rt,[],i=>i.geometryType()],id:[Dt,[],i=>i.id()],zoom:[lt,[],i=>i.globals.zoom],"heatmap-density":[lt,[],i=>i.globals.heatmapDensity||0],elevation:[lt,[],i=>i.globals.elevation||0],"line-progress":[lt,[],i=>i.globals.lineProgress||0],accumulated:[Dt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[lt,ia(lt),(i,e)=>{let r=0;for(const l of e)r+=l.evaluate(i);return r}],"*":[lt,ia(lt),(i,e)=>{let r=1;for(const l of e)r*=l.evaluate(i);return r}],"-":{type:lt,overloads:[[[lt,lt],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[lt],(i,[e])=>-e.evaluate(i)]]},"/":[lt,[lt,lt],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[lt,[lt,lt],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[lt,[lt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[lt,[lt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[lt,[lt],(i,[e])=>Math.log(e.evaluate(i))],log2:[lt,[lt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[lt,[lt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[lt,[lt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[lt,[lt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[lt,[lt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[lt,[lt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[lt,[lt],(i,[e])=>Math.atan(e.evaluate(i))],min:[lt,ia(lt),(i,e)=>Math.min(...e.map((r=>r.evaluate(i))))],max:[lt,ia(lt),(i,e)=>Math.max(...e.map((r=>r.evaluate(i))))],abs:[lt,[lt],(i,[e])=>Math.abs(e.evaluate(i))],round:[lt,[lt],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[lt,[lt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[lt,[lt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Ut,[Rt,Dt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Ut,[Dt],(i,[e])=>i.id()===e.value],"filter-type-==":[Ut,[Rt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Ut,[Rt,Dt],(i,[e,r])=>{const l=i.properties()[e.value],d=r.value;return typeof l==typeof d&&l<d}],"filter-id-<":[Ut,[Dt],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r<l}],"filter->":[Ut,[Rt,Dt],(i,[e,r])=>{const l=i.properties()[e.value],d=r.value;return typeof l==typeof d&&l>d}],"filter-id->":[Ut,[Dt],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r>l}],"filter-<=":[Ut,[Rt,Dt],(i,[e,r])=>{const l=i.properties()[e.value],d=r.value;return typeof l==typeof d&&l<=d}],"filter-id-<=":[Ut,[Dt],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r<=l}],"filter->=":[Ut,[Rt,Dt],(i,[e,r])=>{const l=i.properties()[e.value],d=r.value;return typeof l==typeof d&&l>=d}],"filter-id->=":[Ut,[Dt],(i,[e])=>{const r=i.id(),l=e.value;return typeof r==typeof l&&r>=l}],"filter-has":[Ut,[Dt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Ut,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ut,[br(Rt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ut,[br(Dt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Ut,[Rt,br(Dt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Ut,[Rt,br(Dt)],(i,[e,r])=>(function(l,d,f,m){for(;f<=m;){const v=f+m>>1;if(d[v]===l)return!0;d[v]>l?m=v-1:f=v+1}return!1})(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Ut,overloads:[[[Ut,Ut],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[ia(Ut),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ut,overloads:[[[Ut,Ut],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[ia(Ut),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Ut,[Ut],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Ut,[Rt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Rt,[Rt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Rt,[Rt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Rt,ia(Dt),(i,e)=>e.map((r=>Us(r.evaluate(i)))).join("")],"resolved-locale":[Rt,[Xn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class oh{constructor(e,r,l){this.expression=e,this._warningHistory={},this._evaluator=new ka,this._defaultValue=r?(function(d){if(d.type==="color"&&Oc(d.default))return new fn(0,0,0,0);switch(d.type){case"color":return fn.parse(d.default)||null;case"padding":return jr.parse(d.default)||null;case"numberArray":return er.parse(d.default)||null;case"colorArray":return qt.parse(d.default)||null;case"variableAnchorOffsetCollection":return Qr.parse(d.default)||null;case"projectionDefinition":return Dn.parse(d.default)||null;default:return d.default===void 0?null:d.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=l}evaluateWithoutErrorHandling(e,r,l,d,f,m){return this._globalState&&(e=sa(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(e,r,l,d,f,m){this._globalState&&(e=sa(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Nn(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Na(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in za}function Pl(i,e,r){const l=new Ss(za,Dc,[],e?(function(f){const m={color:Cr,string:Rt,number:lt,enum:Rt,boolean:Ut,formatted:ci,padding:Li,numberArray:Zi,colorArray:Kr,projectionDefinition:Di,resolvedImage:ls,variableAnchorOffsetCollection:zi};return f.type==="array"?br(m[f.value]||Dt,f.length):m[f.type]})(e):void 0),d=l.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Hd(new oh(d,e,r)):Oa(l.errors)}class Fc{constructor(e,r,l){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Sl(r.expression),this.globalStateRefs=Ao(r.expression),this._globalState=l}evaluateWithoutErrorHandling(e,r,l,d,f,m){return this._globalState&&(e=sa(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,l,d,f,m)}evaluate(e,r,l,d,f,m){return this._globalState&&(e=sa(e,this._globalState)),this._styleExpression.evaluate(e,r,l,d,f,m)}}class ah{constructor(e,r,l,d,f){this.kind=e,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Sl(r.expression),this.globalStateRefs=Ao(r.expression),this.interpolationType=d,this._globalState=f}evaluateWithoutErrorHandling(e,r,l,d,f,m){return this._globalState&&(e=sa(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,r,l,d,f,m)}evaluate(e,r,l,d,f,m){return this._globalState&&(e=sa(e,this._globalState)),this._styleExpression.evaluate(e,r,l,d,f,m)}interpolationFactor(e,r,l){return this.interpolationType?Jr.interpolationFactor(this.interpolationType,e,r,l):0}}function lh(i,e,r){const l=Pl(i,e,r);if(l.result==="error")return l;const d=l.value.expression,f=Lc(d);if(!f&&!Fa(e))return Oa([new Jn("","data expressions not supported")]);const m=zc(d,["zoom"]);if(!m&&!Wd(e))return Oa([new Jn("","zoom expressions not supported")]);const v=Vc(d);return v||m?v instanceof Jn?Oa([v]):v instanceof Jr&&!sh(e)?Oa([new Jn("",'"interpolate" expressions cannot be used with this property')]):Hd(v?new ah(f?"camera":"composite",l.value,v.labels,v instanceof Jr?v.interpolation:void 0,r):new Fc(f?"constant":"source",l.value,r)):Oa([new Jn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Nc{constructor(e,r){this._parameters=e,this._specification=r,$n(this,Zd(this._parameters,this._specification))}static deserialize(e){return new Nc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Vc(i){let e=null;if(i instanceof Gn)e=Vc(i.result);else if(i instanceof Hs){for(const r of i.args)if(e=Vc(r),e)break}else(i instanceof ms||i instanceof Jr)&&i.input instanceof gs&&i.input.name==="zoom"&&(e=i);return e instanceof Jn||i.eachChild((r=>{const l=Vc(r);l instanceof Jn?e=l:!e&&l?e=new Jn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Jn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Ao(i,e=new Set){return i instanceof Il&&e.add(i.key),i.eachChild((r=>{Ao(r,e)})),e}function sa(i,e){const{zoom:r,heatmapDensity:l,elevation:d,lineProgress:f,isSupportedScript:m,accumulated:v}=i??{};return{zoom:r,heatmapDensity:l,elevation:d,lineProgress:f,isSupportedScript:m,accumulated:v,globalState:e}}function ch(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ch(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const bm={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Cl(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ch(i)||(i=Ml(i));const r=Pl(i,bm,e);if(r.result==="error")throw new Error(r.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,d,f)=>r.value.evaluate(l,d,{},f),needGeometry:Xd(i),getGlobalStateRefs:()=>Ao(r.value.expression)}}function wm(i,e){return i<e?-1:i>e?1:0}function Xd(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(Xd(i[e]))return!0;return!1}function Ml(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Bc(i[1],i[2],"=="):e==="!="?kl(Bc(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Bc(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Ml))):e==="all"?["all"].concat(i.slice(1).map(Ml)):e==="none"?["all"].concat(i.slice(1).map(Ml).map(kl)):e==="in"?Yd(i[1],i.slice(2)):e==="!in"?kl(Yd(i[1],i.slice(2))):e==="has"?Qd(i[1]):e!=="!has"||kl(Qd(i[1]));var r}function Bc(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Yd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((r=>typeof r!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(wm)]]:["filter-in-small",i,["literal",e]]}}function Qd(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function kl(i){return["!",i]}function Uc(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let d="[";for(const f of i)d+=`${Uc(f)},`;return`${d}]`}const r=Object.keys(i).sort();let l="{";for(let d=0;d<r.length;d++)l+=`${JSON.stringify(r[d])}:${Uc(i[r[d]])},`;return`${l}}`}function Jd(i){let e="";for(const r of rn)e+=`/${Uc(i[r])}`;return e}function ep(i){const e=i.value;return e?[new Ue(i.key,e,"constants have been deprecated as of v8")]:[]}function kr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function oa(i){if(Array.isArray(i))return i.map(oa);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=oa(i[r]);return e}return kr(i)}function ts(i){const e=i.key,r=i.value,l=i.valueSpec||{},d=i.objectElementValidators||{},f=i.style,m=i.styleSpec,v=i.validateSpec;let T=[];const S=Tn(r);if(S!=="object")return[new Ue(e,r,`object expected, ${S} found`)];for(const P in r){const M=P.split(".")[0],D=Xi(l,M)||l["*"];let z;if(Xi(d,M))z=d[M];else if(Xi(l,M)){if(r[P]===void 0)continue;z=v}else if(d["*"])z=d["*"];else{if(!l["*"]){T.push(new Ue(e,r[P],`unknown property "${P}"`));continue}z=v}T=T.concat(z({key:(e&&`${e}.`)+P,value:r[P],valueSpec:D,style:f,styleSpec:m,object:r,objectKey:P,validateSpec:v},r))}for(const P in l)d[P]||l[P].required&&l[P].default===void 0&&r[P]===void 0&&T.push(new Ue(e,r,`missing required property "${P}"`));return T}function jc(i){const e=i.value,r=i.valueSpec,l=i.style,d=i.styleSpec,f=i.key,m=i.arrayElementValidator||i.validateSpec;if(Tn(e)!=="array")return[new Ue(f,e,`array expected, ${Tn(e)} found`)];if(r.length&&e.length!==r.length)return[new Ue(f,e,`array length ${r.length} expected, length ${e.length} found`)];let v={type:r.value,values:r.values};d.$version<7&&(v.function=r.function),Tn(r.value)==="object"&&(v=r.value);let T=[];for(let S=0;S<e.length;S++)T=T.concat(m({array:e,arrayIndex:S,value:e[S],valueSpec:v,validateSpec:i.validateSpec,style:l,styleSpec:d,key:`${f}[${S}]`}));return T}function Rl(i){const e=i.key,r=i.value,l=i.valueSpec;let d=Tn(r);return d==="number"&&r!=r&&(d="NaN"),d!=="number"?[new Ue(e,r,`number expected, ${d} found`)]:"minimum"in l&&r<l.minimum?[new Ue(e,r,`${r} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&r>l.maximum?[new Ue(e,r,`${r} is greater than the maximum value ${l.maximum}`)]:[]}function $c(i){const e=i.valueSpec,r=kr(i.value.type);let l,d,f,m={};const v=r!=="categorical"&&i.value.property===void 0,T=!v,S=Tn(i.value.stops)==="array"&&Tn(i.value.stops[0])==="array"&&Tn(i.value.stops[0][0])==="object",P=ts({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if(r==="identity")return[new Ue(z.key,z.value,'identity function may not have a "stops" property')];let B=[];const j=z.value;return B=B.concat(jc({key:z.key,value:j,valueSpec:z.valueSpec,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:M})),Tn(j)==="array"&&j.length===0&&B.push(new Ue(z.key,j,"array must have at least one stop")),B},default:function(z){return z.validateSpec({key:z.key,value:z.value,valueSpec:e,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec})}}});return r==="identity"&&v&&P.push(new Ue(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||P.push(new Ue(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!sh(i.valueSpec)&&P.push(new Ue(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(T&&!Fa(i.valueSpec)?P.push(new Ue(i.key,i.value,"property functions not supported")):v&&!Wd(i.valueSpec)&&P.push(new Ue(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!S||i.value.property!==void 0||P.push(new Ue(i.key,i.value,'"property" property is required')),P;function M(z){let B=[];const j=z.value,G=z.key;if(Tn(j)!=="array")return[new Ue(G,j,`array expected, ${Tn(j)} found`)];if(j.length!==2)return[new Ue(G,j,`array length 2 expected, length ${j.length} found`)];if(S){if(Tn(j[0])!=="object")return[new Ue(G,j,`object expected, ${Tn(j[0])} found`)];if(j[0].zoom===void 0)return[new Ue(G,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new Ue(G,j,"object stop key must have value")];if(f&&f>kr(j[0].zoom))return[new Ue(G,j[0].zoom,"stop zoom values must appear in ascending order")];kr(j[0].zoom)!==f&&(f=kr(j[0].zoom),d=void 0,m={}),B=B.concat(ts({key:`${G}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Rl,value:D}}))}else B=B.concat(D({key:`${G}[0]`,value:j[0],validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec},j));return Na(oa(j[1]))?B.concat([new Ue(`${G}[1]`,j[1],"expressions are not allowed in function stops.")]):B.concat(z.validateSpec({key:`${G}[1]`,value:j[1],valueSpec:e,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec}))}function D(z,B){const j=Tn(z.value),G=kr(z.value),K=z.value!==null?z.value:B;if(l){if(j!==l)return[new Ue(z.key,K,`${j} stop domain type must match previous stop domain type ${l}`)]}else l=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new Ue(z.key,K,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&r!=="categorical"){let ce=`number expected, ${j} found`;return Fa(e)&&r===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(z.key,K,ce)]}return r!=="categorical"||j!=="number"||isFinite(G)&&Math.floor(G)===G?r!=="categorical"&&j==="number"&&d!==void 0&&G<d?[new Ue(z.key,K,"stop domain values must appear in ascending order")]:(d=G,r==="categorical"&&G in m?[new Ue(z.key,K,"stop domain values must be unique")]:(m[G]=!0,[])):[new Ue(z.key,K,`integer expected, found ${G}`)]}}function Po(i){const e=(i.expressionContext==="property"?lh:Pl)(oa(i.value),i.valueSpec);if(e.result==="error")return e.value.map((l=>new Ue(`${i.key}${l.key}`,i.value,l.message)));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ue(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Sl(r))return[new Ue(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Sl(r))return[new Ue(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!zc(r,["zoom","feature-state"]))return[new Ue(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Lc(r))return[new Ue(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Dl(i){const e=i.key,r=i.value,l=Tn(r);return l!=="string"?[new Ue(e,r,`color expected, ${l} found`)]:fn.parse(String(r))?[]:[new Ue(e,r,`color expected, "${r}" found`)]}function aa(i){const e=i.key,r=i.value,l=i.valueSpec,d=[];return Array.isArray(l.values)?l.values.indexOf(kr(r))===-1&&d.push(new Ue(e,r,`expected one of [${l.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(l.values).indexOf(kr(r))===-1&&d.push(new Ue(e,r,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(r)} found`)),d}function Va(i){return ch(oa(i.value))?Po($n({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):tp(i)}function tp(i){const e=i.value,r=i.key;if(Tn(e)!=="array")return[new Ue(r,e,`array expected, ${Tn(e)} found`)];const l=i.styleSpec;let d,f=[];if(e.length<1)return[new Ue(r,e,"filter array must have at least 1 element")];switch(f=f.concat(aa({key:`${r}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),kr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&kr(e[1])==="$type"&&f.push(new Ue(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new Ue(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=Tn(e[1]),d!=="string"&&f.push(new Ue(`${r}[1]`,e[1],`string expected, ${d} found`)));for(let m=2;m<e.length;m++)d=Tn(e[m]),kr(e[1])==="$type"?f=f.concat(aa({key:`${r}[${m}]`,value:e[m],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&f.push(new Ue(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(tp({key:`${r}[${m}]`,value:e[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=Tn(e[1]),e.length!==2?f.push(new Ue(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&f.push(new Ue(`${r}[1]`,e[1],`string expected, ${d} found`))}return f}function np(i,e){const r=i.key,l=i.validateSpec,d=i.style,f=i.styleSpec,m=i.value,v=i.objectKey,T=f[`${e}_${i.layerType}`];if(!T)return[];const S=v.match(/^(.*)-transition$/);if(e==="paint"&&S&&T[S[1]]&&T[S[1]].transition)return l({key:r,value:m,valueSpec:f.transition,style:d,styleSpec:f});const P=i.valueSpec||T[v];if(!P)return[new Ue(r,m,`unknown property "${v}"`)];let M;if(Tn(m)==="string"&&Fa(P)&&!P.tokens&&(M=/^{([^}]+)}$/.exec(m)))return[new Ue(r,m,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&v==="text-font"&&Oc(oa(m))&&kr(m.type)==="identity"&&D.push(new Ue(r,m,'"text-font" does not support identity functions')),D.concat(l({key:i.key,value:m,valueSpec:P,style:d,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:v}))}function rp(i){return np(i,"paint")}function ip(i){return np(i,"layout")}function sp(i){let e=[];const r=i.value,l=i.key,d=i.style,f=i.styleSpec;if(Tn(r)!=="object")return[new Ue(l,r,`object expected, ${Tn(r)} found`)];r.type||r.ref||e.push(new Ue(l,r,'either "type" or "ref" is required'));let m=kr(r.type);const v=kr(r.ref);if(r.id){const T=kr(r.id);for(let S=0;S<i.arrayIndex;S++){const P=d.layers[S];kr(P.id)===T&&e.push(new Ue(l,r.id,`duplicate layer id "${r.id}", previously used at line ${P.id.__line__}`))}}if("ref"in r){let T;["type","source","source-layer","filter","layout"].forEach((S=>{S in r&&e.push(new Ue(l,r[S],`"${S}" is prohibited for ref layers`))})),d.layers.forEach((S=>{kr(S.id)===v&&(T=S)})),T?T.ref?e.push(new Ue(l,r.ref,"ref cannot reference another ref layer")):m=kr(T.type):e.push(new Ue(l,r.ref,`ref layer "${v}" not found`))}else if(m!=="background")if(r.source){const T=d.sources&&d.sources[r.source],S=T&&kr(T.type);T?S==="vector"&&m==="raster"?e.push(new Ue(l,r.source,`layer "${r.id}" requires a raster source`)):S!=="raster-dem"&&m==="hillshade"||S!=="raster-dem"&&m==="color-relief"?e.push(new Ue(l,r.source,`layer "${r.id}" requires a raster-dem source`)):S==="raster"&&m!=="raster"?e.push(new Ue(l,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&m!=="hillshade"&&m!=="color-relief"?e.push(new Ue(l,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||S==="geojson"&&T.lineMetrics||e.push(new Ue(l,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ue(l,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ue(l,r.source,`source "${r.source}" not found`))}else e.push(new Ue(l,r,'missing required property "source"'));return e=e.concat(ts({key:l,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Va,layout:T=>ts({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":S=>ip($n({layerType:m},S))}}),paint:T=>ts({layer:r,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":S=>rp($n({layerType:m},S))}})}})),e}function Co(i){const e=i.value,r=i.key,l=Tn(e);return l!=="string"?[new Ue(r,e,`string expected, ${l} found`)]:[]}const uh={promoteId:function({key:i,value:e}){if(Tn(e)==="string")return Co({key:i,value:e});{const r=[];for(const l in e)r.push(...Co({key:`${i}.${l}`,value:e[l]}));return r}}};function hh(i){const e=i.value,r=i.key,l=i.styleSpec,d=i.style,f=i.validateSpec;if(!e.type)return[new Ue(r,e,'"type" is required')];const m=kr(e.type);let v;switch(m){case"vector":case"raster":return v=ts({key:r,value:e,valueSpec:l[`source_${m.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:uh,validateSpec:f}),v;case"raster-dem":return v=(function(T){var S;const P=(S=T.sourceName)!==null&&S!==void 0?S:"",M=T.value,D=T.styleSpec,z=D.source_raster_dem,B=T.style;let j=[];const G=Tn(M);if(M===void 0)return j;if(G!=="object")return j.push(new Ue("source_raster_dem",M,`object expected, ${G} found`)),j;const K=kr(M.encoding)==="custom",ce=["redFactor","greenFactor","blueFactor","baseShift"],Q=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const ee in M)!K&&ce.includes(ee)?j.push(new Ue(ee,M[ee],`In "${P}": "${ee}" is only valid when "encoding" is set to "custom". ${Q} encoding found`)):z[ee]?j=j.concat(T.validateSpec({key:ee,value:M[ee],valueSpec:z[ee],validateSpec:T.validateSpec,style:B,styleSpec:D})):j.push(new Ue(ee,M[ee],`unknown property "${ee}"`));return j})({sourceName:r,value:e,style:i.style,styleSpec:l,validateSpec:f}),v;case"geojson":if(v=ts({key:r,value:e,valueSpec:l.source_geojson,style:d,styleSpec:l,validateSpec:f,objectElementValidators:uh}),e.cluster)for(const T in e.clusterProperties){const[S,P]=e.clusterProperties[T],M=typeof S=="string"?[S,["accumulated"],["get",T]]:S;v.push(...Po({key:`${r}.${T}.map`,value:P,expressionContext:"cluster-map"})),v.push(...Po({key:`${r}.${T}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return v;case"video":return ts({key:r,value:e,valueSpec:l.source_video,style:d,validateSpec:f,styleSpec:l});case"image":return ts({key:r,value:e,valueSpec:l.source_image,style:d,validateSpec:f,styleSpec:l});case"canvas":return[new Ue(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return aa({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ll(i){const e=i.value,r=i.styleSpec,l=r.light,d=i.style;let f=[];const m=Tn(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new Ue("light",e,`object expected, ${m} found`)]),f;for(const v in e){const T=v.match(/^(.*)-transition$/);f=f.concat(T&&l[T[1]]&&l[T[1]].transition?i.validateSpec({key:v,value:e[v],valueSpec:r.transition,validateSpec:i.validateSpec,style:d,styleSpec:r}):l[v]?i.validateSpec({key:v,value:e[v],valueSpec:l[v],validateSpec:i.validateSpec,style:d,styleSpec:r}):[new Ue(v,e[v],`unknown property "${v}"`)])}return f}function op(i){const e=i.value,r=i.styleSpec,l=r.sky,d=i.style,f=Tn(e);if(e===void 0)return[];if(f!=="object")return[new Ue("sky",e,`object expected, ${f} found`)];let m=[];for(const v in e)m=m.concat(l[v]?i.validateSpec({key:v,value:e[v],valueSpec:l[v],style:d,styleSpec:r}):[new Ue(v,e[v],`unknown property "${v}"`)]);return m}function dh(i){const e=i.value,r=i.styleSpec,l=r.terrain,d=i.style;let f=[];const m=Tn(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new Ue("terrain",e,`object expected, ${m} found`)]),f;for(const v in e)f=f.concat(l[v]?i.validateSpec({key:v,value:e[v],valueSpec:l[v],validateSpec:i.validateSpec,style:d,styleSpec:r}):[new Ue(v,e[v],`unknown property "${v}"`)]);return f}function ph(i){let e=[];const r=i.value,l=i.key;if(Array.isArray(r)){const d=[],f=[];for(const m in r)r[m].id&&d.includes(r[m].id)&&e.push(new Ue(l,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),d.push(r[m].id),r[m].url&&f.includes(r[m].url)&&e.push(new Ue(l,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),f.push(r[m].url),e=e.concat(ts({key:`${l}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Co({key:l,value:r})}function ap(i){return!!i&&i.constructor===Object}function fh(i){return ap(i.value)?[]:[new Ue(i.key,i.value,`object expected, ${Tn(i.value)} found`)]}const mh={"*":()=>[],array:jc,boolean:function(i){const e=i.value,r=i.key,l=Tn(e);return l!=="boolean"?[new Ue(r,e,`boolean expected, ${l} found`)]:[]},number:Rl,color:Dl,constants:ep,enum:aa,filter:Va,function:$c,layer:sp,object:ts,source:hh,light:Ll,sky:op,terrain:dh,projection:function(i){const e=i.value,r=i.styleSpec,l=r.projection,d=i.style,f=Tn(e);if(e===void 0)return[];if(f!=="object")return[new Ue("projection",e,`object expected, ${f} found`)];let m=[];for(const v in e)m=m.concat(l[v]?i.validateSpec({key:v,value:e[v],valueSpec:l[v],style:d,styleSpec:r}):[new Ue(v,e[v],`unknown property "${v}"`)]);return m},projectionDefinition:function(i){const e=i.key;let r=i.value;r=r instanceof String?r.valueOf():r;const l=Tn(r);return l!=="array"||(function(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"})(r)||(function(d){return!!["interpolate","step","literal"].includes(d[0])})(r)?["array","string"].includes(l)?[]:[new Ue(e,r,`projection expected, invalid type "${l}" found`)]:[new Ue(e,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Co,formatted:function(i){return Co(i).length===0?[]:Po(i)},resolvedImage:function(i){return Co(i).length===0?[]:Po(i)},padding:function(i){const e=i.key,r=i.value;if(Tn(r)==="array"){if(r.length<1||r.length>4)return[new Ue(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const l={type:"number"};let d=[];for(let f=0;f<r.length;f++)d=d.concat(i.validateSpec({key:`${e}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:l}));return d}return Rl({key:e,value:r,valueSpec:{}})},numberArray:function(i){const e=i.key,r=i.value;if(Tn(r)==="array"){const l={type:"number"};if(r.length<1)return[new Ue(e,r,"array length at least 1 expected, length 0 found")];let d=[];for(let f=0;f<r.length;f++)d=d.concat(i.validateSpec({key:`${e}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:l}));return d}return Rl({key:e,value:r,valueSpec:{}})},colorArray:function(i){const e=i.key,r=i.value;if(Tn(r)==="array"){if(r.length<1)return[new Ue(e,r,"array length at least 1 expected, length 0 found")];let l=[];for(let d=0;d<r.length;d++)l=l.concat(Dl({key:`${e}[${d}]`,value:r[d]}));return l}return Dl({key:e,value:r})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,l=Tn(r),d=i.styleSpec;if(l!=="array"||r.length<1||r.length%2!=0)return[new Ue(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<r.length;m+=2)f=f.concat(aa({key:`${e}[${m}]`,value:r[m],valueSpec:d.layout_symbol["text-anchor"]})),f=f.concat(jc({key:`${e}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:d}));return f},sprite:ph,state:fh,fontFaces:function(i){const e=i.key,r=i.value,l=i.validateSpec,d=i.styleSpec,f=i.style;if(!ap(r))return[new Ue(e,r,`object expected, ${Tn(r)} found`)];const m=[];for(const v in r){const T=r[v],S=Tn(T);if(S==="string")m.push(...Co({key:`${e}.${v}`,value:T}));else if(S==="array"){const P={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[M,D]of T.entries())m.push(...ts({key:`${e}.${v}[${M}]`,value:D,valueSpec:P,styleSpec:d,style:f,validateSpec:l}))}else m.push(new Ue(`${e}.${v}`,T,`string or array expected, ${S} found`))}return m}};function Mo(i){const e=i.value,r=i.valueSpec,l=i.styleSpec;return i.validateSpec=Mo,r.expression&&Oc(kr(e))?$c(i):r.expression&&Na(oa(e))?Po(i):r.type&&mh[r.type]?mh[r.type](i):ts($n({},i,{valueSpec:r.type?l[r.type]:r}))}function lp(i){const e=i.value,r=i.key,l=Co(i);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new Ue(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new Ue(r,e,'"glyphs" url must include a "{range}" token'))),l}function _s(i,e=Me){let r=[];return r=r.concat(Mo({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Mo,objectElementValidators:{glyphs:lp,"*":()=>[]}})),i.constants&&(r=r.concat(ep({key:"constants",value:i.constants}))),cp(r)}function Ps(i){return function(e){return i(Object.assign({},e,{validateSpec:Mo}))}}function cp(i){return[].concat(i).sort(((e,r)=>e.line-r.line))}function Cs(i){return function(...e){return cp(i.apply(this,e))}}_s.source=Cs(Ps(hh)),_s.sprite=Cs(Ps(ph)),_s.glyphs=Cs(Ps(lp)),_s.light=Cs(Ps(Ll)),_s.sky=Cs(Ps(op)),_s.terrain=Cs(Ps(dh)),_s.state=Cs(Ps(fh)),_s.layer=Cs(Ps(sp)),_s.filter=Cs(Ps(Va)),_s.paintProperty=Cs(Ps(rp)),_s.layoutProperty=Cs(Ps(ip));const Tm={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class zl{constructor(e,r){this._globalState=r,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const r=Pl(e,Tm,this._globalState);if(r.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(r.value.map((l=>`${l.key}: ${l.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=r.value,this._globalStateRefs=Ao(r.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Ol=Me,ei=_s,Fl=ei.light,up=ei.sky,Em=ei.paintProperty,Im=ei.layoutProperty;function Ba(i,e){let r=!1;if(e&&e.length)for(const l of e)i.fire(new kt(new Error(l.message))),r=!0;return r}class Ua{constructor(e,r,l){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const m=new Int32Array(this.arrayBuffer);e=m[0],this.d=(r=m[1])+2*(l=m[2]);for(let T=0;T<this.d*this.d;T++){const S=m[3+T],P=m[3+T+1];d.push(S===P?null:m.subarray(S,P))}const v=m[3+d.length+1];this.keys=m.subarray(m[3+d.length],v),this.bboxes=m.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*l;for(let m=0;m<this.d*this.d;m++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=l,this.scale=r/e,this.uid=0;const f=l/r*e;this.min=-f,this.max=e+f}insert(e,r,l,d,f){this._forEachCell(r,l,d,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,l,d,f,m){this.cells[f].push(m)}query(e,r,l,d,f){const m=this.min,v=this.max;if(e<=m&&r<=m&&v<=l&&v<=d&&!f)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,r,l,d,this._queryCell,T,{},f),T}}_queryCell(e,r,l,d,f,m,v,T){const S=this.cells[f];if(S!==null){const P=this.keys,M=this.bboxes;for(let D=0;D<S.length;D++){const z=S[D];if(v[z]===void 0){const B=4*z;(T?T(M[B+0],M[B+1],M[B+2],M[B+3]):e<=M[B+2]&&r<=M[B+3]&&l>=M[B+0]&&d>=M[B+1])?(v[z]=!0,m.push(P[z])):v[z]=!1}}}}_forEachCell(e,r,l,d,f,m,v,T){const S=this._convertToCellCoord(e),P=this._convertToCellCoord(r),M=this._convertToCellCoord(l),D=this._convertToCellCoord(d);for(let z=S;z<=M;z++)for(let B=P;B<=D;B++){const j=this.d*B+z;if((!T||T(this._convertFromCellCoord(z),this._convertFromCellCoord(B),this._convertFromCellCoord(z+1),this._convertFromCellCoord(B+1)))&&f.call(this,e,r,l,d,j,m,v,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let l=0;for(let m=0;m<this.cells.length;m++)l+=this.cells[m].length;const d=new Int32Array(r+l+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let f=r;for(let m=0;m<e.length;m++){const v=e[m];d[3+m]=f,d.set(v,f),f+=v.length}return d[3+e.length]=f,d.set(this.keys,f),f+=this.keys.length,d[3+e.length+1]=f,d.set(this.bboxes,f),f+=this.bboxes.length,d.buffer}static serialize(e,r){const l=e.toArrayBuffer();return r&&r.push(l),{buffer:l}}static deserialize(e){return new Ua(e.buffer)}}const Ms={};function bt(i,e,r={}){if(Ms[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Ms[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}bt("Object",Object),bt("Set",Set),bt("TransferableGridIndex",Ua),bt("Color",fn),bt("Error",Error),bt("AJAXError",we),bt("ResolvedImage",ui),bt("StylePropertyFunction",Nc),bt("StyleExpression",oh,{omit:["_evaluator"]}),bt("ZoomDependentExpression",ah),bt("ZoomConstantExpression",Fc),bt("CompoundExpression",gs,{omit:["_evaluate"]});for(const i in za)za[i]._classRegistryKey||bt(`Expression_${i}`,za[i]);function qc(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function gh(i){return i.$name||i.constructor._classRegistryKey}function ja(i){return!(function(e){if(e===null||typeof e!="object")return!1;const r=gh(e);return!(!r||r==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||qc(i)||Kt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Nl(i,e){if(ja(i))return(qc(i)||Kt(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const f=[];for(const m of i)f.push(Nl(m,e));return f}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=gh(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Ms[r])throw new Error(`${r} is not registered.`);const{klass:l}=Ms[r],d=l.serialize?l.serialize(i,e):{};if(l.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||Ms[r].omit.indexOf(f)>=0)continue;const m=i[f];d[f]=Ms[r].shallow.indexOf(f)>=0?m:Nl(m,e)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(d.$name=r),d}function Vl(i){if(ja(i))return i;if(Array.isArray(i))return i.map(Vl);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=gh(i)||"Object";if(!Ms[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Ms[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const l=Object.create(r.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const f=i[d];l[d]=Ms[e].shallow.indexOf(d)>=0?f:Vl(f)}return l}class _h{constructor(){this.first=!0}update(e,r){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}function Bl(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function yh(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function hp(i){return/\s/u.test(String.fromCodePoint(i))}function $a(i){for(const e of i)if(yh(e.codePointAt(0)))return!0;return!1}function Sm(i){for(const e of i)if(!dp(e.codePointAt(0)))return!1;return!0}function Gc(i){const e=i.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(e.join("|"),"u")}const Hc=Gc(["Arab","Dupl","Mong","Ougr","Syrc"]);function dp(i){return!Hc.test(String.fromCodePoint(i))}function vh(i){return!(yh(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const pp=Gc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function xh(i){return pp.test(String.fromCodePoint(i))}function bh(i,e){return!(!e&&xh(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function fp(i){for(const e of i)if(xh(e.codePointAt(0)))return!0;return!1}const ko=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(ko.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const r=i.pluginURL,l=new Promise((f=>{this.loadScriptResolve=f}));e(r);const d=new Promise((f=>setTimeout((()=>f()),this.TIMEOUT)));if(yield Promise.race([l,d]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:r};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class tr{constructor(e,r){this.isSupportedScript=Am,this.zoom=e,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new _h,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _h,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*r}}}function Am(i){return(function(e,r){for(const l of e)if(!bh(l.codePointAt(0),r))return!1;return!0})(i,ko.getRTLTextPluginStatus()==="loaded")}const Ul="-transition";class Wc{constructor(e,r,l){this.property=e,this.value=r,this.expression=(function(d,f,m){if(Oc(d))return new Nc(d,f);if(Na(d)){const v=lh(d,f,m);if(v.result==="error")throw new Error(v.value.map((T=>`${T.key}: ${T.message}`)).join(", "));return v.value}{let v=d;return f.type==="color"&&typeof d=="string"?v=fn.parse(d):f.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?f.type!=="numberArray"||typeof d!="number"&&!Array.isArray(d)?f.type!=="colorArray"||typeof d!="string"&&!Array.isArray(d)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(d)?v=Qr.parse(d):f.type==="projectionDefinition"&&typeof d=="string"&&(v=Dn.parse(d)):v=qt.parse(d):v=er.parse(d):v=jr.parse(d),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>v}}})(r===void 0?e.specification.default:r,e.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,r,l){return this.property.possiblyEvaluate(this,e,r,l)}}class Zc{constructor(e,r){this.property=e,this.value=new Wc(e,void 0,r)}transitioned(e,r){return new mp(this.property,this.value,r,Wt({},e.transition,this.transition),e.now)}untransitioned(){return new mp(this.property,this.value,null,{},0)}}class wh{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=r}getValue(e){return Sn(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Zc(this._values[e].property,this._globalState)),this._values[e].value=new Wc(this._values[e].property,r===null?void 0:Sn(r),this._globalState)}getTransition(e){return Sn(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Zc(this._values[e].property,this._globalState)),this._values[e].transition=Sn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l);const d=this.getTransition(r);d!==void 0&&(e[`${r}${Ul}`]=d)}return e}transitioned(e,r){const l=new gp(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].transitioned(e,r._values[d]);return l}untransitioned(){const e=new gp(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class mp{constructor(e,r,l,d,f){this.property=e,this.value=r,this.begin=f+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=l)}possiblyEvaluate(e,r,l){const d=e.now||0,f=this.value.possiblyEvaluate(e,r,l),m=this.prior;if(m){if(d>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(d<this.begin)return m.possiblyEvaluate(e,r,l);{const v=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,l),f,Qn(v))}}return f}}class gp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,l){const d=new jl(this._properties);for(const f of Object.keys(this._values))d._values[f]=this._values[f].possiblyEvaluate(e,r,l);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class _p{constructor(e,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=r}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Sn(this._values[e].value)}setValue(e,r){this._values[e]=new Wc(this._values[e].property,r===null?void 0:Sn(r),this._globalState)}serialize(){const e={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(e[r]=l)}return e}possiblyEvaluate(e,r,l){const d=new jl(this._properties);for(const f of Object.keys(this._values))d._values[f]=this._values[f].possiblyEvaluate(e,r,l);return d}}class ks{constructor(e,r,l){this.property=e,this.value=r,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,l,d){return this.property.evaluate(this.value,this.parameters,e,r,l,d)}}class jl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Pt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,l){const d=rr[this.specification.type];return d?d(e,r,l):e}}class Bt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,l,d){return new ks(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},l,d)}:e.expression,r)}interpolate(e,r,l){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new ks(this,{kind:"constant",value:void 0},e.parameters);const d=rr[this.specification.type];if(d){const f=d(e.value.value,r.value.value,l);return new ks(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,r,l,d,f,m){return e.kind==="constant"?e.value:e.evaluate(r,l,d,f,m)}}class $l extends Bt{possiblyEvaluate(e,r,l,d){if(e.value===void 0)return new ks(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},l,d),m=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,v=this._calculate(m,m,m,r);return new ks(this,{kind:"constant",value:v},r)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new ks(this,{kind:"constant",value:f},r)}return new ks(this,e.expression,r)}evaluate(e,r,l,d,f,m){if(e.kind==="source"){const v=e.evaluate(r,l,d,f,m);return this._calculate(v,v,v,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},l,d),e.evaluate({zoom:Math.floor(r.zoom)},l,d),e.evaluate({zoom:Math.floor(r.zoom)+1},l,d),r):e.value}_calculate(e,r,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:l,to:r}}interpolate(e){return e}}class Kc{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(r,null,{},l,d);return this._calculate(f,f,f,r)}return this._calculate(e.expression.evaluate(new tr(Math.floor(r.zoom-1),r)),e.expression.evaluate(new tr(Math.floor(r.zoom),r)),e.expression.evaluate(new tr(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:l,to:r}}interpolate(e){return e}}class Xc{constructor(e){this.specification=e}possiblyEvaluate(e,r,l,d){return!!e.expression.evaluate(r,null,{},l,d)}interpolate(){return!1}}class Ai{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const l=e[r];l.specification.overridable&&this.overridableProperties.push(r);const d=this.defaultPropertyValues[r]=new Wc(l,void 0,void 0),f=this.defaultTransitionablePropertyValues[r]=new Zc(l,void 0);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=d.possiblyEvaluate({})}}}bt("DataDrivenProperty",Bt),bt("DataConstantProperty",Pt),bt("CrossFadedDataDrivenProperty",$l),bt("CrossFadedProperty",Kc),bt("ColorRampProperty",Xc);class ys extends Ft{constructor(e,r,l){if(super(),this.id=e.id,this.type=e.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(d,f){return new zl(d,f)})(this.visibility,l),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Cl(e.filter,l)),r.layout&&(this._unevaluatedLayout=new _p(r.layout,l)),r.paint)){this._transitionablePaint=new wh(r.paint,l);for(const d in e.paint)this.setPaintProperty(d,e.paint[d],{validate:!1});for(const d in e.layout)this.setLayoutProperty(d,e.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jl(r.paint)}}setFilter(e){this.filter=e,this._featureFilter=Cl(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const r of this._visibilityExpression.getGlobalStateRefs())e.add(r);if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[r];for(const d of l.getGlobalStateRefs())e.add(d)}for(const r of this._featureFilter.getGlobalStateRefs())e.add(r);return e}getPaintAffectingGlobalStateRefs(){var e;const r=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const d=this._transitionablePaint._values[l].value;for(const f of d.getGlobalStateRefs()){const m=(e=r.get(f))!==null&&e!==void 0?e:[];m.push({name:l,value:d.value}),r.set(f,m)}}return r}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,r,l={}){if(r==null||!this._validate(Im,`layers.${this.id}.layout.${e}`,e,r,l))return e==="visibility"?(this.visibility=r,this._visibilityExpression.setValue(r),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,r)}getPaintProperty(e){return e.endsWith(Ul)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,l={}){if(r!=null&&this._validate(Em,`layers.${this.id}.paint.${e}`,e,r,l))return!1;if(e.endsWith(Ul))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const d=this._transitionablePaint._values[e],f=d.property.specification["property-type"]==="cross-faded-data-driven",m=d.value.isDataDriven(),v=d.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(e,v,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,l){return!1}isHidden(e=this.minzoom,r=!1){return!!(this.minzoom&&e<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ur(e,((r,l)=>!(r===void 0||l==="layout"&&!Object.keys(r).length||l==="paint"&&!Object.keys(r).length)))}_validate(e,r,l,d,f={}){return(!f||f.validate!==!1)&&Ba(this,e.call(ei,{key:r,layerType:this.type,objectKey:l,value:d,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof ks&&Fa(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let Th;var yp={get paint(){return Th=Th||new Ai({"raster-opacity":new Pt(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new Pt(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt(Me.paint_raster["raster-saturation"]),"raster-contrast":new Pt(Me.paint_raster["raster-contrast"]),"raster-resampling":new Pt(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt(Me.paint_raster["raster-fade-duration"])})}};class Pm extends ys{constructor(e,r){super(e,yp,r)}}const Cm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ql{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Rr(i,e=1){let r=0,l=0;return{members:i.map((d=>{const f=Cm[d.type].BYTES_PER_ELEMENT,m=r=la(r,Math.max(e,f)),v=d.components||1;return l=Math.max(l,f),r+=f*v,{name:d.name,type:d.type,components:v,offset:m}})),size:la(r,Math.max(l,e)),alignment:e}}function la(i,e){return Math.ceil(i/e)*e}class Gl extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const d=2*e;return this.int16[d+0]=r,this.int16[d+1]=l,e}}Gl.prototype.bytesPerElement=4,bt("StructArrayLayout2i4",Gl);class Yc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,l)}emplace(e,r,l,d){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=l,this.int16[f+2]=d,e}}Yc.prototype.bytesPerElement=6,bt("StructArrayLayout3i6",Yc);class Eh extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,d)}emplace(e,r,l,d,f){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=l,this.int16[m+2]=d,this.int16[m+3]=f,e}}Eh.prototype.bytesPerElement=8,bt("StructArrayLayout4i8",Eh);class Qc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,d,f,m)}emplace(e,r,l,d,f,m,v){const T=6*e;return this.int16[T+0]=r,this.int16[T+1]=l,this.int16[T+2]=d,this.int16[T+3]=f,this.int16[T+4]=m,this.int16[T+5]=v,e}}Qc.prototype.bytesPerElement=12,bt("StructArrayLayout2i4i12",Qc);class Ih extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,d,f,m)}emplace(e,r,l,d,f,m,v){const T=4*e,S=8*e;return this.int16[T+0]=r,this.int16[T+1]=l,this.uint8[S+4]=d,this.uint8[S+5]=f,this.uint8[S+6]=m,this.uint8[S+7]=v,e}}Ih.prototype.bytesPerElement=8,bt("StructArrayLayout2i4ub8",Ih);class Hl extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const d=2*e;return this.float32[d+0]=r,this.float32[d+1]=l,e}}Hl.prototype.bytesPerElement=8,bt("StructArrayLayout2f8",Hl);class oo extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m,v,T,S,P){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,l,d,f,m,v,T,S,P)}emplace(e,r,l,d,f,m,v,T,S,P,M){const D=10*e;return this.uint16[D+0]=r,this.uint16[D+1]=l,this.uint16[D+2]=d,this.uint16[D+3]=f,this.uint16[D+4]=m,this.uint16[D+5]=v,this.uint16[D+6]=T,this.uint16[D+7]=S,this.uint16[D+8]=P,this.uint16[D+9]=M,e}}oo.prototype.bytesPerElement=20,bt("StructArrayLayout10ui20",oo);class Jc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m,v,T){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,l,d,f,m,v,T)}emplace(e,r,l,d,f,m,v,T,S){const P=8*e;return this.uint16[P+0]=r,this.uint16[P+1]=l,this.uint16[P+2]=d,this.uint16[P+3]=f,this.uint16[P+4]=m,this.uint16[P+5]=v,this.uint16[P+6]=T,this.uint16[P+7]=S,e}}Jc.prototype.bytesPerElement=16,bt("StructArrayLayout8ui16",Jc);class Wl extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m,v,T,S,P,M,D){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,l,d,f,m,v,T,S,P,M,D)}emplace(e,r,l,d,f,m,v,T,S,P,M,D,z){const B=12*e;return this.int16[B+0]=r,this.int16[B+1]=l,this.int16[B+2]=d,this.int16[B+3]=f,this.uint16[B+4]=m,this.uint16[B+5]=v,this.uint16[B+6]=T,this.uint16[B+7]=S,this.int16[B+8]=P,this.int16[B+9]=M,this.int16[B+10]=D,this.int16[B+11]=z,e}}Wl.prototype.bytesPerElement=24,bt("StructArrayLayout4i4ui4i24",Wl);class eu extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,l)}emplace(e,r,l,d){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=l,this.float32[f+2]=d,e}}eu.prototype.bytesPerElement=12,bt("StructArrayLayout3f12",eu);class Zl extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Zl.prototype.bytesPerElement=4,bt("StructArrayLayout1ul4",Zl);class Sh extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m,v,T,S){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,l,d,f,m,v,T,S)}emplace(e,r,l,d,f,m,v,T,S,P){const M=10*e,D=5*e;return this.int16[M+0]=r,this.int16[M+1]=l,this.int16[M+2]=d,this.int16[M+3]=f,this.int16[M+4]=m,this.int16[M+5]=v,this.uint32[D+3]=T,this.uint16[M+8]=S,this.uint16[M+9]=P,e}}Sh.prototype.bytesPerElement=20,bt("StructArrayLayout6i1ul2ui20",Sh);class qa extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,d,f,m)}emplace(e,r,l,d,f,m,v){const T=6*e;return this.int16[T+0]=r,this.int16[T+1]=l,this.int16[T+2]=d,this.int16[T+3]=f,this.int16[T+4]=m,this.int16[T+5]=v,e}}qa.prototype.bytesPerElement=12,bt("StructArrayLayout2i2i2i12",qa);class ca extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,l,d,f)}emplace(e,r,l,d,f,m){const v=4*e,T=8*e;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=d,this.int16[T+6]=f,this.int16[T+7]=m,e}}ca.prototype.bytesPerElement=16,bt("StructArrayLayout2f1f2i16",ca);class Ah extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,l,d,f,m)}emplace(e,r,l,d,f,m,v){const T=16*e,S=4*e,P=8*e;return this.uint8[T+0]=r,this.uint8[T+1]=l,this.float32[S+1]=d,this.float32[S+2]=f,this.int16[P+6]=m,this.int16[P+7]=v,e}}Ah.prototype.bytesPerElement=16,bt("StructArrayLayout2ub2f2i16",Ah);class Kl extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,l)}emplace(e,r,l,d){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=l,this.uint16[f+2]=d,e}}Kl.prototype.bytesPerElement=6,bt("StructArrayLayout3ui6",Kl);class ua extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m,v,T,S,P,M,D,z,B,j,G,K){const ce=this.length;return this.resize(ce+1),this.emplace(ce,e,r,l,d,f,m,v,T,S,P,M,D,z,B,j,G,K)}emplace(e,r,l,d,f,m,v,T,S,P,M,D,z,B,j,G,K,ce){const Q=24*e,ee=12*e,pe=48*e;return this.int16[Q+0]=r,this.int16[Q+1]=l,this.uint16[Q+2]=d,this.uint16[Q+3]=f,this.uint32[ee+2]=m,this.uint32[ee+3]=v,this.uint32[ee+4]=T,this.uint16[Q+10]=S,this.uint16[Q+11]=P,this.uint16[Q+12]=M,this.float32[ee+7]=D,this.float32[ee+8]=z,this.uint8[pe+36]=B,this.uint8[pe+37]=j,this.uint8[pe+38]=G,this.uint32[ee+10]=K,this.int16[Q+22]=ce,e}}ua.prototype.bytesPerElement=48,bt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ua);class Ph extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,d,f,m,v,T,S,P,M,D,z,B,j,G,K,ce,Q,ee,pe,ye,Re,Xe,We,Je,ht,nt){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,r,l,d,f,m,v,T,S,P,M,D,z,B,j,G,K,ce,Q,ee,pe,ye,Re,Xe,We,Je,ht,nt)}emplace(e,r,l,d,f,m,v,T,S,P,M,D,z,B,j,G,K,ce,Q,ee,pe,ye,Re,Xe,We,Je,ht,nt,Ke){const Ne=32*e,vt=16*e;return this.int16[Ne+0]=r,this.int16[Ne+1]=l,this.int16[Ne+2]=d,this.int16[Ne+3]=f,this.int16[Ne+4]=m,this.int16[Ne+5]=v,this.int16[Ne+6]=T,this.int16[Ne+7]=S,this.uint16[Ne+8]=P,this.uint16[Ne+9]=M,this.uint16[Ne+10]=D,this.uint16[Ne+11]=z,this.uint16[Ne+12]=B,this.uint16[Ne+13]=j,this.uint16[Ne+14]=G,this.uint16[Ne+15]=K,this.uint16[Ne+16]=ce,this.uint16[Ne+17]=Q,this.uint16[Ne+18]=ee,this.uint16[Ne+19]=pe,this.uint16[Ne+20]=ye,this.uint16[Ne+21]=Re,this.uint16[Ne+22]=Xe,this.uint32[vt+12]=We,this.float32[vt+13]=Je,this.float32[vt+14]=ht,this.uint16[Ne+30]=nt,this.uint16[Ne+31]=Ke,e}}Ph.prototype.bytesPerElement=64,bt("StructArrayLayout8i15ui1ul2f2ui64",Ph);class tu extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}tu.prototype.bytesPerElement=4,bt("StructArrayLayout1f4",tu);class nu extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,l)}emplace(e,r,l,d){const f=3*e;return this.uint16[6*e+0]=r,this.float32[f+1]=l,this.float32[f+2]=d,e}}nu.prototype.bytesPerElement=12,bt("StructArrayLayout1ui2f12",nu);class Ch extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,l)}emplace(e,r,l,d){const f=4*e;return this.uint32[2*e+0]=r,this.uint16[f+2]=l,this.uint16[f+3]=d,e}}Ch.prototype.bytesPerElement=8,bt("StructArrayLayout1ul2ui8",Ch);class _ extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,r)}emplace(e,r,l){const d=2*e;return this.uint16[d+0]=r,this.uint16[d+1]=l,e}}_.prototype.bytesPerElement=4,bt("StructArrayLayout2ui4",_);class t extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}t.prototype.bytesPerElement=2,bt("StructArrayLayout1ui2",t);class s extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,l,d)}emplace(e,r,l,d,f){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=l,this.float32[m+2]=d,this.float32[m+3]=f,e}}s.prototype.bytesPerElement=16,bt("StructArrayLayout4f16",s);class u extends ql{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new k(this.anchorPointX,this.anchorPointY)}}u.prototype.size=20;class p extends Sh{get(e){return new u(this,e)}}bt("CollisionBoxArray",p);class y extends ql{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}y.prototype.size=48;class b extends ua{get(e){return new y(this,e)}}bt("PlacedSymbolArray",b);class I extends ql{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}I.prototype.size=64;class A extends Ph{get(e){return new I(this,e)}}bt("SymbolInstanceArray",A);class C extends tu{getoffsetX(e){return this.float32[1*e+0]}}bt("GlyphOffsetArray",C);class R extends Yc{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}bt("SymbolLineVertexArray",R);class N extends ql{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}N.prototype.size=12;class F extends nu{get(e){return new N(this,e)}}bt("TextAnchorOffsetArray",F);class q extends ql{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}q.prototype.size=8;class Z extends Ch{get(e){return new q(this,e)}}bt("FeatureIndexArray",Z);class te extends Gl{}class ie extends Gl{}class re extends Gl{}class ue extends Qc{}class ve extends Ih{}class le extends Hl{}class _e extends oo{}class Te extends Jc{}class me extends Wl{}class Ae extends eu{}class Ve extends Zl{}class Le extends qa{}class ze extends Ah{}class Oe extends Kl{}class ot extends _{}const ct=Rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:tt}=ct;class pt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,r,l,d){const f=this.segments[this.segments.length-1];return e>pt.MAX_VERTEX_ARRAY_LENGTH&&Vt(`Max vertices per segment is ${pt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${pt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+e>pt.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==d?this.createNewSegment(r,l,d):f}createNewSegment(e,r,l){const d={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(d.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(e,r,l){return this.prepareSegment(0,e,r,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,l,d){return new pt([{vertexOffset:e,primitiveOffset:r,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])}}function sn(i,e){return 256*(i=xt(Math.floor(i),0,255))+xt(Math.floor(e),0,255)}pt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bt("SegmentVector",pt);const Yn=Rr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),pr=Rr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var ir,_r,sr,Ir={exports:{}},yr={exports:{}},ti={exports:{}},Fr=(function(){if(sr)return Ir.exports;sr=1;var i=(ir||(ir=1,yr.exports=function(r,l){var d,f,m,v,T,S,P,M;for(f=r.length-(d=3&r.length),m=l,T=3432918353,S=461845907,M=0;M<f;)P=255&r.charCodeAt(M)|(255&r.charCodeAt(++M))<<8|(255&r.charCodeAt(++M))<<16|(255&r.charCodeAt(++M))<<24,++M,m=27492+(65535&(v=5*(65535&(m=(m^=P=(65535&(P=(P=(65535&P)*T+(((P>>>16)*T&65535)<<16)&4294967295)<<15|P>>>17))*S+(((P>>>16)*S&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(P=0,d){case 3:P^=(255&r.charCodeAt(M+2))<<16;case 2:P^=(255&r.charCodeAt(M+1))<<8;case 1:m^=P=(65535&(P=(P=(65535&(P^=255&r.charCodeAt(M)))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<15|P>>>17))*S+(((P>>>16)*S&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),yr.exports),e=(_r||(_r=1,ti.exports=function(r,l){for(var d,f=r.length,m=l^f,v=0;f>=4;)d=1540483477*(65535&(d=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(d>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:m^=(255&r.charCodeAt(v+2))<<16;case 2:m^=(255&r.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),ti.exports);return Ir.exports=i,Ir.exports.murmur3=i,Ir.exports.murmur2=e,Ir.exports})(),Dr=O(Fr);class di{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,l,d){this.ids.push(Ro(e)),this.positions.push(r,l,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ro(e);let l=0,d=this.ids.length-1;for(;l<d;){const m=l+d>>1;this.ids[m]>=r?d=m:l=m+1}const f=[];for(;this.ids[l]===r;)f.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return f}static serialize(e,r){const l=new Float64Array(e.ids),d=new Uint32Array(e.positions);return ao(l,d,0,l.length-1),r&&r.push(l.buffer,d.buffer),{ids:l,positions:d}}static deserialize(e){const r=new di;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Ro(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Dr(String(i))}function ao(i,e,r,l){for(;r<l;){const d=i[r+l>>1];let f=r-1,m=l+1;for(;;){do f++;while(i[f]<d);do m--;while(i[m]>d);if(f>=m)break;Ks(i,f,m),Ks(e,3*f,3*m),Ks(e,3*f+1,3*m+1),Ks(e,3*f+2,3*m+2)}m-r<l-m?(ao(i,e,r,m),r=m+1):(ao(i,e,m+1,l),l=m)}}function Ks(i,e,r){const l=i[e];i[e]=i[r],i[r]=l}bt("FeaturePositionMap",di);class Vi{constructor(e,r){this.gl=e.gl,this.location=r}}class ha extends Vi{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Xl extends Vi{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class da extends Vi{constructor(e,r){super(e,r),this.current=fn.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const vs=new Float32Array(16);function Xs(i){return[sn(255*i.r,255*i.g),sn(255*i.b,255*i.a)]}class Rs{constructor(e,r,l){this.value=e,this.uniformNames=r.map((d=>`u_${d}`)),this.type=l}setUniform(e,r,l){e.set(l.constantOr(this.value))}getBinding(e,r,l){return this.type==="color"?new da(e,r):new ha(e,r)}}class Ds{constructor(e,r){this.uniformNames=r.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,r){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(e,r,l,d){let f=null;d==="u_pattern_to"?f=this.patternTo:d==="u_pattern_from"?f=this.patternFrom:d==="u_dasharray_to"?f=this.dashTo:d==="u_dasharray_from"?f=this.dashFrom:d==="u_pixel_ratio_to"?f=this.pixelRatioTo:d==="u_pixel_ratio_from"&&(f=this.pixelRatioFrom),f!==null&&e.set(f)}getBinding(e,r,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new Xl(e,r):new ha(e,r)}}class lr{constructor(e,r,l,d){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map((f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(e,r,l){const d=this.paintVertexArray.length,f=this.expression.evaluate(new tr(0,l),r,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(d,e,f)}updatePaintArray(e,r,l,d,f){const m=this.expression.evaluate(new tr(0,f),l,d);this._setPaintValue(e,r,m)}_setPaintValue(e,r,l){if(this.type==="color"){const d=Xs(l);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class or{constructor(e,r,l,d,f,m){this.expression=e,this.uniformNames=r.map((v=>`u_${v}_t`)),this.type=l,this.useIntegerZoom=d,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map((v=>({name:`a_${v}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new m}populatePaintArray(e,r,l){const d=this.expression.evaluate(new tr(this.zoom,l),r,{},l.canonical,[],l.formattedSection),f=this.expression.evaluate(new tr(this.zoom+1,l),r,{},l.canonical,[],l.formattedSection),m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,d,f)}updatePaintArray(e,r,l,d,f){const m=this.expression.evaluate(new tr(this.zoom,f),l,d),v=this.expression.evaluate(new tr(this.zoom+1,f),l,d);this._setPaintValue(e,r,m,v)}_setPaintValue(e,r,l,d){if(this.type==="color"){const f=Xs(l),m=Xs(d);for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,f[0],f[1],m[0],m[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const l=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,d=xt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,r,l){return new ha(e,r)}}class Hr{constructor(e,r,l,d,f,m){this.expression=e,this.type=r,this.useIntegerZoom=l,this.zoom=d,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,r,l){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,this.getPositionIds(r),l)}updatePaintArray(e,r,l,d,f){this._setPaintValues(e,r,this.getPositionIds(l),f)}_setPaintValues(e,r,l,d){const f=this.getPositions(d);if(!f||!l)return;const m=f[l.min],v=f[l.mid],T=f[l.max];if(m&&v&&T)for(let S=e;S<r;S++)this.emplace(this.zoomInPaintVertexArray,S,v,m),this.emplace(this.zoomOutPaintVertexArray,S,v,T)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wr extends Hr{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Yn.members}emplace(e,r,l,d){e.emplace(r,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],d.tlbr[0],d.tlbr[1],d.tlbr[2],d.tlbr[3],l.pixelRatio,d.pixelRatio)}}class vp extends Hr{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return pr.members}emplace(e,r,l,d){e.emplace(r,0,l.y,l.height,l.width,0,d.y,d.height,d.width)}}class xp{constructor(e,r,l){this.binders={},this._buffers=[];const d=[];for(const f in e.paint._values){if(!l(f))continue;const m=e.paint.get(f);if(!(m instanceof ks&&Fa(m.property.specification)))continue;const v=Mm(f,e.type),T=m.value,S=m.property.specification.type,P=m.property.useIntegerZoom,M=m.property.specification["property-type"],D=M==="cross-faded"||M==="cross-faded-data-driven";if(T.kind==="constant")this.binders[f]=D?new Ds(T.value,v):new Rs(T.value,v,S),d.push(`/u_${f}`);else if(T.kind==="source"||D){const z=bp(f,S,"source");this.binders[f]=D?f==="line-dasharray"?new vp(T,S,P,r,z,e.id):new Wr(T,S,P,r,z,e.id):new lr(T,v,S,z),d.push(`/a_${f}`)}else{const z=bp(f,S,"composite");this.binders[f]=new or(T,v,S,P,r,z),d.push(`/z_${f}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof lr||r instanceof or?r.maxValue:0}populatePaintArrays(e,r,l){for(const d in this.binders){const f=this.binders[d];(f instanceof lr||f instanceof or||f instanceof Hr)&&f.populatePaintArray(e,r,l)}}setConstantPatternPositions(e,r){for(const l in this.binders){const d=this.binders[l];d instanceof Ds&&d.setConstantPatternPositions(e,r)}}setConstantDashPositions(e,r){for(const l in this.binders){const d=this.binders[l];d instanceof Ds&&d.setConstantDashPositions(e,r)}}updatePaintArrays(e,r,l,d,f){let m=!1;for(const v in e){const T=r.getPositions(v);for(const S of T){const P=l.feature(S.index);for(const M in this.binders){const D=this.binders[M];if((D instanceof lr||D instanceof or||D instanceof Hr)&&D.expression.isStateDependent===!0){const z=d.paint.get(M);D.expression=z.value,D.updatePaintArray(S.start,S.end,P,e[v],f),m=!0}}}}return m}defines(){const e=[];for(const r in this.binders){const l=this.binders[r];(l instanceof Rs||l instanceof Ds)&&e.push(...l.uniformNames.map((d=>`#define HAS_UNIFORM_${d}`)))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof lr||l instanceof or)for(let d=0;d<l.paintVertexAttributes.length;d++)e.push(l.paintVertexAttributes[d].name);else if(l instanceof Hr){const d=l.getVertexAttributes();for(const f of d)e.push(f.name)}}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof Rs||l instanceof Ds||l instanceof or)for(const d of l.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const l=[];for(const d in this.binders){const f=this.binders[d];if(f instanceof Rs||f instanceof Ds||f instanceof or){for(const m of f.uniformNames)if(r[m]){const v=f.getBinding(e,r[m],m);l.push({name:m,property:d,binding:v})}}}return l}setUniforms(e,r,l,d){for(const{name:f,property:m,binding:v}of r)this.binders[m].setUniform(v,d,l.get(m),f)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const l=this.binders[r];if(e&&l instanceof Hr){const d=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof lr||l instanceof or)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const r in this.binders){const l=this.binders[r];(l instanceof lr||l instanceof or||l instanceof Hr)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof lr||r instanceof or||r instanceof Hr)&&r.destroy()}}}class pa{constructor(e,r,l=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new xp(d,r,l);this.needsUpload=!1,this._featureMap=new di,this._bufferOffset=0}populatePaintArrays(e,r,l,d){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,r,d);r.id!==void 0&&this._featureMap.add(r.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,l,d){for(const f of l)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,r,f,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Mm(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function bp(i,e,r){const l={color:{source:Hl,composite:s},number:{source:tu,composite:Hl}},d=(function(f){return{"line-pattern":{source:_e,composite:_e},"fill-pattern":{source:_e,composite:_e},"fill-extrusion-pattern":{source:_e,composite:_e},"line-dasharray":{source:Te,composite:Te}}[f]})(i);return d&&d[r]||l[e][r]}bt("ConstantBinder",Rs),bt("CrossFadedConstantBinder",Ds),bt("SourceExpressionBinder",lr),bt("CrossFadedPatternBinder",Wr),bt("CrossFadedDasharrayBinder",vp),bt("CompositeExpressionBinder",or),bt("ProgramConfiguration",xp,{omit:["_buffers"]}),bt("ProgramConfigurationSet",pa);const Mh=Math.pow(2,14)-1,Do=-Mh-1;function Lo(i){const e=St/i.extent,r=i.loadGeometry();for(let l=0;l<r.length;l++){const d=r[l];for(let f=0;f<d.length;f++){const m=d[f],v=Math.round(m.x*e),T=Math.round(m.y*e);m.x=xt(v,Do,Mh),m.y=xt(T,Do,Mh),(v<m.x||v>m.x+1||T<m.y||T>m.y+1)&&Vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function zo(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Lo(i):[]}}const kh=-32768;function Rh(i,e,r,l,d){i.emplaceBack(kh+8*e+l,kh+8*r+d)}class ru{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ie,this.indexArray=new Oe,this.segments=new pt,this.programConfigurations=new pa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,l){const d=this.layers[0],f=[];let m=null,v=!1,T=d.type==="heatmap";if(d.type==="circle"){const P=d;m=P.layout.get("circle-sort-key"),v=!m.isConstant(),T=T||P.paint.get("circle-pitch-alignment")==="map"}const S=T?r.subdivisionGranularity.circle:1;for(const{feature:P,id:M,index:D,sourceLayerIndex:z}of e){const B=this.layers[0]._featureFilter.needGeometry,j=zo(P,B);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),j,l))continue;const G=v?m.evaluate(j,{},l):void 0,K={id:M,properties:P.properties,type:P.type,sourceLayerIndex:z,index:D,geometry:B?j.geometry:Lo(P),patterns:{},sortKey:G};f.push(K)}v&&f.sort(((P,M)=>P.sortKey-M.sortKey));for(const P of f){const{geometry:M,index:D,sourceLayerIndex:z}=P,B=e[D].feature;this.addFeature(P,M,D,l,S),r.featureIndex.insert(B,M,D,z,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,l,d,f=1){let m;switch(f){case 1:m=[0,7];break;case 3:m=[0,2,5,7];break;case 5:m=[0,1,3,4,6,7];break;case 7:m=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const v=m.length;for(const T of r)for(const S of T){const P=S.x,M=S.y;if(P<0||P>=St||M<0||M>=St)continue;const D=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,e.sortKey),z=D.vertexLength;for(let B=0;B<v;B++)for(let j=0;j<v;j++)Rh(this.layoutVertexArray,P,M,m[j],m[B]);for(let B=0;B<v-1;B++)for(let j=0;j<v-1;j++){const G=z+B*v+j,K=z+(B+1)*v+j;this.indexArray.emplaceBack(G,K+1,G+1),this.indexArray.emplaceBack(G,K,K+1)}D.vertexLength+=v*v,D.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:{},canonical:d})}}function iu(i,e){for(let r=0;r<i.length;r++)if(su(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(su(i,e[r]))return!0;return!!km(i,e)}function wp(i,e,r){return!!su(i,e)||!!Rm(e,i,r)}function Ay(i,e){if(i.length===1)return Cy(e,i[0]);for(let r=0;r<e.length;r++){const l=e[r];for(let d=0;d<l.length;d++)if(su(i,l[d]))return!0}for(let r=0;r<i.length;r++)if(Cy(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(km(i,e[r]))return!0;return!1}function IT(i,e,r){if(i.length>1){if(km(i,e))return!0;for(let l=0;l<e.length;l++)if(Rm(e[l],i,r))return!0}for(let l=0;l<i.length;l++)if(Rm(i[l],e,r))return!0;return!1}function km(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const l=i[r],d=i[r+1];for(let f=0;f<e.length-1;f++)if(ST(l,d,e[f],e[f+1]))return!0}return!1}function ST(i,e,r,l){return Jt(i,r,l)!==Jt(e,r,l)&&Jt(i,e,r)!==Jt(i,e,l)}function Rm(i,e,r){const l=r*r;if(e.length===1)return i.distSqr(e[0])<l;for(let d=1;d<e.length;d++)if(Py(i,e[d-1],e[d])<l)return!0;return!1}function Py(i,e,r){const l=e.distSqr(r);if(l===0)return i.distSqr(e);const d=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/l;return i.distSqr(d<0?e:d>1?r:r.sub(e)._mult(d)._add(e))}function Cy(i,e){let r,l,d,f=!1;for(let m=0;m<i.length;m++){r=i[m];for(let v=0,T=r.length-1;v<r.length;T=v++)l=r[v],d=r[T],l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(f=!f)}return f}function su(i,e){let r=!1;for(let l=0,d=i.length-1;l<i.length;d=l++){const f=i[l],m=i[d];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(r=!r)}return r}function AT(i,e,r){const l=r[0],d=r[2];if(i.x<l.x&&e.x<l.x||i.x>d.x&&e.x>d.x||i.y<l.y&&e.y<l.y||i.y>d.y&&e.y>d.y)return!1;const f=Jt(i,e,r[0]);return f!==Jt(i,e,r[1])||f!==Jt(i,e,r[2])||f!==Jt(i,e,r[3])}function ou(i,e,r){const l=e.paint.get(i).value;return l.kind==="constant"?l.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Tp(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ep(i,e,r,l,d){if(!e[0]&&!e[1])return i;const f=k.convert(e)._mult(d);r==="viewport"&&f._rotate(-l);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(f));return m}function PT(i){const e=[];for(let r=0;r<i.length;r++){const l=i[r],d=e.at(-1);(r===0||d&&!l.equals(d))&&e.push(l)}return e}function CT({queryGeometry:i,size:e},r){return wp(i,r,e)}function MT({queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:d},f){return wp(i,f,e*(r.projectTileCoordinates(f.x,f.y,l,d).signedDistanceFromCamera/r.cameraToCenterDistance))}function kT({queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:d},f){const m=r.projectTileCoordinates(f.x,f.y,l,d).signedDistanceFromCamera,v=e*(r.cameraToCenterDistance/m);return wp(i,Dm(f,r,l,d),v)}function RT({queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:d},f){return wp(i,Dm(f,r,l,d),e)}function My({queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:d,pitchAlignment:f="map",pitchScale:m="map"},v){const T=f==="map"?m==="map"?CT:MT:m==="map"?kT:RT,S={queryGeometry:i,size:e,transform:r,unwrappedTileID:l,getElevation:d};for(const P of v)for(const M of P)if(T(S,M))return!0;return!1}function Dm(i,e,r,l){const d=e.projectTileCoordinates(i.x,i.y,r,l).point;return new k((.5*d.x+.5)*e.width,(.5*-d.y+.5)*e.height)}let ky,Ry;bt("CircleBucket",ru,{omit:["layers"]});var DT={get paint(){return Ry=Ry||new Ai({"circle-radius":new Bt(Me.paint_circle["circle-radius"]),"circle-color":new Bt(Me.paint_circle["circle-color"]),"circle-blur":new Bt(Me.paint_circle["circle-blur"]),"circle-opacity":new Bt(Me.paint_circle["circle-opacity"]),"circle-translate":new Pt(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bt(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bt(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bt(Me.paint_circle["circle-stroke-opacity"])})},get layout(){return ky=ky||new Ai({"circle-sort-key":new Bt(Me.layout_circle["circle-sort-key"])})}};class LT extends ys{constructor(e,r){super(e,DT,r)}createBucket(e){return new ru(e)}queryRadius(e){const r=e;return ou("circle-radius",this,r)+ou("circle-stroke-width",this,r)+Tp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:l,geometry:d,transform:f,pixelsToTileUnits:m,unwrappedTileID:v,getElevation:T}){const S=Ep(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,m),P=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l),M=this.paint.get("circle-pitch-scale"),D=this.paint.get("circle-pitch-alignment");let z,B;return D==="map"?(z=S,B=P*m):(z=(function(j,G,K,ce){return j.map((Q=>Dm(Q,G,K,ce)))})(S,f,v,T),B=P),My({queryGeometry:z,size:B,transform:f,unwrappedTileID:v,getElevation:T,pitchAlignment:D,pitchScale:M},d)}}class Dy extends ru{}let Ly;bt("HeatmapBucket",Dy,{omit:["layers"]});var zT={get paint(){return Ly=Ly||new Ai({"heatmap-radius":new Bt(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bt(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xc(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt(Me.paint_heatmap["heatmap-opacity"])})}};function Lm(i,{width:e,height:r},l,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*r*l)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*r*l}`)}else d=new Uint8Array(e*r*l);return i.width=e,i.height=r,i.data=d,i}function zy(i,{width:e,height:r},l){if(e===i.width&&r===i.height)return;const d=Lm({},{width:e,height:r},l);zm(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},l),i.width=e,i.height=r,i.data=d.data}function zm(i,e,r,l,d,f){if(d.width===0||d.height===0)return e;if(d.width>i.width||d.height>i.height||r.x>i.width-d.width||r.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||l.x>e.width-d.width||l.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,v=e.data;if(m===v)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<d.height;T++){const S=((r.y+T)*i.width+r.x)*f,P=((l.y+T)*e.width+l.x)*f;for(let M=0;M<d.width*f;M++)v[P+M]=m[S+M]}return e}class Dh{constructor(e,r){Lm(this,e,1,r)}resize(e){zy(this,e,1)}clone(){return new Dh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,d,f){zm(e,r,l,d,f,1)}}class ns{constructor(e,r){Lm(this,e,4,r)}resize(e){zy(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ns({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,l,d,f){zm(e,r,l,d,f,4)}setPixel(e,r,l){const d=4*(e*this.width+r);this.data[d+0]=Math.round(255*l.r/l.a),this.data[d+1]=Math.round(255*l.g/l.a),this.data[d+2]=Math.round(255*l.b/l.a),this.data[d+3]=Math.round(255*l.a)}}function Oy(i){const e={},r=i.resolution||256,l=i.clips?i.clips.length:1,d=i.image||new ns({width:r,height:l});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(m,v,T)=>{e[i.evaluationKey]=T;const S=i.expression.evaluate(e);d.setPixel(m/4/r,v/4,S)};if(i.clips)for(let m=0,v=0;m<l;++m,v+=4*r)for(let T=0,S=0;T<r;T++,S+=4){const P=T/(r-1),{start:M,end:D}=i.clips[m];f(v,S,M*(1-P)+D*P)}else for(let m=0,v=0;m<r;m++,v+=4)f(0,v,m/(r-1));return d}bt("AlphaImage",Dh),bt("RGBAImage",ns);const Om="big-fb";class OT extends ys{createBucket(e){return new Dy(e)}constructor(e,r){super(e,zT,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Oy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Om)&&this.heatmapFbos.delete(Om)}queryRadius(e){return ou("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:l,geometry:d,transform:f,pixelsToTileUnits:m,unwrappedTileID:v,getElevation:T}){return My({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(r,l)*m,transform:f,unwrappedTileID:v,getElevation:T},d)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let Fy;var FT={get paint(){return Fy=Fy||new Ai({"hillshade-illumination-direction":new Pt(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Pt(Me.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Pt(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt(Me.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Pt(Me.paint_hillshade["hillshade-method"])})}};class NT extends ys{constructor(e,r){super(e,FT,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,d=this.paint.get("hillshade-shadow-color").values;const f=Math.max(e.length,r.length,l.length,d.length);e=e.concat(Array(f-e.length).fill(e.at(-1))),r=r.concat(Array(f-r.length).fill(r.at(-1))),l=l.concat(Array(f-l.length).fill(l.at(-1))),d=d.concat(Array(f-d.length).fill(d.at(-1)));const m=r.map(xn);return{directionRadians:e.map(xn),altitudeRadians:m,shadowColor:d,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Ny;var VT={get paint(){return Ny=Ny||new Ai({"color-relief-opacity":new Pt(Me["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Xc(Me["paint_color-relief"]["color-relief-color"])})}};class Fm{constructor(e,r,l,d){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(r,d)}update(e,r,l){const{width:d,height:f}=e,m=!(this.size&&this.size[0]===d&&this.size[1]===f||l),{context:v}=this,{gl:T}=v;if(this.useMipmap=!!(r&&r.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!r||r.premultiply!==!1)),m)this.size=[d,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Kt(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,d,f,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:S,y:P}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Kt(e)?T.texSubImage2D(T.TEXTURE_2D,0,S,P,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,S,P,d,f,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,r,l){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),l!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,l||e),this.filter=e),r!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Vy{constructor(e,r,l,d=1,f=1,m=1,v=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Vt(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const T=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=f,this.blueFactor=m,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<T;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(T,S)]=this.data[this._idx(T-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,T)]=this.data[this._idx(S,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<T;S++)for(let P=0;P<T;P++){const M=this.get(S,P);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(e,r){const l=new Uint8Array(this.data.buffer),d=4*this._idx(e,r);return this.unpack(l[d],l[d+1],l[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${r}, dim: ${this.dim}`);return(r+1)*this.stride+(e+1)}unpack(e,r,l){return e*this.redFactor+r*this.greenFactor+l*this.blueFactor-this.baseShift}pack(e){return By(e,this.getUnpackVector())}getPixels(){return new ns({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=r*this.dim,f=r*this.dim+this.dim,m=l*this.dim,v=l*this.dim+this.dim;switch(r){case-1:d=f-1;break;case 1:f=d+1}switch(l){case-1:m=v-1;break;case 1:v=m+1}const T=-r*this.dim,S=-l*this.dim;for(let P=m;P<v;P++)for(let M=d;M<f;M++)this.data[this._idx(M,P)]=e.data[this._idx(M+T,P+S)]}}function By(i,e){const r=e[0],l=e[1],d=e[2],f=e[3],m=Math.min(r,l,d),v=Math.round((i+f)/m);return{r:Math.floor(v*m/r)%256,g:Math.floor(v*m/l)%256,b:Math.floor(v*m/d)%256}}bt("DEMData",Vy);class BT extends ys{constructor(e,r){super(e,VT,r)}_createColorRamp(e){const r={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof Fc&&l._styleExpression.expression instanceof Jr){this.colorRampExpression=l;const m=l._styleExpression.expression;r.elevationStops=m.labels,r.colorStops=[];for(const v of r.elevationStops)r.colorStops.push(m.evaluate({globals:{elevation:v}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[fn.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=e)return r;const d={elevationStops:[],colorStops:[]},f=(r.elevationStops.length-1)/(e-1);for(let m=0;m<r.elevationStops.length-.5;m+=f)d.elevationStops.push(r.elevationStops[Math.round(m)]),d.colorStops.push(r.colorStops[Math.round(m)]);return Vt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${r.elevationStops.length}`),d}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,r,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const d=this._createColorRamp(r),f=new ns({width:d.colorStops.length,height:1}),m=new ns({width:d.colorStops.length,height:1});for(let v=0;v<d.elevationStops.length;v++){const T=By(d.elevationStops[v],l);m.setPixel(0,v,new fn(T.r/255,T.g/255,T.b/255,1)),f.setPixel(0,v,d.colorStops[v])}return this.colorRampTextures={elevationTexture:new Fm(e,m,e.gl.RGBA),colorTexture:new Fm(e,f,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const UT=Rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:jT}=UT;function Ip(i,e,r){const l=r.patternDependencies;let d=!1;for(const f of e){const m=f.paint.get(`${i}-pattern`);m.isConstant()||(d=!0);const v=m.constantOr(null);v&&(d=!0,l[v.to]=!0,l[v.from]=!0)}return d}function Nm(i,e,r,l,d){const{zoom:f}=l,m=d.patternDependencies;for(const v of e){const T=v.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let S=T.evaluate({zoom:f-1},r,{},d.availableImages),P=T.evaluate({zoom:f},r,{},d.availableImages),M=T.evaluate({zoom:f+1},r,{},d.availableImages);S=S&&S.name?S.name:S,P=P&&P.name?P.name:P,M=M&&M.name?M.name:M,m[S]=!0,m[P]=!0,m[M]=!0,r.patterns[v.id]={min:S,mid:P,max:M}}}return r}function Uy(i,e,r,l,d){let f;if(d===(function(m,v,T,S){let P=0;for(let M=v,D=T-S;M<T;M+=S)P+=(m[D]-m[M])*(m[M+1]+m[D+1]),D=M;return P})(i,e,r,l)>0)for(let m=e;m<r;m+=l)f=Gy(m/l|0,i[m],i[m+1],f);else for(let m=r-l;m>=e;m-=l)f=Gy(m/l|0,i[m],i[m+1],f);return f&&au(f,f.next)&&(Fh(f),f=f.next),f}function Yl(i,e){if(!i)return i;e||(e=i);let r,l=i;do if(r=!1,l.steiner||!au(l,l.next)&&Nr(l.prev,l,l.next)!==0)l=l.next;else{if(Fh(l),l=e=l.prev,l===l.next)break;r=!0}while(r||l!==e);return e}function Lh(i,e,r,l,d,f,m){if(!i)return;!m&&f&&(function(T,S,P,M){let D=T;do D.z===0&&(D.z=Vm(D.x,D.y,S,P,M)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==T);D.prevZ.nextZ=null,D.prevZ=null,(function(z){let B,j=1;do{let G,K=z;z=null;let ce=null;for(B=0;K;){B++;let Q=K,ee=0;for(let ye=0;ye<j&&(ee++,Q=Q.nextZ,Q);ye++);let pe=j;for(;ee>0||pe>0&&Q;)ee!==0&&(pe===0||!Q||K.z<=Q.z)?(G=K,K=K.nextZ,ee--):(G=Q,Q=Q.nextZ,pe--),ce?ce.nextZ=G:z=G,G.prevZ=ce,ce=G;K=Q}ce.nextZ=null,j*=2}while(B>1)})(D)})(i,l,d,f);let v=i;for(;i.prev!==i.next;){const T=i.prev,S=i.next;if(f?qT(i,l,d,f):$T(i))e.push(T.i,i.i,S.i),Fh(i),i=S.next,v=S.next;else if((i=S)===v){m?m===1?Lh(i=GT(Yl(i),e),e,r,l,d,f,2):m===2&&HT(i,e,r,l,d,f):Lh(Yl(i),e,r,l,d,f,1);break}}}function $T(i){const e=i.prev,r=i,l=i.next;if(Nr(e,r,l)>=0)return!1;const d=e.x,f=r.x,m=l.x,v=e.y,T=r.y,S=l.y,P=Math.min(d,f,m),M=Math.min(v,T,S),D=Math.max(d,f,m),z=Math.max(v,T,S);let B=l.next;for(;B!==e;){if(B.x>=P&&B.x<=D&&B.y>=M&&B.y<=z&&zh(d,v,f,T,m,S,B.x,B.y)&&Nr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function qT(i,e,r,l){const d=i.prev,f=i,m=i.next;if(Nr(d,f,m)>=0)return!1;const v=d.x,T=f.x,S=m.x,P=d.y,M=f.y,D=m.y,z=Math.min(v,T,S),B=Math.min(P,M,D),j=Math.max(v,T,S),G=Math.max(P,M,D),K=Vm(z,B,e,r,l),ce=Vm(j,G,e,r,l);let Q=i.prevZ,ee=i.nextZ;for(;Q&&Q.z>=K&&ee&&ee.z<=ce;){if(Q.x>=z&&Q.x<=j&&Q.y>=B&&Q.y<=G&&Q!==d&&Q!==m&&zh(v,P,T,M,S,D,Q.x,Q.y)&&Nr(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,ee.x>=z&&ee.x<=j&&ee.y>=B&&ee.y<=G&&ee!==d&&ee!==m&&zh(v,P,T,M,S,D,ee.x,ee.y)&&Nr(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;Q&&Q.z>=K;){if(Q.x>=z&&Q.x<=j&&Q.y>=B&&Q.y<=G&&Q!==d&&Q!==m&&zh(v,P,T,M,S,D,Q.x,Q.y)&&Nr(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;ee&&ee.z<=ce;){if(ee.x>=z&&ee.x<=j&&ee.y>=B&&ee.y<=G&&ee!==d&&ee!==m&&zh(v,P,T,M,S,D,ee.x,ee.y)&&Nr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function GT(i,e){let r=i;do{const l=r.prev,d=r.next.next;!au(l,d)&&$y(l,r,r.next,d)&&Oh(l,d)&&Oh(d,l)&&(e.push(l.i,r.i,d.i),Fh(r),Fh(r.next),r=i=d),r=r.next}while(r!==i);return Yl(r)}function HT(i,e,r,l,d,f){let m=i;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&YT(m,v)){let T=qy(m,v);return m=Yl(m,m.next),T=Yl(T,T.next),Lh(m,e,r,l,d,f,0),void Lh(T,e,r,l,d,f,0)}v=v.next}m=m.next}while(m!==i)}function WT(i,e){let r=i.x-e.x;return r===0&&(r=i.y-e.y,r===0)&&(r=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function ZT(i,e){const r=(function(d,f){let m=f;const v=d.x,T=d.y;let S,P=-1/0;if(au(d,m))return m;do{if(au(d,m.next))return m.next;if(T<=m.y&&T>=m.next.y&&m.next.y!==m.y){const j=m.x+(T-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(j<=v&&j>P&&(P=j,S=m.x<m.next.x?m:m.next,j===v))return S}m=m.next}while(m!==f);if(!S)return null;const M=S,D=S.x,z=S.y;let B=1/0;m=S;do{if(v>=m.x&&m.x>=D&&v!==m.x&&jy(T<z?v:P,T,D,z,T<z?P:v,T,m.x,m.y)){const j=Math.abs(T-m.y)/(v-m.x);Oh(m,d)&&(j<B||j===B&&(m.x>S.x||m.x===S.x&&KT(S,m)))&&(S=m,B=j)}m=m.next}while(m!==M);return S})(i,e);if(!r)return e;const l=qy(r,i);return Yl(l,l.next),Yl(r,r.next)}function KT(i,e){return Nr(i.prev,i,e.prev)<0&&Nr(e.next,i,i.next)<0}function Vm(i,e,r,l,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function XT(i){let e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function jy(i,e,r,l,d,f,m,v){return(d-m)*(e-v)>=(i-m)*(f-v)&&(i-m)*(l-v)>=(r-m)*(e-v)&&(r-m)*(f-v)>=(d-m)*(l-v)}function zh(i,e,r,l,d,f,m,v){return!(i===m&&e===v)&&jy(i,e,r,l,d,f,m,v)}function YT(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(r,l){let d=r;do{if(d.i!==r.i&&d.next.i!==r.i&&d.i!==l.i&&d.next.i!==l.i&&$y(d,d.next,r,l))return!0;d=d.next}while(d!==r);return!1})(i,e)&&(Oh(i,e)&&Oh(e,i)&&(function(r,l){let d=r,f=!1;const m=(r.x+l.x)/2,v=(r.y+l.y)/2;do d.y>v!=d.next.y>v&&d.next.y!==d.y&&m<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(f=!f),d=d.next;while(d!==r);return f})(i,e)&&(Nr(i.prev,i,e.prev)||Nr(i,e.prev,e))||au(i,e)&&Nr(i.prev,i,i.next)>0&&Nr(e.prev,e,e.next)>0)}function Nr(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function au(i,e){return i.x===e.x&&i.y===e.y}function $y(i,e,r,l){const d=Ap(Nr(i,e,r)),f=Ap(Nr(i,e,l)),m=Ap(Nr(r,l,i)),v=Ap(Nr(r,l,e));return d!==f&&m!==v||!(d!==0||!Sp(i,r,e))||!(f!==0||!Sp(i,l,e))||!(m!==0||!Sp(r,i,l))||!(v!==0||!Sp(r,e,l))}function Sp(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Ap(i){return i>0?1:i<0?-1:0}function Oh(i,e){return Nr(i.prev,i,i.next)<0?Nr(i,e,i.next)>=0&&Nr(i,i.prev,e)>=0:Nr(i,e,i.prev)<0||Nr(i,i.next,e)<0}function qy(i,e){const r=Bm(i.i,i.x,i.y),l=Bm(e.i,e.x,e.y),d=i.next,f=e.prev;return i.next=e,e.prev=i,r.next=d,d.prev=r,l.next=r,r.prev=l,f.next=l,l.prev=f,l}function Gy(i,e,r,l){const d=Bm(i,e,r);return l?(d.next=l.next,d.prev=l,l.next.prev=d,l.next=d):(d.prev=d,d.next=d),d}function Fh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Bm(i,e,r){return{i,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class lu{constructor(e,r){if(r>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=r}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Pp{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Pp.noSubdivision=new Pp({fill:new lu(0,0),line:new lu(0,0),tile:new lu(0,0),stencil:new lu(0,0),circle:1}),bt("SubdivisionGranularityExpression",lu),bt("SubdivisionGranularitySetting",Pp);const cu=-32768,Nh=32767;class QT{constructor(e,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=St/e,this._canonical=r}_getKey(e,r){return(e+=32768)<<16|r+32768}_vertexToIndex(e,r){if(e<-32768||r<-32768||e>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(e),d=0|Math.round(r),f=this._getKey(l,d);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const m=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,m),this._vertexBuffer.push(l,d),m}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(d,f){const m=[];for(let v=0;v<f.length;v+=3){const T=f[v],S=f[v+1],P=f[v+2],M=d[2*T],D=d[2*T+1];(d[2*S]-M)*(d[2*P+1]-D)-(d[2*S+1]-D)*(d[2*P]-M)>0?(m.push(T),m.push(P),m.push(S)):(m.push(T),m.push(S),m.push(P))}return m})(this._vertexBuffer,e);const r=[],l=e.length;for(let d=0;d<l;d+=3){const f=[e[d+0],e[d+1],e[d+2]],m=[this._vertexBuffer[2*e[d+0]+0],this._vertexBuffer[2*e[d+0]+1],this._vertexBuffer[2*e[d+1]+0],this._vertexBuffer[2*e[d+1]+1],this._vertexBuffer[2*e[d+2]+0],this._vertexBuffer[2*e[d+2]+1]];let v=1/0,T=1/0,S=-1/0,P=-1/0;for(let j=0;j<3;j++){const G=m[2*j],K=m[2*j+1];v=Math.min(v,G),S=Math.max(S,G),T=Math.min(T,K),P=Math.max(P,K)}if(v===S||T===P)continue;const M=Math.floor(v/this._granularityCellSize),D=Math.ceil(S/this._granularityCellSize),z=Math.floor(T/this._granularityCellSize),B=Math.ceil(P/this._granularityCellSize);if(M!==D||z!==B)for(let j=z;j<B;j++){const G=this._scanlineGenerateVertexRingForCellRow(j,m,f);JT(this._vertexBuffer,G,r)}else r.push(...f)}return r}_scanlineGenerateVertexRingForCellRow(e,r,l){const d=e*this._granularityCellSize,f=d+this._granularityCellSize,m=[];for(let v=0;v<3;v++){const T=r[2*v],S=r[2*v+1],P=r[2*(v+1)%6],M=r[(2*(v+1)+1)%6],D=r[2*(v+2)%6],z=r[(2*(v+2)+1)%6],B=P-T,j=M-S,G=B===0,K=j===0,ce=(d-S)/j,Q=(f-S)/j,ee=Math.min(ce,Q),pe=Math.max(ce,Q);if(!K&&(ee>=1||pe<=0)||K&&(S<d||S>f)){M>=d&&M<=f&&m.push(l[(v+1)%3]);continue}!K&&ee>0&&m.push(this._vertexToIndex(T+B*ee,S+j*ee));const ye=T+B*Math.max(ee,0),Re=T+B*Math.min(pe,1);G||this._generateIntraEdgeVertices(m,T,S,P,M,ye,Re),!K&&pe<1&&m.push(this._vertexToIndex(T+B*pe,S+j*pe)),(K||M>=d&&M<=f)&&m.push(l[(v+1)%3]),!K&&(M<=d||M>=f)&&this._generateInterEdgeVertices(m,T,S,P,M,D,z,Re,d,f)}return m}_generateIntraEdgeVertices(e,r,l,d,f,m,v){const T=d-r,S=f-l,P=S===0,M=P?Math.min(r,d):Math.min(m,v),D=P?Math.max(r,d):Math.max(m,v),z=Math.floor(M/this._granularityCellSize)+1,B=Math.ceil(D/this._granularityCellSize)-1;if(P?r<d:m<v)for(let j=z;j<=B;j++){const G=j*this._granularityCellSize;e.push(this._vertexToIndex(G,l+S*(G-r)/T))}else for(let j=B;j>=z;j--){const G=j*this._granularityCellSize;e.push(this._vertexToIndex(G,l+S*(G-r)/T))}}_generateInterEdgeVertices(e,r,l,d,f,m,v,T,S,P){const M=f-l,D=m-d,z=v-f,B=(S-f)/z,j=(P-f)/z,G=Math.min(B,j),K=Math.max(B,j),ce=d+D*G;let Q=Math.floor(Math.min(ce,T)/this._granularityCellSize)+1,ee=Math.ceil(Math.max(ce,T)/this._granularityCellSize)-1,pe=T<ce;const ye=z===0;if(ye&&(v===S||v===P))return;if(ye||G>=1||K<=0){const Xe=l-v,We=m+(r-m)*Math.min((S-v)/Xe,(P-v)/Xe);Q=Math.floor(Math.min(We,T)/this._granularityCellSize)+1,ee=Math.ceil(Math.max(We,T)/this._granularityCellSize)-1,pe=T<We}const Re=M>0?P:S;if(pe)for(let Xe=Q;Xe<=ee;Xe++)e.push(this._vertexToIndex(Xe*this._granularityCellSize,Re));else for(let Xe=ee;Xe>=Q;Xe--)e.push(this._vertexToIndex(Xe*this._granularityCellSize,Re))}_generateOutline(e){const r=[];for(const l of e){const d=Ql(l,this._granularity,!0),f=this._pointArrayToIndices(d),m=[];for(let v=1;v<f.length;v++)m.push(f[v-1]),m.push(f[v]);r.push(m)}return r}_handlePoles(e){let r=!1,l=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(r||l)&&this._fillPoles(e,r,l)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let r=0;r<e.length;r+=2){const l=e[r+1];l===cu&&(e[r+1]=-32767),l===Nh&&(e[r+1]=32766)}}_generatePoleQuad(e,r,l,d,f,m){d>f!=(m===cu)?(e.push(r),e.push(l),e.push(this._vertexToIndex(d,m)),e.push(l),e.push(this._vertexToIndex(f,m)),e.push(this._vertexToIndex(d,m))):(e.push(l),e.push(r),e.push(this._vertexToIndex(d,m)),e.push(this._vertexToIndex(f,m)),e.push(l),e.push(this._vertexToIndex(d,m)))}_fillPoles(e,r,l){const d=this._vertexBuffer,f=St,m=e.length;for(let v=2;v<m;v+=3){const T=e[v-2],S=e[v-1],P=e[v],M=d[2*T],D=d[2*T+1],z=d[2*S],B=d[2*S+1],j=d[2*P],G=d[2*P+1];r&&(D===0&&B===0&&this._generatePoleQuad(e,T,S,M,z,cu),B===0&&G===0&&this._generatePoleQuad(e,S,P,z,j,cu),G===0&&D===0&&this._generatePoleQuad(e,P,T,j,M,cu)),l&&(D===f&&B===f&&this._generatePoleQuad(e,T,S,M,z,Nh),B===f&&G===f&&this._generatePoleQuad(e,S,P,z,j,Nh),G===f&&D===f&&this._generatePoleQuad(e,P,T,j,M,Nh))}}_initializeVertices(e){for(let r=0;r<e.length;r+=2)this._vertexToIndex(e[r],e[r+1])}subdividePolygonInternal(e,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:d}=(function(v){const T=[],S=[];for(const P of v)if(P.length!==0){P!==v[0]&&T.push(S.length/2);for(let M=0;M<P.length;M++)S.push(P[M].x),S.push(P[M].y)}return{flattened:S,holeIndices:T}})(e);let f;this._initializeVertices(l);try{const v=(function(S,P,M=2){const D=P&&P.length,z=D?P[0]*M:S.length;let B=Uy(S,0,z,M,!0);const j=[];if(!B||B.next===B.prev)return j;let G,K,ce;if(D&&(B=(function(Q,ee,pe,ye){const Re=[];for(let Xe=0,We=ee.length;Xe<We;Xe++){const Je=Uy(Q,ee[Xe]*ye,Xe<We-1?ee[Xe+1]*ye:Q.length,ye,!1);Je===Je.next&&(Je.steiner=!0),Re.push(XT(Je))}Re.sort(WT);for(let Xe=0;Xe<Re.length;Xe++)pe=ZT(Re[Xe],pe);return pe})(S,P,B,M)),S.length>80*M){G=S[0],K=S[1];let Q=G,ee=K;for(let pe=M;pe<z;pe+=M){const ye=S[pe],Re=S[pe+1];ye<G&&(G=ye),Re<K&&(K=Re),ye>Q&&(Q=ye),Re>ee&&(ee=Re)}ce=Math.max(Q-G,ee-K),ce=ce!==0?32767/ce:0}return Lh(B,j,M,G,K,ce,0),j})(l,d),T=this._convertIndices(l,v);f=this._subdivideTrianglesScanline(T)}catch(v){console.error(v)}let m=[];return r&&(m=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:m}}_convertIndices(e,r){const l=[];for(let d=0;d<r.length;d++)l.push(this._vertexToIndex(e[2*r[d]],e[2*r[d]+1]));return l}_pointArrayToIndices(e){const r=[];for(let l=0;l<e.length;l++){const d=e[l];r.push(this._vertexToIndex(d.x,d.y))}return r}}function Hy(i,e,r,l=!0){return new QT(r,e).subdividePolygonInternal(i,l)}function Ql(i,e,r=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const l=i[0],d=i[i.length-1],f=r&&(l.x!==d.x||l.y!==d.y);if(e<2)return f?[...i,i[0]]:[...i];const m=Math.floor(St/e),v=[];v.push(new k(i[0].x,i[0].y));const T=i.length,S=f?T:T-1;for(let P=0;P<S;P++){const M=i[P],D=P<T-1?i[P+1]:i[0],z=M.x,B=M.y,j=D.x,G=D.y,K=z!==j,ce=B!==G;if(!K&&!ce)continue;const Q=j-z,ee=G-B,pe=Math.abs(Q),ye=Math.abs(ee);let Re=z,Xe=B;for(;;){const Je=Q>0?(Math.floor(Re/m)+1)*m:(Math.ceil(Re/m)-1)*m,ht=ee>0?(Math.floor(Xe/m)+1)*m:(Math.ceil(Xe/m)-1)*m,nt=Math.abs(Re-Je),Ke=Math.abs(Xe-ht),Ne=Math.abs(Re-j),vt=Math.abs(Xe-G),yt=K?nt/pe:Number.POSITIVE_INFINITY,Tt=ce?Ke/ye:Number.POSITIVE_INFINITY;if((Ne<=nt||!K)&&(vt<=Ke||!ce))break;if(yt<Tt&&K||!ce){Re=Je,Xe+=ee*yt;const mt=new k(Re,Math.round(Xe));v[v.length-1].x===mt.x&&v[v.length-1].y===mt.y||v.push(mt)}else{Re+=Q*Tt,Xe=ht;const mt=new k(Math.round(Re),Xe);v[v.length-1].x===mt.x&&v[v.length-1].y===mt.y||v.push(mt)}}const We=new k(j,G);v[v.length-1].x===We.x&&v[v.length-1].y===We.y||v.push(We)}return v}function JT(i,e,r){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,d=i[2*e[0]];for(let T=1;T<e.length;T++){const S=i[2*e[T]];S<d&&(d=S,l=T)}const f=e.length;let m=l,v=(m+1)%f;for(;;){const T=m-1>=0?m-1:f-1,S=(v+1)%f,P=i[2*e[T]],M=i[2*e[S]],D=i[2*e[m]],z=i[2*e[m]+1],B=i[2*e[v]+1];let j=!1;if(P<M)j=!0;else if(P>M)j=!1;else{const G=B-z,K=-(i[2*e[v]]-D),ce=z<B?1:-1;((P-D)*G+(i[2*e[T]+1]-z)*K)*ce>((M-D)*G+(i[2*e[S]+1]-z)*K)*ce&&(j=!0)}if(j){const G=e[T],K=e[m],ce=e[v];G!==K&&G!==ce&&K!==ce&&r.push(ce,K,G),m--,m<0&&(m=f-1)}else{const G=e[S],K=e[m],ce=e[v];G!==K&&G!==ce&&K!==ce&&r.push(ce,K,G),v++,v>=f&&(v=0)}if(T===S)break}}function Wy(i,e,r,l,d,f,m,v,T){const S=d.length/2,P=m&&v&&T;if(S<pt.MAX_VERTEX_ARRAY_LENGTH){const M=e.prepareSegment(S,r,l),D=M.vertexLength;for(let j=0;j<f.length;j+=3)l.emplaceBack(D+f[j],D+f[j+1],D+f[j+2]);let z,B;M.vertexLength+=S,M.primitiveLength+=f.length/3,P&&(B=m.prepareSegment(S,r,v),z=B.vertexLength,B.vertexLength+=S);for(let j=0;j<d.length;j+=2)i(d[j],d[j+1]);if(P)for(let j=0;j<T.length;j++){const G=T[j];for(let K=1;K<G.length;K+=2)v.emplaceBack(z+G[K-1],z+G[K]);B.primitiveLength+=G.length/2}}else(function(M,D,z,B,j,G){const K=[];for(let ye=0;ye<B.length/2;ye++)K.push(-1);const ce={count:0};let Q=0,ee=M.getOrCreateLatestSegment(D,z),pe=ee.vertexLength;for(let ye=2;ye<j.length;ye+=3){const Re=j[ye-2],Xe=j[ye-1],We=j[ye];let Je=K[Re]<Q,ht=K[Xe]<Q,nt=K[We]<Q;ee.vertexLength+((Je?1:0)+(ht?1:0)+(nt?1:0))>pt.MAX_VERTEX_ARRAY_LENGTH&&(ee=M.createNewSegment(D,z),Q=ce.count,Je=!0,ht=!0,nt=!0,pe=0);const Ke=Vh(K,B,G,ce,Re,Je,ee),Ne=Vh(K,B,G,ce,Xe,ht,ee),vt=Vh(K,B,G,ce,We,nt,ee);z.emplaceBack(pe+Ke-Q,pe+Ne-Q,pe+vt-Q),ee.primitiveLength++}})(e,r,l,d,f,i),P&&(function(M,D,z,B,j,G){const K=[];for(let ye=0;ye<B.length/2;ye++)K.push(-1);const ce={count:0};let Q=0,ee=M.getOrCreateLatestSegment(D,z),pe=ee.vertexLength;for(let ye=0;ye<j.length;ye++){const Re=j[ye];for(let Xe=1;Xe<j[ye].length;Xe+=2){const We=Re[Xe-1],Je=Re[Xe];let ht=K[We]<Q,nt=K[Je]<Q;ee.vertexLength+((ht?1:0)+(nt?1:0))>pt.MAX_VERTEX_ARRAY_LENGTH&&(ee=M.createNewSegment(D,z),Q=ce.count,ht=!0,nt=!0,pe=0);const Ke=Vh(K,B,G,ce,We,ht,ee),Ne=Vh(K,B,G,ce,Je,nt,ee);z.emplaceBack(pe+Ke-Q,pe+Ne-Q),ee.primitiveLength++}}})(m,r,v,d,T,i),e.forceNewSegmentOnNextPrepare(),m==null||m.forceNewSegmentOnNextPrepare()}function Vh(i,e,r,l,d,f,m){if(f){const v=l.count;return r(e[2*d],e[2*d+1]),i[d]=l.count,l.count++,m.vertexLength++,v}return i[d]}class Um{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new re,this.indexArray=new Oe,this.indexArray2=new ot,this.programConfigurations=new pa(e.layers,e.zoom),this.segments=new pt,this.segments2=new pt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,l){this.hasDependencies=Ip("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),f=!d.isConstant(),m=[];for(const{feature:v,id:T,index:S,sourceLayerIndex:P}of e){const M=this.layers[0]._featureFilter.needGeometry,D=zo(v,M);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),D,l))continue;const z=f?d.evaluate(D,{},l,r.availableImages):void 0,B={id:T,properties:v.properties,type:v.type,sourceLayerIndex:P,index:S,geometry:M?D.geometry:Lo(v),patterns:{},sortKey:z};m.push(B)}f&&m.sort(((v,T)=>v.sortKey-T.sortKey));for(const v of m){const{geometry:T,index:S,sourceLayerIndex:P}=v;if(this.hasDependencies){const M=Nm("fill",this.layers,v,{zoom:this.zoom},r);this.patternFeatures.push(M)}else this.addFeature(v,T,S,l,{},r.subdivisionGranularity);r.featureIndex.insert(e[S].feature,T,S,P,this.index)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:l})}addFeatures(e,r,l){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,l,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,l,d,f,m){for(const v of Sc(r,500)){const T=Hy(v,d,m.fill.getGranularityForZoomLevel(d.z)),S=this.layoutVertexArray;Wy(((P,M)=>{S.emplaceBack(P,M)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:f,canonical:d})}}let Zy,Ky;bt("FillBucket",Um,{omit:["layers","patternFeatures"]});var e2={get paint(){return Ky=Ky||new Ai({"fill-antialias":new Pt(Me.paint_fill["fill-antialias"]),"fill-opacity":new Bt(Me.paint_fill["fill-opacity"]),"fill-color":new Bt(Me.paint_fill["fill-color"]),"fill-outline-color":new Bt(Me.paint_fill["fill-outline-color"]),"fill-translate":new Pt(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new $l(Me.paint_fill["fill-pattern"])})},get layout(){return Zy=Zy||new Ai({"fill-sort-key":new Bt(Me.layout_fill["fill-sort-key"])})}};class t2 extends ys{constructor(e,r){super(e,e2,r)}recalculate(e,r){super.recalculate(e,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Um(e)}queryRadius(){return Tp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:r,transform:l,pixelsToTileUnits:d}){return Ay(Ep(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,d),r)}isTileClipped(){return!0}}const n2=Rr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),r2=Rr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:i2}=n2;class Bh{constructor(e,r,l,d,f){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=f,e.readFields(s2,this,r)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos,l=[];let d,f=1,m=0,v=0,T=0;for(;e.pos<r;){if(m<=0){const S=e.readVarint();f=7&S,m=S>>3}if(m--,f===1||f===2)v+=e.readSVarint(),T+=e.readSVarint(),f===1&&(d&&l.push(d),d=[]),d&&d.push(new k(v,T));else{if(f!==7)throw new Error(`unknown command ${f}`);d&&d.push(d[0].clone())}}return d&&l.push(d),l}bbox(){const e=this._pbf;e.pos=this._geometry;const r=e.readVarint()+e.pos;let l=1,d=0,f=0,m=0,v=1/0,T=-1/0,S=1/0,P=-1/0;for(;e.pos<r;){if(d<=0){const M=e.readVarint();l=7&M,d=M>>3}if(d--,l===1||l===2)f+=e.readSVarint(),m+=e.readSVarint(),f<v&&(v=f),f>T&&(T=f),m<S&&(S=m),m>P&&(P=m);else if(l!==7)throw new Error(`unknown command ${l}`)}return[v,S,T,P]}toGeoJSON(e,r,l){const d=this.extent*Math.pow(2,l),f=this.extent*e,m=this.extent*r,v=this.loadGeometry();function T(D){return[360*(D.x+f)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+m)/d)*Math.PI))-90]}function S(D){return D.map(T)}let P;if(this.type===1){const D=[];for(const B of v)D.push(B[0]);const z=S(D);P=D.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z}}else if(this.type===2){const D=v.map(S);P=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=Xy(v),z=[];for(const B of D)z.push(B.map(S));P=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z}}}const M={type:"Feature",geometry:P,properties:this.properties};return this.id!=null&&(M.id=this.id),M}}function s2(i,e,r){i===1?e.id=r.readVarint():i===2?(function(l,d){const f=l.readVarint()+l.pos;for(;l.pos<f;){const m=d._keys[l.readVarint()],v=d._values[l.readVarint()];d.properties[m]=v}})(r,e):i===3?e.type=r.readVarint():i===4&&(e._geometry=r.pos)}function Xy(i){const e=i.length;if(e<=1)return[i];const r=[];let l,d;for(let f=0;f<e;f++){const m=o2(i[f]);m!==0&&(d===void 0&&(d=m<0),d===m<0?(l&&r.push(l),l=[i[f]]):l&&l.push(i[f]))}return l&&r.push(l),r}function o2(i){let e=0;for(let r,l,d=0,f=i.length,m=f-1;d<f;m=d++)r=i[d],l=i[m],e+=(l.x-r.x)*(r.y+l.y);return e}Bh.types=["Unknown","Point","LineString","Polygon"];class a2{constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(l2,this,r),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const r=this._pbf.readVarint()+this._pbf.pos;return new Bh(this._pbf,r,this.extent,this._keys,this._values)}}function l2(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push((function(l){let d=null;const f=l.readVarint()+l.pos;for(;l.pos<f;){const m=l.readVarint()>>3;d=m===1?l.readString():m===2?l.readFloat():m===3?l.readDouble():m===4?l.readVarint64():m===5?l.readVarint():m===6?l.readSVarint():m===7?l.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(r))}class Yy{constructor(e,r){this.layers=e.readFields(c2,{},r)}}function c2(i,e,r){if(i===3){const l=new a2(r,r.readVarint()+r.pos);l.length&&(e[l.name]=l)}}const jm=Math.pow(2,13);function Uh(i,e,r,l,d,f,m,v){i.emplaceBack(e,r,2*Math.floor(l*jm)+m,d*jm*2,f*jm*2,Math.round(v))}class $m{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ue,this.centroidVertexArray=new te,this.indexArray=new Oe,this.programConfigurations=new pa(e.layers,e.zoom),this.segments=new pt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,l){this.features=[],this.hasDependencies=Ip("fill-extrusion",this.layers,r);for(const{feature:d,id:f,index:m,sourceLayerIndex:v}of e){const T=this.layers[0]._featureFilter.needGeometry,S=zo(d,T);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),S,l))continue;const P={id:f,sourceLayerIndex:v,index:m,geometry:T?S.geometry:Lo(d),properties:d.properties,type:d.type,patterns:{}};this.hasDependencies?this.features.push(Nm("fill-extrusion",this.layers,P,{zoom:this.zoom},r)):this.addFeature(P,P.geometry,m,l,{},r.subdivisionGranularity),r.featureIndex.insert(d,P.geometry,m,v,this.index,!0)}}addFeatures(e,r,l){for(const d of this.features){const{geometry:f}=d;this.addFeature(d,f,d.index,r,l,e.subdivisionGranularity)}}update(e,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,i2),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,r2.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,l,d,f,m){for(const v of Sc(r,500)){const T={x:0,y:0,sampleCount:0},S=this.layoutVertexArray.length;this.processPolygon(T,d,e,v,m);const P=this.layoutVertexArray.length-S,M=Math.floor(T.x/T.sampleCount),D=Math.floor(T.y/T.sampleCount);for(let z=0;z<P;z++)this.centroidVertexArray.emplaceBack(M,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:f,canonical:d})}processPolygon(e,r,l,d,f){if(d.length<1||Qy(d[0]))return;for(const M of d)M.length!==0&&u2(e,M);const m={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=f.fill.getGranularityForZoomLevel(r.z),T=Bh.types[l.type]==="Polygon";for(const M of d){if(M.length===0||Qy(M))continue;const D=Ql(M,v,T);this._generateSideFaces(D,m)}if(!T)return;const S=Hy(d,r,v,!1),P=this.layoutVertexArray;Wy(((M,D)=>{Uh(P,M,D,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles)}_generateSideFaces(e,r){let l=0;for(let d=1;d<e.length;d++){const f=e[d],m=e[d-1];if(h2(f,m))continue;r.segment.vertexLength+4>pt.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=f.sub(m)._perp()._unit(),T=m.dist(f);l+T>32768&&(l=0),Uh(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,0,l),Uh(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,1,l),l+=T,Uh(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,0,l),Uh(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,1,l);const S=r.segment.vertexLength;this.indexArray.emplaceBack(S,S+2,S+1),this.indexArray.emplaceBack(S+1,S+2,S+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function u2(i,e){for(let r=0;r<e.length;r++){const l=e[r];r===e.length-1&&e[0].x===l.x&&e[0].y===l.y||(i.x+=l.x,i.y+=l.y,i.sampleCount++)}}function h2(i,e){return i.x===e.x&&(i.x<0||i.x>St)||i.y===e.y&&(i.y<0||i.y>St)}function Qy(i){return i.every((e=>e.x<0))||i.every((e=>e.x>St))||i.every((e=>e.y<0))||i.every((e=>e.y>St))}let Jy;bt("FillExtrusionBucket",$m,{omit:["layers","features"]});var d2={get paint(){return Jy=Jy||new Ai({"fill-extrusion-opacity":new Pt(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bt(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $l(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Bt(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bt(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pt(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class p2 extends ys{constructor(e,r){super(e,d2,r)}createBucket(e){return new $m(e)}queryRadius(){return Tp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:l,geometry:d,transform:f,pixelsToTileUnits:m,pixelPosMatrix:v}){const T=Ep(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,m),S=this.paint.get("fill-extrusion-height").evaluate(r,l),P=this.paint.get("fill-extrusion-base").evaluate(r,l),M=(function(z,B){const j=[];for(const G of z){const K=[G.x,G.y,0,1];Qt(K,K,B),j.push(new k(K[0]/K[3],K[1]/K[3]))}return j})(T,v),D=(function(z,B,j,G){const K=[],ce=[],Q=G[8]*B,ee=G[9]*B,pe=G[10]*B,ye=G[11]*B,Re=G[8]*j,Xe=G[9]*j,We=G[10]*j,Je=G[11]*j;for(const ht of z){const nt=[],Ke=[];for(const Ne of ht){const vt=Ne.x,yt=Ne.y,Tt=G[0]*vt+G[4]*yt+G[12],mt=G[1]*vt+G[5]*yt+G[13],Lt=G[2]*vt+G[6]*yt+G[14],On=G[3]*vt+G[7]*yt+G[15],Pn=Lt+pe,vr=On+ye,Ti=Tt+Re,$r=mt+Xe,xr=Lt+We,fr=On+Je,Zn=new k((Tt+Q)/vr,(mt+ee)/vr);Zn.z=Pn/vr,nt.push(Zn);const Sr=new k(Ti/fr,$r/fr);Sr.z=xr/fr,Ke.push(Sr)}K.push(nt),ce.push(Ke)}return[K,ce]})(d,P,S,v);return(function(z,B,j){let G=1/0;Ay(j,B)&&(G=ev(j,B[0]));for(let K=0;K<B.length;K++){const ce=B[K],Q=z[K];for(let ee=0;ee<ce.length-1;ee++){const pe=ce[ee],ye=[pe,ce[ee+1],Q[ee+1],Q[ee],pe];iu(j,ye)&&(G=Math.min(G,ev(j,ye)))}}return G!==1/0&&G})(D[0],D[1],M)}}function jh(i,e){return i.x*e.x+i.y*e.y}function ev(i,e){if(i.length===1){let r=0;const l=e[r++];let d;for(;!d||l.equals(d);)if(d=e[r++],!d)return 1/0;for(;r<e.length;r++){const f=e[r],m=i[0],v=d.sub(l),T=f.sub(l),S=m.sub(l),P=jh(v,v),M=jh(v,T),D=jh(T,T),z=jh(S,v),B=jh(S,T),j=P*D-M*M,G=(D*z-M*B)/j,K=(P*B-M*z)/j,ce=l.z*(1-G-K)+d.z*G+f.z*K;if(isFinite(ce))return ce}return 1/0}{let r=1/0;for(const l of e)r=Math.min(r,l.z);return r}}const f2=Rr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:m2}=f2,g2=Rr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:_2}=g2,y2=Math.cos(Math.PI/180*37.5),tv=Math.pow(2,14)/.5;class qm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new ve,this.layoutVertexArray2=new le,this.indexArray=new Oe,this.programConfigurations=new pa(e.layers,e.zoom),this.segments=new pt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(e,r,l){this.hasDependencies=Ip("line",this.layers,r)||this.hasLineDasharray(this.layers);const d=this.layers[0].layout.get("line-sort-key"),f=!d.isConstant(),m=[];for(const{feature:v,id:T,index:S,sourceLayerIndex:P}of e){const M=this.layers[0]._featureFilter.needGeometry,D=zo(v,M);if(!this.layers[0]._featureFilter.filter(new tr(this.zoom),D,l))continue;const z=f?d.evaluate(D,{},l):void 0,B={id:T,properties:v.properties,type:v.type,sourceLayerIndex:P,index:S,geometry:M?D.geometry:Lo(v),patterns:{},dashes:{},sortKey:z};m.push(B)}f&&m.sort(((v,T)=>v.sortKey-T.sortKey));for(const v of m){const{geometry:T,index:S,sourceLayerIndex:P}=v;this.hasDependencies?(Ip("line",this.layers,r)?Nm("line",this.layers,v,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,v,this.zoom,r),this.patternFeatures.push(v)):this.addFeature(v,T,S,l,{},{},r.subdivisionGranularity),r.featureIndex.insert(e[S].feature,T,S,P,this.index)}}update(e,r,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,{imagePositions:l,dashPositions:d})}addFeatures(e,r,l,d){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,l,d,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,_2)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,m2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,l,d,f,m,v){const T=this.layers[0].layout,S=T.get("line-join").evaluate(e,{}),P=T.get("line-cap"),M=T.get("line-miter-limit"),D=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of r)this.addLine(z,e,S,P,M,D,d,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:f,dashPositions:m,canonical:d})}addLine(e,r,l,d,f,m,v,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Ql(e,v?T.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=Bh.types[r.type]==="Polygon";let P=e.length;for(;P>=2&&e[P-1].equals(e[P-2]);)P--;let M=0;for(;M<P-1&&e[M].equals(e[M+1]);)M++;if(P<(S?3:2))return;l==="bevel"&&(f=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let B,j,G,K,ce;this.e1=this.e2=-1,S&&(B=e[P-2],ce=e[M].sub(B)._unit()._perp());for(let Q=M;Q<P;Q++){if(G=Q===P-1?S?e[M+1]:void 0:e[Q+1],G&&e[Q].equals(G))continue;ce&&(K=ce),B&&(j=B),B=e[Q],ce=G?G.sub(B)._unit()._perp():K,K=K||ce;let ee=K.add(ce);ee.x===0&&ee.y===0||ee._unit();const pe=K.x*ce.x+K.y*ce.y,ye=ee.x*ce.x+ee.y*ce.y,Re=ye!==0?1/ye:1/0,Xe=2*Math.sqrt(2-2*ye),We=ye<y2&&j&&G,Je=K.x*ce.y-K.y*ce.x>0;if(We&&Q>M){const Ke=B.dist(j);if(Ke>2*D){const Ne=B.sub(B.sub(j)._mult(D/Ke)._round());this.updateDistance(j,Ne),this.addCurrentVertex(Ne,K,0,0,z),j=Ne}}const ht=j&&G;let nt=ht?l:S?"butt":d;if(ht&&nt==="round"&&(Re<m?nt="miter":Re<=2&&(nt="fakeround")),nt==="miter"&&Re>f&&(nt="bevel"),nt==="bevel"&&(Re>2&&(nt="flipbevel"),Re<f&&(nt="miter")),j&&this.updateDistance(j,B),nt==="miter")ee._mult(Re),this.addCurrentVertex(B,ee,0,0,z);else if(nt==="flipbevel"){if(Re>100)ee=ce.mult(-1);else{const Ke=Re*K.add(ce).mag()/K.sub(ce).mag();ee._perp()._mult(Ke*(Je?-1:1))}this.addCurrentVertex(B,ee,0,0,z),this.addCurrentVertex(B,ee.mult(-1),0,0,z)}else if(nt==="bevel"||nt==="fakeround"){const Ke=-Math.sqrt(Re*Re-1),Ne=Je?Ke:0,vt=Je?0:Ke;if(j&&this.addCurrentVertex(B,K,Ne,vt,z),nt==="fakeround"){const yt=Math.round(180*Xe/Math.PI/20);for(let Tt=1;Tt<yt;Tt++){let mt=Tt/yt;if(mt!==.5){const On=mt-.5;mt+=mt*On*(mt-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*On*On+(.848013+pe*(.215638*pe-1.06021)))}const Lt=ce.sub(K)._mult(mt)._add(K)._unit()._mult(Je?-1:1);this.addHalfVertex(B,Lt.x,Lt.y,!1,Je,0,z)}}G&&this.addCurrentVertex(B,ce,-Ne,-vt,z)}else if(nt==="butt")this.addCurrentVertex(B,ee,0,0,z);else if(nt==="square"){const Ke=j?1:-1;this.addCurrentVertex(B,ee,Ke,Ke,z)}else nt==="round"&&(j&&(this.addCurrentVertex(B,K,0,0,z),this.addCurrentVertex(B,K,1,1,z,!0)),G&&(this.addCurrentVertex(B,ce,-1,-1,z,!0),this.addCurrentVertex(B,ce,0,0,z)));if(We&&Q<P-1){const Ke=B.dist(G);if(Ke>2*D){const Ne=B.add(G.sub(B)._mult(D/Ke)._round());this.updateDistance(B,Ne),this.addCurrentVertex(Ne,ce,0,0,z),B=Ne}}}}addCurrentVertex(e,r,l,d,f,m=!1){const v=r.y*d-r.x,T=-r.y-r.x*d;this.addHalfVertex(e,r.x+r.y*l,r.y-r.x*l,m,!1,l,f),this.addHalfVertex(e,v,T,m,!0,-d,f),this.distance>tv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,l,d,f,m))}addHalfVertex({x:e,y:r},l,d,f,m,v,T){const S=.5*(this.lineClips?this.scaledDistance*(tv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(m?1:0),Math.round(63*l)+128,Math.round(63*d)+128,1+(v===0?0:v<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,P,this.e2),T.primitiveLength++),m?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}hasLineDasharray(e){for(const r of e){const l=r.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(e,r,l,d){for(const f of e){const m=f.paint.get("line-dasharray");if(!m||m.value.kind==="constant")continue;const v=f.layout.get("line-cap")==="round",T={dasharray:m.value.evaluate({zoom:l-1},r,{}),round:v},S={dasharray:m.value.evaluate({zoom:l},r,{}),round:v},P={dasharray:m.value.evaluate({zoom:l+1},r,{}),round:v},M=`${T.dasharray.join(",")},${T.round}`,D=`${S.dasharray.join(",")},${S.round}`,z=`${P.dasharray.join(",")},${P.round}`;d.dashDependencies[M]=T,d.dashDependencies[D]=S,d.dashDependencies[z]=P,r.dashes[f.id]={min:M,mid:D,max:z}}}}let nv,rv;bt("LineBucket",qm,{omit:["layers","patternFeatures"]});var iv={get paint(){return rv=rv||new Ai({"line-opacity":new Bt(Me.paint_line["line-opacity"]),"line-color":new Bt(Me.paint_line["line-color"]),"line-translate":new Pt(Me.paint_line["line-translate"]),"line-translate-anchor":new Pt(Me.paint_line["line-translate-anchor"]),"line-width":new Bt(Me.paint_line["line-width"]),"line-gap-width":new Bt(Me.paint_line["line-gap-width"]),"line-offset":new Bt(Me.paint_line["line-offset"]),"line-blur":new Bt(Me.paint_line["line-blur"]),"line-dasharray":new $l(Me.paint_line["line-dasharray"]),"line-pattern":new $l(Me.paint_line["line-pattern"]),"line-gradient":new Xc(Me.paint_line["line-gradient"])})},get layout(){return nv=nv||new Ai({"line-cap":new Pt(Me.layout_line["line-cap"]),"line-join":new Bt(Me.layout_line["line-join"]),"line-miter-limit":new Pt(Me.layout_line["line-miter-limit"]),"line-round-limit":new Pt(Me.layout_line["line-round-limit"]),"line-sort-key":new Bt(Me.layout_line["line-sort-key"])})}};class v2 extends Bt{possiblyEvaluate(e,r){return r=new tr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,l,d){return r=Wt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,l,d)}}let Cp;class x2 extends ys{constructor(e,r){super(e,iv,r),this.gradientVersion=0,Cp||(Cp=new v2(iv.paint.properties["line-width"].specification),Cp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof ms,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Cp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new qm(e)}queryRadius(e){const r=e,l=sv(ou("line-width",this,r),ou("line-gap-width",this,r)),d=ou("line-offset",this,r);return l/2+Math.abs(d)+Tp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:r,featureState:l,geometry:d,transform:f,pixelsToTileUnits:m}){const v=Ep(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,m),T=m/2*sv(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),S=this.paint.get("line-offset").evaluate(r,l);return S&&(d=(function(P,M){const D=[];for(let z=0;z<P.length;z++){const B=PT(P[z]),j=[];for(let G=0;G<B.length;G++){const K=B[G],ce=B[G-1],Q=B[G+1],ee=G===0?new k(0,0):K.sub(ce)._unit()._perp(),pe=G===B.length-1?new k(0,0):Q.sub(K)._unit()._perp(),ye=ee._add(pe)._unit(),Re=ye.x*pe.x+ye.y*pe.y;Re!==0&&ye._mult(1/Re),j.push(ye._mult(M)._add(K))}D.push(j)}return D})(d,S*m)),(function(P,M,D){for(let z=0;z<M.length;z++){const B=M[z];if(P.length>=3){for(let j=0;j<B.length;j++)if(su(P,B[j]))return!0}if(IT(P,B,D))return!0}return!1})(v,d,T)}isTileClipped(){return!0}}function sv(i,e){return e>0?e+2*i:i}const b2=Rr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),w2=Rr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Rr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const T2=Rr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Rr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ov=Rr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),E2=Rr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function I2(i,e,r){return i.sections.forEach((l=>{l.text=(function(d,f,m){const v=f.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?d=d.toLocaleUpperCase():v==="lowercase"&&(d=d.toLocaleLowerCase()),ko.applyArabicShaping&&(d=ko.applyArabicShaping(d)),d})(l.text,e,r)})),i}Rr([{name:"triangle",components:3,type:"Uint16"}]),Rr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Rr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Rr([{type:"Float32",name:"offsetX"}]),Rr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Rr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var ni=24;const $h={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},S2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},A2={40:!0};function av(i,e,r,l,d,f){if("fontStack"in e){const m=r[e.fontStack],v=m&&m[i];return v?v.metrics.advance*e.scale+d:0}{const m=l[e.imageName];return m?m.displaySize[0]*e.scale*ni/f+d:0}}function lv(i,e,r,l){const d=Math.pow(i-e,2);return l?i<e?d/2:2*d:d+Math.abs(r)*r}function P2(i,e,r){let l=0;return i===10&&(l-=1e4),r&&(l+=150),i!==40&&i!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function cv(i,e,r,l,d,f){let m=null,v=lv(e,r,d,f);for(const T of l){const S=lv(e-T.x,r,d,f)+T.badness;S<=v&&(m=T,v=S)}return{index:i,x:e,priorBreak:m,badness:v}}function uv(i){return i?uv(i.priorBreak).concat(i.index):[]}class uu{constructor(e="",r=[],l=[]){this.text=e,this.sections=r,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(e,r){const l=new uu;for(let d=0;d<e.sections.length;d++){const f=e.sections[d];f.image?l.addImageSection(f):l.addTextSection(f,r)}return l}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let r="",l={premature:!0,value:void 0};const d=e[Symbol.iterator]();let f=d.next();const m=e[Symbol.iterator]();m.next();let v=m.next();for(;!f.done;)r+=!v.done&&vh(v.value.codePointAt(0))&&!$h[v.value]||!l.premature&&vh(l.value.codePointAt(0))&&!$h[l.value]||!$h[f.value]?f.value:$h[f.value],l={value:f.value,premature:!1},f=d.next(),v=m.next();return r})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),r=e?e[0].length:0,l=this.text.match(/\S\s*$/),d=l?l[0].length-1:0;this.text=this.text.substring(r,this.text.length-d),this.sectionIndex=this.sectionIndex.slice(r,this.sectionIndex.length-d)}substring(e,r){const l=[...this.text].slice(e,r).join(""),d=this.sectionIndex.slice(e,r);return new uu(l,this.sections,d)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,r)=>Math.max(e,this.sections[r].scale)),0)}getMaxImageSize(e){let r=0,l=0;for(let d=0;d<this.length();d++){const f=this.getSection(d);if("imageName"in f){const m=e[f.imageName];if(!m)continue;const v=m.displaySize;r=Math.max(r,v[0]),l=Math.max(l,v[1])}}return{maxImageWidth:r,maxImageHeight:l}}addTextSection(e,r){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||r});const l=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>l)))}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Vt("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:r}),this.sectionIndex.push(this.sections.length-1)):Vt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,r,l,d,f){const m=[],v=this.determineAverageLineWidth(e,r,l,d,f),T=this.hasZeroWidthSpaces();let S=0,P=0;const M=this.text[Symbol.iterator]();let D=M.next();const z=this.text[Symbol.iterator]();z.next();let B=z.next();const j=this.text[Symbol.iterator]();j.next(),j.next();let G=j.next();for(;!D.done;){const K=this.getSection(P),ce=D.value.codePointAt(0);if(hp(ce)||(S+=av(ce,K,l,d,e,f)),!B.done){const Q=Bl(ce),ee=B.value.codePointAt(0);(S2[ce]||Q||"imageName"in K||!G.done&&A2[ee])&&m.push(cv(P+1,S,v,m,P2(ce,ee,Q&&T),!1))}P++,D=M.next(),B=z.next(),G=j.next()}return uv(cv(this.length(),S,v,m,0,!0))}determineAverageLineWidth(e,r,l,d,f){let m=0,v=0;for(const T of this.text){const S=this.getSection(v);m+=av(T.codePointAt(0),S,l,d,e,f),v++}return m/Math.max(1,Math.ceil(m/r))}}const Gm=4294967296,hv=1/Gm,dv=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Mp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,r,l=this.length){for(;this.pos<l;){const d=this.readVarint(),f=d>>3,m=this.pos;this.type=7&d,e(f,r,this),this.pos===m&&this.skip(d)}return r}readMessage(e,r){return this.readFields(e,r,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Gm;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Gm;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const r=this.buf;let l,d;return d=r[this.pos++],l=127&d,d<128?l:(d=r[this.pos++],l|=(127&d)<<7,d<128?l:(d=r[this.pos++],l|=(127&d)<<14,d<128?l:(d=r[this.pos++],l|=(127&d)<<21,d<128?l:(d=r[this.pos],l|=(15&d)<<28,(function(f,m,v){const T=v.buf;let S,P;if(P=T[v.pos++],S=(112&P)>>4,P<128||(P=T[v.pos++],S|=(127&P)<<3,P<128)||(P=T[v.pos++],S|=(127&P)<<10,P<128)||(P=T[v.pos++],S|=(127&P)<<17,P<128)||(P=T[v.pos++],S|=(127&P)<<24,P<128)||(P=T[v.pos++],S|=(1&P)<<31,P<128))return hu(f,S,m);throw new Error("Expected varint not more than 10 bytes")})(l,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&dv?dv.decode(this.buf.subarray(r,e)):(function(l,d,f){let m="",v=d;for(;v<f;){const T=l[v];let S,P,M,D=null,z=T>239?4:T>223?3:T>191?2:1;if(v+z>f)break;z===1?T<128&&(D=T):z===2?(S=l[v+1],(192&S)==128&&(D=(31&T)<<6|63&S,D<=127&&(D=null))):z===3?(S=l[v+1],P=l[v+2],(192&S)==128&&(192&P)==128&&(D=(15&T)<<12|(63&S)<<6|63&P,(D<=2047||D>=55296&&D<=57343)&&(D=null))):z===4&&(S=l[v+1],P=l[v+2],M=l[v+3],(192&S)==128&&(192&P)==128&&(192&M)==128&&(D=(15&T)<<18|(63&S)<<12|(63&P)<<6|63&M,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,z=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),v+=z}return m})(this.buf,r,e)}readBytes(){const e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r}readPackedVarint(e=[],r){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readVarint(r));return e}readPackedSVarint(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const r=7&e;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(e,r){this.writeVarint(e<<3|r)}realloc(e){let r=this.length||16;for(;r<this.pos+e;)r*=2;if(r!==this.length){const l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*hv),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*hv),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(r,l){let d,f;if(r>=0?(d=r%4294967296|0,f=r/4294967296|0):(d=~(-r%4294967296),f=~(-r/4294967296),4294967295^d?d=d+1|0:(d=0,f=f+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(m,v,T){T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,T.buf[T.pos]=127&(m>>>=7)})(d,0,l),(function(m,v){const T=(7&m)<<4;v.buf[v.pos++]|=T|((m>>>=3)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m)))))})(f,l)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const r=this.pos;this.pos=(function(d,f,m){for(let v,T,S=0;S<f.length;S++){if(v=f.charCodeAt(S),v>55295&&v<57344){if(!T){v>56319||S+1===f.length?(d[m++]=239,d[m++]=191,d[m++]=189):T=v;continue}if(v<56320){d[m++]=239,d[m++]=191,d[m++]=189,T=v;continue}v=T-55296<<10|v-56320|65536,T=null}else T&&(d[m++]=239,d[m++]=191,d[m++]=189,T=null);v<128?d[m++]=v:(v<2048?d[m++]=v>>6|192:(v<65536?d[m++]=v>>12|224:(d[m++]=v>>18|240,d[m++]=v>>12&63|128),d[m++]=v>>6&63|128),d[m++]=63&v|128)}return m})(this.buf,e,this.pos);const l=this.pos-r;l>=128&&pv(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const r=e.length;this.writeVarint(r),this.realloc(r);for(let l=0;l<r;l++)this.buf[this.pos++]=e[l]}writeRawMessage(e,r){this.pos++;const l=this.pos;e(r,this);const d=this.pos-l;d>=128&&pv(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d}writeMessage(e,r,l){this.writeTag(e,2),this.writeRawMessage(r,l)}writePackedVarint(e,r){r.length&&this.writeMessage(e,C2,r)}writePackedSVarint(e,r){r.length&&this.writeMessage(e,M2,r)}writePackedBoolean(e,r){r.length&&this.writeMessage(e,D2,r)}writePackedFloat(e,r){r.length&&this.writeMessage(e,k2,r)}writePackedDouble(e,r){r.length&&this.writeMessage(e,R2,r)}writePackedFixed32(e,r){r.length&&this.writeMessage(e,L2,r)}writePackedSFixed32(e,r){r.length&&this.writeMessage(e,z2,r)}writePackedFixed64(e,r){r.length&&this.writeMessage(e,O2,r)}writePackedSFixed64(e,r){r.length&&this.writeMessage(e,F2,r)}writeBytesField(e,r){this.writeTag(e,2),this.writeBytes(r)}writeFixed32Field(e,r){this.writeTag(e,5),this.writeFixed32(r)}writeSFixed32Field(e,r){this.writeTag(e,5),this.writeSFixed32(r)}writeFixed64Field(e,r){this.writeTag(e,1),this.writeFixed64(r)}writeSFixed64Field(e,r){this.writeTag(e,1),this.writeSFixed64(r)}writeVarintField(e,r){this.writeTag(e,0),this.writeVarint(r)}writeSVarintField(e,r){this.writeTag(e,0),this.writeSVarint(r)}writeStringField(e,r){this.writeTag(e,2),this.writeString(r)}writeFloatField(e,r){this.writeTag(e,5),this.writeFloat(r)}writeDoubleField(e,r){this.writeTag(e,1),this.writeDouble(r)}writeBooleanField(e,r){this.writeVarintField(e,+r)}}function hu(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function pv(i,e,r){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(l);for(let d=r.pos-1;d>=i;d--)r.buf[d+l]=r.buf[d]}function C2(i,e){for(let r=0;r<i.length;r++)e.writeVarint(i[r])}function M2(i,e){for(let r=0;r<i.length;r++)e.writeSVarint(i[r])}function k2(i,e){for(let r=0;r<i.length;r++)e.writeFloat(i[r])}function R2(i,e){for(let r=0;r<i.length;r++)e.writeDouble(i[r])}function D2(i,e){for(let r=0;r<i.length;r++)e.writeBoolean(i[r])}function L2(i,e){for(let r=0;r<i.length;r++)e.writeFixed32(i[r])}function z2(i,e){for(let r=0;r<i.length;r++)e.writeSFixed32(i[r])}function O2(i,e){for(let r=0;r<i.length;r++)e.writeFixed64(i[r])}function F2(i,e){for(let r=0;r<i.length;r++)e.writeSFixed64(i[r])}function N2(i,e,r){i===1&&r.readMessage(V2,e)}function V2(i,e,r){if(i===3){const{id:l,bitmap:d,width:f,height:m,left:v,top:T,advance:S}=r.readMessage(B2,{});e.push({id:l,bitmap:new Dh({width:f+6,height:m+6},d),metrics:{width:f,height:m,left:v,top:T,advance:S}})}}function B2(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function fv(i){let e=0,r=0;for(const m of i)e+=m.w*m.h,r=Math.max(r,m.w);i.sort(((m,v)=>v.h-m.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let d=0,f=0;for(const m of i)for(let v=l.length-1;v>=0;v--){const T=l[v];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,f=Math.max(f,m.y+m.h),d=Math.max(d,m.x+m.w),m.w===T.w&&m.h===T.h){const S=l.pop();S&&v<l.length&&(l[v]=S)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(l.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:d,h:f,fill:e/(d*f)||0}}class Hm{constructor(e,{pixelRatio:r,version:l,stretchX:d,stretchY:f,content:m,textFitWidth:v,textFitHeight:T}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=d,this.stretchY=f,this.content=m,this.version=l,this.textFitWidth=v,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class mv{constructor(e,r){const l={},d={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,l,f),this.addImages(r,d,f);const{w:m,h:v}=fv(f),T=new ns({width:m||1,height:v||1});for(const S in e){const P=e[S],M=l[S].paddedRect;ns.copy(P.data,T,{x:0,y:0},{x:M.x+1,y:M.y+1},P.data)}for(const S in r){const P=r[S],M=d[S].paddedRect,D=M.x+1,z=M.y+1,B=P.data.width,j=P.data.height;ns.copy(P.data,T,{x:0,y:0},{x:D,y:z},P.data),ns.copy(P.data,T,{x:0,y:j-1},{x:D,y:z-1},{width:B,height:1}),ns.copy(P.data,T,{x:0,y:0},{x:D,y:z+j},{width:B,height:1}),ns.copy(P.data,T,{x:B-1,y:0},{x:D-1,y:z},{width:1,height:j}),ns.copy(P.data,T,{x:0,y:0},{x:D+B,y:z},{width:1,height:j})}this.image=T,this.iconPositions=l,this.patternPositions=d}addImages(e,r,l){for(const d in e){const f=e[d],m={x:0,y:0,w:f.data.width+2,h:f.data.height+2};l.push(m),r[d]=new Hm(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),r),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),r)}patchUpdatedImage(e,r,l){if(!e||!r||e.version===r.version)return;e.version=r.version;const[d,f]=e.tl;l.update(r.data,void 0,{x:d,y:f})}}var Ga;function kp(i,e,r,l,d,f,m,v,T,S,P,M,D,z,B){const j=uu.fromFeature(i,d);let G;M===x.az.vertical&&j.verticalizePunctuation();let K=j.determineLineBreaks(S,f,e,l,z);const{processBidirectionalText:ce,processStyledBidirectionalText:Q}=ko;if(ce&&j.sections.length===1){G=[],K=K.map((Re=>j.toCodeUnitIndex(Re)));const ye=ce(j.toString(),K);for(const Re of ye){const Xe=[...Re].map((()=>0));G.push(new uu(Re,j.sections,Xe))}}else if(Q){G=[],K=K.map((We=>j.toCodeUnitIndex(We)));let ye=0;const Re=[];for(const We of j.text)Re.push(...Array(We.length).fill(j.sectionIndex[ye])),ye++;const Xe=Q(j.text,Re,K);for(const We of Xe){const Je=[];let ht="";for(const nt of We[0])Je.push(We[1][ht.length]),ht+=nt;G.push(new uu(We[0],j.sections,Je))}}else G=(function(ye,Re){const Xe=[];let We=0;for(const Je of Re)Xe.push(ye.substring(We,Je)),We=Je;return We<ye.length()&&Xe.push(ye.substring(We,ye.length())),Xe})(j,K);const ee=[],pe={positionedLines:ee,text:j.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:M,iconsInText:!1,verticalizable:!1};return(function(ye,Re,Xe,We,Je,ht,nt,Ke,Ne,vt,yt,Tt){let mt=0,Lt=0,On=0,Pn=0;const vr=Ke==="right"?1:Ke==="left"?0:.5,Ti=ni/Tt;let $r=0;for(const Zn of Je){Zn.trim();const Sr=Zn.getMaxScale(),Lr={positionedGlyphs:[],lineOffset:0};ye.positionedLines[$r]=Lr;const cr=Lr.positionedGlyphs;let rs=0;if(!Zn.length()){Lt+=ht,++$r;continue}const Ei=U2(We,Zn,Ti);let is=0;for(const si of Zn.text){const Tr=Zn.getSection(is),qr=si.codePointAt(0),Ar=j2(Ne,yt,qr),oi={glyph:qr,imageName:null,x:mt,y:Lt+-17,vertical:Ar,scale:1,fontStack:"",sectionIndex:Zn.getSectionIndex(is),metrics:null,rect:null};let ga;if("fontStack"in Tr){if(ga=$2(Tr,qr,Ar,Ei,Re,Xe),!ga)continue;oi.fontStack=Tr.fontStack}else{if(ye.iconsInText=!0,Tr.scale*=Ti,ga=q2(Tr,Ar,Sr,Ei,We),!ga)continue;rs=Math.max(rs,ga.imageOffset),oi.imageName=Tr.imageName}const{rect:uo,metrics:Xh,baselineOffset:Xa}=ga;oi.y+=Xa,oi.scale=Tr.scale,oi.metrics=Xh,oi.rect=uo,cr.push(oi),Ar?(ye.verticalizable=!0,mt+=("imageName"in Tr?Xh.advance:ni)*Tr.scale+vt):mt+=Xh.advance*Tr.scale+vt,is++}cr.length!==0&&(On=Math.max(mt-vt,On),G2(cr,0,cr.length-1,vr)),mt=0,Lr.lineOffset=Math.max(rs,(Sr-1)*ni);const Ys=ht*Sr+rs;Lt+=Ys,Pn=Math.max(Ys,Pn),++$r}const{horizontalAlign:xr,verticalAlign:fr}=Wm(nt);(function(Zn,Sr,Lr,cr,rs,Ei,is,Ys,si){const Tr=(Sr-Lr)*rs;let qr=0;qr=Ei!==is?-Ys*cr- -17:-cr*si*is+.5*is;for(const Ar of Zn)for(const oi of Ar.positionedGlyphs)oi.x+=Tr,oi.y+=qr})(ye.positionedLines,vr,xr,fr,On,Pn,ht,Lt,Je.length),ye.top+=-fr*Lt,ye.bottom=ye.top+Lt,ye.left+=-xr*On,ye.right=ye.left+On})(pe,e,r,l,G,m,v,T,M,S,D,B),!(function(ye){for(const Re of ye)if(Re.positionedGlyphs.length!==0)return!1;return!0})(ee)&&pe}function Wm(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function U2(i,e,r){const l=e.getMaxScale()*ni,{maxImageWidth:d,maxImageHeight:f}=e.getMaxImageSize(i),m=Math.max(l,f*r);return{verticalLineContentWidth:Math.max(l,d*r),horizontalLineContentHeight:m}}function gv(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function j2(i,e,r){return!(i===x.az.horizontal||!e&&!yh(r)||e&&(hp(r)||(l=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function $2(i,e,r,l,d,f){const m=f[i.fontStack],v=(function(S,P,M,D){if(S&&S.rect)return S;const z=P[M.fontStack],B=z&&z[D];return B?{rect:null,metrics:B.metrics}:null})(m&&m[e],d,i,e);if(v===null)return null;let T;if(r)T=l.verticalLineContentWidth-i.scale*ni;else{const S=gv(i.verticalAlign);T=(l.horizontalLineContentHeight-i.scale*ni)*S}return{rect:v.rect,metrics:v.metrics,baselineOffset:T}}function q2(i,e,r,l,d){const f=d[i.imageName];if(!f)return null;const m=f.paddedRect,v=f.displaySize,T={width:v[0],height:v[1],left:1,top:-3,advance:e?v[1]:v[0]};let S;if(e)S=l.verticalLineContentWidth-v[1]*i.scale;else{const P=gv(i.verticalAlign);S=(l.horizontalLineContentHeight-v[1]*i.scale)*P}return{rect:m,metrics:T,baselineOffset:S,imageOffset:(e?v[0]:v[1])*i.scale-ni*r}}function G2(i,e,r,l){if(l===0)return;const d=i[r],f=(i[r].x+d.metrics.advance*d.scale)*l;for(let m=e;m<=r;m++)i[m].x-=f}function H2(i,e,r){const{horizontalAlign:l,verticalAlign:d}=Wm(r),f=e[0]-i.displaySize[0]*l,m=e[1]-i.displaySize[1]*d;return{image:i,top:m,bottom:m+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function _v(i){var e,r;let l=i.left,d=i.top,f=i.right-l,m=i.bottom-d;const v=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",T=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",S=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(T==="proportional"){if(v==="stretchOnly"&&f/m<S||v==="proportional"){const P=Math.ceil(m*S);l*=P/f,f=P}}else if(v==="proportional"&&T==="stretchOnly"&&S!==0&&f/m>S){const P=Math.ceil(f/S);d*=P/m,m=P}return{x1:l,y1:d,x2:l+f,y2:d+m}}function yv(i,e,r,l,d,f){const m=i.image;let v;if(m.content){const G=m.content,K=m.pixelRatio||1;v=[G[0]/K,G[1]/K,m.displaySize[0]-G[2]/K,m.displaySize[1]-G[3]/K]}const T=e.left*f,S=e.right*f;let P,M,D,z;r==="width"||r==="both"?(z=d[0]+T-l[3],M=d[0]+S+l[1]):(z=d[0]+(T+S-m.displaySize[0])/2,M=z+m.displaySize[0]);const B=e.top*f,j=e.bottom*f;return r==="height"||r==="both"?(P=d[1]+B-l[0],D=d[1]+j+l[2]):(P=d[1]+(B+j-m.displaySize[1])/2,D=P+m.displaySize[1]),{image:m,top:P,right:M,bottom:D,left:z,collisionPadding:v}}bt("ImagePosition",Hm),bt("ImageAtlas",mv),x.az=void 0,(Ga=x.az||(x.az={}))[Ga.none=0]="none",Ga[Ga.horizontal=1]="horizontal",Ga[Ga.vertical=2]="vertical",Ga[Ga.horizontalOnly=3]="horizontalOnly";const fa=128,Ha=32640;function vv(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new tr(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:d}=r;let f=0;for(;f<l.length&&l[f]<=i;)f++;f=Math.max(0,f-1);let m=f;for(;m<l.length&&l[m]<i+1;)m++;m=Math.min(l.length-1,m);const v=l[f],T=l[m];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:d}:{kind:"camera",minZoom:v,maxZoom:T,minSize:r.evaluate(new tr(v)),maxSize:r.evaluate(new tr(T)),interpolationType:d}}}function Zm(i,e,r){let l="never";const d=i.get(e);return d?l=d:i.get(r)&&(l="always"),l}const W2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Rp(i,e,r,l,d,f,m,v,T,S,P,M,D){const z=v?Math.min(Ha,Math.round(v[0])):0,B=v?Math.min(Ha,Math.round(v[1])):0;i.emplaceBack(e,r,Math.round(32*l),Math.round(32*d),f,m,(z<<1)+(T?1:0),B,16*S,16*P,256*M,256*D)}function Km(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Z2(i){for(const e of i.sections)if(fp(e.text))return!0;return!1}class Xm{constructor(e){this.layoutVertexArray=new me,this.indexArray=new Oe,this.programConfigurations=e,this.segments=new pt,this.dynamicLayoutVertexArray=new Ae,this.opacityVertexArray=new Ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new b}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,b2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,w2.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,W2,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}bt("SymbolBuffers",Xm);class Ym{constructor(e,r,l){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new l,this.segments=new pt,this.collisionVertexArray=new ze}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,T2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}bt("CollisionBuffers",Ym);class du{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((m=>m.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vv(this.zoom,r["text-size"]),this.iconSizeData=vv(this.zoom,r["icon-size"]);const l=this.layers[0].layout,d=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=Zm(l,"text-overlap","text-allow-overlap")!=="never"||Zm(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((m=>x.az[m]))),this.stateDependentLayerIds=this.layers.filter((m=>m.isStateDependent())).map((m=>m.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Xm(new pa(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Xm(new pa(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new C,this.lineVertexArray=new R,this.symbolInstances=new A,this.textAnchorOffsets=new F}calculateGlyphDependencies(e,r,l,d,f){for(const m of e)if(r[m.codePointAt(0)]=!0,(l||d)&&f){const v=$h[m];v&&(r[v.codePointAt(0)]=!0)}}populate(e,r,l){const d=this.layers[0],f=d.layout,m=f.get("text-font"),v=f.get("text-field"),T=f.get("icon-image"),S=(v.value.kind!=="constant"||v.value.value instanceof vi&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),P=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,M=f.get("symbol-sort-key");if(this.features=[],!S&&!P)return;const D=r.iconDependencies,z=r.glyphDependencies,B=r.availableImages,j=new tr(this.zoom);for(const{feature:G,id:K,index:ce,sourceLayerIndex:Q}of e){const ee=d._featureFilter.needGeometry,pe=zo(G,ee);if(!d._featureFilter.filter(j,pe,l))continue;let ye,Re;if(ee||(pe.geometry=Lo(G)),S){const We=d.getValueAndResolveTokens("text-field",pe,l,B),Je=vi.factory(We),ht=this.hasRTLText=this.hasRTLText||Z2(Je);(!ht||ko.getRTLTextPluginStatus()==="unavailable"||ht&&ko.isParsed())&&(ye=I2(Je,d,pe))}if(P){const We=d.getValueAndResolveTokens("icon-image",pe,l,B);Re=We instanceof ui?We:ui.fromString(We)}if(!ye&&!Re)continue;const Xe=this.sortFeaturesByKey?M.evaluate(pe,{},l):void 0;if(this.features.push({id:K,text:ye,icon:Re,index:ce,sourceLayerIndex:Q,geometry:pe.geometry,properties:G.properties,type:Bh.types[G.type],sortKey:Xe}),Re&&(D[Re.name]=!0),ye){const We=m.evaluate(pe,{},l).join(","),Je=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.az.vertical)>=0;for(const ht of ye.sections)if(ht.image)D[ht.image.name]=!0;else{const nt=$a(ye.toString()),Ke=ht.fontStack||We,Ne=z[Ke]=z[Ke]||{};this.calculateGlyphDependencies(ht.text,Ne,Je,this.allowVerticalPlacement,nt)}}}f.get("symbol-placement")==="line"&&(this.features=(function(G){const K={},ce={},Q=[];let ee=0;function pe(We){Q.push(G[We]),ee++}function ye(We,Je,ht){const nt=ce[We];return delete ce[We],ce[Je]=nt,Q[nt].geometry[0].pop(),Q[nt].geometry[0]=Q[nt].geometry[0].concat(ht[0]),nt}function Re(We,Je,ht){const nt=K[Je];return delete K[Je],K[We]=nt,Q[nt].geometry[0].shift(),Q[nt].geometry[0]=ht[0].concat(Q[nt].geometry[0]),nt}function Xe(We,Je,ht){const nt=ht?Je[0][Je[0].length-1]:Je[0][0];return`${We}:${nt.x}:${nt.y}`}for(let We=0;We<G.length;We++){const Je=G[We],ht=Je.geometry,nt=Je.text?Je.text.toString():null;if(!nt){pe(We);continue}const Ke=Xe(nt,ht),Ne=Xe(nt,ht,!0);if(Ke in ce&&Ne in K&&ce[Ke]!==K[Ne]){const vt=Re(Ke,Ne,ht),yt=ye(Ke,Ne,Q[vt].geometry);delete K[Ke],delete ce[Ne],ce[Xe(nt,Q[yt].geometry,!0)]=yt,Q[vt].geometry=null}else Ke in ce?ye(Ke,Ne,ht):Ne in K?Re(Ke,Ne,ht):(pe(We),K[Ke]=ee-1,ce[Ne]=ee-1)}return Q.filter((We=>We.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((G,K)=>G.sortKey-K.sortKey))}update(e,r,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const l=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(r[e.segment+1]),f=e.dist(r[e.segment]);const m={};for(let v=e.segment+1;v<r.length;v++)m[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:d},v<r.length-1&&(d+=r[v+1].dist(r[v]));for(let v=e.segment||0;v>=0;v--)m[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:f},v>0&&(f+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const T=m[v];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,r,l,d,f,m,v,T,S,P,M,D){const z=e.indexArray,B=e.layoutVertexArray,j=e.segments.prepareSegment(4*r.length,B,z,this.canOverlap?m.sortKey:void 0),G=this.glyphOffsetArray.length,K=j.vertexLength,ce=this.allowVerticalPlacement&&v===x.az.vertical?Math.PI/2:0,Q=m.text&&m.text.sections;for(let ee=0;ee<r.length;ee++){const{tl:pe,tr:ye,bl:Re,br:Xe,tex:We,pixelOffsetTL:Je,pixelOffsetBR:ht,minFontScaleX:nt,minFontScaleY:Ke,glyphOffset:Ne,isSDF:vt,sectionIndex:yt}=r[ee],Tt=j.vertexLength,mt=Ne[1];Rp(B,T.x,T.y,pe.x,mt+pe.y,We.x,We.y,l,vt,Je.x,Je.y,nt,Ke),Rp(B,T.x,T.y,ye.x,mt+ye.y,We.x+We.w,We.y,l,vt,ht.x,Je.y,nt,Ke),Rp(B,T.x,T.y,Re.x,mt+Re.y,We.x,We.y+We.h,l,vt,Je.x,ht.y,nt,Ke),Rp(B,T.x,T.y,Xe.x,mt+Xe.y,We.x+We.w,We.y+We.h,l,vt,ht.x,ht.y,nt,Ke),Km(e.dynamicLayoutVertexArray,T,ce),z.emplaceBack(Tt,Tt+2,Tt+1),z.emplaceBack(Tt+1,Tt+2,Tt+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),ee!==r.length-1&&yt===r[ee+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,m,m.index,{imagePositions:{},canonical:D,formattedSection:Q&&Q[yt]})}e.placedSymbolArray.emplaceBack(T.x,T.y,G,this.glyphOffsetArray.length-G,K,S,P,T.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],v,0,!1,0,M)}_addCollisionDebugVertex(e,r,l,d,f,m){return r.emplaceBack(0,0),e.emplaceBack(l.x,l.y,d,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(e,r,l,d,f,m,v){const T=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),S=T.vertexLength,P=f.layoutVertexArray,M=f.collisionVertexArray,D=v.anchorX,z=v.anchorY;this._addCollisionDebugVertex(P,M,m,D,z,new k(e,r)),this._addCollisionDebugVertex(P,M,m,D,z,new k(l,r)),this._addCollisionDebugVertex(P,M,m,D,z,new k(l,d)),this._addCollisionDebugVertex(P,M,m,D,z,new k(e,d)),T.vertexLength+=4;const B=f.indexArray;B.emplaceBack(S,S+1),B.emplaceBack(S+1,S+2),B.emplaceBack(S+2,S+3),B.emplaceBack(S+3,S),T.primitiveLength+=4}addDebugCollisionBoxes(e,r,l,d){for(let f=e;f<r;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,d?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ym(Le,ov.members,ot),this.iconCollisionBox=new Ym(Le,ov.members,ot);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,l,d,f,m,v,T,S){const P={};for(let M=r;M<l;M++){const D=e.get(M);P.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},P.textFeatureIndex=D.featureIndex;break}for(let M=d;M<f;M++){const D=e.get(M);P.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},P.verticalTextFeatureIndex=D.featureIndex;break}for(let M=m;M<v;M++){const D=e.get(M);P.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},P.iconFeatureIndex=D.featureIndex;break}for(let M=T;M<S;M++){const D=e.get(M);P.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},P.verticalIconFeatureIndex=D.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const l=e.placedSymbolArray.get(r),d=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<d;f+=4)e.indexArray.emplaceBack(f,f+2,f+1),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),l=Math.cos(e),d=[],f=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const T=this.symbolInstances.get(v);d.push(0|Math.round(r*T.anchorX+l*T.anchorY)),f.push(T.featureIndex)}return m.sort(((v,T)=>d[v]-d[T]||f[T]-f[v])),m}addToSortKeyRanges(e,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((d,f,m)=>{d>=0&&m.indexOf(d)===f&&this.addIndicesForPlacedSymbol(this.text,d)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let xv,bv;bt("SymbolBucket",du,{omit:["layers","collisionBoxArray","features","compareText"]}),du.MAX_GLYPHS=65535,du.addDynamicAttributes=Km;var Qm={get paint(){return bv=bv||new Ai({"icon-opacity":new Bt(Me.paint_symbol["icon-opacity"]),"icon-color":new Bt(Me.paint_symbol["icon-color"]),"icon-halo-color":new Bt(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bt(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bt(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new Bt(Me.paint_symbol["text-opacity"]),"text-color":new Bt(Me.paint_symbol["text-color"],{runtimeType:Cr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Bt(Me.paint_symbol["text-halo-color"]),"text-halo-width":new Bt(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new Bt(Me.paint_symbol["text-halo-blur"]),"text-translate":new Pt(Me.paint_symbol["text-translate"]),"text-translate-anchor":new Pt(Me.paint_symbol["text-translate-anchor"])})},get layout(){return xv=xv||new Ai({"symbol-placement":new Pt(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bt(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Pt(Me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Pt(Me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Pt(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bt(Me.layout_symbol["icon-size"]),"icon-text-fit":new Pt(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pt(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bt(Me.layout_symbol["icon-image"]),"icon-rotate":new Bt(Me.layout_symbol["icon-rotate"]),"icon-padding":new Bt(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new Bt(Me.layout_symbol["icon-offset"]),"icon-anchor":new Bt(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt(Me.layout_symbol["text-rotation-alignment"]),"text-field":new Bt(Me.layout_symbol["text-field"]),"text-font":new Bt(Me.layout_symbol["text-font"]),"text-size":new Bt(Me.layout_symbol["text-size"]),"text-max-width":new Bt(Me.layout_symbol["text-max-width"]),"text-line-height":new Pt(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new Bt(Me.layout_symbol["text-letter-spacing"]),"text-justify":new Bt(Me.layout_symbol["text-justify"]),"text-radial-offset":new Bt(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt(Me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Bt(Me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Bt(Me.layout_symbol["text-anchor"]),"text-max-angle":new Pt(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt(Me.layout_symbol["text-writing-mode"]),"text-rotate":new Bt(Me.layout_symbol["text-rotate"]),"text-padding":new Pt(Me.layout_symbol["text-padding"]),"text-keep-upright":new Pt(Me.layout_symbol["text-keep-upright"]),"text-transform":new Bt(Me.layout_symbol["text-transform"]),"text-offset":new Bt(Me.layout_symbol["text-offset"]),"text-allow-overlap":new Pt(Me.layout_symbol["text-allow-overlap"]),"text-overlap":new Pt(Me.layout_symbol["text-overlap"]),"text-ignore-placement":new Pt(Me.layout_symbol["text-ignore-placement"]),"text-optional":new Pt(Me.layout_symbol["text-optional"])})}};class wv{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:mr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bt("FormatSectionOverride",wv,{omit:["defaultValue"]});class Dp extends ys{constructor(e,r){super(e,Qm,r)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const d=[];for(const f of l)d.indexOf(f)<0&&d.push(f);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,l,d){const f=this.layout.get(e).evaluate(r,{},l,d),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Na(m.value)||!f?f:(function(v,T){return T.replace(/{([^{}]+)}/g,((S,P)=>v&&P in v?String(v[P]):""))})(r.properties,f)}createBucket(e){return new du(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Qm.paint.overridableProperties){if(!Dp.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),l=new wv(r),d=new oh(l,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new Fc("source",d):new ah("composite",d,r.value.zoomStops),this.paint._values[e]=new ks(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&Dp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const l=e.get("text-field"),d=Qm.paint.properties[r];let f=!1;const m=v=>{for(const T of v)if(d.overrides&&d.overrides.hasOverride(T))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof vi)m(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const v=S=>{f||(S instanceof Qi&&gr(S.value)===ci?m(S.value.sections):S instanceof _t?m(S.sections):S.eachChild(v))},T=l.value;T._styleExpression&&v(T._styleExpression.expression)}return f}}let Tv;var K2={get paint(){return Tv=Tv||new Ai({"background-color":new Pt(Me.paint_background["background-color"]),"background-pattern":new Kc(Me.paint_background["background-pattern"]),"background-opacity":new Pt(Me.paint_background["background-opacity"])})}};class X2 extends ys{constructor(e,r){super(e,K2,r)}}class Y2 extends ys{constructor(e,r){super(e,{},r),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Q2{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const J2={once:!0},Jm=63710088e-1;class Wa{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Wa(At(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,l=this.lat*r,d=e.lat*r,f=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((e.lng-this.lng)*r);return Jm*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof Wa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Wa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Wa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ev=2*Math.PI*Jm;function Iv(i){return Ev*Math.cos(i*Math.PI/180)}function Sv(i){return(180+i)/360}function Av(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Pv(i,e){return i/Iv(e)}function Cv(i){return 360*i-180}function Lp(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Mv(i,e){return i*Iv(Lp(e))}class qh{constructor(e,r,l=0){this.x=+e,this.y=+r,this.z=+l}static fromLngLat(e,r=0){const l=Wa.convert(e);return new qh(Sv(l.lng),Av(l.lat),Pv(r,l.lat))}toLngLat(){return new Wa(Cv(this.x),Lp(this.y))}toAltitude(){return Mv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ev*(e=Lp(this.y),1/Math.cos(e*Math.PI/180));var e}}function kv(i,e,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class eg{constructor(e,r,l){if(!(function(d,f,m){return!(d<0||d>25||m<0||m>=Math.pow(2,d)||f<0||f>=Math.pow(2,d))})(e,r,l))throw new Error(`x=${r}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=l,this.key=pu(0,e,e,r,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,l){const d=(function(m,v,T){var S=kv(256*m,256*(v=Math.pow(2,T)-v-1),T),P=kv(256*(m+1),256*(v+1),T);return S[0]+","+S[1]+","+P[0]+","+P[1]})(this.x,this.y,this.z),f=(function(m,v,T){let S,P="";for(let M=m;M>0;M--)S=1<<M-1,P+=(v&S?1:0)+(T&S?2:0);return P})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,f).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new k((e.x*r-this.x)*St,(e.y*r-this.y)*St)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Rv{constructor(e,r){this.wrap=e,this.canonical=r,this.key=pu(e,r.z,r.z,r.x,r.y)}}class Ls{constructor(e,r,l,d,f){if(this.terrainRttPosMatrix32f=null,e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=r,this.canonical=new eg(l,+d,+f),this.key=pu(r,e,l,d,f)}clone(){return new Ls(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Ls(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ls(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?pu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):pu(this.wrap*+r,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-e.canonical.z;return!(r<0)&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new Ls(r,this.wrap,r,l,d),new Ls(r,this.wrap,r,l+1,d),new Ls(r,this.wrap,r,l,d+1),new Ls(r,this.wrap,r,l+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ls(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Rv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new qh(e.x-this.wrap,e.y))}}function pu(i,e,r,l,d){(i*=2)<0&&(i=-1*i-1);const f=1<<r;return(f*f*i+f*d+l).toString(36)+r.toString(36)+e.toString(36)}function tg(i,e){return e?i.properties[e]:i.id}function eE(i,e){const r={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const l of e.removeProperties){const d=i.addOrUpdateProperties.findIndex((f=>f.key===l));d>-1&&i.addOrUpdateProperties.splice(d,1)}return(i.removeAllProperties||e.removeAllProperties)&&(r.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(r.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(r.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(r.newGeometry=e.newGeometry||i.newGeometry),r}function Dv(i){var e,r;if(!i)return{};const l={};return l.removeAll=i.removeAll,l.remove=new Set(i.remove||[]),l.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((d=>[d.id,d]))),l.update=new Map((r=i.update)===null||r===void 0?void 0:r.map((d=>[d.id,d]))),l}bt("CanonicalTileID",eg),bt("OverscaledTileID",Ls,{omit:["terrainRttPosMatrix32f"]});class Jl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const r=new Jl;return r.extend(e(new k(this.minX,this.minY))),r.extend(e(new k(this.maxX,this.minY))),r.extend(e(new k(this.minX,this.maxY))),r.extend(e(new k(this.maxX,this.maxY))),r}static fromPoints(e){const r=new Jl;for(const l of e)r.extend(l);return r}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Lv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const l=e[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class zv{constructor(e,r,l,d,f){this.type="Feature",this._vectorTileFeature=e,this._x=l,this._y=d,this._z=r,this.properties=e.properties,this.id=f}projectPoint(e,r,l,d){return[360*(e.x+r)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+l)/d)*Math.PI))-90]}projectLine(e,r,l,d){return e.map((f=>this.projectPoint(f,r,l,d)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,r=e.extent*Math.pow(2,this._z),l=e.extent*this._x,d=e.extent*this._y,f=e.loadGeometry();switch(e.type){case 1:{const m=[];for(const T of f)m.push(T[0]);const v=this.projectLine(m,l,d,r);this._geometry=m.length===1?{type:"Point",coordinates:v[0]}:{type:"MultiPoint",coordinates:v};break}case 2:{const m=f.map((v=>this.projectLine(v,l,d,r)));this._geometry=m.length===1?{type:"LineString",coordinates:m[0]}:{type:"MultiLineString",coordinates:m};break}case 3:{const m=Xy(f),v=[];for(const T of m)v.push(T.map((S=>this.projectLine(S,l,d,r))));this._geometry=v.length===1?{type:"Polygon",coordinates:v[0]}:{type:"MultiPolygon",coordinates:v};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&r!=="_x"&&r!=="_y"&&r!=="_z"&&(e[r]=this[r]);return e}}class fu{constructor(e,r,l){hn(this,"_name");hn(this,"dataBuffer");hn(this,"nullabilityBuffer");hn(this,"_size");this._name=e,this.dataBuffer=r,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class zp extends fu{}class ng extends zp{getValueFromBuffer(e){return this.dataBuffer[e]}}class rg extends zp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Ov extends fu{constructor(r,l,d,f){super(r,l,f);hn(this,"delta");this.delta=d}}class ig extends Ov{constructor(e,r,l,d){super(e,Int32Array.of(r),l,d)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class sg extends fu{constructor(e,r,l){super(e,Int32Array.of(r),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}class tE{constructor(e,r,l,d,f=4096){hn(this,"_name");hn(this,"_geometryVector");hn(this,"_idVector");hn(this,"_propertyVectors");hn(this,"_extent");hn(this,"propertyVectorsMap");this._name=e,this._geometryVector=r,this._idVector=l,this._propertyVectors=d,this._extent=f}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((r=>[r.name,r])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let r=0;for(;r<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(r)):this.idVector.getValue(r));const d=e==null?void 0:e.next().value,f={};for(const m of this.propertyVectors){if(!m)continue;const v=m.name,T=m.getValue(r);T!==null&&(f[v]=T)}r++,yield{id:l,geometry:d,properties:f}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],r=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let d;this.idVector&&(d=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const f={coordinates:r[l],type:this.geometryVector.geometryType(l)},m={};for(const v of this.propertyVectors){if(!v)continue;const T=v.name,S=v.getValue(l);S!==null&&(m[T]=S)}e.push({id:d,geometry:f,properties:m})}return e}containsMaxSaveIntegerValues(e){return e instanceof ng||e instanceof sg&&e instanceof ig||e instanceof rg}}class nE{constructor(e){hn(this,"value");this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Mn,ma,bi,lo,ec,xs,ri,ii,Fv,zs;function pi(i,e,r){const l=new Int32Array(r);let d=0,f=e.get();for(let m=0;m<l.length;m++){let v=i[f++],T=127&v;v<128||(v=i[f++],T|=(127&v)<<7,v<128||(v=i[f++],T|=(127&v)<<14,v<128||(v=i[f++],T|=(127&v)<<21,v<128||(v=i[f++],T|=(15&v)<<28)))),l[d++]=T}return e.set(f),l}function Op(i,e,r){const l=new BigInt64Array(r);for(let d=0;d<l.length;d++)l[d]=iE(i,e);return l}function rE(i,e){let r,l;return l=i[e.get()],e.increment(),r=127&l,l<128?r:(l=i[e.get()],e.increment(),r|=(127&l)<<7,l<128?r:(l=i[e.get()],e.increment(),r|=(127&l)<<14,l<128?r:(l=i[e.get()],e.increment(),r|=(127&l)<<21,l<128?r:(l=i[e.get()],r|=(15&l)<<28,(function(d,f,m){let v,T;if(T=f[m.get()],m.increment(),v=(112&T)>>4,T<128||(T=f[m.get()],m.increment(),v|=(127&T)<<3,T<128)||(T=f[m.get()],m.increment(),v|=(127&T)<<10,T<128)||(T=f[m.get()],m.increment(),v|=(127&T)<<17,T<128)||(T=f[m.get()],m.increment(),v|=(127&T)<<24,T<128)||(T=f[m.get()],m.increment(),v|=(1&T)<<31,T<128))return 4294967296*v+(d>>>0);throw new Error("Expected varint not more than 10 bytes")})(r,i,e)))))}function Nv(i,e,r,l){throw new Error("FastPFor is not implemented yet.")}function tc(i){return i>>>1^-(1&i)}function mu(i){return i>>1n^-(1n&i)}function iE(i,e){let r=0n,l=0,d=e.get();for(;d<i.length;){const f=i[d++];if(r|=BigInt(127&f)<<BigInt(l),!(128&f))break;if(l+=7,l>=64)throw new Error("Varint too long")}return e.set(d),r}function Vv(i,e,r){const l=new Int32Array(r);let d=0;for(let f=0;f<e;f++){const m=i[f];l.fill(i[f+e],d,d+m),d+=m}return l}function Bv(i,e,r){const l=new BigInt64Array(r);let d=0;for(let f=0;f<e;f++){const m=Number(i[f]);l.fill(i[f+e],d,d+m),d+=m}return l}function Uv(i,e,r){const l=new Float64Array(r);let d=0;for(let f=0;f<e;f++){const m=i[f];l.fill(i[f+e],d,d+m),d+=m}return l}function og(i){const e=i.length/4*4;let r=1;if(e>=4)for(let l=i[0];r<e-4;r+=4)l=i[r]+=l,l=i[r+1]+=l,l=i[r+2]+=l,l=i[r+3]+=l;for(;r!=i.length;)i[r]+=i[r-1],++r}function jv(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let r=2;if(e>=4)for(;r<e-4;r+=4){const l=i[r],d=i[r+1],f=i[r+2],m=i[r+3];i[r]=(l>>>1^-(1&l))+i[r-2],i[r+1]=(d>>>1^-(1&d))+i[r-1],i[r+2]=(f>>>1^-(1&f))+i[r],i[r+3]=(m>>>1^-(1&m))+i[r+1]}for(;r!=i.length;r+=2)i[r]=(i[r]>>>1^-(1&i[r]))+i[r-2],i[r+1]=(i[r+1]>>>1^-(1&i[r+1]))+i[r-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(Mn||(Mn={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(ma||(ma={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(bi||(bi={}));class ag{constructor(e,r,l){hn(this,"_dictionaryType");hn(this,"_offsetType");hn(this,"_lengthType");this._dictionaryType=e,this._offsetType=r,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Bi(i,e){const r=(function(l,d){const f=l[d.get()],m=Object.values(bi)[f>>4];let v=null;switch(m){case bi.DATA:v=new ag(Object.values(lo)[15&f]);break;case bi.OFFSET:v=new ag(null,Object.values(ec)[15&f]);break;case bi.LENGTH:v=new ag(null,null,Object.values(xs)[15&f])}d.increment();const T=l[d.get()],S=Object.values(Mn)[T>>5],P=Object.values(Mn)[T>>2&7],M=Object.values(ma)[3&T];d.increment();const D=pi(l,d,2),z=D[0];return{physicalStreamType:m,logicalStreamType:v,logicalLevelTechnique1:S,logicalLevelTechnique2:P,physicalLevelTechnique:M,numValues:z,byteLength:D[1],decompressedCount:z}})(i,e);return r.logicalLevelTechnique1===Mn.MORTON?(function(l,d,f){const m=pi(d,f,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:m[0],coordinateShift:m[1]}})(r,i,e):Mn.RLE!==r.logicalLevelTechnique1&&Mn.RLE!==r.logicalLevelTechnique2||ma.NONE===r.physicalLevelTechnique?r:(function(l,d,f){const m=pi(d,f,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:m[1],runs:m[0],numRleValues:m[1]}})(r,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(lo||(lo={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(ec||(ec={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(xs||(xs={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(ri||(ri={}));class co{constructor(e,r){hn(this,"values");hn(this,"_size");this.values=e,this._size=r}get(e){const r=Math.floor(e/8);return(this.values[r]>>e%8&1)==1}set(e,r){const l=Math.floor(e/8);this.values[l]=this.values[l]|(r?1:0)<<e%8}getInt(e){const r=Math.floor(e/8);return this.values[r]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Ui(i,e,r,l,d){return(function(f,m,v){switch(m.logicalLevelTechnique1){case Mn.DELTA:return m.logicalLevelTechnique2===Mn.RLE?(function(T,S,P){const M=new Int32Array(P);let D=0,z=0;for(let B=0;B<S;B++){const j=T[B],G=tc(T[B+S]);for(let K=0;K<j;K++)z+=G,M[D++]=z}return M})(f,m.runs,m.numRleValues):((function(T){T[0]=T[0]>>>1^-(1&T[0]);const S=T.length/4*4;let P=1;if(S>=4)for(;P<S-4;P+=4){const M=T[P],D=T[P+1],z=T[P+2],B=T[P+3];T[P]=(M>>>1^-(1&M))+T[P-1],T[P+1]=(D>>>1^-(1&D))+T[P],T[P+2]=(z>>>1^-(1&z))+T[P+1],T[P+3]=(B>>>1^-(1&B))+T[P+2]}for(;P!=T.length;++P)T[P]=(T[P]>>>1^-(1&T[P]))+T[P-1]})(f),f);case Mn.RLE:return(function(T,S,P){return P?(function(M,D,z){const B=new Int32Array(z);let j=0;for(let G=0;G<D;G++){const K=M[G];let ce=M[G+D];ce=ce>>>1^-(1&ce),B.fill(ce,j,j+K),j+=K}return B})(T,S.runs,S.numRleValues):Vv(T,S.runs,S.numRleValues)})(f,m,v);case Mn.MORTON:return og(f),f;case Mn.COMPONENTWISE_DELTA:return jv(f),f;case Mn.NONE:return v&&(function(T){for(let S=0;S<T.length;S++){const P=T[S];T[S]=P>>>1^-(1&P)}})(f),f;default:throw new Error(`The specified Logical level technique is not supported: ${m.logicalLevelTechnique1}`)}})(Fp(i,e,r),r,l)}function Za(i,e,r){return(function(l,d){if(d.logicalLevelTechnique1===Mn.DELTA&&d.logicalLevelTechnique2===Mn.NONE)return(function(m){const v=new Int32Array(m.length+1);v[0]=0,v[1]=tc(m[0]);let T=v[1],S=2;for(;S!=v.length;++S){const P=m[S-1];T+=P>>>1^-(1&P),v[S]=v[S-1]+T}return v})(l);if(d.logicalLevelTechnique1===Mn.RLE&&d.logicalLevelTechnique2===Mn.NONE)return(function(m,v,T){const S=new Int32Array(T+1);S[0]=0;let P=1,M=S[0];for(let D=0;D<v;D++){const z=m[D],B=m[D+v];for(let j=P;j<P+z;j++)S[j]=B+M,M=S[j];P+=z}return S})(l,d.runs,d.numRleValues);if(d.logicalLevelTechnique1===Mn.NONE&&d.logicalLevelTechnique2===Mn.NONE){(function(m){let v=0;for(let T=0;T<m.length;T++)m[T]+=v,v=m[T]})(l);const f=new Int32Array(d.numValues+1);return f[0]=0,f.set(l,1),f}if(d.logicalLevelTechnique1===Mn.DELTA&&d.logicalLevelTechnique2===Mn.RLE){const f=(function(m,v,T){const S=new Int32Array(T+1);S[0]=0;let P=1,M=S[0];for(let D=0;D<v;D++){const z=m[D];let B=m[D+v];B=B>>>1^-(1&B);for(let j=P;j<P+z;j++)S[j]=B+M,M=S[j];P+=z}return S})(l,d.runs,d.numRleValues);return og(f),f}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Fp(i,e,r),r)}function Fp(i,e,r){const l=r.physicalLevelTechnique;if(l===ma.FAST_PFOR)return Nv();if(l===ma.VARINT)return pi(i,e,r.numValues);if(l===ma.NONE){const d=e.get();e.add(r.byteLength);const f=i.subarray(d,e.get());return new Int32Array(f)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function lg(i,e,r,l){const d=Fp(i,e,r);if(d.length===1){const f=d[0];return l?tc(f):f}return l?(function(f){return tc(f[1])})(d):(function(f){return f[1]})(d)}function $v(i,e,r){return(function(l){if(l.length==2){const d=tc(l[1]);return[d,d]}return[tc(l[2]),tc(l[3])]})(Fp(i,e,r))}function qv(i,e,r){return(function(l){if(l.length==2){const d=mu(l[1]);return[d,d]}return[mu(l[2]),mu(l[3])]})(Op(i,e,r.numValues))}function Gv(i,e,r,l){return(function(d,f,m){switch(f.logicalLevelTechnique1){case Mn.DELTA:return f.logicalLevelTechnique2===Mn.RLE?(function(v,T,S){const P=new BigInt64Array(S);let M=0,D=0n;for(let z=0;z<T;z++){const B=Number(v[z]),j=mu(v[z+T]);for(let G=0;G<B;G++)D+=j,P[M++]=D}return P})(d,f.runs,f.numRleValues):((function(v){v[0]=v[0]>>1n^-(1n&v[0]);const T=v.length/4*4;let S=1;if(T>=4)for(;S<T-4;S+=4){const P=v[S],M=v[S+1],D=v[S+2],z=v[S+3];v[S]=(P>>1n^-(1n&P))+v[S-1],v[S+1]=(M>>1n^-(1n&M))+v[S],v[S+2]=(D>>1n^-(1n&D))+v[S+1],v[S+3]=(z>>1n^-(1n&z))+v[S+2]}for(;S!=v.length;++S)v[S]=(v[S]>>1n^-(1n&v[S]))+v[S-1]})(d),d);case Mn.RLE:return(function(v,T,S){return S?(function(P,M,D){const z=new BigInt64Array(D);let B=0;for(let j=0;j<M;j++){const G=Number(P[j]);let K=P[j+M];K=K>>1n^-(1n&K),z.fill(K,B,B+G),B+=G}return z})(v,T.runs,T.numRleValues):Bv(v,T.runs,T.numRleValues)})(d,f,m);case Mn.NONE:return m&&(function(v){for(let T=0;T<v.length;T++){const S=v[T];v[T]=S>>1n^-(1n&S)}})(d),d;default:throw new Error(`The specified Logical level technique is not supported: ${f.logicalLevelTechnique1}`)}})(Op(i,e,r.numValues),r,l)}function Hv(i,e,r,l){const d=Op(i,e,r.numValues);if(d.length===1){const f=d[0];return l?mu(f):f}return l?(function(f){return mu(f[1])})(d):(function(f){return f[1]})(d)}function cg(i,e,r,l,d){return(function(f,m,v,T){switch(m.logicalLevelTechnique1){case Mn.DELTA:return m.logicalLevelTechnique2===Mn.RLE&&(f=Vv(f,m.runs,m.numRleValues)),(function(S,P){const M=new Int32Array(S.size());let D=0;S.get(0)?(M[0]=S.get(0)?P[0]>>>1^-(1&P[0]):0,D=1):M[0]=0;let z=1;for(;z!=M.length;++z)M[z]=S.get(z)?M[z-1]+(P[D]>>>1^-(1&P[D++])):M[z-1];return M})(T,f);case Mn.RLE:return(function(S,P,M,D){const z=P;return M?(function(B,j,G){const K=new Int32Array(B.size());let ce=0;for(let Q=0;Q<G;Q++){const ee=j[Q];let pe=j[Q+G];pe=pe>>>1^-(1&pe);for(let ye=ce;ye<ce+ee;ye++)B.get(ye)?K[ye]=pe:(K[ye]=0,ce++);ce+=ee}return K})(D,S,z.runs):(function(B,j,G){const K=new Int32Array(B.size());let ce=0;for(let Q=0;Q<G;Q++){const ee=j[Q],pe=j[Q+G];for(let ye=ce;ye<ce+ee;ye++)B.get(ye)?K[ye]=pe:(K[ye]=0,ce++);ce+=ee}return K})(D,S,z.runs)})(f,m,v,T);case Mn.MORTON:return og(f),f;case Mn.COMPONENTWISE_DELTA:return jv(f),f;case Mn.NONE:return f=v?(function(S,P){const M=new Int32Array(S.size());let D=0,z=0;for(;z!=M.length;++z)if(S.get(z)){const B=P[D++];M[z]=B>>>1^-(1&B)}else M[z]=0;return M})(T,f):(function(S,P){const M=new Int32Array(S.size());let D=0,z=0;for(;z!=M.length;++z)M[z]=S.get(z)?P[D++]:0;return M})(T,f),f;default:throw new Error("The specified Logical level technique is not supported")}})(r.physicalLevelTechnique===ma.FAST_PFOR?Nv():pi(i,e,r.numValues),r,l,d)}function Np(i,e,r,l){const d=i.logicalLevelTechnique1;if(d===Mn.RLE)return i.runs===1?ri.CONST:ri.FLAT;const f=e instanceof co?e.size():e;if(d===Mn.DELTA&&i.logicalLevelTechnique2===Mn.RLE){const m=i.runs,v=2;if(i.numRleValues!==f)return ri.FLAT;if(m===1)return ri.SEQUENCE;if(m===2){const T=l.get();let S;if(i.physicalLevelTechnique===ma.VARINT)S=pi(r,l,4);else{const P=l.get();S=new Int32Array(r.buffer,r.byteOffset+P,4)}if(l.set(T),S[2]===v&&S[3]===v)return ri.SEQUENCE}}return i.numValues===1?ri.CONST:ri.FLAT}class Wv extends zp{getValueFromBuffer(e){return this.dataBuffer[e]}}class Zv extends Ov{constructor(e,r,l,d){super(e,BigInt64Array.of(r),l,d)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class gu{constructor(e,r,l){hn(this,"_geometryOffsets");hn(this,"_partOffsets");hn(this,"_ringOffsets");this._geometryOffsets=e,this._partOffsets=r,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function ug(i,e,r){return{x:Kv(i,e)-r,y:Kv(i>>1,e)-r}}function Kv(i,e){let r=0;for(let l=0;l<e;l++)r|=(i&1<<2*l)>>l;return r}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(ii||(ii={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(Fv||(Fv={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(zs||(zs={}));class sE{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((r=>[r]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,r){return[e].concat(r)}createMultiPolygon(e){return e.flat()}}function Xv(i){const e=new Array(i.numGeometries);let r=1,l=1,d=1,f=0;const m=new sE;let v=0,T=0;const S=i.mortonSettings,P=i.topologyVector,M=P.geometryOffsets,D=P.partOffsets,z=P.ringOffsets,B=i.vertexOffsets,j=i.containsPolygonGeometry(),G=i.vertexBuffer;for(let K=0;K<i.numGeometries;K++){const ce=i.geometryType(K);if(ce===ii.POINT){if(B&&B.length!==0)if(i.vertexBufferType===zs.VEC_2){const Q=2*B[T++],ee=new k(G[Q],G[Q+1]);e[f++]=m.createPoint(ee)}else{const Q=ug(G[B[T++]],S.numBits,S.coordinateShift),ee=new k(Q.x,Q.y);e[f++]=m.createPoint(ee)}else{const Q=new k(G[v++],G[v++]);e[f++]=m.createPoint(Q)}M&&d++,D&&r++,z&&l++}else if(ce===ii.MULTIPOINT){const Q=M[d]-M[d-1];d++;const ee=new Array(Q);if(B&&B.length!==0){for(let pe=0;pe<Q;pe++){const ye=2*B[T++];ee[pe]=new k(G[ye],G[ye+1])}e[f++]=m.createMultiPoint(ee)}else{for(let pe=0;pe<Q;pe++){const ye=G[v++],Re=G[v++];ee[pe]=new k(ye,Re)}e[f++]=m.createMultiPoint(ee)}}else if(ce===ii.LINESTRING){let Q,ee=0;j?(ee=z[l]-z[l-1],l++):ee=D[r]-D[r-1],r++,B&&B.length!==0?(Q=i.vertexBufferType===zs.VEC_2?dg(G,B,T,ee,!1):pg(G,B,T,ee,!1,S),T+=ee):(Q=hg(G,v,ee,!1),v+=2*ee),e[f++]=m.createLineString(Q),M&&d++}else if(ce===ii.POLYGON){const Q=D[r]-D[r-1];r++;const ee=new Array(Q-1);let pe=z[l]-z[l-1];if(l++,B&&B.length!==0){const ye=i.vertexBufferType===zs.VEC_2?Bp(G,B,T,pe):Up(G,B,T,pe,0,S);T+=pe;for(let Re=0;Re<ee.length;Re++)pe=z[l]-z[l-1],l++,ee[Re]=i.vertexBufferType===zs.VEC_2?Bp(G,B,T,pe):Up(G,B,T,pe,0,S),T+=pe;e[f++]=m.createPolygon(ye,ee)}else{const ye=Vp(G,v,pe);v+=2*pe;for(let Re=0;Re<ee.length;Re++)pe=z[l]-z[l-1],l++,ee[Re]=Vp(G,v,pe),v+=2*pe;e[f++]=m.createPolygon(ye,ee)}M&&d++}else if(ce===ii.MULTILINESTRING){const Q=M[d]-M[d-1];d++;const ee=new Array(Q);if(B&&B.length!==0){for(let pe=0;pe<Q;pe++){let ye=0;j?(ye=z[l]-z[l-1],l++):ye=D[r]-D[r-1],r++;const Re=i.vertexBufferType===zs.VEC_2?dg(G,B,T,ye,!1):pg(G,B,T,ye,!1,S);ee[pe]=Re,T+=ye}e[f++]=m.createMultiLineString(ee)}else{for(let pe=0;pe<Q;pe++){let ye=0;j?(ye=z[l]-z[l-1],l++):ye=D[r]-D[r-1],r++,ee[pe]=hg(G,v,ye,!1),v+=2*ye}e[f++]=m.createMultiLineString(ee)}}else{if(ce!==ii.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const Q=M[d]-M[d-1];d++;const ee=new Array(Q);let pe=0;if(B&&B.length!==0){for(let ye=0;ye<Q;ye++){const Re=D[r]-D[r-1];r++;const Xe=new Array(Re-1);pe=z[l]-z[l-1],l++;const We=i.vertexBufferType===zs.VEC_2?Bp(G,B,T,pe):Up(G,B,T,pe,0,S);T+=pe;for(let Je=0;Je<Xe.length;Je++)pe=z[l]-z[l-1],l++,Xe[Je]=i.vertexBufferType===zs.VEC_2?Bp(G,B,T,pe):Up(G,B,T,pe,0,S),T+=pe;ee[ye]=m.createPolygon(We,Xe)}e[f++]=m.createMultiPolygon(ee)}else{for(let ye=0;ye<Q;ye++){const Re=D[r]-D[r-1];r++;const Xe=new Array(Re-1);pe=z[l]-z[l-1],l++;const We=Vp(G,v,pe);v+=2*pe;for(let Je=0;Je<Xe.length;Je++){const ht=z[l]-z[l-1];l++,Xe[Je]=Vp(G,v,ht),v+=2*ht}ee[ye]=m.createPolygon(We,Xe)}e[f++]=m.createMultiPolygon(ee)}}}}return e}function Vp(i,e,r){return hg(i,e,r,!0)}function Bp(i,e,r,l){return dg(i,e,r,l,!0)}function Up(i,e,r,l,d,f){return pg(i,e,r,l,!0,f)}function hg(i,e,r,l){const d=new Array(l?r+1:r);for(let f=0;f<2*r;f+=2)d[f/2]=new k(i[e+f],i[e+f+1]);return l&&(d[d.length-1]=d[0]),d}function dg(i,e,r,l,d){const f=new Array(d?l+1:l);for(let m=0;m<2*l;m+=2){const v=2*e[r+m/2];f[m/2]=new k(i[v],i[v+1])}return d&&(f[f.length-1]=f[0]),f}function pg(i,e,r,l,d,f){const m=new Array(d?l+1:l);for(let v=0;v<l;v++){const T=ug(i[e[r+v]],f.numBits,f.coordinateShift);m[v]=new k(T.x,T.y)}return d&&(m[m.length-1]=m[0]),m}class Yv{constructor(e,r,l,d,f){hn(this,"_vertexBufferType");hn(this,"_topologyVector");hn(this,"_vertexOffsets");hn(this,"_vertexBuffer");hn(this,"_mortonSettings");this._vertexBufferType=e,this._topologyVector=r,this._vertexOffsets=l,this._vertexBuffer=d,this._mortonSettings=f}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Xv(this);let r=0;for(;r<this.numGeometries;)yield{coordinates:e[r],type:this.geometryType(r)},r++}getSimpleEncodedVertex(e){const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=ug(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const r=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[r],this.vertexBuffer[r+1]]}getGeometries(){return Xv(this)}get mortonSettings(){return this._mortonSettings}}class Qv extends Yv{constructor(r,l,d,f,m,v,T){super(d,f,m,v,T);hn(this,"_numGeometries");hn(this,"_geometryType");this._numGeometries=r,this._geometryType=l}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ii.POLYGON||this._geometryType===ii.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Jv extends Yv{constructor(r,l,d,f,m,v){super(r,d,f,m,v);hn(this,"_geometryTypes");this._geometryTypes=l}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let r=0;r<this.numGeometries;r++)if(this.geometryType(r)===ii.POLYGON||this.geometryType(r)===ii.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class e0{constructor(e,r,l,d){hn(this,"_triangleOffsets");hn(this,"_indexBuffer");hn(this,"_vertexBuffer");hn(this,"_topologyVector");this._triangleOffsets=e,this._indexBuffer=r,this._vertexBuffer=l,this._topologyVector=d}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),r=this._topologyVector,l=r.partOffsets,d=r.ringOffsets,f=r.geometryOffsets;let m=0,v=1,T=1,S=1;for(let P=0;P<this.numGeometries;P++)switch(this.geometryType(P)){case ii.POLYGON:{const M=l[v]-l[v-1];v++;const D=[];for(let z=0;z<M;z++){const B=d[T]-d[T-1];T++;const j=[];for(let G=0;G<B;G++){const K=this._vertexBuffer[m++],ce=this._vertexBuffer[m++];j.push(new k(K,ce))}j.length>0&&j.push(j[0]),D.push(j)}e[P]=D,f&&S++}break;case ii.MULTIPOLYGON:{const M=f[S]-f[S-1];S++;const D=[];for(let z=0;z<M;z++){const B=l[v]-l[v-1];v++;for(let j=0;j<B;j++){const G=d[T]-d[T-1];T++;const K=[];for(let ce=0;ce<G;ce++){const Q=this._vertexBuffer[m++],ee=this._vertexBuffer[m++];K.push(new k(Q,ee))}K.length>0&&K.push(K[0]),D.push(K)}}e[P]=D}}return e}[Symbol.iterator](){return null}}function t0(i,e,r,l,d,f){return new oE(i,e,r,l,d,f)}class oE extends e0{constructor(r,l,d,f,m,v){super(d,f,m,v);hn(this,"_numGeometries");hn(this,"_geometryType");this._numGeometries=r,this._geometryType=l}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function n0(i,e,r,l,d){return new aE(i,e,r,l,d)}class aE extends e0{constructor(r,l,d,f,m){super(l,d,f,m);hn(this,"_geometryTypes");this._geometryTypes=r}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function lE(i,e,r,l,d){const f=Bi(i,r);let m=null,v=null,T=null,S=null,P=null,M=null,D=null,z=null;if(Np(f,l,i,r)===ri.CONST){const j=lg(i,r,f,!1);for(let G=0;G<e-1;G++){const K=Bi(i,r);switch(K.physicalStreamType){case bi.LENGTH:switch(K.logicalStreamType.lengthType){case xs.GEOMETRIES:m=Za(i,r,K);break;case xs.PARTS:v=Za(i,r,K);break;case xs.RINGS:T=Za(i,r,K);break;case xs.TRIANGLES:D=Za(i,r,K)}break;case bi.OFFSET:switch(K.logicalStreamType.offsetType){case ec.VERTEX:S=Ui(i,r,K,!1);break;case ec.INDEX:z=Ui(i,r,K,!1)}break;case bi.DATA:lo.VERTEX===K.logicalStreamType.dictionaryType?P=Ui(i,r,K,!0):(M={numBits:K.numBits,coordinateShift:K.coordinateShift},P=Ui(i,r,K,!1))}}return z!==null?m!=null||v!=null?t0(l,j,D,z,P,new gu(m,v,T)):t0(l,j,D,z,P):M===null?(function(G,K,ce,Q,ee){return new Qv(G,K,zs.VEC_2,ce,Q,ee)})(l,j,new gu(m,v,T),S,P):(function(G,K,ce,Q,ee,pe){return new Qv(G,K,zs.MORTON,ce,Q,ee,pe)})(l,j,new gu(m,v,T),S,P,M)}const B=Ui(i,r,f,!1);for(let j=0;j<e-1;j++){const G=Bi(i,r);switch(G.physicalStreamType){case bi.LENGTH:switch(G.logicalStreamType.lengthType){case xs.GEOMETRIES:m=Ui(i,r,G,!1);break;case xs.PARTS:v=Ui(i,r,G,!1);break;case xs.RINGS:T=Ui(i,r,G,!1);break;case xs.TRIANGLES:D=Za(i,r,G)}break;case bi.OFFSET:switch(G.logicalStreamType.offsetType){case ec.VERTEX:S=Ui(i,r,G,!1);break;case ec.INDEX:z=Ui(i,r,G,!1)}break;case bi.DATA:lo.VERTEX===G.logicalStreamType.dictionaryType?P=Ui(i,r,G,!0):(M={numBits:G.numBits,coordinateShift:G.coordinateShift},P=Ui(i,r,G,!1))}}return z!==null&&v===null?n0(B,D,z,P):(m!==null?(m=fg(B,m,2),v!==null&&T!==null?(v=r0(B,m,v,!1),T=(function(j,G,K,ce){const Q=new Int32Array(K[K.length-1]+1);let ee=0;Q[0]=ee;let pe=1,ye=1,Re=0;for(let Xe=0;Xe<j.length;Xe++){const We=j[Xe],Je=G[Xe+1]-G[Xe];if(We!==0&&We!==3)for(let ht=0;ht<Je;ht++){const nt=K[pe]-K[pe-1];pe++;for(let Ke=0;Ke<nt;Ke++)ee=Q[ye++]=ee+ce[Re++]}else for(let ht=0;ht<Je;ht++)Q[ye++]=++ee,pe++}return Q})(B,m,v,T)):v!==null&&(v=(function(j,G,K){const ce=new Int32Array(G[G.length-1]+1);let Q=0;ce[0]=Q;let ee=1,pe=0;for(let ye=0;ye<j.length;ye++){const Re=j[ye],Xe=G[ye+1]-G[ye];if(Re===4||Re===1)for(let We=0;We<Xe;We++)Q=ce[ee++]=Q+K[pe++];else for(let We=0;We<Xe;We++)ce[ee++]=++Q}return ce})(B,m,v))):v!==null&&T!==null?(v=fg(B,v,1),T=r0(B,v,T,!0)):v!==null&&(v=fg(B,v,0)),z!==null?n0(B,D,z,P,new gu(m,v,T)):M===null?(function(j,G,K,ce){return new Jv(zs.VEC_2,j,G,K,ce)})(B,new gu(m,v,T),S,P):(function(j,G,K,ce,Q){return new Jv(zs.MORTON,j,G,K,ce,Q)})(B,new gu(m,v,T),S,P,M))}function fg(i,e,r){const l=new Int32Array(i.length+1);let d=0;l[0]=d;let f=0;for(let m=0;m<i.length;m++)d=l[m+1]=d+(i[m]>r?e[f++]:1);return l}function r0(i,e,r,l){const d=new Int32Array(e[e.length-1]+1);let f=0;d[0]=f;let m=1,v=0;for(let T=0;T<i.length;T++){const S=i[T],P=e[T+1]-e[T];if(S===5||S===2||l&&(S===4||S===1))for(let M=0;M<P;M++)f=d[m++]=f+r[v++];else for(let M=0;M<P;M++)d[m++]=++f}return d}class cE extends fu{constructor(r,l,d){super(r,l.getBuffer(),d);hn(this,"dataVector");this.dataVector=l}getValueFromBuffer(r){return this.dataVector.get(r)}}class uE extends zp{getValueFromBuffer(e){return this.dataBuffer[e]}}class i0 extends fu{constructor(e,r,l){super(e,BigInt64Array.of(r),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Gh(i,e,r){return s0(i,Math.ceil(e/8),r)}function s0(i,e,r){const l=new Uint8Array(e);let d=0;for(;d<e;){const f=i[r.increment()];if(f<=127){const m=f+3,v=i[r.increment()],T=d+m;l.fill(v,d,T),d=T}else{const m=256-f;for(let v=0;v<m;v++)l[d++]=i[r.increment()]}}return l}const hE=new TextDecoder;function mg(i,e,r){return r-e>=12?hE.decode(i.subarray(e,r)):(function(l,d,f){let m="",v=d;for(;v<f;){const T=l[v];let S,P,M,D=null,z=T>239?4:T>223?3:T>191?2:1;if(v+z>f)break;z===1?T<128&&(D=T):z===2?(S=l[v+1],(192&S)==128&&(D=(31&T)<<6|63&S,D<=127&&(D=null))):z===3?(S=l[v+1],P=l[v+2],(192&S)==128&&(192&P)==128&&(D=(15&T)<<12|(63&S)<<6|63&P,(D<=2047||D>=55296&&D<=57343)&&(D=null))):z===4&&(S=l[v+1],P=l[v+2],M=l[v+3],(192&S)==128&&(192&P)==128&&(192&M)==128&&(D=(15&T)<<18|(63&S)<<12|(63&P)<<6|63&M,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,z=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),v+=z}return m})(i,e,r)}class gg extends fu{constructor(r,l,d,f){super(r,d,f);hn(this,"offsetBuffer");this.offsetBuffer=l}}class o0 extends gg{constructor(r,l,d,f){super(r,l,d,f??l.length-1);hn(this,"textEncoder");this.textEncoder=new TextEncoder}getValueFromBuffer(r){return mg(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class _u extends gg{constructor(r,l,d,f,m){super(r,d,f,m??l.length);hn(this,"indexBuffer");hn(this,"textEncoder");this.indexBuffer=l,this.indexBuffer=l,this.textEncoder=new TextEncoder}getValueFromBuffer(r){const l=this.indexBuffer[r];return mg(this.dataBuffer,this.offsetBuffer[l],this.offsetBuffer[l+1])}}class a0 extends gg{constructor(r,l,d,f,m,v,T){super(r,d,f,T);hn(this,"indexBuffer");hn(this,"symbolOffsetBuffer");hn(this,"symbolTableBuffer");hn(this,"textEncoder");hn(this,"symbolLengthBuffer");hn(this,"lengthBuffer");hn(this,"decodedDictionary");this.indexBuffer=l,this.symbolOffsetBuffer=m,this.symbolTableBuffer=v,this.textEncoder=new TextEncoder}getValueFromBuffer(r){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(d,f,m){const v=[],T=new Array(f.length).fill(0);for(let S=1;S<f.length;S++)T[S]=T[S-1]+f[S-1];for(let S=0;S<m.length;S++)if(m[S]===255)v.push(m[++S]);else{const P=f[m[S]],M=T[m[S]];for(let D=0;D<P;D++)v.push(d[M+D])}return new Uint8Array(v)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const l=this.indexBuffer[r];return mg(this.decodedDictionary,this.offsetBuffer[l],this.offsetBuffer[l+1])}offsetToLengthBuffer(r){const l=new Uint32Array(r.length-1);let d=r[0];for(let f=1;f<r.length;f++){const m=r[f];l[f-1]=m-d,d=m}return l}}function dE(i,e,r,l,d,f){return r.type==="scalarType"?(function(m,v,T,S,P,M){let D=null,z=0;if(m===0)return null;if(M.nullable){const j=Bi(v,T);z=j.numValues;const G=T.get(),K=Gh(v,z,T);T.set(G+j.byteLength),D=new co(K,j.numValues)}const B=D??S;switch(P.physicalType){case 4:case 3:return(function(j,G,K,ce,Q){const ee=Bi(j,G),pe=Np(ee,Q,j,G),ye=ce.physicalType===3;if(pe===ri.FLAT){const Re=Hh(Q)?cg(j,G,ee,ye,Q):Ui(j,G,ee,ye);return new ng(K.name,Re,Q)}if(pe===ri.SEQUENCE){const Re=$v(j,G,ee);return new ig(K.name,Re[0],Re[1],ee.numRleValues)}{const Re=lg(j,G,ee,ye);return new sg(K.name,Re,Q)}})(v,T,M,P,B);case 9:return(function(j,G,K,ce,Q){let ee=null,pe=null,ye=null,Re=null,Xe=null,We=null,Je=null,ht=null;for(let nt=0;nt<ce;nt++){const Ke=Bi(G,K);if(Ke.byteLength!==0)switch(Ke.physicalStreamType){case bi.PRESENT:{const Ne=Gh(G,Ke.numValues,K);We=new co(Ne,Ke.numValues);break}case bi.OFFSET:pe=Q!=null||We!=null?cg(G,K,Ke,!1,Q??We):Ui(G,K,Ke,!1);break;case bi.LENGTH:{const Ne=Za(G,K,Ke);xs.DICTIONARY===Ke.logicalStreamType.lengthType?ee=Ne:xs.SYMBOL===Ke.logicalStreamType.lengthType?Re=Ne:Je=Ne;break}case bi.DATA:{const Ne=G.subarray(K.get(),K.get()+Ke.byteLength);K.add(Ke.byteLength);const vt=Ke.logicalStreamType.dictionaryType;lo.FSST===vt?Xe=Ne:lo.SINGLE===vt||lo.SHARED===vt?ye=Ne:lo.NONE===vt&&(ht=Ne);break}}}return(function(nt,Ke,Ne,vt,yt,Tt,mt){return Ke?new a0(nt,Ne,vt,yt,Tt,Ke,mt):null})(j,Xe,pe,ee,ye,Re,Q??We)??(function(nt,Ke,Ne,vt,yt){return Ke?yt?new _u(nt,Ne,vt,Ke,yt):new _u(nt,Ne,vt,Ke):null})(j,ye,pe,ee,Q??We)??(function(nt,Ke,Ne,vt,yt){if(!Ke||!Ne)return null;if(vt)return yt?new _u(nt,vt,Ke,Ne,yt):new _u(nt,vt,Ke,Ne);if(yt&&yt.size()!==Ke.length-1){const Tt=new Int32Array(yt.size());let mt=0;for(let Lt=0;Lt<yt.size();Lt++)Tt[Lt]=yt.get(Lt)?mt++:0;return new _u(nt,Tt,Ke,Ne,yt)}return yt?new o0(nt,Ke,Ne,yt):new o0(nt,Ke,Ne)})(j,Je,ht,pe,Q??We)})(M.name,v,T,M.nullable?m-1:m,D);case 0:return(function(j,G,K,ce,Q){const ee=Bi(j,G),pe=ee.numValues,ye=G.get(),Re=Hh(Q)?(function(We,Je,ht,nt){const Ke=s0(We,Math.ceil(Je/8),ht),Ne=new co(Ke,Je),vt=nt.size(),yt=new co(new Uint8Array(vt),vt);let Tt=0;for(let mt=0;mt<nt.size();mt++){const Lt=!!nt.get(mt)&&Ne.get(Tt++);yt.set(mt,Lt)}return yt.getBuffer()})(j,pe,G,Q):Gh(j,pe,G);G.set(ye+ee.byteLength);const Xe=new co(Re,pe);return new cE(K.name,Xe,Q)})(v,T,M,0,B);case 6:case 5:return(function(j,G,K,ce,Q){const ee=Bi(j,G),pe=Np(ee,ce,j,G),ye=Q.physicalType===5;if(pe===ri.FLAT){const Re=Hh(ce)?(function(Xe,We,Je,ht,nt){return(function(Ke,Ne,vt,yt){switch(Ne.logicalLevelTechnique1){case Mn.DELTA:return Ne.logicalLevelTechnique2===Mn.RLE&&(Ke=Bv(Ke,Ne.runs,Ne.numRleValues)),(function(Tt,mt){const Lt=new BigInt64Array(Tt.size());let On=0;Tt.get(0)?(Lt[0]=Tt.get(0)?mt[0]>>1n^-(1n&mt[0]):0n,On=1):Lt[0]=0n;let Pn=1;for(;Pn!=Lt.length;++Pn)Lt[Pn]=Tt.get(Pn)?Lt[Pn-1]+(mt[On]>>1n^-(1n&mt[On++])):Lt[Pn-1];return Lt})(yt,Ke);case Mn.RLE:return(function(Tt,mt,Lt,On){const Pn=mt;return Lt?(function(vr,Ti,$r){const xr=new BigInt64Array(vr.size());let fr=0;for(let Zn=0;Zn<$r;Zn++){const Sr=Number(Ti[Zn]);let Lr=Ti[Zn+$r];Lr=Lr>>1n^-(1n&Lr);for(let cr=fr;cr<fr+Sr;cr++)vr.get(cr)?xr[cr]=Lr:(xr[cr]=0n,fr++);fr+=Sr}return xr})(On,Tt,Pn.runs):(function(vr,Ti,$r){const xr=new BigInt64Array(vr.size());let fr=0;for(let Zn=0;Zn<$r;Zn++){const Sr=Number(Ti[Zn]),Lr=Ti[Zn+$r];for(let cr=fr;cr<fr+Sr;cr++)vr.get(cr)?xr[cr]=Lr:(xr[cr]=0n,fr++);fr+=Sr}return xr})(On,Tt,Pn.runs)})(Ke,Ne,vt,yt);case Mn.NONE:return Ke=vt?(function(Tt,mt){const Lt=new BigInt64Array(Tt.size());let On=0,Pn=0;for(;Pn!=Lt.length;++Pn)if(Tt.get(Pn)){const vr=mt[On++];Lt[Pn]=vr>>1n^-(1n&vr)}else Lt[Pn]=0n;return Lt})(yt,Ke):(function(Tt,mt){const Lt=new BigInt64Array(Tt.size());let On=0,Pn=0;for(;Pn!=Lt.length;++Pn)Lt[Pn]=Tt.get(Pn)?mt[On++]:0n;return Lt})(yt,Ke),Ke;default:throw new Error("The specified Logical level technique is not supported")}})(Op(Xe,We,Je.numValues),Je,ht,nt)})(j,G,ee,ye,ce):Gv(j,G,ee,ye);return new Wv(K.name,Re,ce)}if(pe===ri.SEQUENCE){const Re=qv(j,G,ee);return new Zv(K.name,Re[0],Re[1],ee.numRleValues)}{const Re=Hv(j,G,ee,ye);return new i0(K.name,Re,ce)}})(v,T,M,B,P);case 7:return(function(j,G,K,ce){const Q=Bi(j,G),ee=Hh(ce)?(function(pe,ye,Re,Xe){const We=ye.get(),Je=We+Xe*Float32Array.BYTES_PER_ELEMENT,ht=new Uint8Array(pe.subarray(We,Je)).buffer,nt=new Float32Array(ht);ye.set(Je);const Ke=Re.size(),Ne=new Float32Array(Ke);let vt=0;for(let yt=0;yt<Ke;yt++)Ne[yt]=Re.get(yt)?nt[vt++]:0;return Ne})(j,G,ce,Q.numValues):(function(pe,ye,Re){const Xe=ye.get(),We=Xe+Re*Float32Array.BYTES_PER_ELEMENT,Je=new Uint8Array(pe.subarray(Xe,We)).buffer,ht=new Float32Array(Je);return ye.set(We),ht})(j,G,Q.numValues);return new uE(K.name,ee,ce)})(v,T,M,B);case 8:return(function(j,G,K,ce){const Q=Bi(j,G),ee=Hh(ce)?(function(pe,ye,Re,Xe){const We=ye.get(),Je=We+Xe*Float64Array.BYTES_PER_ELEMENT,ht=new Uint8Array(pe.subarray(We,Je)).buffer,nt=new Float64Array(ht);ye.set(Je);const Ke=Re.size(),Ne=new Float64Array(Ke);let vt=0;for(let yt=0;yt<Ke;yt++)Ne[yt]=Re.get(yt)?nt[vt++]:0;return Ne})(j,G,ce,Q.numValues):(function(pe,ye,Re){const Xe=ye.get(),We=Xe+Re*Float64Array.BYTES_PER_ELEMENT,Je=new Uint8Array(pe.subarray(Xe,We)).buffer,ht=new Float64Array(Je);return ye.set(We),ht})(j,G,Q.numValues);return new rg(K.name,ee,ce)})(v,T,M,B);default:throw new Error(`The specified data type for the field is currently not supported: ${P}`)}})(l,i,e,d,r.scalarType,r):l!=1?null:(function(m,v,T,S){let P=null,M=null,D=null,z=null,B=!1;for(;!B;){const ce=Bi(m,v);switch(ce.physicalStreamType){case bi.LENGTH:xs.DICTIONARY===ce.logicalStreamType.lengthType?P=Za(m,v,ce):D=Za(m,v,ce);break;case bi.DATA:lo.SINGLE===ce.logicalStreamType.dictionaryType||lo.SHARED===ce.logicalStreamType.dictionaryType?(M=m.subarray(v.get(),v.get()+ce.byteLength),B=!0):z=m.subarray(v.get(),v.get()+ce.byteLength),v.add(ce.byteLength)}}const j=T.complexType.children,G=[];let K=0;for(const ce of j){const Q=pi(m,v,1)[0];if(Q==0)continue;const ee=`${T.name}${ce.name==="default"?"":":"+ce.name}`;if(Q!==2||ce.type!=="scalarField"||ce.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const pe=Bi(m,v),ye=Gh(m,pe.numValues,v),Re=Bi(m,v),Xe=Re.decompressedCount!==S?cg(m,v,Re,!1,new co(ye,pe.numValues)):Ui(m,v,Re,!1);G[K++]=z?new a0(ee,Xe,P,M,D,z,new co(ye,pe.numValues)):new _u(ee,Xe,P,M,new co(ye,pe.numValues))}return G})(i,e,r,d)}function Hh(i){return i instanceof co}function pE(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const fE=new TextDecoder;function l0(i,e){const r=pi(i,e,1)[0];if(r===0)return"";const l=e.get(),d=i.subarray(l,l+r);return e.add(r),fE.decode(d)}function c0(i,e){const r=pi(i,e,1)[0]>>>0,l=!!(4&r),d=!!(2&r),f=pi(i,e,1)[0]>>>0,m={};if(1&r&&(m.nullable=!0),d){const v={};if(l?(v.type="logicalType",v.logicalType=f):(v.type="physicalType",v.physicalType=f),8&r){const T=pi(i,e,1)[0]>>>0;v.children=new Array(T);for(let S=0;S<T;S++)v.children[S]=c0(i,e)}m.type="complexField",m.complexField=v}else{const v={};l?(v.type="logicalType",v.logicalType=f):(v.type="physicalType",v.physicalType=f),m.type="scalarField",m.scalarField=v}return m}function mE(i,e){const r=pi(i,e,1)[0]>>>0,l=(function(d){switch(d){case 0:case 1:case 2:case 3:{const f={};f.nullable=!!(1&d),f.columnScope=0;const m={};return m.physicalType=d>1?6:4,m.type="physicalType",f.scalarType=m,f.type="scalarType",f}case 4:{const f={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:0};return f.type="complexType",f.complexType=m,f}case 30:{const f={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:1};return f.type="complexType",f.complexType=m,f}default:return(function(f){let m=null;switch(f){case 10:case 11:m=0;break;case 12:case 13:m=1;break;case 14:case 15:m=2;break;case 16:case 17:m=3;break;case 18:case 19:m=4;break;case 20:case 21:m=5;break;case 22:case 23:m=6;break;case 24:case 25:m=7;break;case 26:case 27:m=8;break;case 28:case 29:m=9;break;default:return null}const v={};v.nullable=!!(1&f),v.columnScope=0;const T={type:"physicalType"};return T.physicalType=m,v.type="scalarType",v.scalarType=T,v})(d)}})(r);if(!l)throw new Error(`Unsupported column type code: ${r}`);if((function(d){return d>=10})(r)?l.name=l0(i,e):r>=0&&r<=3?l.name="id":r===4&&(l.name="geometry"),(function(d){return d===30})(r)){const d=pi(i,e,1)[0]>>>0,f=l.complexType;f.children=new Array(d);for(let m=0;m<d;m++)f.children[m]=c0(i,e)}return l}function gE(i,e){const r={featureTables:[]},l={};l.name=l0(i,e);const d=pi(i,e,1)[0]>>>0,f=pi(i,e,1)[0]>>>0;l.columns=new Array(f);for(let m=0;m<f;m++)l.columns[m]=mE(i,e);return r.featureTables.push(l),[r,d]}function _E(i,e,r,l,d,f,m=!1){const v=e.scalarType.physicalType,T=Np(d,f,i,r);if(v===4)switch(T){case ri.FLAT:{const S=Ui(i,r,d,!1);return new ng(l,S,f)}case ri.SEQUENCE:{const S=$v(i,r,d);return new ig(l,S[0],S[1],d.numRleValues)}case ri.CONST:{const S=lg(i,r,d,!1);return new sg(l,S,f)}}else switch(T){case ri.FLAT:{if(m){const P=(function(M,D,z,B){const j=(function(G,K,ce){const Q=new Float64Array(K);for(let ee=0;ee<K;ee++)Q[ee]=rE(G,ce);return Q})(M,z.numValues,D);return(function(G,K,ce){switch(K.logicalLevelTechnique1){case Mn.DELTA:return K.logicalLevelTechnique2===Mn.RLE&&(G=Uv(G,K.runs,K.numRleValues)),(function(Q){Q[0]=Q[0]%2==1?(Q[0]+1)/-2:Q[0]/2;const ee=Q.length/4*4;let pe=1;if(ee>=4)for(;pe<ee-4;pe+=4){const ye=Q[pe],Re=Q[pe+1],Xe=Q[pe+2],We=Q[pe+3];Q[pe]=(ye%2==1?(ye+1)/-2:ye/2)+Q[pe-1],Q[pe+1]=(Re%2==1?(Re+1)/-2:Re/2)+Q[pe],Q[pe+2]=(Xe%2==1?(Xe+1)/-2:Xe/2)+Q[pe+1],Q[pe+3]=(We%2==1?(We+1)/-2:We/2)+Q[pe+2]}for(;pe!=Q.length;++pe)Q[pe]=(Q[pe]%2==1?(Q[pe]+1)/-2:Q[pe]/2)+Q[pe-1]})(G),G;case Mn.RLE:return(function(Q,ee,pe){return Uv(Q,ee.runs,ee.numRleValues)})(G,K);case Mn.NONE:return G;default:throw new Error(`The specified Logical level technique is not supported: ${K.logicalLevelTechnique1}`)}})(j,z)})(i,r,d);return new rg(l,P,f)}const S=Gv(i,r,d,!1);return new Wv(l,S,f)}case ri.SEQUENCE:{const S=qv(i,r,d);return new Zv(l,S[0],S[1],d.numRleValues)}case ri.CONST:{const S=Hv(i,r,d,!1);return new i0(l,S,f)}}throw new Error("Vector type not supported for id column.")}class yE{constructor(e,r){var l;switch(this._featureData=e,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case ii.POINT:case ii.MULTIPOINT:this.type=1;break;case ii.LINESTRING:case ii.MULTILINESTRING:this.type=2;break;case ii.POLYGON:case ii.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=r,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const r of this._featureData.geometry.coordinates){const l=[];for(const d of r)l.push(new k(d.x,d.y));e.push(l)}return e}}class vE{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new yE(this.features[e],this.extent)}}class u0{constructor(e){this.layers={};const r=(function(l,d,f=!0){const m=new nE(0),v=[];for(;m.get()<l.length;){const T=pi(l,m,1)[0]>>>0,S=m.get()+T;if(S>l.length)throw new Error(`Block overruns tile: ${S} > ${l.length}`);if(pi(l,m,1)[0]>>>0!=1){m.set(S);continue}const P=gE(l,m),M=P[1],D=P[0].featureTables[0];let z=null,B=null;const j=[];let G=0;for(const ce of D.columns){const Q=ce.name;if(Q==="id"){let ee=null;if(ce.nullable){const ye=Bi(l,m),Re=m.get(),Xe=Gh(l,ye.numValues,m);m.set(Re+ye.byteLength),ee=new co(Xe,ye.numValues)}const pe=Bi(l,m);G=pe.decompressedCount,z=_E(l,ce,m,Q,pe,ee??G,f)}else if(Q==="geometry"){const ee=pi(l,m,1)[0];if(G===0){const pe=m.get();G=Bi(l,m).decompressedCount,m.set(pe)}B=lE(l,ee,m,G)}else{const ee=pE(ce)?pi(l,m,1)[0]:1;if(ee===0&&ce.type==="scalarType")continue;const pe=dE(l,m,ce,ee,G);if(pe)if(Array.isArray(pe))for(const ye of pe)j.push(ye);else j.push(pe)}}const K=new tE(D.name,B,z,j,M);v.push(K),m.set(S)}return v})(new Uint8Array(e));this.layers=r.reduce(((l,d)=>Object.assign(Object.assign({},l),{[d.name]:new vE(d)})),{})}}class xE{constructor(e,r){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=r,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],r=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of r){const d=[];for(const f of l)d.push(new k(f[0],f[1]));e.push(d)}return e}}const Wh="_geojsonTileLayer";function bE(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const r={keys:[],values:[],keycache:{},valuecache:{}};for(let f=0;f<i.length;f++)r.feature=i.feature(f),e.writeMessage(2,wE,r);const l=r.keys;for(const f of l)e.writeStringField(3,f);const d=r.values;for(const f of d)e.writeMessage(4,IE,f)}function wE(i,e){if(!i.feature)return;const r=i.feature;r.id!==void 0&&e.writeVarintField(1,r.id),e.writeMessage(2,TE,i),e.writeVarintField(3,r.type),e.writeMessage(4,EE,r)}function TE(i,e){var r;for(const l in(r=i.feature)==null?void 0:r.properties){let d=i.feature.properties[l],f=i.keycache[l];if(d==null)continue;f===void 0&&(i.keys.push(l),f=i.keys.length-1,i.keycache[l]=f),e.writeVarint(f),typeof d!="string"&&typeof d!="boolean"&&typeof d!="number"&&(d=JSON.stringify(d));const m=typeof d+":"+d;let v=i.valuecache[m];v===void 0&&(i.values.push(d),v=i.values.length-1,i.valuecache[m]=v),e.writeVarint(v)}}function _g(i,e){return(e<<3)+(7&i)}function h0(i){return i<<1^i>>31}function EE(i,e){const r=i.loadGeometry(),l=i.type;let d=0,f=0;for(const m of r){let v=1;l===1&&(v=m.length),e.writeVarint(_g(1,v));const T=l===3?m.length-1:m.length;for(let S=0;S<T;S++){S===1&&l!==1&&e.writeVarint(_g(2,T-1));const P=m[S].x-d,M=m[S].y-f;e.writeVarint(h0(P)),e.writeVarint(h0(M)),d+=P,f+=M}i.type===3&&e.writeVarint(_g(7,1))}}function IE(i,e){const r=typeof i;r==="string"?e.writeStringField(1,i):r==="boolean"?e.writeBooleanField(7,i):r==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class d0{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ua(St,16,0),this.grid3D=new Ua(St,16,0),this.featureIndexArray=new Z,this.promoteId=r}insert(e,r,l,d,f,m){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,f);const T=m?this.grid3D:this.grid;for(let S=0;S<r.length;S++){const P=r[S],M=[1/0,1/0,-1/0,-1/0];for(let D=0;D<P.length;D++){const z=P[D];M[0]=Math.min(M[0],z.x),M[1]=Math.min(M[1],z.y),M[2]=Math.max(M[2],z.x),M[3]=Math.max(M[3],z.y)}M[0]<St&&M[1]<St&&M[2]>=0&&M[3]>=0&&T.insert(v,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Yy(new Mp(this.rawTileData)).layers:new u0(this.rawTileData).layers,this.sourceLayerCoder=new Lv(this.vtLayers?Object.keys(this.vtLayers).sort():[Wh])),this.vtLayers}query(e,r,l,d){this.loadVTLayers();const f=e.params,m=St/e.tileSize/e.scale,v=Cl(f.filter,f.globalState),T=e.queryGeometry,S=e.queryPadding*m,P=Jl.fromPoints(T),M=this.grid.query(P.minX-S,P.minY-S,P.maxX+S,P.maxY+S),D=Jl.fromPoints(e.cameraQueryGeometry).expandBy(S),z=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,((G,K,ce,Q)=>(function(ee,pe,ye,Re,Xe){for(const Je of ee)if(pe<=Je.x&&ye<=Je.y&&Re>=Je.x&&Xe>=Je.y)return!0;const We=[new k(pe,ye),new k(pe,Xe),new k(Re,Xe),new k(Re,ye)];if(ee.length>2){for(const Je of We)if(su(ee,Je))return!0}for(let Je=0;Je<ee.length-1;Je++)if(AT(ee[Je],ee[Je+1],We))return!0;return!1})(e.cameraQueryGeometry,G-S,K-S,ce+S,Q+S)));for(const G of z)M.push(G);M.sort(SE);const B={};let j;for(let G=0;G<M.length;G++){const K=M[G];if(K===j)continue;j=K;const ce=this.featureIndexArray.get(K);let Q=null;this.loadMatchingFeature(B,ce.bucketIndex,ce.sourceLayerIndex,ce.featureIndex,v,f.layers,f.availableImages,r,l,d,((ee,pe,ye)=>(Q||(Q=Lo(ee)),pe.queryIntersectsFeature({queryGeometry:T,feature:ee,featureState:ye,geometry:Q,zoom:this.z,transform:e.transform,pixelsToTileUnits:m,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return B}loadMatchingFeature(e,r,l,d,f,m,v,T,S,P,M){const D=this.bucketLayerIDs[r];if(m&&!D.some((G=>m.has(G))))return;const z=this.sourceLayerCoder.decode(l),B=this.vtLayers[z].feature(d);if(f.needGeometry){const G=zo(B,!0);if(!f.filter(new tr(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!f.filter(new tr(this.tileID.overscaledZ),B))return;const j=this.getId(B,z);for(let G=0;G<D.length;G++){const K=D[G];if(m&&!m.has(K))continue;const ce=T[K];if(!ce)continue;let Q={};j&&P&&(Q=P.getState(ce.sourceLayer||Wh,j));const ee=Wt({},S[K]);ee.paint=p0(ee.paint,ce.paint,B,Q,v),ee.layout=p0(ee.layout,ce.layout,B,Q,v);const pe=!M||M(B,ce,Q);if(!pe)continue;const ye=new zv(B,this.z,this.x,this.y,j);ye.layer=ee;let Re=e[K];Re===void 0&&(Re=e[K]=[]),Re.push({featureIndex:d,feature:ye,intersectionZ:pe})}}lookupSymbolFeatures(e,r,l,d,f,m,v,T){const S={};this.loadVTLayers();const P=Cl(f.filterSpec,f.globalState);for(const M of e)this.loadMatchingFeature(S,l,d,M,P,m,v,T,r);return S}hasLayer(e){for(const r of this.bucketLayerIDs)for(const l of r)if(e===l)return!0;return!1}getId(e,r){var l;let d=e.id;return this.promoteId&&(d=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof d=="boolean"&&(d=Number(d)),d===void 0&&(!((l=e.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(d=Number(e.properties.cluster_id))),d}}function p0(i,e,r,l,d){return Zt(i,((f,m)=>{const v=e instanceof jl?e.get(m):null;return v&&v.evaluate?v.evaluate(r,l,d):v}))}function SE(i,e){return e-i}function f0(i,e,r,l,d){const f=[];for(let m=0;m<i.length;m++){const v=i[m];let T;for(let S=0;S<v.length-1;S++){let P=v[S],M=v[S+1];P.x<e&&M.x<e||(P.x<e?P=new k(e,P.y+(e-P.x)/(M.x-P.x)*(M.y-P.y))._round():M.x<e&&(M=new k(e,P.y+(e-P.x)/(M.x-P.x)*(M.y-P.y))._round()),P.y<r&&M.y<r||(P.y<r?P=new k(P.x+(r-P.y)/(M.y-P.y)*(M.x-P.x),r)._round():M.y<r&&(M=new k(P.x+(r-P.y)/(M.y-P.y)*(M.x-P.x),r)._round()),P.x>=l&&M.x>=l||(P.x>=l?P=new k(l,P.y+(l-P.x)/(M.x-P.x)*(M.y-P.y))._round():M.x>=l&&(M=new k(l,P.y+(l-P.x)/(M.x-P.x)*(M.y-P.y))._round()),P.y>=d&&M.y>=d||(P.y>=d?P=new k(P.x+(d-P.y)/(M.y-P.y)*(M.x-P.x),d)._round():M.y>=d&&(M=new k(P.x+(d-P.y)/(M.y-P.y)*(M.x-P.x),d)._round()),T&&P.equals(T[T.length-1])||(T=[P],f.push(T)),T.push(M)))))}}return f}function m0(i,e,r,l,d){switch(e){case 1:return(function(f,m,v,T){const S=[];for(const P of f)for(const M of P){const D=T===0?M.x:M.y;D>=m&&D<=v&&S.push([M])}return S})(i,r,l,d);case 2:return g0(i,r,l,d,!1);case 3:return g0(i,r,l,d,!0)}return[]}function AE(i,e,r,l,d){const f=l===0?PE:CE;let m=[];const v=[];for(let P=0;P<i.length-1;P++){const M=i[P],D=i[P+1],z=l===0?M.x:M.y,B=l===0?D.x:D.y;let j=!1;z<e?B>e&&m.push(f(M,D,e)):z>r?B<r&&m.push(f(M,D,r)):m.push(M),B<e&&z>=e&&(m.push(f(M,D,e)),j=!0),B>r&&z<=r&&(m.push(f(M,D,r)),j=!0),!d&&j&&(v.push(m),m=[])}const T=i.length-1,S=l===0?i[T].x:i[T].y;return S>=e&&S<=r&&m.push(i[T]),d&&m.length>0&&!m[0].equals(m[m.length-1])&&m.push(new k(m[0].x,m[0].y)),m.length>0&&v.push(m),v}function g0(i,e,r,l,d){const f=[];for(const m of i){const v=AE(m,e,r,l,d);v.length>0&&f.push(...v)}return f}function PE(i,e,r){return new k(r,i.y+(r-i.x)/(e.x-i.x)*(e.y-i.y))}function CE(i,e,r){return new k(i.x+(r-i.y)/(e.y-i.y)*(e.x-i.x),r)}bt("FeatureIndex",d0,{omit:["rawTileData","sourceLayerCoder"]});class Ka extends k{constructor(e,r,l,d){super(e,r),this.angle=l,d!==void 0&&(this.segment=d)}clone(){return new Ka(this.x,this.y,this.angle,this.segment)}}function _0(i,e,r,l,d){if(e.segment===void 0||r===0)return!0;let f=e,m=e.segment+1,v=0;for(;v>-r/2;){if(m--,m<0)return!1;v-=i[m].dist(f),f=i[m]}v+=i[m].dist(i[m+1]),m++;const T=[];let S=0;for(;v<r/2;){const P=i[m],M=i[m+1];if(!M)return!1;let D=i[m-1].angleTo(P)-P.angleTo(M);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:D}),S+=D;v-T[0].distance>l;)S-=T.shift().angleDelta;if(S>d)return!1;m++,v+=P.dist(M)}return!0}function y0(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function v0(i,e,r){return i?.6*e*r:0}function x0(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function ME(i,e,r,l,d,f){const m=v0(r,d,f),v=x0(r,l)*f;let T=0;const S=y0(i)/2;for(let P=0;P<i.length-1;P++){const M=i[P],D=i[P+1],z=M.dist(D);if(T+z>S){const B=(S-T)/z,j=rr.number(M.x,D.x,B),G=rr.number(M.y,D.y,B),K=new Ka(j,G,D.angleTo(M),P);return K._round(),!m||_0(i,K,v,m,e)?K:void 0}T+=z}}function kE(i,e,r,l,d,f,m,v,T){const S=v0(l,f,m),P=x0(l,d),M=P*m,D=i[0].x===0||i[0].x===T||i[0].y===0||i[0].y===T;return e-M<e/4&&(e=M+e/4),b0(i,D?e/2*v%e:(P/2+2*f)*m*v%e,e,S,r,M,D,!1,T)}function b0(i,e,r,l,d,f,m,v,T){const S=f/2,P=y0(i);let M=0,D=e-r,z=[];for(let B=0;B<i.length-1;B++){const j=i[B],G=i[B+1],K=j.dist(G),ce=G.angleTo(j);for(;D+r<M+K;){D+=r;const Q=(D-M)/K,ee=rr.number(j.x,G.x,Q),pe=rr.number(j.y,G.y,Q);if(ee>=0&&ee<T&&pe>=0&&pe<T&&D-S>=0&&D+S<=P){const ye=new Ka(ee,pe,ce,B);ye._round(),l&&!_0(i,ye,f,l,d)||z.push(ye)}}M+=K}return v||z.length||m||(z=b0(i,M/2,r,l,d,f,m,!0,T)),z}function w0(i,e,r,l){const d=[],f=i.image,m=f.pixelRatio,v=f.paddedRect.w-2,T=f.paddedRect.h-2;let S={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const P=f.stretchX||[[0,v]],M=f.stretchY||[[0,T]],D=(Ne,vt)=>Ne+vt[1]-vt[0],z=P.reduce(D,0),B=M.reduce(D,0),j=v-z,G=T-B;let K=0,ce=z,Q=0,ee=B,pe=0,ye=j,Re=0,Xe=G;if(f.content&&l){const Ne=f.content,vt=Ne[2]-Ne[0],yt=Ne[3]-Ne[1];(f.textFitWidth||f.textFitHeight)&&(S=_v(i)),K=jp(P,0,Ne[0]),Q=jp(M,0,Ne[1]),ce=jp(P,Ne[0],Ne[2]),ee=jp(M,Ne[1],Ne[3]),pe=Ne[0]-K,Re=Ne[1]-Q,ye=vt-ce,Xe=yt-ee}const We=S.x1,Je=S.y1,ht=S.x2-We,nt=S.y2-Je,Ke=(Ne,vt,yt,Tt)=>{const mt=$p(Ne.stretch-K,ce,ht,We),Lt=qp(Ne.fixed-pe,ye,Ne.stretch,z),On=$p(vt.stretch-Q,ee,nt,Je),Pn=qp(vt.fixed-Re,Xe,vt.stretch,B),vr=$p(yt.stretch-K,ce,ht,We),Ti=qp(yt.fixed-pe,ye,yt.stretch,z),$r=$p(Tt.stretch-Q,ee,nt,Je),xr=qp(Tt.fixed-Re,Xe,Tt.stretch,B),fr=new k(mt,On),Zn=new k(vr,On),Sr=new k(vr,$r),Lr=new k(mt,$r),cr=new k(Lt/m,Pn/m),rs=new k(Ti/m,xr/m),Ei=e*Math.PI/180;if(Ei){const si=Math.sin(Ei),Tr=Math.cos(Ei),qr=[Tr,-si,si,Tr];fr._matMult(qr),Zn._matMult(qr),Lr._matMult(qr),Sr._matMult(qr)}const is=Ne.stretch+Ne.fixed,Ys=vt.stretch+vt.fixed;return{tl:fr,tr:Zn,bl:Lr,br:Sr,tex:{x:f.paddedRect.x+1+is,y:f.paddedRect.y+1+Ys,w:yt.stretch+yt.fixed-is,h:Tt.stretch+Tt.fixed-Ys},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cr,pixelOffsetBR:rs,minFontScaleX:ye/m/ht,minFontScaleY:Xe/m/nt,isSDF:r}};if(l&&(f.stretchX||f.stretchY)){const Ne=T0(P,j,z),vt=T0(M,G,B);for(let yt=0;yt<Ne.length-1;yt++){const Tt=Ne[yt],mt=Ne[yt+1];for(let Lt=0;Lt<vt.length-1;Lt++)d.push(Ke(Tt,vt[Lt],mt,vt[Lt+1]))}}else d.push(Ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:T+1}));return d}function jp(i,e,r){let l=0;for(const d of i)l+=Math.max(e,Math.min(r,d[1]))-Math.max(e,Math.min(r,d[0]));return l}function T0(i,e,r){const l=[{fixed:-1,stretch:0}];for(const[d,f]of i){const m=l[l.length-1];l.push({fixed:d-m.stretch,stretch:m.stretch}),l.push({fixed:d-m.stretch,stretch:m.stretch+(f-d)})}return l.push({fixed:e+1,stretch:r}),l}function $p(i,e,r,l){return i/e*r+l}function qp(i,e,r,l){return i-e*r/l}bt("Anchor",Ka);class Gp{constructor(e,r,l,d,f,m,v,T,S,P){var M;if(this.boxStartIndex=e.length,S){let D=m.top,z=m.bottom;const B=m.collisionPadding;B&&(D-=B[1],z+=B[3]);let j=z-D;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{const D=!((M=m.image)===null||M===void 0)&&M.content&&(m.image.textFitWidth||m.image.textFitHeight)?_v(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*v-T[0],D.y2=D.y2*v+T[2],D.x1=D.x1*v-T[3],D.x2=D.x2*v+T[1];const z=m.collisionPadding;if(z&&(D.x1-=z[0]*v,D.y1-=z[1]*v,D.x2+=z[2]*v,D.y2+=z[3]*v),P){const B=new k(D.x1,D.y1),j=new k(D.x2,D.y1),G=new k(D.x1,D.y2),K=new k(D.x2,D.y2),ce=P*Math.PI/180;B._rotate(ce),j._rotate(ce),G._rotate(ce),K._rotate(ce),D.x1=Math.min(B.x,j.x,G.x,K.x),D.x2=Math.max(B.x,j.x,G.x,K.x),D.y1=Math.min(B.y,j.y,G.y,K.y),D.y2=Math.max(B.y,j.y,G.y,K.y)}e.emplaceBack(r.x,r.y,D.x1,D.y1,D.x2,D.y2,l,d,f)}this.boxEndIndex=e.length}}class RE{constructor(e=[],r=(l,d)=>l<d?-1:l>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:l}=this,d=r[e];for(;e>0;){const f=e-1>>1,m=r[f];if(l(d,m)>=0)break;r[e]=m,e=f}r[e]=d}_down(e){const{data:r,compare:l}=this,d=this.length>>1,f=r[e];for(;e<d;){let m=1+(e<<1);const v=m+1;if(v<this.length&&l(r[v],r[m])<0&&(m=v),l(r[m],f)>=0)break;r[e]=r[m],e=m}r[e]=f}}function DE(i,e=1,r=!1){const l=Jl.fromPoints(i[0]),d=Math.min(l.width(),l.height());let f=d/2;const m=new RE([],LE),{minX:v,minY:T,maxX:S,maxY:P}=l;if(d===0)return new k(v,T);for(let z=v;z<S;z+=d)for(let B=T;B<P;B+=d)m.push(new yu(z+f,B+f,f,i));let M=(function(z){let B=0,j=0,G=0;const K=z[0];for(let ce=0,Q=K.length,ee=Q-1;ce<Q;ee=ce++){const pe=K[ce],ye=K[ee],Re=pe.x*ye.y-ye.x*pe.y;j+=(pe.x+ye.x)*Re,G+=(pe.y+ye.y)*Re,B+=3*Re}return new yu(j/B,G/B,0,z)})(i),D=m.length;for(;m.length;){const z=m.pop();(z.d>M.d||!M.d)&&(M=z,r&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,D)),z.max-M.d<=e||(f=z.h/2,m.push(new yu(z.p.x-f,z.p.y-f,f,i)),m.push(new yu(z.p.x+f,z.p.y-f,f,i)),m.push(new yu(z.p.x-f,z.p.y+f,f,i)),m.push(new yu(z.p.x+f,z.p.y+f,f,i)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${M.d}`)),M.p}function LE(i,e){return e.max-i.max}function yu(i,e,r,l){this.p=new k(i,e),this.h=r,this.d=(function(d,f){let m=!1,v=1/0;for(let T=0;T<f.length;T++){const S=f[T];for(let P=0,M=S.length,D=M-1;P<M;D=P++){const z=S[P],B=S[D];z.y>d.y!=B.y>d.y&&d.x<(B.x-z.x)*(d.y-z.y)/(B.y-z.y)+z.x&&(m=!m),v=Math.min(v,Py(d,z,B))}}return(m?1:-1)*Math.sqrt(v)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var wi;x.aP=void 0,(wi=x.aP||(x.aP={}))[wi.center=1]="center",wi[wi.left=2]="left",wi[wi.right=3]="right",wi[wi.top=4]="top",wi[wi.bottom=5]="bottom",wi[wi["top-left"]=6]="top-left",wi[wi["top-right"]=7]="top-right",wi[wi["bottom-left"]=8]="bottom-left",wi[wi["bottom-right"]=9]="bottom-right";const yg=Number.POSITIVE_INFINITY;function E0(i,e){return e[1]!==yg?(function(r,l,d){let f=0,m=0;switch(l=Math.abs(l),d=Math.abs(d),r){case"top-right":case"top-left":case"top":m=d-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-d}switch(r){case"top-right":case"bottom-right":case"right":f=-l;break;case"top-left":case"bottom-left":case"left":f=l}return[f,m]})(i,e[0],e[1]):(function(r,l){let d=0,f=0;l<0&&(l=0);const m=l/Math.SQRT2;switch(r){case"top-right":case"top-left":f=m-7;break;case"bottom-right":case"bottom-left":f=7-m;break;case"bottom":f=7-l;break;case"top":f=l-7}switch(r){case"top-right":case"bottom-right":d=-m;break;case"top-left":case"bottom-left":d=m;break;case"left":d=l;break;case"right":d=-l}return[d,f]})(i,e[0])}function I0(i,e,r){var l;const d=i.layout,f=(l=d.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},r);if(f){const v=f.values,T=[];for(let S=0;S<v.length;S+=2){const P=T[S]=v[S],M=v[S+1].map((D=>D*ni));P.startsWith("top")?M[1]-=7:P.startsWith("bottom")&&(M[1]+=7),T[S+1]=M}return new Qr(T)}const m=d.get("text-variable-anchor");if(m){let v;v=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(e,{},r)*ni,yg]:d.get("text-offset").evaluate(e,{},r).map((S=>S*ni));const T=[];for(const S of m)T.push(S,E0(S,v));return new Qr(T)}return null}function vg(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zE(i,e,r,l,d,f,m,v,T,S,P,M){let D=f.textMaxSize.evaluate(e,{});D===void 0&&(D=m);const z=i.layers[0].layout,B=z.get("icon-offset").evaluate(e,{},P),j=A0(r.horizontal),G=m/24,K=i.tilePixelRatio*G,ce=i.tilePixelRatio*D/24,Q=i.tilePixelRatio*v,ee=i.tilePixelRatio*z.get("symbol-spacing"),pe=z.get("text-padding")*i.tilePixelRatio,ye=(function(yt,Tt,mt,Lt=1){const On=yt.get("icon-padding").evaluate(Tt,{},mt),Pn=On&&On.values;return[Pn[0]*Lt,Pn[1]*Lt,Pn[2]*Lt,Pn[3]*Lt]})(z,e,P,i.tilePixelRatio),Re=z.get("text-max-angle")/180*Math.PI,Xe=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",We=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Je=z.get("symbol-placement"),ht=ee/2,nt=z.get("icon-text-fit");let Ke;l&&nt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ke=yv(l,r.vertical,nt,z.get("icon-text-fit-padding"),B,G)),j&&(l=yv(l,j,nt,z.get("icon-text-fit-padding"),B,G)));const Ne=P?M.line.getGranularityForZoomLevel(P.z):1,vt=(yt,Tt)=>{Tt.x<0||Tt.x>=St||Tt.y<0||Tt.y>=St||(function(mt,Lt,On,Pn,vr,Ti,$r,xr,fr,Zn,Sr,Lr,cr,rs,Ei,is,Ys,si,Tr,qr,Ar,oi,ga,uo,Xh){const Xa=mt.addToLineVertexArray(Lt,On);let nc,vu,xu,bu,k0=0,R0=0,D0=0,L0=0,Ag=-1,Pg=-1;const _a={};let z0=Dr("");if(mt.allowVerticalPlacement&&Pn.vertical){const Pi=xr.layout.get("text-rotate").evaluate(Ar,{},uo)+90;xu=new Gp(fr,Lt,Zn,Sr,Lr,Pn.vertical,cr,rs,Ei,Pi),$r&&(bu=new Gp(fr,Lt,Zn,Sr,Lr,$r,Ys,si,Ei,Pi))}if(vr){const Pi=xr.layout.get("icon-rotate").evaluate(Ar,{}),Os=xr.layout.get("icon-text-fit")!=="none",rc=w0(vr,Pi,ga,Os),po=$r?w0($r,Pi,ga,Os):void 0;vu=new Gp(fr,Lt,Zn,Sr,Lr,vr,Ys,si,!1,Pi),k0=4*rc.length;const ic=mt.iconSizeData;let Oo=null;ic.kind==="source"?(Oo=[fa*xr.layout.get("icon-size").evaluate(Ar,{})],Oo[0]>Ha&&Vt(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ic.kind==="composite"&&(Oo=[fa*oi.compositeIconSizes[0].evaluate(Ar,{},uo),fa*oi.compositeIconSizes[1].evaluate(Ar,{},uo)],(Oo[0]>Ha||Oo[1]>Ha)&&Vt(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,rc,Oo,qr,Tr,Ar,x.az.none,Lt,Xa.lineStartIndex,Xa.lineLength,-1,uo),Ag=mt.icon.placedSymbolArray.length-1,po&&(R0=4*po.length,mt.addSymbols(mt.icon,po,Oo,qr,Tr,Ar,x.az.vertical,Lt,Xa.lineStartIndex,Xa.lineLength,-1,uo),Pg=mt.icon.placedSymbolArray.length-1)}const O0=Object.keys(Pn.horizontal);for(const Pi of O0){const Os=Pn.horizontal[Pi];if(!nc){z0=Dr(Os.text);const po=xr.layout.get("text-rotate").evaluate(Ar,{},uo);nc=new Gp(fr,Lt,Zn,Sr,Lr,Os,cr,rs,Ei,po)}const rc=Os.positionedLines.length===1;if(D0+=S0(mt,Lt,Os,Ti,xr,Ei,Ar,is,Xa,Pn.vertical?x.az.horizontal:x.az.horizontalOnly,rc?O0:[Pi],_a,Ag,oi,uo),rc)break}Pn.vertical&&(L0+=S0(mt,Lt,Pn.vertical,Ti,xr,Ei,Ar,is,Xa,x.az.vertical,["vertical"],_a,Pg,oi,uo));const NE=nc?nc.boxStartIndex:mt.collisionBoxArray.length,VE=nc?nc.boxEndIndex:mt.collisionBoxArray.length,BE=xu?xu.boxStartIndex:mt.collisionBoxArray.length,UE=xu?xu.boxEndIndex:mt.collisionBoxArray.length,jE=vu?vu.boxStartIndex:mt.collisionBoxArray.length,$E=vu?vu.boxEndIndex:mt.collisionBoxArray.length,qE=bu?bu.boxStartIndex:mt.collisionBoxArray.length,GE=bu?bu.boxEndIndex:mt.collisionBoxArray.length;let ho=-1;const Wp=(Pi,Os)=>Pi&&Pi.circleDiameter?Math.max(Pi.circleDiameter,Os):Os;ho=Wp(nc,ho),ho=Wp(xu,ho),ho=Wp(vu,ho),ho=Wp(bu,ho);const F0=ho>-1?1:0;F0&&(ho*=Xh/ni),mt.glyphOffsetArray.length>=du.MAX_GLYPHS&&Vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ar.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,Ar.sortKey);const HE=I0(xr,Ar,uo),[WE,ZE]=(function(Pi,Os){const rc=Pi.length,po=Os==null?void 0:Os.values;if((po==null?void 0:po.length)>0)for(let ic=0;ic<po.length;ic+=2){const Oo=po[ic+1];Pi.emplaceBack(x.aP[po[ic]],Oo[0],Oo[1])}return[rc,Pi.length]})(mt.textAnchorOffsets,HE);mt.symbolInstances.emplaceBack(Lt.x,Lt.y,_a.right>=0?_a.right:-1,_a.center>=0?_a.center:-1,_a.left>=0?_a.left:-1,_a.vertical||-1,Ag,Pg,z0,NE,VE,BE,UE,jE,$E,qE,GE,Zn,D0,L0,k0,R0,F0,0,cr,ho,WE,ZE)})(i,Tt,yt,r,l,d,Ke,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,K,[pe,pe,pe,pe],Xe,T,Q,ye,We,B,e,f,S,P,m)};if(Je==="line")for(const yt of f0(e.geometry,0,0,St,St)){const Tt=Ql(yt,Ne),mt=kE(Tt,ee,Re,r.vertical||j,l,24,ce,i.overscaling,St);for(const Lt of mt)j&&OE(i,j.text,ht,Lt)||vt(Tt,Lt)}else if(Je==="line-center"){for(const yt of e.geometry)if(yt.length>1){const Tt=Ql(yt,Ne),mt=ME(Tt,Re,r.vertical||j,l,24,ce);mt&&vt(Tt,mt)}}else if(e.type==="Polygon")for(const yt of Sc(e.geometry,0)){const Tt=DE(yt,16);vt(Ql(yt[0],Ne,!0),new Ka(Tt.x,Tt.y,0))}else if(e.type==="LineString")for(const yt of e.geometry){const Tt=Ql(yt,Ne);vt(Tt,new Ka(Tt[0].x,Tt[0].y,0))}else if(e.type==="Point")for(const yt of e.geometry)for(const Tt of yt)vt([Tt],new Ka(Tt.x,Tt.y,0))}function S0(i,e,r,l,d,f,m,v,T,S,P,M,D,z,B){const j=(function(ce,Q,ee,pe,ye,Re,Xe,We){const Je=pe.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,ht=[];for(const nt of Q.positionedLines)for(const Ke of nt.positionedGlyphs){if(!Ke.rect)continue;const Ne=Ke.rect||{};let vt=4,yt=!0,Tt=1,mt=0;const Lt=(ye||We)&&Ke.vertical,On=Ke.metrics.advance*Ke.scale/2;if(We&&Q.verticalizable&&(mt=nt.lineOffset/2-(Ke.imageName?-(ni-Ke.metrics.width*Ke.scale)/2:(Ke.scale-1)*ni)),Ke.imageName){const si=Xe[Ke.imageName];yt=si.sdf,Tt=si.pixelRatio,vt=1/Tt}const Pn=ye?[Ke.x+On,Ke.y]:[0,0];let vr=ye?[0,0]:[Ke.x+On+ee[0],Ke.y+ee[1]-mt],Ti=[0,0];Lt&&(Ti=vr,vr=[0,0]);const $r=Ke.metrics.isDoubleResolution?2:1,xr=(Ke.metrics.left-vt)*Ke.scale-On+vr[0],fr=(-Ke.metrics.top-vt)*Ke.scale+vr[1],Zn=xr+Ne.w/$r*Ke.scale/Tt,Sr=fr+Ne.h/$r*Ke.scale/Tt,Lr=new k(xr,fr),cr=new k(Zn,fr),rs=new k(xr,Sr),Ei=new k(Zn,Sr);if(Lt){const si=new k(-On,On- -17),Tr=-Math.PI/2,qr=12-On,Ar=new k(22-qr,-(Ke.imageName?qr:0)),oi=new k(...Ti);Lr._rotateAround(Tr,si)._add(Ar)._add(oi),cr._rotateAround(Tr,si)._add(Ar)._add(oi),rs._rotateAround(Tr,si)._add(Ar)._add(oi),Ei._rotateAround(Tr,si)._add(Ar)._add(oi)}if(Je){const si=Math.sin(Je),Tr=Math.cos(Je),qr=[Tr,-si,si,Tr];Lr._matMult(qr),cr._matMult(qr),rs._matMult(qr),Ei._matMult(qr)}const is=new k(0,0),Ys=new k(0,0);ht.push({tl:Lr,tr:cr,bl:rs,br:Ei,tex:Ne,writingMode:Q.writingMode,glyphOffset:Pn,sectionIndex:Ke.sectionIndex,isSDF:yt,pixelOffsetTL:is,pixelOffsetBR:Ys,minFontScaleX:0,minFontScaleY:0})}return ht})(0,r,v,d,f,m,l,i.allowVerticalPlacement),G=i.textSizeData;let K=null;G.kind==="source"?(K=[fa*d.layout.get("text-size").evaluate(m,{})],K[0]>Ha&&Vt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):G.kind==="composite"&&(K=[fa*z.compositeTextSizes[0].evaluate(m,{},B),fa*z.compositeTextSizes[1].evaluate(m,{},B)],(K[0]>Ha||K[1]>Ha)&&Vt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,j,K,v,f,m,S,e,T.lineStartIndex,T.lineLength,D,B);for(const ce of P)M[ce]=i.text.placedSymbolArray.length-1;return 4*j.length}function A0(i){for(const e in i)return i[e];return null}function OE(i,e,r,l){const d=i.compareText;if(e in d){const f=d[e];for(let m=f.length-1;m>=0;m--)if(l.dist(f[m])<r)return!0}else d[e]=[];return d[e].push(l),!1}const P0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xg{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=l>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const f=P0[15&l];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new xg(v,m,f,e)}constructor(e,r=64,l=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=P0.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=r,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return bg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:v}=this,T=[0,f.length-1,0],S=[];for(;T.length;){const P=T.pop()||0,M=T.pop()||0,D=T.pop()||0;if(M-D<=v){for(let G=D;G<=M;G++){const K=m[2*G],ce=m[2*G+1];K>=e&&K<=l&&ce>=r&&ce<=d&&S.push(f[G])}continue}const z=D+M>>1,B=m[2*z],j=m[2*z+1];B>=e&&B<=l&&j>=r&&j<=d&&S.push(f[z]),(P===0?e<=B:r<=j)&&(T.push(D),T.push(z-1),T.push(1-P)),(P===0?l>=B:d>=j)&&(T.push(z+1),T.push(M),T.push(1-P))}return S}within(e,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:m}=this,v=[0,d.length-1,0],T=[],S=l*l;for(;v.length;){const P=v.pop()||0,M=v.pop()||0,D=v.pop()||0;if(M-D<=m){for(let G=D;G<=M;G++)M0(f[2*G],f[2*G+1],e,r)<=S&&T.push(d[G]);continue}const z=D+M>>1,B=f[2*z],j=f[2*z+1];M0(B,j,e,r)<=S&&T.push(d[z]),(P===0?e-l<=B:r-l<=j)&&(v.push(D),v.push(z-1),v.push(1-P)),(P===0?e+l>=B:r+l>=j)&&(v.push(z+1),v.push(M),v.push(1-P))}return T}}function bg(i,e,r,l,d,f){if(d-l<=r)return;const m=l+d>>1;C0(i,e,m,l,d,f),bg(i,e,r,l,m-1,1-f),bg(i,e,r,m+1,d,1-f)}function C0(i,e,r,l,d,f){for(;d>l;){if(d-l>600){const S=d-l+1,P=r-l+1,M=Math.log(S),D=.5*Math.exp(2*M/3),z=.5*Math.sqrt(M*D*(S-D)/S)*(P-S/2<0?-1:1);C0(i,e,r,Math.max(l,Math.floor(r-P*D/S+z)),Math.min(d,Math.floor(r+(S-P)*D/S+z)),f)}const m=e[2*r+f];let v=l,T=d;for(Zh(i,e,l,r),e[2*d+f]>m&&Zh(i,e,l,d);v<T;){for(Zh(i,e,v,T),v++,T--;e[2*v+f]<m;)v++;for(;e[2*T+f]>m;)T--}e[2*l+f]===m?Zh(i,e,l,T):(T++,Zh(i,e,T,d)),T<=r&&(l=T+1),r<=T&&(d=T-1)}}function Zh(i,e,r,l){wg(i,r,l),wg(e,2*r,2*l),wg(e,2*r+1,2*l+1)}function wg(i,e,r){const l=i[e];i[e]=i[r],i[r]=l}function M0(i,e,r,l){const d=i-r,f=e-l;return d*d+f*f}var Tg;x.cH=void 0,(Tg=x.cH||(x.cH={})).create="create",Tg.load="load",Tg.fullLoad="fullLoad";let Hp=null,Kh=[];const Eg=1e3/60,Ig="loadTime",Sg="fullLoadTime",FE={mark(i){performance.mark(i)},frame(i){const e=i;Hp!=null&&Kh.push(e-Hp),Hp=e},clearMetrics(){Hp=null,Kh=[],performance.clearMeasures(Ig),performance.clearMeasures(Sg);for(const i in x.cH)performance.clearMarks(x.cH[i])},getPerformanceMetrics(){performance.measure(Ig,x.cH.create,x.cH.load),performance.measure(Sg,x.cH.create,x.cH.fullLoad);const i=performance.getEntriesByName(Ig)[0].duration,e=performance.getEntriesByName(Sg)[0].duration,r=Kh.length,l=1/(Kh.reduce(((f,m)=>f+m),0)/r/1e3),d=Kh.filter((f=>f>Eg)).reduce(((f,m)=>f+(m-Eg)/Eg),0);return{loadTime:i,fullLoadTime:e,fps:l,percentDroppedFrames:d/(r+d)*100,totalFrames:r}}};x.$=J,x.A=He,x.B=Ba,x.C=ei,x.D=Pt,x.E=Ft,x.F=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},x.G=rr,x.H=tr,x.I=Hm,x.J=up,x.K=function(i){if(Mt==null){const e=i.navigator?i.navigator.userAgent:null;Mt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Mt},x.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Q2((()=>this.process())),this.subscription=Rn(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=Cn(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((r,l)=>{const d=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=e?Rn(e.signal,"abort",(()=>{f==null||f.unsubscribe(),delete this.resolveRejects[d];const T={id:d,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)}),J2):null;this.resolveRejects[d]={resolve:T=>{f==null||f.unsubscribe(),r(T)},reject:T=>{f==null||f.unsubscribe(),l(T)}};const m=[],v=Object.assign(Object.assign({},i),{id:d,sourceMapId:this.mapId,origin:location.origin,data:Nl(i.data,m)});this.target.postMessage(v,{transfer:m})}))}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const l=this.abortControllers[r];return delete this.abortControllers[r],void(l&&l.abort())}if(Cn(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return c(this,void 0,void 0,(function*(){if(e.type==="<response>"){const d=this.resolveRejects[i];return delete this.resolveRejects[i],d?void(e.error?d.reject(Vl(e.error)):d.resolve(Vl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Vl(e.data),l=new AbortController;this.abortControllers[i]=l;try{const d=yield this.messageHandlers[e.type](e.sourceMapId,r,l);this.completeTask(i,null,d)}catch(d){this.completeTask(i,d)}}))}completeTask(i,e,r){const l=[];delete this.abortControllers[i];const d={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Nl(e):null,data:Nl(r,l)};this.target.postMessage(d,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.M=Ie,x.N=function(){var i=new He(16);return He!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},x.O=function(i,e,r){var l,d,f,m,v,T,S,P,M,D,z,B,j=r[0],G=r[1],K=r[2];return e===i?(i[12]=e[0]*j+e[4]*G+e[8]*K+e[12],i[13]=e[1]*j+e[5]*G+e[9]*K+e[13],i[14]=e[2]*j+e[6]*G+e[10]*K+e[14],i[15]=e[3]*j+e[7]*G+e[11]*K+e[15]):(d=e[1],f=e[2],m=e[3],v=e[4],T=e[5],S=e[6],P=e[7],M=e[8],D=e[9],z=e[10],B=e[11],i[0]=l=e[0],i[1]=d,i[2]=f,i[3]=m,i[4]=v,i[5]=T,i[6]=S,i[7]=P,i[8]=M,i[9]=D,i[10]=z,i[11]=B,i[12]=l*j+v*G+M*K+e[12],i[13]=d*j+T*G+D*K+e[13],i[14]=f*j+S*G+z*K+e[14],i[15]=m*j+P*G+B*K+e[15]),i},x.P=k,x.Q=function(i,e,r){var l=r[0],d=r[1],f=r[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*d,i[5]=e[5]*d,i[6]=e[6]*d,i[7]=e[7]*d,i[8]=e[8]*f,i[9]=e[9]*f,i[10]=e[10]*f,i[11]=e[11]*f,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.R=ns,x.S=function(i,e,r){var l=e[0],d=e[1],f=e[2],m=e[3],v=e[4],T=e[5],S=e[6],P=e[7],M=e[8],D=e[9],z=e[10],B=e[11],j=e[12],G=e[13],K=e[14],ce=e[15],Q=r[0],ee=r[1],pe=r[2],ye=r[3];return i[0]=Q*l+ee*v+pe*M+ye*j,i[1]=Q*d+ee*T+pe*D+ye*G,i[2]=Q*f+ee*S+pe*z+ye*K,i[3]=Q*m+ee*P+pe*B+ye*ce,i[4]=(Q=r[4])*l+(ee=r[5])*v+(pe=r[6])*M+(ye=r[7])*j,i[5]=Q*d+ee*T+pe*D+ye*G,i[6]=Q*f+ee*S+pe*z+ye*K,i[7]=Q*m+ee*P+pe*B+ye*ce,i[8]=(Q=r[8])*l+(ee=r[9])*v+(pe=r[10])*M+(ye=r[11])*j,i[9]=Q*d+ee*T+pe*D+ye*G,i[10]=Q*f+ee*S+pe*z+ye*K,i[11]=Q*m+ee*P+pe*B+ye*ce,i[12]=(Q=r[12])*l+(ee=r[13])*v+(pe=r[14])*M+(ye=r[15])*j,i[13]=Q*d+ee*T+pe*D+ye*G,i[14]=Q*f+ee*S+pe*z+ye*K,i[15]=Q*m+ee*P+pe*B+ye*ce,i},x.T=Fm,x.U=function(i,e){const r={};for(let l=0;l<e.length;l++){const d=e[l];d in i&&(r[d]=i[d])}return r},x.V=Wa,x.W=At,x.X=Av,x.Y=Sv,x.Z=fe,x._=c,x.a=X,x.a$=Ee,x.a0=Ye,x.a1=Ot,x.a2=Ls,x.a3=Cv,x.a4=Lp,x.a5=St,x.a6=function(i,e,r){if(!i)return e||{};if(!e)return i||{};const l=Dv(i),d=Dv(e);(function(m,v){v.removeAll&&(m.add.clear(),m.update.clear(),m.remove.clear(),v.remove.clear());for(const T of v.remove)m.add.delete(T),m.update.delete(T);for(const[T,S]of v.update){const P=m.update.get(T);P&&(v.update.set(T,eE(P,S)),m.update.delete(T))}})(l,d);const f={};if((l.removeAll||d.removeAll)&&(f.removeAll=!0),f.remove=new Set([...l.remove,...d.remove]),f.add=new Map([...l.add,...d.add]),f.update=new Map([...l.update,...d.update]),f.remove.size&&f.add.size)for(const m of f.add.keys())f.remove.delete(m);return(function(m){const v={};return m.removeAll&&(v.removeAll=m.removeAll),m.remove&&(v.remove=Array.from(m.remove)),m.add&&(v.add=Array.from(m.add.values())),m.update&&(v.update=Array.from(m.update.values())),v})(f)},x.a7=function(i,e){const r=new Map;if(i==null||i.type==null)return r;if(i.type==="Feature"){const l=tg(i,e);return l==null?void 0:(r.set(l,i),r)}if(i.type==="FeatureCollection"){const l=new Set;for(const d of i.features){const f=tg(d,e);if(f==null||l.has(f))return;l.add(f),r.set(f,d)}return r}},x.a8=function(i,e,r){var l,d;const f=[];if(e.removeAll)i.clear();else if(e.remove)for(const m of e.remove){const v=i.get(m);v&&(f.push(v.geometry),i.delete(m))}if(e.add)for(const m of e.add){const v=tg(m,r);if(v==null)continue;const T=i.get(v);T&&f.push(T.geometry),f.push(m.geometry),i.set(v,m)}if(e.update)for(const m of e.update){const v=i.get(m.id);if(!v)continue;const T=!!m.newGeometry,S=m.removeAllProperties||((l=m.removeProperties)===null||l===void 0?void 0:l.length)>0||((d=m.addOrUpdateProperties)===null||d===void 0?void 0:d.length)>0;if(!T&&!S)continue;f.push(v.geometry);const P=Object.assign({},v);if(i.set(m.id,P),T&&(f.push(m.newGeometry),P.geometry=m.newGeometry),S){if(P.properties=m.removeAllProperties?{}:Object.assign({},P.properties||{}),m.removeProperties)for(const M of m.removeProperties)delete P.properties[M];if(m.addOrUpdateProperties)for(const{key:M,value:D}of m.addOrUpdateProperties)P.properties[M]=D}}return f},x.a9=qh,x.aA=function(i,{uSize:e,uSizeT:r},{lowerSize:l,upperSize:d}){return i.kind==="source"?l/fa:i.kind==="composite"?rr.number(l/fa,d/fa,r):e},x.aB=function(i,e){var r=e[0],l=e[1],d=e[2],f=e[3],m=e[4],v=e[5],T=e[6],S=e[7],P=e[8],M=e[9],D=e[10],z=e[11],B=e[12],j=e[13],G=e[14],K=e[15],ce=r*v-l*m,Q=r*T-d*m,ee=r*S-f*m,pe=l*T-d*v,ye=l*S-f*v,Re=d*S-f*T,Xe=P*j-M*B,We=P*G-D*B,Je=P*K-z*B,ht=M*G-D*j,nt=M*K-z*j,Ke=D*K-z*G,Ne=ce*Ke-Q*nt+ee*ht+pe*Je-ye*We+Re*Xe;return Ne?(i[0]=(v*Ke-T*nt+S*ht)*(Ne=1/Ne),i[1]=(d*nt-l*Ke-f*ht)*Ne,i[2]=(j*Re-G*ye+K*pe)*Ne,i[3]=(D*ye-M*Re-z*pe)*Ne,i[4]=(T*Je-m*Ke-S*We)*Ne,i[5]=(r*Ke-d*Je+f*We)*Ne,i[6]=(G*ee-B*Re-K*Q)*Ne,i[7]=(P*Re-D*ee+z*Q)*Ne,i[8]=(m*nt-v*Je+S*Xe)*Ne,i[9]=(l*Je-r*nt-f*Xe)*Ne,i[10]=(B*ye-j*ee+K*ce)*Ne,i[11]=(M*ee-P*ye-z*ce)*Ne,i[12]=(v*We-m*ht-T*Xe)*Ne,i[13]=(r*ht-l*We+d*Xe)*Ne,i[14]=(j*Q-B*pe-G*ce)*Ne,i[15]=(P*pe-M*Q+D*ce)*Ne,i):null},x.aC=vn,x.aD=function(i){var e=i[0],r=i[1];return Math.sqrt(e*e+r*r)},x.aE=function(i){return i[0]=0,i[1]=0,i},x.aF=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i},x.aG=Km,x.aH=Qt,x.aI=function(i,e,r,l){const d=e.y-i.y,f=e.x-i.x,m=l.y-r.y,v=l.x-r.x,T=m*f-v*d;if(T===0)return null;const S=(v*(i.y-r.y)-m*(i.x-r.x))/T;return new k(i.x+S*f,i.y+S*d)},x.aJ=f0,x.aK=iu,x.aL=function(i){let e=1/0,r=1/0,l=-1/0,d=-1/0;for(const f of i)e=Math.min(e,f.x),r=Math.min(r,f.y),l=Math.max(l,f.x),d=Math.max(d,f.y);return[e,r,l,d]},x.aM=ni,x.aN=In,x.aO=function(i,e,r,l,d=!1){if(!r[0]&&!r[1])return[0,0];const f=d?l==="map"?-i.bearingInRadians:0:l==="viewport"?i.bearingInRadians:0;if(f){const m=Math.sin(f),v=Math.cos(f);r=[r[0]*v-r[1]*m,r[0]*m+r[1]*v]}return[d?r[0]:In(e,r[0],i.zoom),d?r[1]:In(e,r[1],i.zoom)]},x.aQ=Zm,x.aR=vg,x.aS=Wm,x.aT=xg,x.aU=Rr,x.aV=Pp,x.aW=te,x.aX=pt,x.aY=Oe,x.aZ=Xt,x.a_=Mv,x.aa=Jl,x.ab=25,x.ac=eg,x.ad=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((r=>{e.onloadstart=()=>{r(e)};for(const l of i){const d=window.document.createElement("source");Be(l)||(e.crossOrigin="Anonymous"),d.src=l,e.appendChild(d)}}))},x.ae=Ue,x.af=function(){return pn++},x.ag=p,x.ah=du,x.ai=Wh,x.aj=Cl,x.ak=zo,x.al=zv,x.am=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,l,d,f)=>{const m=d||f;return e[l]=!m||m.toLowerCase(),""})),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},x.an=xt,x.ao=85.051129,x.ap=xn,x.aq=function(i){return Math.pow(2,i)},x.ar=at,x.as=Pv,x.at=function(i){return Math.log(i)/Math.LN2},x.au=function(i){var e=i[0],r=i[1];return e*e+r*r},x.av=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((T=>T.canonical.z)));let r=1/0,l=-1/0,d=1/0,f=-1/0;const m=[];for(const T of i){const{x:S,y:P,z:M}=T.canonical,D=Math.pow(2,e-M),z=S*D,B=P*D;m.push({id:T,x:z,y:B}),z<r&&(r=z),z>l&&(l=z),B<d&&(d=B),B>f&&(f=B)}const v=new Set;for(const T of m)T.x!==r&&T.x!==l&&T.y!==d&&T.y!==f||v.add(T.id);return v},x.aw=function(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},x.ax=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,r){const l=i.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const d={value:e,timeout:void 0};if(r!==void 0&&(d.timeout=setTimeout((()=>{this.remove(i,d)}),r)),this.data[l].push(d),this.order.push(l),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const r=i.wrapped().key,l=e===void 0?0:this.data[r].indexOf(e),d=this.data[r][l];return this.data[r].splice(l,1),d.timeout&&clearTimeout(d.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(d.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const r in this.data)for(const l of this.data[r])i(l.value)||e.push(l);for(const r of e)this.remove(r.value.tileID,r)}},x.ay=function(i,e){let r=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:f,maxZoom:m}=i,v=d?xt(Jr.interpolationFactor(d,e,f,m),0,1):0;i.kind==="camera"?l=rr.number(i.minSize,i.maxSize,v):r=v}return{uSizeT:r,uSize:l}},x.b=Kt,x.b$=da,x.b0=ae,x.b1=function(i){var e=new He(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},x.b2=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},x.b3=function(i,e){var r=e[0],l=e[1],d=e[2],f=r*r+l*l+d*d;return f>0&&(f=1/Math.sqrt(f)),i[0]=e[0]*f,i[1]=e[1]*f,i[2]=e[2]*f,i},x.b4=be,x.b5=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},x.b6=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},x.b7=he,x.b8=function(i,e,r){const l=e[0]*r[0]+e[1]*r[1]+e[2]*r[2];return l===0?null:(-(i[0]*r[0]+i[1]*r[1]+i[2]*r[2])-r[3])/l},x.b9=de,x.bA=function(i,e,r,l){return i[0]=e[0]+r[0]*l,i[1]=e[1]+r[1]*l,i[2]=e[2]+r[2]*l,i},x.bB=gt,x.bC=function(i,e,r){var l=r[0],d=r[1],f=r[2],m=r[3],v=e[0],T=e[1],S=e[2],P=d*S-f*T,M=f*v-l*S,D=l*T-d*v;return i[0]=v+m*(P+=P)+d*(D+=D)-f*(M+=M),i[1]=T+m*M+f*P-l*D,i[2]=S+m*D+l*M-d*P,i},x.bD=function(i,e,r){const l=(function(T){var S=T[3],P=T[4],M=T[5],D=T[6],z=T[7],B=T[8];return T[0]*(B*P-M*z)+T[1]*(-B*S+M*D)+T[2]*(z*S-P*D)})([i[0],i[1],i[2],e[0],e[1],e[2],r[0],r[1],r[2]]);if(l===0)return null;const d=be([],[e[0],e[1],e[2]],[r[0],r[1],r[2]]),f=be([],[r[0],r[1],r[2]],[i[0],i[1],i[2]]),m=be([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),v=Ee([],d,-i[3]);return ae(v,v,Ee([],f,-e[3])),ae(v,v,Ee([],m,-r[3])),Ee(v,v,1/l),v},x.bE=Jm,x.bF=function(){return new Float64Array(4)},x.bG=function(i,e,r,l){var d=[],f=[];return d[0]=e[0]-r[0],d[1]=e[1]-r[1],d[2]=e[2]-r[2],f[0]=d[0]*Math.cos(l)-d[1]*Math.sin(l),f[1]=d[0]*Math.sin(l)+d[1]*Math.cos(l),f[2]=d[2],i[0]=f[0]+r[0],i[1]=f[1]+r[1],i[2]=f[2]+r[2],i},x.bH=function(i,e,r,l){var d=[],f=[];return d[0]=e[0]-r[0],d[1]=e[1]-r[1],d[2]=e[2]-r[2],f[0]=d[0],f[1]=d[1]*Math.cos(l)-d[2]*Math.sin(l),f[2]=d[1]*Math.sin(l)+d[2]*Math.cos(l),i[0]=f[0]+r[0],i[1]=f[1]+r[1],i[2]=f[2]+r[2],i},x.bI=function(i,e,r,l){var d=[],f=[];return d[0]=e[0]-r[0],d[1]=e[1]-r[1],d[2]=e[2]-r[2],f[0]=d[2]*Math.sin(l)+d[0]*Math.cos(l),f[1]=d[1],f[2]=d[2]*Math.cos(l)-d[0]*Math.sin(l),i[0]=f[0]+r[0],i[1]=f[1]+r[1],i[2]=f[2]+r[2],i},x.bJ=function(i,e,r){var l=Math.sin(r),d=Math.cos(r),f=e[0],m=e[1],v=e[2],T=e[3],S=e[8],P=e[9],M=e[10],D=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=f*d-S*l,i[1]=m*d-P*l,i[2]=v*d-M*l,i[3]=T*d-D*l,i[8]=f*l+S*d,i[9]=m*l+P*d,i[10]=v*l+M*d,i[11]=T*l+D*d,i},x.bK=function(i,e){const r=jt(i,360),l=jt(e,360),d=l-r,f=l>r?d-360:d+360;return Math.abs(d)<Math.abs(f)?d:f},x.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},x.bM=function(i,e,r,l){const d=Math.sqrt(i*i+e*e),f=Math.sqrt(r*r+l*l);i/=d,e/=d,r/=f,l/=f;const m=Math.acos(i*r+e*l);return-e*r+i*l>0?m:-m},x.bN=function(i,e){const r=jt(i,2*Math.PI),l=jt(e,2*Math.PI);return Math.min(Math.abs(r-l),Math.abs(r-l+2*Math.PI),Math.abs(r-l-2*Math.PI))},x.bO=function(){const i={},e=Me.$version;for(const r in Me.$root){const l=Me.$root[r];if(l.required){let d=null;d=r==="version"?e:l.type==="array"?[]:{},d!=null&&(i[r]=d)}}return i},x.bP=ke,x.bQ=_h,x.bR=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let l=0;l<e.length;l++)if(!i(e[l],r[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const l in e)if(!i(e[l],r[l]))return!1;return!0}return e===r},x.bS=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=An(i[r],e[i[r].ref]));return i},x.bT=function(i,e){if(i.type==="custom")return new Y2(i,e);switch(i.type){case"background":return new X2(i,e);case"circle":return new LT(i,e);case"color-relief":return new BT(i,e);case"fill":return new t2(i,e);case"fill-extrusion":return new p2(i,e);case"heatmap":return new OT(i,e);case"hillshade":return new NT(i,e);case"line":return new x2(i,e);case"raster":return new Pm(i,e);case"symbol":return new Dp(i,e)}},x.bU=i=>i.type==="raster",x.bV=Sn,x.bW=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!Ct(i.version,e.version))return[{command:"setStyle",args:[e]}];Ct(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),Ct(i.state,e.state)||r.push({command:"setGlobalState",args:[e.state]}),Ct(i.centerAltitude,e.centerAltitude)||r.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Ct(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),Ct(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),Ct(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),Ct(i.roll,e.roll)||r.push({command:"setRoll",args:[e.roll]}),Ct(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),Ct(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),Ct(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),Ct(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),Ct(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),Ct(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]}),Ct(i.projection,e.projection)||r.push({command:"setProjection",args:[e.projection]});const l={},d=[];(function(m,v,T,S){let P;for(P in v=v||{},m=m||{})Object.prototype.hasOwnProperty.call(m,P)&&(Object.prototype.hasOwnProperty.call(v,P)||je(P,T,S));for(P in v)Object.prototype.hasOwnProperty.call(v,P)&&(Object.prototype.hasOwnProperty.call(m,P)?Ct(m[P],v[P])||(m[P].type==="geojson"&&v[P].type==="geojson"&&Fe(m,v,P)?Yt(T,{command:"setGeoJSONSourceData",args:[P,v[P].data]}):dt(P,v,T,S)):_n(P,v,T))})(i.sources,e.sources,d,l);const f=[];i.layers&&i.layers.forEach((m=>{"source"in m&&l[m.source]?r.push({command:"removeLayer",args:[m.id]}):f.push(m)})),r=r.concat(d),(function(m,v,T){v=v||[];const S=(m=m||[]).map(Nt),P=v.map(Nt),M=m.reduce(jn,{}),D=v.reduce(jn,{}),z=S.slice(),B=Object.create(null);let j,G,K,ce,Q;for(let ee=0,pe=0;ee<S.length;ee++)j=S[ee],Object.prototype.hasOwnProperty.call(D,j)?pe++:(Yt(T,{command:"removeLayer",args:[j]}),z.splice(z.indexOf(j,pe),1));for(let ee=0,pe=0;ee<P.length;ee++)j=P[P.length-1-ee],z[z.length-1-ee]!==j&&(Object.prototype.hasOwnProperty.call(M,j)?(Yt(T,{command:"removeLayer",args:[j]}),z.splice(z.lastIndexOf(j,z.length-pe),1)):pe++,ce=z[z.length-ee],Yt(T,{command:"addLayer",args:[D[j],ce]}),z.splice(z.length-ee,0,j),B[j]=!0);for(let ee=0;ee<P.length;ee++)if(j=P[ee],G=M[j],K=D[j],!B[j]&&!Ct(G,K))if(Ct(G.source,K.source)&&Ct(G["source-layer"],K["source-layer"])&&Ct(G.type,K.type)){for(Q in wt(G.layout,K.layout,T,j,null,"setLayoutProperty"),wt(G.paint,K.paint,T,j,null,"setPaintProperty"),Ct(G.filter,K.filter)||Yt(T,{command:"setFilter",args:[j,K.filter]}),Ct(G.minzoom,K.minzoom)&&Ct(G.maxzoom,K.maxzoom)||Yt(T,{command:"setLayerZoomRange",args:[j,K.minzoom,K.maxzoom]}),G)Object.prototype.hasOwnProperty.call(G,Q)&&Q!=="layout"&&Q!=="paint"&&Q!=="filter"&&Q!=="metadata"&&Q!=="minzoom"&&Q!=="maxzoom"&&(Q.indexOf("paint.")===0?wt(G[Q],K[Q],T,j,Q.slice(6),"setPaintProperty"):Ct(G[Q],K[Q])||Yt(T,{command:"setLayerProperty",args:[j,Q,K[Q]]}));for(Q in K)Object.prototype.hasOwnProperty.call(K,Q)&&!Object.prototype.hasOwnProperty.call(G,Q)&&Q!=="layout"&&Q!=="paint"&&Q!=="filter"&&Q!=="metadata"&&Q!=="minzoom"&&Q!=="maxzoom"&&(Q.indexOf("paint.")===0?wt(G[Q],K[Q],T,j,Q.slice(6),"setPaintProperty"):Ct(G[Q],K[Q])||Yt(T,{command:"setLayerProperty",args:[j,Q,K[Q]]}))}else Yt(T,{command:"removeLayer",args:[j]}),ce=z[z.lastIndexOf(j)+1],Yt(T,{command:"addLayer",args:[K,ce]})})(f,e.layers,r)}catch(l){console.warn("Unable to compute style diff:",l),r=[{command:"setStyle",args:[e]}]}return r},x.bX=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},x.bY=Zt,x.bZ=ur,x.b_=class extends Vi{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},x.ba=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},x.bb=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},x.bc=Rv,x.bd=pu,x.be=function(i,e,r,l,d){var f=1/Math.tan(e/2);if(i[0]=f/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0){var m=1/(l-d);i[10]=(d+l)*m,i[14]=2*d*l*m}else i[10]=-1,i[14]=-2*l;return i},x.bf=function(i){var e=new He(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},x.bg=function(i,e,r){var l=Math.sin(r),d=Math.cos(r),f=e[0],m=e[1],v=e[2],T=e[3],S=e[4],P=e[5],M=e[6],D=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=f*d+S*l,i[1]=m*d+P*l,i[2]=v*d+M*l,i[3]=T*d+D*l,i[4]=S*d-f*l,i[5]=P*d-m*l,i[6]=M*d-v*l,i[7]=D*d-T*l,i},x.bh=function(i,e,r){var l=Math.sin(r),d=Math.cos(r),f=e[4],m=e[5],v=e[6],T=e[7],S=e[8],P=e[9],M=e[10],D=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=f*d+S*l,i[5]=m*d+P*l,i[6]=v*d+M*l,i[7]=T*d+D*l,i[8]=S*d-f*l,i[9]=P*d-m*l,i[10]=M*d-v*l,i[11]=D*d-T*l,i},x.bi=function(){const i=new Float32Array(16);return at(i),i},x.bj=function(){const i=new Float64Array(16);return at(i),i},x.bk=function(){return new Float64Array(16)},x.bl=function(i,e,r){const l=new Float64Array(4);return gt(l,i,e-90,r),l},x.bm=function(i,e,r,l){var d,f,m,v,T,S=e[0],P=e[1],M=e[2],D=e[3],z=r[0],B=r[1],j=r[2],G=r[3];return(f=S*z+P*B+M*j+D*G)<0&&(f=-f,z=-z,B=-B,j=-j,G=-G),1-f>qe?(d=Math.acos(f),m=Math.sin(d),v=Math.sin((1-l)*d)/m,T=Math.sin(l*d)/m):(v=1-l,T=l),i[0]=v*S+T*z,i[1]=v*P+T*B,i[2]=v*M+T*j,i[3]=v*D+T*G,i},x.bn=function(i){const e=new Float64Array(9);(function(f,m){var v=m[0],T=m[1],S=m[2],P=m[3],M=v+v,D=T+T,z=S+S,B=v*M,j=T*M,G=T*D,K=S*M,ce=S*D,Q=S*z,ee=P*M,pe=P*D,ye=P*z;f[0]=1-G-Q,f[3]=j-ye,f[6]=K+pe,f[1]=j+ye,f[4]=1-B-Q,f[7]=ce-ee,f[2]=K-pe,f[5]=ce+ee,f[8]=1-B-G})(e,i);const r=Xt(-Math.asin(xt(e[2],-1,1)));let l,d;return Math.hypot(e[5],e[8])<.001?(l=0,d=-Xt(Math.atan2(e[3],e[4]))):(l=Xt(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),d=Xt(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:l,pitch:r+90,bearing:d}},x.bo=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},x.bp=fn,x.bq=ha,x.br=cu,x.bs=Nh,x.bt=lu,x.bu=Ht,x.bv=Qn,x.bw=Dn,x.bx=function(i,e,r,l,d){return Ht(l,d,xt((i-e)/(r-e),0,1))},x.by=jt,x.bz=function(){return new Float64Array(3)},x.c=ge,x.c$=function(i,e,r,l,d){return c(this,void 0,void 0,(function*(){if(Ye())try{return yield Ot(i,e,r,l,d)}catch{}return(function(f,m,v,T,S){const P=f.width,M=f.height;tn&&nn||(tn=new OffscreenCanvas(P,M),nn=tn.getContext("2d",{willReadFrequently:!0})),tn.width=P,tn.height=M,nn.drawImage(f,0,0,P,M);const D=nn.getImageData(m,v,T,S);return nn.clearRect(0,0,P,M),D.data})(i,e,r,l,d)}))},x.c0=class extends Vi{constructor(i,e){super(i,e),this.current=vs}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},x.c1=Xl,x.c2=class extends Vi{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},x.c3=class extends Vi{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},x.c4=et,x.c5=function(i,e){var r=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=r,i[2]=0,i[3]=-r,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},x.c6=function(i,e,r){var l=e[0],d=e[1],f=e[2];return i[0]=l*r[0]+d*r[3]+f*r[6],i[1]=l*r[1]+d*r[4]+f*r[7],i[2]=l*r[2]+d*r[5]+f*r[8],i},x.c7=function(i,e,r,l,d,f,m){var v=1/(e-r),T=1/(l-d),S=1/(f-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*S,i[11]=0,i[12]=(e+r)*v,i[13]=(d+l)*T,i[14]=(m+f)*S,i[15]=1,i},x.c8=class extends Vi{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let r=0;r<i.length;r++)e[4*r]=i[r].r,e[4*r+1]=i[r].g,e[4*r+2]=i[r].b,e[4*r+3]=i[r].a;this.gl.uniform4fv(this.location,e)}}},x.c9=class extends Vi{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},x.cA=function(i,e){return Pe[e]&&"touches"in i},x.cB=function(i){return Pe[i]||W[i]},x.cC=function(i,e,r){var l=e[0],d=e[1];return i[0]=r[0]*l+r[4]*d+r[12],i[1]=r[1]*l+r[5]*d+r[13],i},x.cD=function(i,e){const{x:r,y:l}=qh.fromLngLat(e);return!(i<0||i>25||l<0||l>=1||r<0||r>=1)},x.cE=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},x.cF=class extends Yc{},x.cG=FE,x.cI=we,x.cJ=function(i,e){ge.REGISTERED_PROTOCOLS[i]=e},x.cK=function(i){delete ge.REGISTERED_PROTOCOLS[i]},x.cL=function(i,e){const r={};for(let d=0;d<i.length;d++){const f=e&&e[i[d].id]||Jd(i[d]);e&&(e[i[d].id]=f);let m=r[f];m||(m=r[f]=[]),m.push(i[d])}const l=[];for(const d in r)l.push(r[d]);return l},x.cM=bt,x.cN=Lv,x.cO=d0,x.cP=mv,x.cQ=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=St/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,l=e._unevaluatedLayout._values,d={layoutIconSize:l["icon-size"].possiblyEvaluate(new tr(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new tr(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new tr(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:P}=i.bucket.textSizeData;d.compositeTextSizes=[l["text-size"].possiblyEvaluate(new tr(S),i.canonical),l["text-size"].possiblyEvaluate(new tr(P),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:P}=i.bucket.iconSizeData;d.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new tr(S),i.canonical),l["icon-size"].possiblyEvaluate(new tr(P),i.canonical)]}const f=r.get("text-line-height")*ni,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",v=r.get("text-keep-upright"),T=r.get("text-size");for(const S of i.bucket.features){const P=r.get("text-font").evaluate(S,{},i.canonical).join(","),M=T.evaluate(S,{},i.canonical),D=d.layoutTextSize.evaluate(S,{},i.canonical),z=d.layoutIconSize.evaluate(S,{},i.canonical),B={horizontal:{},vertical:void 0},j=S.text;let G,K=[0,0];if(j){const ee=j.toString(),pe=r.get("text-letter-spacing").evaluate(S,{},i.canonical)*ni,ye=Sm(ee)?pe:0,Re=r.get("text-anchor").evaluate(S,{},i.canonical),Xe=I0(e,S,i.canonical);if(!Xe){const nt=r.get("text-radial-offset").evaluate(S,{},i.canonical);K=nt?E0(Re,[nt*ni,yg]):r.get("text-offset").evaluate(S,{},i.canonical).map((Ke=>Ke*ni))}let We=m?"center":r.get("text-justify").evaluate(S,{},i.canonical);const Je=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(S,{},i.canonical)*ni:1/0,ht=()=>{i.bucket.allowVerticalPlacement&&$a(ee)&&(B.vertical=kp(j,i.glyphMap,i.glyphPositions,i.imagePositions,P,Je,f,Re,"left",ye,K,x.az.vertical,!0,D,M))};if(!m&&Xe){const nt=new Set;if(We==="auto")for(let Ne=0;Ne<Xe.values.length;Ne+=2)nt.add(vg(Xe.values[Ne]));else nt.add(We);let Ke=!1;for(const Ne of nt)if(!B.horizontal[Ne])if(Ke)B.horizontal[Ne]=B.horizontal[0];else{const vt=kp(j,i.glyphMap,i.glyphPositions,i.imagePositions,P,Je,f,"center",Ne,ye,K,x.az.horizontal,!1,D,M);vt&&(B.horizontal[Ne]=vt,Ke=vt.positionedLines.length===1)}ht()}else{We==="auto"&&(We=vg(Re));const nt=kp(j,i.glyphMap,i.glyphPositions,i.imagePositions,P,Je,f,Re,We,ye,K,x.az.horizontal,!1,D,M);nt&&(B.horizontal[We]=nt),ht(),$a(ee)&&m&&v&&(B.vertical=kp(j,i.glyphMap,i.glyphPositions,i.imagePositions,P,Je,f,Re,We,ye,K,x.az.vertical,!1,D,M))}}let ce=!1;if(S.icon&&S.icon.name){const ee=i.imageMap[S.icon.name];ee&&(G=H2(i.imagePositions[S.icon.name],r.get("icon-offset").evaluate(S,{},i.canonical),r.get("icon-anchor").evaluate(S,{},i.canonical)),ce=!!ee.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ce:i.bucket.sdfIcons!==ce&&Vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ee.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Q=A0(B.horizontal)||B.vertical;i.bucket.iconsInText=!!Q&&Q.iconsInText,(Q||G)&&zE(i.bucket,S,B,G,i.imageMap,d,D,z,K,ce,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},x.cR=Um,x.cS=$m,x.cT=qm,x.cU=function(i){const e=new Mp;return(function(r,l){for(const d in r.layers)l.writeMessage(3,bE,r.layers[d])})(i,e),e.finish()},x.cV=function(i,e,r,l,d,f){let m=m0(i,e,r,d,0);return m=m0(m,e,l,f,1),m},x.cW=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const r=this.map.keys().next().value;this.map.delete(r)}this.map.set(i,e)}clear(){this.map.clear()}},x.cX=Yy,x.cY=Mp,x.cZ=u0,x.c_=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},x.ca=class extends ca{},x.cb=E2,x.cc=class extends Kl{},x.cd=Om,x.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},x.cf=Oy,x.cg=function(i,e,r){var l=e[0],d=e[1],f=e[2],m=r[3]*l+r[7]*d+r[11]*f+r[15];return i[0]=(r[0]*l+r[4]*d+r[8]*f+r[12])/(m=m||1),i[1]=(r[1]*l+r[5]*d+r[9]*f+r[13])/m,i[2]=(r[2]*l+r[6]*d+r[10]*f+r[14])/m,i},x.ch=class extends Eh{},x.ci=class extends t{},x.cj=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},x.ck=function(i,e){var r=i[0],l=i[1],d=i[2],f=i[3],m=i[4],v=i[5],T=i[6],S=i[7],P=i[8],M=i[9],D=i[10],z=i[11],B=i[12],j=i[13],G=i[14],K=i[15],ce=e[0],Q=e[1],ee=e[2],pe=e[3],ye=e[4],Re=e[5],Xe=e[6],We=e[7],Je=e[8],ht=e[9],nt=e[10],Ke=e[11],Ne=e[12],vt=e[13],yt=e[14],Tt=e[15];return Math.abs(r-ce)<=qe*Math.max(1,Math.abs(r),Math.abs(ce))&&Math.abs(l-Q)<=qe*Math.max(1,Math.abs(l),Math.abs(Q))&&Math.abs(d-ee)<=qe*Math.max(1,Math.abs(d),Math.abs(ee))&&Math.abs(f-pe)<=qe*Math.max(1,Math.abs(f),Math.abs(pe))&&Math.abs(m-ye)<=qe*Math.max(1,Math.abs(m),Math.abs(ye))&&Math.abs(v-Re)<=qe*Math.max(1,Math.abs(v),Math.abs(Re))&&Math.abs(T-Xe)<=qe*Math.max(1,Math.abs(T),Math.abs(Xe))&&Math.abs(S-We)<=qe*Math.max(1,Math.abs(S),Math.abs(We))&&Math.abs(P-Je)<=qe*Math.max(1,Math.abs(P),Math.abs(Je))&&Math.abs(M-ht)<=qe*Math.max(1,Math.abs(M),Math.abs(ht))&&Math.abs(D-nt)<=qe*Math.max(1,Math.abs(D),Math.abs(nt))&&Math.abs(z-Ke)<=qe*Math.max(1,Math.abs(z),Math.abs(Ke))&&Math.abs(B-Ne)<=qe*Math.max(1,Math.abs(B),Math.abs(Ne))&&Math.abs(j-vt)<=qe*Math.max(1,Math.abs(j),Math.abs(vt))&&Math.abs(G-yt)<=qe*Math.max(1,Math.abs(G),Math.abs(yt))&&Math.abs(K-Tt)<=qe*Math.max(1,Math.abs(K),Math.abs(Tt))},x.cl=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.cm=i=>i.type==="symbol",x.cn=i=>i.type==="circle",x.co=i=>i.type==="heatmap",x.cp=i=>i.type==="line",x.cq=i=>i.type==="fill",x.cr=i=>i.type==="fill-extrusion",x.cs=i=>i.type==="hillshade",x.ct=i=>i.type==="color-relief",x.cu=i=>i.type==="background",x.cv=i=>i.type==="custom",x.cw=kn,x.cx=function(i,e,r){const l=gn(e.x-r.x,e.y-r.y),d=gn(i.x-r.x,i.y-r.y),f=Math.atan2(l[0]*d[1]-l[1]*d[0],(function(m,v){return m[0]*v[0]+m[1]*v[1]})(l,d));return Xt(f)},x.cy=Et,x.cz=function(i,e){return W[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},x.d=Be,x.d0=Vy,x.d1=O,x.d2=class{constructor(i,e){this.layers={[Wh]:this},this.name=Wh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new xE(this.features[i],this.extent)}},x.d3=Pl,x.d4=ko,x.e=Wt,x.f=i=>c(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),x.g=V,x.h=i=>new Promise(((e,r)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=$t}))},l.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const d=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(d):$t})),x.i=Cn,x.j=(i,e)=>Ge(Wt(i,{type:"json"}),e),x.k=kt,x.l=It,x.m=Ge,x.n=(i,e)=>Ge(Wt(i,{type:"arrayBuffer"}),e),x.o=function(i){return new Mp(i).readFields(N2,[])},x.p=fv,x.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},x.r=Dh,x.s=Rn,x.t=Ai,x.u=Me,x.v=Ol,x.w=Vt,x.x=wh,x.y=Fl,x.z=Ul})),g("worker",["./shared"],(function(x){class c{constructor(W,H){this.keyCache={},W&&this.replace(W,H)}replace(W,H){this._layerConfigs={},this._layers={},this.update(W,[],H)}update(W,H,X){for(const ge of W){this._layerConfigs[ge.id]=ge;const V=this._layers[ge.id]=x.bT(ge,X);V._featureFilter=x.aj(V.filter,X),this.keyCache[ge.id]&&delete this.keyCache[ge.id]}for(const ge of H)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const fe=x.cL(Object.values(this._layerConfigs),this.keyCache);for(const ge of fe){const V=ge.map((it=>this._layers[it.id])),Ie=V[0];if(Ie.isHidden())continue;const we=Ie.source||"";let ke=this.familiesBySource[we];ke||(ke=this.familiesBySource[we]={});const Ge=Ie.sourceLayer||x.ai;let Be=ke[Ge];Be||(Be=ke[Ge]=[]),Be.push(V)}}}class k{constructor(W){const H={},X=[];for(const Ie in W){const we=W[Ie],ke=H[Ie]={};for(const Ge in we){const Be=we[+Ge];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const it={x:0,y:0,w:Be.bitmap.width+2,h:Be.bitmap.height+2};X.push(it),ke[Ge]={rect:it,metrics:Be.metrics}}}const{w:fe,h:ge}=x.p(X),V=new x.r({width:fe||1,height:ge||1});for(const Ie in W){const we=W[Ie];for(const ke in we){const Ge=we[+ke];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const Be=H[Ie][ke].rect;x.r.copy(Ge.bitmap,V,{x:0,y:0},{x:Be.x+1,y:Be.y+1},Ge.bitmap)}}this.image=V,this.positions=H}}x.cM("GlyphAtlas",k);class O{constructor(W){this.tileID=new x.a2(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,H,X,fe,ge){return x._(this,void 0,void 0,(function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new x.ag;const V=new x.cN(Object.keys(W.layers).sort()),Ie=new x.cO(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const we={},ke={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:X,subdivisionGranularity:ge},Ge=H.familiesBySource[this.source];for(const Fe in Ge){const wt=W.layers[Fe];if(!wt)continue;wt.version===1&&x.w(`Vector tile source "${this.source}" layer "${Fe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Nt=V.encode(Fe),jn=[];for(let Ue=0;Ue<wt.length;Ue++){const $n=wt.feature(Ue),Jn=Ie.getId($n,Fe);jn.push({feature:$n,id:Jn,index:Ue,sourceLayerIndex:Nt})}for(const Ue of Ge[Fe]){const $n=Ue[0];$n.source!==this.source&&x.w(`layer.source = ${$n.source} does not equal this.source = ${this.source}`),$n.isHidden(this.zoom,!0)||(U(Ue,this.zoom,X),(we[$n.id]=$n.createBucket({index:Ie.bucketLayerIDs.length,layers:Ue,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Nt,sourceID:this.source})).populate(jn,ke,this.tileID.canonical),Ie.bucketLayerIDs.push(Ue.map((Jn=>Jn.id))))}}const Be=x.bY(ke.glyphDependencies,(Fe=>Object.keys(Fe).map(Number)));this.inFlightDependencies.forEach((Fe=>Fe==null?void 0:Fe.abort())),this.inFlightDependencies=[];let it=Promise.resolve({});if(Object.keys(Be).length){const Fe=new AbortController;this.inFlightDependencies.push(Fe),it=fe.sendAsync({type:"GG",data:{stacks:Be,source:this.source,tileID:this.tileID,type:"glyphs"}},Fe)}const ft=Object.keys(ke.iconDependencies);let It=Promise.resolve({});if(ft.length){const Fe=new AbortController;this.inFlightDependencies.push(Fe),It=fe.sendAsync({type:"GI",data:{icons:ft,source:this.source,tileID:this.tileID,type:"icons"}},Fe)}const kt=Object.keys(ke.patternDependencies);let Ft=Promise.resolve({});if(kt.length){const Fe=new AbortController;this.inFlightDependencies.push(Fe),Ft=fe.sendAsync({type:"GI",data:{icons:kt,source:this.source,tileID:this.tileID,type:"patterns"}},Fe)}const Me=ke.dashDependencies;let rn=Promise.resolve({});if(Object.keys(Me).length){const Fe=new AbortController;this.inFlightDependencies.push(Fe),rn=fe.sendAsync({type:"GDA",data:{dashes:Me}},Fe)}const[An,Ct,Yt,_n]=yield Promise.all([it,It,Ft,rn]),je=new k(An),dt=new x.cP(Ct,Yt);for(const Fe in we){const wt=we[Fe];wt instanceof x.ah?(U(wt.layers,this.zoom,X),x.cQ({bucket:wt,glyphMap:An,glyphPositions:je.positions,imageMap:Ct,imagePositions:dt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ke.subdivisionGranularity})):wt.hasDependencies&&(wt instanceof x.cR||wt instanceof x.cS||wt instanceof x.cT)&&(U(wt.layers,this.zoom,X),wt.addFeatures(ke,this.tileID.canonical,dt.patternPositions,_n))}return this.status="done",{buckets:Object.values(we).filter((Fe=>!Fe.isEmpty())),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:je.image,imageAtlas:dt,dashPositions:_n,glyphMap:this.returnDependencies?An:null,iconMap:this.returnDependencies?Ct:null,glyphPositions:this.returnDependencies?je.positions:null}}))}}function U(Pe,W,H){const X=new x.H(W);for(const fe of Pe)fe.recalculate(X,H)}class Y{constructor(W,H,X,fe,ge){this.type=W,this.properties=X||{},this.extent=ge,this.pointsArray=H,this.id=fe}loadGeometry(){return this.pointsArray.map((W=>W.map((H=>new x.P(H.x,H.y)))))}}class se{constructor(W,H,X){this.version=2,this._myFeatures=W,this.name=H,this.length=W.length,this.extent=X}feature(W){return this._myFeatures[W]}}class xe{constructor(){this.layers={}}addLayer(W){this.layers[W.name]=W}}function $e(Pe){let W=x.cU(Pe);return W.byteOffset===0&&W.byteLength===W.buffer.byteLength||(W=new Uint8Array(W)),{vectorTile:Pe,rawData:W.buffer}}function Ce(Pe,W,H){const{extent:X}=Pe,fe=Math.pow(2,H.z-W.z),ge=(H.x-W.x*fe)*X,V=(H.y-W.y*fe)*X,Ie=[];for(let we=0;we<Pe.length;we++){const ke=Pe.feature(we);let Ge=ke.loadGeometry();for(const it of Ge)for(const ft of it)ft.x=ft.x*fe-ge,ft.y=ft.y*fe-V;const Be=128;Ge=x.cV(Ge,ke.type,-Be,-Be,X+Be,X+Be),Ge.length!==0&&Ie.push(new Y(ke.type,Ge,ke.properties,ke.id,X))}return new se(Ie,Pe.name,X)}class J{constructor(W,H,X){this.actor=W,this.layerIndex=H,this.availableImages=X,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new x.cW(1e3)}loadVectorTile(W,H){return x._(this,void 0,void 0,(function*(){const X=yield x.n(W.request,H);try{return{vectorTile:W.encoding!=="mlt"?new x.cX(new x.cY(X.data)):new x.cZ(X.data),rawData:X.data,cacheControl:X.cacheControl,expires:X.expires}}catch(fe){const ge=new Uint8Array(X.data);let V=`Unable to parse the tile at ${W.request.url}, `;throw V+=ge[0]===31&&ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${fe.message}`,new Error(V)}}))}loadTile(W){return x._(this,void 0,void 0,(function*(){const{uid:H,overzoomParameters:X}=W;X&&(W.request=X.overzoomRequest);const fe=!!(W&&W.request&&W.request.collectResourceTiming)&&new x.c_(W.request),ge=new O(W);this.loading[H]=ge;const V=new AbortController;ge.abort=V;try{const Ie=yield this.loadVectorTile(W,V);if(delete this.loading[H],!Ie)return null;if(X){const it=this._getOverzoomTile(W,Ie.vectorTile);Ie.rawData=it.rawData,Ie.vectorTile=it.vectorTile}const we=Ie.rawData,ke={};Ie.expires&&(ke.expires=Ie.expires),Ie.cacheControl&&(ke.cacheControl=Ie.cacheControl);const Ge={};if(fe){const it=fe.finish();it&&(Ge.resourceTiming=JSON.parse(JSON.stringify(it)))}ge.vectorTile=Ie.vectorTile;const Be=ge.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[H]=ge,this.fetching[H]={rawTileData:we,cacheControl:ke,resourceTiming:Ge};try{const it=yield Be;return x.e({rawTileData:we.slice(0),encoding:W.encoding},it,ke,Ge)}finally{delete this.fetching[H]}}catch(Ie){throw delete this.loading[H],ge.status="done",this.loaded[H]=ge,Ie}}))}_getOverzoomTile(W,H){const{tileID:X,source:fe,overzoomParameters:ge}=W,{maxZoomTileID:V}=ge,Ie=`${V.key}_${X.key}`,we=this.overzoomedTileResultCache.get(Ie);if(we)return we;const ke=new xe,Ge=this.layerIndex.familiesBySource[fe];for(const it in Ge){const ft=H.layers[it];if(!ft)continue;const It=Ce(ft,V,X.canonical);It.length>0&&ke.addLayer(It)}const Be=$e(ke);return this.overzoomedTileResultCache.set(Ie,Be),Be}reloadTile(W){return x._(this,void 0,void 0,(function*(){const H=W.uid;if(!this.loaded||!this.loaded[H])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const X=this.loaded[H];if(X.showCollisionBoxes=W.showCollisionBoxes,X.status==="parsing"){const fe=yield X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let ge;if(this.fetching[H]){const{rawTileData:V,cacheControl:Ie,resourceTiming:we}=this.fetching[H];delete this.fetching[H],ge=x.e({rawTileData:V.slice(0),encoding:W.encoding},fe,Ie,we)}else ge=fe;return ge}if(X.status==="done"&&X.vectorTile)return X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)}))}abortTile(W){return x._(this,void 0,void 0,(function*(){const H=this.loading,X=W.uid;H&&H[X]&&H[X].abort&&(H[X].abort.abort(),delete H[X])}))}removeTile(W){return x._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]}))}}class Ye{constructor(){this.loaded={}}loadTile(W){return x._(this,void 0,void 0,(function*(){const{uid:H,encoding:X,rawImageData:fe,redFactor:ge,greenFactor:V,blueFactor:Ie,baseShift:we}=W,ke=fe.width+2,Ge=fe.height+2,Be=x.b(fe)?new x.R({width:ke,height:Ge},yield x.c$(fe,-1,-1,ke,Ge)):fe,it=new x.d0(H,Be,X,ge,V,Ie,we);return this.loaded=this.loaded||{},this.loaded[H]=it,it}))}removeTile(W){const H=this.loaded,X=W.uid;H&&H[X]&&delete H[X]}}var qe,He,et=(function(){if(He)return qe;function Pe(H,X){if(H.length!==0){W(H[0],X);for(var fe=1;fe<H.length;fe++)W(H[fe],!X)}}function W(H,X){for(var fe=0,ge=0,V=0,Ie=H.length,we=Ie-1;V<Ie;we=V++){var ke=(H[V][0]-H[we][0])*(H[we][1]+H[V][1]),Ge=fe+ke;ge+=Math.abs(fe)>=Math.abs(ke)?fe-Ge+ke:ke-Ge+fe,fe=Ge}fe+ge>=0!=!!X&&H.reverse()}return He=1,qe=function H(X,fe){var ge,V=X&&X.type;if(V==="FeatureCollection")for(ge=0;ge<X.features.length;ge++)H(X.features[ge],fe);else if(V==="GeometryCollection")for(ge=0;ge<X.geometries.length;ge++)H(X.geometries[ge],fe);else if(V==="Feature")H(X.geometry,fe);else if(V==="Polygon")Pe(X.coordinates,fe);else if(V==="MultiPolygon")for(ge=0;ge<X.coordinates.length;ge++)Pe(X.coordinates[ge],fe);return X}})(),at=x.d1(et);const Qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pe=>Pe},he=Math.fround||(oe=new Float32Array(1),Pe=>(oe[0]=+Pe,oe[0]));var oe;class ae{constructor(W){this.options=Object.assign(Object.create(Qe),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:H,minZoom:X,maxZoom:fe}=this.options;H&&console.time("total time");const ge=`prepare ${W.length} points`;H&&console.time(ge),this.points=W;const V=[];for(let we=0;we<W.length;we++){const ke=W[we];if(!ke.geometry)continue;const[Ge,Be]=ke.geometry.coordinates,it=he(Se(Ge)),ft=he(de(Be));V.push(it,ft,1/0,we,-1,1),this.options.reduce&&V.push(0)}let Ie=this.trees[fe+1]=this._createTree(V);H&&console.timeEnd(ge);for(let we=fe;we>=X;we--){const ke=+Date.now();Ie=this.trees[we]=this._createTree(this._cluster(Ie,we)),H&&console.log("z%d: %d clusters in %dms",we,Ie.numItems,+Date.now()-ke)}return H&&console.timeEnd("total time"),this}getClusters(W,H){let X=((W[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,W[1]));let ge=W[2]===180?180:((W[2]+180)%360+360)%360-180;const V=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)X=-180,ge=180;else if(X>ge){const Be=this.getClusters([X,fe,180,V],H),it=this.getClusters([-180,fe,ge,V],H);return Be.concat(it)}const Ie=this.trees[this._limitZoom(H)],we=Ie.range(Se(X),de(V),Se(ge),de(fe)),ke=Ie.data,Ge=[];for(const Be of we){const it=this.stride*Be;Ge.push(ke[it+5]>1?Ee(ke,it,this.clusterProps):this.points[ke[it+3]])}return Ge}getChildren(W){const H=this._getOriginId(W),X=this._getOriginZoom(W),fe="No cluster with the specified id.",ge=this.trees[X];if(!ge)throw new Error(fe);const V=ge.data;if(H*this.stride>=V.length)throw new Error(fe);const Ie=this.options.radius/(this.options.extent*Math.pow(2,X-1)),we=ge.within(V[H*this.stride],V[H*this.stride+1],Ie),ke=[];for(const Ge of we){const Be=Ge*this.stride;V[Be+4]===W&&ke.push(V[Be+5]>1?Ee(V,Be,this.clusterProps):this.points[V[Be+3]])}if(ke.length===0)throw new Error(fe);return ke}getLeaves(W,H,X){const fe=[];return this._appendLeaves(fe,W,H=H||10,X=X||0,0),fe}getTile(W,H,X){const fe=this.trees[this._limitZoom(W)],ge=Math.pow(2,W),{extent:V,radius:Ie}=this.options,we=Ie/V,ke=(X-we)/ge,Ge=(X+1+we)/ge,Be={features:[]};return this._addTileFeatures(fe.range((H-we)/ge,ke,(H+1+we)/ge,Ge),fe.data,H,X,ge,Be),H===0&&this._addTileFeatures(fe.range(1-we/ge,ke,1,Ge),fe.data,ge,X,ge,Be),H===ge-1&&this._addTileFeatures(fe.range(0,ke,we/ge,Ge),fe.data,-1,X,ge,Be),Be.features.length?Be:null}getClusterExpansionZoom(W){let H=this._getOriginZoom(W)-1;for(;H<=this.options.maxZoom;){const X=this.getChildren(W);if(H++,X.length!==1)break;W=X[0].properties.cluster_id}return H}_appendLeaves(W,H,X,fe,ge){const V=this.getChildren(H);for(const Ie of V){const we=Ie.properties;if(we&&we.cluster?ge+we.point_count<=fe?ge+=we.point_count:ge=this._appendLeaves(W,we.cluster_id,X,fe,ge):ge<fe?ge++:W.push(Ie),W.length===X)break}return ge}_createTree(W){const H=new x.aT(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let X=0;X<W.length;X+=this.stride)H.add(W[X],W[X+1]);return H.finish(),H.data=W,H}_addTileFeatures(W,H,X,fe,ge,V){for(const Ie of W){const we=Ie*this.stride,ke=H[we+5]>1;let Ge,Be,it;if(ke)Ge=be(H,we,this.clusterProps),Be=H[we],it=H[we+1];else{const kt=this.points[H[we+3]];Ge=kt.properties;const[Ft,Me]=kt.geometry.coordinates;Be=Se(Ft),it=de(Me)}const ft={type:1,geometry:[[Math.round(this.options.extent*(Be*ge-X)),Math.round(this.options.extent*(it*ge-fe))]],tags:Ge};let It;It=ke||this.options.generateId?H[we+3]:this.points[H[we+3]].id,It!==void 0&&(ft.id=It),V.features.push(ft)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,H){const{radius:X,extent:fe,reduce:ge,minPoints:V}=this.options,Ie=X/(fe*Math.pow(2,H)),we=W.data,ke=[],Ge=this.stride;for(let Be=0;Be<we.length;Be+=Ge){if(we[Be+2]<=H)continue;we[Be+2]=H;const it=we[Be],ft=we[Be+1],It=W.within(we[Be],we[Be+1],Ie),kt=we[Be+5];let Ft=kt;for(const Me of It){const rn=Me*Ge;we[rn+2]>H&&(Ft+=we[rn+5])}if(Ft>kt&&Ft>=V){let Me,rn=it*kt,An=ft*kt,Ct=-1;const Yt=(Be/Ge<<5)+(H+1)+this.points.length;for(const _n of It){const je=_n*Ge;if(we[je+2]<=H)continue;we[je+2]=H;const dt=we[je+5];rn+=we[je]*dt,An+=we[je+1]*dt,we[je+4]=Yt,ge&&(Me||(Me=this._map(we,Be,!0),Ct=this.clusterProps.length,this.clusterProps.push(Me)),ge(Me,this._map(we,je)))}we[Be+4]=Yt,ke.push(rn/Ft,An/Ft,1/0,Yt,-1,Ft),ge&&ke.push(Ct)}else{for(let Me=0;Me<Ge;Me++)ke.push(we[Be+Me]);if(Ft>1)for(const Me of It){const rn=Me*Ge;if(!(we[rn+2]<=H)){we[rn+2]=H;for(let An=0;An<Ge;An++)ke.push(we[rn+An])}}}}return ke}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,H,X){if(W[H+5]>1){const V=this.clusterProps[W[H+6]];return X?Object.assign({},V):V}const fe=this.points[W[H+3]].properties,ge=this.options.map(fe);return X&&ge===fe?Object.assign({},ge):ge}}function Ee(Pe,W,H){return{type:"Feature",id:Pe[W+3],properties:be(Pe,W,H),geometry:{type:"Point",coordinates:[(X=Pe[W],360*(X-.5)),Qt(Pe[W+1])]}};var X}function be(Pe,W,H){const X=Pe[W+5],fe=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X,ge=Pe[W+6],V=ge===-1?{}:Object.assign({},H[ge]);return Object.assign(V,{cluster:!0,cluster_id:Pe[W+3],point_count:X,point_count_abbreviated:fe})}function Se(Pe){return Pe/360+.5}function de(Pe){const W=Math.sin(Pe*Math.PI/180),H=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return H<0?0:H>1?1:H}function Qt(Pe){const W=(180-360*Pe)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function mn(Pe,W,H,X){let fe=X;const ge=W+(H-W>>1);let V,Ie=H-W;const we=Pe[W],ke=Pe[W+1],Ge=Pe[H],Be=Pe[H+1];for(let it=W+3;it<H;it+=3){const ft=gt(Pe[it],Pe[it+1],we,ke,Ge,Be);if(ft>fe)V=it,fe=ft;else if(ft===fe){const It=Math.abs(it-ge);It<Ie&&(V=it,Ie=It)}}fe>X&&(V-W>3&&mn(Pe,W,V,X),Pe[V+2]=fe,H-V>3&&mn(Pe,V,H,X))}function gt(Pe,W,H,X,fe,ge){let V=fe-H,Ie=ge-X;if(V!==0||Ie!==0){const we=((Pe-H)*V+(W-X)*Ie)/(V*V+Ie*Ie);we>1?(H=fe,X=ge):we>0&&(H+=V*we,X+=Ie*we)}return V=Pe-H,Ie=W-X,V*V+Ie*Ie}function vn(Pe,W,H,X){const fe={id:Pe??null,type:W,geometry:H,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")gn(fe,H);else if(W==="Polygon")gn(fe,H[0]);else if(W==="MultiLineString")for(const ge of H)gn(fe,ge);else if(W==="MultiPolygon")for(const ge of H)gn(fe,ge[0]);return fe}function gn(Pe,W){for(let H=0;H<W.length;H+=3)Pe.minX=Math.min(Pe.minX,W[H]),Pe.minY=Math.min(Pe.minY,W[H+1]),Pe.maxX=Math.max(Pe.maxX,W[H]),Pe.maxY=Math.max(Pe.maxY,W[H+1])}function St(Pe,W,H,X){if(!W.geometry)return;const fe=W.geometry.coordinates;if(fe&&fe.length===0)return;const ge=W.geometry.type,V=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2);let Ie=[],we=W.id;if(H.promoteId?we=W.properties[H.promoteId]:H.generateId&&(we=X||0),ge==="Point")In(fe,Ie);else if(ge==="MultiPoint")for(const ke of fe)In(ke,Ie);else if(ge==="LineString")jt(fe,Ie,V,!1);else if(ge==="MultiLineString"){if(H.lineMetrics){for(const ke of fe)Ie=[],jt(ke,Ie,V,!1),Pe.push(vn(we,"LineString",Ie,W.properties));return}Ht(fe,Ie,V,!1)}else if(ge==="Polygon")Ht(fe,Ie,V,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(const ke of W.geometry.geometries)St(Pe,{id:we,geometry:ke,properties:W.properties},H,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ke of fe){const Ge=[];Ht(ke,Ge,V,!0),Ie.push(Ge)}}Pe.push(vn(we,ge,Ie,W.properties))}function In(Pe,W){W.push(Qn(Pe[0]),kn(Pe[1]),0)}function jt(Pe,W,H,X){let fe,ge,V=0;for(let we=0;we<Pe.length;we++){const ke=Qn(Pe[we][0]),Ge=kn(Pe[we][1]);W.push(ke,Ge,0),we>0&&(V+=X?(fe*Ge-ke*ge)/2:Math.sqrt(Math.pow(ke-fe,2)+Math.pow(Ge-ge,2))),fe=ke,ge=Ge}const Ie=W.length-3;W[2]=1,mn(W,0,Ie,H),W[Ie+2]=1,W.size=Math.abs(V),W.start=0,W.end=W.size}function Ht(Pe,W,H,X){for(let fe=0;fe<Pe.length;fe++){const ge=[];jt(Pe[fe],ge,H,X),W.push(ge)}}function Qn(Pe){return Pe/360+.5}function kn(Pe){const W=Math.sin(Pe*Math.PI/180),H=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return H<0?0:H>1?1:H}function Et(Pe,W,H,X,fe,ge,V,Ie){if(X/=W,ge>=(H/=W)&&V<X)return Pe;if(V<H||ge>=X)return null;const we=[];for(const ke of Pe){const Ge=ke.geometry;let Be=ke.type;const it=fe===0?ke.minX:ke.minY,ft=fe===0?ke.maxX:ke.maxY;if(it>=H&&ft<X){we.push(ke);continue}if(ft<H||it>=X)continue;let It=[];if(Be==="Point"||Be==="MultiPoint")xt(Ge,It,H,X,fe);else if(Be==="LineString")At(Ge,It,H,X,fe,!1,Ie.lineMetrics);else if(Be==="MultiLineString")pn(Ge,It,H,X,fe,!1);else if(Be==="Polygon")pn(Ge,It,H,X,fe,!0);else if(Be==="MultiPolygon")for(const kt of Ge){const Ft=[];pn(kt,Ft,H,X,fe,!0),Ft.length&&It.push(Ft)}if(It.length){if(Ie.lineMetrics&&Be==="LineString"){for(const kt of It)we.push(vn(ke.id,Be,kt,ke.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(It.length===1?(Be="LineString",It=It[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=It.length===3?"Point":"MultiPoint"),we.push(vn(ke.id,Be,It,ke.tags))}}return we.length?we:null}function xt(Pe,W,H,X,fe){for(let ge=0;ge<Pe.length;ge+=3){const V=Pe[ge+fe];V>=H&&V<=X&&Zt(W,Pe[ge],Pe[ge+1],Pe[ge+2])}}function At(Pe,W,H,X,fe,ge,V){let Ie=Wt(Pe);const we=fe===0?ur:Sn;let ke,Ge,Be=Pe.start;for(let Ft=0;Ft<Pe.length-3;Ft+=3){const Me=Pe[Ft],rn=Pe[Ft+1],An=Pe[Ft+2],Ct=Pe[Ft+3],Yt=Pe[Ft+4],_n=fe===0?Me:rn,je=fe===0?Ct:Yt;let dt=!1;V&&(ke=Math.sqrt(Math.pow(Me-Ct,2)+Math.pow(rn-Yt,2))),_n<H?je>H&&(Ge=we(Ie,Me,rn,Ct,Yt,H),V&&(Ie.start=Be+ke*Ge)):_n>X?je<X&&(Ge=we(Ie,Me,rn,Ct,Yt,X),V&&(Ie.start=Be+ke*Ge)):Zt(Ie,Me,rn,An),je<H&&_n>=H&&(Ge=we(Ie,Me,rn,Ct,Yt,H),dt=!0),je>X&&_n<=X&&(Ge=we(Ie,Me,rn,Ct,Yt,X),dt=!0),!ge&&dt&&(V&&(Ie.end=Be+ke*Ge),W.push(Ie),Ie=Wt(Pe)),V&&(Be+=ke)}let it=Pe.length-3;const ft=Pe[it],It=Pe[it+1],kt=fe===0?ft:It;kt>=H&&kt<=X&&Zt(Ie,ft,It,Pe[it+2]),it=Ie.length-3,ge&&it>=3&&(Ie[it]!==Ie[0]||Ie[it+1]!==Ie[1])&&Zt(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&W.push(Ie)}function Wt(Pe){const W=[];return W.size=Pe.size,W.start=Pe.start,W.end=Pe.end,W}function pn(Pe,W,H,X,fe,ge){for(const V of Pe)At(V,W,H,X,fe,ge,!1)}function Zt(Pe,W,H,X){Pe.push(W,H,X)}function ur(Pe,W,H,X,fe,ge){const V=(ge-W)/(X-W);return Zt(Pe,ge,H+(fe-H)*V,1),V}function Sn(Pe,W,H,X,fe,ge){const V=(ge-H)/(fe-H);return Zt(Pe,W+(X-W)*V,ge,1),V}function Fn(Pe,W){const H=[];for(let X=0;X<Pe.length;X++){const fe=Pe[X],ge=fe.type;let V;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")V=Vt(fe.geometry,W);else if(ge==="MultiLineString"||ge==="Polygon"){V=[];for(const Ie of fe.geometry)V.push(Vt(Ie,W))}else if(ge==="MultiPolygon"){V=[];for(const Ie of fe.geometry){const we=[];for(const ke of Ie)we.push(Vt(ke,W));V.push(we)}}H.push(vn(fe.id,ge,V,fe.tags))}return H}function Vt(Pe,W){const H=[];H.size=Pe.size,Pe.start!==void 0&&(H.start=Pe.start,H.end=Pe.end);for(let X=0;X<Pe.length;X+=3)H.push(Pe[X]+W,Pe[X+1],Pe[X+2]);return H}function Jt(Pe,W){if(Pe.transformed)return Pe;const H=1<<Pe.z,X=Pe.x,fe=Pe.y;for(const ge of Pe.features){const V=ge.geometry,Ie=ge.type;if(ge.geometry=[],Ie===1)for(let we=0;we<V.length;we+=2)ge.geometry.push(Cn(V[we],V[we+1],W,H,X,fe));else for(let we=0;we<V.length;we++){const ke=[];for(let Ge=0;Ge<V[we].length;Ge+=2)ke.push(Cn(V[we][Ge],V[we][Ge+1],W,H,X,fe));ge.geometry.push(ke)}}return Pe.transformed=!0,Pe}function Cn(Pe,W,H,X,fe,ge){return[Math.round(H*(Pe*X-fe)),Math.round(H*(W*X-ge))]}function Mt(Pe,W,H,X,fe){const ge=W===fe.maxZoom?0:fe.tolerance/((1<<W)*fe.extent),V={features:[],numPoints:0,numSimplified:0,numFeatures:Pe.length,source:null,x:H,y:X,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ie of Pe)Kt(V,Ie,ge,fe);return V}function Kt(Pe,W,H,X){const fe=W.geometry,ge=W.type,V=[];if(Pe.minX=Math.min(Pe.minX,W.minX),Pe.minY=Math.min(Pe.minY,W.minY),Pe.maxX=Math.max(Pe.maxX,W.maxX),Pe.maxY=Math.max(Pe.maxY,W.maxY),ge==="Point"||ge==="MultiPoint")for(let Ie=0;Ie<fe.length;Ie+=3)V.push(fe[Ie],fe[Ie+1]),Pe.numPoints++,Pe.numSimplified++;else if(ge==="LineString")$t(V,fe,Pe,H,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(let Ie=0;Ie<fe.length;Ie++)$t(V,fe[Ie],Pe,H,ge==="Polygon",Ie===0);else if(ge==="MultiPolygon")for(let Ie=0;Ie<fe.length;Ie++){const we=fe[Ie];for(let ke=0;ke<we.length;ke++)$t(V,we[ke],Pe,H,!0,ke===0)}if(V.length){let Ie=W.tags||null;if(ge==="LineString"&&X.lineMetrics){Ie={};for(const ke in W.tags)Ie[ke]=W.tags[ke];Ie.mapbox_clip_start=fe.start/fe.size,Ie.mapbox_clip_end=fe.end/fe.size}const we={geometry:V,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:Ie};W.id!==null&&(we.id=W.id),Pe.features.push(we)}}function $t(Pe,W,H,X,fe,ge){const V=X*X;if(X>0&&W.size<(fe?V:X))return void(H.numPoints+=W.length/3);const Ie=[];for(let we=0;we<W.length;we+=3)(X===0||W[we+2]>V)&&(H.numSimplified++,Ie.push(W[we],W[we+1])),H.numPoints++;fe&&(function(we,ke){let Ge=0;for(let Be=0,it=we.length,ft=it-2;Be<it;ft=Be,Be+=2)Ge+=(we[Be]-we[ft])*(we[Be+1]+we[ft+1]);if(Ge>0===ke)for(let Be=0,it=we.length;Be<it/2;Be+=2){const ft=we[Be],It=we[Be+1];we[Be]=we[it-2-Be],we[Be+1]=we[it-1-Be],we[it-2-Be]=ft,we[it-1-Be]=It}})(Ie,ge),Pe.push(Ie)}const Ot={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class tn{constructor(W,H){const X=(H=this.options=(function(ge,V){for(const Ie in V)ge[Ie]=V[Ie];return ge})(Object.create(Ot),H)).debug;if(X&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let fe=(function(ge,V){const Ie=[];if(ge.type==="FeatureCollection")for(let we=0;we<ge.features.length;we++)St(Ie,ge.features[we],V,we);else St(Ie,ge.type==="Feature"?ge:{geometry:ge},V);return Ie})(W,H);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),fe=(function(ge,V){const Ie=V.buffer/V.extent;let we=ge;const ke=Et(ge,1,-1-Ie,Ie,0,-1,2,V),Ge=Et(ge,1,1-Ie,2+Ie,0,-1,2,V);return(ke||Ge)&&(we=Et(ge,1,-Ie,1+Ie,0,-1,2,V)||[],ke&&(we=Fn(ke,1).concat(we)),Ge&&(we=we.concat(Fn(Ge,-1)))),we})(fe,H),fe.length&&this.splitTile(fe,0,0,0),X&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,H,X,fe,ge,V,Ie){const we=[W,H,X,fe],ke=this.options,Ge=ke.debug;for(;we.length;){fe=we.pop(),X=we.pop(),H=we.pop(),W=we.pop();const Be=1<<H,it=nn(H,X,fe);let ft=this.tiles[it];if(!ft&&(Ge>1&&console.time("creation"),ft=this.tiles[it]=Mt(W,H,X,fe,ke),this.tileCoords.push({z:H,x:X,y:fe}),Ge)){Ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,X,fe,ft.numFeatures,ft.numPoints,ft.numSimplified),console.timeEnd("creation"));const dt=`z${H}`;this.stats[dt]=(this.stats[dt]||0)+1,this.total++}if(ft.source=W,ge==null){if(H===ke.indexMaxZoom||ft.numPoints<=ke.indexMaxPoints)continue}else{if(H===ke.maxZoom||H===ge)continue;if(ge!=null){const dt=ge-H;if(X!==V>>dt||fe!==Ie>>dt)continue}}if(ft.source=null,W.length===0)continue;Ge>1&&console.time("clipping");const It=.5*ke.buffer/ke.extent,kt=.5-It,Ft=.5+It,Me=1+It;let rn=null,An=null,Ct=null,Yt=null,_n=Et(W,Be,X-It,X+Ft,0,ft.minX,ft.maxX,ke),je=Et(W,Be,X+kt,X+Me,0,ft.minX,ft.maxX,ke);W=null,_n&&(rn=Et(_n,Be,fe-It,fe+Ft,1,ft.minY,ft.maxY,ke),An=Et(_n,Be,fe+kt,fe+Me,1,ft.minY,ft.maxY,ke),_n=null),je&&(Ct=Et(je,Be,fe-It,fe+Ft,1,ft.minY,ft.maxY,ke),Yt=Et(je,Be,fe+kt,fe+Me,1,ft.minY,ft.maxY,ke),je=null),Ge>1&&console.timeEnd("clipping"),we.push(rn||[],H+1,2*X,2*fe),we.push(An||[],H+1,2*X,2*fe+1),we.push(Ct||[],H+1,2*X+1,2*fe),we.push(Yt||[],H+1,2*X+1,2*fe+1)}}getTile(W,H,X){W=+W,H=+H,X=+X;const fe=this.options,{extent:ge,debug:V}=fe;if(W<0||W>24)return null;const Ie=1<<W,we=nn(W,H=H+Ie&Ie-1,X);if(this.tiles[we])return Jt(this.tiles[we],ge);V>1&&console.log("drilling down to z%d-%d-%d",W,H,X);let ke,Ge=W,Be=H,it=X;for(;!ke&&Ge>0;)Ge--,Be>>=1,it>>=1,ke=this.tiles[nn(Ge,Be,it)];return ke&&ke.source?(V>1&&(console.log("found parent tile z%d-%d-%d",Ge,Be,it),console.time("drilling down")),this.splitTile(ke.source,Ge,Be,it,W,H,X),V>1&&console.timeEnd("drilling down"),this.tiles[we]?Jt(this.tiles[we],ge):null):null}}function nn(Pe,W,H){return 32*((1<<Pe)*H+W)+Pe}class Rn extends J{constructor(W,H,X,fe=xn){super(W,H,X),this._dataUpdateable=new Map,this._createGeoJSONIndex=fe}loadVectorTile(W,H){return x._(this,void 0,void 0,(function*(){const X=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const fe=this._geoJSONIndex.getTile(X.z,X.x,X.y);return fe?$e(new x.d2(fe.features,{version:2,extent:x.a5})):null}))}loadData(W){return x._(this,void 0,void 0,(function*(){var H;(H=this._pendingRequest)===null||H===void 0||H.abort();const X=this._startPerformance(W);this._pendingRequest=new AbortController;try{(!this._pendingData||W.request||W.data||W.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest));const fe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(fe,W),this.loaded={};const ge={};return W.request&&(ge.data=fe),this._finishPerformance(X,W,ge),ge}catch(fe){if(delete this._pendingRequest,x.Z(fe))return{abandoned:!0};throw fe}}))}_startPerformance(W){var H;if(!((H=W==null?void 0:W.request)===null||H===void 0)&&H.collectResourceTiming)return new x.c_(W.request)}_finishPerformance(W,H,X){if(!W)return;const fe=W.finish();fe&&(X.resourceTiming={},X.resourceTiming[H.source]=JSON.parse(JSON.stringify(fe)))}getData(){return x._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(W){const H=this.loaded;return H&&H[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,H){return x._(this,void 0,void 0,(function*(){let X;if(W.request?X=yield this.loadGeoJSONFromUrl(W.request,W.promoteId,H):W.data?X=this._loadGeoJSONFromObject(W.data,W.promoteId):W.dataDiff&&(X=this._loadGeoJSONFromDiff(W.dataDiff,W.promoteId,W.source)),delete this._pendingRequest,typeof X!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);return at(X,!0),W.filter&&(X=this._filterGeoJSON(X,W.filter)),X}))}loadGeoJSONFromUrl(W,H,X){return x._(this,void 0,void 0,(function*(){const fe=yield x.j(W,X);return this._dataUpdateable=x.a7(fe.data,H),fe.data}))}_loadGeoJSONFromObject(W,H){return this._dataUpdateable=x.a7(W,H),W}_loadGeoJSONFromDiff(W,H,X){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${X}`);x.a8(this._dataUpdateable,W,H);const fe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(fe)}_filterGeoJSON(W,H){const X=x.d3(H,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(X.result==="error")throw new Error(X.value.map((ge=>`${ge.key}: ${ge.message}`)).join(", "));const fe=W.features.filter((ge=>X.value.evaluate({zoom:0},ge)));return this._toFeatureCollection(fe)}_toFeatureCollection(W){return{type:"FeatureCollection",features:W}}removeSource(W){return x._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}function xn(Pe,W){return W.cluster?new ae((function({superclusterOptions:H,clusterProperties:X}){if(!X||!H)return H;const fe={},ge={},V={accumulated:null,zoom:0},Ie={properties:null},we=Object.keys(X);for(const ke of we){const[Ge,Be]=X[ke],it=x.d3(Be),ft=x.d3(typeof Ge=="string"?[Ge,["accumulated"],["get",ke]]:Ge);fe[ke]=it.value,ge[ke]=ft.value}return H.map=ke=>{Ie.properties=ke;const Ge={};for(const Be of we)Ge[Be]=fe[Be].evaluate(V,Ie);return Ge},H.reduce=(ke,Ge)=>{Ie.properties=Ge;for(const Be of we)V.accumulated=ke[Be],ke[Be]=ge[Be].evaluate(V,Ie)},H})(W)).load(Pe.features):(function(H,X){return new tn(H,X)})(Pe,W.geojsonVtOptions)}class Xt{constructor(W){this.self=W,this.actor=new x.L(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(H,X)=>{if(this.externalWorkerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.externalWorkerSourceTypes[H]=X},this.self.addProtocol=x.cJ,this.self.removeProtocol=x.cK,this.self.registerRTLTextPlugin=H=>{x.d4.setMethods(H)},this.actor.registerMessageHandler("LDT",((H,X)=>this._getDEMWorkerSource(H,X.source).loadTile(X))),this.actor.registerMessageHandler("RDT",((H,X)=>x._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(H,X.source).removeTile(X)})))),this.actor.registerMessageHandler("GCEZ",((H,X)=>x._(this,void 0,void 0,(function*(){return this._getWorkerSource(H,X.type,X.source).getClusterExpansionZoom(X)})))),this.actor.registerMessageHandler("GCC",((H,X)=>x._(this,void 0,void 0,(function*(){return this._getWorkerSource(H,X.type,X.source).getClusterChildren(X)})))),this.actor.registerMessageHandler("GCL",((H,X)=>x._(this,void 0,void 0,(function*(){return this._getWorkerSource(H,X.type,X.source).getClusterLeaves(X)})))),this.actor.registerMessageHandler("LD",((H,X)=>this._getWorkerSource(H,X.type,X.source).loadData(X))),this.actor.registerMessageHandler("GD",((H,X)=>this._getWorkerSource(H,X.type,X.source).getData())),this.actor.registerMessageHandler("LT",((H,X)=>this._getWorkerSource(H,X.type,X.source).loadTile(X))),this.actor.registerMessageHandler("RT",((H,X)=>this._getWorkerSource(H,X.type,X.source).reloadTile(X))),this.actor.registerMessageHandler("AT",((H,X)=>this._getWorkerSource(H,X.type,X.source).abortTile(X))),this.actor.registerMessageHandler("RMT",((H,X)=>this._getWorkerSource(H,X.type,X.source).removeTile(X))),this.actor.registerMessageHandler("RS",((H,X)=>x._(this,void 0,void 0,(function*(){if(!this.workerSources[H]||!this.workerSources[H][X.type]||!this.workerSources[H][X.type][X.source])return;const fe=this.workerSources[H][X.type][X.source];delete this.workerSources[H][X.type][X.source],fe.removeSource!==void 0&&fe.removeSource(X)})))),this.actor.registerMessageHandler("RM",(H=>x._(this,void 0,void 0,(function*(){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H],this.globalStates.delete(H)})))),this.actor.registerMessageHandler("SR",((H,X)=>x._(this,void 0,void 0,(function*(){this.referrer=X})))),this.actor.registerMessageHandler("SRPS",((H,X)=>this._syncRTLPluginState(H,X))),this.actor.registerMessageHandler("IS",((H,X)=>x._(this,void 0,void 0,(function*(){this.self.importScripts(X)})))),this.actor.registerMessageHandler("SI",((H,X)=>this._setImages(H,X))),this.actor.registerMessageHandler("UL",((H,X)=>x._(this,void 0,void 0,(function*(){this._getLayerIndex(H).update(X.layers,X.removedIds,this._getGlobalState(H))})))),this.actor.registerMessageHandler("UGS",((H,X)=>x._(this,void 0,void 0,(function*(){const fe=this._getGlobalState(H);for(const ge in X)fe[ge]=X[ge]})))),this.actor.registerMessageHandler("SL",((H,X)=>x._(this,void 0,void 0,(function*(){this._getLayerIndex(H).replace(X,this._getGlobalState(H))}))))}_getGlobalState(W){let H=this.globalStates.get(W);return H||(H={},this.globalStates.set(W,H)),H}_setImages(W,H){return x._(this,void 0,void 0,(function*(){this.availableImages[W]=H;for(const X in this.workerSources[W]){const fe=this.workerSources[W][X];for(const ge in fe)fe[ge].availableImages=H}}))}_syncRTLPluginState(W,H){return x._(this,void 0,void 0,(function*(){return yield x.d4.syncState(H,this.self.importScripts)}))}_getAvailableImages(W){let H=this.availableImages[W];return H||(H=[]),H}_getLayerIndex(W){let H=this.layerIndexes[W];return H||(H=this.layerIndexes[W]=new c),H}_getWorkerSource(W,H,X){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][H]||(this.workerSources[W][H]={}),!this.workerSources[W][H][X]){const fe={sendAsync:(ge,V)=>(ge.targetMapId=W,this.actor.sendAsync(ge,V))};switch(H){case"vector":this.workerSources[W][H][X]=new J(fe,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][H][X]=new Rn(fe,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][H][X]=new this.externalWorkerSourceTypes[H](fe,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][H][X]}_getDEMWorkerSource(W,H){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][H]||(this.demWorkerSources[W][H]=new Ye),this.demWorkerSources[W][H]}}return x.i(self)&&(self.worker=new Xt(self)),Xt})),g("index",["exports","./shared"],(function(x,c){var k="5.15.0";function O(){var _=new c.A(4);return c.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}let U,Y,se;const xe={frame(_,t,s){const u=requestAnimationFrame((y=>{p(),t(y)})),{unsubscribe:p}=c.s(_.signal,"abort",(()=>{p(),cancelAnimationFrame(u),s(new c.a(_.signal.reason))}),!1)},frameAsync(_){return new Promise(((t,s)=>{this.frame(_,t,s)}))},getImageData(_,t=0){return this.getImageCanvasContext(_).getImageData(-t,-t,_.width+2*t,_.height+2*t)},getImageCanvasContext(_){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=_.width,t.height=_.height,s.drawImage(_,0,0,_.width,_.height),s},resolveURL:_=>(U||(U=document.createElement("a")),U.href=_,U.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return se!==void 0?se:!!matchMedia&&(Y==null&&(Y=matchMedia("(prefers-reduced-motion: reduce)")),Y.matches)},set prefersReducedMotion(_){se=_}},$e=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(_){this._frozenAt=_}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Ce(){return $e.getCurrentTime()}class J{static testProp(t){if(!J.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in J.docStyle)return t[s];return t[0]}static create(t,s,u){const p=window.document.createElement(t);return s!==void 0&&(p.className=s),u&&u.appendChild(p),p}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){J.docStyle&&J.selectProp&&(J.userSelect=J.docStyle[J.selectProp],J.docStyle[J.selectProp]="none")}static enableDrag(){J.docStyle&&J.selectProp&&(J.docStyle[J.selectProp]=J.userSelect)}static setTransform(t,s){t.style[J.transformProp]=s}static addEventListener(t,s,u,p={}){t.addEventListener(s,u,"passive"in p?p:p.capture)}static removeEventListener(t,s,u,p={}){t.removeEventListener(s,u,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",J.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",J.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",J.suppressClickInternal,!0)}),0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,u){const p=s.boundingClientRect;return new c.P((u.clientX-p.left)/s.x-t.clientLeft,(u.clientY-p.top)/s.y-t.clientTop)}static mousePos(t,s){const u=J.getScale(t);return J.getPoint(t,u,s)}static touchPos(t,s){const u=[],p=J.getScale(t);for(let y=0;y<s.length;y++)u.push(J.getPoint(t,p,s[y]));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const s=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),u=s.querySelectorAll("script");for(const p of u)p.remove();return J.clean(s),s.innerHTML}static isPossiblyDangerous(t,s){const u=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!u.includes("javascript:")&&!u.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const s=t.children;for(const u of s)J.removeAttributes(u),J.clean(u)}static removeAttributes(t){for(const{name:s,value:u}of t.attributes)J.isPossiblyDangerous(s,u)&&t.removeAttribute(s)}}J.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,J.selectProp=J.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),J.transformProp=J.testProp(["transform","WebkitTransform"]);const Ye={supported:!1,testSupport:function(_){!et&&He&&(at?Qe(_):qe=_)}};let qe,He,et=!1,at=!1;function Qe(_){const t=_.createTexture();_.bindTexture(_.TEXTURE_2D,t);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,He),_.isContextLost())return;Ye.supported=!0}catch{}_.deleteTexture(t),et=!0}var he;typeof document<"u"&&(He=document.createElement("img"),He.onload=()=>{qe&&Qe(qe),qe=null,at=!0},He.onerror=()=>{et=!0,qe=null},He.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(_){let t,s,u,p;_.resetRequestQueue=()=>{t=[],s=0,u=0,p={}},_.addThrottleControl=A=>{const C=u++;return p[C]=A,C},_.removeThrottleControl=A=>{delete p[A],b()},_.getImage=(A,C,R=!0)=>new Promise(((N,F)=>{Ye.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),c.e(A,{type:"image"}),t.push({abortController:C,requestParameters:A,supportImageRefresh:R,state:"queued",onError:q=>{F(q)},onSuccess:q=>{N(q)}}),b()}));const y=A=>c._(this,void 0,void 0,(function*(){A.state="running";const{requestParameters:C,supportImageRefresh:R,onError:N,onSuccess:F,abortController:q}=A,Z=R===!1&&!c.i(self)&&!c.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce(((re,ue)=>re&&ue==="accept"),!0));s++;const te=Z?I(C,q):c.m(C,q);try{const re=yield te;delete A.abortController,A.state="completed",re.data instanceof HTMLImageElement||c.b(re.data)?F(re):re.data&&F({data:yield(ie=re.data,typeof createImageBitmap=="function"?c.f(ie):c.h(ie)),cacheControl:re.cacheControl,expires:re.expires})}catch(re){delete A.abortController,N(re)}finally{s--,b()}var ie})),b=()=>{const A=(()=>{for(const C of Object.keys(p))if(p[C]())return!0;return!1})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=s;C<A&&t.length>0;C++){const R=t.shift();R.abortController.signal.aborted?C--:y(R)}},I=(A,C)=>new Promise(((R,N)=>{const F=new Image,q=A.url,Z=A.credentials;Z&&Z==="include"?F.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!c.d(q))&&(F.crossOrigin="anonymous"),C.signal.addEventListener("abort",(()=>{F.src="",N(new c.a(C.signal.reason))})),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,R({data:F})},F.onerror=()=>{F.onerror=F.onload=null,C.signal.aborted||N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=q}))})(he||(he={})),he.resetRequestQueue();class oe{constructor(t){this._transformRequestFn=t??null}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ae(_){const t=[];if(typeof _=="string")t.push({id:"default",url:_});else if(_&&_.length>0){const s=[];for(const{id:u,url:p}of _){const y=`${u}${p}`;s.indexOf(y)===-1&&(s.push(y),t.push({id:u,url:p}))}}return t}function Ee(_,t,s){try{const u=new URL(_);return u.pathname+=`${t}${s}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${_}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function be(_){const{userImage:t}=_;return!!(t&&t.render&&t.render())&&(_.data.replace(new Uint8Array(t.data.buffer)),!0)}class Se extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:u}of this.requestors)u(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const u=s.spriteData;s.data=new c.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let u=!0;const p=s.data||s.spriteData;return this._validateStretch(s.stretchX,p&&p.width)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,p&&p.height)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,s){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||s<p[1])return!1;u=p[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const u=s.spriteData,p=u&&u.width||s.data.width,y=u&&u.height||s.data.height;return!(t[0]<0||p<t[0]||t[1]<0||y<t[1]||t[2]<0||p<t[2]||t[3]<0||y<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,u=!0){const p=this.getImage(t);if(u&&(p.data.width!==s.data.width||p.data.height!==s.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=p.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((s,u)=>{let p=!0;if(!this.isLoaded())for(const y of t)this.images[y]||(p=!1);this.isLoaded()||p?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})}))}_getImagesForIds(t){const s={};for(const u of t){let p=this.getImage(u);p||(this.fire(new c.l("styleimagemissing",{id:u})),p=this.getImage(u)),p?s[u]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:c.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],u=this.getImage(t);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},y=new c.I(p,u);this.patterns[t]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const y in this.patterns)t.push(this.patterns[y].bin);const{w:s,h:u}=c.p(t),p=this.atlasImage;p.resize({width:s||1,height:u||1});for(const y in this.patterns){const{bin:b}=this.patterns[y],I=b.x+1,A=b.y+1,C=this.getImage(y).data,R=C.width,N=C.height;c.R.copy(C,p,{x:0,y:0},{x:I,y:A},{width:R,height:N}),c.R.copy(C,p,{x:0,y:N-1},{x:I,y:A-1},{width:R,height:1}),c.R.copy(C,p,{x:0,y:0},{x:I,y:A+N},{width:R,height:1}),c.R.copy(C,p,{x:R-1,y:0},{x:I-1,y:A},{width:1,height:N}),c.R.copy(C,p,{x:0,y:0},{x:I+R,y:A},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.getImage(s);u||c.w(`Image with ID: "${s}" was not found`),be(u)&&this.updateImage(s,u)}}cloneImages(){const t={};for(const s in this.images){const u=this.images[s];t[s]=Object.assign(Object.assign({},u),{data:u.data?u.data.clone():null})}return t}}const de=1e20;function Qt(_,t,s,u,p,y,b,I,A){for(let C=t;C<t+u;C++)mn(_,s*y+C,y,p,b,I,A);for(let C=s;C<s+p;C++)mn(_,C*y+t,1,u,b,I,A)}function mn(_,t,s,u,p,y,b){y[0]=0,b[0]=-de,b[1]=de,p[0]=_[t];for(let I=1,A=0,C=0;I<u;I++){p[I]=_[t+I*s];const R=I*I;do{const N=y[A];C=(p[I]-p[N]+R-N*N)/(I-N)/2}while(C<=b[A]&&--A>-1);A++,y[A]=I,b[A]=C,b[A+1]=de}for(let I=0,A=0;I<u;I++){for(;b[A+1]<I;)A++;const C=y[A],R=I-C;_[t+I*s]=p[C]+R*R}}const gt=c.v.layout_symbol["text-font"].default.join(",");class vn{constructor(t,s,u){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={},this.lang=u}setURL(t){this.url=t}getGlyphs(t){return c._(this,void 0,void 0,(function*(){const s=[];for(const y in t)for(const b of t[y])s.push(this._getAndCacheGlyphsPromise(y,b));const u=yield Promise.all(s),p={};for(const{stack:y,id:b,glyph:I}of u)p[y]||(p[y]={}),p[y][b]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return p}))}_getAndCacheGlyphsPromise(t,s){return c._(this,void 0,void 0,(function*(){let u=this.entries[t];u||(u=this.entries[t]={glyphs:{},requests:{},ranges:{}});let p=u.glyphs[s];return p!==void 0?{stack:t,id:s,glyph:p}:!this.url||this._charUsesLocalIdeographFontFamily(s)?(p=u.glyphs[s]=this._drawGlyph(u,t,s),{stack:t,id:s,glyph:p}):yield this._downloadAndCacheRangePromise(t,s)}))}_downloadAndCacheRangePromise(t,s){return c._(this,void 0,void 0,(function*(){const u=this.entries[t],p=Math.floor(s/256);if(u.ranges[p])return{stack:t,id:s,glyph:null};if(!u.requests[p]){const y=vn.loadGlyphRange(t,p,this.url,this.requestManager);u.requests[p]=y}try{const y=yield u.requests[p];for(const b in y)u.glyphs[+b]=y[+b];return u.ranges[p]=!0,{stack:t,id:s,glyph:y[s]||null}}catch(y){const b=u.glyphs[s]=this._drawGlyph(u,t,s);return this._warnOnMissingGlyphRange(b,p,s,y),{stack:t,id:s,glyph:b}}}))}_warnOnMissingGlyphRange(t,s,u,p){const y=256*s,b=y+255,I=u.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${s}, ${y}-${b}. Rendering codepoint U+${I} locally instead. ${p}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&c.q(t)}_drawGlyph(t,s,u){const p=s===gt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(u),y=p?"ideographTinySDF":"tinySDF";t[y]||(t[y]=this._createTinySDF(p?this.localIdeographFontFamily:s));const b=t[y].draw(String.fromCodePoint(u));return{id:u,bitmap:new c.r({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const s=t?t.split(","):[];s.push("sans-serif");const u=s.map((p=>/[-\w]+/.test(p)?p:`'${CSS.escape(p)}'`)).join(",");return new vn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:this._fontWeight(s[0]),fontStyle:this._fontStyle(s[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const s={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let u;for(const[p,y]of Object.entries(s))new RegExp(`\\b${p}\\b`,"i").test(t)&&(u=`${y}`);return u}destroy(){for(const t in this.entries){const s=this.entries[t];s.tinySDF&&(s.tinySDF=null),s.ideographTinySDF&&(s.ideographTinySDF=null),s.glyphs={},s.requests={},s.ranges={}}this.entries={}}}vn.loadGlyphRange=function(_,t,s,u){return c._(this,void 0,void 0,(function*(){const p=256*t,y=p+255,b=u.transformRequest(s.replace("{fontstack}",_).replace("{range}",`${p}-${y}`),"Glyphs"),I=yield c.n(b,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${t}, ${p}-${y}`);const A={};for(const C of c.o(I.data))A[C.id]=C;return A}))},vn.TinySDF=class{constructor({fontSize:_=24,buffer:t=3,radius:s=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:b="normal",lang:I=null}={}){this.buffer=t,this.cutoff=u,this.radius=s,this.lang=I;const A=this.size=_+4*t,C=this._createCanvas(A),R=this.ctx=C.getContext("2d",{willReadFrequently:!0});R.font=`${b} ${y} ${_}px ${p}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(_){const t=document.createElement("canvas");return t.width=t.height=_,t}draw(_){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(_),b=Math.ceil(s),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),A=Math.min(this.size-this.buffer,b+Math.ceil(u)),C=I+2*this.buffer,R=A+2*this.buffer,N=Math.max(C*R,0),F=new Uint8ClampedArray(N),q={data:F,width:C,height:R,glyphWidth:I,glyphHeight:A,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(I===0||A===0)return q;const{ctx:Z,buffer:te,gridInner:ie,gridOuter:re}=this;this.lang&&(Z.lang=this.lang),Z.clearRect(te,te,I,A),Z.fillText(_,te,te+b);const ue=Z.getImageData(te,te,I,A);re.fill(de,0,N),ie.fill(0,0,N);for(let ve=0;ve<A;ve++)for(let le=0;le<I;le++){const _e=ue.data[4*(ve*I+le)+3]/255;if(_e===0)continue;const Te=(ve+te)*C+le+te;if(_e===1)re[Te]=0,ie[Te]=de;else{const me=.5-_e;re[Te]=me>0?me*me:0,ie[Te]=me<0?me*me:0}}Qt(re,0,0,C,R,C,this.f,this.v,this.z),Qt(ie,te,te,I,A,C,this.f,this.v,this.z);for(let ve=0;ve<N;ve++){const le=Math.sqrt(re[ve])-Math.sqrt(ie[ve]);F[ve]=Math.round(255-255*(le/this.radius+this.cutoff))}return q}};class gn{constructor(){this.specification=c.u.light.position}possiblyEvaluate(t,s){return c.F(t.expression.evaluate(s))}interpolate(t,s,u){return{x:c.G.number(t.x,s.x,u),y:c.G.number(t.y,s.y,u),z:c.G.number(t.z,s.z,u)}}}let St;class In extends c.E{constructor(t){super(),St=St||new c.t({anchor:new c.D(c.u.light.anchor),position:new gn,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(St,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(c.y,t,s))for(const u in t){const p=t[u];u.endsWith(c.z)?this._transitionable.setTransition(u.slice(0,-c.z.length),p):this._transitionable.setValue(u,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,u){return(!u||u.validate!==!1)&&c.B(this,t.call(c.C,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const jt=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class Ht extends c.E{constructor(t){super(),this._transitionable=new c.x(jt,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0))}setSky(t,s={}){if(!this._validate(c.J,t,s)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in t){const p=t[u];u.endsWith(c.z)?this._transitionable.setTransition(u.slice(0,-c.z.length),p):this._transitionable.setValue(u,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,u={}){return(u==null?void 0:u.validate)!==!1&&c.B(this,t.call(c.C,c.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Qn{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const u=t.join(",")+String(s);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,s)),this.dashEntry[u]}getDashRanges(t,s,u){const p=[];let y=t.length%2==1?-t[t.length-1]*u:0,b=t[0]*u,I=!0;p.push({left:y,right:b,isDash:I,zeroLength:t[0]===0});let A=t[0];for(let C=1;C<t.length;C++){I=!I;const R=t[C];y=A*u,A+=R,b=A*u,p.push({left:y,right:b,isDash:I,zeroLength:R===0})}return p}addRoundDash(t,s,u){const p=s/2;for(let y=-u;y<=u;y++){const b=this.width*(this.nextRow+u+y);let I=0,A=t[I];for(let C=0;C<this.width;C++){C/A.right>1&&(A=t[++I]);const R=Math.abs(C-A.left),N=Math.abs(C-A.right),F=Math.min(R,N);let q;const Z=y/u*(p+1);if(A.isDash){const te=p-Math.abs(Z);q=Math.sqrt(F*F+te*te)}else q=p-Math.sqrt(F*F+Z*Z);this.data[b+C]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(t){for(let I=t.length-1;I>=0;--I){const A=t[I],C=t[I+1];A.zeroLength?t.splice(I,1):C&&C.isDash===A.isDash&&(C.left=A.left,t.splice(I,1))}const s=t[0],u=t[t.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const p=this.width*this.nextRow;let y=0,b=t[y];for(let I=0;I<this.width;I++){I/b.right>1&&(b=t[++y]);const A=Math.abs(I-b.left),C=Math.abs(I-b.right),R=Math.min(A,C);this.data[p+I]=Math.max(0,Math.min(255,(b.isDash?R:-R)+128))}}addDash(t,s){const u=s?7:0,p=2*u+1;if(this.nextRow+p>this.height)return c.w("LineAtlas out of space"),null;let y=0;for(let I=0;I<t.length;I++)y+=t[I];if(y!==0){const I=this.width/y,A=this.getDashRanges(t,this.width,I);s?this.addRoundDash(A,I,u):this.addRegularDash(A)}const b={y:this.nextRow+u,height:2*u,width:y};return this.nextRow+=p,this.dirty=!0,b}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const kn="maplibre_preloaded_worker_pool";class Et{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Et.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[kn]}numActive(){return Object.keys(this.active).length}}const xt=Math.floor(xe.hardwareConcurrency/2);let At,Wt;function pn(){return At||(At=new Et),At}Et.workerCount=c.K(globalThis)?Math.max(Math.min(xt,3),1):1;class Zt{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const u=this.workerPool.acquire(s);for(let p=0;p<u.length;p++){const y=new c.L(u[p],s);y.name=`Worker ${p}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const u=[];for(const p of this.actors)u.push(p.sendAsync({type:t,data:s}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const u of this.actors)u.registerMessageHandler(t,s)}unregisterMessageHandler(t){for(const s of this.actors)s.unregisterMessageHandler(t)}}function ur(){return Wt||(Wt=new Zt(pn(),c.M),Wt.registerMessageHandler("GR",((_,t,s)=>c.m(t,s)))),Wt}function Sn(_,t){const s=c.N();return c.O(s,s,[1,1,0]),c.Q(s,s,[.5*_.width,.5*_.height,1]),_.calculatePosMatrix?c.S(s,s,_.calculatePosMatrix(t.toUnwrapped())):s}function Fn(_,t,s,u,p,y,b){var I;const A=(function(F,q,Z){if(F)for(const te of F){const ie=q[te];if(ie&&ie.source===Z&&ie.type==="fill-extrusion")return!0}else for(const te in q){const ie=q[te];if(ie.source===Z&&ie.type==="fill-extrusion")return!0}return!1})((I=p==null?void 0:p.layers)!==null&&I!==void 0?I:null,t,_.id),C=y.maxPitchScaleFactor(),R=_.tilesIn(u,C,A);R.sort(Vt);const N=[];for(const F of R)N.push({wrappedTileID:F.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(t,s,_.getState(),F.queryGeometry,F.cameraQueryGeometry,F.scale,p,y,C,Sn(y,F.tileID),b?(q,Z)=>b(F.tileID,q,Z):void 0)});return(function(F,q){for(const Z in F)for(const te of F[Z])Jt(te,q);return F})((function(F){const q={},Z={};for(const te of F){const ie=te.queryResults,re=te.wrappedTileID,ue=Z[re]=Z[re]||{};for(const ve in ie){const le=ie[ve],_e=ue[ve]=ue[ve]||{},Te=q[ve]=q[ve]||[];for(const me of le)_e[me.featureIndex]||(_e[me.featureIndex]=!0,Te.push(me))}}return q})(N),_)}function Vt(_,t){const s=_.tileID,u=t.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function Jt(_,t){const s=_.feature,u=t.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=u}function Cn(_,t,s){return c._(this,void 0,void 0,(function*(){let u=_;if(_.url?u=(yield c.j(t.transformRequest(_.url,"Source"),s)).data:yield xe.frameAsync(s),!u)return null;const p=c.U(c.e(u,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(p.vectorLayerIds=u.vector_layers.map((y=>y.id))),p}))}class Mt{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}extend(t){const s=this._sw,u=this._ne;let p,y;if(t instanceof c.V)p=t,y=t;else{if(!(t instanceof Mt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Mt.convert(t)):this.extend(c.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(c.V.convert(t)):this;if(p=t._sw,y=t._ne,!p||!y)return this}return s||u?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new c.V(p.lng,p.lat),this._ne=new c.V(y.lng,y.lat)),this}getCenter(){return new c.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.V(this.getWest(),this.getNorth())}getSouthEast(){return new c.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:u}=c.V.convert(t);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}intersects(t){if(!((t=Mt.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const s=Math.abs(this.getEast()-this.getWest()),u=Math.abs(t.getEast()-t.getWest());if(s>=360||u>=360)return!0;const p=c.W(this.getWest(),-180,180),y=c.W(this.getEast(),-180,180),b=c.W(t.getWest(),-180,180),I=c.W(t.getEast(),-180,180),A=p>=y,C=b>=I;return!(!A||!C)||(A?I>=p||b<=y:C?y>=b||p<=I:b<=y&&I>=p)}static convert(t){return t instanceof Mt?t:t&&new Mt(t)}static fromLngLat(t,s=0){const u=360*s/40075017,p=u/Math.cos(Math.PI/180*t.lat);return new Mt(new c.V(t.lng-p,t.lat-u),new c.V(t.lng+p,t.lat+u))}adjustAntiMeridian(){const t=new c.V(this._sw.lng,this._sw.lat),s=new c.V(this._ne.lng,this._ne.lat);return new Mt(t,t.lng>s.lng?new c.V(s.lng+360,s.lat):s)}}class Kt{constructor(t,s,u){this.bounds=Mt.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),u=Math.floor(c.Y(this.bounds.getWest())*s),p=Math.floor(c.X(this.bounds.getNorth())*s),y=Math.ceil(c.Y(this.bounds.getEast())*s),b=Math.ceil(c.X(this.bounds.getSouth())*s);return t.x>=u&&t.x<y&&t.y>=p&&t.y<b}}class $t extends c.E{constructor(t,s,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.U(s,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Cn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(c.e(this,t),t.bounds&&(this.tileBounds=new Kt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,c.Z(t)||this.fire(new c.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(t){return c._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};u.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((y,b)=>{t.reloadPromise={resolve:y,reject:b}}))}else t.actor=this.dispatcher.getActor(),p="LT";t.abortController=new AbortController;try{const y=yield t.actor.sendAsync({type:p,data:u},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,y)}catch(y){if(delete t.abortController,t.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const s=t.tileID.scaledTo(this.maxzoom).canonical,u=s.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:s,overzoomRequest:this.map._requestManager.transformRequest(u,"Tile")}}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const u=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(u.resolve).catch(u.reject)}}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Ot extends c.E{constructor(t,s,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},s),c.e(this,c.U(s,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Cn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(c.e(this,s),s.bounds&&(this.tileBounds=new Kt(s.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(s){this._tileJSONRequest=null,this._loaded=!0,c.Z(s)||this.fire(new c.k(s))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return c.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return c._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const u=yield he.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&t.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const p=this.map.painter.context,y=p.gl,b=u.data;t.texture=this.map.painter.getTileTexture(b.width),t.texture?t.texture.update(b,{useMipmap:!0}):(t.texture=new c.T(p,b,y.RGBA,{useMipmap:!0}),t.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(u){if(delete t.abortController,t.aborted)t.state="unloaded";else if(u)throw t.state="errored",u}}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class tn extends Ot{constructor(t,s,u,p){super(t,s,u,p),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return c._(this,void 0,void 0,(function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const p=yield he.getImage(u,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){const y=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const b=c.b(y)&&c.$()?y:yield this.readImageNow(y),I={type:this.type,uid:t.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const A=yield t.actor.sendAsync({type:"LDT",data:I});t.dem=A,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}}))}readImageNow(t){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.a0()){const s=t.width+2,u=t.height+2;try{return new c.R({width:s,height:u},yield c.a1(t,-1,-1,s,u))}catch{}}return xe.getImageData(t,1)}))}_getNeighboringTiles(t){const s=t.canonical,u=Math.pow(2,s.z),p=(s.x-1+u)%u,y=s.x===0?t.wrap-1:t.wrap,b=(s.x+1+u)%u,I=s.x+1===u?t.wrap+1:t.wrap,A={};return A[new c.a2(t.overscaledZ,y,s.z,p,s.y).key]={backfilled:!1},A[new c.a2(t.overscaledZ,I,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(A[new c.a2(t.overscaledZ,y,s.z,p,s.y-1).key]={backfilled:!1},A[new c.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},A[new c.a2(t.overscaledZ,I,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<u&&(A[new c.a2(t.overscaledZ,y,s.z,p,s.y+1).key]={backfilled:!1},A[new c.a2(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},A[new c.a2(t.overscaledZ,I,s.z,b,s.y+1).key]={backfilled:!1}),A}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function nn(_){return _.type==="GeometryCollection"?_.geometries.map((t=>t.coordinates)).flat(1/0):_.coordinates.flat(1/0)}function Rn(_){const t=new Mt;let s;switch(_.type){case"FeatureCollection":s=_.features.map((u=>nn(u.geometry))).flat(1/0);break;case"Feature":s=nn(_.geometry);break;default:s=nn(_)}if(s.length==0)return t;for(let u=0;u<s.length-1;u+=2)t.extend([s[u],s[u+1]]);return t}class xn extends c.E{constructor(t,s,u,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:s.data},this.actor=u.getActor(),this.setEventedParent(p),this._data=typeof s.data=="string"?{url:s.data}:{geojson:s.data},this._options=c.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:c.a5,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(s.clusterMaxZoom),minPoints:Math.max(2,s.clusterMinPoints||2),extent:c.a5,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(c.a5/this.tileSize)}_getClusterMaxZoom(t){const s=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${s}"`),s}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,s){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const u=this._updateWorkerData();return s?u:this}updateData(t,s){this._pendingWorkerUpdate.diff=c.a6(this._pendingWorkerUpdate.diff,t);const u=this._updateWorkerData();return s?u:this}getData(){return c._(this,void 0,void 0,(function*(){const t=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return c._(this,void 0,void 0,(function*(){return Rn(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:u}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:s}=this._pendingWorkerUpdate,u=c.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(u.request=this.map._requestManager.transformRequest(xe.resolveURL(t),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=t,this._pendingWorkerUpdate.data=void 0):s&&(u.dataDiff=s,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:u});if(this._isUpdatingWorker=!1,this._removed||p.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));p.data&&(this._data={geojson:p.data});const y=this._applyDiffToSource(s),b=this._getShouldReloadTileOptions(y);let I=null;p.resourceTiming&&p.resourceTiming[this.id]&&(I=p.resourceTiming[this.id].slice(0));const A={dataType:"source"};this._collectResourceTiming&&I&&I.length>0&&c.e(A,{resourceTiming:I}),this.fire(new c.l("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},A),{sourceDataType:"content",shouldReloadTileOptions:b})))}catch(p){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(p))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const s=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const p=c.a7(this._data.geojson,s);if(!p)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:p}}if(!this._data.updateable)return;const u=c.a8(this._data.updateable,t,s);return t.removeAll||this._options.cluster?void 0:u}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((s=>Rn(s)))}}shouldReloadTile(t,{affectedBounds:s}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:u,extent:p}=this.workerOptions.geojsonVtOptions,y=(function({x:b,y:I,z:A},C=0){const R=c.a3((b-C)/Math.pow(2,A)),N=c.a4((I+1+C)/Math.pow(2,A)),F=c.a3((b+1+C)/Math.pow(2,A)),q=c.a4((I-C)/Math.pow(2,A));return new Mt([R,N],[F,q])})(t.tileID.canonical,u/p);for(const b of s)if(y.intersects(b))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return c._(this,void 0,void 0,(function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const p=yield this.actor.sendAsync({type:s,data:u},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(p,this.map.painter,s==="RT")}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Xt extends c.E{constructor(t,s,u,p){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s}load(t){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield he.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,c.Z(s)||this.fire(new c.k(s))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(c.a9.fromLngLat);var u;return this.tileID=(function(p){const y=c.aa.fromPoints(p),b=y.width(),I=y.height(),A=Math.max(b,I),C=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),R=Math.pow(2,C);return new c.ac(C,Math.floor((y.minX+y.maxX)/2*R),Math.floor((y.minY+y.maxY)/2*R))})(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map((p=>this.tileID.getTilePoint(p)._round())),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.texture||(this.texture=new c.T(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:s,minY:u,maxX:p,maxY:y}=c.aa.fromPoints(t),b={};for(let I=0;I<=c.ab;I++){const A=Math.pow(2,I),C=Math.floor(s*A),R=Math.floor(u*A),N=Math.floor(p*A),F=Math.floor(y*A);b[I]={minTileX:C,minTileY:R,maxTileX:N,maxTileY:F}}return b}}class Pe extends Xt{constructor(t,s,u,p){super(t,s,u,p),this.roundZoom=!0,this.type="video",this.options=s}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield c.ad(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new c.k(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new c.k(new c.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class W extends Xt{constructor(t,s,u,p){super(t,s,u,p),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((b=>typeof b!="number"))))||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new c.k(new c.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,u=s.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new c.T(s,this.canvas,u.RGBA,{premultiply:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const y in this.tiles){const b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const H={},X=_=>{switch(_){case"geojson":return xn;case"image":return Xt;case"raster":return Ot;case"raster-dem":return tn;case"vector":return $t;case"video":return Pe;case"canvas":return W}return H[_]},fe="RTLPluginLoaded";class ge extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ur()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return c._(this,arguments,void 0,(function*(s,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=xe.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(fe))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let V=null;function Ie(){return V||(V=new ge),V}var we,ke;(function(_){_[_.Base=0]="Base",_[_.Parent=1]="Parent"})(we||(we={})),(function(_){_[_.Departing=0]="Departing",_[_.Incoming=1]="Incoming"})(ke||(ke={}));class Ge{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=c.af(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:s,fadingParentID:u,fadeEndTime:p}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=s,this.fadingParentID=u,this.fadeEndTime=p}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Ce(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(p,y){const b={};if(!y)return b;for(const I of p){const A=I.layerIds.map((C=>y.getLayer(C))).filter(Boolean);if(A.length!==0){I.layers=A,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map((C=>A.filter((R=>R.id===C))[0])));for(const C of A)b[C.id]=I}}return b})(t.buckets,s==null?void 0:s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof c.ah){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof c.ah&&y.hasRTLText){this.hasRTLText=!0,Ie().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(y))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new c.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,u,p,y,b,I,A,C,R,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:R,transform:A,params:I,queryPadding:this.queryPadding*C,getElevation:N},t,s,u):{}}querySourceFeatures(t,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),y=s&&s.sourceLayer?s.sourceLayer:"",b=p[c.ai]||p[y];if(!b)return;const I=c.aj(s==null?void 0:s.filter,s==null?void 0:s.globalState),{z:A,x:C,y:R}=this.tileID.canonical,N={z:A,x:C,y:R};for(let F=0;F<b.length;F++){const q=b.feature(F);if(I.needGeometry){const ie=c.ak(q,!0);if(!I.filter(new c.H(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!I.filter(new c.H(this.tileID.overscaledZ),q))continue;const Z=u.getId(q,y),te=new c.al(q,A,C,R,Z);te.tile=N,t.push(te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const u=c.am(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const y=this.expirationTime-s;y?this.expirationTime=u+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const y=this.buckets[p],b=y.layers[0].sourceLayer||c.ai,I=u[b],A=t[b];if(!I||!A||Object.keys(A).length===0)continue;y.update(A,I,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const C=s&&s.style&&s.style.getLayer(p);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(y)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ce()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=Ce()+t}setDependencies(t,s){const u={};for(const p of s)u[p]=!0;this.dependencies[t]=u}hasDependency(t,s){for(const u of t){const p=this.dependencies[u];if(p){for(const y of s)if(p[y])return!0}}return!1}}class Be{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,u){const p=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},c.e(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==p&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const y in this.state[t][p])u[y]||(this.deletedStates[t][p][y]=null)}else for(const y in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][y]===null&&delete this.deletedStates[t][p][y]}removeFeatureState(t,s,u){if(this.deletedStates[t]===null)return;const p=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&s!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,s){const u=String(s),p=c.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const y=this.deletedStates[t][s];if(y===null)return{};for(const b in y)delete p[b]}return p}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),c.e(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];u[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const b in this.state[p])y[b]={},this.state[p][b]={};else for(const b in this.deletedStates[p]){if(this.deletedStates[p][b]===null)this.state[p][b]={};else for(const I of Object.keys(this.deletedStates[p][b]))delete this.state[p][b][I];y[b]=this.state[p][b]}u[p]=u[p]||{},c.e(u[p],y)}this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0&&t.setFeatureState(u,s)}}const it=89.25;function ft(_,t){const s=c.an(t.lat,-c.ao,c.ao);return new c.P(c.Y(t.lng)*_,c.X(s)*_)}function It(_,t){return new c.a9(t.x/_,t.y/_).toLngLat()}function kt(_){return _.cameraToCenterDistance*Math.min(.85*Math.tan(c.ap(90-_.pitch)),Math.tan(c.ap(it-_.pitch)))}function Ft(_,t){const s=_.canonical,u=t/c.aq(s.z),p=s.x+Math.pow(2,s.z)*_.wrap,y=c.ar(new Float64Array(16));return c.O(y,y,[p*u,s.y*u,0]),c.Q(y,y,[u/c.a5,u/c.a5,1]),y}function Me(_,t,s,u,p){const y=c.a9.fromLngLat(_,t),b=p*c.as(1,_.lat),{x:I,y:A,z:C}=rn(s,u);return new c.a9(y.x+b*-I,y.y+b*-A,y.z+b*-C)}function rn(_,t){const s=c.ap(_),u=c.ap(t),p=Math.cos(-s),y=Math.sin(s);return{x:y*Math.sin(u),y:-y*Math.cos(u),z:p}}function An(_,t,s){const u=t.intersectsFrustum(_);if(!s||u===0)return u;const p=t.intersectsPlane(s);return p===0?0:u===2&&p===2?2:1}function Ct(_,t,s){let u=0;const p=(s-t)/10;for(let y=0;y<10;y++)u+=p*Math.pow(Math.cos(t+(y+.5)/10*(s-t)),_);return u}function Yt(_,t){return function(s,u,p,y,b){const I=2*((_-1)/c.at(Math.cos(c.ap(it-b))/Math.cos(c.ap(it)))-1),A=Math.acos(p/y),C=2*Ct(I-1,0,c.ap(b/2)),R=Math.min(c.ap(it),A+c.ap(b/2)),N=Ct(I-1,Math.min(R,A-c.ap(b/2)),R),F=Math.atan(u/p),q=Math.hypot(u,p);let Z=s;return Z+=c.at(y/q/Math.max(.5,Math.cos(c.ap(b/2)))),Z+=I*c.at(Math.cos(F))/2,Z-=c.at(Math.max(1,N/C/t))/2,Z}}const _n=Yt(9.314,3);function je(_,t){const s=(t.roundZoom?Math.round:Math.floor)(_.zoom+c.at(_.tileSize/t.tileSize));return Math.max(0,s)}function dt(_,t){const s=_.getCameraFrustum(),u=_.getClippingPlane(),p=_.screenPointToMercatorCoordinate(_.getCameraPoint()),y=c.a9.fromLngLat(_.center,_.elevation);p.z=y.z+Math.cos(_.pitchInRadians)*_.cameraToCenterDistance/_.worldSize;const b=_.getCoveringTilesDetailsProvider(),I=b.allowVariableZoom(_,t),A=je(_,t),C=t.minzoom||0,R=t.maxzoom!==void 0?t.maxzoom:_.maxZoom,N=Math.min(Math.max(0,A),R),F=Math.pow(2,N),q=[F*p.x,F*p.y,0],Z=[F*y.x,F*y.y,0],te=Math.hypot(y.x-p.x,y.y-p.y),ie=Math.abs(y.z-p.z),re=Math.hypot(te,ie),ue=_e=>({zoom:0,x:0,y:0,wrap:_e,fullyVisible:!1}),ve=[],le=[];if(_.renderWorldCopies&&b.allowWorldCopies())for(let _e=1;_e<=3;_e++)ve.push(ue(-_e)),ve.push(ue(_e));for(ve.push(ue(0));ve.length>0;){const _e=ve.pop(),Te=_e.x,me=_e.y;let Ae=_e.fullyVisible;const Ve={x:Te,y:me,z:_e.zoom},Le=b.getTileBoundingVolume(Ve,_e.wrap,_.elevation,t);if(!Ae){const ct=An(s,Le,u);if(ct===0)continue;Ae=ct===2}const ze=b.distanceToTile2d(p.x,p.y,Ve,Le);let Oe=A;I&&(Oe=(t.calculateTileZoom||_n)(_.zoom+c.at(_.tileSize/t.tileSize),ze,ie,re,_.fov)),Oe=(t.roundZoom?Math.round:Math.floor)(Oe),Oe=Math.max(0,Oe);const ot=Math.min(Oe,R);if(_e.wrap=b.getWrap(y,Ve,_e.wrap),_e.zoom>=ot){if(_e.zoom<C)continue;const ct=N-_e.zoom,tt=q[0]-.5-(Te<<ct),pt=q[1]-.5-(me<<ct),sn=t.reparseOverscaled?Math.max(_e.zoom,Oe):_e.zoom;le.push({tileID:new c.a2(_e.zoom===R?sn:_e.zoom,_e.wrap,_e.zoom,Te,me),distanceSq:c.au([Z[0]-.5-Te,Z[1]-.5-me]),tileDistanceToCamera:Math.sqrt(tt*tt+pt*pt)})}else for(let ct=0;ct<4;ct++)ve.push({zoom:_e.zoom+1,x:(Te<<1)+ct%2,y:(me<<1)+(ct>>1),wrap:_e.wrap,fullyVisible:Ae})}return le.sort(((_e,Te)=>_e.distanceSq-Te.distanceSq)).map((_e=>_e.tileID))}const Fe=c.aa.fromPoints([new c.P(0,0),new c.P(c.a5,c.a5)]);function wt(_){return _==="raster"||_==="image"||_==="video"}function Nt(_,t,s,u,p,y,b){if(!t.hasData())return!1;const{tileID:I,fadingRole:A,fadingDirection:C,fadingParentID:R}=t;if(A===we.Base&&C===ke.Incoming&&R)return s[R.key]=R,!0;const N=Math.max(I.overscaledZ-p,y);for(let F=I.overscaledZ-1;F>=N;F--){const q=I.scaledTo(F),Z=_.getLoadedTile(q);if(Z)return t.setCrossFadeLogic({fadingRole:we.Base,fadingDirection:ke.Incoming,fadingParentID:Z.tileID,fadeEndTime:u+b}),Z.setCrossFadeLogic({fadingRole:we.Parent,fadingDirection:ke.Departing,fadeEndTime:u+b}),s[q.key]=q,!0}return!1}function jn(_,t,s,u,p,y){if(!t.hasData())return!1;const b=t.tileID.children(p);let I=Ue(_,t,b,s,u,p,y);if(I)return!0;for(const A of b)Ue(_,t,A.children(p),s,u,p,y)&&(I=!0);return I}function Ue(_,t,s,u,p,y,b){if(s[0].overscaledZ>=y)return!1;let I=!1;for(const A of s){const C=_.getLoadedTile(A);if(!C)continue;const{fadingRole:R,fadingDirection:N,fadingParentID:F}=C;R===we.Base&&N===ke.Departing&&F||(C.setCrossFadeLogic({fadingRole:we.Base,fadingDirection:ke.Departing,fadingParentID:t.tileID,fadeEndTime:p+b}),t.setCrossFadeLogic({fadingRole:we.Parent,fadingDirection:ke.Incoming,fadeEndTime:p+b})),u[A.key]=A,I=!0}return I}function $n(_,t,s,u){const p=_.tileID;return!!_.selfFading||!_.hasData()&&!!t.has(p)&&(_.setSelfFadeLogic(s+u),!0)}function Jn(_,t){var s;_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let u=t.tileID.canonical.x-_.tileID.canonical.x;const p=t.tileID.canonical.y-_.tileID.canonical.y,y=Math.pow(2,_.tileID.canonical.z),b=t.tileID.key;u===0&&p===0||Math.abs(p)>1||(Math.abs(u)>1&&(Math.abs(u+y)===1?u+=y:Math.abs(u-y)===1&&(u-=y)),t.dem&&_.dem&&(_.dem.backfillBorder(t.dem,u,p),!((s=_.neighboringTiles)===null||s===void 0)&&s[b]&&(_.neighboringTiles[b].backfilled=!0)))}class Wi{constructor(){this._tiles={}}handleWrapJump(t){const s={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+t),s[p.tileID.key]=p}this._tiles=s}setFeatureState(t,s){for(const u in this._tiles)this._tiles[u].setFeatureState(t,s)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((s=>s.tileID)).sort(c.aw).map((s=>s.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,s){this._tiles[t]=s}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const s=this.getTileById(t.key);return s!=null&&s.hasData()?s:null}isIdRenderable(t,s=!1){var u;return(u=this.getTileById(t))===null||u===void 0?void 0:u.isRenderable(s)}getRenderableIds(t=0,s){const u=[];for(const p of this.getAllIds())this.isIdRenderable(p,s)&&u.push(this.getTileById(p));return s?u.sort(((p,y)=>{const b=p.tileID,I=y.tileID,A=new c.P(b.canonical.x,b.canonical.y)._rotate(-t),C=new c.P(I.canonical.x,I.canonical.y)._rotate(-t);return b.overscaledZ-I.overscaledZ||C.y-A.y||C.x-A.x})).map((p=>p.tileID.key)):u.map((p=>p.tileID)).sort(c.aw).map((p=>p.key))}}class mr extends c.E{constructor(t,s,u){super(),this.id=t,this.dispatcher=u,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,y,b,I)=>{const A=new(X(y.type))(p,y,b,I);if(A.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${A.id}`);return A})(t,s,u,this),this._inViewTiles=new Wi,this._outOfViewCache=new c.ax(0,(p=>this._unloadTile(p))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Be,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const s of this._inViewTiles.getAllTiles())s.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Wi}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,u){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,u)}catch(p){t.state="errored",p.status!==404?this._source.fire(new c.k(p,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new c.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const s of this._inViewTiles.getAllTiles())s.upload(t),s.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var s;return this._inViewTiles.getRenderableIds((s=this.transform)===null||s===void 0?void 0:s.bearingInRadians,t)}hasRenderableParent(t){const s=t.overscaledZ-1;if(s>=this._source.minzoom){const u=this.getLoadedTile(t.scaledTo(s));if(u)return this._inViewTiles.isIdRenderable(u.tileID.key)}return!1}reload(t,s=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const u of this._inViewTiles.getAllIds()){const p=this._inViewTiles.getTileById(u);s&&!this._source.shouldReloadTile(p,s)||(t?this._reloadTile(u,"expired"):p.state!=="errored"&&this._reloadTile(u,"reloading"))}}}_reloadTile(t,s){return c._(this,void 0,void 0,(function*(){const u=this._inViewTiles.getTileById(t);u&&(u.state!=="loading"&&(u.state=s),yield this._loadTile(u,t,s))}))}_tileLoaded(t,s,u){t.timeAdded=Ce(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&(function(p,y){var b,I;const A=y.getRenderableIds();for(const C of A){if(!p.neighboringTiles||!p.neighboringTiles[C])continue;const R=y.getTileById(C);p.neighboringTiles[C].backfilled||Jn(p,R),!((I=(b=R.neighboringTiles)===null||b===void 0?void 0:b[p.tileID.key])===null||I===void 0)&&I.backfilled||Jn(R,p)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,s){const u=this._getLoadedDescendents(s),p=new Set;for(const y of s){const b=u[y.key];if(!(b!=null&&b.length)){p.add(y);continue}const I=y.overscaledZ+mr.maxOverzooming,A=b.filter((N=>N.tileID.overscaledZ<=I));if(!A.length){p.add(y);continue}const C=Math.min(...A.map((N=>N.tileID.overscaledZ))),R=A.filter((N=>N.tileID.overscaledZ===C)).map((N=>N.tileID));for(const N of R)t[N.key]=N;this._areDescendentsComplete(R,C,y.overscaledZ)||p.add(y)}return p}_getLoadedDescendents(t){var s;const u={};for(const p of this._inViewTiles.getAllTiles().filter((y=>y.hasData())))for(const y of t)p.tileID.isChildOf(y)&&(u[s=y.key]||(u[s]=[])).push(p);return u}_areDescendentsComplete(t,s,u){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===s:Math.pow(4,s-u)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(s*u*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._outOfViewCache.setMaxSize(y)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,s&&(this._inViewTiles.handleWrapJump(s),this._resetTileReloadTimers())}update(t,s){if(!this._sourceLoaded||this._paused)return;let u;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((A=>new c.a2(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y))):(u=dt(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter((A=>this._source.hasTile(A))))):u=[],this.usedForTerrain&&(u=this._addTerrainIdealTiles(u));const p=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,p&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const y=je(t,this._source),b=this._updateRetainedTiles(u,y),I=wt(this._source.type);I&&this._rasterFadeDuration>0&&!s&&(function(A,C,R,N,F,q,Z){const te=Ce(),ie=c.av(C);for(const re of C){const ue=A.getTileById(re.key);ue.fadingDirection!==ke.Departing&&ue.fadeOpacity!==0||ue.resetFadeLogic(),Nt(A,ue,R,te,N,F,Z)||jn(A,ue,R,te,q,Z)||$n(ue,ie,te,Z)||ue.resetFadeLogic()}})(this._inViewTiles,u,b,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),I?this._cleanUpRasterTiles(b):this._cleanUpVectorTiles(b)}_cleanUpRasterTiles(t){for(const s of this._inViewTiles.getAllIds())t[s]||this._removeTile(s)}_cleanUpVectorTiles(t){for(const s of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(s);t[s]?u.clearSymbolFadeHold():u.hasSymbolBuckets?u.holdingForSymbolFade()?u.symbolFadeFinished()&&this._removeTile(s):u.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(s)}}_addTerrainIdealTiles(t){const s=[];for(const u of t)if(u.canonical.z>this._source.minzoom){const p=u.scaledTo(u.canonical.z-1);s.push(p);const y=u.scaledTo(Math.max(this._source.minzoom,Math.min(u.canonical.z,5)));s.push(y)}return t.concat(s)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var u;const p=new Set;for(const C of t)this._addTile(C).hasData()||p.add(C);const y=t.reduce(((C,R)=>(C[R.key]=R,C)),{}),b=this._retainLoadedChildren(y,p),I={},A=Math.max(s-mr.maxUnderzooming,this._source.minzoom);for(const C of b){let R=this._inViewTiles.getTileById(C.key),N=R==null?void 0:R.wasRequested();for(let F=C.overscaledZ-1;F>=A;--F){const q=C.scaledTo(F);if(I[q.key])break;if(I[q.key]=!0,R=this.getTile(q),!R&&N&&(R=this._addTile(q)),R){const Z=R.hasData();if((Z||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||N)&&(y[q.key]=q),N=R.wasRequested(),Z)break}}}return y}_addTile(t){let s=this._inViewTiles.getTileById(t.key);if(s)return s;s=this._outOfViewCache.getAndRemove(t),s&&(s.resetFadeLogic(),this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null));const u=s;return s||(s=new Ge(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._inViewTiles.setTile(t.key,s),u||this._source.fire(new c.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){this._clearTileReloadTimer(t);const u=s.getExpiryTimeout();u&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),u))}_clearTileReloadTimer(t){const s=this._timers[t];s&&(clearTimeout(s),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const s=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,s)}}refreshTiles(t){for(const s of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(s);(this._inViewTiles.isIdRenderable(s)||u.state=="errored")&&t.some((p=>p.equals(u.tileID.canonical)))&&this._reloadTile(s,"expired")}}_removeTile(t){const s=this._inViewTiles.getTileById(t);s&&(s.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._outOfViewCache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,s,u){const p=[],y=this.transform;if(!y)return p;const b=y.getCoveringTilesDetailsProvider().allowWorldCopies(),I=u?y.getCameraQueryGeometry(t):t,A=q=>y.screenPointToMercatorCoordinate(q,this.terrain),C=this.transformBbox(t,A,!b),R=this.transformBbox(I,A,!b),N=this.getIds(),F=c.aa.fromPoints(R);for(let q=0;q<N.length;q++){const Z=this._inViewTiles.getTileById(N[q]);if(Z.holdingForSymbolFade())continue;const te=b?[Z.tileID]:[Z.tileID.unwrapTo(-1),Z.tileID.unwrapTo(0)],ie=Math.pow(2,y.zoom-Z.tileID.overscaledZ),re=s*Z.queryPadding*c.a5/Z.tileSize/ie;for(const ue of te){const ve=F.map((le=>ue.getTilePoint(new c.a9(le.x,le.y))));if(ve.expandBy(re),ve.intersects(Fe)){const le=C.map((Te=>ue.getTilePoint(Te))),_e=R.map((Te=>ue.getTilePoint(Te)));p.push({tile:Z,tileID:b?ue:ue.unwrapTo(0),queryGeometry:le,cameraQueryGeometry:_e,scale:ie})}}}return p}transformBbox(t,s,u){let p=t.map(s);if(u){const y=c.aa.fromPoints(t);y.shrinkBy(.001*Math.min(y.width(),y.height()));const b=y.map(s);c.aa.fromPoints(p).covers(b)||(p=p.map((I=>I.x>.5?new c.a9(I.x-1,I.y,I.z):I)))}return p}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map((u=>this._inViewTiles.getTileById(u).tileID));return this.transform&&this.transform.populateCache(s),s}hasTransition(){return!!this._source.hasTransition()||!(!wt(this._source.type)||!(function(t,s){if(s<=0)return!1;const u=Ce();for(const p of t.getAllTiles())if(p.fadeEndTime>=u)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,s,u){this._state.updateState(t=t||c.ai,s,u)}removeFeatureState(t,s,u){this._state.removeFeatureState(t=t||c.ai,s,u)}getFeatureState(t,s){return this._state.getState(t=t||c.ai,s)}setDependencies(t,s,u){const p=this._inViewTiles.getTileById(t);p&&p.setDependencies(s,u)}reloadTilesForDependencies(t,s){for(const u of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(u).hasDependency(t,s)&&this._reloadTile(u,"reloading");this._outOfViewCache.filter((u=>!u.hasDependency(t,s)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}mr.maxUnderzooming=10,mr.maxOverzooming=3;class lt{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=c.an(t,0,1);let s=1,u=this._distances[s];const p=t*this.paddedLength+this.padding;for(;u<p&&s<this._distances.length;)u=this._distances[++s];const y=s-1,b=this._distances[y],I=u-b,A=I>0?(p-b)/I:0;return this.points[y].mult(1-A).add(this.points[s].mult(A))}}function Rt(_,t){let s=!0;return _==="always"||_!=="never"&&t!=="never"||(s=!1),s}class Ut{constructor(t,s,u){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(s/u);for(let b=0;b<this.xCellCount*this.yCellCount;b++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,u,p,y){this._forEachCell(s,u,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(t,s,u,p){this._forEachCell(s-p,u-p,s+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,s,u,p,y,b){this.boxCells[y].push(b)}_insertCircleCell(t,s,u,p,y,b){this.circleCells[y].push(b)}_query(t,s,u,p,y,b,I){if(u<0||t>this.width||p<0||s>this.height)return[];const A=[];if(t<=0&&s<=0&&this.width<=u&&this.height<=p){if(y)return[{key:null,x1:t,y1:s,x2:u,y2:p}];for(let C=0;C<this.boxKeys.length;C++)A.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const R=this.circles[3*C],N=this.circles[3*C+1],F=this.circles[3*C+2];A.push({key:this.circleKeys[C],x1:R-F,y1:N-F,x2:R+F,y2:N+F})}}else this._forEachCell(t,s,u,p,this._queryCell,A,{hitTest:y,overlapMode:b,seenUids:{box:{},circle:{}}},I);return A}query(t,s,u,p){return this._query(t,s,u,p,!1,null)}hitTest(t,s,u,p,y,b){return this._query(t,s,u,p,!0,y,b).length>0}hitTestCircle(t,s,u,p,y){const b=t-u,I=t+u,A=s-u,C=s+u;if(I<0||b>this.width||C<0||A>this.height)return!1;const R=[];return this._forEachCell(b,A,I,C,this._queryCellCircle,R,{hitTest:!0,overlapMode:p,circle:{x:t,y:s,radius:u},seenUids:{box:{},circle:{}}},y),R.length>0}_queryCell(t,s,u,p,y,b,I,A){const{seenUids:C,hitTest:R,overlapMode:N}=I,F=this.boxCells[y];if(F!==null){const Z=this.bboxes;for(const te of F)if(!C.box[te]){C.box[te]=!0;const ie=4*te,re=this.boxKeys[te];if(t<=Z[ie+2]&&s<=Z[ie+3]&&u>=Z[ie+0]&&p>=Z[ie+1]&&(!A||A(re))&&(!R||!Rt(N,re.overlapMode))&&(b.push({key:re,x1:Z[ie],y1:Z[ie+1],x2:Z[ie+2],y2:Z[ie+3]}),R))return!0}}const q=this.circleCells[y];if(q!==null){const Z=this.circles;for(const te of q)if(!C.circle[te]){C.circle[te]=!0;const ie=3*te,re=this.circleKeys[te];if(this._circleAndRectCollide(Z[ie],Z[ie+1],Z[ie+2],t,s,u,p)&&(!A||A(re))&&(!R||!Rt(N,re.overlapMode))){const ue=Z[ie],ve=Z[ie+1],le=Z[ie+2];if(b.push({key:re,x1:ue-le,y1:ve-le,x2:ue+le,y2:ve+le}),R)return!0}}}return!1}_queryCellCircle(t,s,u,p,y,b,I,A){const{circle:C,seenUids:R,overlapMode:N}=I,F=this.boxCells[y];if(F!==null){const Z=this.bboxes;for(const te of F)if(!R.box[te]){R.box[te]=!0;const ie=4*te,re=this.boxKeys[te];if(this._circleAndRectCollide(C.x,C.y,C.radius,Z[ie+0],Z[ie+1],Z[ie+2],Z[ie+3])&&(!A||A(re))&&!Rt(N,re.overlapMode))return b.push(!0),!0}}const q=this.circleCells[y];if(q!==null){const Z=this.circles;for(const te of q)if(!R.circle[te]){R.circle[te]=!0;const ie=3*te,re=this.circleKeys[te];if(this._circlesCollide(Z[ie],Z[ie+1],Z[ie+2],C.x,C.y,C.radius)&&(!A||A(re))&&!Rt(N,re.overlapMode))return b.push(!0),!0}}}_forEachCell(t,s,u,p,y,b,I,A){const C=this._convertToXCellCoord(t),R=this._convertToYCellCoord(s),N=this._convertToXCellCoord(u),F=this._convertToYCellCoord(p);for(let q=C;q<=N;q++)for(let Z=R;Z<=F;Z++)if(y.call(this,t,s,u,p,this.xCellCount*Z+q,b,I,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,u,p,y,b){const I=p-t,A=y-s,C=u+b;return C*C>I*I+A*A}_circleAndRectCollide(t,s,u,p,y,b,I){const A=(b-p)/2,C=Math.abs(t-(p+A));if(C>A+u)return!1;const R=(I-y)/2,N=Math.abs(s-(y+R));if(N>R+u)return!1;if(C<=A||N<=R)return!0;const F=C-A,q=N-R;return F*F+q*q<=u*u}}function Cr(_,t,s){const u=c.N();if(!_){const{vecSouth:N,vecEast:F}=nr(t),q=O();q[0]=F[0],q[1]=F[1],q[2]=N[0],q[3]=N[1],p=q,(R=(b=(y=q)[0])*(C=y[3])-(A=y[2])*(I=y[1]))&&(p[0]=C*(R=1/R),p[1]=-I*R,p[2]=-A*R,p[3]=b*R),u[0]=q[0],u[1]=q[1],u[4]=q[2],u[5]=q[3]}var p,y,b,I,A,C,R;return c.Q(u,u,[1/s,1/s,1]),u}function Di(_,t,s,u){if(_){const p=c.N();if(!t){const{vecSouth:y,vecEast:b}=nr(s);p[0]=b[0],p[1]=b[1],p[4]=y[0],p[5]=y[1]}return c.Q(p,p,[u,u,1]),p}return s.pixelsToClipSpaceMatrix}function nr(_){const t=Math.cos(_.rollInRadians),s=Math.sin(_.rollInRadians),u=Math.cos(_.pitchInRadians),p=Math.cos(_.bearingInRadians),y=Math.sin(_.bearingInRadians),b=c.aC();b[0]=-p*u*s-y*t,b[1]=-y*u*s+p*t;const I=c.aD(b);I<1e-9?c.aE(b):c.aF(b,b,1/I);const A=c.aC();A[0]=p*u*t-y*s,A[1]=y*u*t+p*s;const C=c.aD(A);return C<1e-9?c.aE(A):c.aF(A,A,1/C),{vecEast:A,vecSouth:b}}function Dt(_,t,s,u){let p;u?(p=[_,t,u(_,t),1],c.aH(p,p,s)):(p=[_,t,0,1],Mr(p,p,s));const y=p[3];return{point:new c.P(p[0]/y,p[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function Xn(_,t){return .5+_/t*.5}function ci(_,t){return _.x>=-t[0]&&_.x<=t[0]&&_.y>=-t[1]&&_.y<=t[1]}function Li(_,t,s,u,p,y,b,I,A,C,R,N,F){const q=s?_.textSizeData:_.iconSizeData,Z=c.ay(q,t.transform.zoom),te=[256/t.width*2+1,256/t.height*2+1],ie=s?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ie.clear();const re=_.lineVertexArray,ue=s?_.text.placedSymbolArray:_.icon.placedSymbolArray,ve=t.transform.width/t.transform.height;let le=!1;for(let _e=0;_e<ue.length;_e++){const Te=ue.get(_e);if(Te.hidden||Te.writingMode===c.az.vertical&&!le){Ur(Te.numGlyphs,ie);continue}le=!1;const me=new c.P(Te.anchorX,Te.anchorY),Ae={getElevation:F,pitchedLabelPlaneMatrix:u,lineVertexArray:re,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:me,unwrappedTileID:A,width:C,height:R,translation:N},Ve=Xr(Te.anchorX,Te.anchorY,Ae);if(!ci(Ve.point,te)){Ur(Te.numGlyphs,ie);continue}const Le=Xn(t.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),ze=c.aA(q,Z,Te),Oe=y?ze*t.transform.getPitchedTextCorrection(Te.anchorX,Te.anchorY,A)/Le:ze*Le,ot=ls({projectionContext:Ae,pitchedLabelPlaneMatrixInverse:p,symbol:Te,fontSize:Oe,flip:!1,keepUpright:b,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ie,aspectRatio:ve,rotateToLine:I});le=ot.useVertical,(ot.notEnoughRoom||le||ot.needsFlipping&&ls({projectionContext:Ae,pitchedLabelPlaneMatrixInverse:p,symbol:Te,fontSize:Oe,flip:!0,keepUpright:b,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ie,aspectRatio:ve,rotateToLine:I}).notEnoughRoom)&&Ur(Te.numGlyphs,ie)}s?_.text.dynamicLayoutVertexBuffer.updateData(ie):_.icon.dynamicLayoutVertexBuffer.updateData(ie)}function Kr(_,t,s,u,p,y,b,I){const A=y.glyphStartIndex+y.numGlyphs,C=y.lineStartIndex,R=y.lineStartIndex+y.lineLength,N=t.getoffsetX(y.glyphStartIndex),F=t.getoffsetX(A-1),q=Yr(_*N,s,u,p,y.segment,C,R,I,b);if(!q)return null;const Z=Yr(_*F,s,u,p,y.segment,C,R,I,b);return Z?I.projectionCache.anyProjectionOccluded?null:{first:q,last:Z}:null}function Zi(_,t,s,u){return _===c.az.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*u?{useVertical:!0}:(_===c.az.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function ls(_){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:s,symbol:u,fontSize:p,flip:y,keepUpright:b,glyphOffsetArray:I,dynamicLayoutVertexArray:A,aspectRatio:C,rotateToLine:R}=_,N=p/24,F=u.lineOffsetX*N,q=u.lineOffsetY*N;let Z;if(u.numGlyphs>1){const te=u.glyphStartIndex+u.numGlyphs,ie=u.lineStartIndex,re=u.lineStartIndex+u.lineLength,ue=Kr(N,I,F,q,y,u,R,t);if(!ue)return{notEnoughRoom:!0};const ve=cs(ue.first.point.x,ue.first.point.y,t,s),le=cs(ue.last.point.x,ue.last.point.y,t,s);if(b&&!y){const _e=Zi(u.writingMode,ve,le,C);if(_e)return _e}Z=[ue.first];for(let _e=u.glyphStartIndex+1;_e<te-1;_e++){const Te=Yr(N*I.getoffsetX(_e),F,q,y,u.segment,ie,re,t,R);if(!Te)return{notEnoughRoom:!0};Z.push(Te)}Z.push(ue.last)}else{if(b&&!y){const ie=Ln(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,re=u.lineStartIndex+u.segment+1,ue=new c.P(t.lineVertexArray.getx(re),t.lineVertexArray.gety(re)),ve=Ln(ue.x,ue.y,t),le=ve.signedDistanceFromCamera>0?ve.point:zi(t.tileAnchorPoint,ue,ie,1,t),_e=cs(ie.x,ie.y,t,s),Te=cs(le.x,le.y,t,s),me=Zi(u.writingMode,_e,Te,C);if(me)return me}const te=Yr(N*I.getoffsetX(u.glyphStartIndex),F,q,y,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,t,R);if(!te||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[te]}for(const te of Z)c.aG(A,te.point,te.angle);return{}}function zi(_,t,s,u,p){const y=_.add(_.sub(t)._unit()),b=Ln(y.x,y.y,p).point,I=s.sub(b);return s.add(I._mult(u/I.mag()))}function br(_,t,s){const u=t.projectionCache;if(u.projections[_])return u.projections[_];const p=new c.P(t.lineVertexArray.getx(_),t.lineVertexArray.gety(_)),y=Ln(p.x,p.y,t);if(y.signedDistanceFromCamera>0)return u.projections[_]=y.point,u.anyProjectionOccluded=u.anyProjectionOccluded||y.isOccluded,y.point;const b=_-s.direction;return zi(s.distanceFromAnchor===0?t.tileAnchorPoint:new c.P(t.lineVertexArray.getx(b),t.lineVertexArray.gety(b)),p,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function Ln(_,t,s){const u=_+s.translation[0],p=t+s.translation[1];let y;return s.pitchWithMap?(y=Dt(u,p,s.pitchedLabelPlaneMatrix,s.getElevation),y.isOccluded=!1):(y=s.transform.projectTileCoordinates(u,p,s.unwrappedTileID,s.getElevation),y.point.x=(.5*y.point.x+.5)*s.width,y.point.y=(.5*-y.point.y+.5)*s.height),y}function cs(_,t,s,u){if(s.pitchWithMap){const p=[_,t,0,1];return c.aH(p,p,u),s.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],s.unwrappedTileID,s.getElevation).point}return{x:_/s.width*2-1,y:1-t/s.height*2}}function Xr(_,t,s){return s.transform.projectTileCoordinates(_,t,s.unwrappedTileID,s.getElevation)}function yi(_,t,s){return _._unit()._perp()._mult(t*s)}function Oi(_,t,s,u,p,y,b,I,A){if(I.projectionCache.offsets[_])return I.projectionCache.offsets[_];const C=s.add(t);if(_+A.direction<u||_+A.direction>=p)return I.projectionCache.offsets[_]=C,C;const R=br(_+A.direction,I,A),N=yi(R.sub(s),b,A.direction),F=s.add(N),q=R.add(N);return I.projectionCache.offsets[_]=c.aI(y,C,F,q)||C,I.projectionCache.offsets[_]}function Yr(_,t,s,u,p,y,b,I,A){const C=u?_-t:_+t;let R=C>0?1:-1,N=0;u&&(R*=-1,N=Math.PI),R<0&&(N+=Math.PI);let F,q=R>0?y+p:y+p+1;I.projectionCache.cachedAnchorPoint?F=I.projectionCache.cachedAnchorPoint:(F=Ln(I.tileAnchorPoint.x,I.tileAnchorPoint.y,I).point,I.projectionCache.cachedAnchorPoint=F);let Z,te,ie=F,re=F,ue=0,ve=0;const le=Math.abs(C),_e=[];let Te;for(;ue+ve<=le;){if(q+=R,q<y||q>=b)return null;ue+=ve,re=ie,te=Z;const Ve={absOffsetX:le,direction:R,distanceFromAnchor:ue,previousVertex:re};if(ie=br(q,I,Ve),s===0)_e.push(re),Te=ie.sub(re);else{let Le;const ze=ie.sub(re);Le=ze.mag()===0?yi(br(q+R,I,Ve).sub(ie),s,R):yi(ze,s,R),te||(te=re.add(Le)),Z=Oi(q,Le,ie,y,b,te,s,I,Ve),_e.push(te),Te=Z.sub(te)}ve=Te.mag()}const me=Te._mult((le-ue)/ve)._add(te||re),Ae=N+Math.atan2(ie.y-re.y,ie.x-re.x);return _e.push(me),{point:me,angle:A?Ae:0,path:_e}}const vo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ur(_,t){for(let s=0;s<_;s++){const u=t.length;t.resize(u+4),t.float32.set(vo,3*u)}}function Mr(_,t,s){const u=t[0],p=t[1];return _[0]=s[0]*u+s[4]*p+s[12],_[1]=s[1]*u+s[5]*p+s[13],_[3]=s[3]*u+s[7]*p+s[15],_}const qn=100;class us{constructor(t,s=new Ut(t.width+200,t.height+200,25),u=new Ut(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=u,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+qn,this.screenBottomBoundary=t.height+qn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,u,p,y,b,I,A,C,R,N,F){const q=this.projectAndGetPerspectiveRatio(t.anchorPointX+A[0],t.anchorPointY+A[1],y,R,F),Z=u*q.perspectiveRatio;let te;if(b||I)te=this._projectCollisionBox(t,Z,p,y,b,I,A,q,R,N,F);else{const Te=q.x+(N?N.x*Z:0),me=q.y+(N?N.y*Z:0);te={allPointsOccluded:!1,box:[Te+t.x1*Z,me+t.y1*Z,Te+t.x2*Z,me+t.y2*Z]}}const[ie,re,ue,ve]=te.box,le=b?te.allPointsOccluded:q.isOccluded;let _e=le;return _e||(_e=q.perspectiveRatio<this.perspectiveRatioCutoff),_e||(_e=!this.isInsideGrid(ie,re,ue,ve)),_e||s!=="always"&&this.grid.hitTest(ie,re,ue,ve,s,C)?{box:[ie,re,ue,ve],placeable:!1,offscreen:!1,occluded:le}:{box:[ie,re,ue,ve],placeable:!0,offscreen:this.isOffscreen(ie,re,ue,ve),occluded:le}}placeCollisionCircles(t,s,u,p,y,b,I,A,C,R,N,F,q,Z){const te=[],ie=new c.P(s.anchorX,s.anchorY),re=this.getPerspectiveRatio(ie.x,ie.y,b,Z),ue=(C?y*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,b)/re:y*re)/c.aM,ve={getElevation:Z,pitchedLabelPlaneMatrix:I,lineVertexArray:u,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ie,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:q},le=Kr(ue,p,s.lineOffsetX*ue,s.lineOffsetY*ue,!1,s,!1,ve);let _e=!1,Te=!1,me=!0;if(le){const Ae=.5*N*re+F,Ve=new c.P(-100,-100),Le=new c.P(this.screenRightBoundary,this.screenBottomBoundary),ze=new lt,Oe=le.first,ot=le.last;let ct=[];for(let sn=Oe.path.length-1;sn>=1;sn--)ct.push(Oe.path[sn]);for(let sn=1;sn<ot.path.length;sn++)ct.push(ot.path[sn]);const tt=2.5*Ae;if(C){const sn=this.projectPathToScreenSpace(ct,ve);ct=sn.some((Yn=>Yn.signedDistanceFromCamera<=0))?[]:sn.map((Yn=>Yn.point))}let pt=[];if(ct.length>0){const sn=ct[0].clone(),Yn=ct[0].clone();for(let pr=1;pr<ct.length;pr++)sn.x=Math.min(sn.x,ct[pr].x),sn.y=Math.min(sn.y,ct[pr].y),Yn.x=Math.max(Yn.x,ct[pr].x),Yn.y=Math.max(Yn.y,ct[pr].y);pt=sn.x>=Ve.x&&Yn.x<=Le.x&&sn.y>=Ve.y&&Yn.y<=Le.y?[ct]:Yn.x<Ve.x||sn.x>Le.x||Yn.y<Ve.y||sn.y>Le.y?[]:c.aJ([ct],Ve.x,Ve.y,Le.x,Le.y)}for(const sn of pt){ze.reset(sn,.25*Ae);let Yn=0;Yn=ze.length<=.5*Ae?1:Math.ceil(ze.paddedLength/tt)+1;for(let pr=0;pr<Yn;pr++){const ir=pr/Math.max(Yn-1,1),_r=ze.lerp(ir),sr=_r.x+qn,Ir=_r.y+qn;te.push(sr,Ir,Ae,0);const yr=sr-Ae,ti=Ir-Ae,Fr=sr+Ae,Dr=Ir+Ae;if(me=me&&this.isOffscreen(yr,ti,Fr,Dr),Te=Te||this.isInsideGrid(yr,ti,Fr,Dr),t!=="always"&&this.grid.hitTestCircle(sr,Ir,Ae,t,R)&&(_e=!0,!A))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!A&&_e||!Te||re<this.perspectiveRatioCutoff?[]:te,offscreen:me,collisionDetected:_e}}projectPathToScreenSpace(t,s){const u=(function(p,y){const b=c.N();return c.aB(b,y.pitchedLabelPlaneMatrix),p.map((I=>{const A=Dt(I.x,I.y,b,y.getElevation),C=y.transform.projectTileCoordinates(A.point.x,A.point.y,y.unwrappedTileID,y.getElevation);return C.point.x=(.5*C.point.x+.5)*y.width,C.point.y=(.5*-C.point.y+.5)*y.height,C}))})(t,s);return(function(p){let y=0,b=0,I=0,A=0;for(let C=0;C<p.length;C++)p[C].isOccluded?(I=C+1,A=0):(A++,A>b&&(b=A,y=I));return p.slice(y,y+b)})(u)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[],u=new c.aa;for(const N of t){const F=new c.P(N.x+qn,N.y+qn);u.extend(F),s.push(F)}const{minX:p,minY:y,maxX:b,maxY:I}=u,A=this.grid.query(p,y,b,I).concat(this.ignoredGrid.query(p,y,b,I)),C={},R={};for(const N of A){const F=N.key;if(C[F.bucketInstanceId]===void 0&&(C[F.bucketInstanceId]={}),C[F.bucketInstanceId][F.featureIndex])continue;const q=[new c.P(N.x1,N.y1),new c.P(N.x2,N.y1),new c.P(N.x2,N.y2),new c.P(N.x1,N.y2)];c.aK(s,q)&&(C[F.bucketInstanceId][F.featureIndex]=!0,R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]=[]),R[F.bucketInstanceId].push(F.featureIndex))}return R}insertCollisionBox(t,s,u,p,y,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:b,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,u,p,y,b){const I=u?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:y,collisionGroupID:b,overlapMode:s};for(let C=0;C<t.length;C+=4)I.insertCircle(A,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,s,u,p,y){if(y){let b;p?(b=[t,s,p(t,s),1],c.aH(b,b,y)):(b=[t,s,0,1],Mr(b,b,y));const I=b[3];return{x:(b[0]/I+1)/2*this.transform.width+qn,y:(-b[1]/I+1)/2*this.transform.height+qn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I*.5,isOccluded:!1,signedDistanceFromCamera:I}}{const b=this.transform.projectTileCoordinates(t,s,u,p);return{x:(b.point.x+1)/2*this.transform.width+qn,y:(1-b.point.y)/2*this.transform.height+qn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5,isOccluded:b.isOccluded,signedDistanceFromCamera:b.signedDistanceFromCamera}}}getPerspectiveRatio(t,s,u,p){const y=this.transform.projectTileCoordinates(t,s,u,p);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(t,s,u,p){return u<qn||t>=this.screenRightBoundary||p<qn||s>this.screenBottomBoundary}isInsideGrid(t,s,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=c.ar([]);return c.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,u,p,y,b,I,A,C,R,N){let F=1,q=0,Z=0,te=1;const ie=t.anchorPointX+I[0],re=t.anchorPointY+I[1];if(b&&!y){const ct=this.projectAndGetPerspectiveRatio(ie+1,re,p,C,N),tt=ct.x-A.x,pt=Math.atan((ct.y-A.y)/tt)+(tt<0?Math.PI:0),sn=Math.sin(pt),Yn=Math.cos(pt);F=Yn,q=sn,Z=-sn,te=Yn}else if(!b&&y){const ct=nr(this.transform);F=ct.vecEast[0],q=ct.vecEast[1],Z=ct.vecSouth[0],te=ct.vecSouth[1]}let ue=A.x,ve=A.y,le=s;y&&(ue=ie,ve=re,le=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),le*=this.transform.getPitchedTextCorrection(ie,re,p),R||(le*=c.an(.5+A.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),R&&(ue+=F*R.x*le+Z*R.y*le,ve+=q*R.x*le+te*R.y*le);const _e=t.x1*le,Te=t.x2*le,me=(_e+Te)/2,Ae=t.y1*le,Ve=t.y2*le,Le=(Ae+Ve)/2,ze=[{offsetX:_e,offsetY:Ae},{offsetX:me,offsetY:Ae},{offsetX:Te,offsetY:Ae},{offsetX:Te,offsetY:Le},{offsetX:Te,offsetY:Ve},{offsetX:me,offsetY:Ve},{offsetX:_e,offsetY:Ve},{offsetX:_e,offsetY:Le}];let Oe=[];for(const{offsetX:ct,offsetY:tt}of ze)Oe.push(new c.P(ue+F*ct+Z*tt,ve+q*ct+te*tt));let ot=!1;if(y){const ct=Oe.map((tt=>this.projectAndGetPerspectiveRatio(tt.x,tt.y,p,C,N)));ot=ct.some((tt=>!tt.isOccluded)),Oe=ct.map((tt=>new c.P(tt.x,tt.y)))}else ot=!0;return{box:c.aL(Oe),allPointsOccluded:!ot}}}class hs{constructor(t,s,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class zn{constructor(t,s,u,p,y){this.text=new hs(t?t.text:null,s,u,y),this.icon=new hs(t?t.icon:null,s,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ki{constructor(t,s,u){this.text=t,this.icon=s,this.skipFade=u}}class ds{constructor(t,s,u,p,y){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=y}}class ps{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[t]}}function xo(_,t,s,u,p){const{horizontalAlign:y,verticalAlign:b}=c.aS(_);return new c.P(-(y-.5)*t+u[0]*p,-(b-.5)*s+u[1]*p)}class bo{constructor(t,s,u,p,y){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new us(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ps(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(u,p)=>s.getElevation(t,u,p):null}getBucketParts(t,s,u,p){const y=u.getBucket(s),b=u.latestFeatureIndex;if(!y||!b||s.id!==y.layerIds[0])return;const I=u.collisionBoxArray,A=y.layers[0].layout,C=y.layers[0].paint,R=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),N=u.tileSize/c.a5,F=u.tileID.toUnwrapped(),q=A.get("text-rotation-alignment")==="map",Z=c.aN(u,1,this.transform.zoom),te=c.aO(this.collisionIndex.transform,u,C.get("text-translate"),C.get("text-translate-anchor")),ie=c.aO(this.collisionIndex.transform,u,C.get("icon-translate"),C.get("icon-translate-anchor")),re=Cr(q,this.transform,Z);this.retainedQueryData[y.bucketInstanceId]=new ds(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,u.tileID);const ue={bucket:y,layout:A,translationText:te,translationIcon:ie,unwrappedTileID:F,pitchedLabelPlaneMatrix:re,scale:R,textPixelRatio:N,holdingForFade:u.holdingForSymbolFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:c.ay(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const ve of y.sortKeyRanges){const{sortKey:le,symbolInstanceStart:_e,symbolInstanceEnd:Te}=ve;t.push({sortKey:le,symbolInstanceStart:_e,symbolInstanceEnd:Te,parameters:ue})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(t,s,u,p,y,b,I,A,C,R,N,F,q,Z,te,ie,re,ue,ve,le){const _e=c.aP[t.textAnchor],Te=[t.textOffset0,t.textOffset1],me=xo(_e,u,p,Te,y),Ae=this.collisionIndex.placeCollisionBox(s,F,A,C,R,I,b,ie,N.predicate,ve,me,le);if((!ue||this.collisionIndex.placeCollisionBox(ue,F,A,C,R,I,b,re,N.predicate,ve,me,le).placeable)&&Ae.placeable){let Ve;if(this.prevPlacement&&this.prevPlacement.variableOffsets[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID]&&this.prevPlacement.placements[q.crossTileID].text&&(Ve=this.prevPlacement.variableOffsets[q.crossTileID].anchor),q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[q.crossTileID]={textOffset:Te,width:u,height:p,anchor:_e,textBoxScale:y,prevAnchor:Ve},this.markUsedJustification(Z,_e,q,te),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,te,q),this.placedOrientations[q.crossTileID]=te),{shift:me,placedGlyphBoxes:Ae}}}placeLayerBucketPart(t,s,u){const{bucket:p,layout:y,translationText:b,translationIcon:I,unwrappedTileID:A,pitchedLabelPlaneMatrix:C,textPixelRatio:R,holdingForFade:N,collisionBoxArray:F,partiallyEvaluatedTextSize:q,collisionGroup:Z}=t.parameters,te=y.get("text-optional"),ie=y.get("icon-optional"),re=c.aQ(y,"text-overlap","text-allow-overlap"),ue=re==="always",ve=c.aQ(y,"icon-overlap","icon-allow-overlap"),le=ve==="always",_e=y.get("text-rotation-alignment")==="map",Te=y.get("text-pitch-alignment")==="map",me=y.get("icon-text-fit")!=="none",Ae=y.get("symbol-z-order")==="viewport-y",Ve=ue&&(le||!p.hasIconData()||ie),Le=le&&(ue||!p.hasTextData()||te);!p.collisionArrays&&F&&p.deserializeCollisionBoxes(F);const ze=this.retainedQueryData[p.bucketInstanceId].tileID,Oe=this._getTerrainElevationFunc(ze),ot=this.transform.getFastPathSimpleProjectionMatrix(ze),ct=(tt,pt,sn)=>{var Yn,pr;if(s[tt.crossTileID])return;if(N)return void(this.placements[tt.crossTileID]=new Ki(!1,!1,!1));let ir=!1,_r=!1,sr=!0,Ir=null,yr={box:null,placeable:!1,offscreen:null,occluded:!1},ti={placeable:!1},Fr=null,Dr=null,di=null,Ro=0,ao=0,Ks=0;pt.textFeatureIndex?Ro=pt.textFeatureIndex:tt.useRuntimeCollisionCircles&&(Ro=tt.featureIndex),pt.verticalTextFeatureIndex&&(ao=pt.verticalTextFeatureIndex);const Vi=pt.textBox;if(Vi){const vs=lr=>{let or=c.az.horizontal;if(p.allowVerticalPlacement&&!lr&&this.prevPlacement){const Hr=this.prevPlacement.placedOrientations[tt.crossTileID];Hr&&(this.placedOrientations[tt.crossTileID]=Hr,or=Hr,this.markUsedOrientation(p,or,tt))}return or},Xs=(lr,or)=>{if(p.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&pt.verticalTextBox){for(const Hr of p.writingModes)if(Hr===c.az.vertical?(yr=or(),ti=yr):yr=lr(),yr&&yr.placeable)break}else yr=lr()},Rs=tt.textAnchorOffsetStartIndex,Ds=tt.textAnchorOffsetEndIndex;if(Ds===Rs){const lr=(or,Hr)=>{const Wr=this.collisionIndex.placeCollisionBox(or,re,R,ze,A,Te,_e,b,Z.predicate,Oe,void 0,ot);return Wr&&Wr.placeable&&(this.markUsedOrientation(p,Hr,tt),this.placedOrientations[tt.crossTileID]=Hr),Wr};Xs((()=>lr(Vi,c.az.horizontal)),(()=>{const or=pt.verticalTextBox;return p.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&or?lr(or,c.az.vertical):{box:null,offscreen:null}})),vs(yr&&yr.placeable)}else{let lr=c.aP[(pr=(Yn=this.prevPlacement)===null||Yn===void 0?void 0:Yn.variableOffsets[tt.crossTileID])===null||pr===void 0?void 0:pr.anchor];const or=(Wr,vp,xp)=>{const pa=Wr.x2-Wr.x1,Mm=Wr.y2-Wr.y1,bp=tt.textBoxScale,Mh=me&&ve==="never"?vp:null;let Do=null,Lo=re==="never"?1:2,zo="never";lr&&Lo++;for(let kh=0;kh<Lo;kh++){for(let Rh=Rs;Rh<Ds;Rh++){const ru=p.textAnchorOffsets.get(Rh);if(lr&&ru.textAnchor!==lr)continue;const iu=this.attemptAnchorPlacement(ru,Wr,pa,Mm,bp,_e,Te,R,ze,A,Z,zo,tt,p,xp,b,I,Mh,Oe);if(iu&&(Do=iu.placedGlyphBoxes,Do&&Do.placeable))return ir=!0,Ir=iu.shift,Do}lr?lr=null:zo=re}return u&&!Do&&(Do={box:this.collisionIndex.placeCollisionBox(Vi,"always",R,ze,A,Te,_e,b,Z.predicate,Oe,void 0,ot).box,offscreen:!1,placeable:!1,occluded:!1}),Do};Xs((()=>or(Vi,pt.iconBox,c.az.horizontal)),(()=>{const Wr=pt.verticalTextBox;return p.allowVerticalPlacement&&(!yr||!yr.placeable)&&tt.numVerticalGlyphVertices>0&&Wr?or(Wr,pt.verticalIconBox,c.az.vertical):{box:null,occluded:!0,offscreen:null}})),yr&&(ir=yr.placeable,sr=yr.offscreen);const Hr=vs(yr&&yr.placeable);if(!ir&&this.prevPlacement){const Wr=this.prevPlacement.variableOffsets[tt.crossTileID];Wr&&(this.variableOffsets[tt.crossTileID]=Wr,this.markUsedJustification(p,Wr.anchor,tt,Hr))}}}if(Fr=yr,ir=Fr&&Fr.placeable,sr=Fr&&Fr.offscreen,tt.useRuntimeCollisionCircles&&tt.centerJustifiedTextSymbolIndex>=0){const vs=p.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex),Xs=c.aA(p.textSizeData,q,vs),Rs=y.get("text-padding");Dr=this.collisionIndex.placeCollisionCircles(re,vs,p.lineVertexArray,p.glyphOffsetArray,Xs,A,C,u,Te,Z.predicate,tt.collisionCircleDiameter,Rs,b,Oe),Dr.circles.length&&Dr.collisionDetected&&!u&&c.w("Collisions detected, but collision boxes are not shown"),ir=ue||Dr.circles.length>0&&!Dr.collisionDetected,sr=sr&&Dr.offscreen}if(pt.iconFeatureIndex&&(Ks=pt.iconFeatureIndex),pt.iconBox){const vs=Xs=>this.collisionIndex.placeCollisionBox(Xs,ve,R,ze,A,Te,_e,I,Z.predicate,Oe,me&&Ir?Ir:void 0,ot);ti&&ti.placeable&&pt.verticalIconBox?(di=vs(pt.verticalIconBox),_r=di.placeable):(di=vs(pt.iconBox),_r=di.placeable),sr=sr&&di.offscreen}const ha=te||tt.numHorizontalGlyphVertices===0&&tt.numVerticalGlyphVertices===0,Xl=ie||tt.numIconVertices===0;ha||Xl?Xl?ha||(_r=_r&&ir):ir=_r&&ir:_r=ir=_r&&ir;const da=_r&&di.placeable;if(ir&&Fr.placeable&&this.collisionIndex.insertCollisionBox(Fr.box,re,y.get("text-ignore-placement"),p.bucketInstanceId,ti&&ti.placeable&&ao?ao:Ro,Z.ID),da&&this.collisionIndex.insertCollisionBox(di.box,ve,y.get("icon-ignore-placement"),p.bucketInstanceId,Ks,Z.ID),Dr&&ir&&this.collisionIndex.insertCollisionCircles(Dr.circles,re,y.get("text-ignore-placement"),p.bucketInstanceId,Ro,Z.ID),u&&this.storeCollisionData(p.bucketInstanceId,sn,pt,Fr,di,Dr),tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[tt.crossTileID]=new Ki((ir||Ve)&&!(Fr!=null&&Fr.occluded),(_r||Le)&&!(di!=null&&di.occluded),sr||p.justReloaded),s[tt.crossTileID]=!0};if(Ae){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const tt=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let pt=tt.length-1;pt>=0;--pt){const sn=tt[pt];ct(p.symbolInstances.get(sn),p.collisionArrays[sn],sn)}}else for(let tt=t.symbolInstanceStart;tt<t.symbolInstanceEnd;tt++)ct(p.symbolInstances.get(tt),p.collisionArrays[tt],tt);p.justReloaded=!1}storeCollisionData(t,s,u,p,y,b){if(u.textBox||u.iconBox){let I,A;this.collisionBoxArrays.has(t)?I=this.collisionBoxArrays.get(t):(I=new Map,this.collisionBoxArrays.set(t,I)),I.has(s)?A=I.get(s):(A={text:null,icon:null},I.set(s,A)),u.textBox&&(A.text=p.box),u.iconBox&&(A.icon=y.box)}if(b){let I=this.collisionCircleArrays[t];I===void 0&&(I=this.collisionCircleArrays[t]=[]);for(let A=0;A<b.circles.length;A+=4)I.push(b.circles[A+0]-qn),I.push(b.circles[A+1]-qn),I.push(b.circles[A+2]),I.push(b.collisionDetected?1:0)}}markUsedJustification(t,s,u,p){let y;y=p===c.az.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[c.aR(s)];const b=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const I of b)I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=y>=0&&I!==y?0:u.crossTileID)}markUsedOrientation(t,s,u){const p=s===c.az.horizontal||s===c.az.horizontalOnly?s:0,y=s===c.az.vertical?s:0,b=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const I of b)t.text.placedSymbolArray.get(I).placedOrientation=p;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(t):1,y=s?s.opacities:{},b=s?s.variableOffsets:{},I=s?s.placedOrientations:{};for(const A in this.placements){const C=this.placements[A],R=y[A];R?(this.opacities[A]=new zn(R,p,C.text,C.icon),u=u||C.text!==R.text.placed||C.icon!==R.icon.placed):(this.opacities[A]=new zn(null,p,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const A in y){const C=y[A];if(!this.opacities[A]){const R=new zn(C,p,!1,!1);R.isHidden()||(this.opacities[A]=R,u=u||C.text.placed||C.icon.placed)}}for(const A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(const A in I)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=I[A]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const u={};for(const p of s){const y=p.getBucket(t);y&&p.latestFeatureIndex&&t.id===y.layerIds[0]&&this.updateBucketOpacities(y,p.tileID,u,p.collisionBoxArray)}}updateBucketOpacities(t,s,u,p){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const y=t.layers[0],b=y.layout,I=new zn(null,0,!1,!1,!0),A=b.get("text-allow-overlap"),C=b.get("icon-allow-overlap"),R=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=b.get("text-rotation-alignment")==="map",F=b.get("text-pitch-alignment")==="map",q=b.get("icon-text-fit")!=="none",Z=new zn(null,0,A&&(C||!t.hasIconData()||b.get("icon-optional")),C&&(A||!t.hasTextData()||b.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const te=(re,ue,ve)=>{for(let le=0;le<ue/4;le++)re.opacityVertexArray.emplaceBack(ve);re.hasVisibleVertices=re.hasVisibleVertices||ve!==wo},ie=this.collisionBoxArrays.get(t.bucketInstanceId);for(let re=0;re<t.symbolInstances.length;re++){const ue=t.symbolInstances.get(re),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:le,crossTileID:_e}=ue;let Te=this.opacities[_e];u[_e]?Te=I:Te||(Te=Z,this.opacities[_e]=Te),u[_e]=!0;const me=ue.numIconVertices>0,Ae=this.placedOrientations[ue.crossTileID],Ve=Ae===c.az.vertical,Le=Ae===c.az.horizontal||Ae===c.az.horizontalOnly;if(ve>0||le>0){const Oe=Ma(Te.text);te(t.text,ve,Ve?wo:Oe),te(t.text,le,Le?wo:Oe);const ot=Te.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach((pt=>{pt>=0&&(t.text.placedSymbolArray.get(pt).hidden=ot||Ve?1:0)})),ue.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=ot||Le?1:0);const ct=this.variableOffsets[ue.crossTileID];ct&&this.markUsedJustification(t,ct.anchor,ue,Ae);const tt=this.placedOrientations[ue.crossTileID];tt&&(this.markUsedJustification(t,"left",ue,tt),this.markUsedOrientation(t,tt,ue))}if(me){const Oe=Ma(Te.icon),ot=!(q&&ue.verticalPlacedIconSymbolIndex&&Ve);ue.placedIconSymbolIndex>=0&&(te(t.icon,ue.numIconVertices,ot?Oe:wo),t.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=Te.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(te(t.icon,ue.numVerticalIconVertices,ot?wo:Oe),t.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=Te.icon.isHidden())}const ze=ie&&ie.has(re)?ie.get(re):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Oe=t.collisionArrays[re];if(Oe){let ot=new c.P(0,0);if(Oe.textBox||Oe.verticalTextBox){let ct=!0;if(R){const tt=this.variableOffsets[_e];tt?(ot=xo(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),N&&ot._rotate(F?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ct=!1}if(Oe.textBox||Oe.verticalTextBox){let tt;Oe.textBox&&(tt=Ve),Oe.verticalTextBox&&(tt=Le),Yo(t.textCollisionBox.collisionVertexArray,Te.text.placed,!ct||tt,ze.text,ot.x,ot.y)}}if(Oe.iconBox||Oe.verticalIconBox){const ct=!!(!Le&&Oe.verticalIconBox);let tt;Oe.iconBox&&(tt=ct),Oe.verticalIconBox&&(tt=!ct),Yo(t.iconCollisionBox.collisionVertexArray,Te.icon.placed,tt,ze.icon,q?ot.x:0,q?ot.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function Yo(_,t,s,u,p,y){u&&u.length!==0||(u=[0,0,0,0]);const b=u[0]-qn,I=u[1]-qn,A=u[2]-qn,C=u[3]-qn;_.emplaceBack(t?1:0,s?1:0,p||0,y||0,b,I),_.emplaceBack(t?1:0,s?1:0,p||0,y||0,A,I),_.emplaceBack(t?1:0,s?1:0,p||0,y||0,A,C),_.emplaceBack(t?1:0,s?1:0,p||0,y||0,b,C)}const Qo=Math.pow(2,25),Jo=Math.pow(2,24),vl=Math.pow(2,17),Xi=Math.pow(2,16),Fi=Math.pow(2,9),ea=Math.pow(2,8),to=Math.pow(2,1);function Ma(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const t=_.placed?1:0,s=Math.floor(127*_.opacity);return s*Qo+t*Jo+s*vl+t*Xi+s*Fi+t*ea+s*to+t}const wo=0;class Es{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,u,p,y){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(b,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(((I,A)=>I.sortKey-A.sortKey)));this._currentPartIndex<b.length;)if(s.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,y())return!0;return!1}}class Yi{constructor(t,s,u,p,y,b,I,A){this.placement=new bo(t,s,b,I,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,s,u){const p=Ce(),y=()=>!this._forceFullPlacement&&Ce()-p>2;for(;this._currentPlacementIndex>=0;){const b=s[t[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=I)&&(!b.maxzoom||b.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Es(b)),this._inProgressLayer.continuePlacement(u[b.source],this.placement,this._showCollisionBoxes,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const fn=512/c.a5/2;class xl{constructor(t,s,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const p=new Map;for(let y=0;y<s.length;y++){const b=s.get(y),I=b.key,A=p.get(I);A?A.push(b):p.set(I,[b])}for(const[y,b]of p){const I={positions:b.map((A=>({x:Math.floor(A.anchorX*fn),y:Math.floor(A.anchorY*fn)}))),crossTileIDs:b.map((A=>A.crossTileID))};if(I.positions.length>128){const A=new c.aT(I.positions.length,16,Uint16Array);for(const{x:C,y:R}of I.positions)A.add(C,R);A.finish(),delete I.positions,I.index=A}this._symbolsByKey[y]=I}}getScaledCoordinates(t,s){const{x:u,y:p,z:y}=this.tileID.canonical,{x:b,y:I,z:A}=s.canonical,C=fn/Math.pow(2,A-y),R=(I*c.a5+t.anchorY)*C,N=p*c.a5*fn;return{x:Math.floor((b*c.a5+t.anchorX)*C-u*c.a5*fn),y:Math.floor(R-N)}}findMatches(t,s,u){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let y=0;y<t.length;y++){const b=t.get(y);if(b.crossTileID)continue;const I=this._symbolsByKey[b.key];if(!I)continue;const A=this.getScaledCoordinates(b,s);if(I.index){const C=I.index.range(A.x-p,A.y-p,A.x+p,A.y+p).sort();for(const R of C){const N=I.crossTileIDs[R];if(!u[N]){u[N]=!0,b.crossTileID=N;break}}}else if(I.positions)for(let C=0;C<I.positions.length;C++){const R=I.positions[C],N=I.crossTileIDs[C];if(Math.abs(R.x-A.x)<=p&&Math.abs(R.y-A.y)<=p&&!u[N]){u[N]=!0,b.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Wu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const u in this.indexes){const p=this.indexes[u],y={};for(const b in p){const I=p[b];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+s),y[I.tileID.key]=I}this.indexes[u]=y}this.lng=t}addBucket(t,s,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>t.overscaledZ)for(const I in b){const A=b[I];A.tileID.isChildOf(t)&&A.findMatches(s.symbolInstances,t,p)}else{const I=b[t.scaledTo(Number(y)).key];I&&I.findMatches(s.symbolInstances,t,p)}}for(let y=0;y<s.symbolInstances.length;y++){const b=s.symbolInstances.get(y);b.crossTileID||(b.crossTileID=u.generate(),p[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new xl(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const u of s.getCrossTileIDsLists())for(const p of u)delete this.usedCrossTileIDs[t][p]}removeStaleBuckets(t){let s=!1;for(const u in this.indexes){const p=this.indexes[u];for(const y in p)t[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[y]),delete p[y],s=!0)}return s}}class vi{constructor(){this.layerIndexes={},this.crossTileIDs=new Wu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,u){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new fs);let y=!1;const b={};p.handleWrapJump(u);for(const I of s){const A=I.getBucket(t);A&&t.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(I.tileID,A,this.crossTileIDs)&&(y=!0),b[A.bucketInstanceId]=!0)}return p.removeStaleBuckets(b)&&(y=!0),y}pruneUnusedLayers(t){const s={};t.forEach((u=>{s[u]=!0}));for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}var jr="void main() {fragColor=vec4(1.0);}";const er={prelude:qt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:qt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:qt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:qt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:qt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qt(jr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:qt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:qt(jr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:qt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:qt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:qt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:qt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:qt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:qt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:qt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:qt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:qt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function qt(_,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/in ([\w]+) ([\w]+)/g),p=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=y?y.concat(p):p,I={};return{fragmentSource:_=_.replace(s,((A,C,R,N,F)=>(I[F]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${R} ${N} ${F};
#else
uniform ${R} ${N} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${R} ${N} ${F} = u_${F};
#endif
`))),vertexSource:t=t.replace(s,((A,C,R,N,F)=>{const q=N==="float"?"vec2":"vec4",Z=F.match(/color/)?"color":q;return I[F]?C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${R} ${q} a_${F};
out ${R} ${N} ${F};
#else
uniform ${R} ${N} u_${F};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${R} ${N} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${Z}(a_${F}, u_${F}_t);
#else
    ${R} ${N} ${F} = u_${F};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${R} ${q} a_${F};
#else
uniform ${R} ${N} u_${F};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${R} ${N} ${F} = a_${F};
#else
    ${R} ${N} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${R} ${N} ${F} = unpack_mix_${Z}(a_${F}, u_${F}_t);
#else
    ${R} ${N} ${F} = u_${F};
#endif
`})),staticAttributes:u,staticUniforms:b}}class Nn{constructor(t,s,u){this.vertexBuffer=t,this.indexBuffer=s,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ni=c.aU([{name:"a_pos",type:"Int16",components:2}]);const Qr="#define PROJECTION_MERCATOR",ui="mercator";class Dn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ui}get shaderDefine(){return Qr}get shaderPreludeCode(){return er.projectionMercator}get vertexShaderPreludeCode(){return er.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,s,u,p,y){if(this._cachedMesh)return this._cachedMesh;const b=new c.aW;b.emplaceBack(0,0),b.emplaceBack(c.a5,0),b.emplaceBack(0,c.a5),b.emplaceBack(c.a5,c.a5);const I=t.createVertexBuffer(b,Ni.members),A=c.aX.simpleSegment(0,0,4,2),C=new c.aY;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3);const R=t.createIndexBuffer(C);return this._cachedMesh=new Nn(I,R,A),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class To{constructor(t=0,s=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=u,this.right=p}interpolate(t,s,u){return s.top!=null&&t.top!=null&&(this.top=c.G.number(t.top,s.top,u)),s.bottom!=null&&t.bottom!=null&&(this.bottom=c.G.number(t.bottom,s.bottom,u)),s.left!=null&&t.left!=null&&(this.left=c.G.number(t.left,s.left,u)),s.right!=null&&t.right!=null&&(this.right=c.G.number(t.right,s.right,u)),this}getCenter(t,s){const u=c.an((this.left+t-this.right)/2,0,t),p=c.an((this.top+s-this.bottom)/2,0,s);return new c.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new To(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Bs(_,t){if(!_.renderWorldCopies||_.lngRange)return;const s=t.lng-_.center.lng;t.lng+=s>180?-360:s<-180?360:0}function gr(_){return Math.max(0,Math.floor(_))}class Us{constructor(t,s){var u;this.applyConstrain=(p,y)=>this._constrainOverride!==null?this._constrainOverride(p,y):this._callbacks.defaultConstrain(p,y),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=(s==null?void 0:s.renderWorldCopies)===void 0||!!(s!=null&&s.renderWorldCopies),this._minZoom=(s==null?void 0:s.minZoom)||0,this._maxZoom=(s==null?void 0:s.maxZoom)||22,this._minPitch=(s==null?void 0:s.minPitch)==null?0:s==null?void 0:s.minPitch,this._maxPitch=(s==null?void 0:s.maxPitch)==null?60:s==null?void 0:s.maxPitch,this._constrainOverride=(u=s==null?void 0:s.constrainOverride)!==null&&u!==void 0?u:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=gr(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new To,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,s,u){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=gr(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new To(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!u&&t.autoCalculateNearFarZ,s&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const s=c.W(t,-180,180)*Math.PI/180;var u,p,y,b,I,A,C,R,N;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=O(),u=this._rotationMatrix,y=-this._bearingInRadians,b=(p=this._rotationMatrix)[0],I=p[1],A=p[2],C=p[3],R=Math.sin(y),N=Math.cos(y),u[0]=b*N+A*R,u[1]=I*N+C*R,u[2]=b*-R+A*N,u[3]=I*-R+C*N)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const s=c.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const s=t/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aZ(this._fovInRadians)}setFov(t){t=c.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=c.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const s=this.applyConstrain(this._center,t).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=c.aq(s),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,s){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,u){this._unmodified=!1,this._edgeInsets.interpolate(t,s,u),this.constrainInternal(),this._calcMatrices()}resize(t,s,u=!0){this._width=t,this._height=s,u&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Mt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.ao,c.ao])}getCameraQueryGeometry(t,s){if(s.length===1)return[s[0],t];{const{minX:u,minY:p,maxX:y,maxY:b}=c.aa.fromPoints(s).extend(t);return[new c.P(u,p),new c.P(y,p),new c.P(y,b),new c.P(u,b),new c.P(u,p)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:u}=this.applyConstrain(this.center,this.zoom);this.setCenter(s),this.setZoom(u),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=c.ar(new Float64Array(16));c.Q(t,t,[this._width/2,-this._height/2,1]),c.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=c.ar(new Float64Array(16)),c.Q(t,t,[1,-1,1]),c.O(t,t,[-1,-1,0]),c.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,s,u,p){const y=u!==void 0?u:this.bearing,b=p=p!==void 0?p:this.pitch,{distanceToCenter:I,clampedElevation:A}=this._distanceToCenterFromAltElevationPitch(s,this.elevation,b),{x:C,y:R}=rn(b,y),N=c.a9.fromLngLat(t,s);let F,q,Z=c.a_(1,N.y),te=0;do{if(te+=1,te>10)break;q=I/Z,F=new c.a9(N.x+C*q,N.y+R*q),Z=1/F.meterInMercatorCoordinateUnits()}while(Math.abs(I-q*Z)>1e-12);return{center:F.toLngLat(),elevation:A,zoom:c.at(this.height/2/Math.tan(this.fovInRadians/2)/q/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const s=1/this.worldSize,u=c.as(1,this.center.lat)*this.worldSize,p=c.a9.fromLngLat(this.center,this.elevation),y=p.x/s,b=p.y/s,I=p.z/s,A=this.pitch,C=this.bearing,{x:R,y:N,z:F}=rn(A,C),q=this.cameraToCenterDistance,Z=y+q*-R,te=b+q*-N,ie=I+q*F,{distanceToCenter:re,clampedElevation:ue}=this._distanceToCenterFromAltElevationPitch(ie/u,t,A),ve=re*u,le=new c.a9((Z+R*ve)*s,(te+N*ve)*s,0).toLngLat(),_e=c.as(1,le.lat),Te=c.at(this.height/2/Math.tan(this.fovInRadians/2)/re/_e/this.tileSize);this._elevation=ue,this._center=le,this.setZoom(Te)}_distanceToCenterFromAltElevationPitch(t,s,u){const p=-Math.cos(c.ap(u)),y=t-s;let b,I=s;return p*y>=0||Math.abs(p)<.1?(b=1e4,I=t+b*p):b=-y/p,{distanceToCenter:b,clampedElevation:I}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Me(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const s=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/s,t.canonical.y/s,1/s/c.a5,1/s/c.a5]}}class Qi{constructor(t,s){this.min=t,this.max=s,this.center=c.a$([],c.b0([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],u=c.b1(this.min),p=c.b1(this.max);for(let y=0;y<s.length;y++)u[y]=s[y]?this.min[y]:this.center[y],p[y]=s[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new Qi(u,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let s=!0;for(let u=0;u<t.planes.length;u++){const p=this.intersectsPlane(t.planes[u]);if(p===0)return 0;p===1&&(s=!1)}return s?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let s=t[3],u=t[3];for(let p=0;p<3;p++)t[p]>0?(s+=t[p]*this.min[p],u+=t[p]*this.max[p]):(u+=t[p]*this.min[p],s+=t[p]*this.max[p]);return s>=0?2:u<0?0:1}}class no{distanceToTile2d(t,s,u,p){const y=p.distanceX([t,s]),b=p.distanceY([t,s]);return Math.hypot(y,b)}getWrap(t,s,u){return u}getTileBoundingVolume(t,s,u,p){var y,b;let I=0,A=0;if(p!=null&&p.terrain){const R=new c.a2(t.z,s,t.z,t.x,t.y),N=p.terrain.getMinMaxElevation(R);I=(y=N.minElevation)!==null&&y!==void 0?y:Math.min(0,u),A=(b=N.maxElevation)!==null&&b!==void 0?b:Math.max(0,u)}const C=1<<t.z;return new Qi([s+t.x/C,t.y/C,I],[s+(t.x+1)/C,(t.y+1)/C,A])}allowVariableZoom(t,s){const u=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,p=c.an(78.5-u/2,0,60);return!!s.terrain||t.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class Er{constructor(t,s,u){this.points=t,this.planes=s,this.aabb=u}static fromInvProjectionMatrix(t,s=1,u=0,p,y){const b=y?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],I=Math.pow(2,u),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((F=>(function(q,Z,te,ie){const re=c.aH([],q,Z),ue=1/re[3]/te*ie;return c.b6(re,re,[ue,ue,1/re[3],ue])})(F,t,s,I)));p&&(function(F,q,Z,te){const ie=te?4:0,re=te?0:4;let ue=0;const ve=[],le=[];for(let me=0;me<4;me++){const Ae=c.b2([],F[me+re],F[me+ie]),Ve=c.b7(Ae);c.a$(Ae,Ae,1/Ve),ve.push(Ve),le.push(Ae)}for(let me=0;me<4;me++){const Ae=c.b8(F[me+ie],le[me],Z);ue=Ae!==null&&Ae>=0?Math.max(ue,Ae):Math.max(ue,ve[me])}const _e=(function(me,Ae){const Ve=c.b2([],me[Ae[0]],me[Ae[1]]),Le=c.b2([],me[Ae[2]],me[Ae[1]]),ze=[0,0,0,0];return c.b3(ze,c.b4([],Ve,Le)),ze[3]=-c.b5(ze,me[Ae[0]]),ze})(F,q),Te=(function(me,Ae){const Ve=c.b9(me),Le=c.ba([],me,1/Ve),ze=c.b2([],Ae,c.a$([],Le,c.b5(Ae,Le))),Oe=c.b9(ze);if(Oe>0){const ot=Math.sqrt(1-Le[3]*Le[3]),ct=c.a$([],Le,-Le[3]),tt=c.b0([],ct,c.a$([],ze,ot/Oe));return c.bb(Ae,tt)}return null})(Z,_e);if(Te!==null){const me=Te/c.b5(le[0],_e);ue=Math.min(ue,me)}for(let me=0;me<4;me++){const Ae=Math.min(ue,ve[me]);F[me+re]=[F[me+ie][0]+le[me][0]*Ae,F[me+ie][1]+le[me][1]*Ae,F[me+ie][2]+le[me][2]*Ae,1]}})(A,b[0],p,y);const C=b.map((F=>{const q=c.b2([],A[F[0]],A[F[1]]),Z=c.b2([],A[F[2]],A[F[1]]),te=c.b3([],c.b4([],q,Z)),ie=-c.b5(te,A[F[1]]);return te.concat(ie)})),R=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],N=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const F of A)for(let q=0;q<3;q++)R[q]=Math.min(R[q],F[q]),N[q]=Math.max(N[q],F[q]);return new Er(A,C,new Qi(R,N))}}class js{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,u){return this._helper.interpolatePadding(t,s,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,u=!0){this._helper.resize(t,s,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,s){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(s,u)=>{u=c.an(+u,this.minZoom,this.maxZoom);const p={center:new c.V(s.lng,s.lat),zoom:u};let y=this._helper._lngRange;if(!this._helper._renderWorldCopies&&y===null){const le=179.9999999999;y=[-le,le]}const b=this.tileSize*c.aq(p.zoom);let I=0,A=b,C=0,R=b,N=0,F=0;const{x:q,y:Z}=this.size;if(this._helper._latRange){const le=this._helper._latRange;I=c.X(le[1])*b,A=c.X(le[0])*b,A-I<Z&&(N=Z/(A-I))}y&&(C=c.W(c.Y(y[0])*b,0,b),R=c.W(c.Y(y[1])*b,0,b),R<C&&(R+=b),R-C<q&&(F=q/(R-C)));const{x:te,y:ie}=ft(b,s);let re,ue;const ve=Math.max(F||0,N||0);if(ve){const le=new c.P(F?(R+C)/2:te,N?(A+I)/2:ie);return p.center=It(b,le).wrap(),p.zoom+=c.at(ve),p}if(this._helper._latRange){const le=Z/2;ie-le<I&&(ue=I+le),ie+le>A&&(ue=A-le)}if(y){const le=(C+R)/2;let _e=te;this._helper._renderWorldCopies&&(_e=c.W(te,le-b/2,le+b/2));const Te=q/2;_e-Te<C&&(re=C+Te),_e+Te>R&&(re=R-Te)}if(re!==void 0||ue!==void 0){const le=new c.P(re??te,ue??ie);p.center=It(b,le).wrap()}return p},this.applyConstrain=(s,u)=>this._helper.applyConstrain(s,u),this._helper=new Us({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,u)=>this.defaultConstrain(s,u)},t),this._coveringTilesDetailsProvider=new no}clone(){const t=new js;return t.apply(this),t}apply(t,s,u){this._helper.apply(t,s,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const s=[new c.bc(0,t)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new c.P(0,0)),p=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),b=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),I=Math.floor(Math.min(u.x,p.x,y.x,b.x)),A=Math.floor(Math.max(u.x,p.x,y.x,b.x)),C=1;for(let R=I-C;R<=A+C;R++)R!==0&&s.push(new c.bc(R,t))}return s}getCameraFrustum(){return Er.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const s=this.screenPointToLocation(this.centerPoint,t),u=t?t.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(t,s){const u=c.as(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(s,u),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),b=c.a9.fromLngLat(t),I=new c.a9(b.x-(p.x-y.x),b.y-(p.y-y.y));this.setCenter(I==null?void 0:I.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,s){return s?this.coordinatePoint(c.a9.fromLngLat(t),s.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(c.a9.fromLngLat(t))}screenPointToLocation(t,s){var u;return(u=this.screenPointToMercatorCoordinate(t,s))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(t,s){if(s){const u=s.pointCoordinate(t);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,s){const u=s||0,p=[t.x,t.y,0,1],y=[t.x,t.y,1,1];c.aH(p,p,this._pixelMatrixInverse),c.aH(y,y,this._pixelMatrixInverse);const b=p[3],I=y[3],A=p[1]/b,C=y[1]/I,R=p[2]/b,N=y[2]/I,F=R===N?0:(u-R)/(N-R);return new c.a9(c.G.number(p[0]/b,y[0]/I,F)/this.worldSize,c.G.number(A,C,F)/this.worldSize,u)}coordinatePoint(t,s=0,u=this._pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,s,1];return c.aH(p,p,u),new c.P(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this._helper._height/2-kt(this));return new Mt().extend(this.screenPointToLocation(new c.P(0,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(t,s){return s?s.pointCoordinate(t)!=null:t.y>this.height/2-kt(this)}calculatePosMatrix(t,s=!1,u){var p;const y=(p=t.key)!==null&&p!==void 0?p:c.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),b=s?this._alignedPosMatrixCache:this._posMatrixCache;if(b.has(y)){const C=b.get(y);return u?C.f32:C.f64}const I=Ft(t,this.worldSize);c.S(I,s?this._alignedProjMatrix:this._viewProjMatrix,I);const A={f64:I,f32:new Float32Array(I)};return b.set(y,A),u?A.f32:A.f64}calculateFogMatrix(t){const s=t.key,u=this._fogMatrixCacheF32;if(u.has(s))return u.get(s);const p=Ft(t,this.worldSize);return c.S(p,this._fogMatrix,p),u.set(s,new Float32Array(p)),u.get(s)}calculateCenterFromCameraLngLatAlt(t,s,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,u,p)}_calculateNearFarZIfNeeded(t,s,u){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=t-p*this._helper._pixelPerMeter/Math.cos(s),b=p<0?y:t,I=Math.PI/2+this.pitchInRadians,A=c.ap(this.fov)*(Math.abs(Math.cos(c.ap(this.roll)))*this.height+Math.abs(Math.sin(c.ap(this.roll)))*this.width)/this.height*(.5+u.y/this.height),C=Math.sin(A)*b/Math.sin(c.an(Math.PI-I-A,.01,Math.PI-.01)),R=kt(this),N=Math.atan(R/this._helper.cameraToCenterDistance),F=c.ap(.75),q=N>F?2*N*(.5+u.y/(2*R)):F,Z=Math.sin(q)*b/Math.sin(c.an(Math.PI-I-q,.01,Math.PI-.01)),te=Math.min(C,Z);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*te+b),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,s=ft(this.worldSize,this.center),u=s.x,p=s.y;this._helper._pixelPerMeter=c.as(1,this.center.lat)*this.worldSize;const y=c.ap(Math.min(this.pitch,it)),b=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let I;this._calculateNearFarZIfNeeded(b,y,t),I=new Float64Array(16),c.be(I,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aB(this._invProjMatrix,I),I[8]=2*-t.x/this._helper._width,I[9]=2*t.y/this._helper._height,this._projectionMatrix=c.bf(I),c.Q(I,I,[1,-1,1]),c.O(I,I,[0,0,-this._helper.cameraToCenterDistance]),c.bg(I,I,-this.rollInRadians),c.bh(I,I,this.pitchInRadians),c.bg(I,I,-this.bearingInRadians),c.O(I,I,[-u,-p,0]),this._mercatorMatrix=c.Q([],I,[this.worldSize,this.worldSize,this.worldSize]),c.Q(I,I,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,I),c.O(I,I,[0,0,-this.elevation]),this._viewProjMatrix=I,this._invViewProjMatrix=c.aB([],I);const A=[0,0,-1,1];c.aH(A,A,this._invViewProjMatrix),this._cameraPosition=[A[0]/A[3],A[1]/A[3],A[2]/A[3]],this._fogMatrix=new Float64Array(16),c.be(this._fogMatrix,this.fovInRadians,this.width/this.height,b,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,c.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.O(this._fogMatrix,this._fogMatrix,[-u,-p,0]),c.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,I);const C=this._helper._width%2/2,R=this._helper._height%2/2,N=Math.cos(this.bearingInRadians),F=Math.sin(-this.bearingInRadians),q=u-Math.round(u)+N*C+F*R,Z=p-Math.round(p)+N*R+F*C,te=new Float64Array(I);if(c.O(te,te,[q>.5?q-1:q,Z>.5?Z-1:Z,0]),this._alignedProjMatrix=te,I=c.aB(new Float64Array(16),this._pixelMatrix),!I)throw new Error("failed to invert matrix");this._pixelMatrixInverse=I,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new c.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return c.aH(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=c.as(1,this.center.lat)*this.worldSize;return Me(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,s){const u=c.a9.fromLngLat(t),p=[u.x*this.worldSize,u.y*this.worldSize,s,1];return c.aH(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(t){const{overscaledTileID:s,aligned:u,applyTerrainMatrix:p}=t,y=this._helper.getMercatorTileCoordinates(s),b=s?this.calculatePosMatrix(s,u,!0):null;let I;return I=s&&s.terrainRttPosMatrix32f&&p?s.terrainRttPosMatrix32f:b||c.bi(),{mainMatrix:I,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:I}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,s,u){return 1}transformLightDirection(t){return c.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,s,u,p){const y=this.calculatePosMatrix(u);let b;p?(b=[t,s,p(t,s),1],c.aH(b,b,y)):(b=[t,s,0,1],Mr(b,b,y));const I=b[3];return{point:new c.P(b[0]/I,b[1]/I),signedDistanceFromCamera:I,isOccluded:!1}}populateCache(t){for(const s of t)this.calculatePosMatrix(s)}getMatrixForModel(t,s){const u=c.a9.fromLngLat(t,s),p=u.meterInMercatorCoordinateUnits(),y=c.bj();return c.O(y,y,[u.x,u.y,u.z]),c.bg(y,y,Math.PI),c.bh(y,y,Math.PI/2),c.Q(y,y,[-p,p,p]),y}getProjectionDataForCustomLayer(t=!0){const s=new c.a2(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:t}),p=Ft(s,this.worldSize);c.S(p,this._viewProjMatrix,p),u.tileMercatorCoords=[0,0,1,1];const y=[c.a5,c.a5,this.worldSize/this._helper.pixelsPerMeter],b=c.bk();return c.Q(b,p,y),u.fallbackMatrix=b,u.mainMatrix=b,u}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Is(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Eo(_){if(_.useSlerp)if(_.k<1){const t=c.bl(_.startEulerAngles.roll,_.startEulerAngles.pitch,_.startEulerAngles.bearing),s=c.bl(_.endEulerAngles.roll,_.endEulerAngles.pitch,_.endEulerAngles.bearing),u=new Float64Array(4);c.bm(u,t,s,_.k);const p=c.bn(u);_.tr.setRoll(p.roll),_.tr.setPitch(p.pitch),_.tr.setBearing(p.bearing)}else _.tr.setRoll(_.endEulerAngles.roll),_.tr.setPitch(_.endEulerAngles.pitch),_.tr.setBearing(_.endEulerAngles.bearing);else _.tr.setRoll(c.G.number(_.startEulerAngles.roll,_.endEulerAngles.roll,_.k)),_.tr.setPitch(c.G.number(_.startEulerAngles.pitch,_.endEulerAngles.pitch,_.k)),_.tr.setBearing(c.G.number(_.startEulerAngles.bearing,_.endEulerAngles.bearing,_.k))}function ka(_,t,s,u,p){const y=p.padding,b=ft(p.worldSize,s.getNorthWest()),I=ft(p.worldSize,s.getNorthEast()),A=ft(p.worldSize,s.getSouthEast()),C=ft(p.worldSize,s.getSouthWest()),R=c.ap(-u),N=b.rotate(R),F=I.rotate(R),q=A.rotate(R),Z=C.rotate(R),te=new c.P(Math.max(N.x,F.x,Z.x,q.x),Math.max(N.y,F.y,Z.y,q.y)),ie=new c.P(Math.min(N.x,F.x,Z.x,q.x),Math.min(N.y,F.y,Z.y,q.y)),re=te.sub(ie),ue=(p.width-(y.left+y.right+t.left+t.right))/re.x,ve=(p.height-(y.top+y.bottom+t.top+t.bottom))/re.y;if(ve<0||ue<0)return void Is();const le=Math.min(c.at(p.scale*Math.min(ue,ve)),_.maxZoom),_e=c.P.convert(_.offset),Te=new c.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(c.ap(u)),me=_e.add(Te).mult(p.scale/c.aq(le));return{center:It(p.worldSize,b.add(A).div(2).sub(me)),zoom:le,bearing:u}}class Ss{get useGlobeControls(){return!1}handlePanInertia(t,s){const u=t.mag(),p=Math.abs(kt(s));return{easingOffset:t.mult(Math.min(.75*p/u,1)),easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(t,s){t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta),t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta)}handleMapControlsPan(t,s,u){t.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(u,t.around)}cameraForBoxAndBearing(t,s,u,p,y){return ka(t,s,u,p,y)}handleJumpToCenterZoom(t,s){t.zoom!==(s.zoom!==void 0?+s.zoom:t.zoom)&&t.setZoom(+s.zoom),s.center!==void 0&&t.setCenter(c.V.convert(s.center))}handleEaseTo(t,s){const u=t.zoom,p=t.padding,y={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},I=s.zoom!==void 0,A=!t.isPaddingEqual(s.padding);let C=!1;const R=I?+s.zoom:t.zoom;let N=t.centerPoint.add(s.offsetAsPoint);const F=t.screenPointToLocation(N),{center:q,zoom:Z}=t.applyConstrain(c.V.convert(s.center||F),R??u);Bs(t,q);const te=ft(t.worldSize,F),ie=ft(t.worldSize,q).sub(te),re=c.aq(Z-u);return C=Z!==u,{easeFunc:ue=>{if(C&&t.setZoom(c.G.number(u,Z,ue)),c.bo(y,b)||Eo({startEulerAngles:y,endEulerAngles:b,tr:t,k:ue,useSlerp:y.roll!=b.roll}),A&&(t.interpolatePadding(p,s.padding,ue),N=t.centerPoint.add(s.offsetAsPoint)),s.around)t.setLocationAtPoint(s.around,s.aroundPoint);else{const ve=c.aq(t.zoom-u),le=Z>u?Math.min(2,re):Math.max(.5,re),_e=Math.pow(le,1-ue),Te=It(t.worldSize,te.add(ie.mult(ue*_e)).mult(ve));t.setLocationAtPoint(t.renderWorldCopies?Te.wrap():Te,N)}},isZooming:C,elevationCenter:q}}handleFlyTo(t,s){const u=s.zoom!==void 0,p=t.zoom,y=t.applyConstrain(c.V.convert(s.center||s.locationAtOffset),u?+s.zoom:p),b=y.center,I=y.zoom;Bs(t,b);const A=ft(t.worldSize,s.locationAtOffset),C=ft(t.worldSize,b).sub(A),R=C.mag(),N=c.aq(I-p);let F;if(s.minZoom!==void 0){const q=Math.min(+s.minZoom,p,I),Z=t.applyConstrain(b,q).zoom;F=c.aq(Z-p)}return{easeFunc:(q,Z,te,ie)=>{t.setZoom(q===1?I:p+c.at(Z));const re=q===1?b:It(t.worldSize,A.add(C.mult(te)).mult(Z));t.setLocationAtPoint(t.renderWorldCopies?re.wrap():re,ie)},scaleOfZoom:N,targetCenter:b,scaleOfMinZoom:F,pixelPathLength:R}}}class Gn{constructor(t,s,u){this.blendFunction=t,this.blendColor=s,this.mask=u}}Gn.Replace=[1,0],Gn.disabled=new Gn(Gn.Replace,c.bp.transparent,[!1,!1,!1,!1]),Gn.unblended=new Gn(Gn.Replace,c.bp.transparent,[!0,!0,!0,!0]),Gn.alphaBlended=new Gn([1,771],c.bp.transparent,[!0,!0,!0,!0]);const ro=2305;class bn{constructor(t,s,u){this.enable=t,this.mode=s,this.frontFace=u}}bn.disabled=new bn(!1,1029,ro),bn.backCCW=new bn(!0,1029,ro),bn.frontCCW=new bn(!0,1028,ro);class an{constructor(t,s,u){this.func=t,this.mask=s,this.range=u}}an.ReadOnly=!1,an.ReadWrite=!0,an.disabled=new an(519,an.ReadOnly,[0,1]);const io=7680;class wn{constructor(t,s,u,p,y,b){this.test=t,this.ref=s,this.mask=u,this.fail=p,this.depthFail=y,this.pass=b}}wn.disabled=new wn({func:519,mask:0},0,0,io,io,io);const Io=new WeakMap;function Si(_){var t;if(Io.has(_))return Io.get(_);{const s=(t=_.getParameter(_.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Io.set(_,s),s}}class $s{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const s=t.context,u=s.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const p=new c.aW;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const y=new c.aY;y.emplaceBack(0,1,2),this._fullscreenTriangle=new Nn(s.createVertexBuffer(p,Ni.members),s.createIndexBuffer(y),c.aX.simpleSegment(0,0,p.length,y.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(u.TEXTURE1);const b=u.createTexture();u.bindTexture(u.TEXTURE_2D,b),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(b),Si(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,s){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,s=t.gl;t.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,s){const u=this._cachedRenderContext.context,p=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:c.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,p.TRIANGLES,an.disabled,wn.disabled,Gn.unblended,bn.disabled,((y,b)=>({u_input:y,u_output_expected:b}))(t,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Si(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const y=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Si(t)){const s=t.clientWaitSync(this._readbackQueue.sync,0,0);if(s===t.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=$s._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let s=0;return s+=t[0]/256,s+=t[1]/65536,s+=t[2]/16777216,t[3]<127&&(s=-s),s/128}}const ms=c.a5/128;function bl(_,t){const s=_.granularity!==void 0?Math.max(_.granularity,1):1,u=s+(_.generateBorders?2:0),p=s+(_.extendToNorthPole||_.generateBorders?1:0)+(_.extendToSouthPole||_.generateBorders?1:0),y=u+1,b=p+1,I=_.generateBorders?-1:0,A=_.generateBorders||_.extendToNorthPole?-1:0,C=s+(_.generateBorders?1:0),R=s+(_.generateBorders||_.extendToSouthPole?1:0),N=y*b,F=u*p*6,q=y*b>65536;if(q&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Z=q||t==="32bit",te=new Int16Array(2*N);let ie=0;for(let ve=A;ve<=R;ve++)for(let le=I;le<=C;le++){let _e=le/s*c.a5;le===-1&&(_e=-ms),le===s+1&&(_e=c.a5+ms);let Te=ve/s*c.a5;ve===-1&&(Te=_.extendToNorthPole?c.br:-ms),ve===s+1&&(Te=_.extendToSouthPole?c.bs:c.a5+ms),te[ie++]=_e,te[ie++]=Te}const re=Z?new Uint32Array(F):new Uint16Array(F);let ue=0;for(let ve=0;ve<p;ve++)for(let le=0;le<u;le++){const _e=le+1+ve*y,Te=le+(ve+1)*y,me=le+1+(ve+1)*y;re[ue++]=le+ve*y,re[ue++]=Te,re[ue++]=_e,re[ue++]=_e,re[ue++]=Te,re[ue++]=me}return{vertices:te.buffer.slice(0),indices:re.buffer.slice(0),uses32bitIndices:Z}}const qs=new c.aV({fill:new c.bt(128,2),line:new c.bt(512,0),tile:new c.bt(128,32),stencil:new c.bt(128,1),circle:3});class Ra{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return er.projectionGlobe}get vertexShaderPreludeCode(){return er.projectionMercator.vertexSource}get subdivisionGranularity(){return qs}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new $s(t));const s=c.X(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(s,u),y=Ce();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=y);const b=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bv(b))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,s,u,p,y){const b=(y==="stencil"?qs.stencil:qs.tile).getGranularityForZoomLevel(s.z);return this._getMesh(t,{granularity:b,generateBorders:u,extendToNorthPole:s.y===0&&p,extendToSouthPole:s.y===(1<<s.z)-1&&p})}_getMesh(t,s){const u=this._getMeshKey(s);if(u in this._tileMeshCache)return this._tileMeshCache[u];const p=(function(y,b){const I=bl(b,"16bit"),A=c.aW.deserialize({arrayBuffer:I.vertices,length:I.vertices.byteLength/2/2}),C=c.aY.deserialize({arrayBuffer:I.indices,length:I.indices.byteLength/2/3});return new Nn(y.createVertexBuffer(A,Ni.members),y.createIndexBuffer(C),c.aX.simpleSegment(0,0,A.length,C.length))})(t,s);return this._tileMeshCache[u]=p,p}recalculate(t){}hasTransition(){const t=Ce();let s=!1;return s=s||(t-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Ec=new c.t({type:new c.D(c.u.projection.type)});class Gs extends c.E{constructor(t){super(),this._transitionable=new c.x(Ec,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0)),this._mercatorProjection=new Dn,this._verticalPerspectiveProjection=new Ra}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof c.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,s,u,p,y){return this.currentProjection.getMeshFromTileID(t,s,u,p,y)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Jr(_){const t=Hs(_.worldSize,_.center.lat);return 2*Math.PI*t}function Ji(_,t,s,u,p){const y=1/(1<<p),b=t/c.a5*y+u*y,I=c.by((_/c.a5*y+s*y)*Math.PI*2+Math.PI,2*Math.PI),A=2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI,C=Math.cos(A),R=new Float64Array(3);return R[0]=Math.sin(I)*C,R[1]=Math.sin(A),R[2]=Math.cos(I)*C,R}function rr(_){return(function(t,s){const u=Math.cos(s),p=new Float64Array(3);return p[0]=Math.sin(t)*u,p[1]=Math.sin(s),p[2]=Math.cos(t)*u,p})(_.lng*Math.PI/180,_.lat*Math.PI/180)}function Hs(_,t){return _/(2*Math.PI)/Math.cos(t*Math.PI/180)}function So(_){const t=Math.asin(_[1])/Math.PI*180,s=Math.sqrt(_[0]*_[0]+_[2]*_[2]);if(s>1e-6){const u=_[0]/s,p=Math.acos(_[2]/s),y=(u>0?p:-p)/Math.PI*180;return new c.V(c.W(y,-180,180),t)}return new c.V(0,t)}function Gr(_){return Math.cos(_*Math.PI/180)}function hr(_,t){const s=Gr(_),u=Gr(t);return c.at(u/s)}function wl(_,t){const s=_.rotate(t.bearingInRadians),u=t.zoom+hr(t.center.lat,0),p=c.bu(1/Gr(t.center.lat),1/Gr(Math.min(Math.abs(t.center.lat),60)),c.bx(u,7,3,0,1)),y=360/Jr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new c.V(t.center.lng-s.x*y*p,c.an(t.center.lat+s.y*y,-c.ao,c.ao))}function Ws(_){const t=.5*_,s=Math.sin(t),u=Math.cos(t);return Math.log(s+u)-Math.log(u-s)}function E(_,t,s,u){const p=_.lat+s*u;if(Math.abs(s)>1){const y=(Math.sign(_.lat+s)!==Math.sign(_.lat)?-Math.abs(_.lat):Math.abs(_.lat))*Math.PI/180,b=Math.abs(_.lat+s)*Math.PI/180,I=Ws(y+u*(b-y)),A=Ws(y),C=Ws(b);return new c.V(_.lng+t*((I-A)/(C-A)),p)}return new c.V(_.lng+t*u,p)}class L{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,s,u,p){const y=`${t.z}_${t.x}_${t.y}_${p!=null&&p.terrain?"t":""}`,b=this._cache.get(y);if(b)return b;const I=this._cachePrevious.get(y);if(I)return this._cache.set(y,I),I;const A=this._boundingVolumeFactory(t,s,u,p);return this._cache.set(y,A),this._hadAnyChanges=!0,A}}class ${constructor(t,s,u,p){this.min=u,this.max=p,this.points=t,this.planes=s}static fromAabb(t,s){const u=[];for(let p=0;p<8;p++)u.push([1&~p?t[0]:s[0],(p>>1&1)==1?s[1]:t[1],(p>>2&1)==1?s[2]:t[2]]);return new $(u,[[-1,0,0,s[0]],[1,0,0,-t[0]],[0,-1,0,s[1]],[0,1,0,-t[1]],[0,0,-1,s[2]],[0,0,1,-t[2]]],t,s)}static fromCenterSizeAngles(t,s,u){const p=c.bB([],u[0],u[1],u[2]),y=c.bC([],[s[0],0,0],p),b=c.bC([],[0,s[1],0],p),I=c.bC([],[0,0,s[2]],p),A=[...t],C=[...t];for(let N=0;N<8;N++)for(let F=0;F<3;F++){const q=t[F]+y[F]*(1&~N?-1:1)+b[F]*((N>>1&1)==1?1:-1)+I[F]*((N>>2&1)==1?1:-1);A[F]=Math.min(A[F],q),C[F]=Math.max(C[F],q)}const R=[];for(let N=0;N<8;N++){const F=[...t];c.b0(F,F,c.a$([],y,1&~N?-1:1)),c.b0(F,F,c.a$([],b,(N>>1&1)==1?1:-1)),c.b0(F,F,c.a$([],I,(N>>2&1)==1?1:-1)),R.push(F)}return new $(R,[[...y,-c.b5(y,R[0])],[...b,-c.b5(b,R[0])],[...I,-c.b5(I,R[0])],[-y[0],-y[1],-y[2],-c.b5(y,R[7])],[-b[0],-b[1],-b[2],-c.b5(b,R[7])],[-I[0],-I[1],-I[2],-c.b5(I,R[7])]],A,C)}intersectsFrustum(t){let s=!0;const u=this.points.length,p=this.planes.length,y=t.planes.length,b=t.points.length;for(let I=0;I<y;I++){const A=t.planes[I];let C=0;for(let R=0;R<u;R++){const N=this.points[R];A[0]*N[0]+A[1]*N[1]+A[2]*N[2]+A[3]>=0&&C++}if(C===0)return 0;C<u&&(s=!1)}if(s)return 2;for(let I=0;I<p;I++){const A=this.planes[I];let C=0;for(let R=0;R<b;R++){const N=t.points[R];A[0]*N[0]+A[1]*N[1]+A[2]*N[2]+A[3]>=0&&C++}if(C===0)return 0}return 1}intersectsPlane(t){const s=this.points.length;let u=0;for(let p=0;p<s;p++){const y=this.points[p];t[0]*y[0]+t[1]*y[1]+t[2]*y[2]+t[3]>=0&&u++}return u===s?2:u===0?0:1}}function ne(_,t,s){const u=_-t;return u<0?-u:Math.max(0,u-s)}function De(_,t,s,u,p){const y=_-s;let b;return b=y<0?Math.min(-y,1+y-p):y>1?Math.min(Math.max(y-p,0),1-y):0,Math.max(b,ne(t,u,p))}class Ze{constructor(){this._boundingVolumeCache=new L(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,s,u,p){const y=1<<u.z,b=1/y,I=u.x/y,A=u.y/y;let C=2;return C=Math.min(C,De(t,s,I,A,b)),C=Math.min(C,De(t,s,I+.5,-A-b,b)),C=Math.min(C,De(t,s,I+.5,2-A-b,b)),C}getWrap(t,s,u){const p=1<<s.z,y=1/p,b=s.x/p,I=ne(t.x,b,y),A=ne(t.x,b-1,y),C=ne(t.x,b+1,y),R=Math.min(I,A,C);return R===C?1:R===A?-1:0}allowVariableZoom(t,s){return je(t,s)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,s,u,p){return this._boundingVolumeCache.getTileBoundingVolume(t,s,u,p)}_computeTileBoundingVolume(t,s,u,p){var y,b;let I=0,A=0;if(p!=null&&p.terrain){const C=new c.a2(t.z,s,t.z,t.x,t.y),R=p.terrain.getMinMaxElevation(C);I=(y=R.minElevation)!==null&&y!==void 0?y:Math.min(0,u),A=(b=R.maxElevation)!==null&&b!==void 0?b:Math.max(0,u)}if(I/=c.bE,A/=c.bE,I+=1,A+=1,t.z<=0)return $.fromAabb([-A,-A,-A],[A,A,A]);if(t.z===1)return $.fromAabb([t.x===0?-A:0,t.y===0?0:-A,-A],[t.x===0?0:A,t.y===0?A:0,A]);{const C=[Ji(0,0,t.x,t.y,t.z),Ji(c.a5,0,t.x,t.y,t.z),Ji(c.a5,c.a5,t.x,t.y,t.z),Ji(0,c.a5,t.x,t.y,t.z)],R=[];for(const ze of C)R.push(c.a$([],ze,A));if(A!==I)for(const ze of C)R.push(c.a$([],ze,I));t.y===0&&R.push([0,1,0]),t.y===(1<<t.z)-1&&R.push([0,-1,0]);const N=[1,1,1],F=[-1,-1,-1];for(const ze of R)for(let Oe=0;Oe<3;Oe++)N[Oe]=Math.min(N[Oe],ze[Oe]),F[Oe]=Math.max(F[Oe],ze[Oe]);const q=Ji(c.a5/2,c.a5/2,t.x,t.y,t.z),Z=c.b4([],[0,1,0],q);c.b3(Z,Z);const te=c.b4([],q,Z);c.b3(te,te);const ie=c.b4([],C[2],C[1]);c.b3(ie,ie);const re=c.b4([],C[0],C[3]);c.b3(re,re),R.push(c.a$([],q,A)),t.y>=(1<<t.z)/2&&R.push(c.a$([],Ji(c.a5/2,0,t.x,t.y,t.z),A)),t.y<(1<<t.z)/2&&R.push(c.a$([],Ji(c.a5/2,c.a5,t.x,t.y,t.z),A));const ue=_t(q,R),ve=_t(te,R),le=[-q[0],-q[1],-q[2],ue.max],_e=[q[0],q[1],q[2],-ue.min],Te=[-te[0],-te[1],-te[2],ve.max],me=[te[0],te[1],te[2],-ve.min],Ae=[...ie,0],Ve=[...re,0],Le=[];return t.y===0?Le.push(c.bD(Ve,Ae,le),c.bD(Ve,Ae,_e)):Le.push(c.bD(Te,Ae,le),c.bD(Te,Ae,_e),c.bD(Te,Ve,le),c.bD(Te,Ve,_e)),t.y===(1<<t.z)-1?Le.push(c.bD(Ve,Ae,le),c.bD(Ve,Ae,_e)):Le.push(c.bD(me,Ae,le),c.bD(me,Ae,_e),c.bD(me,Ve,le),c.bD(me,Ve,_e)),new $(Le,[le,_e,Te,me,Ae,Ve],N,F)}}}function _t(_,t){let s=1/0,u=-1/0;for(const p of t){const y=c.b5(_,p);s=Math.min(s,y),u=Math.max(u,y)}return{min:s,max:u}}class ln{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,u){return this._helper.interpolatePadding(t,s,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s){this._helper.resize(t,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=c.bF(),this._projectionMatrix=c.bj(),this._globeViewProjMatrix32f=c.bi(),this._globeViewProjMatrixNoCorrection=c.bj(),this._globeViewProjMatrixNoCorrectionInverted=c.bj(),this._globeProjMatrixInverted=c.bj(),this._cameraPosition=c.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(s,u)=>{const p=c.an(s.lat,-c.ao,c.ao),y=c.an(+u,this.minZoom+hr(0,p),this.maxZoom);return{center:new c.V(s.lng,p),zoom:y}},this.applyConstrain=(s,u)=>this._helper.applyConstrain(s,u),this._helper=new Us({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,u)=>this.defaultConstrain(s,u)},t),this._coveringTilesDetailsProvider=new Ze}clone(){const t=new ln;return t.apply(this),t}apply(t,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=c.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:s,applyGlobeMatrix:u}=t,p=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const s=this.pitchInRadians,u=this.cameraToCenterDistance/t,p=Math.sin(s)*u,y=Math.cos(s)*u+1,b=1/Math.sqrt(p*p+y*y)*1;let I=-p,A=y;const C=Math.sqrt(I*I+A*A);I/=C,A/=C;const R=[0,I,A];c.bG(R,R,[0,0,0],-this.bearingInRadians),c.bH(R,R,[0,0,0],-1*this.center.lat*Math.PI/180),c.bI(R,R,[0,0,0],this.center.lng*Math.PI/180);const N=1/c.b7(R);return c.a$(R,R,N),[...R,-b*N]}isLocationOccluded(t){return!this.isSurfacePointVisible(rr(t))}transformLightDirection(t){const s=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,p=Math.cos(u),y=[Math.sin(s)*p,Math.sin(u),Math.cos(s)*p],b=[y[2],0,-y[0]],I=[0,0,0];c.b4(I,b,y),c.b3(b,b),c.b3(I,I);const A=[0,0,0];return c.b3(A,[b[0]*t[0]+I[0]*t[1]+y[0]*t[2],b[1]*t[0]+I[1]*t[1]+y[1]*t[2],b[2]*t[0]+I[2]*t[1]+y[2]*t[2]]),A}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,s,u){const p=(function(I,A,C){const R=1/(1<<C.z);return new c.a9(I/c.a5*R+C.x*R,A/c.a5*R+C.y*R)})(t,s,u.canonical),y=(b=p.y,[c.by(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-b*Math.PI*2))-.5*Math.PI]);var b;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(t,s,u,p){const y=u.canonical,b=Ji(t,s,y.x,y.y,y.z),I=1+(p?p(t,s):0)/c.bE,A=[b[0]*I,b[1]*I,b[2]*I,1];c.aH(A,A,this._globeViewProjMatrixNoCorrection);const C=this._cachedClippingPlane,R=C[0]*b[0]+C[1]*b[1]+C[2]*b[2]+C[3]<0;return{point:new c.P(A[0]/A[3],A[1]/A[3]),signedDistanceFromCamera:A[3],isOccluded:R}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Hs(this.worldSize,this.center.lat),s=c.bk(),u=c.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),c.be(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;s[8]=2*-p.x/this._helper._width,s[9]=2*p.y/this._helper._height,this._projectionMatrix=c.bf(s),this._globeProjMatrixInverted=c.bk(),c.aB(this._globeProjMatrixInverted,s),c.O(s,s,[0,0,-this.cameraToCenterDistance]),c.bg(s,s,this.rollInRadians),c.bh(s,s,-this.pitchInRadians),c.bg(s,s,this.bearingInRadians),c.O(s,s,[0,0,-t]);const y=c.bz();y[0]=t,y[1]=t,y[2]=t,c.bh(u,s,this.center.lat*Math.PI/180),c.bJ(u,u,-this.center.lng*Math.PI/180),c.Q(u,u,y),this._globeViewProjMatrixNoCorrection=u,c.bh(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bJ(s,s,-this.center.lng*Math.PI/180),c.Q(s,s,y),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=c.bk(),c.aB(this._globeViewProjMatrixNoCorrectionInverted,u);const b=c.bz();this._cameraPosition=c.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,c.bG(this._cameraPosition,this._cameraPosition,b,-this.rollInRadians),c.bH(this._cameraPosition,this._cameraPosition,b,this.pitchInRadians),c.bG(this._cameraPosition,this._cameraPosition,b,-this.bearingInRadians),c.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bH(this._cameraPosition,this._cameraPosition,b,-this.center.lat*Math.PI/180),c.bI(this._cameraPosition,this._cameraPosition,b,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const I=c.bf(this._globeViewProjMatrixNoCorrectionInverted);c.Q(I,I,[1,1,-1]),this._cachedFrustum=Er.fromInvProjectionMatrix(I,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){c.w("calculateFogMatrix is not supported on globe projection.");const s=c.bk();return c.ar(s),s}getVisibleUnwrappedCoordinates(t){return[new c.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=rr(t);c.a$(u,u,1+s/c.bE);const p=c.bF();return c.aH(p,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(t){}getBounds(){const t=.5*this.width,s=.5*this.height,u=[new c.P(0,0),new c.P(t,0),new c.P(this.width,0),new c.P(this.width,s),new c.P(this.width,this.height),new c.P(t,this.height),new c.P(0,this.height),new c.P(0,s)],p=[];for(const N of u)p.push(this.unprojectScreenPoint(N));let y=0,b=0,I=0,A=0;const C=this.center;for(const N of p){const F=c.bK(C.lng,N.lng),q=c.bK(C.lat,N.lat);F<b&&(b=F),F>y&&(y=F),q<A&&(A=q),q>I&&(I=q)}const R=[C.lng+b,C.lat+A,C.lng+y,C.lat+I];return this.isSurfacePointOnScreen([0,1,0])&&(R[3]=90,R[0]=-180,R[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(R[1]=-90,R[0]=-180,R[2]=180),new Mt(R)}calculateCenterFromCameraLngLatAlt(t,s,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,u,p)}setLocationAtPoint(t,s){const u=rr(this.unprojectScreenPoint(s)),p=rr(t),y=c.bz();c.bL(y);const b=c.bz();c.bI(b,u,y,-this.center.lng*Math.PI/180),c.bH(b,b,y,this.center.lat*Math.PI/180);const I=p[0]*p[0]+p[2]*p[2],A=b[0]*b[0];if(I<A)return;const C=Math.sqrt(I-A),R=-C,N=c.bM(p[0],p[2],b[0],C),F=c.bM(p[0],p[2],b[0],R),q=c.bz();c.bI(q,p,y,-N);const Z=c.bM(q[1],q[2],b[1],b[2]),te=c.bz();c.bI(te,p,y,-F);const ie=c.bM(te[1],te[2],b[1],b[2]),re=.5*Math.PI,ue=Z>=-re&&Z<=re,ve=ie>=-re&&ie<=re;let le,_e;if(ue&&ve){const Ve=this.center.lng*Math.PI/180,Le=this.center.lat*Math.PI/180;c.bN(N,Ve)+c.bN(Z,Le)<c.bN(F,Ve)+c.bN(ie,Le)?(le=N,_e=Z):(le=F,_e=ie)}else if(ue)le=N,_e=Z;else{if(!ve)return;le=F,_e=ie}const Te=le/Math.PI*180,me=_e/Math.PI*180,Ae=this.center.lat;this.setCenter(new c.V(Te,c.an(me,-90,90))),this.setZoom(this.zoom+hr(Ae,this.center.lat))}locationToScreenPoint(t,s){const u=rr(t);if(s){const p=s.getElevationForLngLatZoom(t,this._helper._tileZoom);c.a$(u,u,1+p/c.bE)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(t){const s=c.bF();return c.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new c.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,s){if(s){const u=s.pointCoordinate(t);if(u)return u}return c.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,s){var u;return(u=this.screenPointToMercatorCoordinate(t,s))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(t,s){const u=this._cameraPosition,p=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(u,p)}getRayDirectionFromPixel(t){const s=c.bF();s[0]=t.x/this.width*2-1,s[1]=-1*(t.y/this.height*2-1),s[2]=1,s[3]=1,c.aH(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const u=c.bz();u[0]=s[0]-this._cameraPosition[0],u[1]=s[1]-this._cameraPosition[1],u[2]=s[2]-this._cameraPosition[2];const p=c.bz();return c.b3(p,u),p}isSurfacePointVisible(t){const s=this._cachedClippingPlane;return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const s=c.bF();return c.aH(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(t,s){const u=c.b5(t,s),p=c.bz(),y=c.bz();c.a$(y,s,u),c.b2(p,t,y);const b=1-c.b5(p,p);if(b<0)return null;const I=c.b5(t,t)-1,A=-u+(u<0?1:-1)*Math.sqrt(b),C=I/A,R=A;return{tMin:Math.min(C,R),tMax:Math.max(C,R)}}unprojectScreenPoint(t){const s=this._cameraPosition,u=this.getRayDirectionFromPixel(t),p=this.rayPlanetIntersection(s,u);if(p){const R=c.bz();c.b0(R,s,[u[0]*p.tMin,u[1]*p.tMin,u[2]*p.tMin]);const N=c.bz();return c.b3(N,R),So(N)}const y=this._cachedClippingPlane,b=y[0]*u[0]+y[1]*u[1]+y[2]*u[2],I=-c.bb(y,s)/b,A=c.bz();if(I>0)c.b0(A,s,[u[0]*I,u[1]*I,u[2]*I]);else{const R=c.bz();c.b0(R,s,[2*u[0],2*u[1],2*u[2]]);const N=c.bb(this._cachedClippingPlane,R);c.b2(A,R,[this._cachedClippingPlane[0]*N,this._cachedClippingPlane[1]*N,this._cachedClippingPlane[2]*N])}const C=(function(R){const N=c.bz();return N[0]=R[0]*-R[3],N[1]=R[1]*-R[3],N[2]=R[2]*-R[3],{center:N,radius:Math.sqrt(1-R[3]*R[3])}})(y);return So((function(R,N,F){const q=c.bz();c.b2(q,F,R);const Z=c.bz();return c.bA(Z,R,q,N/c.b9(q)),Z})(C.center,C.radius,A))}getMatrixForModel(t,s){const u=c.V.convert(t),p=1/c.bE,y=c.bj();return c.bJ(y,y,u.lng/180*Math.PI),c.bh(y,y,-u.lat/180*Math.PI),c.O(y,y,[0,0,1+s/c.bE]),c.bh(y,y,.5*Math.PI),c.Q(y,y,[p,p,p]),y}getProjectionDataForCustomLayer(t=!0){const s=this.getProjectionData({overscaledTileID:new c.a2(0,0,0,0,0),applyGlobeMatrix:t});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(t){}}class dr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,u){return this._helper.interpolatePadding(t,s,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,u=!0){this._helper.resize(t,s,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,s){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(s,u)=>this.currentTransform.defaultConstrain(s,u),this.applyConstrain=(s,u)=>this._helper.applyConstrain(s,u),this._helper=new Us({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(s,u)=>this.defaultConstrain(s,u)},t),this._globeness=1,this._mercatorTransform=new js,this._verticalPerspectiveTransform=new ln}clone(){const t=new dr;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const s=this._mercatorTransform.getProjectionData(t),u=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:s.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return c.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,s,u){const p=this._mercatorTransform.getPitchedTextCorrection(t,s,u),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,s,u);return c.bu(p,y,this._globeness)}projectTileCoordinates(t,s,u,p){return this.currentTransform.projectTileCoordinates(t,s,u,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){return this.currentTransform.lngLatToCameraDepth(t,s)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,s,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,u,p)}setLocationAtPoint(t,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,s){return this.currentTransform.locationToScreenPoint(t,s)}screenPointToMercatorCoordinate(t,s){return this.currentTransform.screenPointToMercatorCoordinate(t,s)}screenPointToLocation(t,s){return this.currentTransform.screenPointToLocation(t,s)}isPointOnMapSurface(t,s){return this.currentTransform.isPointOnMapSurface(t,s)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,s){return this.currentTransform.getMatrixForModel(t,s)}getProjectionDataForCustomLayer(t=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return s;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return u.fallbackMatrix=s.mainMatrix,u}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class on{get useGlobeControls(){return!0}handlePanInertia(t,s){const u=wl(t,s);return Math.abs(u.lng-s.center.lng)>180&&(u.lng=s.center.lng+179.5*Math.sign(u.lng-s.center.lng)),{easingCenter:u,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,s){const u=t.around,p=s.screenPointToLocation(u);t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta);const y=s.zoom;t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta);const b=s.zoom-y;if(b===0)return;const I=c.bK(s.center.lng,p.lng),A=I/(Math.abs(I/180)+1),C=c.bK(s.center.lat,p.lat),R=s.getRayDirectionFromPixel(u),N=s.cameraPosition,F=-1*c.b5(N,R),q=c.bz();c.b0(q,N,[R[0]*F,R[1]*F,R[2]*F]);const Z=c.b7(q)-1,te=Math.exp(.5*-Math.max(Z-.3,0)),ie=Hs(s.worldSize,s.center.lat)/Math.min(s.width,s.height),re=c.bx(ie,.9,.5,1,.25),ue=(1-c.aq(-b))*Math.min(te,re),ve=s.center.lat,le=s.zoom,_e=new c.V(s.center.lng+A*ue,c.an(s.center.lat+C*ue,-c.ao,c.ao));s.setLocationAtPoint(p,u);const Te=s.center,me=c.bx(Math.abs(I),45,85,0,1),Ae=c.bx(ie,.75,.35,0,1),Ve=Math.pow(Math.max(me,Ae),.25),Le=c.bK(Te.lng,_e.lng),ze=c.bK(Te.lat,_e.lat);s.setCenter(new c.V(Te.lng+Le*Ve,Te.lat+ze*Ve).wrap()),s.setZoom(le+hr(ve,s.center.lat))}handleMapControlsPan(t,s,u){if(!t.panDelta)return;const p=s.center.lat,y=s.zoom;s.setCenter(wl(t.panDelta,s).wrap()),s.setZoom(y+hr(p,s.center.lat))}cameraForBoxAndBearing(t,s,u,p,y){const b=ka(t,s,u,p,y),I=s.left/y.width*2-1,A=(y.width-s.right)/y.width*2-1,C=s.top/y.height*-2+1,R=(y.height-s.bottom)/y.height*-2+1,N=c.bK(u.getWest(),u.getEast())<0,F=N?u.getEast():u.getWest(),q=N?u.getWest():u.getEast(),Z=Math.max(u.getNorth(),u.getSouth()),te=Math.min(u.getNorth(),u.getSouth()),ie=F+.5*c.bK(F,q),re=Z+.5*c.bK(Z,te),ue=y.clone();ue.setCenter(b.center),ue.setBearing(b.bearing),ue.setPitch(0),ue.setRoll(0),ue.setZoom(b.zoom);const ve=ue.modelViewProjectionMatrix,le=[rr(u.getNorthWest()),rr(u.getNorthEast()),rr(u.getSouthWest()),rr(u.getSouthEast()),rr(new c.V(q,re)),rr(new c.V(F,re)),rr(new c.V(ie,Z)),rr(new c.V(ie,te))],_e=rr(b.center);let Te=Number.POSITIVE_INFINITY;for(const me of le)I<0&&(Te=on.getLesserNonNegativeNonNull(Te,on.solveVectorScale(me,_e,ve,"x",I))),A>0&&(Te=on.getLesserNonNegativeNonNull(Te,on.solveVectorScale(me,_e,ve,"x",A))),C>0&&(Te=on.getLesserNonNegativeNonNull(Te,on.solveVectorScale(me,_e,ve,"y",C))),R<0&&(Te=on.getLesserNonNegativeNonNull(Te,on.solveVectorScale(me,_e,ve,"y",R)));if(Number.isFinite(Te)&&Te!==0)return b.zoom=ue.zoom+c.at(Te),b;Is()}handleJumpToCenterZoom(t,s){const u=t.center.lat,p=t.applyConstrain(s.center?c.V.convert(s.center):t.center,t.zoom).center;t.setCenter(p.wrap());const y=s.zoom!==void 0?+s.zoom:t.zoom+hr(u,p.lat);t.zoom!==y&&t.setZoom(y)}handleEaseTo(t,s){const u=t.zoom,p=t.center,y=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},I={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},A=s.zoom!==void 0,C=!t.isPaddingEqual(s.padding);let R=!1;const N=s.center?c.V.convert(s.center):p,F=t.applyConstrain(N,u).center;Bs(t,F);const q=t.clone();q.setCenter(F),q.setZoom(A?+s.zoom:u+hr(p.lat,N.lat)),q.setBearing(s.bearing);const Z=new c.P(c.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));q.setLocationAtPoint(F,Z);const te=(s.offset&&s.offsetAsPoint.mag())>0?q.center:F,ie=A?+s.zoom:u+hr(p.lat,te.lat),re=u+hr(p.lat,0),ue=ie+hr(te.lat,0),ve=c.bK(p.lng,te.lng),le=c.bK(p.lat,te.lat),_e=c.aq(ue-re);return R=ie!==u,{easeFunc:Te=>{if(c.bo(b,I)||Eo({startEulerAngles:b,endEulerAngles:I,tr:t,k:Te,useSlerp:b.roll!=I.roll}),C&&t.interpolatePadding(y,s.padding,Te),s.around)c.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(s.around,s.aroundPoint);else{const me=ue>re?Math.min(2,_e):Math.max(.5,_e),Ae=Math.pow(me,1-Te),Ve=E(p,ve,le,Te*Ae);t.setCenter(Ve.wrap())}if(R){const me=c.G.number(re,ue,Te)+hr(0,t.center.lat);t.setZoom(me)}},isZooming:R,elevationCenter:te}}handleFlyTo(t,s){const u=s.zoom!==void 0,p=t.center,y=t.zoom,b=t.padding,I=!t.isPaddingEqual(s.padding),A=t.applyConstrain(c.V.convert(s.center||s.locationAtOffset),y).center,C=u?+s.zoom:t.zoom+hr(t.center.lat,A.lat),R=t.clone();R.setCenter(A),R.setZoom(C),R.setBearing(s.bearing);const N=new c.P(c.an(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),c.an(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));R.setLocationAtPoint(A,N);const F=R.center;Bs(t,F);const q=(function(le,_e,Te){const me=rr(_e),Ae=rr(Te),Ve=c.b5(me,Ae),Le=Math.acos(Ve),ze=Jr(le);return Le/(2*Math.PI)*ze})(t,p,F),Z=y+hr(p.lat,0),te=C+hr(F.lat,0),ie=c.aq(te-Z);let re;if(typeof s.minZoom=="number"){const le=+s.minZoom+hr(F.lat,0),_e=Math.min(le,Z,te)+hr(0,F.lat),Te=t.applyConstrain(F,_e).zoom+hr(F.lat,0);re=c.aq(Te-Z)}const ue=c.bK(p.lng,F.lng),ve=c.bK(p.lat,F.lat);return{easeFunc:(le,_e,Te,me)=>{const Ae=E(p,ue,ve,Te);I&&t.interpolatePadding(b,s.padding,le);const Ve=le===1?F:Ae;t.setCenter(Ve.wrap());const Le=Z+c.at(_e);t.setZoom(le===1?C:Le+hr(0,Ve.lat))},scaleOfZoom:ie,targetCenter:F,scaleOfMinZoom:re,pixelPathLength:q}}static solveVectorScale(t,s,u,p,y){const b=p==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],I=[u[3],u[7],u[11],u[15]],A=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],C=t[0]*I[0]+t[1]*I[1]+t[2]*I[2],R=s[0]*b[0]+s[1]*b[1]+s[2]*b[2],N=s[0]*I[0]+s[1]*I[1]+s[2]*I[2];return R+y*C===A+y*N||I[3]*(A-R)+b[3]*(N-C)+A*N==R*C?null:(R+b[3]-y*N-y*I[3])/(R-A-y*N+y*C)}static getLesserNonNegativeNonNull(t,s){return s!==null&&s>=0&&s<t?s:t}}class Or{constructor(t){this._globe=t,this._mercatorCameraHelper=new Ss,this._verticalPerspectiveCameraHelper=new on}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,s){return this.currentHelper.handlePanInertia(t,s)}handleMapControlsRollPitchBearingZoom(t,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,s)}handleMapControlsPan(t,s,u){this.currentHelper.handleMapControlsPan(t,s,u)}cameraForBoxAndBearing(t,s,u,p,y){return this.currentHelper.cameraForBoxAndBearing(t,s,u,p,y)}handleJumpToCenterZoom(t,s){this.currentHelper.handleJumpToCenterZoom(t,s)}handleEaseTo(t,s){return this.currentHelper.handleEaseTo(t,s)}handleFlyTo(t,s){return this.currentHelper.handleFlyTo(t,s)}}const hi=(_,t)=>c.B(_,t&&t.filter((s=>s.identifier!=="source.canvas"))),es=c.bO();class xi extends c.E{constructor(t,s={}){var u,p;super(),this._rtlPluginLoaded=()=>{for(const b in this.tileManagers){const I=this.tileManagers[b].getSource().type;I!=="vector"&&I!=="geojson"||this.tileManagers[b].reload()}},this.map=t,this.dispatcher=new Zt(pn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((b,I)=>this.getGlyphs(b,I))),this.dispatcher.registerMessageHandler("GI",((b,I)=>this.getImages(b,I))),this.dispatcher.registerMessageHandler("GDA",((b,I)=>this.getDashes(b,I))),this.imageManager=new Se,this.imageManager.setEventedParent(this);const y=((u=t._container)===null||u===void 0?void 0:u.lang)||typeof document<"u"&&((p=document.documentElement)===null||p===void 0?void 0:p.lang)||void 0;this.glyphManager=new vn(t._requestManager,s.localIdeographFontFamily,y),this.lineAtlas=new Qn(256,512),this.crossTileSymbolIndex=new vi,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bP()),Ie().on(fe,this._rtlPluginLoaded),this.on("data",(b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const I=this.tileManagers[b.sourceId];if(!I)return;const A=I.getSource();if(A&&A.vectorLayerIds)for(const C in this._layers){const R=this._layers[C];R.source===A.id&&this._validateLayer(R)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,s){var u,p,y;this._checkLoaded();const b=s===null?(y=(p=(u=this.stylesheet.state)===null||u===void 0?void 0:u[t])===null||p===void 0?void 0:p.default)!==null&&y!==void 0?y:null:s;if(c.bR(b,this._globalState[t]))return this;this._globalState[t]=b,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const s=[];for(const u in t)!c.bR(this._globalState[u],t[u].default)&&(s.push(u),this._globalState[u]=t[u].default);this._applyGlobalStateChanges(s)}_applyGlobalStateChanges(t){if(t.length===0)return;const s=new Set,u={};for(const p of t){u[p]=this._globalState[p];for(const y in this._layers){const b=this._layers[y],I=b.getLayoutAffectingGlobalStateRefs(),A=b.getPaintAffectingGlobalStateRefs(),C=b.getVisibilityAffectingGlobalStateRefs();if(I.has(p)&&s.add(b.source),A.has(p))for(const{name:R,value:N}of A.get(p))this._updatePaintProperty(b,R,N);C!=null&&C.has(p)&&(b.recalculateVisibility(),this._updateLayer(b))}}this.dispatcher.broadcast("UGS",u);for(const p in this.tileManagers)s.has(p)&&(this._reloadSource(p),this._changed=!0)}loadURL(t,s={},u){this.fire(new c.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const p=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;c.j(p,this._loadStyleRequest).then((b=>{this._loadStyleRequest=null,this._load(b.data,s,u)})).catch((b=>{this._loadStyleRequest=null,b&&!y.signal.aborted&&this.fire(new c.k(b))}))}loadJSON(t,s={},u){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,xe.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,u)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(es,{validate:!1})}_load(t,s,u){var p,y;let b=s.transformStyle?s.transformStyle(u,t):t;if(!s.validate||!hi(this,c.C(b))){b=Object.assign({},b),this._loaded=!0,this.stylesheet=b;for(const I in b.sources)this.addSource(I,b.sources[I],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new In(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new Ht(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var t,s,u;const p=c.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",p),this._order=p.map((y=>y.id)),this._layers={},this._serializedLayers=null;for(const y of p){const b=c.bT(y,this._globalState);if(b.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=b,c.bU(b)&&this.tileManagers[b.source]){const I=(u=(s=y.paint)===null||s===void 0?void 0:s["raster-fade-duration"])!==null&&u!==void 0?u:b.paint.get("raster-fade-duration");this.tileManagers[b.source].setRasterFadeDuration(I)}}}_loadSprite(t,s=!1,u=void 0){this.imageManager.setLoaded(!1);const p=new AbortController;let y;this._spriteRequest=p,(function(b,I,A,C){return c._(this,void 0,void 0,(function*(){const R=ae(b),N=A>1?"@2x":"",F={},q={};for(const{id:Z,url:te}of R){const ie=I.transformRequest(Ee(te,N,".json"),"SpriteJSON");F[Z]=c.j(ie,C);const re=I.transformRequest(Ee(te,N,".png"),"SpriteImage");q[Z]=he.getImage(re,C)}return yield Promise.all([...Object.values(F),...Object.values(q)]),(function(Z,te){return c._(this,void 0,void 0,(function*(){const ie={};for(const re in Z){ie[re]={};const ue=xe.getImageCanvasContext((yield te[re]).data),ve=(yield Z[re]).data;for(const le in ve){const{width:_e,height:Te,x:me,y:Ae,sdf:Ve,pixelRatio:Le,stretchX:ze,stretchY:Oe,content:ot,textFitWidth:ct,textFitHeight:tt}=ve[le];ie[re][le]={data:null,pixelRatio:Le,sdf:Ve,stretchX:ze,stretchY:Oe,content:ot,textFitWidth:ct,textFitHeight:tt,spriteData:{width:_e,height:Te,x:me,y:Ae,context:ue}}}}return ie}))})(F,q)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((b=>{if(this._spriteRequest=null,b)for(const I in b){this._spritesImagesIds[I]=[];const A=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter((C=>!(C in b))):[];for(const C of A)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in b[I]){const R=I==="default"?C:`${I}:${C}`;this._spritesImagesIds[I].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,b[I][C],!1):this.imageManager.addImage(R,b[I][C]),s&&(this._changedImages[R]=!0)}}})).catch((b=>{this._spriteRequest=null,y=b,p.signal.aborted||this.fire(new c.k(y))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),u&&u(y)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(t){const s=this.tileManagers[t.source];if(!s)return;const u=t.sourceLayer;if(!u)return;const p=s.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(u)===-1)&&this.fire(new c.k(new Error(`Source layer "${u}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,s=!1){const u=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s?c.bV(u):u);const p=[];for(const y of t)if(u[y]){const b=s?c.bV(u[y]):u[y];p.push(b)}return p}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const u of s){const p=this._layers[u];p.type!=="custom"&&(t[u]=p.serialize())}return t}hasTransitions(){var t,s,u;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const p in this.tileManagers)if(this.tileManagers[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const b in this._updatedSources){const I=this._updatedSources[b];if(I==="reload")this._reloadSource(b);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const u={};for(const p in this.tileManagers){const y=this.tileManagers[p];u[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(t,this._availableImages),!y.isHidden(t.zoom)&&y.source&&(this.tileManagers[y.source].used=!0)}for(const p in u){const y=this.tileManagers[p];!!u[p]!=!!y.used&&y.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,s&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.tileManagers)this.tileManagers[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var u;this._checkLoaded();const p=this.serialize();if(t=s.transformStyle?s.transformStyle(p,t):t,((u=s.validate)===null||u===void 0||u)&&hi(this,c.C(t)))return!1;(t=c.bV(t)).layers=c.bS(t.layers);const y=c.bW(p,t),b=this._getOperationsToPerform(y);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const I of b.operations)I();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],u=[];for(const p of t)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,p.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,p.args)));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":s.push((()=>this.setGlobalState.apply(this,p.args)));break;case"setTransition":s.push((()=>{}));break;default:u.push(p.command)}return{operations:s,unimplemented:u}}addImage(t,s){if(this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,u={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(c.C.source,`sources.${t}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=this.tileManagers[t]=new mr(t,s,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:t}))),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new c.k(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const s=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],s.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.tileManagers[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(s),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,s,u={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new c.k(new Error(`Layer "${p}" already exists on this map.`)));let y;if(t.type==="custom"){if(hi(this,c.bX(t)))return;y=c.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(p,t.source),t=c.bV(t),t=c.e(t,{source:p})),this._validate(c.C.layer,`layers.${p}`,t,{arrayIndex:-1},u))return;y=c.bT(t,this._globalState),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)this.fire(new c.k(new Error(`Cannot add layer "${p}" before non-existing layer "${s}".`)));else{if(this._order.splice(b,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const I=this._removedLayers[p];delete this._removedLayers[p],I.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.tileManagers[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const u=this._order.indexOf(t);this._order.splice(u,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new c.k(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,u){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===s&&p.maxzoom===u||(s!=null&&(p.minzoom=s),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,u={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!c.bR(p.filter,s))return s==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(c.C.filter,`layers.${p.id}.filter`,s,null,u)||(p.setFilter(c.bV(s)),this._updateLayer(p)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return c.bV(this.getLayer(t).filter)}setLayoutProperty(t,s,u,p={}){this._checkLoaded();const y=this.getLayer(t);y?c.bR(y.getLayoutProperty(s),u)||(y.setLayoutProperty(s,u,p),this._updateLayer(y)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const u=this.getLayer(t);if(u)return u.getLayoutProperty(s);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,u,p={}){this._checkLoaded();const y=this.getLayer(t);y?c.bR(y.getPaintProperty(s),u)||this._updatePaintProperty(y,s,u,p):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,s,u,p={}){t.setPaintProperty(s,u,p)&&this._updateLayer(t),c.bU(t)&&s==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(u),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const u=t.source,p=t.sourceLayer,y=this.tileManagers[u];if(y===void 0)return void this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)));const b=y.getSource().type;b==="geojson"&&p?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||p?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,t.id,s)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const u=t.source,p=this.tileManagers[u];if(p===void 0)return void this.fire(new c.k(new Error(`The source '${u}' does not exist in the map's style.`)));const y=p.getSource().type,b=y==="vector"?t.sourceLayer:void 0;y!=="vector"||b?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(b,t.id,s):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,u=t.sourceLayer,p=this.tileManagers[s];if(p!==void 0)return p.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(u,t.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=c.bY(this.tileManagers,(y=>y.serialize())),s=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,p=this.stylesheet;return c.bZ({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:t,layers:s,terrain:u},(y=>y!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=b=>this._layers[b].type==="fill-extrusion",u={},p=[];for(let b=this._order.length-1;b>=0;b--){const I=this._order[b];if(s(I)){u[I]=b;for(const A of t){const C=A[I];if(C)for(const R of C)p.push(R)}}}p.sort(((b,I)=>I.intersectionZ-b.intersectionZ));const y=[];for(let b=this._order.length-1;b>=0;b--){const I=this._order[b];if(s(I))for(let A=p.length-1;A>=0;A--){const C=p[A].feature;if(u[C.layer.id]<b)break;y.push(C),p.pop()}else for(const A of t){const C=A[I];if(C)for(const R of C)y.push(R.feature)}}return y}queryRenderedFeatures(t,s,u){s&&s.filter&&this._validate(c.C.filter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const C of s.layers){const R=this._layers[C];if(!R)return this.fire(new c.k(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];p[R.source]=!0}}const y=[];s.availableImages=this._availableImages;const b=this._serializedAllLayers(),I=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,A=Object.assign(Object.assign({},s),{layers:I,globalState:this._globalState});for(const C in this.tileManagers)s.layers&&!p[C]||y.push(Fn(this.tileManagers[C],this._layers,b,t,A,u,this.map.terrain?(R,N,F)=>this.map.terrain.getElevation(R,N,F):void 0));return this.placement&&y.push((function(C,R,N,F,q,Z,te){const ie={},re=Z.queryRenderedSymbols(F),ue=[];for(const ve of Object.keys(re).map(Number))ue.push(te[ve]);ue.sort(Vt);for(const ve of ue){const le=ve.featureIndex.lookupSymbolFeatures(re[ve.bucketInstanceId],R,ve.bucketIndex,ve.sourceLayerIndex,{filterSpec:q.filter,globalState:q.globalState},q.layers,q.availableImages,C);for(const _e in le){const Te=ie[_e]=ie[_e]||[],me=le[_e];me.sort(((Ae,Ve)=>{const Le=ve.featureSortOrder;if(Le){const ze=Le.indexOf(Ae.featureIndex);return Le.indexOf(Ve.featureIndex)-ze}return Ve.featureIndex-Ae.featureIndex}));for(const Ae of me)Te.push(Ae)}}return(function(ve,le,_e){for(const Te in ve)for(const me of ve[Te])Jt(me,_e[le[Te].source]);return ve})(ie,C,N)})(this._layers,b,this.tileManagers,t,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(t,s){s!=null&&s.filter&&this._validate(c.C.filter,"querySourceFeatures.filter",s.filter,null,s);const u=this.tileManagers[t];return u?(function(p,y){const b=p.getRenderableIds().map((C=>p.getTileByID(C))),I=[],A={};for(let C=0;C<b.length;C++){const R=b[C],N=R.tileID.canonical.key;A[N]||(A[N]=!0,R.querySourceFeatures(I,y))}return I})(u,s?Object.assign(Object.assign({},s),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const b in t)if(!c.bR(t[b],u[b])){p=!0;break}if(!p)return;const y={now:Ce(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(y)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,s={}){this._checkLoaded();const u=this.getSky();let p=!1;if(!t&&!u)return;if(t&&!u)p=!0;else if(!t&&u)p=!0;else for(const b in t)if(!c.bR(t[b],u[b])){p=!0;break}if(!p)return;const y={now:Ce(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,s),this.sky.updateTransitions(y)}_setProjectionInternal(t){const s=(function(u,p){const y={constrainOverride:p};if(Array.isArray(u)){const b=new Gs({type:u});return{projection:b,transform:new dr(y),cameraHelper:new Or(b)}}switch(u){case"mercator":return{projection:new Dn,transform:new js(y),cameraHelper:new Ss};case"globe":{const b=new Gs({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:b,transform:new dr(y),cameraHelper:new Or(b)}}case"vertical-perspective":return{projection:new Ra,transform:new ln(y),cameraHelper:new on};default:return c.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new Dn,transform:new js(y),cameraHelper:new Ss}}})(t,this.map.transformConstrain);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const u in this.tileManagers)this.tileManagers[u].reload()}_validate(t,s,u,p,y={}){return(!y||y.validate!==!1)&&hi(this,t.call(c.C,c.e({key:s,style:this.serialize(),value:u,styleSpec:c.u},p)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ie().off(fe,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.tileManagers){const u=this.tileManagers[s];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const s in this.tileManagers)this.tileManagers[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,s,u,p,y=!1){let b=!1,I=!1;const A={};for(const C of this._order){const R=this._layers[C];if(R.type!=="symbol")continue;if(!A[R.source]){const F=this.tileManagers[R.source];A[R.source]=F.getRenderableIds(!0).map((q=>F.getTileByID(q))).sort(((q,Z)=>Z.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(Z.tileID)?-1:1)))}const N=this.crossTileSymbolIndex.addLayer(R,A[R.source],t.center.lng);b=b||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ce(),t.zoom))&&(this.pauseablePlacement=new Yi(t,this.map.terrain,this._order,y,s,u,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ce()),I=!0),b&&this.pauseablePlacement.placement.setStale()),I||b)for(const C of this._order){const R=this._layers[C];R.type==="symbol"&&this.placement.updateLayerOpacities(R,A[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ce())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,s){return c._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const p=this.tileManagers[s.source];return p&&p.setDependencies(s.tileID.key,s.type,s.icons),u}))}getGlyphs(t,s){return c._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(s.stacks),p=this.tileManagers[s.source];return p&&p.setDependencies(s.tileID.key,s.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(c.C.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,s){return c._(this,void 0,void 0,(function*(){const u={};for(const[p,y]of Object.entries(s.dashes))u[p]=this.lineAtlas.getDash(y.dasharray,y.round);return u}))}addSprite(t,s,u={},p){this._checkLoaded();const y=[{id:t,url:s}],b=[...ae(this.stylesheet.sprite),...y];this._validate(c.C.sprite,"sprite",b,null,u)||(this.stylesheet.sprite=b,this._loadSprite(y,!0,p))}removeSprite(t){this._checkLoaded();const s=ae(this.stylesheet.sprite);if(s.find((u=>u.id===t))){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;s.splice(s.findIndex((u=>u.id===t)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ae(this.stylesheet.sprite)}setSprite(t,s={},u){this._checkLoaded(),t&&this._validate(c.C.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const s=this.tileManagers[t];s.setEventedParent(null),s.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const s=this._layers[t];s.setEventedParent(null),s.onRemove&&s.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Zs=c.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class so{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,u,p,y,b,I,A,C){this.context=t;let R=this.boundPaintVertexBuffers.length!==p.length;for(let N=0;!R&&N<p.length;N++)this.boundPaintVertexBuffers[N]!==p[N]&&(R=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||R||this.boundIndexBuffer!==y||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==C?this.freshBind(s,u,p,y,b,I,A,C):(t.bindVertexArray.set(this.vao),I&&I.bind(),y&&y.dynamicDraw&&y.bind(),A&&A.bind(),C&&C.bind())}freshBind(t,s,u,p,y,b,I,A){const C=t.numAttributes,R=this.context,N=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=A,s.enableAttributes(N,t);for(const F of u)F.enableAttributes(N,t);b&&b.enableAttributes(N,t),I&&I.enableAttributes(N,t),A&&A.enableAttributes(N,t),s.bind(),s.setVertexAttribPointers(N,t,y);for(const F of u)F.bind(),F.setVertexAttribPointers(N,t,y);b&&(b.bind(),b.setVertexAttribPointers(N,t,y)),p&&p.bind(),I&&(I.bind(),I.setVertexAttribPointers(N,t,y)),A&&(A.bind(),A.setVertexAttribPointers(N,t,y)),R.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Tl=(_,t,s,u,p)=>({u_texture:0,u_ele_delta:_,u_fog_matrix:t,u_fog_color:s?s.properties.get("fog-color"):c.bp.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:s?s.calculateFogBlendOpacity(u):0,u_horizon_color:s?s.properties.get("horizon-color"):c.bp.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),Da={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ic(_){const t=[];for(let s=0;s<_.length;s++){if(_[s]===null)continue;const u=_[s].split(" ");t.push(u.pop())}return t}class Rd{constructor(t,s,u,p,y,b,I,A,C=[]){const R=t.gl;this.program=R.createProgram();const N=Ic(s.staticAttributes),F=u?u.getBinderAttributes():[],q=N.concat(F),Z=er.prelude.staticUniforms?Ic(er.prelude.staticUniforms):[],te=I.staticUniforms?Ic(I.staticUniforms):[],ie=s.staticUniforms?Ic(s.staticUniforms):[],re=u?u.getBinderUniforms():[],ue=Z.concat(te).concat(ie).concat(re),ve=[];for(const Le of ue)ve.indexOf(Le)<0&&ve.push(Le);const le=u?u.defines():[];Si(R)&&le.unshift("#version 300 es"),y&&le.push("#define OVERDRAW_INSPECTOR;"),b&&le.push("#define TERRAIN3D;"),A&&le.push(A),C&&le.push(...C);let _e=le.concat(er.prelude.fragmentSource,I.fragmentSource,s.fragmentSource).join(`
`),Te=le.concat(er.prelude.vertexSource,I.vertexSource,s.vertexSource).join(`
`);Si(R)||(_e=(function(Le){return Le.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(_e),Te=(function(Le){return Le.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Te));const me=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(me,_e),R.compileShader(me),!R.getShaderParameter(me,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(me)}`);R.attachShader(this.program,me);const Ae=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Ae,Te),R.compileShader(Ae),!R.getShaderParameter(Ae,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(Ae)}`);R.attachShader(this.program,Ae),this.attributes={};const Ve={};this.numAttributes=q.length;for(let Le=0;Le<this.numAttributes;Le++)q[Le]&&(R.bindAttribLocation(this.program,Le,q[Le]),this.attributes[q[Le]]=Le);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(Ae),R.deleteShader(me);for(let Le=0;Le<ve.length;Le++){const ze=ve[Le];if(ze&&!Ve[ze]){const Oe=R.getUniformLocation(this.program,ze);Oe&&(Ve[ze]=Oe)}}this.fixedUniforms=p(t,Ve),this.terrainUniforms=((Le,ze)=>({u_depth:new c.b_(Le,ze.u_depth),u_terrain:new c.b_(Le,ze.u_terrain),u_terrain_dim:new c.bq(Le,ze.u_terrain_dim),u_terrain_matrix:new c.c0(Le,ze.u_terrain_matrix),u_terrain_unpack:new c.c1(Le,ze.u_terrain_unpack),u_terrain_exaggeration:new c.bq(Le,ze.u_terrain_exaggeration)}))(t,Ve),this.projectionUniforms=((Le,ze)=>({u_projection_matrix:new c.c0(Le,ze.u_projection_matrix),u_projection_tile_mercator_coords:new c.c1(Le,ze.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.c1(Le,ze.u_projection_clipping_plane),u_projection_transition:new c.bq(Le,ze.u_projection_transition),u_projection_fallback_matrix:new c.c0(Le,ze.u_projection_fallback_matrix)}))(t,Ve),this.binderUniforms=u?u.getUniforms(t,Ve):[]}draw(t,s,u,p,y,b,I,A,C,R,N,F,q,Z,te,ie,re,ue,ve){const le=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(p),t.setColorMode(y),t.setCullFace(b),A){t.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,A.depthTexture),t.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,A.texture);for(const Te in this.terrainUniforms)this.terrainUniforms[Te].set(A[Te])}if(C)for(const Te in C)this.projectionUniforms[Da[Te]].set(C[Te]);if(I)for(const Te in this.fixedUniforms)this.fixedUniforms[Te].set(I[Te]);ie&&ie.setUniforms(t,this.binderUniforms,Z,{zoom:te});let _e=0;switch(s){case le.LINES:_e=2;break;case le.TRIANGLES:_e=3;break;case le.LINE_STRIP:_e=1}for(const Te of q.get()){const me=Te.vaos||(Te.vaos={});(me[R]||(me[R]=new so)).bind(t,this,N,ie?ie.getPaintVertexBuffers():[],F,Te.vertexOffset,re,ue,ve),le.drawElements(s,Te.primitiveLength*_e,le.UNSIGNED_SHORT,Te.primitiveOffset*_e*2)}}}function Dd(_,t,s){const u=1/c.aN(s,1,t.transform.tileZoom),p=Math.pow(2,s.tileID.overscaledZ),y=s.tileSize*Math.pow(2,t.transform.tileZoom)/p,b=y*(s.tileID.canonical.x+s.tileID.wrap*p),I=y*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[b>>16,I>>16],u_pixel_coord_lower:[65535&b,65535&I]}}const Zu=(_,t,s,u)=>{const p=_.style.light,y=p.properties.get("position"),b=[y.x,y.y,y.z],I=c.c4();p.properties.get("anchor")==="viewport"&&c.c5(I,_.transform.bearingInRadians),c.c6(b,b,I);const A=_.transform.transformLightDirection(b),C=p.properties.get("color");return{u_lightpos:b,u_lightpos_globe:A,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+t,u_opacity:s,u_fill_translate:u}},Ku=(_,t,s,u,p,y,b)=>c.e(Zu(_,t,s,u),Dd(y,_,b),{u_height_factor:-Math.pow(2,p.overscaledZ)/b.tileSize/8}),Xu=(_,t,s,u)=>c.e(Dd(t,_,s),{u_fill_translate:u}),Ld=(_,t)=>({u_world:_,u_fill_translate:t}),zd=(_,t,s,u,p)=>c.e(Xu(_,t,s,p),{u_world:u}),Od=(_,t,s,u,p)=>{const y=_.transform;let b,I,A=0;if(s.paint.get("circle-pitch-alignment")==="map"){const C=c.aN(t,1,y.zoom);b=!0,I=[C,C],A=C/(c.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*p}else b=!1,I=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+b,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:I,u_globe_extrude_scale:A,u_translate:u}},ta=_=>({u_pixel_extrude_scale:[1/_.width,1/_.height]}),Fd=_=>({u_viewport_size:[_.width,_.height]}),Yu=(_,t=1)=>({u_color:_,u_overlay:0,u_overlay_scale:t}),La=(_,t,s,u)=>{const p=c.aN(_,1,t)/(c.a5*Math.pow(2,_.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:c.aN(_,1,t),u_intensity:s,u_globe_extrude_scale:p}},Nd=(_,t,s,u)=>{const p=c.N();c.c7(p,0,_.width,_.height,0,0,1);const y=_.context.gl;return{u_matrix:p,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:s,u_color_ramp:u,u_opacity:t.paint.get("heatmap-opacity")}},Sc=(_,t,s)=>{const u=s.paint.get("hillshade-accent-color");let p;switch(s.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const y=s.getIlluminationProperties();for(let b=0;b<y.directionRadians.length;b++)s.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[b]+=_.transform.bearingInRadians);return{u_image:0,u_latrange:dm(0,t.tileID),u_exaggeration:s.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:u,u_method:p,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},hm=(_,t)=>{const s=t.stride,u=c.N();return c.c7(u,0,c.a5,-c.a5,0,0,1),c.O(u,u,[0,-c.a5,0]),{u_matrix:u,u_image:1,u_dimension:[s,s],u_zoom:_.overscaledZ,u_unpack:t.getUnpackVector()}};function dm(_,t){const s=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new c.a9(0,u/s).toLngLat().lat,new c.a9(0,(u+1)/s).toLngLat().lat]}const Vd=(_,t,s=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:s,u_opacity:_.paint.get("color-relief-opacity")}),El=(_,t,s,u)=>{const p=_.transform;return{u_translation:Pc(_,t,s),u_ratio:u/c.aN(t,1,p.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Bd=(_,t,s,u,p)=>c.e(El(_,t,s,u),{u_image:0,u_image_height:p}),Qu=(_,t,s,u,p)=>{const y=_.transform,b=As(t,y);return{u_translation:Pc(_,t,s),u_texsize:t.imageAtlasTexture.size,u_ratio:u/c.aN(t,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[b,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Ud=(_,t,s,u,p)=>{const y=As(t,_.transform);return c.e(El(_,t,s,u),{u_tileratio:y,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image:0,u_mix:p.t,u_lineatlas_width:_.lineAtlas.width,u_lineatlas_height:_.lineAtlas.height})},Ac=(_,t,s,u,p,y)=>{const b=As(t,_.transform);return c.e(El(_,t,s,u),{u_image:0,u_image_height:y,u_tileratio:b,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image_dash:1,u_mix:p.t,u_lineatlas_width:_.lineAtlas.width,u_lineatlas_height:_.lineAtlas.height})};function As(_,t){return 1/c.aN(_,1,t.tileZoom)}function Pc(_,t,s){return c.aO(_.transform,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Ju=(_,t,s,u,p)=>{return{u_tl_parent:_,u_scale_parent:t,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(b=u.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(y=u.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:eh(u.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var y,b};function eh(_){_*=Math.PI/180;const t=Math.sin(_),s=Math.cos(_);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const th=(_,t,s,u,p,y,b,I,A,C,R,N,F)=>{const q=b.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:q.width/q.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_label_plane_matrix:I,u_coord_matrix:A,u_is_text:+R,u_pitch_with_map:+u,u_is_along_line:p,u_is_variable_anchor:y,u_texsize:N,u_texture:0,u_translation:C,u_pitched_scale:F}},Cc=(_,t,s,u,p,y,b,I,A,C,R,N,F,q)=>{const Z=b.transform;return c.e(th(_,t,s,u,p,y,b,I,A,C,R,N,q),{u_gamma_scale:u?Math.cos(Z.pitch*Math.PI/180)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:1})},na=(_,t,s,u,p,y,b,I,A,C,R,N,F)=>c.e(Cc(_,t,s,u,p,y,b,I,A,C,!0,R,0,F),{u_texsize_icon:N,u_texture_icon:1}),nh=(_,t)=>({u_opacity:_,u_color:t}),pm=(_,t,s,u,p)=>c.e((function(y,b,I,A){const C=I.imageManager.getPattern(y.from.toString()),R=I.imageManager.getPattern(y.to.toString()),{width:N,height:F}=I.imageManager.getPixelSize(),q=Math.pow(2,A.tileID.overscaledZ),Z=A.tileSize*Math.pow(2,I.transform.tileZoom)/q,te=Z*(A.tileID.canonical.x+A.tileID.wrap*q),ie=Z*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[N,F],u_mix:b.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/c.aN(A,1,I.transform.tileZoom),u_pixel_coord_upper:[te>>16,ie>>16],u_pixel_coord_lower:[65535&te,65535&ie]}})(s,p,t,u),{u_opacity:_}),jd=(_,t)=>{},fm={fillExtrusion:(_,t)=>({u_lightpos:new c.c2(_,t.u_lightpos),u_lightpos_globe:new c.c2(_,t.u_lightpos_globe),u_lightintensity:new c.bq(_,t.u_lightintensity),u_lightcolor:new c.c2(_,t.u_lightcolor),u_vertical_gradient:new c.bq(_,t.u_vertical_gradient),u_opacity:new c.bq(_,t.u_opacity),u_fill_translate:new c.c3(_,t.u_fill_translate)}),fillExtrusionPattern:(_,t)=>({u_lightpos:new c.c2(_,t.u_lightpos),u_lightpos_globe:new c.c2(_,t.u_lightpos_globe),u_lightintensity:new c.bq(_,t.u_lightintensity),u_lightcolor:new c.c2(_,t.u_lightcolor),u_vertical_gradient:new c.bq(_,t.u_vertical_gradient),u_height_factor:new c.bq(_,t.u_height_factor),u_opacity:new c.bq(_,t.u_opacity),u_fill_translate:new c.c3(_,t.u_fill_translate),u_image:new c.b_(_,t.u_image),u_texsize:new c.c3(_,t.u_texsize),u_pixel_coord_upper:new c.c3(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(_,t.u_pixel_coord_lower),u_scale:new c.c2(_,t.u_scale),u_fade:new c.bq(_,t.u_fade)}),fill:(_,t)=>({u_fill_translate:new c.c3(_,t.u_fill_translate)}),fillPattern:(_,t)=>({u_image:new c.b_(_,t.u_image),u_texsize:new c.c3(_,t.u_texsize),u_pixel_coord_upper:new c.c3(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(_,t.u_pixel_coord_lower),u_scale:new c.c2(_,t.u_scale),u_fade:new c.bq(_,t.u_fade),u_fill_translate:new c.c3(_,t.u_fill_translate)}),fillOutline:(_,t)=>({u_world:new c.c3(_,t.u_world),u_fill_translate:new c.c3(_,t.u_fill_translate)}),fillOutlinePattern:(_,t)=>({u_world:new c.c3(_,t.u_world),u_image:new c.b_(_,t.u_image),u_texsize:new c.c3(_,t.u_texsize),u_pixel_coord_upper:new c.c3(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(_,t.u_pixel_coord_lower),u_scale:new c.c2(_,t.u_scale),u_fade:new c.bq(_,t.u_fade),u_fill_translate:new c.c3(_,t.u_fill_translate)}),circle:(_,t)=>({u_camera_to_center_distance:new c.bq(_,t.u_camera_to_center_distance),u_scale_with_map:new c.b_(_,t.u_scale_with_map),u_pitch_with_map:new c.b_(_,t.u_pitch_with_map),u_extrude_scale:new c.c3(_,t.u_extrude_scale),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_globe_extrude_scale:new c.bq(_,t.u_globe_extrude_scale),u_translate:new c.c3(_,t.u_translate)}),collisionBox:(_,t)=>({u_pixel_extrude_scale:new c.c3(_,t.u_pixel_extrude_scale)}),collisionCircle:(_,t)=>({u_viewport_size:new c.c3(_,t.u_viewport_size)}),debug:(_,t)=>({u_color:new c.b$(_,t.u_color),u_overlay:new c.b_(_,t.u_overlay),u_overlay_scale:new c.bq(_,t.u_overlay_scale)}),depth:jd,clippingMask:jd,heatmap:(_,t)=>({u_extrude_scale:new c.bq(_,t.u_extrude_scale),u_intensity:new c.bq(_,t.u_intensity),u_globe_extrude_scale:new c.bq(_,t.u_globe_extrude_scale)}),heatmapTexture:(_,t)=>({u_matrix:new c.c0(_,t.u_matrix),u_world:new c.c3(_,t.u_world),u_image:new c.b_(_,t.u_image),u_color_ramp:new c.b_(_,t.u_color_ramp),u_opacity:new c.bq(_,t.u_opacity)}),hillshade:(_,t)=>({u_image:new c.b_(_,t.u_image),u_latrange:new c.c3(_,t.u_latrange),u_exaggeration:new c.bq(_,t.u_exaggeration),u_altitudes:new c.c9(_,t.u_altitudes),u_azimuths:new c.c9(_,t.u_azimuths),u_accent:new c.b$(_,t.u_accent),u_method:new c.b_(_,t.u_method),u_shadows:new c.c8(_,t.u_shadows),u_highlights:new c.c8(_,t.u_highlights)}),hillshadePrepare:(_,t)=>({u_matrix:new c.c0(_,t.u_matrix),u_image:new c.b_(_,t.u_image),u_dimension:new c.c3(_,t.u_dimension),u_zoom:new c.bq(_,t.u_zoom),u_unpack:new c.c1(_,t.u_unpack)}),colorRelief:(_,t)=>({u_image:new c.b_(_,t.u_image),u_unpack:new c.c1(_,t.u_unpack),u_dimension:new c.c3(_,t.u_dimension),u_elevation_stops:new c.b_(_,t.u_elevation_stops),u_color_stops:new c.b_(_,t.u_color_stops),u_color_ramp_size:new c.b_(_,t.u_color_ramp_size),u_opacity:new c.bq(_,t.u_opacity)}),line:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels)}),lineGradient:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels),u_image:new c.b_(_,t.u_image),u_image_height:new c.bq(_,t.u_image_height)}),linePattern:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_texsize:new c.c3(_,t.u_texsize),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_image:new c.b_(_,t.u_image),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels),u_scale:new c.c2(_,t.u_scale),u_fade:new c.bq(_,t.u_fade)}),lineSDF:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels),u_image:new c.b_(_,t.u_image),u_mix:new c.bq(_,t.u_mix),u_tileratio:new c.bq(_,t.u_tileratio),u_crossfade_from:new c.bq(_,t.u_crossfade_from),u_crossfade_to:new c.bq(_,t.u_crossfade_to),u_lineatlas_width:new c.bq(_,t.u_lineatlas_width),u_lineatlas_height:new c.bq(_,t.u_lineatlas_height)}),lineGradientSDF:(_,t)=>({u_translation:new c.c3(_,t.u_translation),u_ratio:new c.bq(_,t.u_ratio),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_units_to_pixels:new c.c3(_,t.u_units_to_pixels),u_image:new c.b_(_,t.u_image),u_image_height:new c.bq(_,t.u_image_height),u_tileratio:new c.bq(_,t.u_tileratio),u_crossfade_from:new c.bq(_,t.u_crossfade_from),u_crossfade_to:new c.bq(_,t.u_crossfade_to),u_image_dash:new c.b_(_,t.u_image_dash),u_mix:new c.bq(_,t.u_mix),u_lineatlas_width:new c.bq(_,t.u_lineatlas_width),u_lineatlas_height:new c.bq(_,t.u_lineatlas_height)}),raster:(_,t)=>({u_tl_parent:new c.c3(_,t.u_tl_parent),u_scale_parent:new c.bq(_,t.u_scale_parent),u_buffer_scale:new c.bq(_,t.u_buffer_scale),u_fade_t:new c.bq(_,t.u_fade_t),u_opacity:new c.bq(_,t.u_opacity),u_image0:new c.b_(_,t.u_image0),u_image1:new c.b_(_,t.u_image1),u_brightness_low:new c.bq(_,t.u_brightness_low),u_brightness_high:new c.bq(_,t.u_brightness_high),u_saturation_factor:new c.bq(_,t.u_saturation_factor),u_contrast_factor:new c.bq(_,t.u_contrast_factor),u_spin_weights:new c.c2(_,t.u_spin_weights),u_coords_top:new c.c1(_,t.u_coords_top),u_coords_bottom:new c.c1(_,t.u_coords_bottom)}),symbolIcon:(_,t)=>({u_is_size_zoom_constant:new c.b_(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(_,t.u_is_size_feature_constant),u_size_t:new c.bq(_,t.u_size_t),u_size:new c.bq(_,t.u_size),u_camera_to_center_distance:new c.bq(_,t.u_camera_to_center_distance),u_pitch:new c.bq(_,t.u_pitch),u_rotate_symbol:new c.b_(_,t.u_rotate_symbol),u_aspect_ratio:new c.bq(_,t.u_aspect_ratio),u_fade_change:new c.bq(_,t.u_fade_change),u_label_plane_matrix:new c.c0(_,t.u_label_plane_matrix),u_coord_matrix:new c.c0(_,t.u_coord_matrix),u_is_text:new c.b_(_,t.u_is_text),u_pitch_with_map:new c.b_(_,t.u_pitch_with_map),u_is_along_line:new c.b_(_,t.u_is_along_line),u_is_variable_anchor:new c.b_(_,t.u_is_variable_anchor),u_texsize:new c.c3(_,t.u_texsize),u_texture:new c.b_(_,t.u_texture),u_translation:new c.c3(_,t.u_translation),u_pitched_scale:new c.bq(_,t.u_pitched_scale)}),symbolSDF:(_,t)=>({u_is_size_zoom_constant:new c.b_(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(_,t.u_is_size_feature_constant),u_size_t:new c.bq(_,t.u_size_t),u_size:new c.bq(_,t.u_size),u_camera_to_center_distance:new c.bq(_,t.u_camera_to_center_distance),u_pitch:new c.bq(_,t.u_pitch),u_rotate_symbol:new c.b_(_,t.u_rotate_symbol),u_aspect_ratio:new c.bq(_,t.u_aspect_ratio),u_fade_change:new c.bq(_,t.u_fade_change),u_label_plane_matrix:new c.c0(_,t.u_label_plane_matrix),u_coord_matrix:new c.c0(_,t.u_coord_matrix),u_is_text:new c.b_(_,t.u_is_text),u_pitch_with_map:new c.b_(_,t.u_pitch_with_map),u_is_along_line:new c.b_(_,t.u_is_along_line),u_is_variable_anchor:new c.b_(_,t.u_is_variable_anchor),u_texsize:new c.c3(_,t.u_texsize),u_texture:new c.b_(_,t.u_texture),u_gamma_scale:new c.bq(_,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_is_halo:new c.b_(_,t.u_is_halo),u_translation:new c.c3(_,t.u_translation),u_pitched_scale:new c.bq(_,t.u_pitched_scale)}),symbolTextAndIcon:(_,t)=>({u_is_size_zoom_constant:new c.b_(_,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(_,t.u_is_size_feature_constant),u_size_t:new c.bq(_,t.u_size_t),u_size:new c.bq(_,t.u_size),u_camera_to_center_distance:new c.bq(_,t.u_camera_to_center_distance),u_pitch:new c.bq(_,t.u_pitch),u_rotate_symbol:new c.b_(_,t.u_rotate_symbol),u_aspect_ratio:new c.bq(_,t.u_aspect_ratio),u_fade_change:new c.bq(_,t.u_fade_change),u_label_plane_matrix:new c.c0(_,t.u_label_plane_matrix),u_coord_matrix:new c.c0(_,t.u_coord_matrix),u_is_text:new c.b_(_,t.u_is_text),u_pitch_with_map:new c.b_(_,t.u_pitch_with_map),u_is_along_line:new c.b_(_,t.u_is_along_line),u_is_variable_anchor:new c.b_(_,t.u_is_variable_anchor),u_texsize:new c.c3(_,t.u_texsize),u_texsize_icon:new c.c3(_,t.u_texsize_icon),u_texture:new c.b_(_,t.u_texture),u_texture_icon:new c.b_(_,t.u_texture_icon),u_gamma_scale:new c.bq(_,t.u_gamma_scale),u_device_pixel_ratio:new c.bq(_,t.u_device_pixel_ratio),u_is_halo:new c.b_(_,t.u_is_halo),u_translation:new c.c3(_,t.u_translation),u_pitched_scale:new c.bq(_,t.u_pitched_scale)}),background:(_,t)=>({u_opacity:new c.bq(_,t.u_opacity),u_color:new c.b$(_,t.u_color)}),backgroundPattern:(_,t)=>({u_opacity:new c.bq(_,t.u_opacity),u_image:new c.b_(_,t.u_image),u_pattern_tl_a:new c.c3(_,t.u_pattern_tl_a),u_pattern_br_a:new c.c3(_,t.u_pattern_br_a),u_pattern_tl_b:new c.c3(_,t.u_pattern_tl_b),u_pattern_br_b:new c.c3(_,t.u_pattern_br_b),u_texsize:new c.c3(_,t.u_texsize),u_mix:new c.bq(_,t.u_mix),u_pattern_size_a:new c.c3(_,t.u_pattern_size_a),u_pattern_size_b:new c.c3(_,t.u_pattern_size_b),u_scale_a:new c.bq(_,t.u_scale_a),u_scale_b:new c.bq(_,t.u_scale_b),u_pixel_coord_upper:new c.c3(_,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(_,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bq(_,t.u_tile_units_to_pixels)}),terrain:(_,t)=>({u_texture:new c.b_(_,t.u_texture),u_ele_delta:new c.bq(_,t.u_ele_delta),u_fog_matrix:new c.c0(_,t.u_fog_matrix),u_fog_color:new c.b$(_,t.u_fog_color),u_fog_ground_blend:new c.bq(_,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bq(_,t.u_fog_ground_blend_opacity),u_horizon_color:new c.b$(_,t.u_horizon_color),u_horizon_fog_blend:new c.bq(_,t.u_horizon_fog_blend),u_is_globe_mode:new c.bq(_,t.u_is_globe_mode)}),terrainDepth:(_,t)=>({u_ele_delta:new c.bq(_,t.u_ele_delta)}),terrainCoords:(_,t)=>({u_texture:new c.b_(_,t.u_texture),u_terrain_coords_id:new c.bq(_,t.u_terrain_coords_id),u_ele_delta:new c.bq(_,t.u_ele_delta)}),projectionErrorMeasurement:(_,t)=>({u_input:new c.bq(_,t.u_input),u_output_expected:new c.bq(_,t.u_output_expected)}),atmosphere:(_,t)=>({u_sun_pos:new c.c2(_,t.u_sun_pos),u_atmosphere_blend:new c.bq(_,t.u_atmosphere_blend),u_globe_position:new c.c2(_,t.u_globe_position),u_globe_radius:new c.bq(_,t.u_globe_radius),u_inv_proj_matrix:new c.c0(_,t.u_inv_proj_matrix)}),sky:(_,t)=>({u_sky_color:new c.b$(_,t.u_sky_color),u_horizon_color:new c.b$(_,t.u_horizon_color),u_horizon:new c.c3(_,t.u_horizon),u_horizon_normal:new c.c3(_,t.u_horizon_normal),u_sky_horizon_blend:new c.bq(_,t.u_sky_horizon_blend),u_sky_blend:new c.bq(_,t.u_sky_blend)})};class mm{constructor(t,s,u){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $d={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class gm{constructor(t,s,u,p){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),t.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let u=0;u<this.attributes.length;u++){const p=s.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,s,u){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],b=s.attributes[y.name];b!==void 0&&t.vertexAttribPointer(b,y.components,t[$d[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Hn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mc extends Hn{getDefault(){return c.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class kc extends Hn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Rc extends Hn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class rh extends Hn{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ra extends Hn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Il extends Hn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class za extends Hn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class gs extends Hn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class qd extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Gd extends Hn{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ih extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class ia extends Hn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Dc extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Lc extends Hn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Sl extends Hn{getDefault(){return c.bp.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class zc extends Hn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Hd extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Oa extends Hn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Fa extends Hn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Wd extends Hn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class sh extends Hn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Tn extends Hn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Oc extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class _m extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Zd extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Al extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ym extends Hn{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class vm extends Hn{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const u=this.gl;Si(u)?u.bindVertexArray(t):(s=u.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Kd extends Hn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class xm extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class oh extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Na extends Hn{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Pl extends Na{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Fc extends Na{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ah extends Na{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const lh="Framebuffer is not complete";class Nc{constructor(t,s,u,p,y){this.context=t,this.width=s,this.height=u;const b=t.gl,I=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new Pl(t,I),p)this.depthAttachment=y?new ah(t,I):new Fc(t,I);else if(y)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error(lh)}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class Vc{constructor(t){var s,u;if(this.gl=t,this.clearColor=new Mc(this),this.clearDepth=new kc(this),this.clearStencil=new Rc(this),this.colorMask=new rh(this),this.depthMask=new ra(this),this.stencilMask=new Il(this),this.stencilFunc=new za(this),this.stencilOp=new gs(this),this.stencilTest=new qd(this),this.depthRange=new Gd(this),this.depthTest=new ih(this),this.depthFunc=new ia(this),this.blend=new Dc(this),this.blendFunc=new Lc(this),this.blendColor=new Sl(this),this.blendEquation=new zc(this),this.cullFace=new Hd(this),this.cullFaceSide=new Oa(this),this.frontFace=new Fa(this),this.program=new Wd(this),this.activeTexture=new sh(this),this.viewport=new Tn(this),this.bindFramebuffer=new Oc(this),this.bindRenderbuffer=new _m(this),this.bindTexture=new Zd(this),this.bindVertexBuffer=new Al(this),this.bindElementBuffer=new ym(this),this.bindVertexArray=new vm(this),this.pixelStoreUnpack=new Kd(this),this.pixelStoreUnpackPremultiplyAlpha=new xm(this),this.pixelStoreUnpackFlipY=new oh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Si(t)){this.HALF_FLOAT=t.HALF_FLOAT;const p=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:p==null?void 0:p.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:p==null?void 0:p.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const p=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=p==null?void 0:p.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new mm(this,t,s)}createVertexBuffer(t,s,u){return new gm(this,t,s,u)}createRenderbuffer(t,s,u){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,t,s,u),this.bindRenderbuffer.set(null),y}createFramebuffer(t,s,u,p){return new Nc(this,t,s,u,p)}clear({color:t,depth:s,stencil:u}){const p=this.gl;let y=0;t&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){c.bR(t.blendFunction,Gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Si(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return Si(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Ao;function sa(_,t,s,u,p){const y=_.context,b=_.transform,I=y.gl,A=_.useProgram("collisionBox"),C=[];let R=0,N=0;for(let re=0;re<u.length;re++){const ue=u[re],ve=t.getTile(ue).getBucket(s);if(!ve)continue;const le=p?ve.textCollisionBox:ve.iconCollisionBox,_e=ve.collisionCircleArray;_e.length>0&&(C.push({circleArray:_e,circleOffset:N,coord:ue}),R+=_e.length/4,N=R),le&&A.draw(y,I.LINES,an.disabled,wn.disabled,_.colorModeForRenderPass(),bn.disabled,ta(_.transform),_.style.map.terrain&&_.style.map.terrain.getTerrainData(ue),b.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,null,_.transform.zoom,null,null,le.collisionVertexBuffer)}if(!p||!C.length)return;const F=_.useProgram("collisionCircle"),q=new c.ca;q.resize(4*R),q._trim();let Z=0;for(const re of C)for(let ue=0;ue<re.circleArray.length/4;ue++){const ve=4*ue,le=re.circleArray[ve+0],_e=re.circleArray[ve+1],Te=re.circleArray[ve+2],me=re.circleArray[ve+3];q.emplace(Z++,le,_e,Te,me,0),q.emplace(Z++,le,_e,Te,me,1),q.emplace(Z++,le,_e,Te,me,2),q.emplace(Z++,le,_e,Te,me,3)}(!Ao||Ao.length<2*R)&&(Ao=(function(re){const ue=2*re,ve=new c.cc;ve.resize(ue),ve._trim();for(let le=0;le<ue;le++){const _e=6*le;ve.uint16[_e+0]=4*le+0,ve.uint16[_e+1]=4*le+1,ve.uint16[_e+2]=4*le+2,ve.uint16[_e+3]=4*le+2,ve.uint16[_e+4]=4*le+3,ve.uint16[_e+5]=4*le+0}return ve})(R));const te=y.createIndexBuffer(Ao,!0),ie=y.createVertexBuffer(q,c.cb.members,!0);for(const re of C){const ue=Fd(_.transform);F.draw(y,I.TRIANGLES,an.disabled,wn.disabled,_.colorModeForRenderPass(),bn.disabled,ue,_.style.map.terrain&&_.style.map.terrain.getTerrainData(re.coord),null,s.id,ie,te,c.aX.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,_.transform.zoom,null,null,null)}ie.destroy(),te.destroy()}const ch=c.ar(new Float32Array(16));function bm(_,t,s,u,p,y){const{horizontalAlign:b,verticalAlign:I}=c.aS(_);return new c.P((-(b-.5)*t/p+u[0])*y,(-(I-.5)*s/p+u[1])*y)}function Cl(_,t,s,u,p,y){const b=t.tileAnchorPoint.add(new c.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let I=u.mult(y);s||(I=I.rotate(-p));const A=b.add(I);return Dt(A.x,A.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(s){const I=Ln(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(_),A=Math.atan(I.y/I.x)+(I.x<0?Math.PI:0);return _.add(u.rotate(A))}return _.add(u)}function wm(_,t,s,u,p,y,b,I,A,C,R,N){const F=_.text.placedSymbolArray,q=_.text.dynamicLayoutVertexArray,Z=_.icon.dynamicLayoutVertexArray,te={};q.clear();for(let ie=0;ie<F.length;ie++){const re=F.get(ie),ue=re.hidden||!re.crossTileID||_.allowVerticalPlacement&&!re.placedOrientation?null:u[re.crossTileID];if(ue){const ve=new c.P(re.anchorX,re.anchorY),le={getElevation:N,width:p.width,height:p.height,pitchedLabelPlaneMatrix:y,pitchWithMap:s,transform:p,tileAnchorPoint:ve,translation:C,unwrappedTileID:R},_e=s?Xr(ve.x,ve.y,le):Ln(ve.x,ve.y,le),Te=Xn(p.cameraToCenterDistance,_e.signedDistanceFromCamera);let me=c.aA(_.textSizeData,I,re)*Te/c.aM;s&&(me*=_.tilePixelRatio/b);const{width:Ae,height:Ve,anchor:Le,textOffset:ze,textBoxScale:Oe}=ue,ot=bm(Le,Ae,Ve,ze,Oe,me),ct=p.getPitchedTextCorrection(ve.x+C[0],ve.y+C[1],R),tt=Cl(_e.point,le,t,ot,-p.bearingInRadians,ct),pt=_.allowVerticalPlacement&&re.placedOrientation===c.az.vertical?Math.PI/2:0;for(let sn=0;sn<re.numGlyphs;sn++)c.aG(q,tt,pt);A&&re.associatedIconIndex>=0&&(te[re.associatedIconIndex]={shiftedAnchor:tt,angle:pt})}else Ur(re.numGlyphs,q)}if(A){Z.clear();const ie=_.icon.placedSymbolArray;for(let re=0;re<ie.length;re++){const ue=ie.get(re);if(ue.hidden)Ur(ue.numGlyphs,Z);else{const ve=te[re];if(ve)for(let le=0;le<ue.numGlyphs;le++)c.aG(Z,ve.shiftedAnchor,ve.angle);else Ur(ue.numGlyphs,Z)}}_.icon.dynamicLayoutVertexBuffer.updateData(Z)}_.text.dynamicLayoutVertexBuffer.updateData(q)}function Xd(_,t,s){return s.iconsInText&&t?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Ml(_,t,s,u,p,y,b,I,A,C,R,N,F){const q=_.context,Z=q.gl,te=_.transform,ie=I==="map",re=A==="map",ue=I!=="viewport"&&s.layout.get("symbol-placement")!=="point",ve=ie&&!re&&!ue,le=!s.layout.get("symbol-sort-key").isConstant();let _e=!1;const Te=_.getDepthModeForSublayer(0,an.ReadOnly),me=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ae=[],Ve=te.getCircleRadiusCorrection();for(const Le of u){const ze=t.getTile(Le),Oe=ze.getBucket(s);if(!Oe)continue;const ot=p?Oe.text:Oe.icon;if(!ot||!ot.segments.get().length||!ot.hasVisibleVertices)continue;const ct=ot.programConfigurations.get(s.id),tt=p||Oe.sdfIcons,pt=p?Oe.textSizeData:Oe.iconSizeData,sn=re||te.pitch!==0,Yn=_.useProgram(Xd(tt,p,Oe),ct),pr=c.ay(pt,te.zoom),ir=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Le);let _r,sr,Ir,yr,ti=[0,0],Fr=null;if(p)sr=ze.glyphAtlasTexture,Ir=Z.LINEAR,_r=ze.glyphAtlasTexture.size,Oe.iconsInText&&(ti=ze.imageAtlasTexture.size,Fr=ze.imageAtlasTexture,yr=sn||_.options.rotating||_.options.zooming||pt.kind==="composite"||pt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const lr=s.layout.get("icon-size").constantOr(0)!==1||Oe.iconsNeedLinear;sr=ze.imageAtlasTexture,Ir=tt||_.options.rotating||_.options.zooming||lr||sn?Z.LINEAR:Z.NEAREST,_r=ze.imageAtlasTexture.size}const Dr=c.aN(ze,1,_.transform.zoom),di=Cr(ie,_.transform,Dr),Ro=c.N();c.aB(Ro,di);const ao=Di(re,ie,_.transform,Dr),Ks=c.aO(te,ze,y,b),Vi=te.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),ha=me&&Oe.hasTextData(),Xl=s.layout.get("icon-text-fit")!=="none"&&ha&&Oe.hasIconData();if(ue){const lr=_.style.map.terrain?(Hr,Wr)=>_.style.map.terrain.getElevation(Le,Hr,Wr):null,or=s.layout.get("text-rotation-alignment")==="map";Li(Oe,_,p,di,Ro,re,C,or,Le.toUnwrapped(),te.width,te.height,Ks,lr)}const da=p&&me||Xl,vs=ue||da?ch:re?di:_.transform.clipSpaceToPixelsMatrix,Xs=tt&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Rs;Rs=tt?Oe.iconsInText?na(pt.kind,pr,ve,re,ue,da,_,vs,ao,Ks,_r,ti,Ve):Cc(pt.kind,pr,ve,re,ue,da,_,vs,ao,Ks,p,_r,0,Ve):th(pt.kind,pr,ve,re,ue,da,_,vs,ao,Ks,p,_r,Ve);const Ds={program:Yn,buffers:ot,uniformValues:Rs,projectionData:Vi,atlasTexture:sr,atlasTextureIcon:Fr,atlasInterpolation:Ir,atlasInterpolationIcon:yr,isSDF:tt,hasHalo:Xs};if(le&&Oe.canOverlap){_e=!0;const lr=ot.segments.get();for(const or of lr)Ae.push({segments:new c.aX([or]),sortKey:or.sortKey,state:Ds,terrainData:ir})}else Ae.push({segments:ot.segments,sortKey:0,state:Ds,terrainData:ir})}_e&&Ae.sort(((Le,ze)=>Le.sortKey-ze.sortKey));for(const Le of Ae){const ze=Le.state;if(q.activeTexture.set(Z.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,Z.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(q.activeTexture.set(Z.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),ze.isSDF){const Oe=ze.uniformValues;ze.hasHalo&&(Oe.u_is_halo=1,Bc(ze.buffers,Le.segments,s,_,ze.program,Te,R,N,Oe,ze.projectionData,Le.terrainData)),Oe.u_is_halo=0}Bc(ze.buffers,Le.segments,s,_,ze.program,Te,R,N,ze.uniformValues,ze.projectionData,Le.terrainData)}}function Bc(_,t,s,u,p,y,b,I,A,C,R){const N=u.context;p.draw(N,N.gl.TRIANGLES,y,b,I,bn.backCCW,A,R,C,s.id,_.layoutVertexBuffer,_.indexBuffer,t,s.paint,u.transform.zoom,_.programConfigurations.get(s.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Yd(_,t,s,u,p){const y=_.context,b=y.gl,I=wn.disabled,A=new Gn([b.ONE,b.ONE],c.bp.transparent,[!0,!0,!0,!0]),C=t.getBucket(s);if(!C)return;const R=u.key;let N=s.heatmapFbos.get(R);N||(N=kl(y,t.tileSize,t.tileSize),s.heatmapFbos.set(R,N)),y.bindFramebuffer.set(N.framebuffer),y.viewport.set([0,0,t.tileSize,t.tileSize]),y.clear({color:c.bp.transparent});const F=C.programConfigurations.get(s.id),q=_.useProgram("heatmap",F,!p),Z=_.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),te=_.style.map.terrain.getTerrainData(u);q.draw(y,b.TRIANGLES,an.disabled,I,A,bn.disabled,La(t,_.transform.zoom,s.paint.get("heatmap-intensity"),1),te,Z,s.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,s.paint,_.transform.zoom,F)}function Qd(_,t,s,u,p){const y=_.context,b=y.gl,I=_.transform;y.setColorMode(_.colorModeForRenderPass());const A=Uc(y,t),C=s.key,R=t.heatmapFbos.get(C);if(!R)return;y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,R.colorAttachment.get()),y.activeTexture.set(b.TEXTURE1),A.bind(b.LINEAR,b.CLAMP_TO_EDGE);const N=I.getProjectionData({overscaledTileID:s,applyTerrainMatrix:p,applyGlobeMatrix:!u});_.useProgram("heatmapTexture").draw(y,b.TRIANGLES,an.disabled,wn.disabled,_.colorModeForRenderPass(),bn.disabled,Nd(_,t,0,1),null,N,t.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,t.paint,I.zoom),R.destroy(),t.heatmapFbos.delete(C)}function kl(_,t,s){var u,p;const y=_.gl,b=y.createTexture();y.bindTexture(y.TEXTURE_2D,b),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const I=(u=_.HALF_FLOAT)!==null&&u!==void 0?u:y.UNSIGNED_BYTE,A=(p=_.RGBA16F)!==null&&p!==void 0?p:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,A,t,s,0,y.RGBA,I,null);const C=_.createFramebuffer(t,s,!1,!1);return C.colorAttachment.set(b),C}function Uc(_,t){return t.colorRampTexture||(t.colorRampTexture=new c.T(_,t.colorRamp,_.gl.RGBA)),t.colorRampTexture}function Jd(_,t,s,u,p,y,b,I){let A=256;if(p.stepInterpolant){const C=t.getSource().maxzoom,R=b.canonical.z===C?Math.ceil(1<<_.transform.maxZoom-b.canonical.z):1;A=c.an(c.ce(y.maxLineLength/c.a5*1024*R),256,s.maxTextureSize)}return I.gradient=c.cf({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:A,image:I.gradient||void 0,clips:y.lineClipsArray}),I.texture?I.texture.update(I.gradient):I.texture=new c.T(s,I.gradient,u.RGBA),I.version=p.gradientVersion,I.texture}function ep(_,t,s,u,p){_.activeTexture.set(t.TEXTURE0),s.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),u.updatePaintBuffers(p)}function kr(_,t,s,u,p,y){(p||_.lineAtlas.dirty)&&(t.activeTexture.set(s.TEXTURE0),_.lineAtlas.bind(t)),u.updatePaintBuffers(y)}function oa(_,t,s,u,p,y,b){const I=y.gradients[p.id];let A=I.texture;p.gradientVersion!==I.version&&(A=Jd(_,t,s,u,p,y,b,I)),s.activeTexture.set(u.TEXTURE0),A.bind(p.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE)}function ts(_,t,s,u,p,y,b,I,A){const C=y.gradients[p.id];let R=C.texture;p.gradientVersion!==C.version&&(R=Jd(_,t,s,u,p,y,b,C)),s.activeTexture.set(u.TEXTURE0),R.bind(p.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE),s.activeTexture.set(u.TEXTURE1),_.lineAtlas.bind(s),I.updatePaintBuffers(A)}function jc(_,t,s,u,p){if(!s||!u||!u.imageAtlas)return;const y=u.imageAtlas.patternPositions;let b=y[s.to.toString()],I=y[s.from.toString()];if(!b&&I&&(b=I),!I&&b&&(I=b),!b||!I){const A=p.getPaintProperty(t);b=y[A],I=y[A]}b&&I&&_.setConstantPatternPositions(b,I)}function Rl(_,t,s,u,p,y,b,I){const A=_.context.gl,C="fill-pattern",R=s.paint.get(C),N=R&&R.constantOr(1),F=s.getCrossfadeParameters();let q,Z,te,ie,re;const ue=_.transform,ve=s.paint.get("fill-translate"),le=s.paint.get("fill-translate-anchor");b?(Z=N&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=A.LINES):(Z=N?"fillPattern":"fill",q=A.TRIANGLES);const _e=R.constantOr(null);for(const Te of u){const me=t.getTile(Te);if(N&&!me.patternsLoaded())continue;const Ae=me.getBucket(s);if(!Ae)continue;const Ve=Ae.programConfigurations.get(s.id),Le=_.useProgram(Z,Ve),ze=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Te);N&&(_.context.activeTexture.set(A.TEXTURE0),me.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Ve.updatePaintBuffers(F)),jc(Ve,C,_e,me,s);const Oe=ue.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),ot=c.aO(ue,me,ve,le);if(b){ie=Ae.indexBuffer2,re=Ae.segments2;const tt=[A.drawingBufferWidth,A.drawingBufferHeight];te=Z==="fillOutlinePattern"&&N?zd(_,F,me,tt,ot):Ld(tt,ot)}else ie=Ae.indexBuffer,re=Ae.segments,te=N?Xu(_,F,me,ot):{u_fill_translate:ot};const ct=_.stencilModeForClipping(Te);Le.draw(_.context,q,p,ct,y,bn.backCCW,te,ze,Oe,s.id,Ae.layoutVertexBuffer,ie,re,s.paint,_.transform.zoom,Ve)}}function $c(_,t,s,u,p,y,b,I){const A=_.context,C=A.gl,R="fill-extrusion-pattern",N=s.paint.get(R),F=N.constantOr(1),q=s.getCrossfadeParameters(),Z=s.paint.get("fill-extrusion-opacity"),te=N.constantOr(null),ie=_.transform;for(const re of u){const ue=t.getTile(re),ve=ue.getBucket(s);if(!ve)continue;const le=_.style.map.terrain&&_.style.map.terrain.getTerrainData(re),_e=ve.programConfigurations.get(s.id),Te=_.useProgram(F?"fillExtrusionPattern":"fillExtrusion",_e);F&&(_.context.activeTexture.set(C.TEXTURE0),ue.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),_e.updatePaintBuffers(q));const me=ie.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!I,applyTerrainMatrix:!0});jc(_e,R,te,ue,s);const Ae=c.aO(ie,ue,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ve=s.paint.get("fill-extrusion-vertical-gradient"),Le=F?Ku(_,Ve,Z,Ae,re,q,ue):Zu(_,Ve,Z,Ae);Te.draw(A,A.gl.TRIANGLES,p,y,b,bn.backCCW,Le,le,me,s.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,s.paint,_.transform.zoom,_e,_.style.map.terrain&&ve.centroidVertexBuffer)}}function Po(_,t,s,u,p,y,b,I,A){var C;const R=_.style.projection,N=_.context,F=_.transform,q=N.gl,Z=[`#define NUM_ILLUMINATION_SOURCES ${s.paint.get("hillshade-highlight-color").values.length}`],te=_.useProgram("hillshade",null,!1,Z),ie=!_.options.moving;for(const re of u){const ue=t.getTile(re),ve=ue.fbo;if(!ve)continue;const le=R.getMeshFromTileID(N,re.canonical,I,!0,"raster"),_e=(C=_.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(re);N.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,ve.colorAttachment.get());const Te=F.getProjectionData({overscaledTileID:re,aligned:ie,applyGlobeMatrix:!A,applyTerrainMatrix:!0});te.draw(N,q.TRIANGLES,y,p[re.overscaledZ],b,bn.backCCW,Sc(_,ue,s),_e,Te,s.id,le.vertexBuffer,le.indexBuffer,le.segments)}}function Dl(_,t,s,u,p,y,b,I,A){var C;const R=_.style.projection,N=_.context,F=_.transform,q=N.gl,Z=_.useProgram("colorRelief"),te=!_.options.moving;let ie=!0,re=0;for(const ue of u){const ve=t.getTile(ue),le=ve.dem;if(ie){const Le=q.getParameter(q.MAX_TEXTURE_SIZE),{elevationTexture:ze,colorTexture:Oe}=s.getColorRampTextures(N,Le,le.getUnpackVector());N.activeTexture.set(q.TEXTURE1),ze.bind(q.NEAREST,q.CLAMP_TO_EDGE),N.activeTexture.set(q.TEXTURE4),Oe.bind(q.LINEAR,q.CLAMP_TO_EDGE),ie=!1,re=ze.size[0]}if(!le||!le.data)continue;const _e=le.stride,Te=le.getPixels();if(N.activeTexture.set(q.TEXTURE0),N.pixelStoreUnpackPremultiplyAlpha.set(!1),ve.demTexture=ve.demTexture||_.getTileTexture(_e),ve.demTexture){const Le=ve.demTexture;Le.update(Te,{premultiply:!1}),Le.bind(q.LINEAR,q.CLAMP_TO_EDGE)}else ve.demTexture=new c.T(N,Te,q.RGBA,{premultiply:!1}),ve.demTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const me=R.getMeshFromTileID(N,ue.canonical,I,!0,"raster"),Ae=(C=_.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(ue),Ve=F.getProjectionData({overscaledTileID:ue,aligned:te,applyGlobeMatrix:!A,applyTerrainMatrix:!0});Z.draw(N,q.TRIANGLES,y,p[ue.overscaledZ],b,bn.backCCW,Vd(s,ve.dem,re),Ae,Ve,s.id,me.vertexBuffer,me.indexBuffer,me.segments)}}const aa=[new c.P(0,0),new c.P(c.a5,0),new c.P(c.a5,c.a5),new c.P(0,c.a5)];function Va(_,t,s,u,p,y,b,I,A=!1,C=!1){const R=u[u.length-1].overscaledZ,N=_.context,F=N.gl,q=_.useProgram("raster"),Z=_.transform,te=_.style.projection,ie=_.colorModeForRenderPass(),re=!_.options.moving,ue=s.paint.get("raster-opacity"),ve=s.paint.get("raster-resampling"),le=s.paint.get("raster-fade-duration"),_e=!!_.style.map.terrain;for(const Te of u){const me=_.getDepthModeForSublayer(Te.overscaledZ-R,ue===1?an.ReadWrite:an.ReadOnly,F.LESS),Ae=t.getTile(Te),Ve=ve==="nearest"?F.NEAREST:F.LINEAR;N.activeTexture.set(F.TEXTURE0),Ae.texture.bind(Ve,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),N.activeTexture.set(F.TEXTURE1);const{parentTile:Le,parentScaleBy:ze,parentTopLeft:Oe,fadeValues:ot}=tp(Ae,t,le,_e);Ae.fadeOpacity=ot.tileOpacity,Le?(Le.fadeOpacity=ot.parentTileOpacity,Le.texture.bind(Ve,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST)):Ae.texture.bind(Ve,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Ae.texture.useMipmap&&N.extTextureFilterAnisotropic&&_.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const ct=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Te),tt=Z.getProjectionData({overscaledTileID:Te,aligned:re,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),pt=Ju(Oe,ze,ot.fadeMix,s,I),sn=te.getMeshFromTileID(N,Te.canonical,y,b,"raster");q.draw(N,F.TRIANGLES,me,p?p[Te.overscaledZ]:wn.disabled,ie,A?bn.frontCCW:bn.backCCW,pt,ct,tt,s.id,sn.vertexBuffer,sn.indexBuffer,sn.segments)}}function tp(_,t,s,u){const p={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(s===0||u)return p;if(_.fadingParentID){const y=t.getLoadedTile(_.fadingParentID);if(!y)return p;const b=Math.pow(2,y.tileID.overscaledZ-_.tileID.overscaledZ),I=[_.tileID.canonical.x*b%1,_.tileID.canonical.y*b%1],A=(function(C,R,N){const F=Ce(),q=(F-R.timeAdded)/N,Z=C.fadingDirection===ke.Incoming,te=c.an((F-C.timeAdded)/N,0,1),ie=c.an(1-q,0,1),re=Z?te:ie;return{tileOpacity:re,parentTileOpacity:Z?ie:te,fadeMix:{opacity:1,mix:1-re}}})(_,y,s);return{parentTile:y,parentScaleBy:b,parentTopLeft:I,fadeValues:A}}if(_.selfFading){const y=(function(b,I){const A=(Ce()-b.timeAdded)/I,C=c.an(A,0,1);return{tileOpacity:C,fadeMix:{opacity:C,mix:0}}})(_,s);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:y}}return p}const np=new c.bp(1,0,0,1),rp=new c.bp(0,1,0,1),ip=new c.bp(0,0,1,1),sp=new c.bp(1,0,1,1),Co=new c.bp(0,1,1,1);function uh(_,t,s,u){Ll(_,0,t+s/2,_.transform.width,s,u)}function hh(_,t,s,u){Ll(_,t-s/2,0,s,_.transform.height,u)}function Ll(_,t,s,u,p,y){const b=_.context,I=b.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*_.pixelRatio,s*_.pixelRatio,u*_.pixelRatio,p*_.pixelRatio),b.clear({color:y}),I.disable(I.SCISSOR_TEST)}function op(_,t,s){const u=_.context,p=u.gl,y=_.useProgram("debug"),b=an.disabled,I=wn.disabled,A=_.colorModeForRenderPass(),C="$debug",R=_.style.map.terrain&&_.style.map.terrain.getTerrainData(s);u.activeTexture.set(p.TEXTURE0);const N=t.getTileByID(s.key).latestRawTileData,F=Math.floor((N&&N.byteLength||0)/1024),q=t.getTile(s).tileSize,Z=512/Math.min(q,512)*(s.overscaledZ/_.transform.zoom)*.5;let te=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(te+=` => ${s.overscaledZ}`),(function(re,ue){re.initDebugOverlayCanvas();const ve=re.debugOverlayCanvas,le=re.context.gl,_e=re.debugOverlayCanvas.getContext("2d");_e.clearRect(0,0,ve.width,ve.height),_e.shadowColor="white",_e.shadowBlur=2,_e.lineWidth=1.5,_e.strokeStyle="white",_e.textBaseline="top",_e.font="bold 36px Open Sans, sans-serif",_e.fillText(ue,5,5),_e.strokeText(ue,5,5),re.debugOverlayTexture.update(ve),re.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)})(_,`${te} ${F}kB`);const ie=_.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(u,p.TRIANGLES,b,I,Gn.alphaBlended,bn.disabled,Yu(c.bp.transparent,Z),null,ie,C,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),y.draw(u,p.LINE_STRIP,b,I,A,bn.disabled,Yu(c.bp.red),R,ie,C,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function dh(_,t,s,u){const{isRenderingGlobe:p}=u,y=_.context,b=y.gl,I=_.transform,A=_.colorModeForRenderPass(),C=_.getDepthModeFor3D(),R=_.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,_.width,_.height]);for(const N of s){const F=t.getTerrainMesh(N.tileID),q=_.renderToTexture.getTexture(N),Z=t.getTerrainData(N.tileID);y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,q.texture);const te=t.getMeshFrameDelta(I.zoom),ie=I.calculateFogMatrix(N.tileID.toUnwrapped()),re=Tl(te,ie,_.style.sky,I.pitch,p),ue=I.getProjectionData({overscaledTileID:N.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});R.draw(y,b.TRIANGLES,C,wn.disabled,A,bn.backCCW,re,Z,ue,"terrain",F.vertexBuffer,F.indexBuffer,F.segments)}}function ph(_,t){if(!t.mesh){const s=new c.aW;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const u=new c.aY;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),t.mesh=new Nn(_.createVertexBuffer(s,Ni.members),_.createIndexBuffer(u),c.aX.simpleSegment(0,0,s.length,u.length))}return t.mesh}class ap{constructor(t,s){this.context=new Vc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=mr.maxOverzooming+mr.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new vi}resize(t,s,u){if(this.width=Math.floor(t*u),this.height=Math.floor(s*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,s=new c.aW;s.emplaceBack(0,0),s.emplaceBack(c.a5,0),s.emplaceBack(0,c.a5),s.emplaceBack(c.a5,c.a5),this.tileExtentBuffer=t.createVertexBuffer(s,Ni.members),this.tileExtentSegments=c.aX.simpleSegment(0,0,4,2);const u=new c.aW;u.emplaceBack(0,0),u.emplaceBack(c.a5,0),u.emplaceBack(0,c.a5),u.emplaceBack(c.a5,c.a5),this.debugBuffer=t.createVertexBuffer(u,Ni.members),this.debugSegments=c.aX.simpleSegment(0,0,4,5);const p=new c.ch;p.emplaceBack(0,0,0,0),p.emplaceBack(c.a5,0,c.a5,0),p.emplaceBack(0,c.a5,0,c.a5),p.emplaceBack(c.a5,c.a5,c.a5,c.a5),this.rasterBoundsBuffer=t.createVertexBuffer(p,Zs.members),this.rasterBoundsSegments=c.aX.simpleSegment(0,0,4,2);const y=new c.aW;y.emplaceBack(0,0),y.emplaceBack(c.a5,0),y.emplaceBack(0,c.a5),y.emplaceBack(c.a5,c.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(y,Ni.members),this.rasterBoundsSegmentsPosOnly=c.aX.simpleSegment(0,0,4,5);const b=new c.aW;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(b,Ni.members),this.viewportSegments=c.aX.simpleSegment(0,0,4,2);const I=new c.ci;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(I);const A=new c.aY;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(A);const C=this.context.gl;this.stencilClearMode=new wn({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.tileExtentMesh=new Nn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=c.N();c.c7(u,0,this.width,this.height,0,0,1),c.Q(u,u,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const p={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(t,s.TRIANGLES,an.disabled,this.stencilClearMode,Gn.disabled,bn.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,u){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source,this.nextStencilID+s.length>256&&this.clearStencil();const p=this.context;p.setColorMode(Gn.disabled),p.setDepthMode(an.disabled);const y={};for(const b of s)y[b.key]=this.nextStencilID++;this._renderTileMasks(y,s,u,!0),this._renderTileMasks(y,s,u,!1),this._tileClippingMaskIDs=y}_renderTileMasks(t,s,u,p){const y=this.context,b=y.gl,I=this.style.projection,A=this.transform,C=this.useProgram("clippingMask");for(const R of s){const N=t[R.key],F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),q=I.getMeshFromTileID(this.context,R.canonical,p,!0,"stencil"),Z=A.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!u,applyTerrainMatrix:!0});C.draw(y,b.TRIANGLES,an.disabled,new wn({func:b.ALWAYS,mask:0},N,255,b.KEEP,b.KEEP,b.REPLACE),Gn.disabled,u?bn.disabled:bn.backCCW,null,F,Z,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}_renderTilesDepthBuffer(){const t=this.context,s=t.gl,u=this.style.projection,p=this.transform,y=this.useProgram("depth"),b=this.getDepthModeFor3D(),I=dt(p,{tileSize:p.tileSize});for(const A of I){const C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),R=u.getMeshFromTileID(this.context,A.canonical,!0,!0,"raster"),N=p.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(t,s.TRIANGLES,b,wn.disabled,Gn.disabled,bn.backCCW,null,C,N,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new wn({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new wn({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const s=this.context.gl,u=t.sort(((b,I)=>I.overscaledZ-b.overscaledZ)),p=u[u.length-1].overscaledZ,y=u[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let I=0;I<y;I++)b[I+p]=new wn({func:s.GEQUAL,mask:255},I+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[b,u]}return[{[p]:wn.disabled},u]}stencilConfigForOverlapTwoPass(t){const s=this.context.gl,u=t.sort(((b,I)=>I.overscaledZ-b.overscaledZ)),p=u[u.length-1].overscaledZ,y=u[0].overscaledZ-p+1;if(this.clearStencil(),y>1){const b={},I={};for(let A=0;A<y;A++)b[A+p]=new wn({func:s.GREATER,mask:255},y+1+A,255,s.KEEP,s.KEEP,s.REPLACE),I[A+p]=new wn({func:s.GREATER,mask:255},1+A,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*y+1,[b,I,u]}return this.nextStencilID=3,[{[p]:new wn({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[p]:new wn({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Gn([t.CONSTANT_COLOR,t.ONE],new c.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gn.unblended:Gn.alphaBlended}getDepthModeForSublayer(t,s,u){if(!this.opaquePassEnabledForLayer())return an.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new an(u||this.context.gl.LEQUAL,s,[p,p])}getDepthModeFor3D(){return new an(this.context.gl.LEQUAL,an.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){var u,p;this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(Ce()),this.imageManager.beginFrame();const y=this.style._order,b=this.style.tileManagers,I={},A={},C={},R={isRenderingToTexture:!1,isRenderingGlobe:((u=t.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const F in b){const q=b[F];q.used&&q.prepare(this.context),I[F]=q.getVisibleCoordinates(!1),A[F]=I[F].slice().reverse(),C[F]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<y.length;F++)if(this.style._layers[y[F]].is3D()){this.opaquePassCutoff=F;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const F of y){const q=this.style._layers[F];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const Z=A[q.source];(q.type==="custom"||Z.length)&&this.renderLayer(this,b[q.source],q,Z,R)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:F=>this.useProgram(F)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?c.bp.black:c.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(F,q){const Z=F.context,te=Z.gl,ie=((Te,me,Ae)=>{const Ve=Math.cos(me.rollInRadians),Le=Math.sin(me.rollInRadians),ze=kt(me),Oe=me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Te.properties.get("sky-color"),u_horizon_color:Te.properties.get("horizon-color"),u_horizon:[(me.width/2-ze*Le)*Ae,(me.height/2+ze*Ve)*Ae],u_horizon_normal:[-Le,Ve],u_sky_horizon_blend:Te.properties.get("sky-horizon-blend")*me.height/2*Ae,u_sky_blend:Oe}})(q,F.style.map.transform,F.pixelRatio),re=new an(te.LEQUAL,an.ReadWrite,[0,1]),ue=wn.disabled,ve=F.colorModeForRenderPass(),le=F.useProgram("sky"),_e=ph(Z,q);le.draw(Z,te.TRIANGLES,re,ue,ve,bn.disabled,ie,null,void 0,"sky",_e.vertexBuffer,_e.indexBuffer,_e.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[y[this.currentLayer]],q=b[F.source],Z=I[F.source];this._renderTileClippingMasks(F,Z,!1),this.renderLayer(this,q,F,Z,R)}this.renderPass="translucent";let N=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const F=this.style._layers[y[this.currentLayer]],q=b[F.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(F,R))continue;this.opaquePassEnabledForLayer()||N||(N=!0,R.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Z=(F.type==="symbol"?C:A)[F.source];this._renderTileClippingMasks(F,I[F.source],!!this.renderToTexture),this.renderLayer(this,q,F,Z,R)}if(R.isRenderingGlobe&&(function(F,q,Z){const te=F.context,ie=te.gl,re=F.useProgram("atmosphere"),ue=new an(ie.LEQUAL,an.ReadOnly,[0,1]),ve=F.transform,le=(function(Oe,ot){const ct=Oe.properties.get("position"),tt=[-ct.x,-ct.y,-ct.z],pt=c.ar(new Float64Array(16));return Oe.properties.get("anchor")==="map"&&(c.bg(pt,pt,ot.rollInRadians),c.bh(pt,pt,-ot.pitchInRadians),c.bg(pt,pt,ot.bearingInRadians),c.bh(pt,pt,ot.center.lat*Math.PI/180),c.bJ(pt,pt,-ot.center.lng*Math.PI/180)),c.cg(tt,tt,pt),tt})(Z,F.transform),_e=ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Te=q.properties.get("atmosphere-blend")*_e.projectionTransition;if(Te===0)return;const me=Hs(ve.worldSize,ve.center.lat),Ae=ve.inverseProjectionMatrix,Ve=new Float64Array(4);Ve[3]=1,c.aH(Ve,Ve,ve.modelViewProjectionMatrix),Ve[0]/=Ve[3],Ve[1]/=Ve[3],Ve[2]/=Ve[3],Ve[3]=1,c.aH(Ve,Ve,Ae),Ve[0]/=Ve[3],Ve[1]/=Ve[3],Ve[2]/=Ve[3],Ve[3]=1;const Le=((Oe,ot,ct,tt,pt)=>({u_sun_pos:Oe,u_atmosphere_blend:ot,u_globe_position:ct,u_globe_radius:tt,u_inv_proj_matrix:pt}))(le,Te,[Ve[0],Ve[1],Ve[2]],me,Ae),ze=ph(te,q);re.draw(te,ie.TRIANGLES,ue,wn.disabled,Gn.alphaBlended,bn.disabled,Le,null,null,"atmosphere",ze.vertexBuffer,ze.indexBuffer,ze.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const F=(function(q,Z){let te=null;const ie=Object.values(q._layers).flatMap((le=>le.source&&!le.isHidden(Z)?[q.tileManagers[le.source]]:[])),re=ie.filter((le=>le.getSource().type==="vector")),ue=ie.filter((le=>le.getSource().type!=="vector")),ve=le=>{(!te||te.getSource().maxzoom<le.getSource().maxzoom)&&(te=le)};return re.forEach((le=>ve(le))),te||ue.forEach((le=>ve(le))),te})(this.style,this.transform.zoom);F&&(function(q,Z,te){for(let ie=0;ie<te.length;ie++)op(q,Z,te[ie])})(this,F,F.getVisibleCoordinates())}this.options.showPadding&&(function(F){const q=F.transform.padding;uh(F,F.transform.height-(q.top||0),3,np),uh(F,q.bottom||0,3,rp),hh(F,q.left||0,3,ip),hh(F,F.transform.width-(q.right||0),3,sp);const Z=F.transform.centerPoint;(function(te,ie,re,ue){Ll(te,ie-1,re-10,2,20,ue),Ll(te,ie-10,re-1,20,2,ue)})(F,Z.x,F.transform.height-Z.y,Co)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=t?!c.cj(s,u):!c.ck(s,u)),p||(p=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(c.cl(s,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(y,b){const I=y.context,A=I.gl,C=y.transform,R=Gn.unblended,N=new an(A.LEQUAL,an.ReadWrite,[0,1]),F=b.tileManager.getRenderableTiles(),q=y.useProgram("terrainDepth");I.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),I.clear({color:c.bp.transparent,depth:1});for(const Z of F){const te=b.getTerrainMesh(Z.tileID),ie=b.getTerrainData(Z.tileID),re=C.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ue={u_ele_delta:b.getMeshFrameDelta(C.zoom)};q.draw(I,A.TRIANGLES,N,wn.disabled,R,bn.backCCW,ue,ie,re,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain),(function(y,b){const I=y.context,A=I.gl,C=y.transform,R=Gn.unblended,N=new an(A.LEQUAL,an.ReadWrite,[0,1]),F=b.getCoordsTexture(),q=b.tileManager.getRenderableTiles(),Z=y.useProgram("terrainCoords");I.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),I.clear({color:c.bp.transparent,depth:1}),b.coordsIndex=[];for(const te of q){const ie=b.getTerrainMesh(te.tileID),re=b.getTerrainData(te.tileID);I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,F.texture);const ue={u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(C.zoom)},ve=C.getProjectionData({overscaledTileID:te.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(I,A.TRIANGLES,N,wn.disabled,R,bn.backCCW,ue,re,ve,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments),b.coordsIndex.push(te.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain))}renderLayer(t,s,u,p,y){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(p||[]).length)&&(this.id=u.id,c.cm(u)?(function(b,I,A,C,R,N){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:F}=N,q=wn.disabled,Z=b.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(te,ie,re,ue,ve,le,_e,Te,me){const Ae=ie.transform,Ve=ie.style.map.terrain,Le=ve==="map",ze=le==="map";for(const Oe of te){const ot=ue.getTile(Oe),ct=ot.getBucket(re);if(!ct||!ct.text||!ct.text.segments.get().length)continue;const tt=c.ay(ct.textSizeData,Ae.zoom),pt=c.aN(ot,1,ie.transform.zoom),sn=Cr(Le,ie.transform,pt),Yn=re.layout.get("icon-text-fit")!=="none"&&ct.hasIconData();if(tt){const pr=Math.pow(2,Ae.zoom-ot.tileID.overscaledZ),ir=Ve?(_r,sr)=>Ve.getElevation(Oe,_r,sr):null;wm(ct,Le,ze,me,Ae,sn,pr,tt,Yn,c.aO(Ae,ot,_e,Te),Oe.toUnwrapped(),ir)}}})(C,b,A,I,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),R),A.paint.get("icon-opacity").constantOr(1)!==0&&Ml(b,I,A,C,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),q,Z,F),A.paint.get("text-opacity").constantOr(1)!==0&&Ml(b,I,A,C,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),q,Z,F),I.map.showCollisionBoxes&&(sa(b,I,A,C,!0),sa(b,I,A,C,!1))})(t,s,u,p,this.style.placement.variableOffsets,y):c.cn(u)?(function(b,I,A,C,R){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:N}=R,F=A.paint.get("circle-opacity"),q=A.paint.get("circle-stroke-width"),Z=A.paint.get("circle-stroke-opacity"),te=!A.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(q.constantOr(1)===0||Z.constantOr(1)===0))return;const ie=b.context,re=ie.gl,ue=b.transform,ve=b.getDepthModeForSublayer(0,an.ReadOnly),le=wn.disabled,_e=b.colorModeForRenderPass(),Te=[],me=ue.getCircleRadiusCorrection();for(let Ae=0;Ae<C.length;Ae++){const Ve=C[Ae],Le=I.getTile(Ve),ze=Le.getBucket(A);if(!ze)continue;const Oe=A.paint.get("circle-translate"),ot=A.paint.get("circle-translate-anchor"),ct=c.aO(ue,Le,Oe,ot),tt=ze.programConfigurations.get(A.id),pt=b.useProgram("circle",tt),sn=ze.layoutVertexBuffer,Yn=ze.indexBuffer,pr=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ve),ir={programConfiguration:tt,program:pt,layoutVertexBuffer:sn,indexBuffer:Yn,uniformValues:Od(b,Le,A,ct,me),terrainData:pr,projectionData:ue.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!N,applyTerrainMatrix:!0})};if(te){const _r=ze.segments.get();for(const sr of _r)Te.push({segments:new c.aX([sr]),sortKey:sr.sortKey,state:ir})}else Te.push({segments:ze.segments,sortKey:0,state:ir})}te&&Te.sort(((Ae,Ve)=>Ae.sortKey-Ve.sortKey));for(const Ae of Te){const{programConfiguration:Ve,program:Le,layoutVertexBuffer:ze,indexBuffer:Oe,uniformValues:ot,terrainData:ct,projectionData:tt}=Ae.state;Le.draw(ie,re.TRIANGLES,ve,le,_e,bn.backCCW,ot,ct,tt,A.id,ze,Oe,Ae.segments,A.paint,b.transform.zoom,Ve)}})(t,s,u,p,y):c.co(u)?(function(b,I,A,C,R){if(A.paint.get("heatmap-opacity")===0)return;const N=b.context,{isRenderingToTexture:F,isRenderingGlobe:q}=R;if(b.style.map.terrain){for(const Z of C){const te=I.getTile(Z);I.hasRenderableParent(Z)||(b.renderPass==="offscreen"?Yd(b,te,A,Z,q):b.renderPass==="translucent"&&Qd(b,A,Z,F,q))}N.viewport.set([0,0,b.width,b.height])}else b.renderPass==="offscreen"?(function(Z,te,ie,re){const ue=Z.context,ve=ue.gl,le=Z.transform,_e=wn.disabled,Te=new Gn([ve.ONE,ve.ONE],c.bp.transparent,[!0,!0,!0,!0]);(function(me,Ae,Ve){const Le=me.gl;me.activeTexture.set(Le.TEXTURE1),me.viewport.set([0,0,Ae.width/4,Ae.height/4]);let ze=Ve.heatmapFbos.get(c.cd);ze?(Le.bindTexture(Le.TEXTURE_2D,ze.colorAttachment.get()),me.bindFramebuffer.set(ze.framebuffer)):(ze=kl(me,Ae.width/4,Ae.height/4),Ve.heatmapFbos.set(c.cd,ze))})(ue,Z,ie),ue.clear({color:c.bp.transparent});for(let me=0;me<re.length;me++){const Ae=re[me];if(te.hasRenderableParent(Ae))continue;const Ve=te.getTile(Ae),Le=Ve.getBucket(ie);if(!Le)continue;const ze=Le.programConfigurations.get(ie.id),Oe=Z.useProgram("heatmap",ze),ot=le.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ct=le.getCircleRadiusCorrection();Oe.draw(ue,ve.TRIANGLES,an.disabled,_e,Te,bn.backCCW,La(Ve,le.zoom,ie.paint.get("heatmap-intensity"),ct),null,ot,ie.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,ie.paint,le.zoom,ze)}ue.viewport.set([0,0,Z.width,Z.height])})(b,I,A,C):b.renderPass==="translucent"&&(function(Z,te){const ie=Z.context,re=ie.gl;ie.setColorMode(Z.colorModeForRenderPass());const ue=te.heatmapFbos.get(c.cd);ue&&(ie.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,ue.colorAttachment.get()),ie.activeTexture.set(re.TEXTURE1),Uc(ie,te).bind(re.LINEAR,re.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(ie,re.TRIANGLES,an.disabled,wn.disabled,Z.colorModeForRenderPass(),bn.disabled,Nd(Z,te,0,1),null,null,te.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,te.paint,Z.transform.zoom))})(b,A)})(t,s,u,p,y):c.cp(u)?(function(b,I,A,C,R){if(b.renderPass!=="translucent")return;const{isRenderingToTexture:N}=R,F=A.paint.get("line-opacity"),q=A.paint.get("line-width");if(F.constantOr(1)===0||q.constantOr(1)===0)return;const Z=b.getDepthModeForSublayer(0,an.ReadOnly),te=b.colorModeForRenderPass(),ie=A.paint.get("line-dasharray"),re=ie.constantOr(1),ue=A.paint.get("line-pattern"),ve=ue.constantOr(1),le=A.paint.get("line-gradient"),_e=A.getCrossfadeParameters();let Te;Te=ve?"linePattern":re&&le?"lineGradientSDF":re?"lineSDF":le?"lineGradient":"line";const me=b.context,Ae=me.gl,Ve=b.transform;let Le=!0;for(const ze of C){const Oe=I.getTile(ze);if(ve&&!Oe.patternsLoaded())continue;const ot=Oe.getBucket(A);if(!ot)continue;const ct=ot.programConfigurations.get(A.id),tt=b.context.program.get(),pt=b.useProgram(Te,ct),sn=Le||pt.program!==tt,Yn=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ze),pr=ue.constantOr(null),ir=ie&&ie.constantOr(null);if(pr&&Oe.imageAtlas){const ti=Oe.imageAtlas,Fr=ti.patternPositions[pr.to.toString()],Dr=ti.patternPositions[pr.from.toString()];Fr&&Dr&&ct.setConstantPatternPositions(Fr,Dr)}else if(ir){const ti=A.layout.get("line-cap")==="round",Fr=b.lineAtlas.getDash(ir.to,ti),Dr=b.lineAtlas.getDash(ir.from,ti);ct.setConstantDashPositions(Fr,Dr)}const _r=Ve.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),sr=Ve.getPixelScale();let Ir;ve?(Ir=Qu(b,Oe,A,sr,_e),ep(me,Ae,Oe,ct,_e)):re&&le?(Ir=Ac(b,Oe,A,sr,_e,ot.lineClipsArray.length),ts(b,I,me,Ae,A,ot,ze,ct,_e)):re?(Ir=Ud(b,Oe,A,sr,_e),kr(b,me,Ae,ct,sn,_e)):le?(Ir=Bd(b,Oe,A,sr,ot.lineClipsArray.length),oa(b,I,me,Ae,A,ot,ze)):Ir=El(b,Oe,A,sr);const yr=b.stencilModeForClipping(ze);pt.draw(me,Ae.TRIANGLES,Z,yr,te,bn.disabled,Ir,Yn,_r,A.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,A.paint,b.transform.zoom,ct,ot.layoutVertexBuffer2),Le=!1}})(t,s,u,p,y):c.cq(u)?(function(b,I,A,C,R){const N=A.paint.get("fill-color"),F=A.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const{isRenderingToTexture:q}=R,Z=b.colorModeForRenderPass(),te=A.paint.get("fill-pattern"),ie=b.opaquePassEnabledForLayer()&&!te.constantOr(1)&&N.constantOr(c.bp.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===ie){const re=b.getDepthModeForSublayer(1,b.renderPass==="opaque"?an.ReadWrite:an.ReadOnly);Rl(b,I,A,C,re,Z,!1,q)}if(b.renderPass==="translucent"&&A.paint.get("fill-antialias")){const re=b.getDepthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,an.ReadOnly);Rl(b,I,A,C,re,Z,!0,q)}})(t,s,u,p,y):c.cr(u)?(function(b,I,A,C,R){const N=A.paint.get("fill-extrusion-opacity");if(N===0)return;const{isRenderingToTexture:F}=R;if(b.renderPass==="translucent"){const q=new an(b.context.gl.LEQUAL,an.ReadWrite,b.depthRangeFor3D);if(N!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))$c(b,I,A,C,q,wn.disabled,Gn.disabled,F),$c(b,I,A,C,q,b.stencilModeFor3D(),b.colorModeForRenderPass(),F);else{const Z=b.colorModeForRenderPass();$c(b,I,A,C,q,wn.disabled,Z,F)}}})(t,s,u,p,y):c.cs(u)?(function(b,I,A,C,R){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const{isRenderingToTexture:N}=R,F=b.context,q=b.style.projection.useSubdivision,Z=b.getDepthModeForSublayer(0,an.ReadOnly),te=b.colorModeForRenderPass();if(b.renderPass==="offscreen")(function(ie,re,ue,ve,le,_e,Te){const me=ie.context,Ae=me.gl;for(const Ve of ue){const Le=re.getTile(Ve),ze=Le.dem;if(!ze||!ze.data||!Le.needsHillshadePrepare)continue;const Oe=ze.dim,ot=ze.stride,ct=ze.getPixels();if(me.activeTexture.set(Ae.TEXTURE1),me.pixelStoreUnpackPremultiplyAlpha.set(!1),Le.demTexture=Le.demTexture||ie.getTileTexture(ot),Le.demTexture){const pt=Le.demTexture;pt.update(ct,{premultiply:!1}),pt.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE)}else Le.demTexture=new c.T(me,ct,Ae.RGBA,{premultiply:!1}),Le.demTexture.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);me.activeTexture.set(Ae.TEXTURE0);let tt=Le.fbo;if(!tt){const pt=new c.T(me,{width:Oe,height:Oe,data:null},Ae.RGBA);pt.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),tt=Le.fbo=me.createFramebuffer(Oe,Oe,!0,!1),tt.colorAttachment.set(pt.texture)}me.bindFramebuffer.set(tt.framebuffer),me.viewport.set([0,0,Oe,Oe]),ie.useProgram("hillshadePrepare").draw(me,Ae.TRIANGLES,le,_e,Te,bn.disabled,hm(Le.tileID,ze),null,null,ve.id,ie.rasterBoundsBuffer,ie.quadTriangleIndexBuffer,ie.rasterBoundsSegments),Le.needsHillshadePrepare=!1}})(b,I,C,A,Z,wn.disabled,te),F.viewport.set([0,0,b.width,b.height]);else if(b.renderPass==="translucent")if(q){const[ie,re,ue]=b.stencilConfigForOverlapTwoPass(C);Po(b,I,A,ue,ie,Z,te,!1,N),Po(b,I,A,ue,re,Z,te,!0,N)}else{const[ie,re]=b.getStencilConfigForOverlapAndUpdateStencilID(C);Po(b,I,A,re,ie,Z,te,!1,N)}})(t,s,u,p,y):c.ct(u)?(function(b,I,A,C,R){if(b.renderPass!=="translucent"||!C.length)return;const{isRenderingToTexture:N}=R,F=b.style.projection.useSubdivision,q=b.getDepthModeForSublayer(0,an.ReadOnly),Z=b.colorModeForRenderPass();if(F){const[te,ie,re]=b.stencilConfigForOverlapTwoPass(C);Dl(b,I,A,re,te,q,Z,!1,N),Dl(b,I,A,re,ie,q,Z,!0,N)}else{const[te,ie]=b.getStencilConfigForOverlapAndUpdateStencilID(C);Dl(b,I,A,ie,te,q,Z,!1,N)}})(t,s,u,p,y):c.bU(u)?(function(b,I,A,C,R){if(b.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!C.length)return;const{isRenderingToTexture:N}=R,F=I.getSource(),q=b.style.projection.useSubdivision;if(F instanceof Xt)Va(b,I,A,C,null,!1,!1,F.tileCoords,F.flippedWindingOrder,N);else if(q){const[Z,te,ie]=b.stencilConfigForOverlapTwoPass(C);Va(b,I,A,ie,Z,!1,!0,aa,!1,N),Va(b,I,A,ie,te,!0,!0,aa,!1,N)}else{const[Z,te]=b.getStencilConfigForOverlapAndUpdateStencilID(C);Va(b,I,A,te,Z,!1,!0,aa,!1,N)}})(t,s,u,p,y):c.cu(u)?(function(b,I,A,C,R){const N=A.paint.get("background-color"),F=A.paint.get("background-opacity");if(F===0)return;const{isRenderingToTexture:q}=R,Z=b.context,te=Z.gl,ie=b.style.projection,re=b.transform,ue=re.tileSize,ve=A.paint.get("background-pattern");if(b.isPatternMissing(ve))return;const le=!ve&&N.a===1&&F===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==le)return;const _e=wn.disabled,Te=b.getDepthModeForSublayer(0,le==="opaque"?an.ReadWrite:an.ReadOnly),me=b.colorModeForRenderPass(),Ae=b.useProgram(ve?"backgroundPattern":"background"),Ve=C||dt(re,{tileSize:ue,terrain:b.style.map.terrain});ve&&(Z.activeTexture.set(te.TEXTURE0),b.imageManager.bind(b.context));const Le=A.getCrossfadeParameters();for(const ze of Ve){const Oe=re.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),ot=ve?pm(F,b,ve,{tileID:ze,tileSize:ue},Le):nh(F,N),ct=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ze),tt=ie.getMeshFromTileID(Z,ze.canonical,!1,!0,"raster");Ae.draw(Z,te.TRIANGLES,Te,_e,me,bn.backCCW,ot,ct,Oe,A.id,tt.vertexBuffer,tt.indexBuffer,tt.segments)}})(t,0,u,p,y):c.cv(u)&&(function(b,I,A,C){const{isRenderingGlobe:R}=C,N=b.context,F=A.implementation,q=b.style.projection,Z=b.transform,te=Z.getProjectionDataForCustomLayer(R),ie={farZ:Z.farZ,nearZ:Z.nearZ,fov:Z.fov*Math.PI/180,modelViewProjectionMatrix:Z.modelViewProjectionMatrix,projectionMatrix:Z.projectionMatrix,shaderData:{variantName:q.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${q.shaderPreludeCode.vertexSource}`,define:q.shaderDefine},defaultProjectionData:te},re=F.renderingMode?F.renderingMode:"2d";if(b.renderPass==="offscreen"){const ue=F.prerender;ue&&(b.setCustomLayerDefaults(),N.setColorMode(b.colorModeForRenderPass()),ue.call(F,N.gl,ie),N.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),N.setColorMode(b.colorModeForRenderPass()),N.setStencilMode(wn.disabled);const ue=re==="3d"?b.getDepthModeFor3D():b.getDepthModeForSublayer(0,an.ReadOnly);N.setDepthMode(ue),F.render(N.gl,ie),N.setDirty(),b.setBaseState(),N.bindFramebuffer.set(null)}})(t,0,u,y))}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!s||!u}useProgram(t,s,u=!1,p=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,b=this.style.projection,I=u?er.projectionMercator:b.shaderPreludeCode,A=u?Qr:b.shaderDefine,C=t+(s?s.cacheKey:"")+`/${u?ui:b.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[C]||(this.cache[C]=new Rd(this.context,er[t],s,fm[t],this._showOverdrawInspector,y,I,A,p)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,s;if(this._tileTextures){for(const u in this._tileTextures){const p=this._tileTextures[u];if(p)for(const y of p)y.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((s=this.tileExtentMesh.indexBuffer)===null||s===void 0||s.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const u in this.cache){const p=this.cache[u];p&&p.program&&this.context.gl.deleteProgram(p.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}function fh(_,t){let s,u=!1,p=null,y=null;const b=()=>{p=null,u&&(_.apply(y,s),p=setTimeout(b,t),u=!1)};return(...I)=>(u=!0,y=this,s=I,p||b(),p)}class mh{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(u=p)})),(u&&u[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const u=s.join("/");let p=u;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${u}`);let y=window.location.hash.replace(p,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let b=window.location.href.replace(/(#.+)?$/,y);b=b.replace("&&","&"),window.history.replaceState(window.history.state,null,b)},this._updateHash=fh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const s=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),b=Math.round(s.lng*y)/y,I=Math.round(s.lat*y)/y,A=this._map.getBearing(),C=this._map.getPitch();let R="";if(R+=t?`/${b}/${I}/${u}`:`${u}/${I}/${b}`,(A||C)&&(R+="/"+Math.round(10*A)/10),C&&(R+=`/${Math.round(C)}`),this._hashName){const N=this._hashName;let F=!1;const q=window.location.hash.slice(1).split("&").map((Z=>{const te=Z.split("=")[0];return te===N?(F=!0,`${te}=${R}`):Z})).filter((Z=>Z));return F||q.push(`${N}=${R}`),`#${q.join("&")}`}return`#${R}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new c.V(+t[2],+t[1])}catch{return!1}const s=+t[0],u=+(t[3]||0),p=+(t[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&u>=-180&&u<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const Mo={linearity:.3,easing:c.cw(0,0,.3,1)},lp=c.e({deceleration:2500,maxSpeed:1400},Mo),_s=c.e({deceleration:20,maxSpeed:1400},Mo),Ps=c.e({deceleration:1e3,maxSpeed:360},Mo),cp=c.e({deceleration:1e3,maxSpeed:90},Mo),Cs=c.e({deceleration:1e3,maxSpeed:360},Mo);class Tm{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ce(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=Ce();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,s.roll+=y.rollDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const y=Ol(s.pan.mag(),u,c.e({},lp,t||{})),b=s.pan.mult(y.amount/s.pan.mag()),I=this._map.cameraHelper.handlePanInertia(b,this._map.transform);p.center=I.easingCenter,p.offset=I.easingOffset,zl(p,y)}if(s.zoom){const y=Ol(s.zoom,u,_s);p.zoom=this._map.transform.zoom+y.amount,zl(p,y)}if(s.bearing){const y=Ol(s.bearing,u,Ps);p.bearing=this._map.transform.bearing+c.an(y.amount,-179,179),zl(p,y)}if(s.pitch){const y=Ol(s.pitch,u,cp);p.pitch=this._map.transform.pitch+y.amount,zl(p,y)}if(s.roll){const y=Ol(s.roll,u,Cs);p.roll=this._map.transform.roll+c.an(y.amount,-179,179),zl(p,y)}if(p.zoom||p.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),c.e(p,{noMoveStart:!0})}}function zl(_,t){(!_.duration||_.duration<t.duration)&&(_.duration=t.duration,_.easing=t.easing)}function Ol(_,t,s){const{maxSpeed:u,linearity:p,deceleration:y}=s,b=c.an(_*p/(t/1e3),-u,u),I=Math.abs(b)/(y*p);return{easing:s.easing,duration:1e3*I,amount:b*(I/2)}}class ei extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u,p={}){u=u instanceof MouseEvent?u:new MouseEvent(t,u);const y=J.mousePos(s.getCanvas(),u),b=s.unproject(y);super(t,c.e({point:y,lngLat:b,originalEvent:u},p)),this._defaultPrevented=!1,this.target=s}}class Fl extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u){const p=t==="touchend"?u.changedTouches:u.touches,y=J.touchPos(s.getCanvasContainer(),p),b=y.map((A=>s.unproject(A))),I=y.reduce(((A,C,R,N)=>A.add(C.div(N.length))),new c.P(0,0));super(t,{points:y,point:I,lngLats:b,lngLat:s.unproject(I),originalEvent:u}),this._defaultPrevented=!1}}class up extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class Em{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new up(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new ei(t.type,this._map,t))}mouseup(t){this._map.fire(new ei(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new ei(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ei(t.type,this._map,t))}mouseover(t){this._map.fire(new ei(t.type,this._map,t))}mouseout(t){this._map.fire(new ei(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Fl(t.type,this._map,t))}touchmove(t){this._map.fire(new Fl(t.type,this._map,t))}touchend(t){this._map.fire(new Fl(t.type,this._map,t))}touchcancel(t){this._map.fire(new Fl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Im{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ei(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ei("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new ei(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ba{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(c.P.convert(t),this._map.terrain)}}class Ua{constructor(t,s){this._map=t,this._tr=new Ba(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(J.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const u=s;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=u,this._box||(this._box=J.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(p.x,u.x),b=Math.max(p.x,u.x),I=Math.min(p.y,u.y),A=Math.max(p.y,u.y);J.setTransform(this._box,`translate(${y}px,${I}px)`),this._box.style.width=b-y+"px",this._box.style.height=A-I+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const u=this._startPos,p=s;if(this.reset(),J.suppressClick(),u.x!==p.x||u.y!==p.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(u,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(J.remove(this._box),this._box=null),J.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new c.l(t,{originalEvent:s}))}}function Ms(_,t){if(_.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${t.length}`);const s={};for(let u=0;u<_.length;u++)s[_[u].identifier]=t[u];return s}class bt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=(function(p){const y=new c.P(0,0);for(const b of p)y._add(b);return y.div(p.length)})(s),this.touches=Ms(u,s)))}touchmove(t,s,u){if(this.aborted||!this.centroid)return;const p=Ms(u,s);for(const y in this.touches){const b=p[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,s,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class qc{constructor(t){this.singleTap=new bt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,u){this.singleTap.touchstart(t,s,u)}touchmove(t,s,u){this.singleTap.touchmove(t,s,u)}touchend(t,s,u){const p=this.singleTap.touchend(t,s,u);if(p){const y=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(p)<30;if(y&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class gh{constructor(t){this._tr=new Ba(t),this._zoomIn=new qc({numTouches:1,numTaps:2}),this._zoomOut=new qc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,u){this._zoomIn.touchstart(t,s,u),this._zoomOut.touchstart(t,s,u)}touchmove(t,s,u){this._zoomIn.touchmove(t,s,u),this._zoomOut.touchmove(t,s,u)}touchend(t,s,u){const p=this._zoomIn.touchend(t,s,u),y=this._zoomOut.touchend(t,s,u),b=this._tr;return p?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(p)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ja{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const p=Array.isArray(s)?s[0]:s;return!this._moved&&p.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(u,p))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&J.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Nl=0,Vl=2,_h={[Nl]:1,[Vl]:2};class Bl{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=J.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(s,u){const p=_h[u];return s.buttons===void 0||(s.buttons&p)!==p})(t,this._eventButton)}isValidEndEvent(t){return J.mouseButton(t)===this._eventButton}}class yh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class hp{constructor(t=new Bl({checkCorrectEvent:()=>!0}),s=new yh){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(t,s,u){return t instanceof MouseEvent?s(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?u(t):void 0}startMove(t){this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.startMove(s)),(s=>this.oneFingerTouchMoveStateManager.startMove(s)))}endMove(t){this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.endMove(s)),(s=>this.oneFingerTouchMoveStateManager.endMove(s)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidStartEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidMoveEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(s=>this.mouseMoveStateManager.isValidEndEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s)))}}const $a=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=t=>{t.preventDefault()}};class Sm{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,s,u){return this._calculateTransform(t,s,u)}touchmove(t,s,u){if(this._active){if(!this._shouldBePrevented(u.length))return t.preventDefault(),this._calculateTransform(t,s,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,s,u){this._calculateTransform(t,s,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,u){u.length>0&&(this._active=!0);const p=Ms(u,s),y=new c.P(0,0),b=new c.P(0,0);let I=0;for(const C in p){const R=p[C],N=this._touches[C];N&&(y._add(R),b._add(R.sub(N)),I++,p[C]=R)}if(this._touches=p,this._shouldBePrevented(I)||!b.mag())return;const A=b.div(I);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(I),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,u){if(!this._firstTwoTouches)return;t.preventDefault();const[p,y]=this._firstTwoTouches,b=Hc(u,s,p),I=Hc(u,s,y);if(!b||!I)return;const A=this._aroundCenter?null:b.add(I).div(2);return this._move([b,I],A,t)}touchend(t,s,u){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,b=Hc(u,s,p),I=Hc(u,s,y);b&&I||(this._active&&J.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Hc(_,t,s){for(let u=0;u<_.length;u++)if(_[u].identifier===s)return t[u]}function dp(_,t){return Math.log(_/t)/Math.LN2}class vh extends Gc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(dp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:dp(this._distance,u),pinchAround:s}}}function pp(_,t){return 180*_.angleWith(t)/Math.PI}class xh extends Gc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,u){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pp(this._vector,p),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,u=pp(t,this._startVector);return Math.abs(u)<s}}function bh(_){return Math.abs(_.y)>Math.abs(_.x)}class fp extends Gc{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,u){super.touchstart(t,s,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,bh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),y=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,y=s.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const b=t.y>0==s.y>0;return bh(t)&&bh(s)&&b}}const ko={panStep:100,bearingStep:15,pitchStep:10};class tr{constructor(t){this._tr=new Ba(t);const s=ko;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,u=0,p=0,y=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:I=>{const A=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:Am,zoom:s?Math.round(A.zoom)+s*(t.shiftKey?2:1):A.zoom,bearing:A.bearing+u*this._bearingStep,pitch:A.pitch+p*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:A.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Am(_){return _*(2-_)}const Ul=4.000244140625,Wc=1/450;class Zc{constructor(t,s){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new Ba(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Wc}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=Ce(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%Ul==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=J.mousePos(this._map.getCanvas(),t),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(c.V.convert(u.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const I=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=I),typeof this._targetZoom=="number"&&(this._targetZoom+=I)}if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Ul?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&A!==0&&(A=1/A);const C=typeof this._targetZoom!="number"?t.scale:c.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),c.at(C*A)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,u=this._startZoom,p=this._easing;let y,b=!1;if(this._type==="wheel"&&u&&p){const I=Ce()-this._lastWheelEventTime,A=Math.min((I+5)/200,1),C=p(A);y=c.G.number(u,s,C),A<1?this._frameId||(this._frameId=!0):b=!0}else y=s,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!b,zoomDelta:y-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=c.cy;if(this._prevEase){const u=this._prevEase,p=(Ce()-u.start)/u.duration,y=u.easing(p+.01)-u.easing(p),b=.27/Math.sqrt(y*y+1e-4)*.01,I=Math.sqrt(.0729-b*b);s=c.cw(b,I,.25,1)}return this._prevEase={start:Ce(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class wh{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class mp{constructor(t){this._tr=new Ba(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gp{constructor(){this._tap=new qc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,u){if(!this._swipePoint)if(this._tapTime){const p=s[0],y=t.timeStamp-this._tapTime<500,b=this._tapPoint.dist(p)<30;y&&b?u.length>0&&(this._swipePoint=p,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,s,u)}touchmove(t,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=s[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,s,u)}touchend(t,s,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const p=this._tap.touchend(t,s,u);p&&(this._tapTime=t.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _p{constructor(t,s,u){this._el=t,this._mousePan=s,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ks{constructor(t,s,u,p){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=s,this._mousePitch=u,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class jl{constructor(t,s,u,p){this._el=t,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Pt{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=J.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=s,this._container.appendChild(p);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=u,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(J.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,s){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:t,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Bt=_=>_.zoom||_.drag||_.roll||_.pitch||_.rotate;class $l extends c.l{}function Kc(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta||_.rollDelta}class Xc{constructor(t,s){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=p.type==="renderFrame"?void 0:p,I={needsRenderFrame:!1},A={},C={};for(const{handlerName:F,handler:q,allowed:Z}of this._handlers){if(!q.isEnabled())continue;let te;if(this._blockedByActive(C,Z,F))q.reset();else if(q[y||p.type]){if(c.cz(p,y||p.type)){const ie=J.mousePos(this._map.getCanvas(),p);te=q[y||p.type](p,ie)}else if(c.cA(p,y||p.type)){const ie=this._getMapTouches(p.touches),re=J.touchPos(this._map.getCanvas(),ie);te=q[y||p.type](p,re,ie)}else c.cB(y||p.type)||(te=q[y||p.type](p));this.mergeHandlerResult(I,A,te,F,b),te&&te.needsRenderFrame&&this._triggerRenderFrame()}(te||q.isActive())&&(C[F]=q)}const R={};for(const F in this._previousActiveHandlers)C[F]||(R[F]=b);this._previousActiveHandlers=C,(Object.keys(R).length||Kc(I))&&(this._changes.push([I,A,R]),this._triggerRenderFrame()),(Object.keys(C).length||Kc(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=I;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tm(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,b]of this._listeners)J.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[t,s,u]of this._listeners)J.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new Em(s,t));const p=s.boxZoom=new Ua(s,t);this._add("boxZoom",p),t.interactive&&t.boxZoom&&p.enable();const y=s.cooperativeGestures=new Pt(s,t.cooperativeGestures);this._add("cooperativeGestures",y),t.cooperativeGestures&&y.enable();const b=new gh(s),I=new mp(s);s.doubleClickZoom=new wh(I,b),this._add("tapZoom",b),this._add("clickZoom",I),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const A=new gp;this._add("tapDragZoom",A);const C=s.touchPitch=new fp(s);this._add("touchPitch",C),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const R=()=>s.project(s.getCenter()),N=(function({enable:le,clickTolerance:_e,aroundCenter:Te=!0,minPixelCenterThreshold:me=100,rotateDegreesPerPixelMoved:Ae=.8},Ve){const Le=new Bl({checkCorrectEvent:ze=>J.mouseButton(ze)===0&&ze.ctrlKey||J.mouseButton(ze)===2&&!ze.ctrlKey});return new ja({clickTolerance:_e,move:(ze,Oe)=>{const ot=Ve();if(Te&&Math.abs(ot.y-ze.y)>me)return{bearingDelta:c.cx(new c.P(ze.x,Oe.y),Oe,ot)};let ct=(Oe.x-ze.x)*Ae;return Te&&Oe.y<ot.y&&(ct=-ct),{bearingDelta:ct}},moveStateManager:Le,enable:le,assignEvents:$a})})(t,R),F=(function({enable:le,clickTolerance:_e,pitchDegreesPerPixelMoved:Te=-.5}){const me=new Bl({checkCorrectEvent:Ae=>J.mouseButton(Ae)===0&&Ae.ctrlKey||J.mouseButton(Ae)===2});return new ja({clickTolerance:_e,move:(Ae,Ve)=>({pitchDelta:(Ve.y-Ae.y)*Te}),moveStateManager:me,enable:le,assignEvents:$a})})(t),q=(function({enable:le,clickTolerance:_e,rollDegreesPerPixelMoved:Te=.3},me){const Ae=new Bl({checkCorrectEvent:Ve=>J.mouseButton(Ve)===2&&Ve.ctrlKey});return new ja({clickTolerance:_e,move:(Ve,Le)=>{const ze=me();let Oe=(Le.x-Ve.x)*Te;return Le.y<ze.y&&(Oe=-Oe),{rollDelta:Oe}},moveStateManager:Ae,enable:le,assignEvents:$a})})(t,R);s.dragRotate=new ks(t,N,F,q),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",F,["mouseRotate","mouseRoll"]),this._add("mouseRoll",q,["mousePitch"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const Z=(function({enable:le,clickTolerance:_e}){const Te=new Bl({checkCorrectEvent:me=>J.mouseButton(me)===0&&!me.ctrlKey});return new ja({clickTolerance:_e,move:(me,Ae)=>({around:Ae,panDelta:Ae.sub(me)}),activateOnStart:!0,moveStateManager:Te,enable:le,assignEvents:$a})})(t),te=new Sm(t,s);s.dragPan=new _p(u,Z,te),this._add("mousePan",Z),this._add("touchPan",te,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const ie=new xh,re=new vh;s.touchZoomRotate=new jl(u,re,ie,A),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Im(s));const ue=s.scrollZoom=new Zc(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ue,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const ve=s.keyboard=new tr(s);this._add("keyboard",ve),t.interactive&&t.keyboard&&s.keyboard.enable()}_add(t,s,u){this._handlers.push({handlerName:t,handler:s,allowed:u}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,u){for(const p in t)if(p!==u&&(!s||s.indexOf(p)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const u of t)this._el.contains(u.target)&&s.push(u);return s}mergeHandlerResult(t,s,u,p,y){if(!u)return;c.e(t,u);const b={handlerName:p,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(s.zoom=b),u.panDelta!==void 0&&(s.drag=b),u.rollDelta!==void 0&&(s.roll=b),u.pitchDelta!==void 0&&(s.pitch=b),u.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const t={},s={},u={};for(const[p,y,b]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new c.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(t.rollDelta=(t.rollDelta||0)+p.rollDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),c.e(s,y),c.e(u,b);this._updateMapTransform(t,s,u),this._changes=[]}_updateMapTransform(t,s,u){const p=this._map,y=p._getTransformForUpdate(),b=p.terrain;if(!(Kc(t)||b&&this._terrainMovement))return this._fireEvents(s,u,!0);p._stop(!0);let{panDelta:I,zoomDelta:A,bearingDelta:C,pitchDelta:R,rollDelta:N,around:F,pinchAround:q}=t;q!==void 0&&(F=q),F=F||p.transform.centerPoint,b&&!y.isPointOnMapSurface(F)&&(F=y.centerPoint);const Z={panDelta:I,zoomDelta:A,rollDelta:N,pitchDelta:R,bearingDelta:C,around:F};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(F)&&(F=y.centerPoint);const te=F.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(I?F.sub(I):F);this._handleMapControls({terrain:b,tr:y,deltasForHelper:Z,preZoomAroundLoc:te,combinedEventsInProgress:s,panDelta:I}),p._applyUpdatedTransform(y),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,u,!0)}_handleMapControls({terrain:t,tr:s,deltasForHelper:u,preZoomAroundLoc:p,combinedEventsInProgress:y,panDelta:b}){const I=this._map.cameraHelper;if(I.handleMapControlsRollPitchBearingZoom(u,s),t)return I.useGlobeControls?(this._terrainMovement||!y.drag&&!y.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void I.handleMapControlsPan(u,s,p)):this._terrainMovement||!y.drag&&!y.zoom?void(y.drag&&this._terrainMovement&&b?s.setCenter(s.screenPointToLocation(s.centerPoint.sub(b))):I.handleMapControlsPan(u,s,p)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void I.handleMapControlsPan(u,s,p));I.handleMapControlsPan(u,s,p)}_fireEvents(t,s,u){const p=Bt(this._eventsInProgress),y=Bt(t),b={};for(const N in t){const{originalEvent:F}=t[N];this._eventsInProgress[N]||(b[`${N}start`]=F),this._eventsInProgress[N]=t[N]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const N in b)this._fireEvent(N,b[N]);y&&this._fireEvent("move",y.originalEvent);for(const N in t){const{originalEvent:F}=t[N];this._fireEvent(N,F)}const I={};let A;for(const N in this._eventsInProgress){const{handlerName:F,originalEvent:q}=this._eventsInProgress[N];this._handlersById[F].isActive()||(delete this._eventsInProgress[N],A=s[F]||q,I[`${N}end`]=A)}for(const N in I)this._fireEvent(N,I[N]);const C=Bt(this._eventsInProgress),R=(p||y)&&!C;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const N=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&N.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(N)}if(u&&R){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;!N||!N.essential&&xe.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:A})),F(this._map.getBearing())&&this._map.resetNorth()):(F(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new c.l(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new $l("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ai extends c.E{constructor(t,s,u){super(),this._renderFrameCallback=()=>{const p=Math.min((Ce()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=u.bearingSnap,this.cameraHelper=s,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,s){t.apply(this.transform),this.transform=t,this.cameraHelper=s}getCenter(){return new c.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,s){return this.jumpTo({elevation:t},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,s,u){return t=c.P.convert(t).mult(-1),this.panTo(this.transform.center,c.e({offset:t},s),u)}panTo(t,s,u){return this.easeTo(c.e({center:t},s),u)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,u){return this.easeTo(c.e({zoom:t},s),u)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,s){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new c.l("movestart",s)).fire(new c.l("move",s)).fire(new c.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,u){return this.easeTo(c.e({bearing:t},s),u)}resetNorth(t,s){return this.rotateTo(0,c.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}getRoll(){return this.transform.roll}setRoll(t,s){return this.jumpTo({roll:t},s),this}cameraForBounds(t,s){t=Mt.convert(t).adjustAntiMeridian();const u=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,s)}_cameraForBoxAndBearing(t,s,u,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=c.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const C=p.padding;p.padding={top:C,bottom:C,right:C,left:C}}const b=c.e(y,p.padding);p.padding=b;const I=this.transform,A=new Mt(t,s);return this.cameraHelper.cameraForBoxAndBearing(p,b,A,u,I)}fitBounds(t,s,u){return this._fitInternal(this.cameraForBounds(t,s),s,u)}fitScreenCoordinates(t,s,u,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(t)),this.transform.screenPointToLocation(c.P.convert(s)),u,p),p,y)}_fitInternal(t,s,u){return t?(delete(s=c.e(t,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(t,s){this.stop();const u=this._getTransformForUpdate();let p=!1,y=!1,b=!1;const I=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,t);const A=u.zoom!==I;return"elevation"in t&&u.elevation!==+t.elevation&&u.setElevation(+t.elevation),"bearing"in t&&u.bearing!==+t.bearing&&(p=!0,u.setBearing(+t.bearing)),"pitch"in t&&u.pitch!==+t.pitch&&(y=!0,u.setPitch(+t.pitch)),"roll"in t&&u.roll!==+t.roll&&(b=!0,u.setRoll(+t.roll)),t.padding==null||u.isPaddingEqual(t.padding)||u.setPadding(t.padding),this._applyUpdatedTransform(u),this.fire(new c.l("movestart",s)).fire(new c.l("move",s)),A&&this.fire(new c.l("zoomstart",s)).fire(new c.l("zoom",s)).fire(new c.l("zoomend",s)),p&&this.fire(new c.l("rotatestart",s)).fire(new c.l("rotate",s)).fire(new c.l("rotateend",s)),y&&this.fire(new c.l("pitchstart",s)).fire(new c.l("pitch",s)).fire(new c.l("pitchend",s)),b&&this.fire(new c.l("rollstart",s)).fire(new c.l("roll",s)).fire(new c.l("rollend",s)),this.fire(new c.l("moveend",s))}calculateCameraOptionsFromTo(t,s,u,p=0){const y=c.a9.fromLngLat(t,s),b=c.a9.fromLngLat(u,p),I=b.x-y.x,A=b.y-y.y,C=b.z-y.z,R=Math.hypot(I,A,C);if(R===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(I,A),F=c.at(this.transform.cameraToCenterDistance/R/this.transform.tileSize),q=180*Math.atan2(I,-A)/Math.PI;let Z=180*Math.acos(N/R)/Math.PI;return Z=C<0?90-Z:90+Z,{center:b.toLngLat(),elevation:p,zoom:F,pitch:Z,bearing:q}}calculateCameraOptionsFromCameraLngLatAltRotation(t,s,u,p,y){const b=this.transform.calculateCenterFromCameraLngLatAlt(t,s,u,p);return{center:b.center,elevation:b.elevation,zoom:b.zoom,bearing:u,pitch:p,roll:y}}easeTo(t,s){this._stop(!1,t.easeId),((t=c.e({offset:[0,0],duration:500,easing:c.cy},t)).animate===!1||!t.essential&&xe.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),p=this.getBearing(),y=u.pitch,b=u.roll,I="bearing"in t?this._normalizeBearing(t.bearing,p):p,A="pitch"in t?+t.pitch:y,C="roll"in t?this._normalizeBearing(t.roll,b):b,R="padding"in t?t.padding:u.padding,N=c.P.convert(t.offset);let F,q;t.around&&(F=c.V.convert(t.around),q=u.locationToScreenPoint(F));const Z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},te=this.cameraHelper.handleEaseTo(u,{bearing:I,pitch:A,roll:C,padding:R,around:F,aroundPoint:q,offsetAsPoint:N,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||p!==I,this._pitching=this._pitching||A!==y,this._rolling=this._rolling||C!==b,this._padding=!u.isPaddingEqual(R),this._zooming=this._zooming||te.isZooming,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Z),this.terrain&&this._prepareElevation(te.elevationCenter),this._ease((ie=>{te.easeFunc(ie),this.terrain&&!t.freezeElevation&&this._updateElevation(ie),this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(ie=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,ie)}),t),this}_prepareEase(t,s,u={}){this._moving=!0,s||u.moving||this.fire(new c.l("movestart",t)),this._zooming&&!u.zooming&&this.fire(new c.l("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new c.l("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new c.l("pitchstart",t)),this._rolling&&!u.rolling&&this.fire(new c.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(s-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.setElevation(c.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const s=t.getCameraLngLat(),u=t.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(s,t.zoom):0;if(u<p){const y=this.calculateCameraOptionsFromTo(s,p,t.center,t.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(t){const s=[];if(s.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&s.push((p=>this.transformCameraUpdate(p))),!s.length)return;const u=t.clone();for(const p of s){const y=u.clone(),{center:b,zoom:I,roll:A,pitch:C,bearing:R,elevation:N}=p(y);b&&y.setCenter(b),N!==void 0&&y.setElevation(N),I!==void 0&&y.setZoom(I),A!==void 0&&y.setRoll(A),C!==void 0&&y.setPitch(C),R!==void 0&&y.setBearing(R),u.apply(y)}this.transform.apply(u)}_fireMoveEvents(t){this.fire(new c.l("move",t)),this._zooming&&this.fire(new c.l("zoom",t)),this._rotating&&this.fire(new c.l("rotate",t)),this._pitching&&this.fire(new c.l("pitch",t)),this._rolling&&this.fire(new c.l("roll",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const u=this._zooming,p=this._rotating,y=this._pitching,b=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new c.l("zoomend",t)),p&&this.fire(new c.l("rotateend",t)),y&&this.fire(new c.l("pitchend",t)),b&&this.fire(new c.l("rollend",t)),this.fire(new c.l("moveend",t))}flyTo(t,s){if(!t.essential&&xe.prefersReducedMotion){const Oe=c.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Oe,s)}this.stop(),t=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cy},t);const u=this._getTransformForUpdate(),p=u.bearing,y=u.pitch,b=u.roll,I=u.padding,A="bearing"in t?this._normalizeBearing(t.bearing,p):p,C="pitch"in t?+t.pitch:y,R="roll"in t?this._normalizeBearing(t.roll,b):b,N="padding"in t?t.padding:u.padding,F=c.P.convert(t.offset);let q=u.centerPoint.add(F);const Z=u.screenPointToLocation(q),te=this.cameraHelper.handleFlyTo(u,{bearing:A,pitch:C,roll:R,padding:N,locationAtOffset:Z,offsetAsPoint:F,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ie=t.curve;const re=Math.max(u.width,u.height),ue=re/te.scaleOfZoom,ve=te.pixelPathLength;typeof te.scaleOfMinZoom=="number"&&(ie=Math.sqrt(re/te.scaleOfMinZoom/ve*2));const le=ie*ie;function _e(Oe){const ot=(ue*ue-re*re+(Oe?-1:1)*le*le*ve*ve)/(2*(Oe?ue:re)*le*ve);return Math.log(Math.sqrt(ot*ot+1)-ot)}function Te(Oe){return(Math.exp(Oe)-Math.exp(-Oe))/2}function me(Oe){return(Math.exp(Oe)+Math.exp(-Oe))/2}const Ae=_e(!1);let Ve=function(Oe){return me(Ae)/me(Ae+ie*Oe)},Le=function(Oe){return re*((me(Ae)*(Te(ot=Ae+ie*Oe)/me(ot))-Te(Ae))/le)/ve;var ot},ze=(_e(!0)-Ae)/ie;if(Math.abs(ve)<2e-6||!isFinite(ze)){if(Math.abs(re-ue)<1e-6)return this.easeTo(t,s);const Oe=ue<re?-1:1;ze=Math.abs(Math.log(ue/re))/ie,Le=()=>0,Ve=ot=>Math.exp(Oe*ie*ot)}return t.duration="duration"in t?+t.duration:1e3*ze/("screenSpeed"in t?+t.screenSpeed/ie:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==A,this._pitching=C!==y,this._rolling=R!==b,this._padding=!u.isPaddingEqual(N),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(te.targetCenter),this._ease((Oe=>{const ot=Oe*ze,ct=1/Ve(ot),tt=Le(ot);this._rotating&&u.setBearing(c.G.number(p,A,Oe)),this._pitching&&u.setPitch(c.G.number(y,C,Oe)),this._rolling&&u.setRoll(c.G.number(b,R,Oe)),this._padding&&(u.interpolatePadding(I,N,Oe),q=u.centerPoint.add(F)),te.easeFunc(Oe,ct,tt,q),this.terrain&&!t.freezeElevation&&this._updateElevation(Oe),this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,s)}return t||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(t,s,u){u.animate===!1||u.duration===0?(t(1),s()):(this._easeStart=Ce(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=c.W(t,-180,180);const u=Math.abs(t-s);return Math.abs(t-360-s)<u&&(t-=360),Math.abs(t+360-s)<u&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(c.V.convert(t),this.transform):null}}const ys={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Th{constructor(t=ys){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=J.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=J.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=J.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){J.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const u=this._map._getUIString(`AttributionControl.${s}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style.tileManagers;for(const p in s){const y=s[p];if(y.used||y.usedForTerrain){const b=y.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t=t.filter((p=>String(p).trim())),t.sort(((p,y)=>p.length-y.length)),t=t.filter(((p,y)=>{for(let b=y+1;b<t.length;b++)if(t[b].indexOf(p)>=0)return!1;return!0}));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=J.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yp{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=J.create("div","maplibregl-ctrl");const s=J.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){J.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Pm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Cm=c.aU([{name:"a_pos3d",type:"Int16",components:3}]);class ql extends c.E{constructor(t){super(),this._lastTilesetChange=Ce(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,s){this.tileManager.update(t,s),this._renderableTilesKeys=[];const u={};for(const p of dt(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.tileManager._source.calculateTileZoom}))u[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),c.c7(p.terrainRttPosMatrix32f,0,c.a5,c.a5,0,0,1),this._tiles[p.key]=new Ge(p,this.tileSize),this._lastTilesetChange=Ce());for(const p in this._tiles)u[p]||delete this._tiles[p]}freeRtt(t){for(const s in this._tiles){const u=this._tiles[s];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,s){return s?this._getTerrainCoordsForTileRanges(t,s):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const s={};for(const u of this._renderableTilesKeys){const p=this._tiles[u].tileID,y=t.clone(),b=c.bk();if(p.canonical.equals(t.canonical))c.c7(b,0,c.a5,c.a5,0,0,1);else if(p.canonical.isChildOf(t.canonical)){const I=p.canonical.z-t.canonical.z,A=p.canonical.x-(p.canonical.x>>I<<I),C=p.canonical.y-(p.canonical.y>>I<<I),R=c.a5>>I;c.c7(b,0,R,R,0,0,1),c.O(b,b,[-A*R,-C*R,0])}else{if(!t.canonical.isChildOf(p.canonical))continue;{const I=t.canonical.z-p.canonical.z,A=t.canonical.x-(t.canonical.x>>I<<I),C=t.canonical.y-(t.canonical.y>>I<<I),R=c.a5>>I;c.c7(b,0,c.a5,c.a5,0,0,1),c.O(b,b,[A*R,C*R,0]),c.Q(b,b,[1/2**I,1/2**I,0])}}y.terrainRttPosMatrix32f=new Float32Array(b),s[u]=y}return s}_getTerrainCoordsForTileRanges(t,s){const u={};for(const p of this._renderableTilesKeys){const y=this._tiles[p].tileID;if(!this._isWithinTileRanges(y,s))continue;const b=t.clone(),I=c.bk();if(y.canonical.z===t.canonical.z){const A=t.canonical.x-y.canonical.x,C=t.canonical.y-y.canonical.y;c.c7(I,0,c.a5,c.a5,0,0,1),c.O(I,I,[A*c.a5,C*c.a5,0])}else if(y.canonical.z>t.canonical.z){const A=y.canonical.z-t.canonical.z,C=y.canonical.x-(y.canonical.x>>A<<A),R=y.canonical.y-(y.canonical.y>>A<<A),N=t.canonical.x-(y.canonical.x>>A),F=t.canonical.y-(y.canonical.y>>A),q=c.a5>>A;c.c7(I,0,q,q,0,0,1),c.O(I,I,[-C*q+N*c.a5,-R*q+F*c.a5,0])}else{const A=t.canonical.z-y.canonical.z,C=t.canonical.x-(t.canonical.x>>A<<A),R=t.canonical.y-(t.canonical.y>>A<<A),N=(t.canonical.x>>A)-y.canonical.x,F=(t.canonical.y>>A)-y.canonical.y,q=c.a5<<A;c.c7(I,0,q,q,0,0,1),c.O(I,I,[C*c.a5+N*q,R*c.a5+F*q,0])}b.terrainRttPosMatrix32f=new Float32Array(I),u[p]=b}return u}getSourceTile(t,s){const u=this.tileManager._source;let p=t.overscaledZ-this.deltaZoom;if(p>u.maxzoom&&(p=u.maxzoom),p<u.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let y=this.findTileInCaches(this._sourceTileCache[t.key]);if(!(y!=null&&y.dem)&&s)for(;p>=u.minzoom&&!(y!=null&&y.dem);)y=this.findTileInCaches(t.scaledTo(p--).key);return y}findTileInCaches(t){let s=this.tileManager.getTileByID(t);return s||(s=this.tileManager._outOfViewCache.getByKey(t),s)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,s){return s[t.canonical.z]&&t.canonical.x>=s[t.canonical.z].minTileX&&t.canonical.x<=s[t.canonical.z].maxTileX&&t.canonical.y>=s[t.canonical.z].minTileY&&t.canonical.y<=s[t.canonical.z].maxTileY}}class wr{constructor(t,s,u){this._meshCache={},this.painter=t,this.tileManager=new ql(s),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,u,p=c.a5){var y;if(!(s>=0&&s<p&&u>=0&&u<p))return 0;const b=this.getTerrainData(t),I=(y=b.tile)===null||y===void 0?void 0:y.dem;if(!I)return 0;const A=c.cC([],[s/p*c.a5,u/p*c.a5],b.u_terrain_matrix),C=[A[0]*I.dim,A[1]*I.dim],R=Math.floor(C[0]),N=Math.floor(C[1]),F=C[0]-R,q=C[1]-N;return I.get(R,N)*(1-F)*(1-q)+I.get(R+1,N)*F*(1-q)+I.get(R,N+1)*(1-F)*q+I.get(R+1,N+1)*F*q}getElevationForLngLatZoom(t,s){if(!c.cD(s,t.wrap()))return 0;const{tileID:u,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(u,p%c.a5,y%c.a5,c.a5)}getElevationForLngLat(t,s){const u=dt(s,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let p=0;for(const y of u)y.canonical.z>p&&(p=Math.min(y.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,p)}getElevation(t,s,u,p=c.a5){return this.getDEMElevation(t,s,u,p)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.painter.context,y=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(p,new c.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ar([])}const s=this.tileManager.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const p=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new c.T(p,s.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),s.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const u=s&&s.toString()+s.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const p=this.tileManager.getSource().maxzoom;let y=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?y=t.canonical.z-p:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=t.canonical.x-(t.canonical.x>>y<<y),I=t.canonical.y-(t.canonical.y>>y<<y),A=c.cE(new Float64Array(16),[1/(c.a5<<y),1/(c.a5<<y),0]);c.O(A,A,[b*c.a5,I*c.a5,0]),this._demMatrixCache[t.key]={matrix:A,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,u=s.width/devicePixelRatio,p=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(s.context,{width:u,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(s.context,{width:u,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(u,p,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,b=0;y<this._coordsTextureSize;y++)for(let I=0;I<this._coordsTextureSize;I++,b+=4)s[b+0]=255&I,s[b+1]=255&y,s[b+2]=I>>8<<4|y>>8,s[b+3]=0;const u=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),p=new c.T(t,u,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),u=this.painter.context,p=u.gl,y=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),I=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(y,I-b-1,1,1,p.RGBA,p.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null);const A=s[0]+(s[2]>>4<<8),C=s[1]+((15&s[2])<<8),R=this.coordsIndex[255-s[3]],N=R&&this.tileManager.getTileByID(R);if(!N)return null;const F=this._coordsTextureSize,q=(1<<N.tileID.canonical.z)*F;return new c.a9((N.tileID.canonical.x*F+A)/q+N.tileID.wrap,(N.tileID.canonical.y*F+C)/q,this.getElevation(N.tileID,A,C,F))}depthAtPoint(t){const s=new Uint8Array(4),u=this.painter.context,p=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(t){var s;const u=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,p=u&&t.canonical.y===0,y=u&&t.canonical.y===(1<<t.canonical.z)-1,b=`m_${p?"n":""}_${y?"s":""}`;if(this._meshCache[b])return this._meshCache[b];const I=this.painter.context,A=new c.cF,C=new c.aY,R=this.meshSize,N=c.a5/R,F=R*R;for(let me=0;me<=R;me++)for(let Ae=0;Ae<=R;Ae++)A.emplaceBack(Ae*N,me*N,0);for(let me=0;me<F;me+=R+1)for(let Ae=0;Ae<R;Ae++)C.emplaceBack(Ae+me,R+Ae+me+1,R+Ae+me+2),C.emplaceBack(Ae+me,R+Ae+me+2,Ae+me+1);const q=A.length,Z=q+(R+1),te=(R+1)*R,ie=p?c.br:0,re=p?0:1,ue=y?c.bs:c.a5,ve=y?0:1;for(let me=0;me<=R;me++)A.emplaceBack(me*N,ie,re);for(let me=0;me<=R;me++)A.emplaceBack(me*N,ue,ve);for(let me=0;me<R;me++)C.emplaceBack(te+me,Z+me,Z+me+1),C.emplaceBack(te+me,Z+me+1,te+me+1),C.emplaceBack(0+me,q+me+1,q+me),C.emplaceBack(0+me,0+me+1,q+me+1);const le=A.length,_e=le+2*(R+1);for(const me of[0,1])for(let Ae=0;Ae<=R;Ae++)for(const Ve of[0,1])A.emplaceBack(me*c.a5,Ae*N,Ve);for(let me=0;me<2*R;me+=2)C.emplaceBack(le+me,le+me+1,le+me+3),C.emplaceBack(le+me,le+me+3,le+me+2),C.emplaceBack(_e+me,_e+me+3,_e+me+1),C.emplaceBack(_e+me,_e+me+2,_e+me+3);const Te=new Nn(I.createVertexBuffer(A,Cm.members),I.createIndexBuffer(C),c.aX.simpleSegment(0,0,A.length,C.length));return this._meshCache[b]=Te,Te}getMeshFrameDelta(t){return 2*Math.PI*c.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,s){var u;if(!c.cD(s,t.wrap()))return 0;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(u=this.getMinMaxElevation(p).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return s&&s.dem&&(u.minElevation=s.dem.min*this.exaggeration,u.maxElevation=s.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,s){const u=c.a9.fromLngLat(t.wrap()),p=(1<<s)*c.a5,y=u.x*p,b=u.y*p,I=Math.floor(y/c.a5),A=Math.floor(b/c.a5);return{tileID:new c.a2(s,0,s,I,A),mercatorX:y,mercatorY:b}}}class Rr{constructor(t,s,u){this._context=t,this._size=s,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(u.texture),{id:t,fbo:s,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>t.id!==s)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const la={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Gl{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new Rr(t.context,30,s.tileManager.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((u=>!t._layers[u].isHidden(s))),this._coordsAscending={};for(const u in t.tileManagers){this._coordsAscending[u]={};const p=t.tileManagers[u].getVisibleCoordinates(),y=t.tileManagers[u].getSource(),b=y instanceof Xt?y.terrainTileRanges:null;for(const I of p){const A=this.terrain.tileManager.getTerrainCoords(I,b);for(const C in A)this._coordsAscending[u][C]||(this._coordsAscending[u][C]=[]),this._coordsAscending[u][C].push(A[C])}}this._coordsAscendingStr={};for(const u of t._order){const p=t._layers[u],y=p.source;if(la[p.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const b in this._coordsAscending[y])this._coordsAscendingStr[y][b]=this._coordsAscending[y][b].map((I=>I.key)).sort().join()}}for(const u of this._renderableTiles)for(const p in this._coordsAscendingStr){const y=this._coordsAscendingStr[p][u.tileID.key];y&&y!==u.rttCoords[p]&&(u.rtt=[])}}renderLayer(t,s){if(t.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),p=t.type,y=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(la[p]&&(this._prevType&&la[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(t.id),!b))return!0;if(la[this._prevType]||la[p]&&b){this._prevType=p;const I=this._stacks.length-1,A=this._stacks[I]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(dh(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[I]){const N=this.pool.getObjectForId(C.rtt[I].id);if(N.stamp===C.rtt[I].stamp){this.pool.useObject(N);continue}}const R=this.pool.getOrCreateFreeObject();this.pool.useObject(R),this.pool.stampObject(R),C.rtt[I]={id:R.id,stamp:R.stamp},y.context.bindFramebuffer.set(R.fbo.framebuffer),y.context.clear({color:c.bp.transparent,stencil:0}),y.currentStencilSource=void 0;for(let N=0;N<A.length;N++){const F=y.style._layers[A[N]],q=F.source?this._coordsAscending[F.source][C.tileID.key]:[C.tileID];y.context.viewport.set([0,0,R.fbo.width,R.fbo.height]),y._renderTileClippingMasks(F,q,!0),y.renderLayer(y,y.style.tileManagers[F.source],F,q,u),F.source&&(C.rttCoords[F.source]=this._coordsAscendingStr[F.source][C.tileID.key])}}return dh(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),la[p]}return!1}}const Yc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Eh=k,Qc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ys,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Ih={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Hl{constructor(t,s,u=!1){this.mousedown=y=>{this.startMove(y,J.mousePos(this.element,y)),J.addEventListener(window,"mousemove",this.mousemove),J.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,J.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHandler.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=J.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),J.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),J.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=J.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const p=new hp;this._rotatePitchHandler=new ja({clickTolerance:3,move:(y,b)=>{const I=s.getBoundingClientRect(),A=new c.P((I.bottom-I.top)/2,(I.right-I.left)/2);return{bearingDelta:c.cx(new c.P(y.x,b.y),b,A),pitchDelta:u?-.5*(b.y-y.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=t,J.addEventListener(s,"mousedown",this.mousedown),J.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),J.addEventListener(s,"touchcancel",this.reset)}startMove(t,s){this._rotatePitchHandler.dragStart(t,s),J.disableDrag()}move(t,s){const u=this.map,{bearingDelta:p,pitchDelta:y}=this._rotatePitchHandler.dragMove(t,s)||{};p&&u.setBearing(u.getBearing()+p),y&&u.setPitch(u.getPitch()+y)}off(){const t=this.element;J.removeEventListener(t,"mousedown",this.mousedown),J.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),J.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),J.removeEventListener(window,"touchend",this.touchend),J.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){J.enableDrag(),J.removeEventListener(window,"mousemove",this.mousemove),J.removeEventListener(window,"mouseup",this.mouseup),J.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),J.removeEventListener(window,"touchend",this.touchend)}}let oo;function Jc(_,t,s,u=!1){if(u||!s.getCoveringTilesDetailsProvider().allowWorldCopies())return _==null?void 0:_.wrap();const p=new c.V(_.lng,_.lat);if(_=new c.V(_.lng,_.lat),t){const y=new c.V(_.lng-360,_.lat),b=new c.V(_.lng+360,_.lat),I=s.locationToScreenPoint(_).distSqr(t);s.locationToScreenPoint(y).distSqr(t)<I?_=y:s.locationToScreenPoint(b).distSqr(t)<I&&(_=b)}for(;Math.abs(_.lng-s.center.lng)>180;){const y=s.locationToScreenPoint(_);if(y.x>=0&&y.y>=0&&y.x<=s.width&&y.y<=s.height)break;_.lng>s.center.lng?_.lng-=360:_.lng+=360}return _.lng!==p.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(_))?_:p}const Wl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function eu(_,t,s){const u=_.classList;for(const p in Wl)u.remove(`maplibregl-${s}-anchor-${p}`);u.add(`maplibregl-${s}-anchor-${t}`)}class Zl extends c.E{constructor(t){if(super(),this._onKeyPress=s=>{const u=s.code,p=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=s=>{const u=s.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=Jc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),J.setTransform(this._element,`${Wl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${p}`),xe.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=c.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=J.create("div");const s=J.createNS("http://www.w3.org/2000/svg","svg"),u=41,p=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${u}px`),s.setAttributeNS(null,"width",`${p}px`),s.setAttributeNS(null,"viewBox",`0 0 ${p} ${u}`);const y=J.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const b=J.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const I=J.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of A){const ue=J.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",re.rx),ue.setAttributeNS(null,"ry",re.ry),I.appendChild(ue)}const C=J.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const R=J.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(R);const N=J.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const F=J.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(F);const q=J.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const Z=J.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const te=J.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#000000"),te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962");const ie=J.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),Z.appendChild(te),Z.appendChild(ie),b.appendChild(I),b.appendChild(C),b.appendChild(N),b.appendChild(q),b.appendChild(Z),s.appendChild(b),s.setAttributeNS(null,"height",u*this._scale+"px"),s.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(s),this._offset=c.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),eu(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),J.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,u;const p=(s=this._map)===null||s===void 0?void 0:s.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!p||y){const q=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==q&&(this._element.style.opacity=q))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const b=this._map,I=b.terrain.depthAtPoint(this._pos),A=b.terrain.getElevationForLngLat(this._lngLat,b.transform);if(b.transform.lngLatToCameraDepth(this._lngLat,A)-I<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/b.transform.pixelsPerMeter,R=Math.sin(b.getPitch()*Math.PI/180)*C,N=b.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),F=b.transform.lngLatToCameraDepth(this._lngLat,A+R)-N>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=c.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return(this._opacity===void 0||t===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Sh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let qa=0,ca=!1;const Ah={maxWidth:100,unit:"metric"};function Kl(_,t,s){const u=s&&s.maxWidth||100,p=_._container.clientHeight/2,y=_._container.clientWidth/2,b=_.unproject([y-u/2,p]),I=_.unproject([y+u/2,p]),A=Math.round(_.project(I).x-_.project(b).x),C=Math.min(u,A,_._container.clientWidth),R=b.distanceTo(I);if(s&&s.unit==="imperial"){const N=3.2808*R;N>5280?ua(t,C,N/5280,_._getUIString("ScaleControl.Miles")):ua(t,C,N,_._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?ua(t,C,R/1852,_._getUIString("ScaleControl.NauticalMiles")):R>=1e3?ua(t,C,R/1e3,_._getUIString("ScaleControl.Kilometers")):ua(t,C,R,_._getUIString("ScaleControl.Meters"))}function ua(_,t,s,u){const p=(function(y){const b=Math.pow(10,`${Math.floor(y)}`.length-1);let I=y/b;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:(function(A){const C=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*C)/C})(I),b*I})(s);_.style.width=t*(p/s)+"px",_.innerHTML=`${p}&nbsp;${u}`}const Ph={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},tu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nu(_){if(_){if(typeof _=="number"){const t=Math.round(Math.abs(_)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,_),"top-left":new c.P(t,t),"top-right":new c.P(-t,t),bottom:new c.P(0,-_),"bottom-left":new c.P(t,-t),"bottom-right":new c.P(-t,-t),left:new c.P(_,0),right:new c.P(-_,0)}}if(_ instanceof c.P||Array.isArray(_)){const t=c.P.convert(_);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:c.P.convert(_.center||[0,0]),top:c.P.convert(_.top||[0,0]),"top-left":c.P.convert(_["top-left"]||[0,0]),"top-right":c.P.convert(_["top-right"]||[0,0]),bottom:c.P.convert(_.bottom||[0,0]),"bottom-left":c.P.convert(_["bottom-left"]||[0,0]),"bottom-right":c.P.convert(_["bottom-right"]||[0,0]),left:c.P.convert(_.left||[0,0]),right:c.P.convert(_.right||[0,0])}}return nu(new c.P(0,0))}const Ch=k;x.AJAXError=c.cI,x.Event=c.l,x.Evented=c.E,x.LngLat=c.V,x.MercatorCoordinate=c.a9,x.Point=c.P,x.addProtocol=c.cJ,x.config=c.c,x.removeProtocol=c.cK,x.AttributionControl=Th,x.BoxZoomHandler=Ua,x.CanvasSource=W,x.CooperativeGesturesHandler=Pt,x.DoubleClickZoomHandler=wh,x.DragPanHandler=_p,x.DragRotateHandler=ks,x.EdgeInsets=To,x.FullscreenControl=class extends c.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s==null?void 0:s.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){J.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=J.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);J.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=xn,x.GeolocateControl=class extends c.E{constructor(_){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new c.V(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,p=this._map.getBearing(),y=c.e({bearing:p},this.options.fitBoundsOptions),b=Mt.fromLngLat(s,u);this._map.fitBounds(b,y,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new c.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ca)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=J.create("button","maplibregl-ctrl-geolocate",this._container),J.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=J.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Zl({element:this._dotElement}),this._circleElement=J.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{const u=(s==null?void 0:s[0])instanceof ResizeObserverEntry;s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},Sh,_)}onAdd(_){return this._map=_,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(t=!1){if(oo!==void 0&&!t)return oo;if(window.navigator.permissions===void 0)return oo=!!window.navigator.geolocation,oo;try{oo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{oo=!!window.navigator.geolocation}return oo}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),J.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,qa=0,ca=!1}_isOutOfMapMaxBounds(_){const t=this._map.getMaxBounds(),s=_.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const _=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&_))return;const t=this._map.project(_),s=this._map.unproject([t.x+100,t.y]),u=_.distanceTo(s)/100,p=2*this._accuracy/u;this._circleElement.style.width=`${p.toFixed(2)}px`,this._circleElement.style.height=`${p.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":qa--,ca=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),qa++,qa>1?(_={maximumAge:6e5,timeout:0},ca=!0):(_=this.options.positionOptions,ca=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.GlobeControl=class{constructor(){this._toggleProjection=()=>{var _;const t=(_=this._map.getProjection())===null||_===void 0?void 0:_.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var _;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((_=this._map.getProjection())===null||_===void 0?void 0:_.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(_){return this._map=_,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=J.create("button","maplibregl-ctrl-globe",this._container),J.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){J.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},x.Hash=mh,x.ImageSource=Xt,x.KeyboardHandler=tr,x.LngLatBounds=Mt,x.LogoControl=yp,x.Map=class extends Ai{constructor(_){var t,s;c.cG.mark(c.cH.create);const u=Object.assign(Object.assign(Object.assign({},Qc),_),{canvasContextAttributes:Object.assign(Object.assign({},Qc.canvasContextAttributes),_.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new js,y=new Ss;if(u.minZoom!==void 0&&p.setMinZoom(u.minZoom),u.maxZoom!==void 0&&p.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&p.setMinPitch(u.minPitch),u.maxPitch!==void 0&&p.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&p.setRenderWorldCopies(u.renderWorldCopies),u.transformConstrain!==null&&p.setConstrainOverride(u.transformConstrain),super(p,y,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Pm,this._controls=[],this._mapId=c.af(),this._lostContextStyle={style:null,images:null},this._contextLost=I=>{I.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const A of Object.values(this.style._layers))if(A.type==="custom"&&console.warn(`Custom layer with id '${A.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),A._listeners)for(const[C]of Object.entries(A._listeners))console.warn(`Custom layer with id '${A.id}' had event listeners for event '${C}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:I}))},this._contextRestored=I=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:I}))},this._onMapScroll=I=>{if(I.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Yc),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this._zoomLevelsToOverscale=u.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=u.transformCameraUpdate,this.transformConstrain=u.transformConstrain,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,u.reduceMotion!==void 0&&(xe.prefersReducedMotion=u.reduceMotion),this._imageQueueHandle=he.addThrottleControl((()=>this.isMoving())),this._requestManager=new oe(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let I=!1;const A=fh((C=>{this._trackResize&&!this._removed&&(this.resize(C),this.redraw())}),50);this._resizeObserver=new ResizeObserver((C=>{I?A(C):I=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Xc(this,u),this._hash=u.hash&&new mh(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,c.e({},u.fitBoundsOptions,{duration:0}))));const b=typeof u.style=="string"||((s=(t=u.style)===null||t===void 0?void 0:t.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,b),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Th(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new yp,u.logoPosition),this.on("style.load",(()=>{if(b||this._resizeTransform(),this.transform.unmodified){const I=c.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(I)}})),this.on("data",(I=>{this._update(I.dataType==="style"),this.fire(new c.l(`${I.dataType}data`,I))})),this.on("dataloading",(I=>{this.fire(new c.l(`${I.dataType}dataloading`,I))})),this.on("dataabort",(I=>{this.fire(new c.l("sourcedataabort",I))}))}_getMapId(){return this._mapId}setGlobalStateProperty(_,t){return this.style.setGlobalStateProperty(_,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(_,t){if(t===void 0&&(t=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=_.onAdd(this);this._controls.push(_);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(_);return t>-1&&this._controls.splice(t,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}coveringTiles(_){return dt(this.transform,_)}calculateCameraOptionsFromTo(_,t,s,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLat(s,this.transform)),super.calculateCameraOptionsFromTo(_,t,s,u)}resize(_,t=!0){const[s,u]=this._containerDimensions(),p=this._getClampedPixelRatio(s,u);if(this._resizeCanvas(s,u,p),this.painter.resize(s,u,p),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const I=this._getClampedPixelRatio(s,u);this._resizeCanvas(s,u,I),this.painter.resize(s,u,I)}this._resizeTransform(t);const y=!this._moving;return y&&(this.stop(),this.fire(new c.l("movestart",_)).fire(new c.l("move",_))),this.fire(new c.l("resize",_)),y&&this.fire(new c.l("moveend",_)),this}_resizeTransform(_=!0){var t;const[s,u]=this._containerDimensions();this.transform.resize(s,u,_),(t=this._requestedCameraState)===null||t===void 0||t.resize(s,u,_)}_getClampedPixelRatio(_,t){const{0:s,1:u}=this._maxCanvasSize,p=this.getPixelRatio(),y=_*p,b=t*p;return Math.min(y>s?s/y:1,b>u?u/b:1)*p}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(Mt.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(_),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(_),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.setMinPitch(_),this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(_>=this.transform.minPitch)return this.transform.setMaxPitch(_),this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.setRenderWorldCopies(_),this._update()}setTransformConstrain(_){return this.transform.setConstrainOverride(_),this._update()}project(_){return this.transform.locationToScreenPoint(c.V.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.screenPointToLocation(c.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,t,s){if(_==="mouseenter"||_==="mouseover"){let u=!1;return{layers:t,listener:s,delegates:{mousemove:y=>{const b=t.filter((A=>this.getLayer(A))),I=b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[];I.length?u||(u=!0,s.call(this,new ei(_,this,y.originalEvent,{features:I}))):u=!1},mouseout:()=>{u=!1}}}}if(_==="mouseleave"||_==="mouseout"){let u=!1;return{layers:t,listener:s,delegates:{mousemove:b=>{const I=t.filter((A=>this.getLayer(A)));(I.length!==0?this.queryRenderedFeatures(b.point,{layers:I}):[]).length?u=!0:u&&(u=!1,s.call(this,new ei(_,this,b.originalEvent)))},mouseout:b=>{u&&(u=!1,s.call(this,new ei(_,this,b.originalEvent)))}}}}{const u=p=>{const y=t.filter((I=>this.getLayer(I))),b=y.length!==0?this.queryRenderedFeatures(p.point,{layers:y}):[];b.length&&(p.features=b,s.call(this,p),delete p.features)};return{layers:t,listener:s,delegates:{[_]:u}}}}_saveDelegatedListener(_,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(t)}_removeDelegatedListener(_,t,s){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const u=this._delegatedListeners[_];for(let p=0;p<u.length;p++){const y=u[p];if(y.listener===s&&y.layers.length===t.length&&y.layers.every((b=>t.includes(b)))){for(const b in y.delegates)this.off(b,y.delegates[b]);return void u.splice(p,1)}}}on(_,t,s){if(s===void 0)return super.on(_,t);const u=typeof t=="string"?[t]:t,p=this._createDelegatedListener(_,u,s);this._saveDelegatedListener(_,p);for(const y in p.delegates)this.on(y,p.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(_,u,s)}}}once(_,t,s){if(s===void 0)return super.once(_,t);const u=typeof t=="string"?[t]:t,p=this._createDelegatedListener(_,u,s);for(const y in p.delegates){const b=p.delegates[y];p.delegates[y]=(...I)=>{this._removeDelegatedListener(_,u,s),b(...I)}}this._saveDelegatedListener(_,p);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(_,t,s){return s===void 0?super.off(_,t):(this._removeDelegatedListener(_,typeof t=="string"?[t]:t,s),this)}queryRenderedFeatures(_,t){if(!this.style)return[];let s;const u=_ instanceof c.P||Array.isArray(_),p=u?_:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:_)||{},p instanceof c.P||typeof p[0]=="number")s=[c.P.convert(p)];else{const y=c.P.convert(p[0]),b=c.P.convert(p[1]);s=[y,new c.P(b.x,y.y),b,new c.P(y.x,b.y),y]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(_,t){return this.style.querySourceFeatures(_,t)}setStyle(_,t){return(t=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(_,t))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const t=this._locale[_];if(t==null)throw new Error(`Missing UI string '${_}'`);return t}_updateStyle(_,t){var s,u;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(_,t)));const p=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new xi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,t,p):this.style.loadJSON(_,t,p),this):((u=(s=this.style)===null||s===void 0?void 0:s.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,t){if(typeof _=="string"){const s=this._requestManager.transformRequest(_,"Style");c.j(s,new AbortController).then((u=>{this._updateDiff(u.data,t)})).catch((u=>{u&&this.fire(new c.k(u))}))}else typeof _=="object"&&this._updateDiff(_,t)}_updateDiff(_,t){try{this.style.setState(_,t)&&this._update(!0)}catch(s){c.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(_,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(_,t){return this._lazyInitEmptyStyle(),this.style.addSource(_,t),this._update(!0)}isSourceLoaded(_){const t=this.style&&this.style.tileManagers[_];if(t!==void 0)return t.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const t=this.style.tileManagers[_.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const u=this.style._layers[s];u.type==="hillshade"&&u.source===_.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===_.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new wr(this.painter,t,_),this.painter.renderToTexture=new Gl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var u;s.dataType==="style"?this.terrain.tileManager.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==_.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=s.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:_})),this}getTerrain(){var _,t;return(t=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const _=this.style&&this.style.tileManagers;for(const t of Object.values(_))if(!t.areTilesLoaded())return!1;return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}setSourceTileLodParams(_,t,s){if(s){const u=this.getSource(s);if(!u)throw new Error(`There is no source with ID "${s}", cannot set LOD parameters`);u.calculateTileZoom=Yt(Math.max(1,_),Math.max(1,t))}else for(const u in this.style.tileManagers)this.style.tileManagers[u].getSource().calculateTileZoom=Yt(Math.max(1,_),Math.max(1,t));return this._update(!0),this}refreshTiles(_,t){const s=this.style.tileManagers[_];if(!s)throw new Error(`There is no tile manager with ID "${_}", cannot refresh tile`);t===void 0?s.reload(!0):s.refreshTiles(t.map((u=>new c.ac(u.z,u.x,u.y))))}addImage(_,t,s={}){const{pixelRatio:u=1,sdf:p=!1,stretchX:y,stretchY:b,content:I,textFitWidth:A,textFitHeight:C}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||c.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:N,data:F}=t,q=t;return this.style.addImage(_,{data:new c.R({width:R,height:N},new Uint8Array(F)),pixelRatio:u,stretchX:y,stretchY:b,content:I,textFitWidth:A,textFitHeight:C,sdf:p,version:0,userImage:q}),q.onAdd&&q.onAdd(this,_),this}}{const{width:R,height:N,data:F}=xe.getImageData(t);this.style.addImage(_,{data:new c.R({width:R,height:N},F),pixelRatio:u,stretchX:y,stretchY:b,content:I,textFitWidth:A,textFitHeight:C,sdf:p,version:0})}}updateImage(_,t){const s=this.style.getImage(_);if(!s)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||c.b(t)?xe.getImageData(t):t,{width:p,height:y,data:b}=u;if(p===void 0||y===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||y!==s.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(t instanceof HTMLImageElement||c.b(t));return s.data.replace(b,I),this.style.updateImage(_,s),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return he.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,t){return this._lazyInitEmptyStyle(),this.style.addLayer(_,t),this._update(!0)}moveLayer(_,t){return this.style.moveLayer(_,t),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,t,s){return this.style.setLayerZoomRange(_,t,s),this._update(!0)}setFilter(_,t,s={}){return this.style.setFilter(_,t,s),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,t,s,u={}){return this.style.setPaintProperty(_,t,s,u),this._update(!0)}getPaintProperty(_,t){return this.style.getPaintProperty(_,t)}setLayoutProperty(_,t,s,u={}){return this.style.setLayoutProperty(_,t,s,u),this._update(!0)}getLayoutProperty(_,t){return this.style.getLayoutProperty(_,t)}setGlyphs(_,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,t,s,(u=>{u||this._update(!0)})),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,t,(s=>{s||this._update(!0)})),this}setLight(_,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(_,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(_,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,t){return this.style.setFeatureState(_,t),this._update()}removeFeatureState(_,t){return this.style.removeFeatureState(_,t),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,t=0;return this._container&&(_=this._container.clientWidth||400,t=this._container.clientHeight||300),[_,t]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const t=this._canvasContainer=J.create("div","maplibregl-canvas-container",_);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=J.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),u=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],u);const p=this._controlContainer=J.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((b=>{y[b]=J.create("div",`maplibregl-ctrl-${b} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,t,s){this._canvas.width=Math.floor(s*_),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const _=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(u=>{t={requestedAttributes:_},u&&(t.statusMessage=u.statusMessage,t.type=u.type)}),{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,_):this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_),!s){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new ap(s,this.transform),Ye.testSupport(s)}migrateProjection(_,t){super.migrateProjection(_,t),this.painter.transform=_,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){var t,s,u,p,y;const b=this._idleTriggered?this._fadeDuration:0,I=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let A=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,F=Ce();this.style.zoomHistory.update(N,F);const q=new c.H(N,{now:F,fadeDuration:b,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Z=q.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(A=!0,this._crossFadingFactor=Z),this.style.update(q)}const C=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==I;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||C)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,C),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cG.mark(c.cH.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||A)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const R=this._sourcesDirty||this._styleDirty||this._placementDirty;return R||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,c.cG.mark(c.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),he.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),J.remove(this._canvasContainer),J.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cG.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,xe.frame(this._frameRequest,(_=>{c.cG.frame(_),this._frameRequest=null;try{this._render(_)}catch(t){if(!c.Z(t)&&!(function(s){return s.message===lh})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return Eh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),this.style.setProjection(_),this._update(!0)}},x.MapMouseEvent=ei,x.MapTouchEvent=Fl,x.MapWheelEvent=up,x.Marker=Zl,x.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,s)=>{const u=this._map._getUIString(`NavigationControl.${s}`);t.title=u,t.setAttribute("aria-label",u)},this.options=c.e({},Ih,_),this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),J.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),J.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=J.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Hl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){J.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,t){const s=J.create("button",_,this._container);return s.type="button",s.addEventListener("click",t),s}},x.Popup=class extends c.E{constructor(_){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&J.remove(this._content),this._container&&(J.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=J.create("div","maplibregl-popup",this._map.getContainer()),this._tip=J.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Jc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const s=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const p=nu(this.options.offset);if(!u){const b=this._container.offsetWidth,I=this._container.offsetHeight;let A;A=s.y+p.bottom.y<I?["top"]:s.y>this._map.transform.height-I?["bottom"]:[],s.x<b/2?A.push("left"):s.x>this._map.transform.width-b/2&&A.push("right"),u=A.length===0?"bottom":A.join("-")}let y=s.add(p[u]);this.options.subpixelPositioning||(y=y.round()),J.setTransform(this._container,`${Wl[u]} translate(${y.x}px,${y.y}px)`),eu(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ph),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=c.V.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const t=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=_;u=s.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=J.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=J.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(tu);_&&_.focus()}},x.RasterDEMTileSource=tn,x.RasterTileSource=Ot,x.ScaleControl=class{constructor(_){this._onMove=()=>{Kl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Kl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ah),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){J.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=Zc,x.Style=xi,x.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=J.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=J.create("button","maplibregl-ctrl-terrain",this._container),J.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){J.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=fp,x.TwoFingersTouchRotateHandler=xh,x.TwoFingersTouchZoomHandler=vh,x.TwoFingersTouchZoomRotateHandler=jl,x.VectorTileSource=$t,x.VideoSource=Pe,x.addSourceType=(_,t)=>c._(void 0,void 0,void 0,(function*(){if(X(_))throw new Error(`A source type called "${_}" already exists.`);((s,u)=>{H[s]=u})(_,t)})),x.clearPrewarmedResources=function(){const _=At;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(kn),At=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.createTileMesh=bl,x.getMaxParallelImageRequests=function(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return Ie().getRTLTextPluginStatus()},x.getVersion=function(){return Ch},x.getWorkerCount=function(){return Et.workerCount},x.getWorkerUrl=function(){return c.c.WORKER_URL},x.importScriptInWorkers=function(_){return ur().broadcast("IS",_)},x.isTimeFrozen=function(){return $e.isFrozen()},x.now=Ce,x.prewarm=function(){pn().acquire(kn)},x.restoreNow=function(){$e.restoreNow()},x.setMaxParallelImageRequests=function(_){c.c.MAX_PARALLEL_IMAGE_REQUESTS=_},x.setNow=function(_){$e.setNow(_)},x.setRTLTextPlugin=function(_,t){return Ie().setRTLTextPlugin(_,t)},x.setWorkerCount=function(_){Et.workerCount=_},x.setWorkerUrl=function(_){c.c.WORKER_URL=_}}));var w=o;return w}))})(sf)),sf.exports}var iI=rI();const wu=tI(iI);function sI(a,n={}){const{center:o=[0,0],zoom:h=2,onUserInteraction:g}=n;console.log("[MapLibre]  Initialization started"),console.log("[MapLibre] Container:",a),console.log("[MapLibre] Options:",{center:o,zoom:h});const w="RxBvcEtOzt1XOYbUqQ4i";console.log("[MapLibre] API Key:","Loaded ");const x=document.documentElement.getAttribute("data-theme")==="light",c=`https://api.maptiler.com/maps/darkmatter/style.json?key=${w}`,k=`https://api.maptiler.com/maps/positron/style.json?key=${w}`,O=x?k:c;console.log("[MapLibre] Style:",x?"Light (Positron)":"Dark (Darkmatter)"),console.log("[MapLibre] Creating Map instance...");const U=new wu.Map({container:a,style:O,center:o,zoom:h,pitch:0,bearing:0,antialias:!0,attributionControl:!0});g&&["dragstart","touchstart","wheel","mousedown"].forEach(et=>{U.on(et,()=>{g()})}),window.addEventListener("themeChanged",et=>{const{theme:at}=et.detail,Qe=at==="light"||document.documentElement.getAttribute("data-theme")==="light",he=Qe?k:c;U.setStyle(he),console.log("[MapLibre] Style switched to:",Qe?"Light":"Dark")}),console.log("[MapLibre] Map instance created:",U);let Y=!1;U.on("load",()=>{console.log("[MapLibre]  Map loaded successfully!");const et=U.getStyle().layers;let at;for(const Qe of et)if(Qe.type==="symbol"){at=Qe.id;break}console.log("[MapLibre] Placing trajectory below layer:",at),U.addSource("trajectory-past",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),U.addLayer({id:"trajectory-past-glow",type:"line",source:"trajectory-past",paint:{"line-color":"#00d4ff","line-width":10,"line-opacity":.5,"line-blur":6}}),U.addLayer({id:"trajectory-past-line",type:"line",source:"trajectory-past",paint:{"line-color":"#00d4ff","line-width":4,"line-opacity":1}}),U.addSource("trajectory-future",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),U.addLayer({id:"trajectory-future-line",type:"line",source:"trajectory-future",paint:{"line-color":"#ffa500","line-width":4,"line-opacity":.9,"line-dasharray":[4,4]}}),Y=!0,console.log("[MapLibre]  Trajectory layers initialized")}),U.on("error",et=>{console.error("[MapLibre]  Map error:",et)}),U.addControl(new wu.AttributionControl({compact:!0}),"bottom-right"),U.addControl(new wu.NavigationControl({showCompass:!0,showZoom:!0,visualizePitch:!1}),"top-right");const se=`
    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M14 18H26V22H14V18Z" fill="#00D4FF"/>
        <path d="M12 16H8V24H12V16Z" fill="#66E0FF"/>
        <path d="M28 16H32V24H28V16Z" fill="#66E0FF"/>
        <path d="M18 14V10H22V14H18Z" fill="#0099CC"/>
        <path d="M18 26V30H22V26H18Z" fill="#0099CC"/>
        <path d="M4 14H8V26H4V14Z" fill="#AACCFF"/> 
        <path d="M32 14H36V26H32V14Z" fill="#AACCFF"/>
        <rect x="0" y="14" width="4" height="12" fill="#003366"/>
        <rect x="36" y="14" width="4" height="12" fill="#003366"/>
        <rect x="19" y="8" width="2" height="2" fill="white"/> <!-- Antenna tip -->
    </svg>
    `,xe=document.createElement("div");xe.className="iss-marker",xe.style.width="40px",xe.style.height="40px",xe.innerHTML=se,xe.style.cursor="pointer",xe.style.filter="drop-shadow(0 0 5px rgba(0,212,255,0.8))",xe.style.transition="transform 0.3s ease",xe.addEventListener("mouseenter",()=>xe.style.transform="scale(1.2)"),xe.addEventListener("mouseleave",()=>xe.style.transform="scale(1)");const $e=new wu.Marker({element:xe,anchor:"center"}).setLngLat([0,0]).addTo(U);let Ce=null;function J(et,at){if(Ce)Ce.setLngLat([at,et]);else{const Qe=document.createElement("div");Qe.innerHTML=`
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9.5L12 2.5L21 9.5V20.5C21 21.0523 20.5523 21.5 20 21.5H15V15.5H9V21.5H4C3.44772 21.5 3 21.0523 3 20.5V9.5Z" fill="#FF00FF" stroke="white" stroke-width="2"/>
            </svg>`,Qe.className="home-marker",Qe.style.filter="drop-shadow(0 0 5px #ff00ff)",Ce=new wu.Marker({element:Qe,anchor:"bottom"}).setLngLat([at,et]).addTo(U)}}const Ye=new wu.Popup({closeButton:!1,closeOnClick:!1,offset:25});xe.addEventListener("click",()=>{const[et,at]=$e.getLngLat().toArray();Ye.setLngLat([et,at]).setHTML(`
        <div style="
          background: var(--card);
          color: var(--text);
          padding: 8px 12px;
          border-radius: 8px;
          font-size: 12px;
          font-weight: 700;
        ">
          <strong> ISS Position</strong><br>
          Lat: ${at.toFixed(4)}<br>
          Lng: ${et.toFixed(4)}
        </div>
      `).addTo(U)});let qe={lat:0,lng:0},He=!1;return U.on("render",()=>{He&&($e.setLngLat([qe.lng,qe.lat]),He=!1)}),{map:U,issMarker:$e,popup:Ye,updateHomeMarker:J,updateISSPosition(et,at){qe.lat=et,qe.lng=at,He=!0,U.triggerRepaint()},panTo(et,at,Qe=4){U.flyTo({center:[at,et],zoom:Qe,duration:1500,essential:!0})},setViewMode(et){et==="tilted"?U.easeTo({pitch:60,duration:1e3}):U.easeTo({pitch:0,duration:1e3})},updateTrajectory(et,at){if(!Y){console.warn("[MapLibre] Trajectory layers not ready yet"),U.once("load",()=>{this.updateTrajectory(et,at)});return}try{const Qe=U.getSource("trajectory-past"),he=U.getSource("trajectory-future");Qe&&et&&Qe.setData(et),he&&at&&he.setData(at),console.log("[MapLibre]  Trajectory updated")}catch(Qe){console.error("[MapLibre] Trajectory update error:",Qe)}},isTrajectoryReady(){return Y},destroy(){Ye.remove(),$e.remove(),U.remove()}}}const oI=[{id:1,name:"Adana",lat:37,lon:35.3213333},{id:2,name:"Adyaman",lat:37.7641667,lon:38.2761667},{id:3,name:"Afyonkarahisar",lat:38.76376,lon:30.54034},{id:4,name:"Ar",lat:39.7216667,lon:43.0566667},{id:5,name:"Amasya",lat:40.65,lon:35.8333333},{id:6,name:"Ankara",lat:39.92077,lon:32.85411},{id:7,name:"Antalya",lat:36.88414,lon:30.70563},{id:8,name:"Artvin",lat:41.1833333,lon:41.8166667},{id:9,name:"Aydn",lat:37.8444,lon:27.8458},{id:10,name:"Balkesir",lat:39.648369,lon:27.88261},{id:11,name:"Bilecik",lat:40.150131,lon:29.983061},{id:12,name:"Bingl",lat:38.885349,lon:40.498291},{id:13,name:"Bitlis",lat:38.4,lon:42.1166667},{id:14,name:"Bolu",lat:40.739479,lon:31.611561},{id:15,name:"Burdur",lat:37.726909,lon:30.288876},{id:16,name:"Bursa",lat:40.18257,lon:29.06687},{id:17,name:"anakkale",lat:40.155312,lon:26.41416},{id:18,name:"ankr",lat:40.6,lon:33.6166667},{id:19,name:"orum",lat:40.5505556,lon:34.9555556},{id:20,name:"Denizli",lat:37.77652,lon:29.08639},{id:21,name:"Diyarbakr",lat:37.91441,lon:40.230629},{id:22,name:"Edirne",lat:41.6666667,lon:26.5666667},{id:23,name:"Elaz",lat:38.680969,lon:39.226398},{id:24,name:"Erzincan",lat:39.75,lon:39.5},{id:25,name:"Erzurum",lat:39.9043189,lon:41.2678853},{id:26,name:"Eskiehir",lat:39.784302,lon:30.51922},{id:27,name:"Gaziantep",lat:37.06622,lon:37.38332},{id:28,name:"Giresun",lat:40.912811,lon:38.38953},{id:29,name:"Gmhane",lat:40.4602778,lon:39.4813889},{id:30,name:"Hakkari",lat:37.5833333,lon:43.7333333},{id:31,name:"Hatay",lat:36.4018488,lon:36.3498097},{id:32,name:"Isparta",lat:37.7666667,lon:30.55},{id:33,name:"Mersin",lat:36.8,lon:34.6333333},{id:34,name:"Istanbul",lat:41.00527,lon:28.97696},{id:35,name:"Izmir",lat:38.41885,lon:27.12872},{id:36,name:"Kars",lat:40.59267,lon:43.077831},{id:37,name:"Kastamonu",lat:41.38871,lon:33.78273},{id:38,name:"Kayseri",lat:38.7333333,lon:35.4833333},{id:39,name:"Krklareli",lat:41.7333333,lon:27.2166667},{id:40,name:"Krehir",lat:39.15,lon:34.1666667},{id:41,name:"Kocaeli",lat:40.8532704,lon:29.8815203},{id:42,name:"Konya",lat:37.8666667,lon:32.4833333},{id:43,name:"Ktahya",lat:39.4166667,lon:29.9833333},{id:44,name:"Malatya",lat:38.35519,lon:38.30946},{id:45,name:"Manisa",lat:38.619099,lon:27.428921},{id:46,name:"Kahramanmara",lat:37.5833333,lon:36.9333333},{id:47,name:"Mardin",lat:37.3122361,lon:40.735112},{id:48,name:"Mula",lat:37.2152778,lon:28.3636111},{id:49,name:"Mu",lat:38.7432926,lon:41.5064823},{id:50,name:"Nevehir",lat:38.62442,lon:34.723969},{id:51,name:"Nide",lat:37.9666667,lon:34.6833333},{id:52,name:"Ordu",lat:40.9833333,lon:37.8833333},{id:53,name:"Rize",lat:41.02005,lon:40.523449},{id:54,name:"Sakarya",lat:40.7568793,lon:30.378138},{id:55,name:"Samsun",lat:41.292782,lon:36.33128},{id:56,name:"Siirt",lat:37.94429,lon:41.93288},{id:57,name:"Sinop",lat:42.0264222,lon:35.1550745},{id:58,name:"Sivas",lat:39.747662,lon:37.017879},{id:59,name:"Tekirda",lat:40.9833333,lon:27.5166667},{id:60,name:"Tokat",lat:40.3166667,lon:36.55},{id:61,name:"Trabzon",lat:41,lon:39.7333333},{id:62,name:"Tunceli",lat:39.1079868,lon:39.5401672},{id:63,name:"anlurfa",lat:37.15,lon:38.8},{id:64,name:"Uak",lat:38.682301,lon:29.40819},{id:65,name:"Van",lat:38.4941667,lon:43.38},{id:66,name:"Yozgat",lat:39.82,lon:34.8044444},{id:67,name:"Zonguldak",lat:41.456409,lon:31.798731},{id:68,name:"Aksaray",lat:38.36869,lon:34.03698},{id:69,name:"Bayburt",lat:40.255169,lon:40.22488},{id:70,name:"Karaman",lat:37.17593,lon:33.228748},{id:71,name:"Krkkale",lat:39.846821,lon:33.515251},{id:72,name:"Batman",lat:37.881168,lon:41.13509},{id:73,name:"rnak",lat:37.5163889,lon:42.4611111},{id:74,name:"Bartn",lat:41.6344444,lon:32.3375},{id:75,name:"Ardahan",lat:41.110481,lon:42.702171},{id:76,name:"Idr",lat:39.9166667,lon:44.0333333},{id:77,name:"Yalova",lat:40.65,lon:29.2666667},{id:78,name:"Karabk",lat:41.2,lon:32.6333333},{id:79,name:"Kilis",lat:36.718399,lon:37.12122},{id:80,name:"Osmaniye",lat:37.06805,lon:36.261589},{id:81,name:"Dzce",lat:40.843849,lon:31.15654}];var ki=Math.PI,zr=ki*2,Pu=ki/180,aI=180/ki,lI=1440,cI=398600.8,Fs=6378.135,xa=60/Math.sqrt(Fs*Fs*Fs/cI),Cg=Fs*xa/60,uI=1/xa,ac=.001082616,hI=-253881e-11,dI=-165597e-11,lc=hI/ac,ud=2/3,pI=1440/(2*ki);function fI(a,n){for(var o=[31,a%4===0?29:28,31,30,31,30,31,31,30,31,30,31],h=Math.floor(n),g=1,w=0;h>w+o[g-1]&&g<12;)w+=o[g-1],g+=1;var x=g,c=h-w,k=(n-h)*24,O=Math.floor(k);k=(k-O)*60;var U=Math.floor(k),Y=(k-U)*60;return{mon:x,day:c,hr:O,minute:U,sec:Y}}function B0(a,n,o,h,g,w){var x=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;return 367*a-Math.floor(7*(a+Math.floor((n+9)/12))*.25)+Math.floor(275*n/9)+o+17210135e-1+((x/6e4+w/60+g)/60+h)/24}function E_(a,n,o,h,g,w){var x=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(a instanceof Date){var c=a;return B0(c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds())}return B0(a,n,o,h,g,w,x)}function Fb(a,n){var o=a.e3,h=a.ee2,g=a.peo,w=a.pgho,x=a.pho,c=a.pinco,k=a.plo,O=a.se2,U=a.se3,Y=a.sgh2,se=a.sgh3,xe=a.sgh4,$e=a.sh2,Ce=a.sh3,J=a.si2,Ye=a.si3,qe=a.sl2,He=a.sl3,et=a.sl4,at=a.t,Qe=a.xgh2,he=a.xgh3,oe=a.xgh4,ae=a.xh2,Ee=a.xh3,be=a.xi2,Se=a.xi3,de=a.xl2,Qt=a.xl3,mn=a.xl4,gt=a.zmol,vn=a.zmos,gn=n.init,St=n.opsmode,In=n.ep,jt=n.inclp,Ht=n.nodep,Qn=n.argpp,kn=n.mp,Et,xt,At,Wt,pn,Zt,ur,Sn,Fn,Vt,Jt,Cn,Mt,Kt,$t,Ot,tn,nn,Rn,xn,Xt,Pe=119459e-10,W=.01675,H=.00015835218,X=.0549;Xt=vn+Pe*at,gn==="y"&&(Xt=vn),xn=Xt+2*W*Math.sin(Xt),tn=Math.sin(xn),Vt=.5*tn*tn-.25,Jt=-.5*tn*Math.cos(xn);var fe=O*Vt+U*Jt,ge=J*Vt+Ye*Jt,V=qe*Vt+He*Jt+et*tn,Ie=Y*Vt+se*Jt+xe*tn,we=$e*Vt+Ce*Jt;Xt=gt+H*at,gn==="y"&&(Xt=gt),xn=Xt+2*X*Math.sin(Xt),tn=Math.sin(xn),Vt=.5*tn*tn-.25,Jt=-.5*tn*Math.cos(xn);var ke=h*Vt+o*Jt,Ge=be*Vt+Se*Jt,Be=de*Vt+Qt*Jt+mn*tn,it=Qe*Vt+he*Jt+oe*tn,ft=ae*Vt+Ee*Jt;return Cn=fe+ke,$t=ge+Ge,Ot=V+Be,Mt=Ie+it,Kt=we+ft,gn==="n"&&(Cn-=g,$t-=c,Ot-=k,Mt-=w,Kt-=x,jt+=$t,In+=Cn,Wt=Math.sin(jt),At=Math.cos(jt),jt>=.2?(Kt/=Wt,Mt-=At*Kt,Qn+=Mt,Ht+=Kt,kn+=Ot):(Zt=Math.sin(Ht),pn=Math.cos(Ht),Et=Wt*Zt,xt=Wt*pn,ur=Kt*pn+$t*At*Zt,Sn=-Kt*Zt+$t*At*pn,Et+=ur,xt+=Sn,Ht%=zr,Ht<0&&St==="a"&&(Ht+=zr),nn=kn+Qn+At*Ht,Fn=Ot+Mt-$t*Ht*Wt,nn+=Fn,Rn=Ht,Ht=Math.atan2(Et,xt),Ht<0&&St==="a"&&(Ht+=zr),Math.abs(Rn-Ht)>ki&&(Ht<Rn?Ht+=zr:Ht-=zr),kn+=Ot,Qn=nn-kn-At*Ht)),{ep:In,inclp:jt,nodep:Ht,argpp:Qn,mp:kn}}function mI(a){var n=a.epoch,o=a.ep,h=a.argpp,g=a.tc,w=a.inclp,x=a.nodep,c=a.np,k,O,U,Y,se,xe,$e,Ce,J,Ye,qe,He,et,at,Qe,he,oe,ae,Ee,be,Se,de,Qt,mn,gt,vn,gn,St,In,jt,Ht,Qn,kn,Et,xt,At,Wt,pn,Zt,ur,Sn,Fn,Vt,Jt,Cn,Mt,Kt,$t,Ot,tn,nn,Rn,xn,Xt,Pe,W,H,X,fe,ge,V,Ie,we,ke=.01675,Ge=.0549,Be=29864797e-13,it=47968065e-14,ft=.39785416,It=.91744867,kt=.1945905,Ft=-.98088458,Me=c,rn=o,An=Math.sin(x),Ct=Math.cos(x),Yt=Math.sin(h),_n=Math.cos(h),je=Math.sin(w),dt=Math.cos(w),Fe=rn*rn,wt=1-Fe,Nt=Math.sqrt(wt),jn=0,Ue=0,$n=0,Jn=0,Wi=0,mr=n+18261.5+g/1440,lt=(4.523602-.00092422029*mr)%zr,Rt=Math.sin(lt),Ut=Math.cos(lt),Cr=.91375164-.03568096*Ut,Di=Math.sqrt(1-Cr*Cr),nr=.089683511*Rt/Di,Dt=Math.sqrt(1-nr*nr),Xn=5.8351514+.001944368*mr,ci=.39785416*Rt/Di,Li=Dt*Ut+.91744867*nr*Rt;ci=Math.atan2(ci,Li),ci+=Xn-lt;var Kr=Math.cos(ci),Zi=Math.sin(ci);be=kt,Se=Ft,mn=It,gt=ft,de=Ct,Qt=An,qe=Be;for(var ls=1/Me,zi=0;zi<2;)zi+=1,k=be*de+Se*mn*Qt,U=-Se*de+be*mn*Qt,$e=-be*Qt+Se*mn*de,Ce=Se*gt,J=Se*Qt+be*mn*de,Ye=be*gt,O=dt*$e+je*Ce,Y=dt*J+je*Ye,se=-je*$e+dt*Ce,xe=-je*J+dt*Ye,He=k*_n+O*Yt,et=U*_n+Y*Yt,at=-k*Yt+O*_n,Qe=-U*Yt+Y*_n,he=se*Yt,oe=xe*Yt,ae=se*_n,Ee=xe*_n,V=12*He*He-3*at*at,Ie=24*He*et-6*at*Qe,we=12*et*et-3*Qe*Qe,Rn=3*(k*k+O*O)+V*Fe,xn=6*(k*U+O*Y)+Ie*Fe,Xt=3*(U*U+Y*Y)+we*Fe,Pe=-6*k*se+Fe*(-24*He*ae-6*at*he),W=-6*(k*xe+U*se)+Fe*(-24*(et*ae+He*Ee)+-6*(at*oe+Qe*he)),H=-6*U*xe+Fe*(-24*et*Ee-6*Qe*oe),X=6*O*se+Fe*(24*He*he-6*at*ae),fe=6*(Y*se+O*xe)+Fe*(24*(et*he+He*oe)-6*(Qe*ae+at*Ee)),ge=6*Y*xe+Fe*(24*et*oe-6*Qe*Ee),Rn=Rn+Rn+wt*V,xn=xn+xn+wt*Ie,Xt=Xt+Xt+wt*we,Kt=qe*ls,Mt=-.5*Kt/Nt,$t=Kt*Nt,Cn=-15*rn*$t,Ot=He*at+et*Qe,tn=et*at+He*Qe,nn=et*Qe-He*at,zi===1&&(vn=Cn,gn=Mt,St=Kt,In=$t,jt=Ot,Ht=tn,Qn=nn,kn=Rn,Et=xn,xt=Xt,At=Pe,Wt=W,pn=H,Zt=X,ur=fe,Sn=ge,Fn=V,Vt=Ie,Jt=we,be=Kr,Se=Zi,mn=Cr,gt=Di,de=Dt*Ct+nr*An,Qt=An*Dt-Ct*nr,qe=it);var br=(4.7199672+(.2299715*mr-Xn))%zr,Ln=(6.2565837+.017201977*mr)%zr,cs=2*vn*Ht,Xr=2*vn*Qn,yi=2*gn*Wt,Oi=2*gn*(pn-At),Yr=-2*St*Et,vo=-2*St*(xt-kn),Ur=-2*St*(-21-9*Fe)*ke,Mr=2*In*Vt,qn=2*In*(Jt-Fn),us=-18*In*ke,hs=-2*gn*ur,zn=-2*gn*(Sn-Zt),Ki=2*Cn*tn,ds=2*Cn*nn,ps=2*Mt*W,xo=2*Mt*(H-Pe),bo=-2*Kt*xn,Yo=-2*Kt*(Xt-Rn),Qo=-2*Kt*(-21-9*Fe)*Ge,Jo=2*$t*Ie,vl=2*$t*(we-V),Xi=-18*$t*Ge,Fi=-2*Mt*fe,ea=-2*Mt*(ge-X);return{snodm:An,cnodm:Ct,sinim:je,cosim:dt,sinomm:Yt,cosomm:_n,day:mr,e3:ds,ee2:Ki,em:rn,emsq:Fe,gam:Xn,peo:jn,pgho:Jn,pho:Wi,pinco:Ue,plo:$n,rtemsq:Nt,se2:cs,se3:Xr,sgh2:Mr,sgh3:qn,sgh4:us,sh2:hs,sh3:zn,si2:yi,si3:Oi,sl2:Yr,sl3:vo,sl4:Ur,s1:Cn,s2:Mt,s3:Kt,s4:$t,s5:Ot,s6:tn,s7:nn,ss1:vn,ss2:gn,ss3:St,ss4:In,ss5:jt,ss6:Ht,ss7:Qn,sz1:kn,sz2:Et,sz3:xt,sz11:At,sz12:Wt,sz13:pn,sz21:Zt,sz22:ur,sz23:Sn,sz31:Fn,sz32:Vt,sz33:Jt,xgh2:Jo,xgh3:vl,xgh4:Xi,xh2:Fi,xh3:ea,xi2:ps,xi3:xo,xl2:bo,xl3:Yo,xl4:Qo,nm:Me,z1:Rn,z2:xn,z3:Xt,z11:Pe,z12:W,z13:H,z21:X,z22:fe,z23:ge,z31:V,z32:Ie,z33:we,zmol:br,zmos:Ln}}function gI(a){var n=a.cosim,o=a.argpo,h=a.s1,g=a.s2,w=a.s3,x=a.s4,c=a.s5,k=a.sinim,O=a.ss1,U=a.ss2,Y=a.ss3,se=a.ss4,xe=a.ss5,$e=a.sz1,Ce=a.sz3,J=a.sz11,Ye=a.sz13,qe=a.sz21,He=a.sz23,et=a.sz31,at=a.sz33,Qe=a.t,he=a.tc,oe=a.gsto,ae=a.mo,Ee=a.mdot,be=a.no,Se=a.nodeo,de=a.nodedot,Qt=a.xpidot,mn=a.z1,gt=a.z3,vn=a.z11,gn=a.z13,St=a.z21,In=a.z23,jt=a.z31,Ht=a.z33,Qn=a.ecco,kn=a.eccsq,Et=a.emsq,xt=a.em,At=a.argpm,Wt=a.inclm,pn=a.mm,Zt=a.nm,ur=a.nodem,Sn=a.irez,Fn=a.atime,Vt=a.d2201,Jt=a.d2211,Cn=a.d3210,Mt=a.d3222,Kt=a.d4410,$t=a.d4422,Ot=a.d5220,tn=a.d5232,nn=a.d5421,Rn=a.d5433,xn=a.dedt,Xt=a.didt,Pe=a.dmdt,W=a.dnodt,H=a.domdt,X=a.del1,fe=a.del2,ge=a.del3,V=a.xfact,Ie=a.xlamo,we=a.xli,ke=a.xni,Ge,Be,it,ft,It,kt,Ft,Me,rn,An,Ct,Yt,_n,je,dt,Fe,wt,Nt,jn,Ue,$n,Jn,Wi,mr,lt,Rt,Ut,Cr,Di,nr,Dt,Xn,ci=17891679e-13,Li=21460748e-13,Kr=22123015e-14,Zi=17891679e-13,ls=73636953e-16,zi=21765803e-16,br=.0043752690880113,Ln=37393792e-14,cs=11428639e-14,Xr=.00015835218,yi=119459e-10;Sn=0,Zt<.0052359877&&Zt>.0034906585&&(Sn=1),Zt>=.00826&&Zt<=.00924&&xt>=.5&&(Sn=2);var Oi=O*yi*xe,Yr=U*yi*(J+Ye),vo=-yi*Y*($e+Ce-14-6*Et),Ur=se*yi*(et+at-6),Mr=-yi*U*(qe+He);(Wt<.052359877||Wt>ki-.052359877)&&(Mr=0),k!==0&&(Mr/=k);var qn=Ur-n*Mr;xn=Oi+h*Xr*c,Xt=Yr+g*Xr*(vn+gn),Pe=vo-Xr*w*(mn+gt-14-6*Et);var us=x*Xr*(jt+Ht-6),hs=-Xr*g*(St+In);(Wt<.052359877||Wt>ki-.052359877)&&(hs=0),H=qn+us,W=Mr,k!==0&&(H-=n/k*hs,W+=hs/k);var zn=0,Ki=(oe+he*br)%zr;if(xt+=xn*Qe,Wt+=Xt*Qe,At+=H*Qe,ur+=W*Qe,pn+=Pe*Qe,Sn!==0){if(nr=Math.pow(Zt/xa,ud),Sn===2){Dt=n*n;var ds=xt;xt=Qn;var ps=Et;Et=kn,Xn=xt*Et,je=-.306-(xt-.64)*.44,xt<=.65?(dt=3.616-13.247*xt+16.29*Et,wt=-19.302+117.39*xt-228.419*Et+156.591*Xn,Nt=-18.9068+109.7927*xt-214.6334*Et+146.5816*Xn,jn=-41.122+242.694*xt-471.094*Et+313.953*Xn,Ue=-146.407+841.88*xt-1629.014*Et+1083.435*Xn,$n=-532.114+3017.977*xt-5740.032*Et+3708.276*Xn):(dt=-72.099+331.819*xt-508.738*Et+266.724*Xn,wt=-346.844+1582.851*xt-2415.925*Et+1246.113*Xn,Nt=-342.585+1554.908*xt-2366.899*Et+1215.972*Xn,jn=-1052.797+4758.686*xt-7193.992*Et+3651.957*Xn,Ue=-3581.69+16178.11*xt-24462.77*Et+12422.52*Xn,xt>.715?$n=-5149.66+29936.92*xt-54087.36*Et+31324.56*Xn:$n=1464.74-4664.75*xt+3763.64*Et),xt<.7?(mr=-919.2277+4988.61*xt-9064.77*Et+5542.21*Xn,Jn=-822.71072+4568.6173*xt-8491.4146*Et+5337.524*Xn,Wi=-853.666+4690.25*xt-8624.77*Et+5341.4*Xn):(mr=-37995.78+161616.52*xt-229838.2*Et+109377.94*Xn,Jn=-51752.104+218913.95*xt-309468.16*Et+146349.42*Xn,Wi=-40023.88+170470.89*xt-242699.48*Et+115605.82*Xn),lt=k*k,Ge=.75*(1+2*n+Dt),Be=1.5*lt,ft=1.875*k*(1-2*n-3*Dt),It=-1.875*k*(1+2*n-3*Dt),Ft=35*lt*Ge,Me=39.375*lt*lt,rn=9.84375*k*(lt*(1-2*n-5*Dt)+.33333333*(-2+4*n+6*Dt)),An=k*(4.92187512*lt*(-2-4*n+10*Dt)+6.56250012*(1+2*n-3*Dt)),Ct=29.53125*k*(2-8*n+Dt*(-12+8*n+10*Dt)),Yt=29.53125*k*(-2-8*n+Dt*(12+8*n-10*Dt)),Cr=Zt*Zt,Di=nr*nr,Ut=3*Cr*Di,Rt=Ut*Zi,Vt=Rt*Ge*je,Jt=Rt*Be*dt,Ut*=nr,Rt=Ut*Ln,Cn=Rt*ft*wt,Mt=Rt*It*Nt,Ut*=nr,Rt=2*Ut*ls,Kt=Rt*Ft*jn,$t=Rt*Me*Ue,Ut*=nr,Rt=Ut*cs,Ot=Rt*rn*$n,tn=Rt*An*Wi,Rt=2*Ut*zi,nn=Rt*Ct*Jn,Rn=Rt*Yt*mr,Ie=(ae+Se+Se-(Ki+Ki))%zr,V=Ee+Pe+2*(de+W-br)-be,xt=ds,Et=ps}Sn===1&&(_n=1+Et*(-2.5+.8125*Et),wt=1+2*Et,Fe=1+Et*(-6+6.60937*Et),Ge=.75*(1+n)*(1+n),it=.9375*k*k*(1+3*n)-.75*(1+n),kt=1+n,kt*=1.875*kt*kt,X=3*Zt*Zt*nr*nr,fe=2*X*Ge*_n*ci,ge=3*X*kt*Fe*Kr*nr,X=X*it*wt*Li*nr,Ie=(ae+Se+o-Ki)%zr,V=Ee+Qt+Pe+H+W-(be+br)),we=Ie,ke=be,Fn=0,Zt=be+zn}return{em:xt,argpm:At,inclm:Wt,mm:pn,nm:Zt,nodem:ur,irez:Sn,atime:Fn,d2201:Vt,d2211:Jt,d3210:Cn,d3222:Mt,d4410:Kt,d4422:$t,d5220:Ot,d5232:tn,d5421:nn,d5433:Rn,dedt:xn,didt:Xt,dmdt:Pe,dndt:zn,dnodt:W,domdt:H,del1:X,del2:fe,del3:ge,xfact:V,xlamo:Ie,xli:we,xni:ke}}function U0(a){var n=(a-2451545)/36525,o=-62e-7*n*n*n+.093104*n*n+(876600*3600+8640184812866e-6)*n+67310.54841;return o=o*Pu/240%zr,o<0&&(o+=zr),o}function Uf(a,n,o,h,g,w,x){return a instanceof Date?U0(E_(a)):U0(a)}function _I(a){var n=a.ecco,o=a.epoch,h=a.inclo,g=a.opsmode,w=a.no,x=n*n,c=1-x,k=Math.sqrt(c),O=Math.cos(h),U=O*O,Y=Math.pow(xa/w,ud),se=.75*ac*(3*U-1)/(k*c),xe=se/(Y*Y),$e=Y*(1-xe*xe-xe*(1/3+134*xe*xe/81));xe=se/($e*$e),w/=1+xe;var Ce=Math.pow(xa/w,ud),J=Math.sin(h),Ye=Ce*c,qe=1-5*U,He=-qe-U-U,et=1/Ce,at=Ye*Ye,Qe=Ce*(1-n),he="n",oe;if(g==="a"){var ae=o-7305,Ee=Math.floor(ae+1e-8),be=ae-Ee,Se=.017202791694070362,de=1.7321343856509375,Qt=5075514194322695e-30,mn=Se+zr;oe=(de+Se*Ee+mn*be+ae*ae*Qt)%zr,oe<0&&(oe+=zr)}else oe=Uf(o+24332815e-1);return{no:w,method:he,ainv:et,ao:Ce,con41:He,con42:qe,cosio:O,cosio2:U,eccsq:x,omeosq:c,posq:at,rp:Qe,rteosq:k,sinio:J,gsto:oe}}function yI(a){var n=a.irez,o=a.d2201,h=a.d2211,g=a.d3210,w=a.d3222,x=a.d4410,c=a.d4422,k=a.d5220,O=a.d5232,U=a.d5421,Y=a.d5433,se=a.dedt,xe=a.del1,$e=a.del2,Ce=a.del3,J=a.didt,Ye=a.dmdt,qe=a.dnodt,He=a.domdt,et=a.argpo,at=a.argpdot,Qe=a.t,he=a.tc,oe=a.gsto,ae=a.xfact,Ee=a.xlamo,be=a.no,Se=a.atime,de=a.em,Qt=a.argpm,mn=a.inclm,gt=a.xli,vn=a.mm,gn=a.xni,St=a.nodem,In=a.nm,jt=.13130908,Ht=2.8843198,Qn=.37448087,kn=5.7686396,Et=.95240898,xt=1.8014998,At=1.050833,Wt=4.4108898,pn=.0043752690880113,Zt=720,ur=-720,Sn=259200,Fn,Vt,Jt,Cn,Mt,Kt,$t,Ot,tn=0,nn=0,Rn=(oe+he*pn)%zr;if(de+=se*Qe,mn+=J*Qe,Qt+=He*Qe,St+=qe*Qe,vn+=Ye*Qe,n!==0){(Se===0||Qe*Se<=0||Math.abs(Qe)<Math.abs(Se))&&(Se=0,gn=be,gt=Ee),Qe>0?Fn=Zt:Fn=ur;for(var xn=381;xn===381;)n!==2?($t=xe*Math.sin(gt-jt)+$e*Math.sin(2*(gt-Ht))+Ce*Math.sin(3*(gt-Qn)),Mt=gn+ae,Kt=xe*Math.cos(gt-jt)+2*$e*Math.cos(2*(gt-Ht))+3*Ce*Math.cos(3*(gt-Qn)),Kt*=Mt):(Ot=et+at*Se,Jt=Ot+Ot,Vt=gt+gt,$t=o*Math.sin(Jt+gt-kn)+h*Math.sin(gt-kn)+g*Math.sin(Ot+gt-Et)+w*Math.sin(-Ot+gt-Et)+x*Math.sin(Jt+Vt-xt)+c*Math.sin(Vt-xt)+k*Math.sin(Ot+gt-At)+O*Math.sin(-Ot+gt-At)+U*Math.sin(Ot+Vt-Wt)+Y*Math.sin(-Ot+Vt-Wt),Mt=gn+ae,Kt=o*Math.cos(Jt+gt-kn)+h*Math.cos(gt-kn)+g*Math.cos(Ot+gt-Et)+w*Math.cos(-Ot+gt-Et)+k*Math.cos(Ot+gt-At)+O*Math.cos(-Ot+gt-At)+2*(x*Math.cos(Jt+Vt-xt)+c*Math.cos(Vt-xt)+U*Math.cos(Ot+Vt-Wt)+Y*Math.cos(-Ot+Vt-Wt)),Kt*=Mt),Math.abs(Qe-Se)>=Zt?xn=381:(nn=Qe-Se,xn=0),xn===381&&(gt+=Mt*Fn+$t*Sn,gn+=$t*Fn+Kt*Sn,Se+=Fn);In=gn+$t*nn+Kt*nn*nn*.5,Cn=gt+Mt*nn+$t*nn*nn*.5,n!==1?(vn=Cn-2*St+2*Rn,tn=In-be):(vn=Cn-St-Qt+Rn,tn=In-be),In=be+tn}return{atime:Se,em:de,argpm:Qt,inclm:mn,xli:gt,mm:vn,xni:gn,nodem:St,dndt:tn,nm:In}}var Ja;(function(a){a[a.None=0]="None",a[a.MeanEccentricityOutOfRange=1]="MeanEccentricityOutOfRange",a[a.MeanMotionBelowZero=2]="MeanMotionBelowZero",a[a.PerturbedEccentricityOutOfRange=3]="PerturbedEccentricityOutOfRange",a[a.SemiLatusRectumBelowZero=4]="SemiLatusRectumBelowZero",a[a.Decayed=6]="Decayed"})(Ja||(Ja={}));function Nb(a,n){var o,h,g,w,x,c,k,O,U,Y,se,xe,$e,Ce,J,Ye,qe,He,et,at,Qe,he,oe,ae,Ee,be,Se,de=15e-13;a.t=n,a.error=Ja.None;var Qt=a.mo+a.mdot*a.t,mn=a.argpo+a.argpdot*a.t,gt=a.nodeo+a.nodedot*a.t;U=mn,Qe=Qt;var vn=a.t*a.t;if(oe=gt+a.nodecf*vn,qe=1-a.cc1*a.t,He=a.bstar*a.cc4*a.t,et=a.t2cof*vn,a.isimp!==1){k=a.omgcof*a.t;var gn=1+a.eta*Math.cos(Qt);c=a.xmcof*(gn*gn*gn-a.delmo),Ye=k+c,Qe=Qt+Ye,U=mn-Ye,xe=vn*a.t,$e=xe*a.t,qe=qe-a.d2*vn-a.d3*xe-a.d4*$e,He+=a.bstar*a.cc5*(Math.sin(Qe)-a.sinmao),et=et+a.t3cof*xe+$e*(a.t4cof+a.t*a.t5cof)}he=a.no;var St=a.ecco;if(at=a.inclo,a.method==="d"){Ce=a.t;var In={irez:a.irez,d2201:a.d2201,d2211:a.d2211,d3210:a.d3210,d3222:a.d3222,d4410:a.d4410,d4422:a.d4422,d5220:a.d5220,d5232:a.d5232,d5421:a.d5421,d5433:a.d5433,dedt:a.dedt,del1:a.del1,del2:a.del2,del3:a.del3,didt:a.didt,dmdt:a.dmdt,dnodt:a.dnodt,domdt:a.domdt,argpo:a.argpo,argpdot:a.argpdot,t:a.t,tc:Ce,gsto:a.gsto,xfact:a.xfact,xlamo:a.xlamo,no:a.no,atime:a.atime,em:St,argpm:U,inclm:at,xli:a.xli,mm:Qe,xni:a.xni,nodem:oe,nm:he},jt=yI(In);St=jt.em,U=jt.argpm,at=jt.inclm,Qe=jt.mm,oe=jt.nodem,he=jt.nm}if(he<=0)return a.error=Ja.MeanMotionBelowZero,null;var Ht=Math.pow(xa/he,ud)*qe*qe;if(he=xa/Math.pow(Ht,1.5),St-=He,St>=1||St<-.001)return a.error=Ja.MeanEccentricityOutOfRange,null;St<1e-6&&(St=1e-6),Qe+=a.no*et,Ee=Qe+U+oe,oe%=zr,U%=zr,Ee%=zr,Qe=(Ee-U-oe)%zr;var Qn={am:Ht,em:St,im:at,Om:oe,om:U,mm:Qe,nm:he},kn=Math.sin(at),Et=Math.cos(at),xt=St;if(ae=at,Y=U,Se=oe,be=Qe,w=kn,g=Et,a.method==="d"){var At={inclo:a.inclo,init:"n",ep:xt,inclp:ae,nodep:Se,argpp:Y,mp:be,opsmode:a.operationmode},Wt=Fb(a,At);if(xt=Wt.ep,Se=Wt.nodep,Y=Wt.argpp,be=Wt.mp,ae=Wt.inclp,ae<0&&(ae=-ae,Se+=ki,Y-=ki),xt<0||xt>1)return a.error=Ja.PerturbedEccentricityOutOfRange,null}a.method==="d"&&(w=Math.sin(ae),g=Math.cos(ae),a.aycof=-.5*lc*w,Math.abs(g+1)>15e-13?a.xlcof=-.25*lc*w*(3+5*g)/(1+g):a.xlcof=-.25*lc*w*(3+5*g)/de);var pn=xt*Math.cos(Y);Ye=1/(Ht*(1-xt*xt));var Zt=xt*Math.sin(Y)+Ye*a.aycof,ur=be+Y+Se+Ye*a.xlcof*pn,Sn=(ur-Se)%zr;O=Sn,J=9999.9;for(var Fn=1;Math.abs(J)>=1e-12&&Fn<=10;)h=Math.sin(O),o=Math.cos(O),J=1-o*pn-h*Zt,J=(Sn-Zt*o+pn*h-O)/J,Math.abs(J)>=.95&&(J>0?J=.95:J=-.95),O+=J,Fn+=1;var Vt=pn*o+Zt*h,Jt=pn*h-Zt*o,Cn=pn*pn+Zt*Zt,Mt=Ht*(1-Cn);if(Mt<0)return a.error=Ja.SemiLatusRectumBelowZero,null;var Kt=Ht*(1-Vt),$t=Math.sqrt(Ht)*Jt/Kt,Ot=Math.sqrt(Mt)/Kt,tn=Math.sqrt(1-Cn);Ye=Jt/(1+tn);var nn=Ht/Kt*(h-Zt-pn*Ye),Rn=Ht/Kt*(o-pn+Zt*Ye);se=Math.atan2(nn,Rn);var xn=(Rn+Rn)*nn,Xt=1-2*nn*nn;Ye=1/Mt;var Pe=.5*ac*Ye,W=Pe*Ye;a.method==="d"&&(x=g*g,a.con41=3*x-1,a.x1mth2=1-x,a.x7thm1=7*x-1);var H=Kt*(1-1.5*W*tn*a.con41)+.5*Pe*a.x1mth2*Xt;if(H<1)return a.error=Ja.Decayed,null;se-=.25*W*a.x7thm1*xn;var X=Se+1.5*W*g*xn,fe=ae+1.5*W*g*w*Xt,ge=$t-he*Pe*a.x1mth2*xn/xa,V=Ot+he*Pe*(a.x1mth2*Xt+1.5*a.con41)/xa,Ie=Math.sin(se),we=Math.cos(se),ke=Math.sin(X),Ge=Math.cos(X),Be=Math.sin(fe),it=Math.cos(fe),ft=-ke*it,It=Ge*it,kt=ft*Ie+Ge*we,Ft=It*Ie+ke*we,Me=Be*Ie,rn=ft*we-Ge*Ie,An=It*we-ke*Ie,Ct=Be*we,Yt={x:H*kt*Fs,y:H*Ft*Fs,z:H*Me*Fs},_n={x:(ge*kt+V*rn)*Cg,y:(ge*Ft+V*An)*Cg,z:(ge*Me+V*Ct)*Cg};return{position:Yt,velocity:_n,meanElements:Qn}}function vI(a,n){var o=n.opsmode,h=n.epoch,g=n.xbstar,w=n.xecco,x=n.xargpo,c=n.xinclo,k=n.xmo,O=n.xno,U=n.xnodeo,Y,se,xe,$e,Ce,J,Ye,qe,He,et,at,Qe,he,oe,ae,Ee,be,Se,de,Qt,mn,gt,vn,gn,St,In,jt,Ht,Qn,kn,Et,xt,At,Wt,pn,Zt,ur,Sn,Fn,Vt,Jt,Cn,Mt,Kt,$t,Ot,tn,nn,Rn,xn,Xt,Pe,W,H,X,fe,ge=15e-13,V=a;V.isimp=0,V.method="n",V.aycof=0,V.con41=0,V.cc1=0,V.cc4=0,V.cc5=0,V.d2=0,V.d3=0,V.d4=0,V.delmo=0,V.eta=0,V.argpdot=0,V.omgcof=0,V.sinmao=0,V.t=0,V.t2cof=0,V.t3cof=0,V.t4cof=0,V.t5cof=0,V.x1mth2=0,V.x7thm1=0,V.mdot=0,V.nodedot=0,V.xlcof=0,V.xmcof=0,V.nodecf=0,V.irez=0,V.d2201=0,V.d2211=0,V.d3210=0,V.d3222=0,V.d4410=0,V.d4422=0,V.d5220=0,V.d5232=0,V.d5421=0,V.d5433=0,V.dedt=0,V.del1=0,V.del2=0,V.del3=0,V.didt=0,V.dmdt=0,V.dnodt=0,V.domdt=0,V.e3=0,V.ee2=0,V.peo=0,V.pgho=0,V.pho=0,V.pinco=0,V.plo=0,V.se2=0,V.se3=0,V.sgh2=0,V.sgh3=0,V.sgh4=0,V.sh2=0,V.sh3=0,V.si2=0,V.si3=0,V.sl2=0,V.sl3=0,V.sl4=0,V.gsto=0,V.xfact=0,V.xgh2=0,V.xgh3=0,V.xgh4=0,V.xh2=0,V.xh3=0,V.xi2=0,V.xi3=0,V.xl2=0,V.xl3=0,V.xl4=0,V.xlamo=0,V.zmol=0,V.zmos=0,V.atime=0,V.xli=0,V.xni=0,V.bstar=g,V.ecco=w,V.argpo=x,V.inclo=c,V.mo=k,V.no=O,V.nodeo=U,V.operationmode=o;var Ie=78/Fs+1,we=42/Fs,ke=we*we*we*we;V.init="y",V.t=0;var Ge={ecco:V.ecco,epoch:h,inclo:V.inclo,no:V.no,method:V.method,opsmode:V.operationmode},Be=_I(Ge),it=Be.ao,ft=Be.con42,It=Be.cosio,kt=Be.cosio2,Ft=Be.eccsq,Me=Be.omeosq,rn=Be.posq,An=Be.rp,Ct=Be.rteosq,Yt=Be.sinio;if(V.no=Be.no,V.con41=Be.con41,V.gsto=Be.gsto,V.a=Math.pow(V.no*uI,-2/3),V.alta=V.a*(1+V.ecco)-1,V.altp=V.a*(1-V.ecco)-1,V.error=0,Me>=0||V.no>=0){if(V.isimp=0,An<220/Fs+1&&(V.isimp=1),jt=Ie,mn=ke,Se=(An-1)*Fs,Se<156){jt=Se-78,Se<98&&(jt=20);var _n=(120-jt)/Fs;mn=_n*_n*_n*_n,jt=jt/Fs+1}de=1/rn,Ot=1/(it-jt),V.eta=it*V.ecco*Ot,Qe=V.eta*V.eta,at=V.ecco*V.eta,Qt=Math.abs(1-Qe),J=mn*Math.pow(Ot,4),Ye=J/Math.pow(Qt,3.5),$e=Ye*V.no*(it*(1+1.5*Qe+at*(4+Qe))+.375*ac*Ot/Qt*V.con41*(8+3*Qe*(8+Qe))),V.cc1=V.bstar*$e,Ce=0,V.ecco>1e-4&&(Ce=-2*J*Ot*lc*V.no*Yt/V.ecco),V.x1mth2=1-kt,V.cc4=2*V.no*Ye*it*Me*(V.eta*(2+.5*Qe)+V.ecco*(.5+2*Qe)-ac*Ot/(it*Qt)*(-3*V.con41*(1-2*at+Qe*(1.5-.5*at))+.75*V.x1mth2*(2*Qe-at*(1+Qe))*Math.cos(2*V.argpo))),V.cc5=2*Ye*it*Me*(1+2.75*(Qe+at)+at*Qe),qe=kt*kt,Mt=1.5*ac*de*V.no,Kt=.5*Mt*ac*de,$t=-.46875*dI*de*de*V.no,V.mdot=V.no+.5*Mt*Ct*V.con41+.0625*Kt*Ct*(13-78*kt+137*qe),V.argpdot=-.5*Mt*ft+.0625*Kt*(7-114*kt+395*qe)+$t*(3-36*kt+49*qe),nn=-Mt*It,V.nodedot=nn+(.5*Kt*(4-19*kt)+2*$t*(3-7*kt))*It,tn=V.argpdot+V.nodedot,V.omgcof=V.bstar*Ce*Math.cos(V.argpo),V.xmcof=0,V.ecco>1e-4&&(V.xmcof=-ud*J*V.bstar/at),V.nodecf=3.5*Me*nn*V.cc1,V.t2cof=1.5*V.cc1,Math.abs(It+1)>15e-13?V.xlcof=-.25*lc*Yt*(3+5*It)/(1+It):V.xlcof=-.25*lc*Yt*(3+5*It)/ge,V.aycof=-.5*lc*Yt;var je=1+V.eta*Math.cos(V.mo);if(V.delmo=je*je*je,V.sinmao=Math.sin(V.mo),V.x7thm1=7*kt-1,2*ki/V.no>=225){V.method="d",V.isimp=1,Jt=0,ae=V.inclo;var dt={epoch:h,ep:V.ecco,argpp:V.argpo,tc:Jt,inclp:V.inclo,nodep:V.nodeo,np:V.no,e3:V.e3,ee2:V.ee2,peo:V.peo,pgho:V.pgho,pho:V.pho,pinco:V.pinco,plo:V.plo,se2:V.se2,se3:V.se3,sgh2:V.sgh2,sgh3:V.sgh3,sgh4:V.sgh4,sh2:V.sh2,sh3:V.sh3,si2:V.si2,si3:V.si3,sl2:V.sl2,sl3:V.sl3,sl4:V.sl4,xgh2:V.xgh2,xgh3:V.xgh3,xgh4:V.xgh4,xh2:V.xh2,xh3:V.xh3,xi2:V.xi2,xi3:V.xi3,xl2:V.xl2,xl3:V.xl3,xl4:V.xl4,zmol:V.zmol,zmos:V.zmos},Fe=mI(dt);V.e3=Fe.e3,V.ee2=Fe.ee2,V.peo=Fe.peo,V.pgho=Fe.pgho,V.pho=Fe.pho,V.pinco=Fe.pinco,V.plo=Fe.plo,V.se2=Fe.se2,V.se3=Fe.se3,V.sgh2=Fe.sgh2,V.sgh3=Fe.sgh3,V.sgh4=Fe.sgh4,V.sh2=Fe.sh2,V.sh3=Fe.sh3,V.si2=Fe.si2,V.si3=Fe.si3,V.sl2=Fe.sl2,V.sl3=Fe.sl3,V.sl4=Fe.sl4,se=Fe.sinim,Y=Fe.cosim,He=Fe.em,et=Fe.emsq,gt=Fe.s1,vn=Fe.s2,gn=Fe.s3,St=Fe.s4,In=Fe.s5,Ht=Fe.ss1,Qn=Fe.ss2,kn=Fe.ss3,Et=Fe.ss4,xt=Fe.ss5,At=Fe.sz1,Wt=Fe.sz3,pn=Fe.sz11,Zt=Fe.sz13,ur=Fe.sz21,Sn=Fe.sz23,Fn=Fe.sz31,Vt=Fe.sz33,V.xgh2=Fe.xgh2,V.xgh3=Fe.xgh3,V.xgh4=Fe.xgh4,V.xh2=Fe.xh2,V.xh3=Fe.xh3,V.xi2=Fe.xi2,V.xi3=Fe.xi3,V.xl2=Fe.xl2,V.xl3=Fe.xl3,V.xl4=Fe.xl4,V.zmol=Fe.zmol,V.zmos=Fe.zmos,be=Fe.nm,Rn=Fe.z1,xn=Fe.z3,Xt=Fe.z11,Pe=Fe.z13,W=Fe.z21,H=Fe.z23,X=Fe.z31,fe=Fe.z33;var wt={inclo:ae,init:V.init,ep:V.ecco,inclp:V.inclo,nodep:V.nodeo,argpp:V.argpo,mp:V.mo,opsmode:V.operationmode},Nt=Fb(V,wt);V.ecco=Nt.ep,V.inclo=Nt.inclp,V.nodeo=Nt.nodep,V.argpo=Nt.argpp,V.mo=Nt.mp,he=0,oe=0,Ee=0;var jn={cosim:Y,emsq:et,argpo:V.argpo,s1:gt,s2:vn,s3:gn,s4:St,s5:In,sinim:se,ss1:Ht,ss2:Qn,ss3:kn,ss4:Et,ss5:xt,sz1:At,sz3:Wt,sz11:pn,sz13:Zt,sz21:ur,sz23:Sn,sz31:Fn,sz33:Vt,t:V.t,tc:Jt,gsto:V.gsto,mo:V.mo,mdot:V.mdot,no:V.no,nodeo:V.nodeo,nodedot:V.nodedot,xpidot:tn,z1:Rn,z3:xn,z11:Xt,z13:Pe,z21:W,z23:H,z31:X,z33:fe,ecco:V.ecco,eccsq:Ft,em:He,argpm:he,inclm:ae,mm:Ee,nm:be,nodem:oe,irez:V.irez,atime:V.atime,d2201:V.d2201,d2211:V.d2211,d3210:V.d3210,d3222:V.d3222,d4410:V.d4410,d4422:V.d4422,d5220:V.d5220,d5232:V.d5232,d5421:V.d5421,d5433:V.d5433,dedt:V.dedt,didt:V.didt,dmdt:V.dmdt,dnodt:V.dnodt,domdt:V.domdt,del1:V.del1,del2:V.del2,del3:V.del3,xfact:V.xfact,xlamo:V.xlamo,xli:V.xli,xni:V.xni},Ue=gI(jn);V.irez=Ue.irez,V.atime=Ue.atime,V.d2201=Ue.d2201,V.d2211=Ue.d2211,V.d3210=Ue.d3210,V.d3222=Ue.d3222,V.d4410=Ue.d4410,V.d4422=Ue.d4422,V.d5220=Ue.d5220,V.d5232=Ue.d5232,V.d5421=Ue.d5421,V.d5433=Ue.d5433,V.dedt=Ue.dedt,V.didt=Ue.didt,V.dmdt=Ue.dmdt,V.dnodt=Ue.dnodt,V.domdt=Ue.domdt,V.del1=Ue.del1,V.del2=Ue.del2,V.del3=Ue.del3,V.xfact=Ue.xfact,V.xlamo=Ue.xlamo,V.xli=Ue.xli,V.xni=Ue.xni}V.isimp!==1&&(xe=V.cc1*V.cc1,V.d2=4*it*Ot*xe,Cn=V.d2*Ot*V.cc1/3,V.d3=(17*it+jt)*Cn,V.d4=.5*Cn*it*Ot*(221*it+31*jt)*V.cc1,V.t3cof=V.d2+2*xe,V.t4cof=.25*(3*V.d3+V.cc1*(12*V.d2+10*xe)),V.t5cof=.2*(3*V.d4+12*V.cc1*V.d3+6*V.d2*V.d2+15*xe*(2*V.d2+xe)))}Nb(V,0),V.init="n"}function I_(a,n){var o="i",h=0,g=a.substring(2,7),w=parseInt(a.substring(18,20),10),x=parseFloat(a.substring(20,32)),c=parseFloat(a.substring(33,43)),k=parseFloat("".concat(a.substring(44,45),".").concat(a.substring(45,50),"E").concat(a.substring(50,52))),O=parseFloat("".concat(a.substring(53,54),".").concat(a.substring(54,59),"E").concat(a.substring(59,61))),U=parseFloat(n.substring(8,16))*Pu,Y=parseFloat(n.substring(17,25))*Pu,se=parseFloat(".".concat(n.substring(26,33))),xe=parseFloat(n.substring(34,42))*Pu,$e=parseFloat(n.substring(43,51))*Pu,Ce=parseFloat(n.substring(52,63))/pI,J=w<57?w+2e3:w+1900,Ye=fI(J,x),qe=Ye.mon,He=Ye.day,et=Ye.hr,at=Ye.minute,Qe=Ye.sec,he=E_(J,qe,He,et,at,Qe),oe={error:h,satnum:g,epochyr:w,epochdays:x,ndot:c,nddot:k,bstar:O,inclo:U,nodeo:Y,ecco:se,argpo:xe,mo:$e,no:Ce,jdsatepoch:he};return vI(oe,{opsmode:o,satn:oe.satnum,epoch:oe.jdsatepoch-24332815e-1,xbstar:oe.bstar,xecco:oe.ecco,xargpo:oe.argpo,xinclo:oe.inclo,xmo:oe.mo,xno:oe.no,xnodeo:oe.nodeo}),oe}function S_(a){for(var n=arguments.length,o=new Array(n>1?n-1:0),h=1;h<n;h++)o[h-1]=arguments[h];var g=E_.apply(void 0,o),w=(g-a.jdsatepoch)*lI;return Nb(a,w)}function Vb(a){return a*aI}function j0(a){return a*Pu}function Bb(a){if(a<-ki/2||a>ki/2)throw new RangeError("Latitude radians must be in range [-pi/2; pi/2].");return Vb(a)}function Ub(a){if(a<-ki||a>ki)throw new RangeError("Longitude radians must be in range [-pi; pi].");return Vb(a)}function xI(a){var n=a.longitude,o=a.latitude,h=a.height,g=6378.137,w=6356.7523142,x=(g-w)/g,c=2*x-x*x,k=g/Math.sqrt(1-c*(Math.sin(o)*Math.sin(o))),O=(k+h)*Math.cos(o)*Math.cos(n),U=(k+h)*Math.cos(o)*Math.sin(n),Y=(k*(1-c)+h)*Math.sin(o);return{x:O,y:U,z:Y}}function jb(a,n){for(var o=6378.137,h=6356.7523142,g=Math.sqrt(a.x*a.x+a.y*a.y),w=(o-h)/o,x=2*w-w*w,c=Math.atan2(a.y,a.x)-n;c<-ki;)c+=zr;for(;c>ki;)c-=zr;for(var k=20,O=0,U=Math.atan2(a.z,Math.sqrt(a.x*a.x+a.y*a.y)),Y;O++<k;)Y=1/Math.sqrt(1-x*(Math.sin(U)*Math.sin(U))),U=Math.atan2(a.z+o*Y*x*Math.sin(U),g);var se=g/Math.cos(U)-o*Y;return{longitude:c,latitude:U,height:se}}function bI(a,n){var o=a.x*Math.cos(n)+a.y*Math.sin(n),h=a.x*-Math.sin(n)+a.y*Math.cos(n),g=a.z;return{x:o,y:h,z:g}}function wI(a,n){var o=a.longitude,h=a.latitude,g=xI(a),w=n.x-g.x,x=n.y-g.y,c=n.z-g.z,k=Math.sin(h)*Math.cos(o)*w+Math.sin(h)*Math.sin(o)*x-Math.cos(h)*c,O=-Math.sin(o)*w+Math.cos(o)*x,U=Math.cos(h)*Math.cos(o)*w+Math.cos(h)*Math.sin(o)*x+Math.sin(h)*c;return{topS:k,topE:O,topZ:U}}function TI(a){var n=a.topS,o=a.topE,h=a.topZ,g=Math.sqrt(n*n+o*o+h*h),w=Math.asin(h/g),x=Math.atan2(-o,n)+ki;return{azimuth:x,elevation:w,rangeSat:g}}function EI(a,n){var o=wI(a,n);return TI(o)}const $b="iss_tle_cache_v1",II="https://celestrak.org/NORAD/elements/gp.php?CATNR=25544&FORMAT=TLE",SI=360*60*1e3;function AI(){try{const a=localStorage.getItem($b);return a?JSON.parse(a):null}catch{return null}}function PI(a,n){try{localStorage.setItem($b,JSON.stringify({line1:a,line2:n,ts:Date.now()}))}catch{}}function CI(a){const n=String(a).split(`
`).map(o=>o.trim()).filter(Boolean);if(n.length>=2){const o=n[n.length-1];return{line1:n[n.length-2],line2:o}}throw new Error("TLE parse failed")}async function A_({force:a=!1}={}){const n=AI(),o=Date.now();if(!a&&(n!=null&&n.line1)&&(n!=null&&n.line2)&&(n!=null&&n.ts)&&o-n.ts<SI)return{line1:n.line1,line2:n.line2,fromCache:!0};try{const h=await fetch(II,{cache:"no-store"});if(!h.ok)throw new Error("TLE fetch failed");const g=await h.text(),{line1:w,line2:x}=CI(g);return PI(w,x),{line1:w,line2:x,fromCache:!1}}catch(h){if(n!=null&&n.line1&&(n!=null&&n.line2))return{line1:n.line1,line2:n.line2,fromCache:!0,stale:!0};throw h}}function $0(a){return a*180/Math.PI}function MI(a,n,o,h,g){const w=S_(a,g);if(!w.position)return null;const x=Uf(g),c=bI(w.position,x),k={latitude:j0(n),longitude:j0(o),height:h},O=EI(k,c);return{elevation:$0(O.elevation),azimuth:$0(O.azimuth)}}function kI({satrec:a,obsLat:n,obsLon:o,startMs:h,endMs:g,stepMs:w}){let c=!1,k=null,O=null,U=null,Y=null,se=-999,xe=null;const $e=[];for(let Ce=h;Ce<=g;Ce+=w){const J=MI(a,n,o,0,new Date(Ce));if(!J)continue;const Ye=J.elevation,qe=J.azimuth,He=Ye>0;if(!c&&He&&(c=!0,k=Ce,O=qe,se=Ye,xe=Ce),c&&(Ye>se&&(se=Ye,xe=Ce),!He)){U=Ce,Y=qe;const et={aosMs:k,losMs:U,aosAz:O,losAz:Y,maxMs:xe||k,maxElev:Math.max(0,se),visible:se>=dn.MIN_ELEVATION};$e.push(et),c=!1,k=null,O=null,U=null,Y=null,se=-999,xe=null}}return c&&$e.push({aosMs:k,losMs:g,aosAz:O,losAz:0,maxMs:xe||k,maxElev:Math.max(0,se),visible:se>=dn.MIN_ELEVATION}),$e}async function RI({obsLat:a,obsLon:n}){const{line1:o,line2:h}=await A_(),g=I_(o,h),w=Date.now(),x=w+2160*60*1e3,c=10*1e3,k=kI({satrec:g,obsLat:a,obsLon:n,startMs:w,endMs:x,stepMs:c}),O=k.length?k[0]:null,U=k.find(Y=>Y.visible)||null;return{nextPass:O,nextVisiblePass:U}}async function DI({pastMinutes:a=45,futureMinutes:n=90,stepSeconds:o=60}={}){const{line1:h,line2:g}=await A_(),w=I_(h,g),x=new Date,c=[],k=[];for(let U=a*60;U>=0;U-=o){const Y=new Date(x.getTime()-U*1e3),se=Mg(w,Y);se&&c.push(se)}for(let U=o;U<=n*60;U+=o){const Y=new Date(x.getTime()+U*1e3),se=Mg(w,Y);se&&k.push(se)}const O=Mg(w,x);return console.log(`[Trajectory] Calculated: ${c.length} past, ${k.length} future points`),{past:c,future:k,current:O}}function Mg(a,n){try{const o=S_(a,n);if(!o.position)return null;const h=Uf(n),g=jb(o.position,h),w=Bb(g.latitude);let x=Ub(g.longitude);for(;x>180;)x-=360;for(;x<-180;)x+=360;return{lat:w,lng:x,alt:g.height,time:n.getTime()}}catch(o){return console.warn("[Trajectory] Propagation error:",o),null}}function LI(a){if(!a||a.length<2)return[];const n=[];let o=[[a[0].lng,a[0].lat]];for(let h=1;h<a.length;h++){const g=a[h-1],w=a[h];Math.abs(w.lng-g.lng)>180?(o.length>1&&n.push(o),o=[[w.lng,w.lat]]):o.push([w.lng,w.lat])}return o.length>1&&n.push(o),n}function q0(a){const n=LI(a);return n.length===0?{type:"Feature",geometry:{type:"MultiLineString",coordinates:[]}}:n.length===1?{type:"Feature",geometry:{type:"LineString",coordinates:n[0]}}:{type:"Feature",geometry:{type:"MultiLineString",coordinates:n}}}const zI="https://api.wheretheiss.at/v1/satellites/25544",OI="https://api.open-notify.org/iss-now.json";function jf(a,n){return{lat:Number(a.lat),lon:Number(a.lon),altKm:Number(a.altKm||408),velKmh:Number(a.velKmh||27580),source:n,ts:Date.now()}}async function FI(){const a=new AbortController,n=setTimeout(()=>a.abort(),5e3);try{const o=await fetch(zI,{cache:"no-store",signal:a.signal});if(clearTimeout(n),!o.ok)throw new Error(`HTTP ${o.status}`);const h=await o.json();return jf({lat:h.latitude,lon:h.longitude,altKm:h.altitude,velKmh:h.velocity},"wheretheiss")}catch(o){throw clearTimeout(n),new Error(`Primary failed: ${o.message}`)}}async function NI(){const a=new AbortController,n=setTimeout(()=>a.abort(),5e3);try{const o=await fetch(OI,{cache:"no-store",signal:a.signal});if(clearTimeout(n),!o.ok)throw new Error(`HTTP ${o.status}`);const h=await o.json();if(h.message!=="success")throw new Error("API returned failure");return jf({lat:h.iss_position.latitude,lon:h.iss_position.longitude},"open-notify")}catch(o){throw clearTimeout(n),new Error(`Secondary failed: ${o.message}`)}}async function VI(){try{const{line1:a,line2:n}=await A_(),o=I_(a,n),h=new Date,g=S_(o,h);if(!g.position)throw new Error("SGP4 propagation failed");const w=Uf(h),x=jb(g.position,w),c=Bb(x.latitude),k=Ub(x.longitude),O=x.height;return jf({lat:c,lon:k,altKm:O},"tle-sgp4")}catch(a){throw new Error(`Tertiary failed: ${a.message}`)}}async function BI(){try{const a=await FI();return console.log("[ISS]  Primary API success"),a}catch(a){console.warn("[ISS]  Primary failed:",a.message);try{const n=await NI();return console.log("[ISS]  Secondary API success"),n}catch(n){console.warn("[ISS]  Secondary failed:",n.message);try{const o=await VI();return console.log("[ISS]  Tertiary (TLE) success"),o}catch{return console.error("[ISS]  CRITICAL: All data streams failed. Switching to SIMULATION."),jf(UI(),"simulation")}}}}function UI(){const a=Date.now(),n=a/1e3/5560*(Math.PI*2),o=Math.sin(n)*51.6,h=a/1e3/10%360-180;return{lat:o,lon:h,altKm:420+Math.sin(a/1e4)*10,velKmh:27580+Math.cos(a/1e4)*50,source:"simulation"}}const el={smoothFactor:.06,dataInterval:3e3,positionThreshold:.001};let fo={lat:0,lng:0,alt:408},$i={lat:0,lng:0,alt:408},G0=null,Zg=!1,Kg=null,Xg=null;function jI(a,n,o){let h=n-a;h>180&&(h-=360),h<-180&&(h+=360);let g=a+h*o;return g>180&&(g-=360),g<-180&&(g+=360),g}function H0(a,n,o){return a+(n-a)*o}async function W0(){try{const a=await BI();a?(fo.lat=a.lat,fo.lng=a.lon,fo.alt=a.altKm||408,G0||($i.lat=fo.lat,$i.lng=fo.lng,$i.alt=fo.alt),G0={...a},Xg&&Xg(a),console.log(`[Motion]  Target updated: ${fo.lat.toFixed(4)}, ${fo.lng.toFixed(4)} [${a.source}]`)):console.warn("[Motion]  No data received, keeping last position")}catch(a){console.error("[Motion] Data fetch error:",a)}}function qb(){if(!Zg)return;const a=$i.lat,n=$i.lng;$i.lat=H0($i.lat,fo.lat,el.smoothFactor),$i.lng=jI($i.lng,fo.lng,el.smoothFactor),$i.alt=H0($i.alt,fo.alt,el.smoothFactor),(Math.abs($i.lat-a)>el.positionThreshold||Math.abs($i.lng-n)>el.positionThreshold)&&Kg&&Kg({lat:$i.lat,lng:$i.lng,alt:$i.alt}),requestAnimationFrame(qb)}function $I({onPosition:a,onData:n}={}){if(Zg){console.warn("[Motion] Already running");return}Kg=a||null,Xg=n||null,Zg=!0,console.log("[Motion]  Starting ISS motion system"),console.log(`[Motion] Config: smoothFactor=${el.smoothFactor}, interval=${el.dataInterval}ms`),W0(),setInterval(W0,el.dataInterval),requestAnimationFrame(qb)}function kg(a,n){const o=document.createElement(a);return n&&(o.className=n),o}const Gb="isshub:view_mode",Hb="isshub:focus_mode";function qI(){return localStorage.getItem(Gb)==="3d"?"3d":"2d"}function GI(){return localStorage.getItem(Hb)==="iss"?"iss":"earth"}function HI({initialMode:a="2d",onChange:n,onFocusChange:o}={}){try{const J=document.getElementById("isshub-viewmode-toggle");J&&J.remove()}catch{}const h=kg("div","view-toggle glass");h.id="isshub-viewmode-toggle",h.style.cssText=`
    position: fixed;
    right: 350px;
    bottom: 20px;
    z-index: 1300;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
  `;const g=kg("button","btn btn-primary view-mode-btn");g.type="button",g.style.cssText=`
    width: 44px;
    height: 44px;
    border-radius: 50%;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
  `,h.appendChild(g);const w=kg("button","btn btn-secondary focus-mode-btn");w.type="button",w.style.cssText=`
    width: 40px;
    height: 40px;
    border-radius: 50%;
    padding: 0;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    background: rgba(0, 180, 255, 0.3);
    border: 2px solid rgba(0, 200, 255, 0.6);
    color: #00d4ff;
    transition: all 0.3s ease;
  `,h.appendChild(w);let x=a==="3d"?"3d":"2d",c=GI();const k='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>',O='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>',U='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><ellipse cx="12" cy="12" rx="10" ry="4"/></svg>',Y='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="10" width="18" height="4" rx="1"/><rect x="1" y="8" width="4" height="8"/><rect x="19" y="8" width="4" height="8"/><circle cx="12" cy="12" r="2"/></svg>';function se(){const J=x==="3d"?"Switch to 2D Map":"Switch to 3D Globe";g.innerHTML=x==="3d"?k:O,g.title=J,g.setAttribute("aria-label",J);let Ye=document.getElementById("view-mode-label");if(Ye||(Ye=document.createElement("div"),Ye.id="view-mode-label",Ye.style.cssText=`
            background: var(--card);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            color: var(--text);
            font-size: 14px; /* Secondary text allow 14px? User said NO < 18px primary/secondary. */
            /* Checking rule: "No primary or secondary UI text may render below 18px" */
            /* So this must be 18px. */
            font-size: 18px;
            font-weight: 700;
            text-align: right;
            pointer-events: none;
            position: absolute;
            right: 60px; /* Left of the buttons */
            top: 0;
            white-space: nowrap;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            height: 44px; /* Match button height */
        `,h.appendChild(Ye)),Ye.textContent=x==="3d"?"Mod: 3D Kre":"Mod: 2D Harita",x==="3d")w.style.display="flex",xe();else{w.style.display="none";const qe=document.getElementById("focus-mode-label");qe&&(qe.style.display="none")}}function xe(){let J=document.getElementById("focus-mode-label");J||(J=document.createElement("div"),J.id="focus-mode-label",J.style.cssText=`
            background: var(--card);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            color: var(--text);
            font-size: 18px; /* Strict 18px */
            font-weight: 700;
            text-align: right;
            pointer-events: none;
            position: absolute;
            right: 60px;
            top: 52px; /* Below the first label */
            white-space: nowrap;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            height: 40px;
        `,h.appendChild(J)),J.style.display="flex",c==="iss"?(w.innerHTML=U,w.title="Switch to Earth View",w.style.background="rgba(255, 100, 50, 0.4)",w.style.borderColor="rgba(255, 150, 100, 0.8)",w.style.color="#ffaa66",J.textContent="Odak: ISS"):(w.innerHTML=Y,w.title="Focus on ISS",w.style.background="rgba(0, 180, 255, 0.3)",w.style.borderColor="rgba(0, 200, 255, 0.6)",w.style.color="#00d4ff",J.textContent="Odak: Dnya")}function $e(J){x=J==="3d"?"3d":"2d";try{localStorage.setItem(Gb,x)}catch{}se(),typeof n=="function"&&n(x)}function Ce(J){c=J==="iss"?"iss":"earth";try{localStorage.setItem(Hb,c)}catch{}xe(),typeof o=="function"&&o(c)}return g.addEventListener("click",J=>{J.preventDefault(),$e(x==="3d"?"2d":"3d")}),w.addEventListener("click",J=>{J.preventDefault(),Ce(c==="iss"?"earth":"iss")}),se(),{el:h,getMode:()=>x,setMode:$e,getFocusMode:()=>c,setFocusMode:Ce}}const Wb="isshub:language";let ya="tr";const Qs={en:{speed:"Speed",altitude:"Altitude",lat:"Latitude",lon:"Longitude",close:"Close",save:"Save",cancel:"Cancel",settings:"Settings",theme:"Theme",language:"Language",units:"Units",crew:"Crew",follow:"Follow",on:"ON",off:"OFF",connectionStable:"Connection stable",connectionLost:" Internet connection lost",connectionRestored:" Connection restored",daylight:"Daylight",eclipse:"Eclipse",tools:"Tools",location:"Location",changeLocation:"Change Location",passDepend:"Pass predictions depend on location",locationModalTitle:"Location Settings",locationModalDesc:"Select your location for accurate pass predictions",locGpsRequesting:"Requesting GPS location...",locGpsSuccess:"Location acquired",locGpsFailed:"GPS failed",locSearchFailed:"Search failed",locSaved:"Location saved",useMyLocation:"Use My Location (GPS)",searchLocation:"Search Location",searchPlaceholder:'Search: "London" / "Tokyo" ...',selection:"Selection",noSelection:"No selection",noResults:'No results. Try broader terms (e.g., "London").',searching:"Searching...",selectCity:"Select a city",followActive:"Tracking: ON",followInactive:"Tracking: OFF",passNoLocation:"No location set",passCalculating:"Calculating pass...",passNotFound:"No visible pass found",passError:"Pass calculation error",passCardTitle:"Next Pass",passVisible:" VISIBLE",passPoorAngle:" DIFFICULT (Low Angle: {deg})",passInvisible:" INVISIBLE",passNone:"No upcoming pass",passDetails:"Details",passClose:"Close",passDuration:"Duration",passFirstVisible:"First visible pass",passHoursMinutes:"{h}h {m}min later ({time})",passNotFoundDetails:"not found",passMinutes:"{min} min",globeLoadFailed:"3D Globe failed to load",globeError:"Globe error",bootReady:"App ready",locationSet:"Location set",offline:"Offline. Retrying...",staleData:"Data may be outdated",reconnecting:"Reconnecting...",trajectoryCalculating:"Calculating trajectory...",trajectoryError:"Trajectory error","hero.headline":"The ISS is currently over Earth","hero.subline.loading":"Calculating pass times...","hero.subline.pass":"Visible from your location in {minutes} minutes","hero.subline.permission":"Enable location to see when ISS passes overhead","hero.subline.unavailable":"Pass calculation unavailable","hero.cta.showPass":"Show Pass","hero.cta.liveTrack":"Live Track","hero.passCardComing":"Pass card is being prepared...",hudShowDetails:"Show details",hudHideDetails:"Hide details",hudDebug:"Debug",hudDebugReady:"Debug console ready",nasaLive:"NASA LIVE",cam1:"High Definition",cam2:"Standard Def",cam3:"Media TV",streamOffline:"Signal Lost / Offline",streamLocked:"Stream Unavailable",crewTitle:"Expedition Crew",daysInSpace:"{d} days in space",bioCdr:"Commander",bioFe:"Flight Engineer",helpTitle:"Help & Guide",helpDesc:"How to track the station",help:{tabAbout:"About ISS",tabGlossary:"Terms",tabTips:"Tips",aboutTitle:"What is the Space Station?",aboutText1:"The International Space Station (ISS) is a large laboratory flying in space. It orbits Earth 16 times every day.",aboutText2:"Astronauts live there to do science experiments. It looks like a very bright moving star in the sky.",aboutSize:"Size: 109 meters (Like a football field)",aboutSpeed:"Speed: 28,000 km/h (17,500 mph)",termAos:"Appearance (AOS)",defAos:"The time when the station rises above the horizon and becomes visible.",termLos:"Disappearance (LOS)",defLos:"The time when the station goes below the horizon or enters Earth's shadow.",termAlt:"Altitude",defAlt:"How high the station is above the ground (approx. 400 km).",termMag:"Brightness",defMag:"How bright it looks. Negative numbers (like -3.0) mean very bright!",tip1Title:"Look for a moving star",tip1Text:"It looks like a steady white light moving quickly across the sky. It does not blink.",tip2Title:"Best time to watch",tip2Text:"It is visible shortly after sunset or before sunrise.",tip3Title:"No telescope needed",tip3Text:"You can see it clearly with your naked eye."},notify:{title:"ISS Tracker Hub",body30m:"Heads up! ISS pass in 30 minutes.",body10m:"Get ready! ISS pass in 10 minutes.",btnAlertOn:" Alerts On",btnAlertOff:" Alerts Off",permDenied:" Alerts blocked. Please enable in browser settings.",keepOpen:" Keep tab open to receive alerts",label:"Alerts (30m & 10m)"},crewParams:{title:"Expedition Crew",labelStatic:" Reference Data (Not Real-Time)",roleCdr:"Commander",roleFe:"Flight Engineer",bio1:"Veteran cosmonaut and commander of the station.",bio2:"Flight engineer on his first long-duration mission.",bio3:"Researching microgravity fluid dynamics.",bio4:"US Navy test pilot and NASA astronaut.",bio5:"Physician and veteran of two previous spaceflights.",bio6:"Aerospace engineer on her rookie mission.",bio7:"Cosmonaut with background in aircraft radio engineering."},nasa:{title:"NASA Live",streamCam1:"ISS Cam 1 (HD)",streamTv:"NASA TV",streamMedia:"Media Channel",btnStart:" Start Live Stream",offline:"Stream Offline",locked:"Signal Locked"},weather:{code_0:"Clear sky",code_1:"Mainly clear",code_2:"Partly cloudy",code_3:"Overcast",code_45:"Fog",code_48:"Depositing rime fog",code_51:"Light drizzle",code_53:"Moderate drizzle",code_55:"Dense drizzle",code_61:"Slight rain",code_63:"Moderate rain",code_65:"Heavy rain",code_71:"Slight snow fall",code_73:"Moderate snow fall",code_75:"Heavy snow fall",code_80:"Slight rain showers",code_81:"Moderate rain showers",code_82:"Violent rain showers",code_95:"Thunderstorm",code_96:"Thunderstorm with hail",code_99:"Heavy thunderstorm",visLabel:"Visibility",visGood:"Good  ISS clearly visible",visPoor:"Low  Clouds might block view"},navMap:"Map",navTelemetry:"Telemetry",navPasses:"Passes",navSettings:"Settings",navNasaTV:"NASA TV",authLogin:"Sign In",authSignup:"Sign Up",authLogout:"Sign Out",authEmail:"Email",authPassword:"Password",authName:"Full Name",authForgotPassword:"Forgot password?",authNoAccount:"Don't have an account?",authHasAccount:"Already have an account?",authGoogleSignIn:"Continue with Google",authWelcome:"Welcome",authProfile:"Profile",addToCalendar:"Add to Calendar",calendarDownloaded:"Downloaded!",enableNotifications:"Enable Notifications",notificationsEnabled:"Notifications Enabled",passReminder:"ISS Pass Reminder",nasaNote:" Stream may have interruptions based on ISS signal status.",skinRealistic:"Realistic Mode",skinLiquid:"Liquid Mode",skinCyberpunk:"Cyberpunk Mode",nasaTitle:"NASA Live",nasaStart:"Start Stream",streamCam1:"HD View",streamTv:"NASA TV",streamMedia:"Media",crewParams:{title:"Expedition Crew",labelStatic:"Reference Data (Not Live)",bioCdr:"Commander",bioFe:"Flight Engineer",bio1:"Commander (Roscosmos)",bio2:"Flight Engineer (Roscosmos)",bio3:"Flight Engineer (NASA)",bio4:"Flight Engineer (NASA)",bio5:"Flight Engineer (NASA)",bio6:"Flight Engineer (NASA)",bio7:"Flight Engineer (Roscosmos)"}},tr:{speed:"Hz",altitude:"rtifa",lat:"Enlem",lon:"Boylam",close:"Kapat",save:"Kaydet",cancel:"ptal",settings:"Ayarlar",theme:"Tema",language:"Dil",units:"Birimler",crew:"Mrettebat",follow:"Takip",on:"AIK",off:"KAPALI",connectionStable:"Balant kararl",connectionLost:" nternet balants kesildi",connectionRestored:" Balant geri geldi",daylight:"Gndz",eclipse:"Tutulma (Gece)",tools:"Aralar",location:"Konum",changeLocation:"Konum Deitir",passDepend:"Gei tahminleri konuma baldr",locationModalTitle:"Konum Ayarlar",locationModalDesc:"Doru gei tahminleri iin konumunuzu sein",locGpsRequesting:"GPS konumu isteniyor...",locGpsSuccess:"Konum alnd",locGpsFailed:"GPS baarsz",locSearchFailed:"Arama baarsz",locSaved:"Konum kaydedildi",useMyLocation:"Konumumu Kullan (GPS)",searchLocation:"Arama ile Se",searchPlaceholder:'Ara: "Bursa" / "Istanbul" ...',selection:"Seim",noSelection:"Seim yaplmad",noResults:'Sonu yok. Daha genel yaz (rn: "Bursa").',searching:"Aranyor...",selectCity:"ehir sein",followActive:"Takip: Ak",followInactive:"Takip: Kapal",passNoLocation:"Konum belirtilmedi",passCalculating:"Gei hesaplanyor...",passNotFound:"Grnr gei bulunamad",passError:"Gei hesaplama hatas",passCardTitle:"Sradaki Gei",passVisible:" GRNR",passPoorAngle:" ZOR (Dk A: {deg})",passInvisible:" GRNMEZ",passNone:"Yaknda gei yok",passDetails:"Detaylar",passClose:"Kapat",passDuration:"Sre",passFirstVisible:"lk grnr gei",passHoursMinutes:"{h}sa {m}dk sonra ({time})",passNotFoundDetails:"bulunamad",passMinutes:"{min} dk",globeLoadFailed:"3D Kre yklenemedi",globeError:"Kre hatas",bootReady:"Uygulama hazr",locationSet:"Konum ayarland",offline:"evrimd. Tekrar deneniyor...",staleData:"Veriler gncel olmayabilir",reconnecting:"Yeniden balanlyor...",trajectoryCalculating:"Yrnge hesaplanyor...",trajectoryError:"Yrnge hatas","hero.headline":"ISS u an Dnya'nn zerinde","hero.subline.loading":"Gei hesaplanyor...","hero.subline.pass":"{minutes} dakika sonra bulunduun konumdan grlebilir","hero.subline.permission":"Konum izni vererek gei zamann ren","hero.subline.unavailable":"Gei hesaplamas kullanlamyor","hero.cta.showPass":"Geii Gster","hero.cta.liveTrack":"Canl Takip Et","hero.passCardComing":"Gei kart hazrlanyor...",hudShowDetails:"Detaylar gster",hudHideDetails:"Detaylar gizle",hudDebug:"Hata Ayklama",hudDebugReady:"Hata ayklama konsolu hazr",nasaLive:"NASA CANLI YAYIN",cam1:"Yksek Kalite (HD)",cam2:"Standart (SD)",cam3:"Medya TV",streamOffline:"Sinyal Yok / evrimd",streamLocked:"Yayn Kullanlamyor",crewTitle:"stasyon Mrettebat",daysInSpace:"{d} gndr uzayda",bioCdr:"Komutan",bioFe:"Uu Mhendisi",help:{tabAbout:"stasyon Nedir?",tabGlossary:"Terimler",tabTips:"pular",aboutTitle:"Uzay stasyonu Hakknda",aboutText1:"Uluslararas Uzay stasyonu (ISS), uzayda uan dev bir laboratuvardr. Dnya etrafnda gnde 16 tur atar.",aboutText2:"Astronotlar orada yaar ve deneyler yapar. Gkyznde ok parlak, hareket eden bir yldz gibi grnr.",aboutSize:"Boyut: 109 metre (Bir futbol sahas kadar)",aboutSpeed:"Hz: 28,000 km/s (Ses hzndan 10 kat hzl)",termAos:"Gr Balangc (AOS)",defAos:"stasyonun ufuktan ykselip grnr olmaya balad an.",termLos:"Gr Bitii (LOS)",defLos:"stasyonun ufuktan kaybolduu veya Dnya'nn glgesine girdii an.",termAlt:"Ykseklik (rtifa)",defAlt:"stasyonun yerden ne kadar yksekte olduu (yaklak 400 km).",termMag:"Parlaklk",defMag:"Ne kadar parlak grnddr. Eksi saylar (rnein -3.0) ok parlak demektir!",tip1Title:"Hareket eden yldza bakn",tip1Text:"Gkyznde hzla kayan parlak, beyaz bir k gibidir. Uaklar gibi yanp snmez.",tip2Title:"En iyi zaman",tip2Text:"Genellikle gn batmndan hemen sonra veya gn doumundan nce grlr.",tip3Title:"Teleskop gerekmez",tip3Text:"plak gzle ok rahat grlebilir."},notify:{title:"ISS Takip Merkezi",body30m:"Dikkat! ISS geiine 30 dakika var.",body10m:"Hazrlan! ISS geiine 10 dakika var.",btnAlertOn:" Bildirimler Ak",btnAlertOff:" Bildirimler Kapal",permDenied:" Bildirimler engellendi. Tarayc ayarlarndan izin verin.",keepOpen:" Bildirim almak iin sekmeyi ak tutun",label:"Uyarlar (30dk & 10dk)"},crewParams:{title:"Keif Mrettebat",labelStatic:" Referans Verisi (Canl Deil)",roleCdr:"Komutan",roleFe:"Uu Mhendisi",bio1:"Tecrbeli kozmonot ve istasyon komutan.",bio2:"lk uzun sreli grevindeki uu mhendisi.",bio3:"Mikro yerekimi sv dinamii aratrmacs.",bio4:"ABD Donanmas test pilotu ve astronot.",bio5:"Doktor ve nceki iki uzay uuunun gazisi.",bio6:"aylak grevindeki havaclk mhendisi.",bio7:"Uak radyo mhendislii gemiine sahip kozmonot."},nasa:{title:"NASA Canl",streamCam1:"ISS Kamera 1 (HD)",streamTv:"NASA TV",streamMedia:"Medya Kanal",btnStart:" Yayn Balat",offline:"Yayn Kapal",locked:"Sinyal Yok"},weather:{code_0:"Ak",code_1:"ounlukla ak",code_2:"Paral bulutlu",code_3:"Kapal",code_45:"Sisli",code_48:"Kral sis",code_51:"Hafif iseleme",code_53:"Orta iseleme",code_55:"Youn iseleme",code_61:"Hafif yamurlu",code_63:"Orta yamurlu",code_65:"iddetli yamurlu",code_71:"Hafif kar yal",code_73:"Orta kar yal",code_75:"Youn kar yal",code_80:"Hafif saanak",code_81:"Orta saanak",code_82:"iddetli saanak",code_95:"Frtna",code_96:"Dolu ile frtna",code_99:"iddetli frtna",visLabel:"Gr",visGood:"yi  ISS net grlebilir",visPoor:"Dk  Bulutlar engel olabilir"},navMap:"Harita",navTelemetry:"Telemetri",navPasses:"Geiler",navSettings:"Ayarlar",navNasaTV:"NASA TV",authLogin:"Giri Yap",authSignup:"Kayt Ol",authLogout:"k Yap",authEmail:"E-posta",authPassword:"ifre",authName:"Ad Soyad",authForgotPassword:"ifremi unuttum",authNoAccount:"Hesabnz yok mu?",authHasAccount:"Zaten hesabnz var m?",authGoogleSignIn:"Google ile devam et",authWelcome:"Ho geldin",authProfile:"Profil",addToCalendar:"Takvime Ekle",calendarDownloaded:"ndirildi!",enableNotifications:"Bildirimleri A",notificationsEnabled:"Bildirimler Ak",passReminder:"ISS Gei Hatrlatcs",nasaNote:" ISS sinyal durumuna gre canl yaynda kesintiler olabilir.",skinRealistic:"Gereki Mod",skinLiquid:"Sv Mod",skinCyberpunk:"Siberpunk Mod",nasaTitle:"NASA Canl",nasaStart:"Yayn Balat",streamCam1:"HD Grnt",streamTv:"NASA TV",streamMedia:"Medya",crewParams:{title:"Sefer Mrettebat",labelStatic:"Referans Verisi (Canl Deil)",bioCdr:"Komutan",bioFe:"Uu Mhendisi",bio1:"Komutan (Ruscosmos)",bio2:"Uu Mhendisi (Ruscosmos)",bio3:"Uu Mhendisi (NASA)",bio4:"Uu Mhendisi (NASA)",bio5:"Uu Mhendisi (NASA)",bio6:"Uu Mhendisi (NASA)",bio7:"Uu Mhendisi (Ruscosmos)"}},de:{},fr:{},es:{},it:{},ru:{},ja:{},zh:{},pt:{},hi:{},ar:{},bn:{},ko:{},nl:{},pl:{},ro:{},sv:{}};async function WI(){const a=localStorage.getItem(Wb);if(a&&Qs[a])ya=a;else{const o=(navigator.language||navigator.userLanguage).split("-")[0];Qs[o]?ya=o:ya="tr"}return Zb(ya),ya}function _o(){return ya}function ZI(a){Qs[a]||(a="en"),ya=a,localStorage.setItem(Wb,a),Zb(a),window.dispatchEvent(new CustomEvent("language-change",{detail:a}))}function rt(a){const n=Qs[ya],o=(x,c)=>{const k=c.split(".");let O=x;for(const U of k)if(O&&typeof O=="object"&&U in O)O=O[U];else return;return typeof O=="string"?O:void 0},h=o(n,a);if(h)return h;if(n&&n[a]&&typeof n[a]=="string")return n[a];const g=o(Qs.tr,a);if(g)return g;if(Qs.tr[a]&&typeof Qs.tr[a]=="string")return Qs.tr[a];const w=o(Qs.en,a);return w||(Qs.en[a]&&typeof Qs.en[a]=="string"?Qs.en[a]:(console.warn(`[i18n] Missing translation key: "${a}"`),a))}function KI(a,n){return ya==="en"?{speed:Math.round(a*.621371).toLocaleString("en-US"),speedUnit:"mph",altitude:(n*.621371).toFixed(1),altUnit:"mi"}:{speed:Math.round(a).toLocaleString("tr-TR"),speedUnit:"km/h",altitude:n.toFixed(1),altUnit:"km"}}function Zb(a){document.documentElement.lang=a,document.querySelectorAll("[data-i18n]").forEach(n=>{const o=n.dataset.i18n;o&&(n.textContent=rt(o))})}function Yh(a,n){const o=document.createElement(a);return n&&(o.className=n),o}function XI(){var x;const a=Yh("div","weather-badge glass");a.style.position="fixed",a.style.left="16px",a.style.bottom="16px",a.style.zIndex="25",a.style.padding="16px",a.style.minWidth="280px",a.style.display="flex",a.style.flexDirection="column",a.style.gap="4px";const n=Yh("div","weather-title");n.textContent=((x=rt("weather"))==null?void 0:x.visLabel)||"Hava durumu",n.style.fontSize="18px",n.style.fontWeight="900",n.style.color="var(--accent)",n.style.marginBottom="4px";const o=Yh("div","weather-line");o.textContent="",o.style.fontSize="18px",o.style.fontWeight="700",o.style.color="var(--text)";const h=Yh("div","weather-line muted");h.textContent="",h.style.fontSize="18px",h.style.color="var(--muted)";const g=Yh("div","weather-vis-hint");g.style.fontSize="18px",g.style.fontWeight="800",g.style.marginTop="8px",g.style.paddingTop="8px",g.style.borderTop="1px solid var(--ring)",g.style.display="none",a.append(n,o,h,g);function w({placeLabel:c,tempC:k,windKmh:O,codeLabel:U,timeLabel:Y,code:se}={}){var J,Ye;const xe=c?` ${c}`:"",$e=Number.isFinite(k)?`${Math.round(k)}C`:"",Ce=Number.isFinite(O)?`${Math.round(O)} km/h`:"";o.textContent=`${$e} ${U?`(${U})`:""} ${xe}`.trim(),h.textContent=`Rzgar: ${Ce}${Y?`  ${Y}`:""}`,Number.isFinite(se)?(g.style.display="block",Number(se)<=2?(g.textContent=((J=rt("weather"))==null?void 0:J.visGood)||" Good View",g.style.color="var(--good)"):(g.textContent=((Ye=rt("weather"))==null?void 0:Ye.visPoor)||" Poor View",g.style.color="var(--warning)")):g.style.display="none"}return{el:a,setState:w}}const YI=6e4;let Z0=null,K0=0,Rg=null;async function QI({lat:a,lon:n}={}){if(!Number.isFinite(a)||!Number.isFinite(n))throw new Error("WEATHER_BAD_COORDS");const o=`${a.toFixed(2)},${n.toFixed(2)}`,h=Date.now();if(o===Z0&&Rg&&h-K0<YI)return Rg;const g=new URL("https://api.open-meteo.com/v1/forecast");g.searchParams.set("latitude",String(a)),g.searchParams.set("longitude",String(n)),g.searchParams.set("current","temperature_2m,wind_speed_10m,weather_code"),g.searchParams.set("timezone","auto");const w=await fetch(g,{cache:"no-store"});if(!w.ok)throw new Error("WEATHER_API_FAIL");const x=await w.json(),c=x==null?void 0:x.current,k={tempC:Number(c==null?void 0:c.temperature_2m),windKmh:Number(c==null?void 0:c.wind_speed_10m),code:Number(c==null?void 0:c.weather_code),timeIso:typeof(c==null?void 0:c.time)=="string"?c.time:null};return Z0=o,K0=h,Rg=k,k}function JI(a){const n=Number(a);if(!Number.isFinite(n))return"";const o=`weather.code_${n}`,h=rt(o);return h&&h!==o?h:`Code ${n}`}const eS="https://nominatim.openstreetmap.org",tS="ISS-Tracker-HUB/1.0";async function nS(a,n){const o=new URL(`${eS}/reverse`);o.searchParams.set("lat",a.toString()),o.searchParams.set("lon",n.toString()),o.searchParams.set("format","json"),o.searchParams.set("addressdetails","1");try{const h=await fetch(o.toString(),{headers:{"User-Agent":tS}});if(!h.ok)throw new Error(`Reverse geocode error: ${h.status}`);const g=await h.json();return{displayName:g.display_name,address:g.address||{},lat:a,lon:n}}catch(h){return console.error("Reverse geocode error:",h),{displayName:`${a.toFixed(4)}, ${n.toFixed(4)}`,address:{},lat:a,lon:n}}}function rS(){return new Promise((a,n)=>{if(!navigator.geolocation){n(new Error("Geolocation not supported"));return}navigator.geolocation.getCurrentPosition(o=>{a({lat:o.coords.latitude,lon:o.coords.longitude})},o=>{n(o)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:3e5})})}const P_="isshub:userLocation";function iS(){return localStorage.getItem(P_)!==null}function sS(){const a=localStorage.getItem(P_);if(!a)return null;try{return JSON.parse(a)}catch{return null}}function oS(a){localStorage.setItem(P_,JSON.stringify(a))}function aS(a,n){if(iS()){const c=sS();c&&a&&a(c);return}const o=document.createElement("div");o.className="welcome-overlay",o.style.cssText=`
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    z-index: 5000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  `;const h=document.createElement("div");h.className="welcome-card hub-glass",h.style.cssText=`
    max-width: 500px;
    width: 100%;
    padding: 32px;
    text-align: center;
  `,h.innerHTML=`
    <div class="welcome-icon" style="font-size: 64px; margin-bottom: 16px;"></div>
    <h2 style="font-weight: 900; font-size: 24px; margin-bottom: 12px;">
      ISS'i Grmek ster misin?
    </h2>
    <p style="color: var(--muted); font-size: 14px; line-height: 1.6; margin-bottom: 24px;">
      ISS'in ne zaman gkyznde grnebileceini hesaplamak iin konumunuza ihtiyacmz var.
    </p>
    
    <div class="welcome-buttons" style="display: flex; flex-direction: column; gap: 12px;">
      <button type="button" class="btn-auto-location" style="
        padding: 14px 24px;
        border-radius: 12px;
        background: var(--accent);
        color: #000;
        border: none;
        font-weight: 800;
        font-size: 15px;
        cursor: pointer;
        transition: all 150ms;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      ">
        <span></span>
        <span>Konumu Otomatik Tespit Et</span>
      </button>
      
      <button type="button" class="btn-manual-location" style="
        padding: 14px 24px;
        border-radius: 12px;
        background: var(--card2);
        color: var(--text);
        border: 1px solid var(--ring);
        font-weight: 700;
        font-size: 14px;
        cursor: pointer;
        transition: all 150ms;
      ">
        Manuel Gir
      </button>
    </div>
    
    <div class="welcome-status" style="margin-top: 16px; min-height: 20px; font-size: 13px; color: var(--muted);"></div>
  `,o.appendChild(h),document.body.appendChild(o);const g=h.querySelector(".btn-auto-location"),w=h.querySelector(".btn-manual-location"),x=h.querySelector(".welcome-status");g.addEventListener("click",async()=>{g.disabled=!0,w.disabled=!0,x.textContent=" Konum tespit ediliyor...";try{const c=await rS();x.textContent=" Adres bilgisi alnyor...";const k=await nS(c.lat,c.lon),O={lat:c.lat,lon:c.lon,displayName:k.displayName,address:k.address,method:"auto"};oS(O),x.innerHTML=' <span style="color: var(--good);">Konum ayarland!</span>',setTimeout(()=>{o.remove(),a&&a(O)},1e3)}catch{x.innerHTML=' <span style="color: var(--bad);">Konum izni reddedildi veya alnamad</span>',g.disabled=!1,w.disabled=!1,setTimeout(()=>{x.textContent="Manuel giri kullanabilirsiniz"},2e3)}}),w.addEventListener("click",()=>{o.remove(),n&&n()})}const as={settings:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>',video:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',user:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',map:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>',globe:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>',sun:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>',moon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>',activity:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>',users:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>'},lS=[{key:"bioCdr",name:"Oleg Kononenko",country:"ru",bioKey:"bio1",photo:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Oleg_Kononenko_v2.jpg/480px-Oleg_Kononenko_v2.jpg",days:200},{key:"bioFe",name:"Nikolai Chub",country:"ru",bioKey:"bio2",photo:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/Nikolai_Chub_official_portrait.jpg/480px-Nikolai_Chub_official_portrait.jpg",days:200},{key:"bioFe",name:"Loral O'Hara",country:"us",bioKey:"bio3",photo:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Loral_O%27Hara_official_portrait.jpg/480px-Loral_O%27Hara_official_portrait.jpg",days:170},{key:"bioFe",name:"Matthew Dominick",country:"us",bioKey:"bio4",photo:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Matthew_Dominick_official_portrait.jpg/480px-Matthew_Dominick_official_portrait.jpg",days:25},{key:"bioFe",name:"Michael Barratt",country:"us",bioKey:"bio5",photo:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Michael_Reed_Barratt_v2.jpg/480px-Michael_Reed_Barratt_v2.jpg",days:25},{key:"bioFe",name:"Jeanette Epps",country:"us",bioKey:"bio6",photo:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Jeanette_Epps_official_portrait.jpg/480px-Jeanette_Epps_official_portrait.jpg",days:25},{key:"bioFe",name:"Alexander Grebenkin",country:"ru",bioKey:"bio7",photo:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/Alexander_Grebenkin_official_portrait.jpg/480px-Alexander_Grebenkin_official_portrait.jpg",days:25}],cS={us:"",ru:"",jp:"",esa:"",ca:""};function uS(){var h;const a=document.createElement("div");a.className="crew-board",a.style.cssText=`
        display: flex; flex-direction: column; gap: 16px; margin-top: 16px; width: 100%;
    `;const n=document.createElement("div");n.style.cssText=`
        background: rgba(255, 165, 0, 0.15);
        border: 1px solid rgba(255, 165, 0, 0.5);
        color: #ffca28;
        padding: 12px;
        border-radius: 8px;
        font-size: 18px; /* Strict 18px */
        font-weight: 700;
        text-align: center;
    `,n.textContent=((h=rt("crewParams"))==null?void 0:h.labelStatic)||" Reference Data (Not Live)",a.appendChild(n);const o=document.createElement("div");return o.style.cssText=`
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 16px;
    `,lS.forEach(g=>{const w=document.createElement("div");w.className="crew-card hub-glass",w.style.cssText=`
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
            background: rgba(10,10,10,0.6);
            display: flex;
            flex-direction: column;
        `;const x=document.createElement("div");x.style.cssText=`
            padding: 16px;
            display: flex;
            gap: 16px;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        `;const c=document.createElement("img");c.src=g.photo,c.onerror=()=>{c.src="https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png",c.style.filter="invert(1) opacity(0.8)"},c.style.cssText=`
            width: 72px; height: 72px; /* Large Image */
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent);
        `;const k=document.createElement("div"),O=rt("crewParams"),U=O?O[g.key]:g.key;k.innerHTML=`
            <div style="font-weight:700; font-size:20px; color: var(--text);">${g.name}</div>
            <div style="display:flex; gap:8px; font-size:18px; opacity:0.8; align-items:center; margin-top:4px;">
                <span>${cS[g.country]||""}</span>
                <span>${U}</span>
            </div>
            <div style="font-size:16px; color:var(--neon-green); margin-top:4px; font-weight:600;">
                ${rt("daysInSpace").replace("{d}",g.days)}
            </div>
        `,x.append(c,k);const Y=O?O[g.bioKey]:"Bio not found",se=document.createElement("div");se.style.cssText=`
            padding: 16px;
            font-size: 18px; /* Strict 18px */
            opacity: 0.9;
            line-height: 1.5;
            flex: 1;
            background: rgba(255,255,255,0.03);
        `,se.textContent=Y,w.append(x,se),o.append(w)}),a.appendChild(o),{el:a}}function Kb(){var c;if(document.querySelector(".crew-overlay"))return;const a=document.createElement("div");a.className="crew-overlay",a.style.display="flex",a.style.cssText=`
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
    z-index: 9999; display: flex; align-items: center; justify-content: center;
    padding: 20px;
  `;const n=document.createElement("div");n.className="crew-modal hub-glass",n.style.cssText=`
    width: 100%; max-width: 800px; max-height: 90vh;
    border-radius: 16px; background: var(--panel);
    border: 1px solid var(--border); display: flex; flex-direction: column;
    box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden;
  `;const o=document.createElement("div");o.style.cssText=`
    padding: 16px 24px; border-bottom: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center;
    background: rgba(255,255,255,0.02);
  `,o.innerHTML=`
    <div style="font-size: 24px; font-weight: 800; color: var(--accent);">
       ${((c=rt("crewParams"))==null?void 0:c.title)||"Expedition Crew"}
    </div>
    <button type="button" class="btn crew-close" style="font-size: 24px; background: transparent; border: none; color: var(--muted); cursor: pointer; min-width: 44px;"></button>
  `,n.appendChild(o);const h=document.createElement("div");h.className="crew-content",h.style.cssText=`
    flex: 1; overflow-y: auto; padding: 24px;
    display: flex; flex-direction: column; align-items: center;
  `;const g=uS();h.appendChild(g.el),n.appendChild(h),a.appendChild(n),document.body.appendChild(a);const w=o.querySelector(".crew-close"),x=()=>a.remove();w.onclick=x,a.onclick=k=>{k.target===a&&x()}}window.openCrewModal=Kb;function hS(a={}){const n=document.createElement("div");n.className="floating-hud glass-panel";const o=document.createElement("style");o.textContent=`
    .hud-metric { display: flex; flex-direction: column; align-items: start; min-width: 110px; }
    .hud-label { 
        font-size: 14px !important; 
        font-weight: 700; 
        color: var(--muted); 
        letter-spacing: 1px;
        margin-bottom: 6px;
    }
    .hud-value { 
        font-size: 36px !important; 
        font-weight: 800; 
        color: var(--text);
        line-height: 1;
        margin-bottom: 4px;
    }
    .hud-unit { 
        font-size: 14px !important; 
        color: var(--accent);
        font-weight: 600;
        opacity: 0.8;
    }
    .hud-coord-label { font-size: 14px !important; color: var(--muted); margin-bottom: 4px; }
    .hud-coord-value { font-size: 18px !important; font-weight: 700; font-family: var(--font-mono); }
    .hud-status-pill { font-size: 14px !important; padding: 6px 16px; margin-right: 12px; }
    .hud-vis-icon { font-size: 28px !important; }
  `,n.appendChild(o),(()=>{n.innerHTML=`
      <div class="hud-dashboard">
        <!-- Decoration: Top Border Line -->
        <div class="hud-deco-line"></div>
        
        <div class="hud-main-row">
          <!-- Left: Telemetry -->
          <div class="hud-section telemetry">
            <div class="hud-metric">
              <span class="hud-label">VELOCITY</span>
              <span class="hud-value" data-speed>--</span>
              <span class="hud-unit">KM/H</span>
            </div>
            <div class="hud-metric">
              <span class="hud-label">ALTITUDE</span>
              <span class="hud-value" data-altitude>--</span>
              <span class="hud-unit">KM</span>
            </div>
          </div>

          <!-- Center: Status & Location -->
          <div class="hud-section status">
             <div class="hud-location-box">
                <span class="hud-coord-label">LAT / LON</span>
                <span class="hud-coord-value" data-location>--.--, --.--</span>
             </div>
             <div class="hud-meta-row">
                <div class="hud-status-pill" data-status>${rt("connectionStable")}</div>
                <div class="hud-vis-icon" data-visibility>${as.sun}</div>
             </div>
          </div>

          <!-- Right: Controls -->
          <div class="hud-section controls">
             <button class="btn-cyber-mini crew-btn" title="${rt("crew")}" style="font-size: 18px;">
                ${as.users} <span style="font-size: 18px; font-weight: 700;">CREW</span>
             </button>
             <button class="btn-cyber-mini debug-btn" data-toggle="debug" title="LOGS" style="font-size: 18px;">
                ${as.terminal||"TERM"}
             </button>
          </div>
        </div>

        <!-- Debug Terminal (Collapsible) -->
        <div class="hud-debug-panel" style="display: none;">
           <div class="hud-terminal-header">SYSTEM LOGS</div>
           <div class="hud-terminal-content" data-terminal></div>
        </div>
      </div>
    `})();const g=n.querySelector("[data-speed]"),w=n.querySelector("[data-altitude]"),x=n.querySelector("[data-status]"),c=n.querySelector("[data-visibility]"),k=n.querySelector("[data-location]"),O=n.querySelector("[data-terminal]"),U=n.querySelector(".hud-debug-panel"),Y=n.querySelector("[data-toggle='debug']"),se=n.querySelector(".crew-btn");let xe={};Y==null||Y.addEventListener("click",()=>{const Ce=U.style.display!=="none";U.style.display=Ce?"none":"block",Y&&Y.classList.toggle("active",!Ce)}),se==null||se.addEventListener("click",()=>Kb()),window.addEventListener("language-change",()=>{statusText&&(statusText.textContent=rt("connectionStable")),se&&(se.setAttribute("title",rt("crew")),se.querySelector("span").textContent=rt("crew")),Y&&(Y.setAttribute("title",rt("hudDebug")),Y.querySelector("span").textContent=rt("hudDebug")),xe.velocity&&$e(xe)});function $e(Ce){xe={...xe,...Ce};const J=Ce.velocity??xe.velocity??27580,Ye=Ce.altitude??xe.altitude??420,{speed:qe,altitude:He}=KI(J,Ye);if(g&&(g.textContent=qe),w&&(w.textContent=He),Ce.latitude!==void 0&&Ce.longitude!==void 0&&k&&(k.textContent=`${Ce.latitude.toFixed(2)}, ${Ce.longitude.toFixed(2)}`),Ce.visibility!==void 0&&c){const et=Ce.visibility==="daylight"||Ce.visibility===!0;c.innerHTML=et?as.sun:as.moon,c.title=rt(et?"daylight":"eclipse"),c.className=`hud-vis-icon ${et?"day":"night"}`}}return $e({velocity:27580,altitude:420,visibility:"daylight"}),{el:n,update:$e,log(Ce){if(x&&(x.textContent=Ce.substring(0,30)),O){const J=document.createElement("div");for(J.className="terminal-line",J.textContent=`> ${Ce}`,O.appendChild(J);O.children.length>8;)O.removeChild(O.firstChild);O.scrollTop=O.scrollHeight}},getLogFn(){return Ce=>this.log(Ce)}}}const dS=()=>{};var X0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xb=function(a){const n=[];let o=0;for(let h=0;h<a.length;h++){let g=a.charCodeAt(h);g<128?n[o++]=g:g<2048?(n[o++]=g>>6|192,n[o++]=g&63|128):(g&64512)===55296&&h+1<a.length&&(a.charCodeAt(h+1)&64512)===56320?(g=65536+((g&1023)<<10)+(a.charCodeAt(++h)&1023),n[o++]=g>>18|240,n[o++]=g>>12&63|128,n[o++]=g>>6&63|128,n[o++]=g&63|128):(n[o++]=g>>12|224,n[o++]=g>>6&63|128,n[o++]=g&63|128)}return n},pS=function(a){const n=[];let o=0,h=0;for(;o<a.length;){const g=a[o++];if(g<128)n[h++]=String.fromCharCode(g);else if(g>191&&g<224){const w=a[o++];n[h++]=String.fromCharCode((g&31)<<6|w&63)}else if(g>239&&g<365){const w=a[o++],x=a[o++],c=a[o++],k=((g&7)<<18|(w&63)<<12|(x&63)<<6|c&63)-65536;n[h++]=String.fromCharCode(55296+(k>>10)),n[h++]=String.fromCharCode(56320+(k&1023))}else{const w=a[o++],x=a[o++];n[h++]=String.fromCharCode((g&15)<<12|(w&63)<<6|x&63)}}return n.join("")},Yb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(a,n){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();const o=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,h=[];for(let g=0;g<a.length;g+=3){const w=a[g],x=g+1<a.length,c=x?a[g+1]:0,k=g+2<a.length,O=k?a[g+2]:0,U=w>>2,Y=(w&3)<<4|c>>4;let se=(c&15)<<2|O>>6,xe=O&63;k||(xe=64,x||(se=64)),h.push(o[U],o[Y],o[se],o[xe])}return h.join("")},encodeString(a,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(a):this.encodeByteArray(Xb(a),n)},decodeString(a,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(a):pS(this.decodeStringToByteArray(a,n))},decodeStringToByteArray(a,n){this.init_();const o=n?this.charToByteMapWebSafe_:this.charToByteMap_,h=[];for(let g=0;g<a.length;){const w=o[a.charAt(g++)],c=g<a.length?o[a.charAt(g)]:0;++g;const O=g<a.length?o[a.charAt(g)]:64;++g;const Y=g<a.length?o[a.charAt(g)]:64;if(++g,w==null||c==null||O==null||Y==null)throw new fS;const se=w<<2|c>>4;if(h.push(se),O!==64){const xe=c<<4&240|O>>2;if(h.push(xe),Y!==64){const $e=O<<6&192|Y;h.push($e)}}}return h},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}};class fS extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const mS=function(a){const n=Xb(a);return Yb.encodeByteArray(n,!0)},yf=function(a){return mS(a).replace(/\./g,"")},Qb=function(a){try{return Yb.decodeString(a,!0)}catch(n){console.error("base64Decode failed: ",n)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _S=()=>gS().__FIREBASE_DEFAULTS__,yS=()=>{if(typeof process>"u"||typeof X0>"u")return;const a=X0.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},vS=()=>{if(typeof document>"u")return;let a;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const n=a&&Qb(a[1]);return n&&JSON.parse(n)},$f=()=>{try{return dS()||_S()||yS()||vS()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},Jb=a=>{var n,o;return(o=(n=$f())==null?void 0:n.emulatorHosts)==null?void 0:o[a]},e1=a=>{const n=Jb(a);if(!n)return;const o=n.lastIndexOf(":");if(o<=0||o+1===n.length)throw new Error(`Invalid host ${n} with no separate hostname and port!`);const h=parseInt(n.substring(o+1),10);return n[0]==="["?[n.substring(1,o-1),h]:[n.substring(0,o),h]},t1=()=>{var a;return(a=$f())==null?void 0:a.config},n1=a=>{var n;return(n=$f())==null?void 0:n[`_${a}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((n,o)=>{this.resolve=n,this.reject=o})}wrapCallback(n){return(o,h)=>{o?this.reject(o):this.resolve(h),typeof n=="function"&&(this.promise.catch(()=>{}),n.length===1?n(o):n(o,h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xc(a){try{return(a.startsWith("http://")||a.startsWith("https://")?new URL(a).hostname:a).endsWith(".cloudworkstations.dev")}catch{return!1}}async function C_(a){return(await fetch(a,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r1(a,n){if(a.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const o={alg:"none",type:"JWT"},h=n||"demo-project",g=a.iat||0,w=a.sub||a.user_id;if(!w)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const x={iss:`https://securetoken.google.com/${h}`,aud:h,iat:g,exp:g+3600,auth_time:g,sub:w,user_id:w,firebase:{sign_in_provider:"custom",identities:{}},...a};return[yf(JSON.stringify(o)),yf(JSON.stringify(x)),""].join(".")}const id={};function bS(){const a={prod:[],emulator:[]};for(const n of Object.keys(id))id[n]?a.emulator.push(n):a.prod.push(n);return a}function wS(a){let n=document.getElementById(a),o=!1;return n||(n=document.createElement("div"),n.setAttribute("id",a),o=!0),{created:o,element:n}}let Y0=!1;function M_(a,n){if(typeof window>"u"||typeof document>"u"||!xc(window.location.host)||id[a]===n||id[a]||Y0)return;id[a]=n;function o(se){return`__firebase__banner__${se}`}const h="__firebase__banner",w=bS().prod.length>0;function x(){const se=document.getElementById(h);se&&se.remove()}function c(se){se.style.display="flex",se.style.background="#7faaf0",se.style.position="fixed",se.style.bottom="5px",se.style.left="5px",se.style.padding=".5em",se.style.borderRadius="5px",se.style.alignItems="center"}function k(se,xe){se.setAttribute("width","24"),se.setAttribute("id",xe),se.setAttribute("height","24"),se.setAttribute("viewBox","0 0 24 24"),se.setAttribute("fill","none"),se.style.marginLeft="-6px"}function O(){const se=document.createElement("span");return se.style.cursor="pointer",se.style.marginLeft="16px",se.style.fontSize="24px",se.innerHTML=" &times;",se.onclick=()=>{Y0=!0,x()},se}function U(se,xe){se.setAttribute("id",xe),se.innerText="Learn more",se.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",se.setAttribute("target","__blank"),se.style.paddingLeft="5px",se.style.textDecoration="underline"}function Y(){const se=wS(h),xe=o("text"),$e=document.getElementById(xe)||document.createElement("span"),Ce=o("learnmore"),J=document.getElementById(Ce)||document.createElement("a"),Ye=o("preprendIcon"),qe=document.getElementById(Ye)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(se.created){const He=se.element;c(He),U(J,Ce);const et=O();k(qe,Ye),He.append(qe,$e,J,et),document.body.appendChild(He)}w?($e.innerText="Preview backend disconnected.",qe.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(qe.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,$e.innerText="Preview backend running in this workspace."),$e.setAttribute("id",xe)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",Y):Y()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hi(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function TS(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Hi())}function ES(){var n;const a=(n=$f())==null?void 0:n.forceEnvironment;if(a==="node")return!0;if(a==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function IS(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function SS(){const a=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof a=="object"&&a.id!==void 0}function AS(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function PS(){const a=Hi();return a.indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0}function CS(){return!ES()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function MS(){try{return typeof indexedDB=="object"}catch{return!1}}function kS(){return new Promise((a,n)=>{try{let o=!0;const h="validate-browser-context-for-indexeddb-analytics-module",g=self.indexedDB.open(h);g.onsuccess=()=>{g.result.close(),o||self.indexedDB.deleteDatabase(h),a(!0)},g.onupgradeneeded=()=>{o=!1},g.onerror=()=>{var w;n(((w=g.error)==null?void 0:w.message)||"")}}catch(o){n(o)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RS="FirebaseError";class Zo extends Error{constructor(n,o,h){super(o),this.code=n,this.customData=h,this.name=RS,Object.setPrototypeOf(this,Zo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bd.prototype.create)}}class bd{constructor(n,o,h){this.service=n,this.serviceName=o,this.errors=h}create(n,...o){const h=o[0]||{},g=`${this.service}/${n}`,w=this.errors[n],x=w?DS(w,h):"Error",c=`${this.serviceName}: ${x} (${g}).`;return new Zo(g,c,h)}}function DS(a,n){return a.replace(LS,(o,h)=>{const g=n[h];return g!=null?String(g):`<${h}?>`})}const LS=/\{\$([^}]+)}/g;function zS(a){for(const n in a)if(Object.prototype.hasOwnProperty.call(a,n))return!1;return!0}function pc(a,n){if(a===n)return!0;const o=Object.keys(a),h=Object.keys(n);for(const g of o){if(!h.includes(g))return!1;const w=a[g],x=n[g];if(Q0(w)&&Q0(x)){if(!pc(w,x))return!1}else if(w!==x)return!1}for(const g of h)if(!o.includes(g))return!1;return!0}function Q0(a){return a!==null&&typeof a=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wd(a){const n=[];for(const[o,h]of Object.entries(a))Array.isArray(h)?h.forEach(g=>{n.push(encodeURIComponent(o)+"="+encodeURIComponent(g))}):n.push(encodeURIComponent(o)+"="+encodeURIComponent(h));return n.length?"&"+n.join("&"):""}function Qh(a){const n={};return a.replace(/^\?/,"").split("&").forEach(h=>{if(h){const[g,w]=h.split("=");n[decodeURIComponent(g)]=decodeURIComponent(w)}}),n}function Jh(a){const n=a.indexOf("?");if(!n)return"";const o=a.indexOf("#",n);return a.substring(n,o>0?o:void 0)}function OS(a,n){const o=new FS(a,n);return o.subscribe.bind(o)}class FS{constructor(n,o){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=o,this.task.then(()=>{n(this)}).catch(h=>{this.error(h)})}next(n){this.forEachObserver(o=>{o.next(n)})}error(n){this.forEachObserver(o=>{o.error(n)}),this.close(n)}complete(){this.forEachObserver(n=>{n.complete()}),this.close()}subscribe(n,o,h){let g;if(n===void 0&&o===void 0&&h===void 0)throw new Error("Missing Observer.");NS(n,["next","error","complete"])?g=n:g={next:n,error:o,complete:h},g.next===void 0&&(g.next=Dg),g.error===void 0&&(g.error=Dg),g.complete===void 0&&(g.complete=Dg);const w=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?g.error(this.finalError):g.complete()}catch{}}),this.observers.push(g),w}unsubscribeOne(n){this.observers===void 0||this.observers[n]===void 0||(delete this.observers[n],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(n){if(!this.finalized)for(let o=0;o<this.observers.length;o++)this.sendOne(o,n)}sendOne(n,o){this.task.then(()=>{if(this.observers!==void 0&&this.observers[n]!==void 0)try{o(this.observers[n])}catch(h){typeof console<"u"&&console.error&&console.error(h)}})}close(n){this.finalized||(this.finalized=!0,n!==void 0&&(this.finalError=n),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function NS(a,n){if(typeof a!="object"||a===null)return!1;for(const o of n)if(o in a&&typeof a[o]=="function")return!0;return!1}function Dg(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _i(a){return a&&a._delegate?a._delegate:a}class ul{constructor(n,o,h){this.name=n,this.instanceFactory=o,this.type=h,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(n){return this.instantiationMode=n,this}setMultipleInstances(n){return this.multipleInstances=n,this}setServiceProps(n){return this.serviceProps=n,this}setInstanceCreatedCallback(n){return this.onInstanceCreated=n,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VS{constructor(n,o){this.name=n,this.container=o,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(n){const o=this.normalizeInstanceIdentifier(n);if(!this.instancesDeferred.has(o)){const h=new xS;if(this.instancesDeferred.set(o,h),this.isInitialized(o)||this.shouldAutoInitialize())try{const g=this.getOrInitializeService({instanceIdentifier:o});g&&h.resolve(g)}catch{}}return this.instancesDeferred.get(o).promise}getImmediate(n){const o=this.normalizeInstanceIdentifier(n==null?void 0:n.identifier),h=(n==null?void 0:n.optional)??!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(g){if(h)return null;throw g}else{if(h)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(n){if(n.name!==this.name)throw Error(`Mismatching Component ${n.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=n,!!this.shouldAutoInitialize()){if(US(n))try{this.getOrInitializeService({instanceIdentifier:oc})}catch{}for(const[o,h]of this.instancesDeferred.entries()){const g=this.normalizeInstanceIdentifier(o);try{const w=this.getOrInitializeService({instanceIdentifier:g});h.resolve(w)}catch{}}}}clearInstance(n=oc){this.instancesDeferred.delete(n),this.instancesOptions.delete(n),this.instances.delete(n)}async delete(){const n=Array.from(this.instances.values());await Promise.all([...n.filter(o=>"INTERNAL"in o).map(o=>o.INTERNAL.delete()),...n.filter(o=>"_delete"in o).map(o=>o._delete())])}isComponentSet(){return this.component!=null}isInitialized(n=oc){return this.instances.has(n)}getOptions(n=oc){return this.instancesOptions.get(n)||{}}initialize(n={}){const{options:o={}}=n,h=this.normalizeInstanceIdentifier(n.instanceIdentifier);if(this.isInitialized(h))throw Error(`${this.name}(${h}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const g=this.getOrInitializeService({instanceIdentifier:h,options:o});for(const[w,x]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(w);h===c&&x.resolve(g)}return g}onInit(n,o){const h=this.normalizeInstanceIdentifier(o),g=this.onInitCallbacks.get(h)??new Set;g.add(n),this.onInitCallbacks.set(h,g);const w=this.instances.get(h);return w&&n(w,h),()=>{g.delete(n)}}invokeOnInitCallbacks(n,o){const h=this.onInitCallbacks.get(o);if(h)for(const g of h)try{g(n,o)}catch{}}getOrInitializeService({instanceIdentifier:n,options:o={}}){let h=this.instances.get(n);if(!h&&this.component&&(h=this.component.instanceFactory(this.container,{instanceIdentifier:BS(n),options:o}),this.instances.set(n,h),this.instancesOptions.set(n,o),this.invokeOnInitCallbacks(h,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,h)}catch{}return h||null}normalizeInstanceIdentifier(n=oc){return this.component?this.component.multipleInstances?n:oc:n}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function BS(a){return a===oc?void 0:a}function US(a){return a.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jS{constructor(n){this.name=n,this.providers=new Map}addComponent(n){const o=this.getProvider(n.name);if(o.isComponentSet())throw new Error(`Component ${n.name} has already been registered with ${this.name}`);o.setComponent(n)}addOrOverwriteComponent(n){this.getProvider(n.name).isComponentSet()&&this.providers.delete(n.name),this.addComponent(n)}getProvider(n){if(this.providers.has(n))return this.providers.get(n);const o=new VS(n,this);return this.providers.set(n,o),o}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vn;(function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"})(Vn||(Vn={}));const $S={debug:Vn.DEBUG,verbose:Vn.VERBOSE,info:Vn.INFO,warn:Vn.WARN,error:Vn.ERROR,silent:Vn.SILENT},qS=Vn.INFO,GS={[Vn.DEBUG]:"log",[Vn.VERBOSE]:"log",[Vn.INFO]:"info",[Vn.WARN]:"warn",[Vn.ERROR]:"error"},HS=(a,n,...o)=>{if(n<a.logLevel)return;const h=new Date().toISOString(),g=GS[n];if(g)console[g](`[${h}]  ${a.name}:`,...o);else throw new Error(`Attempted to log a message with an invalid logType (value: ${n})`)};class k_{constructor(n){this.name=n,this._logLevel=qS,this._logHandler=HS,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(n){if(!(n in Vn))throw new TypeError(`Invalid value "${n}" assigned to \`logLevel\``);this._logLevel=n}setLogLevel(n){this._logLevel=typeof n=="string"?$S[n]:n}get logHandler(){return this._logHandler}set logHandler(n){if(typeof n!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=n}get userLogHandler(){return this._userLogHandler}set userLogHandler(n){this._userLogHandler=n}debug(...n){this._userLogHandler&&this._userLogHandler(this,Vn.DEBUG,...n),this._logHandler(this,Vn.DEBUG,...n)}log(...n){this._userLogHandler&&this._userLogHandler(this,Vn.VERBOSE,...n),this._logHandler(this,Vn.VERBOSE,...n)}info(...n){this._userLogHandler&&this._userLogHandler(this,Vn.INFO,...n),this._logHandler(this,Vn.INFO,...n)}warn(...n){this._userLogHandler&&this._userLogHandler(this,Vn.WARN,...n),this._logHandler(this,Vn.WARN,...n)}error(...n){this._userLogHandler&&this._userLogHandler(this,Vn.ERROR,...n),this._logHandler(this,Vn.ERROR,...n)}}const WS=(a,n)=>n.some(o=>a instanceof o);let J0,ex;function ZS(){return J0||(J0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function KS(){return ex||(ex=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const i1=new WeakMap,Yg=new WeakMap,s1=new WeakMap,Lg=new WeakMap,R_=new WeakMap;function XS(a){const n=new Promise((o,h)=>{const g=()=>{a.removeEventListener("success",w),a.removeEventListener("error",x)},w=()=>{o(ol(a.result)),g()},x=()=>{h(a.error),g()};a.addEventListener("success",w),a.addEventListener("error",x)});return n.then(o=>{o instanceof IDBCursor&&i1.set(o,a)}).catch(()=>{}),R_.set(n,a),n}function YS(a){if(Yg.has(a))return;const n=new Promise((o,h)=>{const g=()=>{a.removeEventListener("complete",w),a.removeEventListener("error",x),a.removeEventListener("abort",x)},w=()=>{o(),g()},x=()=>{h(a.error||new DOMException("AbortError","AbortError")),g()};a.addEventListener("complete",w),a.addEventListener("error",x),a.addEventListener("abort",x)});Yg.set(a,n)}let Qg={get(a,n,o){if(a instanceof IDBTransaction){if(n==="done")return Yg.get(a);if(n==="objectStoreNames")return a.objectStoreNames||s1.get(a);if(n==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return ol(a[n])},set(a,n,o){return a[n]=o,!0},has(a,n){return a instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in a}};function QS(a){Qg=a(Qg)}function JS(a){return a===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...o){const h=a.call(zg(this),n,...o);return s1.set(h,n.sort?n.sort():[n]),ol(h)}:KS().includes(a)?function(...n){return a.apply(zg(this),n),ol(i1.get(this))}:function(...n){return ol(a.apply(zg(this),n))}}function eA(a){return typeof a=="function"?JS(a):(a instanceof IDBTransaction&&YS(a),WS(a,ZS())?new Proxy(a,Qg):a)}function ol(a){if(a instanceof IDBRequest)return XS(a);if(Lg.has(a))return Lg.get(a);const n=eA(a);return n!==a&&(Lg.set(a,n),R_.set(n,a)),n}const zg=a=>R_.get(a);function tA(a,n,{blocked:o,upgrade:h,blocking:g,terminated:w}={}){const x=indexedDB.open(a,n),c=ol(x);return h&&x.addEventListener("upgradeneeded",k=>{h(ol(x.result),k.oldVersion,k.newVersion,ol(x.transaction),k)}),o&&x.addEventListener("blocked",k=>o(k.oldVersion,k.newVersion,k)),c.then(k=>{w&&k.addEventListener("close",()=>w()),g&&k.addEventListener("versionchange",O=>g(O.oldVersion,O.newVersion,O))}).catch(()=>{}),c}const nA=["get","getKey","getAll","getAllKeys","count"],rA=["put","add","delete","clear"],Og=new Map;function tx(a,n){if(!(a instanceof IDBDatabase&&!(n in a)&&typeof n=="string"))return;if(Og.get(n))return Og.get(n);const o=n.replace(/FromIndex$/,""),h=n!==o,g=rA.includes(o);if(!(o in(h?IDBIndex:IDBObjectStore).prototype)||!(g||nA.includes(o)))return;const w=async function(x,...c){const k=this.transaction(x,g?"readwrite":"readonly");let O=k.store;return h&&(O=O.index(c.shift())),(await Promise.all([O[o](...c),g&&k.done]))[0]};return Og.set(n,w),w}QS(a=>({...a,get:(n,o,h)=>tx(n,o)||a.get(n,o,h),has:(n,o)=>!!tx(n,o)||a.has(n,o)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iA{constructor(n){this.container=n}getPlatformInfoString(){return this.container.getProviders().map(o=>{if(sA(o)){const h=o.getImmediate();return`${h.library}/${h.version}`}else return null}).filter(o=>o).join(" ")}}function sA(a){const n=a.getComponent();return(n==null?void 0:n.type)==="VERSION"}const Jg="@firebase/app",nx="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ea=new k_("@firebase/app"),oA="@firebase/app-compat",aA="@firebase/analytics-compat",lA="@firebase/analytics",cA="@firebase/app-check-compat",uA="@firebase/app-check",hA="@firebase/auth",dA="@firebase/auth-compat",pA="@firebase/database",fA="@firebase/data-connect",mA="@firebase/database-compat",gA="@firebase/functions",_A="@firebase/functions-compat",yA="@firebase/installations",vA="@firebase/installations-compat",xA="@firebase/messaging",bA="@firebase/messaging-compat",wA="@firebase/performance",TA="@firebase/performance-compat",EA="@firebase/remote-config",IA="@firebase/remote-config-compat",SA="@firebase/storage",AA="@firebase/storage-compat",PA="@firebase/firestore",CA="@firebase/ai",MA="@firebase/firestore-compat",kA="firebase",RA="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e_="[DEFAULT]",DA={[Jg]:"fire-core",[oA]:"fire-core-compat",[lA]:"fire-analytics",[aA]:"fire-analytics-compat",[uA]:"fire-app-check",[cA]:"fire-app-check-compat",[hA]:"fire-auth",[dA]:"fire-auth-compat",[pA]:"fire-rtdb",[fA]:"fire-data-connect",[mA]:"fire-rtdb-compat",[gA]:"fire-fn",[_A]:"fire-fn-compat",[yA]:"fire-iid",[vA]:"fire-iid-compat",[xA]:"fire-fcm",[bA]:"fire-fcm-compat",[wA]:"fire-perf",[TA]:"fire-perf-compat",[EA]:"fire-rc",[IA]:"fire-rc-compat",[SA]:"fire-gcs",[AA]:"fire-gcs-compat",[PA]:"fire-fst",[MA]:"fire-fst-compat",[CA]:"fire-vertex","fire-js":"fire-js",[kA]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vf=new Map,LA=new Map,t_=new Map;function rx(a,n){try{a.container.addComponent(n)}catch(o){Ea.debug(`Component ${n.name} failed to register with FirebaseApp ${a.name}`,o)}}function fc(a){const n=a.name;if(t_.has(n))return Ea.debug(`There were multiple attempts to register component ${n}.`),!1;t_.set(n,a);for(const o of vf.values())rx(o,a);for(const o of LA.values())rx(o,a);return!0}function qf(a,n){const o=a.container.getProvider("heartbeat").getImmediate({optional:!0});return o&&o.triggerHeartbeat(),a.container.getProvider(n)}function ws(a){return a==null?!1:a.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zA={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},al=new bd("app","Firebase",zA);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OA{constructor(n,o,h){this._isDeleted=!1,this._options={...n},this._config={...o},this._name=o.name,this._automaticDataCollectionEnabled=o.automaticDataCollectionEnabled,this._container=h,this.container.addComponent(new ul("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(n){this.checkDestroyed(),this._automaticDataCollectionEnabled=n}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(n){this._isDeleted=n}checkDestroyed(){if(this.isDeleted)throw al.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bc=RA;function o1(a,n={}){let o=a;typeof n!="object"&&(n={name:n});const h={name:e_,automaticDataCollectionEnabled:!0,...n},g=h.name;if(typeof g!="string"||!g)throw al.create("bad-app-name",{appName:String(g)});if(o||(o=t1()),!o)throw al.create("no-options");const w=vf.get(g);if(w){if(pc(o,w.options)&&pc(h,w.config))return w;throw al.create("duplicate-app",{appName:g})}const x=new jS(g);for(const k of t_.values())x.addComponent(k);const c=new OA(o,h,x);return vf.set(g,c),c}function D_(a=e_){const n=vf.get(a);if(!n&&a===e_&&t1())return o1();if(!n)throw al.create("no-app",{appName:a});return n}function No(a,n,o){let h=DA[a]??a;o&&(h+=`-${o}`);const g=h.match(/\s|\//),w=n.match(/\s|\//);if(g||w){const x=[`Unable to register library "${h}" with version "${n}":`];g&&x.push(`library name "${h}" contains illegal characters (whitespace or "/")`),g&&w&&x.push("and"),w&&x.push(`version name "${n}" contains illegal characters (whitespace or "/")`),Ea.warn(x.join(" "));return}fc(new ul(`${h}-version`,()=>({library:h,version:n}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FA="firebase-heartbeat-database",NA=1,hd="firebase-heartbeat-store";let Fg=null;function a1(){return Fg||(Fg=tA(FA,NA,{upgrade:(a,n)=>{switch(n){case 0:try{a.createObjectStore(hd)}catch(o){console.warn(o)}}}}).catch(a=>{throw al.create("idb-open",{originalErrorMessage:a.message})})),Fg}async function VA(a){try{const o=(await a1()).transaction(hd),h=await o.objectStore(hd).get(l1(a));return await o.done,h}catch(n){if(n instanceof Zo)Ea.warn(n.message);else{const o=al.create("idb-get",{originalErrorMessage:n==null?void 0:n.message});Ea.warn(o.message)}}}async function ix(a,n){try{const h=(await a1()).transaction(hd,"readwrite");await h.objectStore(hd).put(n,l1(a)),await h.done}catch(o){if(o instanceof Zo)Ea.warn(o.message);else{const h=al.create("idb-set",{originalErrorMessage:o==null?void 0:o.message});Ea.warn(h.message)}}}function l1(a){return`${a.name}!${a.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BA=1024,UA=30;class jA{constructor(n){this.container=n,this._heartbeatsCache=null;const o=this.container.getProvider("app").getImmediate();this._storage=new qA(o),this._heartbeatsCachePromise=this._storage.read().then(h=>(this._heartbeatsCache=h,h))}async triggerHeartbeat(){var n,o;try{const g=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),w=sx();if(((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((o=this._heartbeatsCache)==null?void 0:o.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===w||this._heartbeatsCache.heartbeats.some(x=>x.date===w))return;if(this._heartbeatsCache.heartbeats.push({date:w,agent:g}),this._heartbeatsCache.heartbeats.length>UA){const x=GA(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(x,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(h){Ea.warn(h)}}async getHeartbeatsHeader(){var n;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const o=sx(),{heartbeatsToSend:h,unsentEntries:g}=$A(this._heartbeatsCache.heartbeats),w=yf(JSON.stringify({version:2,heartbeats:h}));return this._heartbeatsCache.lastSentHeartbeatDate=o,g.length>0?(this._heartbeatsCache.heartbeats=g,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),w}catch(o){return Ea.warn(o),""}}}function sx(){return new Date().toISOString().substring(0,10)}function $A(a,n=BA){const o=[];let h=a.slice();for(const g of a){const w=o.find(x=>x.agent===g.agent);if(w){if(w.dates.push(g.date),ox(o)>n){w.dates.pop();break}}else if(o.push({agent:g.agent,dates:[g.date]}),ox(o)>n){o.pop();break}h=h.slice(1)}return{heartbeatsToSend:o,unsentEntries:h}}class qA{constructor(n){this.app=n,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return MS()?kS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const o=await VA(this.app);return o!=null&&o.heartbeats?o:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(n){if(await this._canUseIndexedDBPromise){const h=await this.read();return ix(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??h.lastSentHeartbeatDate,heartbeats:n.heartbeats})}else return}async add(n){if(await this._canUseIndexedDBPromise){const h=await this.read();return ix(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??h.lastSentHeartbeatDate,heartbeats:[...h.heartbeats,...n.heartbeats]})}else return}}function ox(a){return yf(JSON.stringify({version:2,heartbeats:a})).length}function GA(a){if(a.length===0)return-1;let n=0,o=a[0].date;for(let h=1;h<a.length;h++)a[h].date<o&&(o=a[h].date,n=h);return n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HA(a){fc(new ul("platform-logger",n=>new iA(n),"PRIVATE")),fc(new ul("heartbeat",n=>new jA(n),"PRIVATE")),No(Jg,nx,a),No(Jg,nx,"esm2020"),No("fire-js","")}HA("");var ax=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ll,c1;(function(){var a;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function n(he,oe){function ae(){}ae.prototype=oe.prototype,he.F=oe.prototype,he.prototype=new ae,he.prototype.constructor=he,he.D=function(Ee,be,Se){for(var de=Array(arguments.length-2),Qt=2;Qt<arguments.length;Qt++)de[Qt-2]=arguments[Qt];return oe.prototype[be].apply(Ee,de)}}function o(){this.blockSize=-1}function h(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}n(h,o),h.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function g(he,oe,ae){ae||(ae=0);const Ee=Array(16);if(typeof oe=="string")for(var be=0;be<16;++be)Ee[be]=oe.charCodeAt(ae++)|oe.charCodeAt(ae++)<<8|oe.charCodeAt(ae++)<<16|oe.charCodeAt(ae++)<<24;else for(be=0;be<16;++be)Ee[be]=oe[ae++]|oe[ae++]<<8|oe[ae++]<<16|oe[ae++]<<24;oe=he.g[0],ae=he.g[1],be=he.g[2];let Se=he.g[3],de;de=oe+(Se^ae&(be^Se))+Ee[0]+3614090360&4294967295,oe=ae+(de<<7&4294967295|de>>>25),de=Se+(be^oe&(ae^be))+Ee[1]+3905402710&4294967295,Se=oe+(de<<12&4294967295|de>>>20),de=be+(ae^Se&(oe^ae))+Ee[2]+606105819&4294967295,be=Se+(de<<17&4294967295|de>>>15),de=ae+(oe^be&(Se^oe))+Ee[3]+3250441966&4294967295,ae=be+(de<<22&4294967295|de>>>10),de=oe+(Se^ae&(be^Se))+Ee[4]+4118548399&4294967295,oe=ae+(de<<7&4294967295|de>>>25),de=Se+(be^oe&(ae^be))+Ee[5]+1200080426&4294967295,Se=oe+(de<<12&4294967295|de>>>20),de=be+(ae^Se&(oe^ae))+Ee[6]+2821735955&4294967295,be=Se+(de<<17&4294967295|de>>>15),de=ae+(oe^be&(Se^oe))+Ee[7]+4249261313&4294967295,ae=be+(de<<22&4294967295|de>>>10),de=oe+(Se^ae&(be^Se))+Ee[8]+1770035416&4294967295,oe=ae+(de<<7&4294967295|de>>>25),de=Se+(be^oe&(ae^be))+Ee[9]+2336552879&4294967295,Se=oe+(de<<12&4294967295|de>>>20),de=be+(ae^Se&(oe^ae))+Ee[10]+4294925233&4294967295,be=Se+(de<<17&4294967295|de>>>15),de=ae+(oe^be&(Se^oe))+Ee[11]+2304563134&4294967295,ae=be+(de<<22&4294967295|de>>>10),de=oe+(Se^ae&(be^Se))+Ee[12]+1804603682&4294967295,oe=ae+(de<<7&4294967295|de>>>25),de=Se+(be^oe&(ae^be))+Ee[13]+4254626195&4294967295,Se=oe+(de<<12&4294967295|de>>>20),de=be+(ae^Se&(oe^ae))+Ee[14]+2792965006&4294967295,be=Se+(de<<17&4294967295|de>>>15),de=ae+(oe^be&(Se^oe))+Ee[15]+1236535329&4294967295,ae=be+(de<<22&4294967295|de>>>10),de=oe+(be^Se&(ae^be))+Ee[1]+4129170786&4294967295,oe=ae+(de<<5&4294967295|de>>>27),de=Se+(ae^be&(oe^ae))+Ee[6]+3225465664&4294967295,Se=oe+(de<<9&4294967295|de>>>23),de=be+(oe^ae&(Se^oe))+Ee[11]+643717713&4294967295,be=Se+(de<<14&4294967295|de>>>18),de=ae+(Se^oe&(be^Se))+Ee[0]+3921069994&4294967295,ae=be+(de<<20&4294967295|de>>>12),de=oe+(be^Se&(ae^be))+Ee[5]+3593408605&4294967295,oe=ae+(de<<5&4294967295|de>>>27),de=Se+(ae^be&(oe^ae))+Ee[10]+38016083&4294967295,Se=oe+(de<<9&4294967295|de>>>23),de=be+(oe^ae&(Se^oe))+Ee[15]+3634488961&4294967295,be=Se+(de<<14&4294967295|de>>>18),de=ae+(Se^oe&(be^Se))+Ee[4]+3889429448&4294967295,ae=be+(de<<20&4294967295|de>>>12),de=oe+(be^Se&(ae^be))+Ee[9]+568446438&4294967295,oe=ae+(de<<5&4294967295|de>>>27),de=Se+(ae^be&(oe^ae))+Ee[14]+3275163606&4294967295,Se=oe+(de<<9&4294967295|de>>>23),de=be+(oe^ae&(Se^oe))+Ee[3]+4107603335&4294967295,be=Se+(de<<14&4294967295|de>>>18),de=ae+(Se^oe&(be^Se))+Ee[8]+1163531501&4294967295,ae=be+(de<<20&4294967295|de>>>12),de=oe+(be^Se&(ae^be))+Ee[13]+2850285829&4294967295,oe=ae+(de<<5&4294967295|de>>>27),de=Se+(ae^be&(oe^ae))+Ee[2]+4243563512&4294967295,Se=oe+(de<<9&4294967295|de>>>23),de=be+(oe^ae&(Se^oe))+Ee[7]+1735328473&4294967295,be=Se+(de<<14&4294967295|de>>>18),de=ae+(Se^oe&(be^Se))+Ee[12]+2368359562&4294967295,ae=be+(de<<20&4294967295|de>>>12),de=oe+(ae^be^Se)+Ee[5]+4294588738&4294967295,oe=ae+(de<<4&4294967295|de>>>28),de=Se+(oe^ae^be)+Ee[8]+2272392833&4294967295,Se=oe+(de<<11&4294967295|de>>>21),de=be+(Se^oe^ae)+Ee[11]+1839030562&4294967295,be=Se+(de<<16&4294967295|de>>>16),de=ae+(be^Se^oe)+Ee[14]+4259657740&4294967295,ae=be+(de<<23&4294967295|de>>>9),de=oe+(ae^be^Se)+Ee[1]+2763975236&4294967295,oe=ae+(de<<4&4294967295|de>>>28),de=Se+(oe^ae^be)+Ee[4]+1272893353&4294967295,Se=oe+(de<<11&4294967295|de>>>21),de=be+(Se^oe^ae)+Ee[7]+4139469664&4294967295,be=Se+(de<<16&4294967295|de>>>16),de=ae+(be^Se^oe)+Ee[10]+3200236656&4294967295,ae=be+(de<<23&4294967295|de>>>9),de=oe+(ae^be^Se)+Ee[13]+681279174&4294967295,oe=ae+(de<<4&4294967295|de>>>28),de=Se+(oe^ae^be)+Ee[0]+3936430074&4294967295,Se=oe+(de<<11&4294967295|de>>>21),de=be+(Se^oe^ae)+Ee[3]+3572445317&4294967295,be=Se+(de<<16&4294967295|de>>>16),de=ae+(be^Se^oe)+Ee[6]+76029189&4294967295,ae=be+(de<<23&4294967295|de>>>9),de=oe+(ae^be^Se)+Ee[9]+3654602809&4294967295,oe=ae+(de<<4&4294967295|de>>>28),de=Se+(oe^ae^be)+Ee[12]+3873151461&4294967295,Se=oe+(de<<11&4294967295|de>>>21),de=be+(Se^oe^ae)+Ee[15]+530742520&4294967295,be=Se+(de<<16&4294967295|de>>>16),de=ae+(be^Se^oe)+Ee[2]+3299628645&4294967295,ae=be+(de<<23&4294967295|de>>>9),de=oe+(be^(ae|~Se))+Ee[0]+4096336452&4294967295,oe=ae+(de<<6&4294967295|de>>>26),de=Se+(ae^(oe|~be))+Ee[7]+1126891415&4294967295,Se=oe+(de<<10&4294967295|de>>>22),de=be+(oe^(Se|~ae))+Ee[14]+2878612391&4294967295,be=Se+(de<<15&4294967295|de>>>17),de=ae+(Se^(be|~oe))+Ee[5]+4237533241&4294967295,ae=be+(de<<21&4294967295|de>>>11),de=oe+(be^(ae|~Se))+Ee[12]+1700485571&4294967295,oe=ae+(de<<6&4294967295|de>>>26),de=Se+(ae^(oe|~be))+Ee[3]+2399980690&4294967295,Se=oe+(de<<10&4294967295|de>>>22),de=be+(oe^(Se|~ae))+Ee[10]+4293915773&4294967295,be=Se+(de<<15&4294967295|de>>>17),de=ae+(Se^(be|~oe))+Ee[1]+2240044497&4294967295,ae=be+(de<<21&4294967295|de>>>11),de=oe+(be^(ae|~Se))+Ee[8]+1873313359&4294967295,oe=ae+(de<<6&4294967295|de>>>26),de=Se+(ae^(oe|~be))+Ee[15]+4264355552&4294967295,Se=oe+(de<<10&4294967295|de>>>22),de=be+(oe^(Se|~ae))+Ee[6]+2734768916&4294967295,be=Se+(de<<15&4294967295|de>>>17),de=ae+(Se^(be|~oe))+Ee[13]+1309151649&4294967295,ae=be+(de<<21&4294967295|de>>>11),de=oe+(be^(ae|~Se))+Ee[4]+4149444226&4294967295,oe=ae+(de<<6&4294967295|de>>>26),de=Se+(ae^(oe|~be))+Ee[11]+3174756917&4294967295,Se=oe+(de<<10&4294967295|de>>>22),de=be+(oe^(Se|~ae))+Ee[2]+718787259&4294967295,be=Se+(de<<15&4294967295|de>>>17),de=ae+(Se^(be|~oe))+Ee[9]+3951481745&4294967295,he.g[0]=he.g[0]+oe&4294967295,he.g[1]=he.g[1]+(be+(de<<21&4294967295|de>>>11))&4294967295,he.g[2]=he.g[2]+be&4294967295,he.g[3]=he.g[3]+Se&4294967295}h.prototype.v=function(he,oe){oe===void 0&&(oe=he.length);const ae=oe-this.blockSize,Ee=this.C;let be=this.h,Se=0;for(;Se<oe;){if(be==0)for(;Se<=ae;)g(this,he,Se),Se+=this.blockSize;if(typeof he=="string"){for(;Se<oe;)if(Ee[be++]=he.charCodeAt(Se++),be==this.blockSize){g(this,Ee),be=0;break}}else for(;Se<oe;)if(Ee[be++]=he[Se++],be==this.blockSize){g(this,Ee),be=0;break}}this.h=be,this.o+=oe},h.prototype.A=function(){var he=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);he[0]=128;for(var oe=1;oe<he.length-8;++oe)he[oe]=0;oe=this.o*8;for(var ae=he.length-8;ae<he.length;++ae)he[ae]=oe&255,oe/=256;for(this.v(he),he=Array(16),oe=0,ae=0;ae<4;++ae)for(let Ee=0;Ee<32;Ee+=8)he[oe++]=this.g[ae]>>>Ee&255;return he};function w(he,oe){var ae=c;return Object.prototype.hasOwnProperty.call(ae,he)?ae[he]:ae[he]=oe(he)}function x(he,oe){this.h=oe;const ae=[];let Ee=!0;for(let be=he.length-1;be>=0;be--){const Se=he[be]|0;Ee&&Se==oe||(ae[be]=Se,Ee=!1)}this.g=ae}var c={};function k(he){return-128<=he&&he<128?w(he,function(oe){return new x([oe|0],oe<0?-1:0)}):new x([he|0],he<0?-1:0)}function O(he){if(isNaN(he)||!isFinite(he))return Y;if(he<0)return J(O(-he));const oe=[];let ae=1;for(let Ee=0;he>=ae;Ee++)oe[Ee]=he/ae|0,ae*=4294967296;return new x(oe,0)}function U(he,oe){if(he.length==0)throw Error("number format error: empty string");if(oe=oe||10,oe<2||36<oe)throw Error("radix out of range: "+oe);if(he.charAt(0)=="-")return J(U(he.substring(1),oe));if(he.indexOf("-")>=0)throw Error('number format error: interior "-" character');const ae=O(Math.pow(oe,8));let Ee=Y;for(let Se=0;Se<he.length;Se+=8){var be=Math.min(8,he.length-Se);const de=parseInt(he.substring(Se,Se+be),oe);be<8?(be=O(Math.pow(oe,be)),Ee=Ee.j(be).add(O(de))):(Ee=Ee.j(ae),Ee=Ee.add(O(de)))}return Ee}var Y=k(0),se=k(1),xe=k(16777216);a=x.prototype,a.m=function(){if(Ce(this))return-J(this).m();let he=0,oe=1;for(let ae=0;ae<this.g.length;ae++){const Ee=this.i(ae);he+=(Ee>=0?Ee:4294967296+Ee)*oe,oe*=4294967296}return he},a.toString=function(he){if(he=he||10,he<2||36<he)throw Error("radix out of range: "+he);if($e(this))return"0";if(Ce(this))return"-"+J(this).toString(he);const oe=O(Math.pow(he,6));var ae=this;let Ee="";for(;;){const be=et(ae,oe).g;ae=Ye(ae,be.j(oe));let Se=((ae.g.length>0?ae.g[0]:ae.h)>>>0).toString(he);if(ae=be,$e(ae))return Se+Ee;for(;Se.length<6;)Se="0"+Se;Ee=Se+Ee}},a.i=function(he){return he<0?0:he<this.g.length?this.g[he]:this.h};function $e(he){if(he.h!=0)return!1;for(let oe=0;oe<he.g.length;oe++)if(he.g[oe]!=0)return!1;return!0}function Ce(he){return he.h==-1}a.l=function(he){return he=Ye(this,he),Ce(he)?-1:$e(he)?0:1};function J(he){const oe=he.g.length,ae=[];for(let Ee=0;Ee<oe;Ee++)ae[Ee]=~he.g[Ee];return new x(ae,~he.h).add(se)}a.abs=function(){return Ce(this)?J(this):this},a.add=function(he){const oe=Math.max(this.g.length,he.g.length),ae=[];let Ee=0;for(let be=0;be<=oe;be++){let Se=Ee+(this.i(be)&65535)+(he.i(be)&65535),de=(Se>>>16)+(this.i(be)>>>16)+(he.i(be)>>>16);Ee=de>>>16,Se&=65535,de&=65535,ae[be]=de<<16|Se}return new x(ae,ae[ae.length-1]&-2147483648?-1:0)};function Ye(he,oe){return he.add(J(oe))}a.j=function(he){if($e(this)||$e(he))return Y;if(Ce(this))return Ce(he)?J(this).j(J(he)):J(J(this).j(he));if(Ce(he))return J(this.j(J(he)));if(this.l(xe)<0&&he.l(xe)<0)return O(this.m()*he.m());const oe=this.g.length+he.g.length,ae=[];for(var Ee=0;Ee<2*oe;Ee++)ae[Ee]=0;for(Ee=0;Ee<this.g.length;Ee++)for(let be=0;be<he.g.length;be++){const Se=this.i(Ee)>>>16,de=this.i(Ee)&65535,Qt=he.i(be)>>>16,mn=he.i(be)&65535;ae[2*Ee+2*be]+=de*mn,qe(ae,2*Ee+2*be),ae[2*Ee+2*be+1]+=Se*mn,qe(ae,2*Ee+2*be+1),ae[2*Ee+2*be+1]+=de*Qt,qe(ae,2*Ee+2*be+1),ae[2*Ee+2*be+2]+=Se*Qt,qe(ae,2*Ee+2*be+2)}for(he=0;he<oe;he++)ae[he]=ae[2*he+1]<<16|ae[2*he];for(he=oe;he<2*oe;he++)ae[he]=0;return new x(ae,0)};function qe(he,oe){for(;(he[oe]&65535)!=he[oe];)he[oe+1]+=he[oe]>>>16,he[oe]&=65535,oe++}function He(he,oe){this.g=he,this.h=oe}function et(he,oe){if($e(oe))throw Error("division by zero");if($e(he))return new He(Y,Y);if(Ce(he))return oe=et(J(he),oe),new He(J(oe.g),J(oe.h));if(Ce(oe))return oe=et(he,J(oe)),new He(J(oe.g),oe.h);if(he.g.length>30){if(Ce(he)||Ce(oe))throw Error("slowDivide_ only works with positive integers.");for(var ae=se,Ee=oe;Ee.l(he)<=0;)ae=at(ae),Ee=at(Ee);var be=Qe(ae,1),Se=Qe(Ee,1);for(Ee=Qe(Ee,2),ae=Qe(ae,2);!$e(Ee);){var de=Se.add(Ee);de.l(he)<=0&&(be=be.add(ae),Se=de),Ee=Qe(Ee,1),ae=Qe(ae,1)}return oe=Ye(he,be.j(oe)),new He(be,oe)}for(be=Y;he.l(oe)>=0;){for(ae=Math.max(1,Math.floor(he.m()/oe.m())),Ee=Math.ceil(Math.log(ae)/Math.LN2),Ee=Ee<=48?1:Math.pow(2,Ee-48),Se=O(ae),de=Se.j(oe);Ce(de)||de.l(he)>0;)ae-=Ee,Se=O(ae),de=Se.j(oe);$e(Se)&&(Se=se),be=be.add(Se),he=Ye(he,de)}return new He(be,he)}a.B=function(he){return et(this,he).h},a.and=function(he){const oe=Math.max(this.g.length,he.g.length),ae=[];for(let Ee=0;Ee<oe;Ee++)ae[Ee]=this.i(Ee)&he.i(Ee);return new x(ae,this.h&he.h)},a.or=function(he){const oe=Math.max(this.g.length,he.g.length),ae=[];for(let Ee=0;Ee<oe;Ee++)ae[Ee]=this.i(Ee)|he.i(Ee);return new x(ae,this.h|he.h)},a.xor=function(he){const oe=Math.max(this.g.length,he.g.length),ae=[];for(let Ee=0;Ee<oe;Ee++)ae[Ee]=this.i(Ee)^he.i(Ee);return new x(ae,this.h^he.h)};function at(he){const oe=he.g.length+1,ae=[];for(let Ee=0;Ee<oe;Ee++)ae[Ee]=he.i(Ee)<<1|he.i(Ee-1)>>>31;return new x(ae,he.h)}function Qe(he,oe){const ae=oe>>5;oe%=32;const Ee=he.g.length-ae,be=[];for(let Se=0;Se<Ee;Se++)be[Se]=oe>0?he.i(Se+ae)>>>oe|he.i(Se+ae+1)<<32-oe:he.i(Se+ae);return new x(be,he.h)}h.prototype.digest=h.prototype.A,h.prototype.reset=h.prototype.u,h.prototype.update=h.prototype.v,c1=h,x.prototype.add=x.prototype.add,x.prototype.multiply=x.prototype.j,x.prototype.modulo=x.prototype.B,x.prototype.compare=x.prototype.l,x.prototype.toNumber=x.prototype.m,x.prototype.toString=x.prototype.toString,x.prototype.getBits=x.prototype.i,x.fromNumber=O,x.fromString=U,ll=x}).apply(typeof ax<"u"?ax:typeof self<"u"?self:typeof window<"u"?window:{});var Zp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var u1,ed,h1,of,n_,d1,p1,f1;(function(){var a,n=Object.defineProperty;function o(E){E=[typeof globalThis=="object"&&globalThis,E,typeof window=="object"&&window,typeof self=="object"&&self,typeof Zp=="object"&&Zp];for(var L=0;L<E.length;++L){var $=E[L];if($&&$.Math==Math)return $}throw Error("Cannot find global object")}var h=o(this);function g(E,L){if(L)e:{var $=h;E=E.split(".");for(var ne=0;ne<E.length-1;ne++){var De=E[ne];if(!(De in $))break e;$=$[De]}E=E[E.length-1],ne=$[E],L=L(ne),L!=ne&&L!=null&&n($,E,{configurable:!0,writable:!0,value:L})}}g("Symbol.dispose",function(E){return E||Symbol("Symbol.dispose")}),g("Array.prototype.values",function(E){return E||function(){return this[Symbol.iterator]()}}),g("Object.entries",function(E){return E||function(L){var $=[],ne;for(ne in L)Object.prototype.hasOwnProperty.call(L,ne)&&$.push([ne,L[ne]]);return $}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var w=w||{},x=this||self;function c(E){var L=typeof E;return L=="object"&&E!=null||L=="function"}function k(E,L,$){return E.call.apply(E.bind,arguments)}function O(E,L,$){return O=k,O.apply(null,arguments)}function U(E,L){var $=Array.prototype.slice.call(arguments,1);return function(){var ne=$.slice();return ne.push.apply(ne,arguments),E.apply(this,ne)}}function Y(E,L){function $(){}$.prototype=L.prototype,E.Z=L.prototype,E.prototype=new $,E.prototype.constructor=E,E.Ob=function(ne,De,Ze){for(var _t=Array(arguments.length-2),ln=2;ln<arguments.length;ln++)_t[ln-2]=arguments[ln];return L.prototype[De].apply(ne,_t)}}var se=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?E=>E&&AsyncContext.Snapshot.wrap(E):E=>E;function xe(E){const L=E.length;if(L>0){const $=Array(L);for(let ne=0;ne<L;ne++)$[ne]=E[ne];return $}return[]}function $e(E,L){for(let ne=1;ne<arguments.length;ne++){const De=arguments[ne];var $=typeof De;if($=$!="object"?$:De?Array.isArray(De)?"array":$:"null",$=="array"||$=="object"&&typeof De.length=="number"){$=E.length||0;const Ze=De.length||0;E.length=$+Ze;for(let _t=0;_t<Ze;_t++)E[$+_t]=De[_t]}else E.push(De)}}class Ce{constructor(L,$){this.i=L,this.j=$,this.h=0,this.g=null}get(){let L;return this.h>0?(this.h--,L=this.g,this.g=L.next,L.next=null):L=this.i(),L}}function J(E){x.setTimeout(()=>{throw E},0)}function Ye(){var E=he;let L=null;return E.g&&(L=E.g,E.g=E.g.next,E.g||(E.h=null),L.next=null),L}class qe{constructor(){this.h=this.g=null}add(L,$){const ne=He.get();ne.set(L,$),this.h?this.h.next=ne:this.g=ne,this.h=ne}}var He=new Ce(()=>new et,E=>E.reset());class et{constructor(){this.next=this.g=this.h=null}set(L,$){this.h=L,this.g=$,this.next=null}reset(){this.next=this.g=this.h=null}}let at,Qe=!1,he=new qe,oe=()=>{const E=Promise.resolve(void 0);at=()=>{E.then(ae)}};function ae(){for(var E;E=Ye();){try{E.h.call(E.g)}catch($){J($)}var L=He;L.j(E),L.h<100&&(L.h++,E.next=L.g,L.g=E)}Qe=!1}function Ee(){this.u=this.u,this.C=this.C}Ee.prototype.u=!1,Ee.prototype.dispose=function(){this.u||(this.u=!0,this.N())},Ee.prototype[Symbol.dispose]=function(){this.dispose()},Ee.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function be(E,L){this.type=E,this.g=this.target=L,this.defaultPrevented=!1}be.prototype.h=function(){this.defaultPrevented=!0};var Se=(function(){if(!x.addEventListener||!Object.defineProperty)return!1;var E=!1,L=Object.defineProperty({},"passive",{get:function(){E=!0}});try{const $=()=>{};x.addEventListener("test",$,L),x.removeEventListener("test",$,L)}catch{}return E})();function de(E){return/^[\s\xa0]*$/.test(E)}function Qt(E,L){be.call(this,E?E.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,E&&this.init(E,L)}Y(Qt,be),Qt.prototype.init=function(E,L){const $=this.type=E.type,ne=E.changedTouches&&E.changedTouches.length?E.changedTouches[0]:null;this.target=E.target||E.srcElement,this.g=L,L=E.relatedTarget,L||($=="mouseover"?L=E.fromElement:$=="mouseout"&&(L=E.toElement)),this.relatedTarget=L,ne?(this.clientX=ne.clientX!==void 0?ne.clientX:ne.pageX,this.clientY=ne.clientY!==void 0?ne.clientY:ne.pageY,this.screenX=ne.screenX||0,this.screenY=ne.screenY||0):(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0),this.button=E.button,this.key=E.key||"",this.ctrlKey=E.ctrlKey,this.altKey=E.altKey,this.shiftKey=E.shiftKey,this.metaKey=E.metaKey,this.pointerId=E.pointerId||0,this.pointerType=E.pointerType,this.state=E.state,this.i=E,E.defaultPrevented&&Qt.Z.h.call(this)},Qt.prototype.h=function(){Qt.Z.h.call(this);const E=this.i;E.preventDefault?E.preventDefault():E.returnValue=!1};var mn="closure_listenable_"+(Math.random()*1e6|0),gt=0;function vn(E,L,$,ne,De){this.listener=E,this.proxy=null,this.src=L,this.type=$,this.capture=!!ne,this.ha=De,this.key=++gt,this.da=this.fa=!1}function gn(E){E.da=!0,E.listener=null,E.proxy=null,E.src=null,E.ha=null}function St(E,L,$){for(const ne in E)L.call($,E[ne],ne,E)}function In(E,L){for(const $ in E)L.call(void 0,E[$],$,E)}function jt(E){const L={};for(const $ in E)L[$]=E[$];return L}const Ht="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qn(E,L){let $,ne;for(let De=1;De<arguments.length;De++){ne=arguments[De];for($ in ne)E[$]=ne[$];for(let Ze=0;Ze<Ht.length;Ze++)$=Ht[Ze],Object.prototype.hasOwnProperty.call(ne,$)&&(E[$]=ne[$])}}function kn(E){this.src=E,this.g={},this.h=0}kn.prototype.add=function(E,L,$,ne,De){const Ze=E.toString();E=this.g[Ze],E||(E=this.g[Ze]=[],this.h++);const _t=xt(E,L,ne,De);return _t>-1?(L=E[_t],$||(L.fa=!1)):(L=new vn(L,this.src,Ze,!!ne,De),L.fa=$,E.push(L)),L};function Et(E,L){const $=L.type;if($ in E.g){var ne=E.g[$],De=Array.prototype.indexOf.call(ne,L,void 0),Ze;(Ze=De>=0)&&Array.prototype.splice.call(ne,De,1),Ze&&(gn(L),E.g[$].length==0&&(delete E.g[$],E.h--))}}function xt(E,L,$,ne){for(let De=0;De<E.length;++De){const Ze=E[De];if(!Ze.da&&Ze.listener==L&&Ze.capture==!!$&&Ze.ha==ne)return De}return-1}var At="closure_lm_"+(Math.random()*1e6|0),Wt={};function pn(E,L,$,ne,De){if(Array.isArray(L)){for(let Ze=0;Ze<L.length;Ze++)pn(E,L[Ze],$,ne,De);return null}return $=Kt($),E&&E[mn]?E.J(L,$,c(ne)?!!ne.capture:!1,De):Zt(E,L,$,!1,ne,De)}function Zt(E,L,$,ne,De,Ze){if(!L)throw Error("Invalid event type");const _t=c(De)?!!De.capture:!!De;let ln=Cn(E);if(ln||(E[At]=ln=new kn(E)),$=ln.add(L,$,ne,_t,Ze),$.proxy)return $;if(ne=ur(),$.proxy=ne,ne.src=E,ne.listener=$,E.addEventListener)Se||(De=_t),De===void 0&&(De=!1),E.addEventListener(L.toString(),ne,De);else if(E.attachEvent)E.attachEvent(Vt(L.toString()),ne);else if(E.addListener&&E.removeListener)E.addListener(ne);else throw Error("addEventListener and attachEvent are unavailable.");return $}function ur(){function E($){return L.call(E.src,E.listener,$)}const L=Jt;return E}function Sn(E,L,$,ne,De){if(Array.isArray(L))for(var Ze=0;Ze<L.length;Ze++)Sn(E,L[Ze],$,ne,De);else ne=c(ne)?!!ne.capture:!!ne,$=Kt($),E&&E[mn]?(E=E.i,Ze=String(L).toString(),Ze in E.g&&(L=E.g[Ze],$=xt(L,$,ne,De),$>-1&&(gn(L[$]),Array.prototype.splice.call(L,$,1),L.length==0&&(delete E.g[Ze],E.h--)))):E&&(E=Cn(E))&&(L=E.g[L.toString()],E=-1,L&&(E=xt(L,$,ne,De)),($=E>-1?L[E]:null)&&Fn($))}function Fn(E){if(typeof E!="number"&&E&&!E.da){var L=E.src;if(L&&L[mn])Et(L.i,E);else{var $=E.type,ne=E.proxy;L.removeEventListener?L.removeEventListener($,ne,E.capture):L.detachEvent?L.detachEvent(Vt($),ne):L.addListener&&L.removeListener&&L.removeListener(ne),($=Cn(L))?(Et($,E),$.h==0&&($.src=null,L[At]=null)):gn(E)}}}function Vt(E){return E in Wt?Wt[E]:Wt[E]="on"+E}function Jt(E,L){if(E.da)E=!0;else{L=new Qt(L,this);const $=E.listener,ne=E.ha||E.src;E.fa&&Fn(E),E=$.call(ne,L)}return E}function Cn(E){return E=E[At],E instanceof kn?E:null}var Mt="__closure_events_fn_"+(Math.random()*1e9>>>0);function Kt(E){return typeof E=="function"?E:(E[Mt]||(E[Mt]=function(L){return E.handleEvent(L)}),E[Mt])}function $t(){Ee.call(this),this.i=new kn(this),this.M=this,this.G=null}Y($t,Ee),$t.prototype[mn]=!0,$t.prototype.removeEventListener=function(E,L,$,ne){Sn(this,E,L,$,ne)};function Ot(E,L){var $,ne=E.G;if(ne)for($=[];ne;ne=ne.G)$.push(ne);if(E=E.M,ne=L.type||L,typeof L=="string")L=new be(L,E);else if(L instanceof be)L.target=L.target||E;else{var De=L;L=new be(ne,E),Qn(L,De)}De=!0;let Ze,_t;if($)for(_t=$.length-1;_t>=0;_t--)Ze=L.g=$[_t],De=tn(Ze,ne,!0,L)&&De;if(Ze=L.g=E,De=tn(Ze,ne,!0,L)&&De,De=tn(Ze,ne,!1,L)&&De,$)for(_t=0;_t<$.length;_t++)Ze=L.g=$[_t],De=tn(Ze,ne,!1,L)&&De}$t.prototype.N=function(){if($t.Z.N.call(this),this.i){var E=this.i;for(const L in E.g){const $=E.g[L];for(let ne=0;ne<$.length;ne++)gn($[ne]);delete E.g[L],E.h--}}this.G=null},$t.prototype.J=function(E,L,$,ne){return this.i.add(String(E),L,!1,$,ne)},$t.prototype.K=function(E,L,$,ne){return this.i.add(String(E),L,!0,$,ne)};function tn(E,L,$,ne){if(L=E.i.g[String(L)],!L)return!0;L=L.concat();let De=!0;for(let Ze=0;Ze<L.length;++Ze){const _t=L[Ze];if(_t&&!_t.da&&_t.capture==$){const ln=_t.listener,dr=_t.ha||_t.src;_t.fa&&Et(E.i,_t),De=ln.call(dr,ne)!==!1&&De}}return De&&!ne.defaultPrevented}function nn(E,L){if(typeof E!="function")if(E&&typeof E.handleEvent=="function")E=O(E.handleEvent,E);else throw Error("Invalid listener argument");return Number(L)>2147483647?-1:x.setTimeout(E,L||0)}function Rn(E){E.g=nn(()=>{E.g=null,E.i&&(E.i=!1,Rn(E))},E.l);const L=E.h;E.h=null,E.m.apply(null,L)}class xn extends Ee{constructor(L,$){super(),this.m=L,this.l=$,this.h=null,this.i=!1,this.g=null}j(L){this.h=arguments,this.g?this.i=!0:Rn(this)}N(){super.N(),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Xt(E){Ee.call(this),this.h=E,this.g={}}Y(Xt,Ee);var Pe=[];function W(E){St(E.g,function(L,$){this.g.hasOwnProperty($)&&Fn(L)},E),E.g={}}Xt.prototype.N=function(){Xt.Z.N.call(this),W(this)},Xt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var H=x.JSON.stringify,X=x.JSON.parse,fe=class{stringify(E){return x.JSON.stringify(E,void 0)}parse(E){return x.JSON.parse(E,void 0)}};function ge(){}function V(){}var Ie={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function we(){be.call(this,"d")}Y(we,be);function ke(){be.call(this,"c")}Y(ke,be);var Ge={},Be=null;function it(){return Be=Be||new $t}Ge.Ia="serverreachability";function ft(E){be.call(this,Ge.Ia,E)}Y(ft,be);function It(E){const L=it();Ot(L,new ft(L))}Ge.STAT_EVENT="statevent";function kt(E,L){be.call(this,Ge.STAT_EVENT,E),this.stat=L}Y(kt,be);function Ft(E){const L=it();Ot(L,new kt(L,E))}Ge.Ja="timingevent";function Me(E,L){be.call(this,Ge.Ja,E),this.size=L}Y(Me,be);function rn(E,L){if(typeof E!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){E()},L)}function An(){this.g=!0}An.prototype.ua=function(){this.g=!1};function Ct(E,L,$,ne,De,Ze){E.info(function(){if(E.g)if(Ze){var _t="",ln=Ze.split("&");for(let on=0;on<ln.length;on++){var dr=ln[on].split("=");if(dr.length>1){const Or=dr[0];dr=dr[1];const hi=Or.split("_");_t=hi.length>=2&&hi[1]=="type"?_t+(Or+"="+dr+"&"):_t+(Or+"=redacted&")}}}else _t=null;else _t=Ze;return"XMLHTTP REQ ("+ne+") [attempt "+De+"]: "+L+`
`+$+`
`+_t})}function Yt(E,L,$,ne,De,Ze,_t){E.info(function(){return"XMLHTTP RESP ("+ne+") [ attempt "+De+"]: "+L+`
`+$+`
`+Ze+" "+_t})}function _n(E,L,$,ne){E.info(function(){return"XMLHTTP TEXT ("+L+"): "+dt(E,$)+(ne?" "+ne:"")})}function je(E,L){E.info(function(){return"TIMEOUT: "+L})}An.prototype.info=function(){};function dt(E,L){if(!E.g)return L;if(!L)return null;try{const Ze=JSON.parse(L);if(Ze){for(E=0;E<Ze.length;E++)if(Array.isArray(Ze[E])){var $=Ze[E];if(!($.length<2)){var ne=$[1];if(Array.isArray(ne)&&!(ne.length<1)){var De=ne[0];if(De!="noop"&&De!="stop"&&De!="close")for(let _t=1;_t<ne.length;_t++)ne[_t]=""}}}}return H(Ze)}catch{return L}}var Fe={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},wt={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Nt;function jn(){}Y(jn,ge),jn.prototype.g=function(){return new XMLHttpRequest},Nt=new jn;function Ue(E){return encodeURIComponent(String(E))}function $n(E){var L=1;E=E.split(":");const $=[];for(;L>0&&E.length;)$.push(E.shift()),L--;return E.length&&$.push(E.join(":")),$}function Jn(E,L,$,ne){this.j=E,this.i=L,this.l=$,this.S=ne||1,this.V=new Xt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Wi}function Wi(){this.i=null,this.g="",this.h=!1}var mr={},lt={};function Rt(E,L,$){E.M=1,E.A=Ki(Mr(L)),E.u=$,E.R=!0,Ut(E,null)}function Ut(E,L){E.F=Date.now(),Dt(E),E.B=Mr(E.A);var $=E.B,ne=E.S;Array.isArray(ne)||(ne=[String(ne)]),wo($.i,"t",ne),E.C=0,$=E.j.L,E.h=new Wi,E.g=rr(E.j,$?L:null,!E.u),E.P>0&&(E.O=new xn(O(E.Y,E,E.g),E.P)),L=E.V,$=E.g,ne=E.ba;var De="readystatechange";Array.isArray(De)||(De&&(Pe[0]=De.toString()),De=Pe);for(let Ze=0;Ze<De.length;Ze++){const _t=pn($,De[Ze],ne||L.handleEvent,!1,L.h||L);if(!_t)break;L.g[_t.key]=_t}L=E.J?jt(E.J):{},E.u?(E.v||(E.v="POST"),L["Content-Type"]="application/x-www-form-urlencoded",E.g.ea(E.B,E.v,E.u,L)):(E.v="GET",E.g.ea(E.B,E.v,null,L)),It(),Ct(E.i,E.v,E.B,E.l,E.S,E.u)}Jn.prototype.ba=function(E){E=E.target;const L=this.O;L&&Er(E)==3?L.j():this.Y(E)},Jn.prototype.Y=function(E){try{if(E==this.g)e:{const ln=Er(this.g),dr=this.g.ya(),on=this.g.ca();if(!(ln<3)&&(ln!=3||this.g&&(this.h.h||this.g.la()||js(this.g)))){this.K||ln!=4||dr==7||(dr==8||on<=0?It(3):It(2)),ci(this);var L=this.g.ca();this.X=L;var $=Cr(this);if(this.o=L==200,Yt(this.i,this.v,this.B,this.l,this.S,ln,L),this.o){if(this.U&&!this.L){t:{if(this.g){var ne,De=this.g;if((ne=De.g?De.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!de(ne)){var Ze=ne;break t}}Ze=null}if(E=Ze)_n(this.i,this.l,E,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Zi(this,E);else{this.o=!1,this.m=3,Ft(12),Kr(this),Li(this);break e}}if(this.R){E=!0;let Or;for(;!this.K&&this.C<$.length;)if(Or=nr(this,$),Or==lt){ln==4&&(this.m=4,Ft(14),E=!1),_n(this.i,this.l,null,"[Incomplete Response]");break}else if(Or==mr){this.m=4,Ft(15),_n(this.i,this.l,$,"[Invalid Chunk]"),E=!1;break}else _n(this.i,this.l,Or,null),Zi(this,Or);if(Di(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ln!=4||$.length!=0||this.h.h||(this.m=1,Ft(16),E=!1),this.o=this.o&&E,!E)_n(this.i,this.l,$,"[Invalid Chunked Response]"),Kr(this),Li(this);else if($.length>0&&!this.W){this.W=!0;var _t=this.j;_t.g==this&&_t.aa&&!_t.P&&(_t.j.info("Great, no buffering proxy detected. Bytes received: "+$.length),ms(_t),_t.P=!0,Ft(11))}}else _n(this.i,this.l,$,null),Zi(this,$);ln==4&&Kr(this),this.o&&!this.K&&(ln==4?Ra(this.j,this):(this.o=!1,Dt(this)))}else Is(this.g),L==400&&$.indexOf("Unknown SID")>0?(this.m=3,Ft(12)):(this.m=0,Ft(13)),Kr(this),Li(this)}}}catch{}finally{}};function Cr(E){if(!Di(E))return E.g.la();const L=js(E.g);if(L==="")return"";let $="";const ne=L.length,De=Er(E.g)==4;if(!E.h.i){if(typeof TextDecoder>"u")return Kr(E),Li(E),"";E.h.i=new x.TextDecoder}for(let Ze=0;Ze<ne;Ze++)E.h.h=!0,$+=E.h.i.decode(L[Ze],{stream:!(De&&Ze==ne-1)});return L.length=0,E.h.g+=$,E.C=0,E.h.g}function Di(E){return E.g?E.v=="GET"&&E.M!=2&&E.j.Aa:!1}function nr(E,L){var $=E.C,ne=L.indexOf(`
`,$);return ne==-1?lt:($=Number(L.substring($,ne)),isNaN($)?mr:(ne+=1,ne+$>L.length?lt:(L=L.slice(ne,ne+$),E.C=ne+$,L)))}Jn.prototype.cancel=function(){this.K=!0,Kr(this)};function Dt(E){E.T=Date.now()+E.H,Xn(E,E.H)}function Xn(E,L){if(E.D!=null)throw Error("WatchDog timer not null");E.D=rn(O(E.aa,E),L)}function ci(E){E.D&&(x.clearTimeout(E.D),E.D=null)}Jn.prototype.aa=function(){this.D=null;const E=Date.now();E-this.T>=0?(je(this.i,this.B),this.M!=2&&(It(),Ft(17)),Kr(this),this.m=2,Li(this)):Xn(this,this.T-E)};function Li(E){E.j.I==0||E.K||Ra(E.j,E)}function Kr(E){ci(E);var L=E.O;L&&typeof L.dispose=="function"&&L.dispose(),E.O=null,W(E.V),E.g&&(L=E.g,E.g=null,L.abort(),L.dispose())}function Zi(E,L){try{var $=E.j;if($.I!=0&&($.g==E||cs($.h,E))){if(!E.L&&cs($.h,E)&&$.I==3){try{var ne=$.Ba.g.parse(L)}catch{ne=null}if(Array.isArray(ne)&&ne.length==3){var De=ne;if(De[0]==0){e:if(!$.v){if($.g)if($.g.F+3e3<E.F)qs($),Gn($);else break e;$s($),Ft(18)}}else $.xa=De[1],0<$.xa-$.K&&De[2]<37500&&$.F&&$.A==0&&!$.C&&($.C=rn(O($.Va,$),6e3));Ln($.h)<=1&&$.ta&&($.ta=void 0)}else Gs($,11)}else if((E.L||$.g==E)&&qs($),!de(L))for(De=$.Ba.g.parse(L),L=0;L<De.length;L++){let on=De[L];const Or=on[0];if(!(Or<=$.K))if($.K=Or,on=on[1],$.I==2)if(on[0]=="c"){$.M=on[1],$.ba=on[2];const hi=on[3];hi!=null&&($.ka=hi,$.j.info("VER="+$.ka));const es=on[4];es!=null&&($.za=es,$.j.info("SVER="+$.za));const xi=on[5];xi!=null&&typeof xi=="number"&&xi>0&&(ne=1.5*xi,$.O=ne,$.j.info("backChannelRequestTimeoutMs_="+ne)),ne=$;const Zs=E.g;if(Zs){const so=Zs.g?Zs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(so){var Ze=ne.h;Ze.g||so.indexOf("spdy")==-1&&so.indexOf("quic")==-1&&so.indexOf("h2")==-1||(Ze.j=Ze.l,Ze.g=new Set,Ze.h&&(Xr(Ze,Ze.h),Ze.h=null))}if(ne.G){const Tl=Zs.g?Zs.g.getResponseHeader("X-HTTP-Session-Id"):null;Tl&&(ne.wa=Tl,zn(ne.J,ne.G,Tl))}}$.I=3,$.l&&$.l.ra(),$.aa&&($.T=Date.now()-E.F,$.j.info("Handshake RTT: "+$.T+"ms")),ne=$;var _t=E;if(ne.na=Ji(ne,ne.L?ne.ba:null,ne.W),_t.L){yi(ne.h,_t);var ln=_t,dr=ne.O;dr&&(ln.H=dr),ln.D&&(ci(ln),Dt(ln)),ne.g=_t}else Si(ne);$.i.length>0&&bn($)}else on[0]!="stop"&&on[0]!="close"||Gs($,7);else $.I==3&&(on[0]=="stop"||on[0]=="close"?on[0]=="stop"?Gs($,7):Ss($):on[0]!="noop"&&$.l&&$.l.qa(on),$.A=0)}}It(4)}catch{}}var ls=class{constructor(E,L){this.g=E,this.map=L}};function zi(E){this.l=E||10,x.PerformanceNavigationTiming?(E=x.performance.getEntriesByType("navigation"),E=E.length>0&&(E[0].nextHopProtocol=="hq"||E[0].nextHopProtocol=="h2")):E=!!(x.chrome&&x.chrome.loadTimes&&x.chrome.loadTimes()&&x.chrome.loadTimes().wasFetchedViaSpdy),this.j=E?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function br(E){return E.h?!0:E.g?E.g.size>=E.j:!1}function Ln(E){return E.h?1:E.g?E.g.size:0}function cs(E,L){return E.h?E.h==L:E.g?E.g.has(L):!1}function Xr(E,L){E.g?E.g.add(L):E.h=L}function yi(E,L){E.h&&E.h==L?E.h=null:E.g&&E.g.has(L)&&E.g.delete(L)}zi.prototype.cancel=function(){if(this.i=Oi(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const E of this.g.values())E.cancel();this.g.clear()}};function Oi(E){if(E.h!=null)return E.i.concat(E.h.G);if(E.g!=null&&E.g.size!==0){let L=E.i;for(const $ of E.g.values())L=L.concat($.G);return L}return xe(E.i)}var Yr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vo(E,L){if(E){E=E.split("&");for(let $=0;$<E.length;$++){const ne=E[$].indexOf("=");let De,Ze=null;ne>=0?(De=E[$].substring(0,ne),Ze=E[$].substring(ne+1)):De=E[$],L(De,Ze?decodeURIComponent(Ze.replace(/\+/g," ")):"")}}}function Ur(E){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let L;E instanceof Ur?(this.l=E.l,qn(this,E.j),this.o=E.o,this.g=E.g,us(this,E.u),this.h=E.h,hs(this,Es(E.i)),this.m=E.m):E&&(L=String(E).match(Yr))?(this.l=!1,qn(this,L[1]||"",!0),this.o=ds(L[2]||""),this.g=ds(L[3]||"",!0),us(this,L[4]),this.h=ds(L[5]||"",!0),hs(this,L[6]||"",!0),this.m=ds(L[7]||"")):(this.l=!1,this.i=new Xi(null,this.l))}Ur.prototype.toString=function(){const E=[];var L=this.j;L&&E.push(ps(L,bo,!0),":");var $=this.g;return($||L=="file")&&(E.push("//"),(L=this.o)&&E.push(ps(L,bo,!0),"@"),E.push(Ue($).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),$=this.u,$!=null&&E.push(":",String($))),($=this.h)&&(this.g&&$.charAt(0)!="/"&&E.push("/"),E.push(ps($,$.charAt(0)=="/"?Qo:Yo,!0))),($=this.i.toString())&&E.push("?",$),($=this.m)&&E.push("#",ps($,vl)),E.join("")},Ur.prototype.resolve=function(E){const L=Mr(this);let $=!!E.j;$?qn(L,E.j):$=!!E.o,$?L.o=E.o:$=!!E.g,$?L.g=E.g:$=E.u!=null;var ne=E.h;if($)us(L,E.u);else if($=!!E.h){if(ne.charAt(0)!="/")if(this.g&&!this.h)ne="/"+ne;else{var De=L.h.lastIndexOf("/");De!=-1&&(ne=L.h.slice(0,De+1)+ne)}if(De=ne,De==".."||De==".")ne="";else if(De.indexOf("./")!=-1||De.indexOf("/.")!=-1){ne=De.lastIndexOf("/",0)==0,De=De.split("/");const Ze=[];for(let _t=0;_t<De.length;){const ln=De[_t++];ln=="."?ne&&_t==De.length&&Ze.push(""):ln==".."?((Ze.length>1||Ze.length==1&&Ze[0]!="")&&Ze.pop(),ne&&_t==De.length&&Ze.push("")):(Ze.push(ln),ne=!0)}ne=Ze.join("/")}else ne=De}return $?L.h=ne:$=E.i.toString()!=="",$?hs(L,Es(E.i)):$=!!E.m,$&&(L.m=E.m),L};function Mr(E){return new Ur(E)}function qn(E,L,$){E.j=$?ds(L,!0):L,E.j&&(E.j=E.j.replace(/:$/,""))}function us(E,L){if(L){if(L=Number(L),isNaN(L)||L<0)throw Error("Bad port number "+L);E.u=L}else E.u=null}function hs(E,L,$){L instanceof Xi?(E.i=L,fn(E.i,E.l)):($||(L=ps(L,Jo)),E.i=new Xi(L,E.l))}function zn(E,L,$){E.i.set(L,$)}function Ki(E){return zn(E,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),E}function ds(E,L){return E?L?decodeURI(E.replace(/%25/g,"%2525")):decodeURIComponent(E):""}function ps(E,L,$){return typeof E=="string"?(E=encodeURI(E).replace(L,xo),$&&(E=E.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),E):null}function xo(E){return E=E.charCodeAt(0),"%"+(E>>4&15).toString(16)+(E&15).toString(16)}var bo=/[#\/\?@]/g,Yo=/[#\?:]/g,Qo=/[#\?]/g,Jo=/[#\?@]/g,vl=/#/g;function Xi(E,L){this.h=this.g=null,this.i=E||null,this.j=!!L}function Fi(E){E.g||(E.g=new Map,E.h=0,E.i&&vo(E.i,function(L,$){E.add(decodeURIComponent(L.replace(/\+/g," ")),$)}))}a=Xi.prototype,a.add=function(E,L){Fi(this),this.i=null,E=Yi(this,E);let $=this.g.get(E);return $||this.g.set(E,$=[]),$.push(L),this.h+=1,this};function ea(E,L){Fi(E),L=Yi(E,L),E.g.has(L)&&(E.i=null,E.h-=E.g.get(L).length,E.g.delete(L))}function to(E,L){return Fi(E),L=Yi(E,L),E.g.has(L)}a.forEach=function(E,L){Fi(this),this.g.forEach(function($,ne){$.forEach(function(De){E.call(L,De,ne,this)},this)},this)};function Ma(E,L){Fi(E);let $=[];if(typeof L=="string")to(E,L)&&($=$.concat(E.g.get(Yi(E,L))));else for(E=Array.from(E.g.values()),L=0;L<E.length;L++)$=$.concat(E[L]);return $}a.set=function(E,L){return Fi(this),this.i=null,E=Yi(this,E),to(this,E)&&(this.h-=this.g.get(E).length),this.g.set(E,[L]),this.h+=1,this},a.get=function(E,L){return E?(E=Ma(this,E),E.length>0?String(E[0]):L):L};function wo(E,L,$){ea(E,L),$.length>0&&(E.i=null,E.g.set(Yi(E,L),xe($)),E.h+=$.length)}a.toString=function(){if(this.i)return this.i;if(!this.g)return"";const E=[],L=Array.from(this.g.keys());for(let ne=0;ne<L.length;ne++){var $=L[ne];const De=Ue($);$=Ma(this,$);for(let Ze=0;Ze<$.length;Ze++){let _t=De;$[Ze]!==""&&(_t+="="+Ue($[Ze])),E.push(_t)}}return this.i=E.join("&")};function Es(E){const L=new Xi;return L.i=E.i,E.g&&(L.g=new Map(E.g),L.h=E.h),L}function Yi(E,L){return L=String(L),E.j&&(L=L.toLowerCase()),L}function fn(E,L){L&&!E.j&&(Fi(E),E.i=null,E.g.forEach(function($,ne){const De=ne.toLowerCase();ne!=De&&(ea(this,ne),wo(this,De,$))},E)),E.j=L}function xl(E,L){const $=new An;if(x.Image){const ne=new Image;ne.onload=U(fs,$,"TestLoadImage: loaded",!0,L,ne),ne.onerror=U(fs,$,"TestLoadImage: error",!1,L,ne),ne.onabort=U(fs,$,"TestLoadImage: abort",!1,L,ne),ne.ontimeout=U(fs,$,"TestLoadImage: timeout",!1,L,ne),x.setTimeout(function(){ne.ontimeout&&ne.ontimeout()},1e4),ne.src=E}else L(!1)}function Wu(E,L){const $=new An,ne=new AbortController,De=setTimeout(()=>{ne.abort(),fs($,"TestPingServer: timeout",!1,L)},1e4);fetch(E,{signal:ne.signal}).then(Ze=>{clearTimeout(De),Ze.ok?fs($,"TestPingServer: ok",!0,L):fs($,"TestPingServer: server error",!1,L)}).catch(()=>{clearTimeout(De),fs($,"TestPingServer: error",!1,L)})}function fs(E,L,$,ne,De){try{De&&(De.onload=null,De.onerror=null,De.onabort=null,De.ontimeout=null),ne($)}catch{}}function vi(){this.g=new fe}function jr(E){this.i=E.Sb||null,this.h=E.ab||!1}Y(jr,ge),jr.prototype.g=function(){return new er(this.i,this.h)};function er(E,L){$t.call(this),this.H=E,this.o=L,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}Y(er,$t),a=er.prototype,a.open=function(E,L){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=E,this.D=L,this.readyState=1,Ni(this)},a.send=function(E){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const L={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};E&&(L.body=E),(this.H||x).fetch(new Request(this.D,L)).then(this.Pa.bind(this),this.ga.bind(this))},a.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Nn(this)),this.readyState=0},a.Pa=function(E){if(this.g&&(this.l=E,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=E.headers,this.readyState=2,Ni(this)),this.g&&(this.readyState=3,Ni(this),this.g)))if(this.responseType==="arraybuffer")E.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof x.ReadableStream<"u"&&"body"in E){if(this.j=E.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;qt(this)}else E.text().then(this.Oa.bind(this),this.ga.bind(this))};function qt(E){E.j.read().then(E.Ma.bind(E)).catch(E.ga.bind(E))}a.Ma=function(E){if(this.g){if(this.o&&E.value)this.response.push(E.value);else if(!this.o){var L=E.value?E.value:new Uint8Array(0);(L=this.B.decode(L,{stream:!E.done}))&&(this.response=this.responseText+=L)}E.done?Nn(this):Ni(this),this.readyState==3&&qt(this)}},a.Oa=function(E){this.g&&(this.response=this.responseText=E,Nn(this))},a.Na=function(E){this.g&&(this.response=E,Nn(this))},a.ga=function(){this.g&&Nn(this)};function Nn(E){E.readyState=4,E.l=null,E.j=null,E.B=null,Ni(E)}a.setRequestHeader=function(E,L){this.A.append(E,L)},a.getResponseHeader=function(E){return this.h&&this.h.get(E.toLowerCase())||""},a.getAllResponseHeaders=function(){if(!this.h)return"";const E=[],L=this.h.entries();for(var $=L.next();!$.done;)$=$.value,E.push($[0]+": "+$[1]),$=L.next();return E.join(`\r
`)};function Ni(E){E.onreadystatechange&&E.onreadystatechange.call(E)}Object.defineProperty(er.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(E){this.m=E?"include":"same-origin"}});function Qr(E){let L="";return St(E,function($,ne){L+=ne,L+=":",L+=$,L+=`\r
`}),L}function ui(E,L,$){e:{for(ne in $){var ne=!1;break e}ne=!0}ne||($=Qr($),typeof E=="string"?$!=null&&Ue($):zn(E,L,$))}function Dn(E){$t.call(this),this.headers=new Map,this.L=E||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}Y(Dn,$t);var To=/^https?$/i,Bs=["POST","PUT"];a=Dn.prototype,a.Fa=function(E){this.H=E},a.ea=function(E,L,$,ne){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+E);L=L?L.toUpperCase():"GET",this.D=E,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Nt.g(),this.g.onreadystatechange=se(O(this.Ca,this));try{this.B=!0,this.g.open(L,String(E),!0),this.B=!1}catch(Ze){gr(this,Ze);return}if(E=$||"",$=new Map(this.headers),ne)if(Object.getPrototypeOf(ne)===Object.prototype)for(var De in ne)$.set(De,ne[De]);else if(typeof ne.keys=="function"&&typeof ne.get=="function")for(const Ze of ne.keys())$.set(Ze,ne.get(Ze));else throw Error("Unknown input type for opt_headers: "+String(ne));ne=Array.from($.keys()).find(Ze=>Ze.toLowerCase()=="content-type"),De=x.FormData&&E instanceof x.FormData,!(Array.prototype.indexOf.call(Bs,L,void 0)>=0)||ne||De||$.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Ze,_t]of $)this.g.setRequestHeader(Ze,_t);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(E),this.v=!1}catch(Ze){gr(this,Ze)}};function gr(E,L){E.h=!1,E.g&&(E.j=!0,E.g.abort(),E.j=!1),E.l=L,E.o=5,Us(E),no(E)}function Us(E){E.A||(E.A=!0,Ot(E,"complete"),Ot(E,"error"))}a.abort=function(E){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=E||7,Ot(this,"complete"),Ot(this,"abort"),no(this))},a.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),no(this,!0)),Dn.Z.N.call(this)},a.Ca=function(){this.u||(this.B||this.v||this.j?Qi(this):this.Xa())},a.Xa=function(){Qi(this)};function Qi(E){if(E.h&&typeof w<"u"){if(E.v&&Er(E)==4)setTimeout(E.Ca.bind(E),0);else if(Ot(E,"readystatechange"),Er(E)==4){E.h=!1;try{const Ze=E.ca();e:switch(Ze){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var L=!0;break e;default:L=!1}var $;if(!($=L)){var ne;if(ne=Ze===0){let _t=String(E.D).match(Yr)[1]||null;!_t&&x.self&&x.self.location&&(_t=x.self.location.protocol.slice(0,-1)),ne=!To.test(_t?_t.toLowerCase():"")}$=ne}if($)Ot(E,"complete"),Ot(E,"success");else{E.o=6;try{var De=Er(E)>2?E.g.statusText:""}catch{De=""}E.l=De+" ["+E.ca()+"]",Us(E)}}finally{no(E)}}}}function no(E,L){if(E.g){E.m&&(clearTimeout(E.m),E.m=null);const $=E.g;E.g=null,L||Ot(E,"ready");try{$.onreadystatechange=null}catch{}}}a.isActive=function(){return!!this.g};function Er(E){return E.g?E.g.readyState:0}a.ca=function(){try{return Er(this)>2?this.g.status:-1}catch{return-1}},a.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},a.La=function(E){if(this.g){var L=this.g.responseText;return E&&L.indexOf(E)==0&&(L=L.substring(E.length)),X(L)}};function js(E){try{if(!E.g)return null;if("response"in E.g)return E.g.response;switch(E.F){case"":case"text":return E.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in E.g)return E.g.mozResponseArrayBuffer}return null}catch{return null}}function Is(E){const L={};E=(E.g&&Er(E)>=2&&E.g.getAllResponseHeaders()||"").split(`\r
`);for(let ne=0;ne<E.length;ne++){if(de(E[ne]))continue;var $=$n(E[ne]);const De=$[0];if($=$[1],typeof $!="string")continue;$=$.trim();const Ze=L[De]||[];L[De]=Ze,Ze.push($)}In(L,function(ne){return ne.join(", ")})}a.ya=function(){return this.o},a.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Eo(E,L,$){return $&&$.internalChannelParams&&$.internalChannelParams[E]||L}function ka(E){this.za=0,this.i=[],this.j=new An,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Eo("failFast",!1,E),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Eo("baseRetryDelayMs",5e3,E),this.Za=Eo("retryDelaySeedMs",1e4,E),this.Ta=Eo("forwardChannelMaxRetries",2,E),this.va=Eo("forwardChannelRequestTimeoutMs",2e4,E),this.ma=E&&E.xmlHttpFactory||void 0,this.Ua=E&&E.Rb||void 0,this.Aa=E&&E.useFetchStreams||!1,this.O=void 0,this.L=E&&E.supportsCrossDomainXhr||!1,this.M="",this.h=new zi(E&&E.concurrentRequestLimit),this.Ba=new vi,this.S=E&&E.fastHandshake||!1,this.R=E&&E.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=E&&E.Pb||!1,E&&E.ua&&this.j.ua(),E&&E.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&E&&E.detectBufferingProxy||!1,this.ia=void 0,E&&E.longPollingTimeout&&E.longPollingTimeout>0&&(this.ia=E.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}a=ka.prototype,a.ka=8,a.I=1,a.connect=function(E,L,$,ne){Ft(0),this.W=E,this.H=L||{},$&&ne!==void 0&&(this.H.OSID=$,this.H.OAID=ne),this.F=this.X,this.J=Ji(this,null,this.W),bn(this)};function Ss(E){if(ro(E),E.I==3){var L=E.V++,$=Mr(E.J);if(zn($,"SID",E.M),zn($,"RID",L),zn($,"TYPE","terminate"),wn(E,$),L=new Jn(E,E.j,L),L.M=2,L.A=Ki(Mr($)),$=!1,x.navigator&&x.navigator.sendBeacon)try{$=x.navigator.sendBeacon(L.A.toString(),"")}catch{}!$&&x.Image&&(new Image().src=L.A,$=!0),$||(L.g=rr(L.j,null),L.g.ea(L.A)),L.F=Date.now(),Dt(L)}Jr(E)}function Gn(E){E.g&&(ms(E),E.g.cancel(),E.g=null)}function ro(E){Gn(E),E.v&&(x.clearTimeout(E.v),E.v=null),qs(E),E.h.cancel(),E.m&&(typeof E.m=="number"&&x.clearTimeout(E.m),E.m=null)}function bn(E){if(!br(E.h)&&!E.m){E.m=!0;var L=E.Ea;at||oe(),Qe||(at(),Qe=!0),he.add(L,E),E.D=0}}function an(E,L){return Ln(E.h)>=E.h.j-(E.m?1:0)?!1:E.m?(E.i=L.G.concat(E.i),!0):E.I==1||E.I==2||E.D>=(E.Sa?0:E.Ta)?!1:(E.m=rn(O(E.Ea,E,L),Ec(E,E.D)),E.D++,!0)}a.Ea=function(E){if(this.m)if(this.m=null,this.I==1){if(!E){this.V=Math.floor(Math.random()*1e5),E=this.V++;const De=new Jn(this,this.j,E);let Ze=this.o;if(this.U&&(Ze?(Ze=jt(Ze),Qn(Ze,this.U)):Ze=this.U),this.u!==null||this.R||(De.J=Ze,Ze=null),this.S)e:{for(var L=0,$=0;$<this.i.length;$++){t:{var ne=this.i[$];if("__data__"in ne.map&&(ne=ne.map.__data__,typeof ne=="string")){ne=ne.length;break t}ne=void 0}if(ne===void 0)break;if(L+=ne,L>4096){L=$;break e}if(L===4096||$===this.i.length-1){L=$+1;break e}}L=1e3}else L=1e3;L=Io(this,De,L),$=Mr(this.J),zn($,"RID",E),zn($,"CVER",22),this.G&&zn($,"X-HTTP-Session-Id",this.G),wn(this,$),Ze&&(this.R?L="headers="+Ue(Qr(Ze))+"&"+L:this.u&&ui($,this.u,Ze)),Xr(this.h,De),this.Ra&&zn($,"TYPE","init"),this.S?(zn($,"$req",L),zn($,"SID","null"),De.U=!0,Rt(De,$,null)):Rt(De,$,L),this.I=2}}else this.I==3&&(E?io(this,E):this.i.length==0||br(this.h)||io(this))};function io(E,L){var $;L?$=L.l:$=E.V++;const ne=Mr(E.J);zn(ne,"SID",E.M),zn(ne,"RID",$),zn(ne,"AID",E.K),wn(E,ne),E.u&&E.o&&ui(ne,E.u,E.o),$=new Jn(E,E.j,$,E.D+1),E.u===null&&($.J=E.o),L&&(E.i=L.G.concat(E.i)),L=Io(E,$,1e3),$.H=Math.round(E.va*.5)+Math.round(E.va*.5*Math.random()),Xr(E.h,$),Rt($,ne,L)}function wn(E,L){E.H&&St(E.H,function($,ne){zn(L,ne,$)}),E.l&&St({},function($,ne){zn(L,ne,$)})}function Io(E,L,$){$=Math.min(E.i.length,$);const ne=E.l?O(E.l.Ka,E.l,E):null;e:{var De=E.i;let ln=-1;for(;;){const dr=["count="+$];ln==-1?$>0?(ln=De[0].g,dr.push("ofs="+ln)):ln=0:dr.push("ofs="+ln);let on=!0;for(let Or=0;Or<$;Or++){var Ze=De[Or].g;const hi=De[Or].map;if(Ze-=ln,Ze<0)ln=Math.max(0,De[Or].g-100),on=!1;else try{Ze="req"+Ze+"_"||"";try{var _t=hi instanceof Map?hi:Object.entries(hi);for(const[es,xi]of _t){let Zs=xi;c(xi)&&(Zs=H(xi)),dr.push(Ze+es+"="+encodeURIComponent(Zs))}}catch(es){throw dr.push(Ze+"type="+encodeURIComponent("_badmap")),es}}catch{ne&&ne(hi)}}if(on){_t=dr.join("&");break e}}_t=void 0}return E=E.i.splice(0,$),L.G=E,_t}function Si(E){if(!E.g&&!E.v){E.Y=1;var L=E.Da;at||oe(),Qe||(at(),Qe=!0),he.add(L,E),E.A=0}}function $s(E){return E.g||E.v||E.A>=3?!1:(E.Y++,E.v=rn(O(E.Da,E),Ec(E,E.A)),E.A++,!0)}a.Da=function(){if(this.v=null,bl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var E=4*this.T;this.j.info("BP detection timer enabled: "+E),this.B=rn(O(this.Wa,this),E)}},a.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ft(10),Gn(this),bl(this))};function ms(E){E.B!=null&&(x.clearTimeout(E.B),E.B=null)}function bl(E){E.g=new Jn(E,E.j,"rpc",E.Y),E.u===null&&(E.g.J=E.o),E.g.P=0;var L=Mr(E.na);zn(L,"RID","rpc"),zn(L,"SID",E.M),zn(L,"AID",E.K),zn(L,"CI",E.F?"0":"1"),!E.F&&E.ia&&zn(L,"TO",E.ia),zn(L,"TYPE","xmlhttp"),wn(E,L),E.u&&E.o&&ui(L,E.u,E.o),E.O&&(E.g.H=E.O);var $=E.g;E=E.ba,$.M=1,$.A=Ki(Mr(L)),$.u=null,$.R=!0,Ut($,E)}a.Va=function(){this.C!=null&&(this.C=null,Gn(this),$s(this),Ft(19))};function qs(E){E.C!=null&&(x.clearTimeout(E.C),E.C=null)}function Ra(E,L){var $=null;if(E.g==L){qs(E),ms(E),E.g=null;var ne=2}else if(cs(E.h,L))$=L.G,yi(E.h,L),ne=1;else return;if(E.I!=0){if(L.o)if(ne==1){$=L.u?L.u.length:0,L=Date.now()-L.F;var De=E.D;ne=it(),Ot(ne,new Me(ne,$)),bn(E)}else Si(E);else if(De=L.m,De==3||De==0&&L.X>0||!(ne==1&&an(E,L)||ne==2&&$s(E)))switch($&&$.length>0&&(L=E.h,L.i=L.i.concat($)),De){case 1:Gs(E,5);break;case 4:Gs(E,10);break;case 3:Gs(E,6);break;default:Gs(E,2)}}}function Ec(E,L){let $=E.Qa+Math.floor(Math.random()*E.Za);return E.isActive()||($*=2),$*L}function Gs(E,L){if(E.j.info("Error code "+L),L==2){var $=O(E.bb,E),ne=E.Ua;const De=!ne;ne=new Ur(ne||"//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||qn(ne,"https"),Ki(ne),De?xl(ne.toString(),$):Wu(ne.toString(),$)}else Ft(2);E.I=0,E.l&&E.l.pa(L),Jr(E),ro(E)}a.bb=function(E){E?(this.j.info("Successfully pinged google.com"),Ft(2)):(this.j.info("Failed to ping google.com"),Ft(1))};function Jr(E){if(E.I=0,E.ja=[],E.l){const L=Oi(E.h);(L.length!=0||E.i.length!=0)&&($e(E.ja,L),$e(E.ja,E.i),E.h.i.length=0,xe(E.i),E.i.length=0),E.l.oa()}}function Ji(E,L,$){var ne=$ instanceof Ur?Mr($):new Ur($);if(ne.g!="")L&&(ne.g=L+"."+ne.g),us(ne,ne.u);else{var De=x.location;ne=De.protocol,L=L?L+"."+De.hostname:De.hostname,De=+De.port;const Ze=new Ur(null);ne&&qn(Ze,ne),L&&(Ze.g=L),De&&us(Ze,De),$&&(Ze.h=$),ne=Ze}return $=E.G,L=E.wa,$&&L&&zn(ne,$,L),zn(ne,"VER",E.ka),wn(E,ne),ne}function rr(E,L,$){if(L&&!E.L)throw Error("Can't create secondary domain capable XhrIo object.");return L=E.Aa&&!E.ma?new Dn(new jr({ab:$})):new Dn(E.ma),L.Fa(E.L),L}a.isActive=function(){return!!this.l&&this.l.isActive(this)};function Hs(){}a=Hs.prototype,a.ra=function(){},a.qa=function(){},a.pa=function(){},a.oa=function(){},a.isActive=function(){return!0},a.Ka=function(){};function So(){}So.prototype.g=function(E,L){return new Gr(E,L)};function Gr(E,L){$t.call(this),this.g=new ka(L),this.l=E,this.h=L&&L.messageUrlParams||null,E=L&&L.messageHeaders||null,L&&L.clientProtocolHeaderRequired&&(E?E["X-Client-Protocol"]="webchannel":E={"X-Client-Protocol":"webchannel"}),this.g.o=E,E=L&&L.initMessageHeaders||null,L&&L.messageContentType&&(E?E["X-WebChannel-Content-Type"]=L.messageContentType:E={"X-WebChannel-Content-Type":L.messageContentType}),L&&L.sa&&(E?E["X-WebChannel-Client-Profile"]=L.sa:E={"X-WebChannel-Client-Profile":L.sa}),this.g.U=E,(E=L&&L.Qb)&&!de(E)&&(this.g.u=E),this.A=L&&L.supportsCrossDomainXhr||!1,this.v=L&&L.sendRawJson||!1,(L=L&&L.httpSessionIdParam)&&!de(L)&&(this.g.G=L,E=this.h,E!==null&&L in E&&(E=this.h,L in E&&delete E[L])),this.j=new Ws(this)}Y(Gr,$t),Gr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Gr.prototype.close=function(){Ss(this.g)},Gr.prototype.o=function(E){var L=this.g;if(typeof E=="string"){var $={};$.__data__=E,E=$}else this.v&&($={},$.__data__=H(E),E=$);L.i.push(new ls(L.Ya++,E)),L.I==3&&bn(L)},Gr.prototype.N=function(){this.g.l=null,delete this.j,Ss(this.g),delete this.g,Gr.Z.N.call(this)};function hr(E){we.call(this),E.__headers__&&(this.headers=E.__headers__,this.statusCode=E.__status__,delete E.__headers__,delete E.__status__);var L=E.__sm__;if(L){e:{for(const $ in L){E=$;break e}E=void 0}(this.i=E)&&(E=this.i,L=L!==null&&E in L?L[E]:void 0),this.data=L}else this.data=E}Y(hr,we);function wl(){ke.call(this),this.status=1}Y(wl,ke);function Ws(E){this.g=E}Y(Ws,Hs),Ws.prototype.ra=function(){Ot(this.g,"a")},Ws.prototype.qa=function(E){Ot(this.g,new hr(E))},Ws.prototype.pa=function(E){Ot(this.g,new wl)},Ws.prototype.oa=function(){Ot(this.g,"b")},So.prototype.createWebChannel=So.prototype.g,Gr.prototype.send=Gr.prototype.o,Gr.prototype.open=Gr.prototype.m,Gr.prototype.close=Gr.prototype.close,f1=function(){return new So},p1=function(){return it()},d1=Ge,n_={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Fe.NO_ERROR=0,Fe.TIMEOUT=8,Fe.HTTP_ERROR=6,of=Fe,wt.COMPLETE="complete",h1=wt,V.EventType=Ie,Ie.OPEN="a",Ie.CLOSE="b",Ie.ERROR="c",Ie.MESSAGE="d",$t.prototype.listen=$t.prototype.J,ed=V,Dn.prototype.listenOnce=Dn.prototype.K,Dn.prototype.getLastError=Dn.prototype.Ha,Dn.prototype.getLastErrorCode=Dn.prototype.ya,Dn.prototype.getStatus=Dn.prototype.ca,Dn.prototype.getResponseJson=Dn.prototype.La,Dn.prototype.getResponseText=Dn.prototype.la,Dn.prototype.send=Dn.prototype.ea,Dn.prototype.setWithCredentials=Dn.prototype.Fa,u1=Dn}).apply(typeof Zp<"u"?Zp:typeof self<"u"?self:typeof window<"u"?window:{});const lx="@firebase/firestore",cx="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(n){this.uid=n}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(n){return n.uid===this.uid}}qi.UNAUTHENTICATED=new qi(null),qi.GOOGLE_CREDENTIALS=new qi("google-credentials-uid"),qi.FIRST_PARTY=new qi("first-party-uid"),qi.MOCK_USER=new qi("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ju="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mc=new k_("@firebase/firestore");function Eu(){return mc.logLevel}function zt(a,...n){if(mc.logLevel<=Vn.DEBUG){const o=n.map(L_);mc.debug(`Firestore (${ju}): ${a}`,...o)}}function Ia(a,...n){if(mc.logLevel<=Vn.ERROR){const o=n.map(L_);mc.error(`Firestore (${ju}): ${a}`,...o)}}function zu(a,...n){if(mc.logLevel<=Vn.WARN){const o=n.map(L_);mc.warn(`Firestore (${ju}): ${a}`,...o)}}function L_(a){if(typeof a=="string")return a;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(o){return JSON.stringify(o)})(a)}catch{return a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function un(a,n,o){let h="Unexpected state";typeof n=="string"?h=n:o=n,m1(a,h,o)}function m1(a,n,o){let h=`FIRESTORE (${ju}) INTERNAL ASSERTION FAILED: ${n} (ID: ${a.toString(16)})`;if(o!==void 0)try{h+=" CONTEXT: "+JSON.stringify(o)}catch{h+=" CONTEXT: "+o}throw Ia(h),new Error(h)}function ar(a,n,o,h){let g="Unexpected state";typeof o=="string"?g=o:h=o,a||m1(n,g,h)}function En(a,n){return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ut={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Gt extends Zo{constructor(n,o){super(n,o),this.code=n,this.message=o,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(){this.promise=new Promise(((n,o)=>{this.resolve=n,this.reject=o}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g1{constructor(n,o){this.user=o,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${n}`)}}class WA{getToken(){return Promise.resolve(null)}invalidateToken(){}start(n,o){n.enqueueRetryable((()=>o(qi.UNAUTHENTICATED)))}shutdown(){}}class ZA{constructor(n){this.token=n,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(n,o){this.changeListener=o,n.enqueueRetryable((()=>o(this.token.user)))}shutdown(){this.changeListener=null}}class KA{constructor(n){this.t=n,this.currentUser=qi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(n,o){ar(this.o===void 0,42304);let h=this.i;const g=k=>this.i!==h?(h=this.i,o(k)):Promise.resolve();let w=new hc;this.o=()=>{this.i++,this.currentUser=this.u(),w.resolve(),w=new hc,n.enqueueRetryable((()=>g(this.currentUser)))};const x=()=>{const k=w;n.enqueueRetryable((async()=>{await k.promise,await g(this.currentUser)}))},c=k=>{zt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=k,this.o&&(this.auth.addAuthTokenListener(this.o),x())};this.t.onInit((k=>c(k))),setTimeout((()=>{if(!this.auth){const k=this.t.getImmediate({optional:!0});k?c(k):(zt("FirebaseAuthCredentialsProvider","Auth not yet detected"),w.resolve(),w=new hc)}}),0),x()}getToken(){const n=this.i,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then((h=>this.i!==n?(zt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):h?(ar(typeof h.accessToken=="string",31837,{l:h}),new g1(h.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const n=this.auth&&this.auth.getUid();return ar(n===null||typeof n=="string",2055,{h:n}),new qi(n)}}class XA{constructor(n,o,h){this.P=n,this.T=o,this.I=h,this.type="FirstParty",this.user=qi.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const n=this.R();return n&&this.A.set("Authorization",n),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class YA{constructor(n,o,h){this.P=n,this.T=o,this.I=h}getToken(){return Promise.resolve(new XA(this.P,this.T,this.I))}start(n,o){n.enqueueRetryable((()=>o(qi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ux{constructor(n){this.value=n,this.type="AppCheck",this.headers=new Map,n&&n.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class QA{constructor(n,o){this.V=o,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ws(n)&&n.settings.appCheckToken&&(this.p=n.settings.appCheckToken)}start(n,o){ar(this.o===void 0,3512);const h=w=>{w.error!=null&&zt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${w.error.message}`);const x=w.token!==this.m;return this.m=w.token,zt("FirebaseAppCheckTokenProvider",`Received ${x?"new":"existing"} token.`),x?o(w.token):Promise.resolve()};this.o=w=>{n.enqueueRetryable((()=>h(w)))};const g=w=>{zt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=w,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((w=>g(w))),setTimeout((()=>{if(!this.appCheck){const w=this.V.getImmediate({optional:!0});w?g(w):zt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ux(this.p));const n=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(n).then((o=>o?(ar(typeof o.token=="string",44558,{tokenResult:o}),this.m=o.token,new ux(o.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JA(a){const n=typeof self<"u"&&(self.crypto||self.msCrypto),o=new Uint8Array(a);if(n&&typeof n.getRandomValues=="function")n.getRandomValues(o);else for(let h=0;h<a;h++)o[h]=Math.floor(256*Math.random());return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z_{static newId(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=62*Math.floor(4.129032258064516);let h="";for(;h.length<20;){const g=JA(40);for(let w=0;w<g.length;++w)h.length<20&&g[w]<o&&(h+=n.charAt(g[w]%62))}return h}}function Bn(a,n){return a<n?-1:a>n?1:0}function r_(a,n){const o=Math.min(a.length,n.length);for(let h=0;h<o;h++){const g=a.charAt(h),w=n.charAt(h);if(g!==w)return Ng(g)===Ng(w)?Bn(g,w):Ng(g)?1:-1}return Bn(a.length,n.length)}const eP=55296,tP=57343;function Ng(a){const n=a.charCodeAt(0);return n>=eP&&n<=tP}function Ou(a,n,o){return a.length===n.length&&a.every(((h,g)=>o(h,n[g])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hx="__name__";class Fo{constructor(n,o,h){o===void 0?o=0:o>n.length&&un(637,{offset:o,range:n.length}),h===void 0?h=n.length-o:h>n.length-o&&un(1746,{length:h,range:n.length-o}),this.segments=n,this.offset=o,this.len=h}get length(){return this.len}isEqual(n){return Fo.comparator(this,n)===0}child(n){const o=this.segments.slice(this.offset,this.limit());return n instanceof Fo?n.forEach((h=>{o.push(h)})):o.push(n),this.construct(o)}limit(){return this.offset+this.length}popFirst(n){return n=n===void 0?1:n,this.construct(this.segments,this.offset+n,this.length-n)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(n){return this.segments[this.offset+n]}isEmpty(){return this.length===0}isPrefixOf(n){if(n.length<this.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==n.get(o))return!1;return!0}isImmediateParentOf(n){if(this.length+1!==n.length)return!1;for(let o=0;o<this.length;o++)if(this.get(o)!==n.get(o))return!1;return!0}forEach(n){for(let o=this.offset,h=this.limit();o<h;o++)n(this.segments[o])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(n,o){const h=Math.min(n.length,o.length);for(let g=0;g<h;g++){const w=Fo.compareSegments(n.get(g),o.get(g));if(w!==0)return w}return Bn(n.length,o.length)}static compareSegments(n,o){const h=Fo.isNumericId(n),g=Fo.isNumericId(o);return h&&!g?-1:!h&&g?1:h&&g?Fo.extractNumericId(n).compare(Fo.extractNumericId(o)):r_(n,o)}static isNumericId(n){return n.startsWith("__id")&&n.endsWith("__")}static extractNumericId(n){return ll.fromString(n.substring(4,n.length-2))}}class Vr extends Fo{construct(n,o,h){return new Vr(n,o,h)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...n){const o=[];for(const h of n){if(h.indexOf("//")>=0)throw new Gt(ut.INVALID_ARGUMENT,`Invalid segment (${h}). Paths must not contain // in them.`);o.push(...h.split("/").filter((g=>g.length>0)))}return new Vr(o)}static emptyPath(){return new Vr([])}}const nP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Mi extends Fo{construct(n,o,h){return new Mi(n,o,h)}static isValidIdentifier(n){return nP.test(n)}canonicalString(){return this.toArray().map((n=>(n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Mi.isValidIdentifier(n)||(n="`"+n+"`"),n))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===hx}static keyField(){return new Mi([hx])}static fromServerFormat(n){const o=[];let h="",g=0;const w=()=>{if(h.length===0)throw new Gt(ut.INVALID_ARGUMENT,`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);o.push(h),h=""};let x=!1;for(;g<n.length;){const c=n[g];if(c==="\\"){if(g+1===n.length)throw new Gt(ut.INVALID_ARGUMENT,"Path has trailing escape character: "+n);const k=n[g+1];if(k!=="\\"&&k!=="."&&k!=="`")throw new Gt(ut.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);h+=k,g+=2}else c==="`"?(x=!x,g++):c!=="."||x?(h+=c,g++):(w(),g++)}if(w(),x)throw new Gt(ut.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new Mi(o)}static emptyPath(){return new Mi([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(n){this.path=n}static fromPath(n){return new en(Vr.fromString(n))}static fromName(n){return new en(Vr.fromString(n).popFirst(5))}static empty(){return new en(Vr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(n){return this.path.length>=2&&this.path.get(this.path.length-2)===n}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(n){return n!==null&&Vr.comparator(this.path,n.path)===0}toString(){return this.path.toString()}static comparator(n,o){return Vr.comparator(n.path,o.path)}static isDocumentKey(n){return n.length%2==0}static fromSegments(n){return new en(new Vr(n.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rP(a,n,o){if(!o)throw new Gt(ut.INVALID_ARGUMENT,`Function ${a}() cannot be called with an empty ${n}.`)}function iP(a,n,o,h){if(n===!0&&h===!0)throw new Gt(ut.INVALID_ARGUMENT,`${a} and ${o} cannot be used together.`)}function dx(a){if(!en.isDocumentKey(a))throw new Gt(ut.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${a} has ${a.length}.`)}function _1(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}function O_(a){if(a===void 0)return"undefined";if(a===null)return"null";if(typeof a=="string")return a.length>20&&(a=`${a.substring(0,20)}...`),JSON.stringify(a);if(typeof a=="number"||typeof a=="boolean")return""+a;if(typeof a=="object"){if(a instanceof Array)return"an array";{const n=(function(h){return h.constructor?h.constructor.name:null})(a);return n?`a custom ${n} object`:"an object"}}return typeof a=="function"?"a function":un(12329,{type:typeof a})}function cl(a,n){if("_delegate"in a&&(a=a._delegate),!(a instanceof n)){if(n.name===a.constructor.name)throw new Gt(ut.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const o=O_(a);throw new Gt(ut.INVALID_ARGUMENT,`Expected type '${n.name}', but it was: ${o}`)}}return a}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function li(a,n){const o={typeString:a};return n&&(o.value=n),o}function Td(a,n){if(!_1(a))throw new Gt(ut.INVALID_ARGUMENT,"JSON must be an object");let o;for(const h in n)if(n[h]){const g=n[h].typeString,w="value"in n[h]?{value:n[h].value}:void 0;if(!(h in a)){o=`JSON missing required field: '${h}'`;break}const x=a[h];if(g&&typeof x!==g){o=`JSON field '${h}' must be a ${g}.`;break}if(w!==void 0&&x!==w.value){o=`Expected '${h}' field to equal '${w.value}'`;break}}if(o)throw new Gt(ut.INVALID_ARGUMENT,o);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const px=-62135596800,fx=1e6;class Pr{static now(){return Pr.fromMillis(Date.now())}static fromDate(n){return Pr.fromMillis(n.getTime())}static fromMillis(n){const o=Math.floor(n/1e3),h=Math.floor((n-1e3*o)*fx);return new Pr(o,h)}constructor(n,o){if(this.seconds=n,this.nanoseconds=o,o<0)throw new Gt(ut.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+o);if(o>=1e9)throw new Gt(ut.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+o);if(n<px)throw new Gt(ut.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n);if(n>=253402300800)throw new Gt(ut.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/fx}_compareTo(n){return this.seconds===n.seconds?Bn(this.nanoseconds,n.nanoseconds):Bn(this.seconds,n.seconds)}isEqual(n){return n.seconds===this.seconds&&n.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Pr._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(n){if(Td(n,Pr._jsonSchema))return new Pr(n.seconds,n.nanoseconds)}valueOf(){const n=this.seconds-px;return String(n).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Pr._jsonSchemaVersion="firestore/timestamp/1.0",Pr._jsonSchema={type:li("string",Pr._jsonSchemaVersion),seconds:li("number"),nanoseconds:li("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{static fromTimestamp(n){return new yn(n)}static min(){return new yn(new Pr(0,0))}static max(){return new yn(new Pr(253402300799,999999999))}constructor(n){this.timestamp=n}compareTo(n){return this.timestamp._compareTo(n.timestamp)}isEqual(n){return this.timestamp.isEqual(n.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dd=-1;function sP(a,n){const o=a.toTimestamp().seconds,h=a.toTimestamp().nanoseconds+1,g=yn.fromTimestamp(h===1e9?new Pr(o+1,0):new Pr(o,h));return new hl(g,en.empty(),n)}function oP(a){return new hl(a.readTime,a.key,dd)}class hl{constructor(n,o,h){this.readTime=n,this.documentKey=o,this.largestBatchId=h}static min(){return new hl(yn.min(),en.empty(),dd)}static max(){return new hl(yn.max(),en.empty(),dd)}}function aP(a,n){let o=a.readTime.compareTo(n.readTime);return o!==0?o:(o=en.comparator(a.documentKey,n.documentKey),o!==0?o:Bn(a.largestBatchId,n.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lP="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class cP{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(n){this.onCommittedListeners.push(n)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((n=>n()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $u(a){if(a.code!==ut.FAILED_PRECONDITION||a.message!==lP)throw a;zt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(n){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,n((o=>{this.isDone=!0,this.result=o,this.nextCallback&&this.nextCallback(o)}),(o=>{this.isDone=!0,this.error=o,this.catchCallback&&this.catchCallback(o)}))}catch(n){return this.next(void 0,n)}next(n,o){return this.callbackAttached&&un(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(o,this.error):this.wrapSuccess(n,this.result):new st(((h,g)=>{this.nextCallback=w=>{this.wrapSuccess(n,w).next(h,g)},this.catchCallback=w=>{this.wrapFailure(o,w).next(h,g)}}))}toPromise(){return new Promise(((n,o)=>{this.next(n,o)}))}wrapUserFunction(n){try{const o=n();return o instanceof st?o:st.resolve(o)}catch(o){return st.reject(o)}}wrapSuccess(n,o){return n?this.wrapUserFunction((()=>n(o))):st.resolve(o)}wrapFailure(n,o){return n?this.wrapUserFunction((()=>n(o))):st.reject(o)}static resolve(n){return new st(((o,h)=>{o(n)}))}static reject(n){return new st(((o,h)=>{h(n)}))}static waitFor(n){return new st(((o,h)=>{let g=0,w=0,x=!1;n.forEach((c=>{++g,c.next((()=>{++w,x&&w===g&&o()}),(k=>h(k)))})),x=!0,w===g&&o()}))}static or(n){let o=st.resolve(!1);for(const h of n)o=o.next((g=>g?st.resolve(g):h()));return o}static forEach(n,o){const h=[];return n.forEach(((g,w)=>{h.push(o.call(this,g,w))})),this.waitFor(h)}static mapArray(n,o){return new st(((h,g)=>{const w=n.length,x=new Array(w);let c=0;for(let k=0;k<w;k++){const O=k;o(n[O]).next((U=>{x[O]=U,++c,c===w&&h(x)}),(U=>g(U)))}}))}static doWhile(n,o){return new st(((h,g)=>{const w=()=>{n()===!0?o().next((()=>{w()}),g):h()};w()}))}}function uP(a){const n=a.match(/Android ([\d.]+)/i),o=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(o)}function qu(a){return a.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(n,o){this.previousValue=n,o&&(o.sequenceNumberHandler=h=>this.ae(h),this.ue=h=>o.writeSequenceNumber(h))}ae(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){const n=++this.previousValue;return this.ue&&this.ue(n),n}}Gf.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F_=-1;function Hf(a){return a==null}function xf(a){return a===0&&1/a==-1/0}function hP(a){return typeof a=="number"&&Number.isInteger(a)&&!xf(a)&&a<=Number.MAX_SAFE_INTEGER&&a>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y1="";function dP(a){let n="";for(let o=0;o<a.length;o++)n.length>0&&(n=mx(n)),n=pP(a.get(o),n);return mx(n)}function pP(a,n){let o=n;const h=a.length;for(let g=0;g<h;g++){const w=a.charAt(g);switch(w){case"\0":o+="";break;case y1:o+="";break;default:o+=w}}return o}function mx(a){return a+y1+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gx(a){let n=0;for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&n++;return n}function _l(a,n){for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&n(o,a[o])}function v1(a){for(const n in a)if(Object.prototype.hasOwnProperty.call(a,n))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(n,o){this.comparator=n,this.root=o||Ci.EMPTY}insert(n,o){return new Br(this.comparator,this.root.insert(n,o,this.comparator).copy(null,null,Ci.BLACK,null,null))}remove(n){return new Br(this.comparator,this.root.remove(n,this.comparator).copy(null,null,Ci.BLACK,null,null))}get(n){let o=this.root;for(;!o.isEmpty();){const h=this.comparator(n,o.key);if(h===0)return o.value;h<0?o=o.left:h>0&&(o=o.right)}return null}indexOf(n){let o=0,h=this.root;for(;!h.isEmpty();){const g=this.comparator(n,h.key);if(g===0)return o+h.left.size;g<0?h=h.left:(o+=h.left.size+1,h=h.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(n){return this.root.inorderTraversal(n)}forEach(n){this.inorderTraversal(((o,h)=>(n(o,h),!1)))}toString(){const n=[];return this.inorderTraversal(((o,h)=>(n.push(`${o}:${h}`),!1))),`{${n.join(", ")}}`}reverseTraversal(n){return this.root.reverseTraversal(n)}getIterator(){return new Kp(this.root,null,this.comparator,!1)}getIteratorFrom(n){return new Kp(this.root,n,this.comparator,!1)}getReverseIterator(){return new Kp(this.root,null,this.comparator,!0)}getReverseIteratorFrom(n){return new Kp(this.root,n,this.comparator,!0)}}class Kp{constructor(n,o,h,g){this.isReverse=g,this.nodeStack=[];let w=1;for(;!n.isEmpty();)if(w=o?h(n.key,o):1,o&&g&&(w*=-1),w<0)n=this.isReverse?n.left:n.right;else{if(w===0){this.nodeStack.push(n);break}this.nodeStack.push(n),n=this.isReverse?n.right:n.left}}getNext(){let n=this.nodeStack.pop();const o={key:n.key,value:n.value};if(this.isReverse)for(n=n.left;!n.isEmpty();)this.nodeStack.push(n),n=n.right;else for(n=n.right;!n.isEmpty();)this.nodeStack.push(n),n=n.left;return o}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const n=this.nodeStack[this.nodeStack.length-1];return{key:n.key,value:n.value}}}class Ci{constructor(n,o,h,g,w){this.key=n,this.value=o,this.color=h??Ci.RED,this.left=g??Ci.EMPTY,this.right=w??Ci.EMPTY,this.size=this.left.size+1+this.right.size}copy(n,o,h,g,w){return new Ci(n??this.key,o??this.value,h??this.color,g??this.left,w??this.right)}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,o,h){let g=this;const w=h(n,g.key);return g=w<0?g.copy(null,null,null,g.left.insert(n,o,h),null):w===0?g.copy(null,o,null,null,null):g.copy(null,null,null,null,g.right.insert(n,o,h)),g.fixUp()}removeMin(){if(this.left.isEmpty())return Ci.EMPTY;let n=this;return n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.removeMin(),null),n.fixUp()}remove(n,o){let h,g=this;if(o(n,g.key)<0)g.left.isEmpty()||g.left.isRed()||g.left.left.isRed()||(g=g.moveRedLeft()),g=g.copy(null,null,null,g.left.remove(n,o),null);else{if(g.left.isRed()&&(g=g.rotateRight()),g.right.isEmpty()||g.right.isRed()||g.right.left.isRed()||(g=g.moveRedRight()),o(n,g.key)===0){if(g.right.isEmpty())return Ci.EMPTY;h=g.right.min(),g=g.copy(h.key,h.value,null,null,g.right.removeMin())}g=g.copy(null,null,null,null,g.right.remove(n,o))}return g.fixUp()}isRed(){return this.color}fixUp(){let n=this;return n.right.isRed()&&!n.left.isRed()&&(n=n.rotateLeft()),n.left.isRed()&&n.left.left.isRed()&&(n=n.rotateRight()),n.left.isRed()&&n.right.isRed()&&(n=n.colorFlip()),n}moveRedLeft(){let n=this.colorFlip();return n.right.left.isRed()&&(n=n.copy(null,null,null,null,n.right.rotateRight()),n=n.rotateLeft(),n=n.colorFlip()),n}moveRedRight(){let n=this.colorFlip();return n.left.left.isRed()&&(n=n.rotateRight(),n=n.colorFlip()),n}rotateLeft(){const n=this.copy(null,null,Ci.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight(){const n=this.copy(null,null,Ci.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip(){const n=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,o)}checkMaxDepth(){const n=this.check();return Math.pow(2,n)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw un(43730,{key:this.key,value:this.value});if(this.right.isRed())throw un(14113,{key:this.key,value:this.value});const n=this.left.check();if(n!==this.right.check())throw un(27949);return n+(this.isRed()?0:1)}}Ci.EMPTY=null,Ci.RED=!0,Ci.BLACK=!1;Ci.EMPTY=new class{constructor(){this.size=0}get key(){throw un(57766)}get value(){throw un(16141)}get color(){throw un(16727)}get left(){throw un(29726)}get right(){throw un(36894)}copy(n,o,h,g,w){return this}insert(n,o,h){return new Ci(n,o)}remove(n,o){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(n){this.comparator=n,this.data=new Br(this.comparator)}has(n){return this.data.get(n)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(n){return this.data.indexOf(n)}forEach(n){this.data.inorderTraversal(((o,h)=>(n(o),!1)))}forEachInRange(n,o){const h=this.data.getIteratorFrom(n[0]);for(;h.hasNext();){const g=h.getNext();if(this.comparator(g.key,n[1])>=0)return;o(g.key)}}forEachWhile(n,o){let h;for(h=o!==void 0?this.data.getIteratorFrom(o):this.data.getIterator();h.hasNext();)if(!n(h.getNext().key))return}firstAfterOrEqual(n){const o=this.data.getIteratorFrom(n);return o.hasNext()?o.getNext().key:null}getIterator(){return new _x(this.data.getIterator())}getIteratorFrom(n){return new _x(this.data.getIteratorFrom(n))}add(n){return this.copy(this.data.remove(n).insert(n,!0))}delete(n){return this.has(n)?this.copy(this.data.remove(n)):this}isEmpty(){return this.data.isEmpty()}unionWith(n){let o=this;return o.size<n.size&&(o=n,n=this),n.forEach((h=>{o=o.add(h)})),o}isEqual(n){if(!(n instanceof gi)||this.size!==n.size)return!1;const o=this.data.getIterator(),h=n.data.getIterator();for(;o.hasNext();){const g=o.getNext().key,w=h.getNext().key;if(this.comparator(g,w)!==0)return!1}return!0}toArray(){const n=[];return this.forEach((o=>{n.push(o)})),n}toString(){const n=[];return this.forEach((o=>n.push(o))),"SortedSet("+n.toString()+")"}copy(n){const o=new gi(this.comparator);return o.data=n,o}}class _x{constructor(n){this.iter=n}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(n){this.fields=n,n.sort(Mi.comparator)}static empty(){return new Ns([])}unionWith(n){let o=new gi(Mi.comparator);for(const h of this.fields)o=o.add(h);for(const h of n)o=o.add(h);return new Ns(o.toArray())}covers(n){for(const o of this.fields)if(o.isPrefixOf(n))return!0;return!1}isEqual(n){return Ou(this.fields,n.fields,((o,h)=>o.isEqual(h)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(n){this.binaryString=n}static fromBase64String(n){const o=(function(g){try{return atob(g)}catch(w){throw typeof DOMException<"u"&&w instanceof DOMException?new x1("Invalid base64 string: "+w):w}})(n);return new Ri(o)}static fromUint8Array(n){const o=(function(g){let w="";for(let x=0;x<g.length;++x)w+=String.fromCharCode(g[x]);return w})(n);return new Ri(o)}[Symbol.iterator](){let n=0;return{next:()=>n<this.binaryString.length?{value:this.binaryString.charCodeAt(n++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(o){return btoa(o)})(this.binaryString)}toUint8Array(){return(function(o){const h=new Uint8Array(o.length);for(let g=0;g<o.length;g++)h[g]=o.charCodeAt(g);return h})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(n){return Bn(this.binaryString,n.binaryString)}isEqual(n){return this.binaryString===n.binaryString}}Ri.EMPTY_BYTE_STRING=new Ri("");const fP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function dl(a){if(ar(!!a,39018),typeof a=="string"){let n=0;const o=fP.exec(a);if(ar(!!o,46558,{timestamp:a}),o[1]){let g=o[1];g=(g+"000000000").substr(0,9),n=Number(g)}const h=new Date(a);return{seconds:Math.floor(h.getTime()/1e3),nanos:n}}return{seconds:Zr(a.seconds),nanos:Zr(a.nanos)}}function Zr(a){return typeof a=="number"?a:typeof a=="string"?Number(a):0}function pl(a){return typeof a=="string"?Ri.fromBase64String(a):Ri.fromUint8Array(a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b1="server_timestamp",w1="__type__",T1="__previous_value__",E1="__local_write_time__";function N_(a){var o,h;return((h=(((o=a==null?void 0:a.mapValue)==null?void 0:o.fields)||{})[w1])==null?void 0:h.stringValue)===b1}function Wf(a){const n=a.mapValue.fields[T1];return N_(n)?Wf(n):n}function pd(a){const n=dl(a.mapValue.fields[E1].timestampValue);return new Pr(n.seconds,n.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{constructor(n,o,h,g,w,x,c,k,O,U){this.databaseId=n,this.appId=o,this.persistenceKey=h,this.host=g,this.ssl=w,this.forceLongPolling=x,this.autoDetectLongPolling=c,this.longPollingOptions=k,this.useFetchStreams=O,this.isUsingEmulator=U}}const bf="(default)";class fd{constructor(n,o){this.projectId=n,this.database=o||bf}static empty(){return new fd("","")}get isDefaultDatabase(){return this.database===bf}isEqual(n){return n instanceof fd&&n.projectId===this.projectId&&n.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I1="__type__",gP="__max__",Xp={mapValue:{}},S1="__vector__",wf="value";function fl(a){return"nullValue"in a?0:"booleanValue"in a?1:"integerValue"in a||"doubleValue"in a?2:"timestampValue"in a?3:"stringValue"in a?5:"bytesValue"in a?6:"referenceValue"in a?7:"geoPointValue"in a?8:"arrayValue"in a?9:"mapValue"in a?N_(a)?4:yP(a)?9007199254740991:_P(a)?10:11:un(28295,{value:a})}function Go(a,n){if(a===n)return!0;const o=fl(a);if(o!==fl(n))return!1;switch(o){case 0:case 9007199254740991:return!0;case 1:return a.booleanValue===n.booleanValue;case 4:return pd(a).isEqual(pd(n));case 3:return(function(g,w){if(typeof g.timestampValue=="string"&&typeof w.timestampValue=="string"&&g.timestampValue.length===w.timestampValue.length)return g.timestampValue===w.timestampValue;const x=dl(g.timestampValue),c=dl(w.timestampValue);return x.seconds===c.seconds&&x.nanos===c.nanos})(a,n);case 5:return a.stringValue===n.stringValue;case 6:return(function(g,w){return pl(g.bytesValue).isEqual(pl(w.bytesValue))})(a,n);case 7:return a.referenceValue===n.referenceValue;case 8:return(function(g,w){return Zr(g.geoPointValue.latitude)===Zr(w.geoPointValue.latitude)&&Zr(g.geoPointValue.longitude)===Zr(w.geoPointValue.longitude)})(a,n);case 2:return(function(g,w){if("integerValue"in g&&"integerValue"in w)return Zr(g.integerValue)===Zr(w.integerValue);if("doubleValue"in g&&"doubleValue"in w){const x=Zr(g.doubleValue),c=Zr(w.doubleValue);return x===c?xf(x)===xf(c):isNaN(x)&&isNaN(c)}return!1})(a,n);case 9:return Ou(a.arrayValue.values||[],n.arrayValue.values||[],Go);case 10:case 11:return(function(g,w){const x=g.mapValue.fields||{},c=w.mapValue.fields||{};if(gx(x)!==gx(c))return!1;for(const k in x)if(x.hasOwnProperty(k)&&(c[k]===void 0||!Go(x[k],c[k])))return!1;return!0})(a,n);default:return un(52216,{left:a})}}function md(a,n){return(a.values||[]).find((o=>Go(o,n)))!==void 0}function Fu(a,n){if(a===n)return 0;const o=fl(a),h=fl(n);if(o!==h)return Bn(o,h);switch(o){case 0:case 9007199254740991:return 0;case 1:return Bn(a.booleanValue,n.booleanValue);case 2:return(function(w,x){const c=Zr(w.integerValue||w.doubleValue),k=Zr(x.integerValue||x.doubleValue);return c<k?-1:c>k?1:c===k?0:isNaN(c)?isNaN(k)?0:-1:1})(a,n);case 3:return yx(a.timestampValue,n.timestampValue);case 4:return yx(pd(a),pd(n));case 5:return r_(a.stringValue,n.stringValue);case 6:return(function(w,x){const c=pl(w),k=pl(x);return c.compareTo(k)})(a.bytesValue,n.bytesValue);case 7:return(function(w,x){const c=w.split("/"),k=x.split("/");for(let O=0;O<c.length&&O<k.length;O++){const U=Bn(c[O],k[O]);if(U!==0)return U}return Bn(c.length,k.length)})(a.referenceValue,n.referenceValue);case 8:return(function(w,x){const c=Bn(Zr(w.latitude),Zr(x.latitude));return c!==0?c:Bn(Zr(w.longitude),Zr(x.longitude))})(a.geoPointValue,n.geoPointValue);case 9:return vx(a.arrayValue,n.arrayValue);case 10:return(function(w,x){var se,xe,$e,Ce;const c=w.fields||{},k=x.fields||{},O=(se=c[wf])==null?void 0:se.arrayValue,U=(xe=k[wf])==null?void 0:xe.arrayValue,Y=Bn((($e=O==null?void 0:O.values)==null?void 0:$e.length)||0,((Ce=U==null?void 0:U.values)==null?void 0:Ce.length)||0);return Y!==0?Y:vx(O,U)})(a.mapValue,n.mapValue);case 11:return(function(w,x){if(w===Xp.mapValue&&x===Xp.mapValue)return 0;if(w===Xp.mapValue)return 1;if(x===Xp.mapValue)return-1;const c=w.fields||{},k=Object.keys(c),O=x.fields||{},U=Object.keys(O);k.sort(),U.sort();for(let Y=0;Y<k.length&&Y<U.length;++Y){const se=r_(k[Y],U[Y]);if(se!==0)return se;const xe=Fu(c[k[Y]],O[U[Y]]);if(xe!==0)return xe}return Bn(k.length,U.length)})(a.mapValue,n.mapValue);default:throw un(23264,{he:o})}}function yx(a,n){if(typeof a=="string"&&typeof n=="string"&&a.length===n.length)return Bn(a,n);const o=dl(a),h=dl(n),g=Bn(o.seconds,h.seconds);return g!==0?g:Bn(o.nanos,h.nanos)}function vx(a,n){const o=a.values||[],h=n.values||[];for(let g=0;g<o.length&&g<h.length;++g){const w=Fu(o[g],h[g]);if(w)return w}return Bn(o.length,h.length)}function Nu(a){return i_(a)}function i_(a){return"nullValue"in a?"null":"booleanValue"in a?""+a.booleanValue:"integerValue"in a?""+a.integerValue:"doubleValue"in a?""+a.doubleValue:"timestampValue"in a?(function(o){const h=dl(o);return`time(${h.seconds},${h.nanos})`})(a.timestampValue):"stringValue"in a?a.stringValue:"bytesValue"in a?(function(o){return pl(o).toBase64()})(a.bytesValue):"referenceValue"in a?(function(o){return en.fromName(o).toString()})(a.referenceValue):"geoPointValue"in a?(function(o){return`geo(${o.latitude},${o.longitude})`})(a.geoPointValue):"arrayValue"in a?(function(o){let h="[",g=!0;for(const w of o.values||[])g?g=!1:h+=",",h+=i_(w);return h+"]"})(a.arrayValue):"mapValue"in a?(function(o){const h=Object.keys(o.fields||{}).sort();let g="{",w=!0;for(const x of h)w?w=!1:g+=",",g+=`${x}:${i_(o.fields[x])}`;return g+"}"})(a.mapValue):un(61005,{value:a})}function af(a){switch(fl(a)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const n=Wf(a);return n?16+af(n):16;case 5:return 2*a.stringValue.length;case 6:return pl(a.bytesValue).approximateByteSize();case 7:return a.referenceValue.length;case 9:return(function(h){return(h.values||[]).reduce(((g,w)=>g+af(w)),0)})(a.arrayValue);case 10:case 11:return(function(h){let g=0;return _l(h.fields,((w,x)=>{g+=w.length+af(x)})),g})(a.mapValue);default:throw un(13486,{value:a})}}function s_(a){return!!a&&"integerValue"in a}function V_(a){return!!a&&"arrayValue"in a}function xx(a){return!!a&&"nullValue"in a}function bx(a){return!!a&&"doubleValue"in a&&isNaN(Number(a.doubleValue))}function lf(a){return!!a&&"mapValue"in a}function _P(a){var o,h;return((h=(((o=a==null?void 0:a.mapValue)==null?void 0:o.fields)||{})[I1])==null?void 0:h.stringValue)===S1}function sd(a){if(a.geoPointValue)return{geoPointValue:{...a.geoPointValue}};if(a.timestampValue&&typeof a.timestampValue=="object")return{timestampValue:{...a.timestampValue}};if(a.mapValue){const n={mapValue:{fields:{}}};return _l(a.mapValue.fields,((o,h)=>n.mapValue.fields[o]=sd(h))),n}if(a.arrayValue){const n={arrayValue:{values:[]}};for(let o=0;o<(a.arrayValue.values||[]).length;++o)n.arrayValue.values[o]=sd(a.arrayValue.values[o]);return n}return{...a}}function yP(a){return(((a.mapValue||{}).fields||{}).__type__||{}).stringValue===gP}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(n){this.value=n}static empty(){return new Ts({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let o=this.value;for(let h=0;h<n.length-1;++h)if(o=(o.mapValue.fields||{})[n.get(h)],!lf(o))return null;return o=(o.mapValue.fields||{})[n.lastSegment()],o||null}}set(n,o){this.getFieldsMap(n.popLast())[n.lastSegment()]=sd(o)}setAll(n){let o=Mi.emptyPath(),h={},g=[];n.forEach(((x,c)=>{if(!o.isImmediateParentOf(c)){const k=this.getFieldsMap(o);this.applyChanges(k,h,g),h={},g=[],o=c.popLast()}x?h[c.lastSegment()]=sd(x):g.push(c.lastSegment())}));const w=this.getFieldsMap(o);this.applyChanges(w,h,g)}delete(n){const o=this.field(n.popLast());lf(o)&&o.mapValue.fields&&delete o.mapValue.fields[n.lastSegment()]}isEqual(n){return Go(this.value,n.value)}getFieldsMap(n){let o=this.value;o.mapValue.fields||(o.mapValue={fields:{}});for(let h=0;h<n.length;++h){let g=o.mapValue.fields[n.get(h)];lf(g)&&g.mapValue.fields||(g={mapValue:{fields:{}}},o.mapValue.fields[n.get(h)]=g),o=g}return o.mapValue.fields}applyChanges(n,o,h){_l(o,((g,w)=>n[g]=w));for(const g of h)delete n[g]}clone(){return new Ts(sd(this.value))}}function A1(a){const n=[];return _l(a.fields,((o,h)=>{const g=new Mi([o]);if(lf(h)){const w=A1(h.mapValue).fields;if(w.length===0)n.push(g);else for(const x of w)n.push(g.child(x))}else n.push(g)})),new Ns(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(n,o,h,g,w,x,c){this.key=n,this.documentType=o,this.version=h,this.readTime=g,this.createTime=w,this.data=x,this.documentState=c}static newInvalidDocument(n){return new Gi(n,0,yn.min(),yn.min(),yn.min(),Ts.empty(),0)}static newFoundDocument(n,o,h,g){return new Gi(n,1,o,yn.min(),h,g,0)}static newNoDocument(n,o){return new Gi(n,2,o,yn.min(),yn.min(),Ts.empty(),0)}static newUnknownDocument(n,o){return new Gi(n,3,o,yn.min(),yn.min(),Ts.empty(),2)}convertToFoundDocument(n,o){return!this.createTime.isEqual(yn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=n),this.version=n,this.documentType=1,this.data=o,this.documentState=0,this}convertToNoDocument(n){return this.version=n,this.documentType=2,this.data=Ts.empty(),this.documentState=0,this}convertToUnknownDocument(n){return this.version=n,this.documentType=3,this.data=Ts.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=yn.min(),this}setReadTime(n){return this.readTime=n,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(n){return n instanceof Gi&&this.key.isEqual(n.key)&&this.version.isEqual(n.version)&&this.documentType===n.documentType&&this.documentState===n.documentState&&this.data.isEqual(n.data)}mutableCopy(){return new Gi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(n,o){this.position=n,this.inclusive=o}}function wx(a,n,o){let h=0;for(let g=0;g<a.position.length;g++){const w=n[g],x=a.position[g];if(w.field.isKeyField()?h=en.comparator(en.fromName(x.referenceValue),o.key):h=Fu(x,o.data.field(w.field)),w.dir==="desc"&&(h*=-1),h!==0)break}return h}function Tx(a,n){if(a===null)return n===null;if(n===null||a.inclusive!==n.inclusive||a.position.length!==n.position.length)return!1;for(let o=0;o<a.position.length;o++)if(!Go(a.position[o],n.position[o]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef{constructor(n,o="asc"){this.field=n,this.dir=o}}function vP(a,n){return a.dir===n.dir&&a.field.isEqual(n.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{}class fi extends P1{constructor(n,o,h){super(),this.field=n,this.op=o,this.value=h}static create(n,o,h){return n.isKeyField()?o==="in"||o==="not-in"?this.createKeyFieldInFilter(n,o,h):new bP(n,o,h):o==="array-contains"?new EP(n,h):o==="in"?new IP(n,h):o==="not-in"?new SP(n,h):o==="array-contains-any"?new AP(n,h):new fi(n,o,h)}static createKeyFieldInFilter(n,o,h){return o==="in"?new wP(n,h):new TP(n,h)}matches(n){const o=n.data.field(this.field);return this.op==="!="?o!==null&&o.nullValue===void 0&&this.matchesComparison(Fu(o,this.value)):o!==null&&fl(this.value)===fl(o)&&this.matchesComparison(Fu(o,this.value))}matchesComparison(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return un(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ho extends P1{constructor(n,o){super(),this.filters=n,this.op=o,this.Pe=null}static create(n,o){return new Ho(n,o)}matches(n){return C1(this)?this.filters.find((o=>!o.matches(n)))===void 0:this.filters.find((o=>o.matches(n)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((n,o)=>n.concat(o.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function C1(a){return a.op==="and"}function M1(a){return xP(a)&&C1(a)}function xP(a){for(const n of a.filters)if(n instanceof Ho)return!1;return!0}function o_(a){if(a instanceof fi)return a.field.canonicalString()+a.op.toString()+Nu(a.value);if(M1(a))return a.filters.map((n=>o_(n))).join(",");{const n=a.filters.map((o=>o_(o))).join(",");return`${a.op}(${n})`}}function k1(a,n){return a instanceof fi?(function(h,g){return g instanceof fi&&h.op===g.op&&h.field.isEqual(g.field)&&Go(h.value,g.value)})(a,n):a instanceof Ho?(function(h,g){return g instanceof Ho&&h.op===g.op&&h.filters.length===g.filters.length?h.filters.reduce(((w,x,c)=>w&&k1(x,g.filters[c])),!0):!1})(a,n):void un(19439)}function R1(a){return a instanceof fi?(function(o){return`${o.field.canonicalString()} ${o.op} ${Nu(o.value)}`})(a):a instanceof Ho?(function(o){return o.op.toString()+" {"+o.getFilters().map(R1).join(" ,")+"}"})(a):"Filter"}class bP extends fi{constructor(n,o,h){super(n,o,h),this.key=en.fromName(h.referenceValue)}matches(n){const o=en.comparator(n.key,this.key);return this.matchesComparison(o)}}class wP extends fi{constructor(n,o){super(n,"in",o),this.keys=D1("in",o)}matches(n){return this.keys.some((o=>o.isEqual(n.key)))}}class TP extends fi{constructor(n,o){super(n,"not-in",o),this.keys=D1("not-in",o)}matches(n){return!this.keys.some((o=>o.isEqual(n.key)))}}function D1(a,n){var o;return(((o=n.arrayValue)==null?void 0:o.values)||[]).map((h=>en.fromName(h.referenceValue)))}class EP extends fi{constructor(n,o){super(n,"array-contains",o)}matches(n){const o=n.data.field(this.field);return V_(o)&&md(o.arrayValue,this.value)}}class IP extends fi{constructor(n,o){super(n,"in",o)}matches(n){const o=n.data.field(this.field);return o!==null&&md(this.value.arrayValue,o)}}class SP extends fi{constructor(n,o){super(n,"not-in",o)}matches(n){if(md(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const o=n.data.field(this.field);return o!==null&&o.nullValue===void 0&&!md(this.value.arrayValue,o)}}class AP extends fi{constructor(n,o){super(n,"array-contains-any",o)}matches(n){const o=n.data.field(this.field);return!(!V_(o)||!o.arrayValue.values)&&o.arrayValue.values.some((h=>md(this.value.arrayValue,h)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(n,o=null,h=[],g=[],w=null,x=null,c=null){this.path=n,this.collectionGroup=o,this.orderBy=h,this.filters=g,this.limit=w,this.startAt=x,this.endAt=c,this.Te=null}}function Ex(a,n=null,o=[],h=[],g=null,w=null,x=null){return new PP(a,n,o,h,g,w,x)}function B_(a){const n=En(a);if(n.Te===null){let o=n.path.canonicalString();n.collectionGroup!==null&&(o+="|cg:"+n.collectionGroup),o+="|f:",o+=n.filters.map((h=>o_(h))).join(","),o+="|ob:",o+=n.orderBy.map((h=>(function(w){return w.field.canonicalString()+w.dir})(h))).join(","),Hf(n.limit)||(o+="|l:",o+=n.limit),n.startAt&&(o+="|lb:",o+=n.startAt.inclusive?"b:":"a:",o+=n.startAt.position.map((h=>Nu(h))).join(",")),n.endAt&&(o+="|ub:",o+=n.endAt.inclusive?"a:":"b:",o+=n.endAt.position.map((h=>Nu(h))).join(",")),n.Te=o}return n.Te}function U_(a,n){if(a.limit!==n.limit||a.orderBy.length!==n.orderBy.length)return!1;for(let o=0;o<a.orderBy.length;o++)if(!vP(a.orderBy[o],n.orderBy[o]))return!1;if(a.filters.length!==n.filters.length)return!1;for(let o=0;o<a.filters.length;o++)if(!k1(a.filters[o],n.filters[o]))return!1;return a.collectionGroup===n.collectionGroup&&!!a.path.isEqual(n.path)&&!!Tx(a.startAt,n.startAt)&&Tx(a.endAt,n.endAt)}function a_(a){return en.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(n,o=null,h=[],g=[],w=null,x="F",c=null,k=null){this.path=n,this.collectionGroup=o,this.explicitOrderBy=h,this.filters=g,this.limit=w,this.limitType=x,this.startAt=c,this.endAt=k,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function CP(a,n,o,h,g,w,x,c){return new Zf(a,n,o,h,g,w,x,c)}function j_(a){return new Zf(a)}function Ix(a){return a.filters.length===0&&a.limit===null&&a.startAt==null&&a.endAt==null&&(a.explicitOrderBy.length===0||a.explicitOrderBy.length===1&&a.explicitOrderBy[0].field.isKeyField())}function MP(a){return a.collectionGroup!==null}function od(a){const n=En(a);if(n.Ie===null){n.Ie=[];const o=new Set;for(const w of n.explicitOrderBy)n.Ie.push(w),o.add(w.field.canonicalString());const h=n.explicitOrderBy.length>0?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";(function(x){let c=new gi(Mi.comparator);return x.filters.forEach((k=>{k.getFlattenedFilters().forEach((O=>{O.isInequality()&&(c=c.add(O.field))}))})),c})(n).forEach((w=>{o.has(w.canonicalString())||w.isKeyField()||n.Ie.push(new Ef(w,h))})),o.has(Mi.keyField().canonicalString())||n.Ie.push(new Ef(Mi.keyField(),h))}return n.Ie}function Vo(a){const n=En(a);return n.Ee||(n.Ee=kP(n,od(a))),n.Ee}function kP(a,n){if(a.limitType==="F")return Ex(a.path,a.collectionGroup,n,a.filters,a.limit,a.startAt,a.endAt);{n=n.map((g=>{const w=g.dir==="desc"?"asc":"desc";return new Ef(g.field,w)}));const o=a.endAt?new Tf(a.endAt.position,a.endAt.inclusive):null,h=a.startAt?new Tf(a.startAt.position,a.startAt.inclusive):null;return Ex(a.path,a.collectionGroup,n,a.filters,a.limit,o,h)}}function l_(a,n,o){return new Zf(a.path,a.collectionGroup,a.explicitOrderBy.slice(),a.filters.slice(),n,o,a.startAt,a.endAt)}function Kf(a,n){return U_(Vo(a),Vo(n))&&a.limitType===n.limitType}function L1(a){return`${B_(Vo(a))}|lt:${a.limitType}`}function Iu(a){return`Query(target=${(function(o){let h=o.path.canonicalString();return o.collectionGroup!==null&&(h+=" collectionGroup="+o.collectionGroup),o.filters.length>0&&(h+=`, filters: [${o.filters.map((g=>R1(g))).join(", ")}]`),Hf(o.limit)||(h+=", limit: "+o.limit),o.orderBy.length>0&&(h+=`, orderBy: [${o.orderBy.map((g=>(function(x){return`${x.field.canonicalString()} (${x.dir})`})(g))).join(", ")}]`),o.startAt&&(h+=", startAt: ",h+=o.startAt.inclusive?"b:":"a:",h+=o.startAt.position.map((g=>Nu(g))).join(",")),o.endAt&&(h+=", endAt: ",h+=o.endAt.inclusive?"a:":"b:",h+=o.endAt.position.map((g=>Nu(g))).join(",")),`Target(${h})`})(Vo(a))}; limitType=${a.limitType})`}function Xf(a,n){return n.isFoundDocument()&&(function(h,g){const w=g.key.path;return h.collectionGroup!==null?g.key.hasCollectionId(h.collectionGroup)&&h.path.isPrefixOf(w):en.isDocumentKey(h.path)?h.path.isEqual(w):h.path.isImmediateParentOf(w)})(a,n)&&(function(h,g){for(const w of od(h))if(!w.field.isKeyField()&&g.data.field(w.field)===null)return!1;return!0})(a,n)&&(function(h,g){for(const w of h.filters)if(!w.matches(g))return!1;return!0})(a,n)&&(function(h,g){return!(h.startAt&&!(function(x,c,k){const O=wx(x,c,k);return x.inclusive?O<=0:O<0})(h.startAt,od(h),g)||h.endAt&&!(function(x,c,k){const O=wx(x,c,k);return x.inclusive?O>=0:O>0})(h.endAt,od(h),g))})(a,n)}function RP(a){return a.collectionGroup||(a.path.length%2==1?a.path.lastSegment():a.path.get(a.path.length-2))}function z1(a){return(n,o)=>{let h=!1;for(const g of od(a)){const w=DP(g,n,o);if(w!==0)return w;h=h||g.field.isKeyField()}return 0}}function DP(a,n,o){const h=a.field.isKeyField()?en.comparator(n.key,o.key):(function(w,x,c){const k=x.data.field(w),O=c.data.field(w);return k!==null&&O!==null?Fu(k,O):un(42886)})(a.field,n,o);switch(a.dir){case"asc":return h;case"desc":return-1*h;default:return un(19790,{direction:a.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(n,o){this.mapKeyFn=n,this.equalsFn=o,this.inner={},this.innerSize=0}get(n){const o=this.mapKeyFn(n),h=this.inner[o];if(h!==void 0){for(const[g,w]of h)if(this.equalsFn(g,n))return w}}has(n){return this.get(n)!==void 0}set(n,o){const h=this.mapKeyFn(n),g=this.inner[h];if(g===void 0)return this.inner[h]=[[n,o]],void this.innerSize++;for(let w=0;w<g.length;w++)if(this.equalsFn(g[w][0],n))return void(g[w]=[n,o]);g.push([n,o]),this.innerSize++}delete(n){const o=this.mapKeyFn(n),h=this.inner[o];if(h===void 0)return!1;for(let g=0;g<h.length;g++)if(this.equalsFn(h[g][0],n))return h.length===1?delete this.inner[o]:h.splice(g,1),this.innerSize--,!0;return!1}forEach(n){_l(this.inner,((o,h)=>{for(const[g,w]of h)n(g,w)}))}isEmpty(){return v1(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LP=new Br(en.comparator);function Sa(){return LP}const O1=new Br(en.comparator);function td(...a){let n=O1;for(const o of a)n=n.insert(o.key,o);return n}function F1(a){let n=O1;return a.forEach(((o,h)=>n=n.insert(o,h.overlayedDocument))),n}function cc(){return ad()}function N1(){return ad()}function ad(){return new wc((a=>a.toString()),((a,n)=>a.isEqual(n)))}const zP=new Br(en.comparator),OP=new gi(en.comparator);function Un(...a){let n=OP;for(const o of a)n=n.add(o);return n}const FP=new gi(Bn);function NP(){return FP}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $_(a,n){if(a.useProto3Json){if(isNaN(n))return{doubleValue:"NaN"};if(n===1/0)return{doubleValue:"Infinity"};if(n===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xf(n)?"-0":n}}function V1(a){return{integerValue:""+a}}function VP(a,n){return hP(n)?V1(n):$_(a,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(){this._=void 0}}function BP(a,n,o){return a instanceof If?(function(g,w){const x={fields:{[w1]:{stringValue:b1},[E1]:{timestampValue:{seconds:g.seconds,nanos:g.nanoseconds}}}};return w&&N_(w)&&(w=Wf(w)),w&&(x.fields[T1]=w),{mapValue:x}})(o,n):a instanceof gd?U1(a,n):a instanceof _d?j1(a,n):(function(g,w){const x=B1(g,w),c=Sx(x)+Sx(g.Ae);return s_(x)&&s_(g.Ae)?V1(c):$_(g.serializer,c)})(a,n)}function UP(a,n,o){return a instanceof gd?U1(a,n):a instanceof _d?j1(a,n):o}function B1(a,n){return a instanceof Sf?(function(h){return s_(h)||(function(w){return!!w&&"doubleValue"in w})(h)})(n)?n:{integerValue:0}:null}class If extends Yf{}class gd extends Yf{constructor(n){super(),this.elements=n}}function U1(a,n){const o=$1(n);for(const h of a.elements)o.some((g=>Go(g,h)))||o.push(h);return{arrayValue:{values:o}}}class _d extends Yf{constructor(n){super(),this.elements=n}}function j1(a,n){let o=$1(n);for(const h of a.elements)o=o.filter((g=>!Go(g,h)));return{arrayValue:{values:o}}}class Sf extends Yf{constructor(n,o){super(),this.serializer=n,this.Ae=o}}function Sx(a){return Zr(a.integerValue||a.doubleValue)}function $1(a){return V_(a)&&a.arrayValue.values?a.arrayValue.values.slice():[]}function jP(a,n){return a.field.isEqual(n.field)&&(function(h,g){return h instanceof gd&&g instanceof gd||h instanceof _d&&g instanceof _d?Ou(h.elements,g.elements,Go):h instanceof Sf&&g instanceof Sf?Go(h.Ae,g.Ae):h instanceof If&&g instanceof If})(a.transform,n.transform)}class $P{constructor(n,o){this.version=n,this.transformResults=o}}class Bo{constructor(n,o){this.updateTime=n,this.exists=o}static none(){return new Bo}static exists(n){return new Bo(void 0,n)}static updateTime(n){return new Bo(n)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(n){return this.exists===n.exists&&(this.updateTime?!!n.updateTime&&this.updateTime.isEqual(n.updateTime):!n.updateTime)}}function cf(a,n){return a.updateTime!==void 0?n.isFoundDocument()&&n.version.isEqual(a.updateTime):a.exists===void 0||a.exists===n.isFoundDocument()}class Qf{}function q1(a,n){if(!a.hasLocalMutations||n&&n.fields.length===0)return null;if(n===null)return a.isNoDocument()?new H1(a.key,Bo.none()):new Ed(a.key,a.data,Bo.none());{const o=a.data,h=Ts.empty();let g=new gi(Mi.comparator);for(let w of n.fields)if(!g.has(w)){let x=o.field(w);x===null&&w.length>1&&(w=w.popLast(),x=o.field(w)),x===null?h.delete(w):h.set(w,x),g=g.add(w)}return new yl(a.key,h,new Ns(g.toArray()),Bo.none())}}function qP(a,n,o){a instanceof Ed?(function(g,w,x){const c=g.value.clone(),k=Px(g.fieldTransforms,w,x.transformResults);c.setAll(k),w.convertToFoundDocument(x.version,c).setHasCommittedMutations()})(a,n,o):a instanceof yl?(function(g,w,x){if(!cf(g.precondition,w))return void w.convertToUnknownDocument(x.version);const c=Px(g.fieldTransforms,w,x.transformResults),k=w.data;k.setAll(G1(g)),k.setAll(c),w.convertToFoundDocument(x.version,k).setHasCommittedMutations()})(a,n,o):(function(g,w,x){w.convertToNoDocument(x.version).setHasCommittedMutations()})(0,n,o)}function ld(a,n,o,h){return a instanceof Ed?(function(w,x,c,k){if(!cf(w.precondition,x))return c;const O=w.value.clone(),U=Cx(w.fieldTransforms,k,x);return O.setAll(U),x.convertToFoundDocument(x.version,O).setHasLocalMutations(),null})(a,n,o,h):a instanceof yl?(function(w,x,c,k){if(!cf(w.precondition,x))return c;const O=Cx(w.fieldTransforms,k,x),U=x.data;return U.setAll(G1(w)),U.setAll(O),x.convertToFoundDocument(x.version,U).setHasLocalMutations(),c===null?null:c.unionWith(w.fieldMask.fields).unionWith(w.fieldTransforms.map((Y=>Y.field)))})(a,n,o,h):(function(w,x,c){return cf(w.precondition,x)?(x.convertToNoDocument(x.version).setHasLocalMutations(),null):c})(a,n,o)}function GP(a,n){let o=null;for(const h of a.fieldTransforms){const g=n.data.field(h.field),w=B1(h.transform,g||null);w!=null&&(o===null&&(o=Ts.empty()),o.set(h.field,w))}return o||null}function Ax(a,n){return a.type===n.type&&!!a.key.isEqual(n.key)&&!!a.precondition.isEqual(n.precondition)&&!!(function(h,g){return h===void 0&&g===void 0||!(!h||!g)&&Ou(h,g,((w,x)=>jP(w,x)))})(a.fieldTransforms,n.fieldTransforms)&&(a.type===0?a.value.isEqual(n.value):a.type!==1||a.data.isEqual(n.data)&&a.fieldMask.isEqual(n.fieldMask))}class Ed extends Qf{constructor(n,o,h,g=[]){super(),this.key=n,this.value=o,this.precondition=h,this.fieldTransforms=g,this.type=0}getFieldMask(){return null}}class yl extends Qf{constructor(n,o,h,g,w=[]){super(),this.key=n,this.data=o,this.fieldMask=h,this.precondition=g,this.fieldTransforms=w,this.type=1}getFieldMask(){return this.fieldMask}}function G1(a){const n=new Map;return a.fieldMask.fields.forEach((o=>{if(!o.isEmpty()){const h=a.data.field(o);n.set(o,h)}})),n}function Px(a,n,o){const h=new Map;ar(a.length===o.length,32656,{Re:o.length,Ve:a.length});for(let g=0;g<o.length;g++){const w=a[g],x=w.transform,c=n.data.field(w.field);h.set(w.field,UP(x,c,o[g]))}return h}function Cx(a,n,o){const h=new Map;for(const g of a){const w=g.transform,x=o.data.field(g.field);h.set(g.field,BP(w,x,n))}return h}class H1 extends Qf{constructor(n,o){super(),this.key=n,this.precondition=o,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class HP extends Qf{constructor(n,o){super(),this.key=n,this.precondition=o,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(n,o,h,g){this.batchId=n,this.localWriteTime=o,this.baseMutations=h,this.mutations=g}applyToRemoteDocument(n,o){const h=o.mutationResults;for(let g=0;g<this.mutations.length;g++){const w=this.mutations[g];w.key.isEqual(n.key)&&qP(w,n,h[g])}}applyToLocalView(n,o){for(const h of this.baseMutations)h.key.isEqual(n.key)&&(o=ld(h,n,o,this.localWriteTime));for(const h of this.mutations)h.key.isEqual(n.key)&&(o=ld(h,n,o,this.localWriteTime));return o}applyToLocalDocumentSet(n,o){const h=N1();return this.mutations.forEach((g=>{const w=n.get(g.key),x=w.overlayedDocument;let c=this.applyToLocalView(x,w.mutatedFields);c=o.has(g.key)?null:c;const k=q1(x,c);k!==null&&h.set(g.key,k),x.isValidDocument()||x.convertToNoDocument(yn.min())})),h}keys(){return this.mutations.reduce(((n,o)=>n.add(o.key)),Un())}isEqual(n){return this.batchId===n.batchId&&Ou(this.mutations,n.mutations,((o,h)=>Ax(o,h)))&&Ou(this.baseMutations,n.baseMutations,((o,h)=>Ax(o,h)))}}class q_{constructor(n,o,h,g){this.batch=n,this.commitVersion=o,this.mutationResults=h,this.docVersions=g}static from(n,o,h){ar(n.mutations.length===h.length,58842,{me:n.mutations.length,fe:h.length});let g=(function(){return zP})();const w=n.mutations;for(let x=0;x<w.length;x++)g=g.insert(w[x].key,h[x].version);return new q_(n,o,h,g)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP{constructor(n,o){this.largestBatchId=n,this.mutation=o}getKey(){return this.mutation.key}isEqual(n){return n!==null&&this.mutation===n.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(n,o){this.count=n,this.unchangedNames=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ai,Kn;function XP(a){switch(a){case ut.OK:return un(64938);case ut.CANCELLED:case ut.UNKNOWN:case ut.DEADLINE_EXCEEDED:case ut.RESOURCE_EXHAUSTED:case ut.INTERNAL:case ut.UNAVAILABLE:case ut.UNAUTHENTICATED:return!1;case ut.INVALID_ARGUMENT:case ut.NOT_FOUND:case ut.ALREADY_EXISTS:case ut.PERMISSION_DENIED:case ut.FAILED_PRECONDITION:case ut.ABORTED:case ut.OUT_OF_RANGE:case ut.UNIMPLEMENTED:case ut.DATA_LOSS:return!0;default:return un(15467,{code:a})}}function W1(a){if(a===void 0)return Ia("GRPC error has no .code"),ut.UNKNOWN;switch(a){case ai.OK:return ut.OK;case ai.CANCELLED:return ut.CANCELLED;case ai.UNKNOWN:return ut.UNKNOWN;case ai.DEADLINE_EXCEEDED:return ut.DEADLINE_EXCEEDED;case ai.RESOURCE_EXHAUSTED:return ut.RESOURCE_EXHAUSTED;case ai.INTERNAL:return ut.INTERNAL;case ai.UNAVAILABLE:return ut.UNAVAILABLE;case ai.UNAUTHENTICATED:return ut.UNAUTHENTICATED;case ai.INVALID_ARGUMENT:return ut.INVALID_ARGUMENT;case ai.NOT_FOUND:return ut.NOT_FOUND;case ai.ALREADY_EXISTS:return ut.ALREADY_EXISTS;case ai.PERMISSION_DENIED:return ut.PERMISSION_DENIED;case ai.FAILED_PRECONDITION:return ut.FAILED_PRECONDITION;case ai.ABORTED:return ut.ABORTED;case ai.OUT_OF_RANGE:return ut.OUT_OF_RANGE;case ai.UNIMPLEMENTED:return ut.UNIMPLEMENTED;case ai.DATA_LOSS:return ut.DATA_LOSS;default:return un(39323,{code:a})}}(Kn=ai||(ai={}))[Kn.OK=0]="OK",Kn[Kn.CANCELLED=1]="CANCELLED",Kn[Kn.UNKNOWN=2]="UNKNOWN",Kn[Kn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Kn[Kn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Kn[Kn.NOT_FOUND=5]="NOT_FOUND",Kn[Kn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Kn[Kn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Kn[Kn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Kn[Kn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Kn[Kn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Kn[Kn.ABORTED=10]="ABORTED",Kn[Kn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Kn[Kn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Kn[Kn.INTERNAL=13]="INTERNAL",Kn[Kn.UNAVAILABLE=14]="UNAVAILABLE",Kn[Kn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YP(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QP=new ll([4294967295,4294967295],0);function Mx(a){const n=YP().encode(a),o=new c1;return o.update(n),new Uint8Array(o.digest())}function kx(a){const n=new DataView(a.buffer),o=n.getUint32(0,!0),h=n.getUint32(4,!0),g=n.getUint32(8,!0),w=n.getUint32(12,!0);return[new ll([o,h],0),new ll([g,w],0)]}class G_{constructor(n,o,h){if(this.bitmap=n,this.padding=o,this.hashCount=h,o<0||o>=8)throw new nd(`Invalid padding: ${o}`);if(h<0)throw new nd(`Invalid hash count: ${h}`);if(n.length>0&&this.hashCount===0)throw new nd(`Invalid hash count: ${h}`);if(n.length===0&&o!==0)throw new nd(`Invalid padding when bitmap length is 0: ${o}`);this.ge=8*n.length-o,this.pe=ll.fromNumber(this.ge)}ye(n,o,h){let g=n.add(o.multiply(ll.fromNumber(h)));return g.compare(QP)===1&&(g=new ll([g.getBits(0),g.getBits(1)],0)),g.modulo(this.pe).toNumber()}we(n){return!!(this.bitmap[Math.floor(n/8)]&1<<n%8)}mightContain(n){if(this.ge===0)return!1;const o=Mx(n),[h,g]=kx(o);for(let w=0;w<this.hashCount;w++){const x=this.ye(h,g,w);if(!this.we(x))return!1}return!0}static create(n,o,h){const g=n%8==0?0:8-n%8,w=new Uint8Array(Math.ceil(n/8)),x=new G_(w,g,o);return h.forEach((c=>x.insert(c))),x}insert(n){if(this.ge===0)return;const o=Mx(n),[h,g]=kx(o);for(let w=0;w<this.hashCount;w++){const x=this.ye(h,g,w);this.Se(x)}}Se(n){const o=Math.floor(n/8),h=n%8;this.bitmap[o]|=1<<h}}class nd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(n,o,h,g,w){this.snapshotVersion=n,this.targetChanges=o,this.targetMismatches=h,this.documentUpdates=g,this.resolvedLimboDocuments=w}static createSynthesizedRemoteEventForCurrentChange(n,o,h){const g=new Map;return g.set(n,Id.createSynthesizedTargetChangeForCurrentChange(n,o,h)),new Jf(yn.min(),g,new Br(Bn),Sa(),Un())}}class Id{constructor(n,o,h,g,w){this.resumeToken=n,this.current=o,this.addedDocuments=h,this.modifiedDocuments=g,this.removedDocuments=w}static createSynthesizedTargetChangeForCurrentChange(n,o,h){return new Id(h,o,Un(),Un(),Un())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(n,o,h,g){this.be=n,this.removedTargetIds=o,this.key=h,this.De=g}}class Z1{constructor(n,o){this.targetId=n,this.Ce=o}}class K1{constructor(n,o,h=Ri.EMPTY_BYTE_STRING,g=null){this.state=n,this.targetIds=o,this.resumeToken=h,this.cause=g}}class Rx{constructor(){this.ve=0,this.Fe=Dx(),this.Me=Ri.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(n){n.approximateByteSize()>0&&(this.Oe=!0,this.Me=n)}ke(){let n=Un(),o=Un(),h=Un();return this.Fe.forEach(((g,w)=>{switch(w){case 0:n=n.add(g);break;case 2:o=o.add(g);break;case 1:h=h.add(g);break;default:un(38017,{changeType:w})}})),new Id(this.Me,this.xe,n,o,h)}qe(){this.Oe=!1,this.Fe=Dx()}Qe(n,o){this.Oe=!0,this.Fe=this.Fe.insert(n,o)}$e(n){this.Oe=!0,this.Fe=this.Fe.remove(n)}Ue(){this.ve+=1}Ke(){this.ve-=1,ar(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class JP{constructor(n){this.Ge=n,this.ze=new Map,this.je=Sa(),this.Je=Yp(),this.He=Yp(),this.Ye=new Br(Bn)}Ze(n){for(const o of n.be)n.De&&n.De.isFoundDocument()?this.Xe(o,n.De):this.et(o,n.key,n.De);for(const o of n.removedTargetIds)this.et(o,n.key,n.De)}tt(n){this.forEachTarget(n,(o=>{const h=this.nt(o);switch(n.state){case 0:this.rt(o)&&h.Le(n.resumeToken);break;case 1:h.Ke(),h.Ne||h.qe(),h.Le(n.resumeToken);break;case 2:h.Ke(),h.Ne||this.removeTarget(o);break;case 3:this.rt(o)&&(h.We(),h.Le(n.resumeToken));break;case 4:this.rt(o)&&(this.it(o),h.Le(n.resumeToken));break;default:un(56790,{state:n.state})}}))}forEachTarget(n,o){n.targetIds.length>0?n.targetIds.forEach(o):this.ze.forEach(((h,g)=>{this.rt(g)&&o(g)}))}st(n){const o=n.targetId,h=n.Ce.count,g=this.ot(o);if(g){const w=g.target;if(a_(w))if(h===0){const x=new en(w.path);this.et(o,x,Gi.newNoDocument(x,yn.min()))}else ar(h===1,20013,{expectedCount:h});else{const x=this._t(o);if(x!==h){const c=this.ut(n),k=c?this.ct(c,n,x):1;if(k!==0){this.it(o);const O=k===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(o,O)}}}}}ut(n){const o=n.Ce.unchangedNames;if(!o||!o.bits)return null;const{bits:{bitmap:h="",padding:g=0},hashCount:w=0}=o;let x,c;try{x=pl(h).toUint8Array()}catch(k){if(k instanceof x1)return zu("Decoding the base64 bloom filter in existence filter failed ("+k.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw k}try{c=new G_(x,g,w)}catch(k){return zu(k instanceof nd?"BloomFilter error: ":"Applying bloom filter failed: ",k),null}return c.ge===0?null:c}ct(n,o,h){return o.Ce.count===h-this.Pt(n,o.targetId)?0:2}Pt(n,o){const h=this.Ge.getRemoteKeysForTarget(o);let g=0;return h.forEach((w=>{const x=this.Ge.ht(),c=`projects/${x.projectId}/databases/${x.database}/documents/${w.path.canonicalString()}`;n.mightContain(c)||(this.et(o,w,null),g++)})),g}Tt(n){const o=new Map;this.ze.forEach(((w,x)=>{const c=this.ot(x);if(c){if(w.current&&a_(c.target)){const k=new en(c.target.path);this.It(k).has(x)||this.Et(x,k)||this.et(x,k,Gi.newNoDocument(k,n))}w.Be&&(o.set(x,w.ke()),w.qe())}}));let h=Un();this.He.forEach(((w,x)=>{let c=!0;x.forEachWhile((k=>{const O=this.ot(k);return!O||O.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(h=h.add(w))})),this.je.forEach(((w,x)=>x.setReadTime(n)));const g=new Jf(n,o,this.Ye,this.je,h);return this.je=Sa(),this.Je=Yp(),this.He=Yp(),this.Ye=new Br(Bn),g}Xe(n,o){if(!this.rt(n))return;const h=this.Et(n,o.key)?2:0;this.nt(n).Qe(o.key,h),this.je=this.je.insert(o.key,o),this.Je=this.Je.insert(o.key,this.It(o.key).add(n)),this.He=this.He.insert(o.key,this.dt(o.key).add(n))}et(n,o,h){if(!this.rt(n))return;const g=this.nt(n);this.Et(n,o)?g.Qe(o,1):g.$e(o),this.He=this.He.insert(o,this.dt(o).delete(n)),this.He=this.He.insert(o,this.dt(o).add(n)),h&&(this.je=this.je.insert(o,h))}removeTarget(n){this.ze.delete(n)}_t(n){const o=this.nt(n).ke();return this.Ge.getRemoteKeysForTarget(n).size+o.addedDocuments.size-o.removedDocuments.size}Ue(n){this.nt(n).Ue()}nt(n){let o=this.ze.get(n);return o||(o=new Rx,this.ze.set(n,o)),o}dt(n){let o=this.He.get(n);return o||(o=new gi(Bn),this.He=this.He.insert(n,o)),o}It(n){let o=this.Je.get(n);return o||(o=new gi(Bn),this.Je=this.Je.insert(n,o)),o}rt(n){const o=this.ot(n)!==null;return o||zt("WatchChangeAggregator","Detected inactive target",n),o}ot(n){const o=this.ze.get(n);return o&&o.Ne?null:this.Ge.At(n)}it(n){this.ze.set(n,new Rx),this.Ge.getRemoteKeysForTarget(n).forEach((o=>{this.et(n,o,null)}))}Et(n,o){return this.Ge.getRemoteKeysForTarget(n).has(o)}}function Yp(){return new Br(en.comparator)}function Dx(){return new Br(en.comparator)}const eC={asc:"ASCENDING",desc:"DESCENDING"},tC={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},nC={and:"AND",or:"OR"};class rC{constructor(n,o){this.databaseId=n,this.useProto3Json=o}}function c_(a,n){return a.useProto3Json||Hf(n)?n:{value:n}}function Af(a,n){return a.useProto3Json?`${new Date(1e3*n.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+n.nanoseconds).slice(-9)}Z`:{seconds:""+n.seconds,nanos:n.nanoseconds}}function X1(a,n){return a.useProto3Json?n.toBase64():n.toUint8Array()}function iC(a,n){return Af(a,n.toTimestamp())}function Uo(a){return ar(!!a,49232),yn.fromTimestamp((function(o){const h=dl(o);return new Pr(h.seconds,h.nanos)})(a))}function H_(a,n){return u_(a,n).canonicalString()}function u_(a,n){const o=(function(g){return new Vr(["projects",g.projectId,"databases",g.database])})(a).child("documents");return n===void 0?o:o.child(n)}function Y1(a){const n=Vr.fromString(a);return ar(nw(n),10190,{key:n.toString()}),n}function h_(a,n){return H_(a.databaseId,n.path)}function Vg(a,n){const o=Y1(n);if(o.get(1)!==a.databaseId.projectId)throw new Gt(ut.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+o.get(1)+" vs "+a.databaseId.projectId);if(o.get(3)!==a.databaseId.database)throw new Gt(ut.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+o.get(3)+" vs "+a.databaseId.database);return new en(J1(o))}function Q1(a,n){return H_(a.databaseId,n)}function sC(a){const n=Y1(a);return n.length===4?Vr.emptyPath():J1(n)}function d_(a){return new Vr(["projects",a.databaseId.projectId,"databases",a.databaseId.database]).canonicalString()}function J1(a){return ar(a.length>4&&a.get(4)==="documents",29091,{key:a.toString()}),a.popFirst(5)}function Lx(a,n,o){return{name:h_(a,n),fields:o.value.mapValue.fields}}function oC(a,n){let o;if("targetChange"in n){n.targetChange;const h=(function(O){return O==="NO_CHANGE"?0:O==="ADD"?1:O==="REMOVE"?2:O==="CURRENT"?3:O==="RESET"?4:un(39313,{state:O})})(n.targetChange.targetChangeType||"NO_CHANGE"),g=n.targetChange.targetIds||[],w=(function(O,U){return O.useProto3Json?(ar(U===void 0||typeof U=="string",58123),Ri.fromBase64String(U||"")):(ar(U===void 0||U instanceof Buffer||U instanceof Uint8Array,16193),Ri.fromUint8Array(U||new Uint8Array))})(a,n.targetChange.resumeToken),x=n.targetChange.cause,c=x&&(function(O){const U=O.code===void 0?ut.UNKNOWN:W1(O.code);return new Gt(U,O.message||"")})(x);o=new K1(h,g,w,c||null)}else if("documentChange"in n){n.documentChange;const h=n.documentChange;h.document,h.document.name,h.document.updateTime;const g=Vg(a,h.document.name),w=Uo(h.document.updateTime),x=h.document.createTime?Uo(h.document.createTime):yn.min(),c=new Ts({mapValue:{fields:h.document.fields}}),k=Gi.newFoundDocument(g,w,x,c),O=h.targetIds||[],U=h.removedTargetIds||[];o=new uf(O,U,k.key,k)}else if("documentDelete"in n){n.documentDelete;const h=n.documentDelete;h.document;const g=Vg(a,h.document),w=h.readTime?Uo(h.readTime):yn.min(),x=Gi.newNoDocument(g,w),c=h.removedTargetIds||[];o=new uf([],c,x.key,x)}else if("documentRemove"in n){n.documentRemove;const h=n.documentRemove;h.document;const g=Vg(a,h.document),w=h.removedTargetIds||[];o=new uf([],w,g,null)}else{if(!("filter"in n))return un(11601,{Rt:n});{n.filter;const h=n.filter;h.targetId;const{count:g=0,unchangedNames:w}=h,x=new KP(g,w),c=h.targetId;o=new Z1(c,x)}}return o}function aC(a,n){let o;if(n instanceof Ed)o={update:Lx(a,n.key,n.value)};else if(n instanceof H1)o={delete:h_(a,n.key)};else if(n instanceof yl)o={update:Lx(a,n.key,n.data),updateMask:gC(n.fieldMask)};else{if(!(n instanceof HP))return un(16599,{Vt:n.type});o={verify:h_(a,n.key)}}return n.fieldTransforms.length>0&&(o.updateTransforms=n.fieldTransforms.map((h=>(function(w,x){const c=x.transform;if(c instanceof If)return{fieldPath:x.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof gd)return{fieldPath:x.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof _d)return{fieldPath:x.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Sf)return{fieldPath:x.field.canonicalString(),increment:c.Ae};throw un(20930,{transform:x.transform})})(0,h)))),n.precondition.isNone||(o.currentDocument=(function(g,w){return w.updateTime!==void 0?{updateTime:iC(g,w.updateTime)}:w.exists!==void 0?{exists:w.exists}:un(27497)})(a,n.precondition)),o}function lC(a,n){return a&&a.length>0?(ar(n!==void 0,14353),a.map((o=>(function(g,w){let x=g.updateTime?Uo(g.updateTime):Uo(w);return x.isEqual(yn.min())&&(x=Uo(w)),new $P(x,g.transformResults||[])})(o,n)))):[]}function cC(a,n){return{documents:[Q1(a,n.path)]}}function uC(a,n){const o={structuredQuery:{}},h=n.path;let g;n.collectionGroup!==null?(g=h,o.structuredQuery.from=[{collectionId:n.collectionGroup,allDescendants:!0}]):(g=h.popLast(),o.structuredQuery.from=[{collectionId:h.lastSegment()}]),o.parent=Q1(a,g);const w=(function(O){if(O.length!==0)return tw(Ho.create(O,"and"))})(n.filters);w&&(o.structuredQuery.where=w);const x=(function(O){if(O.length!==0)return O.map((U=>(function(se){return{field:Su(se.field),direction:pC(se.dir)}})(U)))})(n.orderBy);x&&(o.structuredQuery.orderBy=x);const c=c_(a,n.limit);return c!==null&&(o.structuredQuery.limit=c),n.startAt&&(o.structuredQuery.startAt=(function(O){return{before:O.inclusive,values:O.position}})(n.startAt)),n.endAt&&(o.structuredQuery.endAt=(function(O){return{before:!O.inclusive,values:O.position}})(n.endAt)),{ft:o,parent:g}}function hC(a){let n=sC(a.parent);const o=a.structuredQuery,h=o.from?o.from.length:0;let g=null;if(h>0){ar(h===1,65062);const U=o.from[0];U.allDescendants?g=U.collectionId:n=n.child(U.collectionId)}let w=[];o.where&&(w=(function(Y){const se=ew(Y);return se instanceof Ho&&M1(se)?se.getFilters():[se]})(o.where));let x=[];o.orderBy&&(x=(function(Y){return Y.map((se=>(function($e){return new Ef(Au($e.field),(function(J){switch(J){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})($e.direction))})(se)))})(o.orderBy));let c=null;o.limit&&(c=(function(Y){let se;return se=typeof Y=="object"?Y.value:Y,Hf(se)?null:se})(o.limit));let k=null;o.startAt&&(k=(function(Y){const se=!!Y.before,xe=Y.values||[];return new Tf(xe,se)})(o.startAt));let O=null;return o.endAt&&(O=(function(Y){const se=!Y.before,xe=Y.values||[];return new Tf(xe,se)})(o.endAt)),CP(n,g,x,w,c,"F",k,O)}function dC(a,n){const o=(function(g){switch(g){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return un(28987,{purpose:g})}})(n.purpose);return o==null?null:{"goog-listen-tags":o}}function ew(a){return a.unaryFilter!==void 0?(function(o){switch(o.unaryFilter.op){case"IS_NAN":const h=Au(o.unaryFilter.field);return fi.create(h,"==",{doubleValue:NaN});case"IS_NULL":const g=Au(o.unaryFilter.field);return fi.create(g,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const w=Au(o.unaryFilter.field);return fi.create(w,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const x=Au(o.unaryFilter.field);return fi.create(x,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return un(61313);default:return un(60726)}})(a):a.fieldFilter!==void 0?(function(o){return fi.create(Au(o.fieldFilter.field),(function(g){switch(g){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return un(58110);default:return un(50506)}})(o.fieldFilter.op),o.fieldFilter.value)})(a):a.compositeFilter!==void 0?(function(o){return Ho.create(o.compositeFilter.filters.map((h=>ew(h))),(function(g){switch(g){case"AND":return"and";case"OR":return"or";default:return un(1026)}})(o.compositeFilter.op))})(a):un(30097,{filter:a})}function pC(a){return eC[a]}function fC(a){return tC[a]}function mC(a){return nC[a]}function Su(a){return{fieldPath:a.canonicalString()}}function Au(a){return Mi.fromServerFormat(a.fieldPath)}function tw(a){return a instanceof fi?(function(o){if(o.op==="=="){if(bx(o.value))return{unaryFilter:{field:Su(o.field),op:"IS_NAN"}};if(xx(o.value))return{unaryFilter:{field:Su(o.field),op:"IS_NULL"}}}else if(o.op==="!="){if(bx(o.value))return{unaryFilter:{field:Su(o.field),op:"IS_NOT_NAN"}};if(xx(o.value))return{unaryFilter:{field:Su(o.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Su(o.field),op:fC(o.op),value:o.value}}})(a):a instanceof Ho?(function(o){const h=o.getFilters().map((g=>tw(g)));return h.length===1?h[0]:{compositeFilter:{op:mC(o.op),filters:h}}})(a):un(54877,{filter:a})}function gC(a){const n=[];return a.fields.forEach((o=>n.push(o.canonicalString()))),{fieldPaths:n}}function nw(a){return a.length>=4&&a.get(0)==="projects"&&a.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(n,o,h,g,w=yn.min(),x=yn.min(),c=Ri.EMPTY_BYTE_STRING,k=null){this.target=n,this.targetId=o,this.purpose=h,this.sequenceNumber=g,this.snapshotVersion=w,this.lastLimboFreeSnapshotVersion=x,this.resumeToken=c,this.expectedCount=k}withSequenceNumber(n){return new sl(this.target,this.targetId,this.purpose,n,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(n,o){return new sl(this.target,this.targetId,this.purpose,this.sequenceNumber,o,this.lastLimboFreeSnapshotVersion,n,null)}withExpectedCount(n){return new sl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,n)}withLastLimboFreeSnapshotVersion(n){return new sl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,n,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _C{constructor(n){this.yt=n}}function yC(a){const n=hC({parent:a.parent,structuredQuery:a.structuredQuery});return a.limitType==="LAST"?l_(n,n.limit,"L"):n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(){this.Cn=new xC}addToCollectionParentIndex(n,o){return this.Cn.add(o),st.resolve()}getCollectionParents(n,o){return st.resolve(this.Cn.getEntries(o))}addFieldIndex(n,o){return st.resolve()}deleteFieldIndex(n,o){return st.resolve()}deleteAllFieldIndexes(n){return st.resolve()}createTargetIndexes(n,o){return st.resolve()}getDocumentsMatchingTarget(n,o){return st.resolve(null)}getIndexType(n,o){return st.resolve(0)}getFieldIndexes(n,o){return st.resolve([])}getNextCollectionGroupToUpdate(n){return st.resolve(null)}getMinOffset(n,o){return st.resolve(hl.min())}getMinOffsetFromCollectionGroup(n,o){return st.resolve(hl.min())}updateCollectionGroup(n,o,h){return st.resolve()}updateIndexEntries(n,o){return st.resolve()}}class xC{constructor(){this.index={}}add(n){const o=n.lastSegment(),h=n.popLast(),g=this.index[o]||new gi(Vr.comparator),w=!g.has(h);return this.index[o]=g.add(h),w}has(n){const o=n.lastSegment(),h=n.popLast(),g=this.index[o];return g&&g.has(h)}getEntries(n){return(this.index[n]||new gi(Vr.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},rw=41943040;class bs{static withCacheSize(n){return new bs(n,bs.DEFAULT_COLLECTION_PERCENTILE,bs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(n,o,h){this.cacheSizeCollectionThreshold=n,this.percentileToCollect=o,this.maximumSequenceNumbersToCollect=h}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */bs.DEFAULT_COLLECTION_PERCENTILE=10,bs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bs.DEFAULT=new bs(rw,bs.DEFAULT_COLLECTION_PERCENTILE,bs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bs.DISABLED=new bs(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu{constructor(n){this.ar=n}next(){return this.ar+=2,this.ar}static ur(){return new Vu(0)}static cr(){return new Vu(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ox="LruGarbageCollector",bC=1048576;function Fx([a,n],[o,h]){const g=Bn(a,o);return g===0?Bn(n,h):g}class wC{constructor(n){this.Ir=n,this.buffer=new gi(Fx),this.Er=0}dr(){return++this.Er}Ar(n){const o=[n,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(o);else{const h=this.buffer.last();Fx(o,h)<0&&(this.buffer=this.buffer.delete(h).add(o))}}get maxValue(){return this.buffer.last()[0]}}class TC{constructor(n,o,h){this.garbageCollector=n,this.asyncQueue=o,this.localStore=h,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(n){zt(Ox,`Garbage collection scheduled in ${n}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(o){qu(o)?zt(Ox,"Ignoring IndexedDB error during garbage collection: ",o):await $u(o)}await this.Vr(3e5)}))}}class EC{constructor(n,o){this.mr=n,this.params=o}calculateTargetCount(n,o){return this.mr.gr(n).next((h=>Math.floor(o/100*h)))}nthSequenceNumber(n,o){if(o===0)return st.resolve(Gf.ce);const h=new wC(o);return this.mr.forEachTarget(n,(g=>h.Ar(g.sequenceNumber))).next((()=>this.mr.pr(n,(g=>h.Ar(g))))).next((()=>h.maxValue))}removeTargets(n,o,h){return this.mr.removeTargets(n,o,h)}removeOrphanedDocuments(n,o){return this.mr.removeOrphanedDocuments(n,o)}collect(n,o){return this.params.cacheSizeCollectionThreshold===-1?(zt("LruGarbageCollector","Garbage collection skipped; disabled"),st.resolve(zx)):this.getCacheSize(n).next((h=>h<this.params.cacheSizeCollectionThreshold?(zt("LruGarbageCollector",`Garbage collection skipped; Cache size ${h} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zx):this.yr(n,o)))}getCacheSize(n){return this.mr.getCacheSize(n)}yr(n,o){let h,g,w,x,c,k,O;const U=Date.now();return this.calculateTargetCount(n,this.params.percentileToCollect).next((Y=>(Y>this.params.maximumSequenceNumbersToCollect?(zt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${Y}`),g=this.params.maximumSequenceNumbersToCollect):g=Y,x=Date.now(),this.nthSequenceNumber(n,g)))).next((Y=>(h=Y,c=Date.now(),this.removeTargets(n,h,o)))).next((Y=>(w=Y,k=Date.now(),this.removeOrphanedDocuments(n,h)))).next((Y=>(O=Date.now(),Eu()<=Vn.DEBUG&&zt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${x-U}ms
	Determined least recently used ${g} in `+(c-x)+`ms
	Removed ${w} targets in `+(k-c)+`ms
	Removed ${Y} documents in `+(O-k)+`ms
Total Duration: ${O-U}ms`),st.resolve({didRun:!0,sequenceNumbersCollected:g,targetsRemoved:w,documentsRemoved:Y}))))}}function IC(a,n){return new EC(a,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SC{constructor(){this.changes=new wc((n=>n.toString()),((n,o)=>n.isEqual(o))),this.changesApplied=!1}addEntry(n){this.assertNotApplied(),this.changes.set(n.key,n)}removeEntry(n,o){this.assertNotApplied(),this.changes.set(n,Gi.newInvalidDocument(n).setReadTime(o))}getEntry(n,o){this.assertNotApplied();const h=this.changes.get(o);return h!==void 0?st.resolve(h):this.getFromCache(n,o)}getEntries(n,o){return this.getAllFromCache(n,o)}apply(n){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(n)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(n,o){this.overlayedDocument=n,this.mutatedFields=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(n,o,h,g){this.remoteDocumentCache=n,this.mutationQueue=o,this.documentOverlayCache=h,this.indexManager=g}getDocument(n,o){let h=null;return this.documentOverlayCache.getOverlay(n,o).next((g=>(h=g,this.remoteDocumentCache.getEntry(n,o)))).next((g=>(h!==null&&ld(h.mutation,g,Ns.empty(),Pr.now()),g)))}getDocuments(n,o){return this.remoteDocumentCache.getEntries(n,o).next((h=>this.getLocalViewOfDocuments(n,h,Un()).next((()=>h))))}getLocalViewOfDocuments(n,o,h=Un()){const g=cc();return this.populateOverlays(n,g,o).next((()=>this.computeViews(n,o,g,h).next((w=>{let x=td();return w.forEach(((c,k)=>{x=x.insert(c,k.overlayedDocument)})),x}))))}getOverlayedDocuments(n,o){const h=cc();return this.populateOverlays(n,h,o).next((()=>this.computeViews(n,o,h,Un())))}populateOverlays(n,o,h){const g=[];return h.forEach((w=>{o.has(w)||g.push(w)})),this.documentOverlayCache.getOverlays(n,g).next((w=>{w.forEach(((x,c)=>{o.set(x,c)}))}))}computeViews(n,o,h,g){let w=Sa();const x=ad(),c=(function(){return ad()})();return o.forEach(((k,O)=>{const U=h.get(O.key);g.has(O.key)&&(U===void 0||U.mutation instanceof yl)?w=w.insert(O.key,O):U!==void 0?(x.set(O.key,U.mutation.getFieldMask()),ld(U.mutation,O,U.mutation.getFieldMask(),Pr.now())):x.set(O.key,Ns.empty())})),this.recalculateAndSaveOverlays(n,w).next((k=>(k.forEach(((O,U)=>x.set(O,U))),o.forEach(((O,U)=>c.set(O,new AC(U,x.get(O)??null)))),c)))}recalculateAndSaveOverlays(n,o){const h=ad();let g=new Br(((x,c)=>x-c)),w=Un();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(n,o).next((x=>{for(const c of x)c.keys().forEach((k=>{const O=o.get(k);if(O===null)return;let U=h.get(k)||Ns.empty();U=c.applyToLocalView(O,U),h.set(k,U);const Y=(g.get(c.batchId)||Un()).add(k);g=g.insert(c.batchId,Y)}))})).next((()=>{const x=[],c=g.getReverseIterator();for(;c.hasNext();){const k=c.getNext(),O=k.key,U=k.value,Y=N1();U.forEach((se=>{if(!w.has(se)){const xe=q1(o.get(se),h.get(se));xe!==null&&Y.set(se,xe),w=w.add(se)}})),x.push(this.documentOverlayCache.saveOverlays(n,O,Y))}return st.waitFor(x)})).next((()=>h))}recalculateAndSaveOverlaysForDocumentKeys(n,o){return this.remoteDocumentCache.getEntries(n,o).next((h=>this.recalculateAndSaveOverlays(n,h)))}getDocumentsMatchingQuery(n,o,h,g){return(function(x){return en.isDocumentKey(x.path)&&x.collectionGroup===null&&x.filters.length===0})(o)?this.getDocumentsMatchingDocumentQuery(n,o.path):MP(o)?this.getDocumentsMatchingCollectionGroupQuery(n,o,h,g):this.getDocumentsMatchingCollectionQuery(n,o,h,g)}getNextDocuments(n,o,h,g){return this.remoteDocumentCache.getAllFromCollectionGroup(n,o,h,g).next((w=>{const x=g-w.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(n,o,h.largestBatchId,g-w.size):st.resolve(cc());let c=dd,k=w;return x.next((O=>st.forEach(O,((U,Y)=>(c<Y.largestBatchId&&(c=Y.largestBatchId),w.get(U)?st.resolve():this.remoteDocumentCache.getEntry(n,U).next((se=>{k=k.insert(U,se)}))))).next((()=>this.populateOverlays(n,O,w))).next((()=>this.computeViews(n,k,O,Un()))).next((U=>({batchId:c,changes:F1(U)})))))}))}getDocumentsMatchingDocumentQuery(n,o){return this.getDocument(n,new en(o)).next((h=>{let g=td();return h.isFoundDocument()&&(g=g.insert(h.key,h)),g}))}getDocumentsMatchingCollectionGroupQuery(n,o,h,g){const w=o.collectionGroup;let x=td();return this.indexManager.getCollectionParents(n,w).next((c=>st.forEach(c,(k=>{const O=(function(Y,se){return new Zf(se,null,Y.explicitOrderBy.slice(),Y.filters.slice(),Y.limit,Y.limitType,Y.startAt,Y.endAt)})(o,k.child(w));return this.getDocumentsMatchingCollectionQuery(n,O,h,g).next((U=>{U.forEach(((Y,se)=>{x=x.insert(Y,se)}))}))})).next((()=>x))))}getDocumentsMatchingCollectionQuery(n,o,h,g){let w;return this.documentOverlayCache.getOverlaysForCollection(n,o.path,h.largestBatchId).next((x=>(w=x,this.remoteDocumentCache.getDocumentsMatchingQuery(n,o,h,w,g)))).next((x=>{w.forEach(((k,O)=>{const U=O.getKey();x.get(U)===null&&(x=x.insert(U,Gi.newInvalidDocument(U)))}));let c=td();return x.forEach(((k,O)=>{const U=w.get(k);U!==void 0&&ld(U.mutation,O,Ns.empty(),Pr.now()),Xf(o,O)&&(c=c.insert(k,O))})),c}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CC{constructor(n){this.serializer=n,this.Lr=new Map,this.kr=new Map}getBundleMetadata(n,o){return st.resolve(this.Lr.get(o))}saveBundleMetadata(n,o){return this.Lr.set(o.id,(function(g){return{id:g.id,version:g.version,createTime:Uo(g.createTime)}})(o)),st.resolve()}getNamedQuery(n,o){return st.resolve(this.kr.get(o))}saveNamedQuery(n,o){return this.kr.set(o.name,(function(g){return{name:g.name,query:yC(g.bundledQuery),readTime:Uo(g.readTime)}})(o)),st.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC{constructor(){this.overlays=new Br(en.comparator),this.qr=new Map}getOverlay(n,o){return st.resolve(this.overlays.get(o))}getOverlays(n,o){const h=cc();return st.forEach(o,(g=>this.getOverlay(n,g).next((w=>{w!==null&&h.set(g,w)})))).next((()=>h))}saveOverlays(n,o,h){return h.forEach(((g,w)=>{this.St(n,o,w)})),st.resolve()}removeOverlaysForBatchId(n,o,h){const g=this.qr.get(h);return g!==void 0&&(g.forEach((w=>this.overlays=this.overlays.remove(w))),this.qr.delete(h)),st.resolve()}getOverlaysForCollection(n,o,h){const g=cc(),w=o.length+1,x=new en(o.child("")),c=this.overlays.getIteratorFrom(x);for(;c.hasNext();){const k=c.getNext().value,O=k.getKey();if(!o.isPrefixOf(O.path))break;O.path.length===w&&k.largestBatchId>h&&g.set(k.getKey(),k)}return st.resolve(g)}getOverlaysForCollectionGroup(n,o,h,g){let w=new Br(((O,U)=>O-U));const x=this.overlays.getIterator();for(;x.hasNext();){const O=x.getNext().value;if(O.getKey().getCollectionGroup()===o&&O.largestBatchId>h){let U=w.get(O.largestBatchId);U===null&&(U=cc(),w=w.insert(O.largestBatchId,U)),U.set(O.getKey(),O)}}const c=cc(),k=w.getIterator();for(;k.hasNext()&&(k.getNext().value.forEach(((O,U)=>c.set(O,U))),!(c.size()>=g)););return st.resolve(c)}St(n,o,h){const g=this.overlays.get(h.key);if(g!==null){const x=this.qr.get(g.largestBatchId).delete(h.key);this.qr.set(g.largestBatchId,x)}this.overlays=this.overlays.insert(h.key,new ZP(o,h));let w=this.qr.get(o);w===void 0&&(w=Un(),this.qr.set(o,w)),this.qr.set(o,w.add(h.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kC{constructor(){this.sessionToken=Ri.EMPTY_BYTE_STRING}getSessionToken(n){return st.resolve(this.sessionToken)}setSessionToken(n,o){return this.sessionToken=o,st.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_{constructor(){this.Qr=new gi(Ii.$r),this.Ur=new gi(Ii.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(n,o){const h=new Ii(n,o);this.Qr=this.Qr.add(h),this.Ur=this.Ur.add(h)}Wr(n,o){n.forEach((h=>this.addReference(h,o)))}removeReference(n,o){this.Gr(new Ii(n,o))}zr(n,o){n.forEach((h=>this.removeReference(h,o)))}jr(n){const o=new en(new Vr([])),h=new Ii(o,n),g=new Ii(o,n+1),w=[];return this.Ur.forEachInRange([h,g],(x=>{this.Gr(x),w.push(x.key)})),w}Jr(){this.Qr.forEach((n=>this.Gr(n)))}Gr(n){this.Qr=this.Qr.delete(n),this.Ur=this.Ur.delete(n)}Hr(n){const o=new en(new Vr([])),h=new Ii(o,n),g=new Ii(o,n+1);let w=Un();return this.Ur.forEachInRange([h,g],(x=>{w=w.add(x.key)})),w}containsKey(n){const o=new Ii(n,0),h=this.Qr.firstAfterOrEqual(o);return h!==null&&n.isEqual(h.key)}}class Ii{constructor(n,o){this.key=n,this.Yr=o}static $r(n,o){return en.comparator(n.key,o.key)||Bn(n.Yr,o.Yr)}static Kr(n,o){return Bn(n.Yr,o.Yr)||en.comparator(n.key,o.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{constructor(n,o){this.indexManager=n,this.referenceDelegate=o,this.mutationQueue=[],this.tr=1,this.Zr=new gi(Ii.$r)}checkEmpty(n){return st.resolve(this.mutationQueue.length===0)}addMutationBatch(n,o,h,g){const w=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const x=new WP(w,o,h,g);this.mutationQueue.push(x);for(const c of g)this.Zr=this.Zr.add(new Ii(c.key,w)),this.indexManager.addToCollectionParentIndex(n,c.key.path.popLast());return st.resolve(x)}lookupMutationBatch(n,o){return st.resolve(this.Xr(o))}getNextMutationBatchAfterBatchId(n,o){const h=o+1,g=this.ei(h),w=g<0?0:g;return st.resolve(this.mutationQueue.length>w?this.mutationQueue[w]:null)}getHighestUnacknowledgedBatchId(){return st.resolve(this.mutationQueue.length===0?F_:this.tr-1)}getAllMutationBatches(n){return st.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(n,o){const h=new Ii(o,0),g=new Ii(o,Number.POSITIVE_INFINITY),w=[];return this.Zr.forEachInRange([h,g],(x=>{const c=this.Xr(x.Yr);w.push(c)})),st.resolve(w)}getAllMutationBatchesAffectingDocumentKeys(n,o){let h=new gi(Bn);return o.forEach((g=>{const w=new Ii(g,0),x=new Ii(g,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([w,x],(c=>{h=h.add(c.Yr)}))})),st.resolve(this.ti(h))}getAllMutationBatchesAffectingQuery(n,o){const h=o.path,g=h.length+1;let w=h;en.isDocumentKey(w)||(w=w.child(""));const x=new Ii(new en(w),0);let c=new gi(Bn);return this.Zr.forEachWhile((k=>{const O=k.key.path;return!!h.isPrefixOf(O)&&(O.length===g&&(c=c.add(k.Yr)),!0)}),x),st.resolve(this.ti(c))}ti(n){const o=[];return n.forEach((h=>{const g=this.Xr(h);g!==null&&o.push(g)})),o}removeMutationBatch(n,o){ar(this.ni(o.batchId,"removed")===0,55003),this.mutationQueue.shift();let h=this.Zr;return st.forEach(o.mutations,(g=>{const w=new Ii(g.key,o.batchId);return h=h.delete(w),this.referenceDelegate.markPotentiallyOrphaned(n,g.key)})).next((()=>{this.Zr=h}))}ir(n){}containsKey(n,o){const h=new Ii(o,0),g=this.Zr.firstAfterOrEqual(h);return st.resolve(o.isEqual(g&&g.key))}performConsistencyCheck(n){return this.mutationQueue.length,st.resolve()}ni(n,o){return this.ei(n)}ei(n){return this.mutationQueue.length===0?0:n-this.mutationQueue[0].batchId}Xr(n){const o=this.ei(n);return o<0||o>=this.mutationQueue.length?null:this.mutationQueue[o]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(n){this.ri=n,this.docs=(function(){return new Br(en.comparator)})(),this.size=0}setIndexManager(n){this.indexManager=n}addEntry(n,o){const h=o.key,g=this.docs.get(h),w=g?g.size:0,x=this.ri(o);return this.docs=this.docs.insert(h,{document:o.mutableCopy(),size:x}),this.size+=x-w,this.indexManager.addToCollectionParentIndex(n,h.path.popLast())}removeEntry(n){const o=this.docs.get(n);o&&(this.docs=this.docs.remove(n),this.size-=o.size)}getEntry(n,o){const h=this.docs.get(o);return st.resolve(h?h.document.mutableCopy():Gi.newInvalidDocument(o))}getEntries(n,o){let h=Sa();return o.forEach((g=>{const w=this.docs.get(g);h=h.insert(g,w?w.document.mutableCopy():Gi.newInvalidDocument(g))})),st.resolve(h)}getDocumentsMatchingQuery(n,o,h,g){let w=Sa();const x=o.path,c=new en(x.child("__id-9223372036854775808__")),k=this.docs.getIteratorFrom(c);for(;k.hasNext();){const{key:O,value:{document:U}}=k.getNext();if(!x.isPrefixOf(O.path))break;O.path.length>x.length+1||aP(oP(U),h)<=0||(g.has(U.key)||Xf(o,U))&&(w=w.insert(U.key,U.mutableCopy()))}return st.resolve(w)}getAllFromCollectionGroup(n,o,h,g){un(9500)}ii(n,o){return st.forEach(this.docs,(h=>o(h)))}newChangeBuffer(n){return new LC(this)}getSize(n){return st.resolve(this.size)}}class LC extends SC{constructor(n){super(),this.Nr=n}applyChanges(n){const o=[];return this.changes.forEach(((h,g)=>{g.isValidDocument()?o.push(this.Nr.addEntry(n,g)):this.Nr.removeEntry(h)})),st.waitFor(o)}getFromCache(n,o){return this.Nr.getEntry(n,o)}getAllFromCache(n,o){return this.Nr.getEntries(n,o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC{constructor(n){this.persistence=n,this.si=new wc((o=>B_(o)),U_),this.lastRemoteSnapshotVersion=yn.min(),this.highestTargetId=0,this.oi=0,this._i=new W_,this.targetCount=0,this.ai=Vu.ur()}forEachTarget(n,o){return this.si.forEach(((h,g)=>o(g))),st.resolve()}getLastRemoteSnapshotVersion(n){return st.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(n){return st.resolve(this.oi)}allocateTargetId(n){return this.highestTargetId=this.ai.next(),st.resolve(this.highestTargetId)}setTargetsMetadata(n,o,h){return h&&(this.lastRemoteSnapshotVersion=h),o>this.oi&&(this.oi=o),st.resolve()}Pr(n){this.si.set(n.target,n);const o=n.targetId;o>this.highestTargetId&&(this.ai=new Vu(o),this.highestTargetId=o),n.sequenceNumber>this.oi&&(this.oi=n.sequenceNumber)}addTargetData(n,o){return this.Pr(o),this.targetCount+=1,st.resolve()}updateTargetData(n,o){return this.Pr(o),st.resolve()}removeTargetData(n,o){return this.si.delete(o.target),this._i.jr(o.targetId),this.targetCount-=1,st.resolve()}removeTargets(n,o,h){let g=0;const w=[];return this.si.forEach(((x,c)=>{c.sequenceNumber<=o&&h.get(c.targetId)===null&&(this.si.delete(x),w.push(this.removeMatchingKeysForTargetId(n,c.targetId)),g++)})),st.waitFor(w).next((()=>g))}getTargetCount(n){return st.resolve(this.targetCount)}getTargetData(n,o){const h=this.si.get(o)||null;return st.resolve(h)}addMatchingKeys(n,o,h){return this._i.Wr(o,h),st.resolve()}removeMatchingKeys(n,o,h){this._i.zr(o,h);const g=this.persistence.referenceDelegate,w=[];return g&&o.forEach((x=>{w.push(g.markPotentiallyOrphaned(n,x))})),st.waitFor(w)}removeMatchingKeysForTargetId(n,o){return this._i.jr(o),st.resolve()}getMatchingKeysForTargetId(n,o){const h=this._i.Hr(o);return st.resolve(h)}containsKey(n,o){return st.resolve(this._i.containsKey(o))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(n,o){this.ui={},this.overlays={},this.ci=new Gf(0),this.li=!1,this.li=!0,this.hi=new kC,this.referenceDelegate=n(this),this.Pi=new zC(this),this.indexManager=new vC,this.remoteDocumentCache=(function(g){return new DC(g)})((h=>this.referenceDelegate.Ti(h))),this.serializer=new _C(o),this.Ii=new CC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(n){return this.indexManager}getDocumentOverlayCache(n){let o=this.overlays[n.toKey()];return o||(o=new MC,this.overlays[n.toKey()]=o),o}getMutationQueue(n,o){let h=this.ui[n.toKey()];return h||(h=new RC(o,this.referenceDelegate),this.ui[n.toKey()]=h),h}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(n,o,h){zt("MemoryPersistence","Starting transaction:",n);const g=new OC(this.ci.next());return this.referenceDelegate.Ei(),h(g).next((w=>this.referenceDelegate.di(g).next((()=>w)))).toPromise().then((w=>(g.raiseOnCommittedEvent(),w)))}Ai(n,o){return st.or(Object.values(this.ui).map((h=>()=>h.containsKey(n,o))))}}class OC extends cP{constructor(n){super(),this.currentSequenceNumber=n}}class Z_{constructor(n){this.persistence=n,this.Ri=new W_,this.Vi=null}static mi(n){return new Z_(n)}get fi(){if(this.Vi)return this.Vi;throw un(60996)}addReference(n,o,h){return this.Ri.addReference(h,o),this.fi.delete(h.toString()),st.resolve()}removeReference(n,o,h){return this.Ri.removeReference(h,o),this.fi.add(h.toString()),st.resolve()}markPotentiallyOrphaned(n,o){return this.fi.add(o.toString()),st.resolve()}removeTarget(n,o){this.Ri.jr(o.targetId).forEach((g=>this.fi.add(g.toString())));const h=this.persistence.getTargetCache();return h.getMatchingKeysForTargetId(n,o.targetId).next((g=>{g.forEach((w=>this.fi.add(w.toString())))})).next((()=>h.removeTargetData(n,o)))}Ei(){this.Vi=new Set}di(n){const o=this.persistence.getRemoteDocumentCache().newChangeBuffer();return st.forEach(this.fi,(h=>{const g=en.fromPath(h);return this.gi(n,g).next((w=>{w||o.removeEntry(g,yn.min())}))})).next((()=>(this.Vi=null,o.apply(n))))}updateLimboDocument(n,o){return this.gi(n,o).next((h=>{h?this.fi.delete(o.toString()):this.fi.add(o.toString())}))}Ti(n){return 0}gi(n,o){return st.or([()=>st.resolve(this.Ri.containsKey(o)),()=>this.persistence.getTargetCache().containsKey(n,o),()=>this.persistence.Ai(n,o)])}}class Pf{constructor(n,o){this.persistence=n,this.pi=new wc((h=>dP(h.path)),((h,g)=>h.isEqual(g))),this.garbageCollector=IC(this,o)}static mi(n,o){return new Pf(n,o)}Ei(){}di(n){return st.resolve()}forEachTarget(n,o){return this.persistence.getTargetCache().forEachTarget(n,o)}gr(n){const o=this.wr(n);return this.persistence.getTargetCache().getTargetCount(n).next((h=>o.next((g=>h+g))))}wr(n){let o=0;return this.pr(n,(h=>{o++})).next((()=>o))}pr(n,o){return st.forEach(this.pi,((h,g)=>this.br(n,h,g).next((w=>w?st.resolve():o(g)))))}removeTargets(n,o,h){return this.persistence.getTargetCache().removeTargets(n,o,h)}removeOrphanedDocuments(n,o){let h=0;const g=this.persistence.getRemoteDocumentCache(),w=g.newChangeBuffer();return g.ii(n,(x=>this.br(n,x,o).next((c=>{c||(h++,w.removeEntry(x,yn.min()))})))).next((()=>w.apply(n))).next((()=>h))}markPotentiallyOrphaned(n,o){return this.pi.set(o,n.currentSequenceNumber),st.resolve()}removeTarget(n,o){const h=o.withSequenceNumber(n.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(n,h)}addReference(n,o,h){return this.pi.set(h,n.currentSequenceNumber),st.resolve()}removeReference(n,o,h){return this.pi.set(h,n.currentSequenceNumber),st.resolve()}updateLimboDocument(n,o){return this.pi.set(o,n.currentSequenceNumber),st.resolve()}Ti(n){let o=n.key.toString().length;return n.isFoundDocument()&&(o+=af(n.data.value)),o}br(n,o,h){return st.or([()=>this.persistence.Ai(n,o),()=>this.persistence.getTargetCache().containsKey(n,o),()=>{const g=this.pi.get(o);return st.resolve(g!==void 0&&g>h)}])}getCacheSize(n){return this.persistence.getRemoteDocumentCache().getSize(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K_{constructor(n,o,h,g){this.targetId=n,this.fromCache=o,this.Es=h,this.ds=g}static As(n,o){let h=Un(),g=Un();for(const w of o.docChanges)switch(w.type){case 0:h=h.add(w.doc.key);break;case 1:g=g.add(w.doc.key)}return new K_(n,o.fromCache,h,g)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(n){this._documentReadCount+=n}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NC{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return CS()?8:uP(Hi())>0?6:4})()}initialize(n,o){this.ps=n,this.indexManager=o,this.Rs=!0}getDocumentsMatchingQuery(n,o,h,g){const w={result:null};return this.ys(n,o).next((x=>{w.result=x})).next((()=>{if(!w.result)return this.ws(n,o,g,h).next((x=>{w.result=x}))})).next((()=>{if(w.result)return;const x=new FC;return this.Ss(n,o,x).next((c=>{if(w.result=c,this.Vs)return this.bs(n,o,x,c.size)}))})).next((()=>w.result))}bs(n,o,h,g){return h.documentReadCount<this.fs?(Eu()<=Vn.DEBUG&&zt("QueryEngine","SDK will not create cache indexes for query:",Iu(o),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),st.resolve()):(Eu()<=Vn.DEBUG&&zt("QueryEngine","Query:",Iu(o),"scans",h.documentReadCount,"local documents and returns",g,"documents as results."),h.documentReadCount>this.gs*g?(Eu()<=Vn.DEBUG&&zt("QueryEngine","The SDK decides to create cache indexes for query:",Iu(o),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(n,Vo(o))):st.resolve())}ys(n,o){if(Ix(o))return st.resolve(null);let h=Vo(o);return this.indexManager.getIndexType(n,h).next((g=>g===0?null:(o.limit!==null&&g===1&&(o=l_(o,null,"F"),h=Vo(o)),this.indexManager.getDocumentsMatchingTarget(n,h).next((w=>{const x=Un(...w);return this.ps.getDocuments(n,x).next((c=>this.indexManager.getMinOffset(n,h).next((k=>{const O=this.Ds(o,c);return this.Cs(o,O,x,k.readTime)?this.ys(n,l_(o,null,"F")):this.vs(n,O,o,k)}))))})))))}ws(n,o,h,g){return Ix(o)||g.isEqual(yn.min())?st.resolve(null):this.ps.getDocuments(n,h).next((w=>{const x=this.Ds(o,w);return this.Cs(o,x,h,g)?st.resolve(null):(Eu()<=Vn.DEBUG&&zt("QueryEngine","Re-using previous result from %s to execute query: %s",g.toString(),Iu(o)),this.vs(n,x,o,sP(g,dd)).next((c=>c)))}))}Ds(n,o){let h=new gi(z1(n));return o.forEach(((g,w)=>{Xf(n,w)&&(h=h.add(w))})),h}Cs(n,o,h,g){if(n.limit===null)return!1;if(h.size!==o.size)return!0;const w=n.limitType==="F"?o.last():o.first();return!!w&&(w.hasPendingWrites||w.version.compareTo(g)>0)}Ss(n,o,h){return Eu()<=Vn.DEBUG&&zt("QueryEngine","Using full collection scan to execute query:",Iu(o)),this.ps.getDocumentsMatchingQuery(n,o,hl.min(),h)}vs(n,o,h,g){return this.ps.getDocumentsMatchingQuery(n,h,g).next((w=>(o.forEach((x=>{w=w.insert(x.key,x)})),w)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X_="LocalStore",VC=3e8;class BC{constructor(n,o,h,g){this.persistence=n,this.Fs=o,this.serializer=g,this.Ms=new Br(Bn),this.xs=new wc((w=>B_(w)),U_),this.Os=new Map,this.Ns=n.getRemoteDocumentCache(),this.Pi=n.getTargetCache(),this.Ii=n.getBundleCache(),this.Bs(h)}Bs(n){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(n),this.indexManager=this.persistence.getIndexManager(n),this.mutationQueue=this.persistence.getMutationQueue(n,this.indexManager),this.localDocuments=new PC(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(n){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(o=>n.collect(o,this.Ms)))}}function UC(a,n,o,h){return new BC(a,n,o,h)}async function sw(a,n){const o=En(a);return await o.persistence.runTransaction("Handle user change","readonly",(h=>{let g;return o.mutationQueue.getAllMutationBatches(h).next((w=>(g=w,o.Bs(n),o.mutationQueue.getAllMutationBatches(h)))).next((w=>{const x=[],c=[];let k=Un();for(const O of g){x.push(O.batchId);for(const U of O.mutations)k=k.add(U.key)}for(const O of w){c.push(O.batchId);for(const U of O.mutations)k=k.add(U.key)}return o.localDocuments.getDocuments(h,k).next((O=>({Ls:O,removedBatchIds:x,addedBatchIds:c})))}))}))}function jC(a,n){const o=En(a);return o.persistence.runTransaction("Acknowledge batch","readwrite-primary",(h=>{const g=n.batch.keys(),w=o.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,k,O,U){const Y=O.batch,se=Y.keys();let xe=st.resolve();return se.forEach(($e=>{xe=xe.next((()=>U.getEntry(k,$e))).next((Ce=>{const J=O.docVersions.get($e);ar(J!==null,48541),Ce.version.compareTo(J)<0&&(Y.applyToRemoteDocument(Ce,O),Ce.isValidDocument()&&(Ce.setReadTime(O.commitVersion),U.addEntry(Ce)))}))})),xe.next((()=>c.mutationQueue.removeMutationBatch(k,Y)))})(o,h,n,w).next((()=>w.apply(h))).next((()=>o.mutationQueue.performConsistencyCheck(h))).next((()=>o.documentOverlayCache.removeOverlaysForBatchId(h,g,n.batch.batchId))).next((()=>o.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,(function(c){let k=Un();for(let O=0;O<c.mutationResults.length;++O)c.mutationResults[O].transformResults.length>0&&(k=k.add(c.batch.mutations[O].key));return k})(n)))).next((()=>o.localDocuments.getDocuments(h,g)))}))}function ow(a){const n=En(a);return n.persistence.runTransaction("Get last remote snapshot version","readonly",(o=>n.Pi.getLastRemoteSnapshotVersion(o)))}function $C(a,n){const o=En(a),h=n.snapshotVersion;let g=o.Ms;return o.persistence.runTransaction("Apply remote event","readwrite-primary",(w=>{const x=o.Ns.newChangeBuffer({trackRemovals:!0});g=o.Ms;const c=[];n.targetChanges.forEach(((U,Y)=>{const se=g.get(Y);if(!se)return;c.push(o.Pi.removeMatchingKeys(w,U.removedDocuments,Y).next((()=>o.Pi.addMatchingKeys(w,U.addedDocuments,Y))));let xe=se.withSequenceNumber(w.currentSequenceNumber);n.targetMismatches.get(Y)!==null?xe=xe.withResumeToken(Ri.EMPTY_BYTE_STRING,yn.min()).withLastLimboFreeSnapshotVersion(yn.min()):U.resumeToken.approximateByteSize()>0&&(xe=xe.withResumeToken(U.resumeToken,h)),g=g.insert(Y,xe),(function(Ce,J,Ye){return Ce.resumeToken.approximateByteSize()===0||J.snapshotVersion.toMicroseconds()-Ce.snapshotVersion.toMicroseconds()>=VC?!0:Ye.addedDocuments.size+Ye.modifiedDocuments.size+Ye.removedDocuments.size>0})(se,xe,U)&&c.push(o.Pi.updateTargetData(w,xe))}));let k=Sa(),O=Un();if(n.documentUpdates.forEach((U=>{n.resolvedLimboDocuments.has(U)&&c.push(o.persistence.referenceDelegate.updateLimboDocument(w,U))})),c.push(qC(w,x,n.documentUpdates).next((U=>{k=U.ks,O=U.qs}))),!h.isEqual(yn.min())){const U=o.Pi.getLastRemoteSnapshotVersion(w).next((Y=>o.Pi.setTargetsMetadata(w,w.currentSequenceNumber,h)));c.push(U)}return st.waitFor(c).next((()=>x.apply(w))).next((()=>o.localDocuments.getLocalViewOfDocuments(w,k,O))).next((()=>k))})).then((w=>(o.Ms=g,w)))}function qC(a,n,o){let h=Un(),g=Un();return o.forEach((w=>h=h.add(w))),n.getEntries(a,h).next((w=>{let x=Sa();return o.forEach(((c,k)=>{const O=w.get(c);k.isFoundDocument()!==O.isFoundDocument()&&(g=g.add(c)),k.isNoDocument()&&k.version.isEqual(yn.min())?(n.removeEntry(c,k.readTime),x=x.insert(c,k)):!O.isValidDocument()||k.version.compareTo(O.version)>0||k.version.compareTo(O.version)===0&&O.hasPendingWrites?(n.addEntry(k),x=x.insert(c,k)):zt(X_,"Ignoring outdated watch update for ",c,". Current version:",O.version," Watch version:",k.version)})),{ks:x,qs:g}}))}function GC(a,n){const o=En(a);return o.persistence.runTransaction("Get next mutation batch","readonly",(h=>(n===void 0&&(n=F_),o.mutationQueue.getNextMutationBatchAfterBatchId(h,n))))}function HC(a,n){const o=En(a);return o.persistence.runTransaction("Allocate target","readwrite",(h=>{let g;return o.Pi.getTargetData(h,n).next((w=>w?(g=w,st.resolve(g)):o.Pi.allocateTargetId(h).next((x=>(g=new sl(n,x,"TargetPurposeListen",h.currentSequenceNumber),o.Pi.addTargetData(h,g).next((()=>g)))))))})).then((h=>{const g=o.Ms.get(h.targetId);return(g===null||h.snapshotVersion.compareTo(g.snapshotVersion)>0)&&(o.Ms=o.Ms.insert(h.targetId,h),o.xs.set(n,h.targetId)),h}))}async function p_(a,n,o){const h=En(a),g=h.Ms.get(n),w=o?"readwrite":"readwrite-primary";try{o||await h.persistence.runTransaction("Release target",w,(x=>h.persistence.referenceDelegate.removeTarget(x,g)))}catch(x){if(!qu(x))throw x;zt(X_,`Failed to update sequence numbers for target ${n}: ${x}`)}h.Ms=h.Ms.remove(n),h.xs.delete(g.target)}function Nx(a,n,o){const h=En(a);let g=yn.min(),w=Un();return h.persistence.runTransaction("Execute query","readwrite",(x=>(function(k,O,U){const Y=En(k),se=Y.xs.get(U);return se!==void 0?st.resolve(Y.Ms.get(se)):Y.Pi.getTargetData(O,U)})(h,x,Vo(n)).next((c=>{if(c)return g=c.lastLimboFreeSnapshotVersion,h.Pi.getMatchingKeysForTargetId(x,c.targetId).next((k=>{w=k}))})).next((()=>h.Fs.getDocumentsMatchingQuery(x,n,o?g:yn.min(),o?w:Un()))).next((c=>(WC(h,RP(n),c),{documents:c,Qs:w})))))}function WC(a,n,o){let h=a.Os.get(n)||yn.min();o.forEach(((g,w)=>{w.readTime.compareTo(h)>0&&(h=w.readTime)})),a.Os.set(n,h)}class Vx{constructor(){this.activeTargetIds=NP()}zs(n){this.activeTargetIds=this.activeTargetIds.add(n)}js(n){this.activeTargetIds=this.activeTargetIds.delete(n)}Gs(){const n={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(n)}}class ZC{constructor(){this.Mo=new Vx,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(n){}updateMutationState(n,o,h){}addLocalQueryTarget(n,o=!0){return o&&this.Mo.zs(n),this.xo[n]||"not-current"}updateQueryState(n,o,h){this.xo[n]=o}removeLocalQueryTarget(n){this.Mo.js(n)}isLocalQueryTarget(n){return this.Mo.activeTargetIds.has(n)}clearQueryState(n){delete this.xo[n]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(n){return this.Mo.activeTargetIds.has(n)}start(){return this.Mo=new Vx,Promise.resolve()}handleUserChange(n,o,h){}setOnlineState(n){}shutdown(){}writeSequenceNumber(n){}notifyBundleLoaded(n){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{Oo(n){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bx="ConnectivityMonitor";class Ux{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(n){this.qo.push(n)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){zt(Bx,"Network connectivity changed: AVAILABLE");for(const n of this.qo)n(0)}ko(){zt(Bx,"Network connectivity changed: UNAVAILABLE");for(const n of this.qo)n(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qp=null;function f_(){return Qp===null?Qp=(function(){return 268435456+Math.round(2147483648*Math.random())})():Qp++,"0x"+Qp.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bg="RestConnection",XC={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class YC{get $o(){return!1}constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const o=n.ssl?"https":"http",h=encodeURIComponent(this.databaseId.projectId),g=encodeURIComponent(this.databaseId.database);this.Uo=o+"://"+n.host,this.Ko=`projects/${h}/databases/${g}`,this.Wo=this.databaseId.database===bf?`project_id=${h}`:`project_id=${h}&database_id=${g}`}Go(n,o,h,g,w){const x=f_(),c=this.zo(n,o.toUriEncodedString());zt(Bg,`Sending RPC '${n}' ${x}:`,c,h);const k={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(k,g,w);const{host:O}=new URL(c),U=xc(O);return this.Jo(n,c,k,h,U).then((Y=>(zt(Bg,`Received RPC '${n}' ${x}: `,Y),Y)),(Y=>{throw zu(Bg,`RPC '${n}' ${x} failed with error: `,Y,"url: ",c,"request:",h),Y}))}Ho(n,o,h,g,w,x){return this.Go(n,o,h,g,w)}jo(n,o,h){n["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+ju})(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),o&&o.headers.forEach(((g,w)=>n[w]=g)),h&&h.headers.forEach(((g,w)=>n[w]=g))}zo(n,o){const h=XC[n];return`${this.Uo}/v1/${o}:${h}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC{constructor(n){this.Yo=n.Yo,this.Zo=n.Zo}Xo(n){this.e_=n}t_(n){this.n_=n}r_(n){this.i_=n}onMessage(n){this.s_=n}close(){this.Zo()}send(n){this.Yo(n)}o_(){this.e_()}__(){this.n_()}a_(n){this.i_(n)}u_(n){this.s_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ji="WebChannelConnection";class JC extends YC{constructor(n){super(n),this.c_=[],this.forceLongPolling=n.forceLongPolling,this.autoDetectLongPolling=n.autoDetectLongPolling,this.useFetchStreams=n.useFetchStreams,this.longPollingOptions=n.longPollingOptions}Jo(n,o,h,g,w){const x=f_();return new Promise(((c,k)=>{const O=new u1;O.setWithCredentials(!0),O.listenOnce(h1.COMPLETE,(()=>{try{switch(O.getLastErrorCode()){case of.NO_ERROR:const Y=O.getResponseJson();zt(ji,`XHR for RPC '${n}' ${x} received:`,JSON.stringify(Y)),c(Y);break;case of.TIMEOUT:zt(ji,`RPC '${n}' ${x} timed out`),k(new Gt(ut.DEADLINE_EXCEEDED,"Request time out"));break;case of.HTTP_ERROR:const se=O.getStatus();if(zt(ji,`RPC '${n}' ${x} failed with status:`,se,"response text:",O.getResponseText()),se>0){let xe=O.getResponseJson();Array.isArray(xe)&&(xe=xe[0]);const $e=xe==null?void 0:xe.error;if($e&&$e.status&&$e.message){const Ce=(function(Ye){const qe=Ye.toLowerCase().replace(/_/g,"-");return Object.values(ut).indexOf(qe)>=0?qe:ut.UNKNOWN})($e.status);k(new Gt(Ce,$e.message))}else k(new Gt(ut.UNKNOWN,"Server responded with status "+O.getStatus()))}else k(new Gt(ut.UNAVAILABLE,"Connection failed."));break;default:un(9055,{l_:n,streamId:x,h_:O.getLastErrorCode(),P_:O.getLastError()})}}finally{zt(ji,`RPC '${n}' ${x} completed.`)}}));const U=JSON.stringify(g);zt(ji,`RPC '${n}' ${x} sending request:`,g),O.send(o,"POST",U,h,15)}))}T_(n,o,h){const g=f_(),w=[this.Uo,"/","google.firestore.v1.Firestore","/",n,"/channel"],x=f1(),c=p1(),k={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},O=this.longPollingOptions.timeoutSeconds;O!==void 0&&(k.longPollingTimeout=Math.round(1e3*O)),this.useFetchStreams&&(k.useFetchStreams=!0),this.jo(k.initMessageHeaders,o,h),k.encodeInitMessageHeaders=!0;const U=w.join("");zt(ji,`Creating RPC '${n}' stream ${g}: ${U}`,k);const Y=x.createWebChannel(U,k);this.I_(Y);let se=!1,xe=!1;const $e=new QC({Yo:J=>{xe?zt(ji,`Not sending because RPC '${n}' stream ${g} is closed:`,J):(se||(zt(ji,`Opening RPC '${n}' stream ${g} transport.`),Y.open(),se=!0),zt(ji,`RPC '${n}' stream ${g} sending:`,J),Y.send(J))},Zo:()=>Y.close()}),Ce=(J,Ye,qe)=>{J.listen(Ye,(He=>{try{qe(He)}catch(et){setTimeout((()=>{throw et}),0)}}))};return Ce(Y,ed.EventType.OPEN,(()=>{xe||(zt(ji,`RPC '${n}' stream ${g} transport opened.`),$e.o_())})),Ce(Y,ed.EventType.CLOSE,(()=>{xe||(xe=!0,zt(ji,`RPC '${n}' stream ${g} transport closed`),$e.a_(),this.E_(Y))})),Ce(Y,ed.EventType.ERROR,(J=>{xe||(xe=!0,zu(ji,`RPC '${n}' stream ${g} transport errored. Name:`,J.name,"Message:",J.message),$e.a_(new Gt(ut.UNAVAILABLE,"The operation could not be completed")))})),Ce(Y,ed.EventType.MESSAGE,(J=>{var Ye;if(!xe){const qe=J.data[0];ar(!!qe,16349);const He=qe,et=(He==null?void 0:He.error)||((Ye=He[0])==null?void 0:Ye.error);if(et){zt(ji,`RPC '${n}' stream ${g} received error:`,et);const at=et.status;let Qe=(function(ae){const Ee=ai[ae];if(Ee!==void 0)return W1(Ee)})(at),he=et.message;Qe===void 0&&(Qe=ut.INTERNAL,he="Unknown error status: "+at+" with message "+et.message),xe=!0,$e.a_(new Gt(Qe,he)),Y.close()}else zt(ji,`RPC '${n}' stream ${g} received:`,qe),$e.u_(qe)}})),Ce(c,d1.STAT_EVENT,(J=>{J.stat===n_.PROXY?zt(ji,`RPC '${n}' stream ${g} detected buffering proxy`):J.stat===n_.NOPROXY&&zt(ji,`RPC '${n}' stream ${g} detected no buffering proxy`)})),setTimeout((()=>{$e.__()}),0),$e}terminate(){this.c_.forEach((n=>n.close())),this.c_=[]}I_(n){this.c_.push(n)}E_(n){this.c_=this.c_.filter((o=>o===n))}}function Ug(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function em(a){return new rC(a,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(n,o,h=1e3,g=1.5,w=6e4){this.Mi=n,this.timerId=o,this.d_=h,this.A_=g,this.R_=w,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(n){this.cancel();const o=Math.floor(this.V_+this.y_()),h=Math.max(0,Date.now()-this.f_),g=Math.max(0,o-h);g>0&&zt("ExponentialBackoff",`Backing off for ${g} ms (base delay: ${this.V_} ms, delay with jitter: ${o} ms, last attempt: ${h} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,g,(()=>(this.f_=Date.now(),n()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jx="PersistentStream";class lw{constructor(n,o,h,g,w,x,c,k){this.Mi=n,this.S_=h,this.b_=g,this.connection=w,this.authCredentialsProvider=x,this.appCheckCredentialsProvider=c,this.listener=k,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new aw(n,o)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(n){this.Q_(),this.stream.send(n)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(n,o){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,n!==4?this.M_.reset():o&&o.code===ut.RESOURCE_EXHAUSTED?(Ia(o.toString()),Ia("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):o&&o.code===ut.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=n,await this.listener.r_(o)}K_(){}auth(){this.state=1;const n=this.W_(this.D_),o=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([h,g])=>{this.D_===o&&this.G_(h,g)}),(h=>{n((()=>{const g=new Gt(ut.UNKNOWN,"Fetching auth token failed: "+h.message);return this.z_(g)}))}))}G_(n,o){const h=this.W_(this.D_);this.stream=this.j_(n,o),this.stream.Xo((()=>{h((()=>this.listener.Xo()))})),this.stream.t_((()=>{h((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((g=>{h((()=>this.z_(g)))})),this.stream.onMessage((g=>{h((()=>++this.F_==1?this.J_(g):this.onNext(g)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(n){return zt(jx,`close with error: ${n}`),this.stream=null,this.close(4,n)}W_(n){return o=>{this.Mi.enqueueAndForget((()=>this.D_===n?o():(zt(jx,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class eM extends lw{constructor(n,o,h,g,w,x){super(n,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",o,h,g,x),this.serializer=w}j_(n,o){return this.connection.T_("Listen",n,o)}J_(n){return this.onNext(n)}onNext(n){this.M_.reset();const o=oC(this.serializer,n),h=(function(w){if(!("targetChange"in w))return yn.min();const x=w.targetChange;return x.targetIds&&x.targetIds.length?yn.min():x.readTime?Uo(x.readTime):yn.min()})(n);return this.listener.H_(o,h)}Y_(n){const o={};o.database=d_(this.serializer),o.addTarget=(function(w,x){let c;const k=x.target;if(c=a_(k)?{documents:cC(w,k)}:{query:uC(w,k).ft},c.targetId=x.targetId,x.resumeToken.approximateByteSize()>0){c.resumeToken=X1(w,x.resumeToken);const O=c_(w,x.expectedCount);O!==null&&(c.expectedCount=O)}else if(x.snapshotVersion.compareTo(yn.min())>0){c.readTime=Af(w,x.snapshotVersion.toTimestamp());const O=c_(w,x.expectedCount);O!==null&&(c.expectedCount=O)}return c})(this.serializer,n);const h=dC(this.serializer,n);h&&(o.labels=h),this.q_(o)}Z_(n){const o={};o.database=d_(this.serializer),o.removeTarget=n,this.q_(o)}}class tM extends lw{constructor(n,o,h,g,w,x){super(n,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",o,h,g,x),this.serializer=w}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(n,o){return this.connection.T_("Write",n,o)}J_(n){return ar(!!n.streamToken,31322),this.lastStreamToken=n.streamToken,ar(!n.writeResults||n.writeResults.length===0,55816),this.listener.ta()}onNext(n){ar(!!n.streamToken,12678),this.lastStreamToken=n.streamToken,this.M_.reset();const o=lC(n.writeResults,n.commitTime),h=Uo(n.commitTime);return this.listener.na(h,o)}ra(){const n={};n.database=d_(this.serializer),this.q_(n)}ea(n){const o={streamToken:this.lastStreamToken,writes:n.map((h=>aC(this.serializer,h)))};this.q_(o)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nM{}class rM extends nM{constructor(n,o,h,g){super(),this.authCredentials=n,this.appCheckCredentials=o,this.connection=h,this.serializer=g,this.ia=!1}sa(){if(this.ia)throw new Gt(ut.FAILED_PRECONDITION,"The client has already been terminated.")}Go(n,o,h,g){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([w,x])=>this.connection.Go(n,u_(o,h),g,w,x))).catch((w=>{throw w.name==="FirebaseError"?(w.code===ut.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),w):new Gt(ut.UNKNOWN,w.toString())}))}Ho(n,o,h,g,w){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([x,c])=>this.connection.Ho(n,u_(o,h),g,x,c,w))).catch((x=>{throw x.name==="FirebaseError"?(x.code===ut.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),x):new Gt(ut.UNKNOWN,x.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class iM{constructor(n,o){this.asyncQueue=n,this.onlineStateHandler=o,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(n){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${n.toString()}`),this.ca("Offline")))}set(n){this.Pa(),this.oa=0,n==="Online"&&(this.aa=!1),this.ca(n)}ca(n){n!==this.state&&(this.state=n,this.onlineStateHandler(n))}la(n){const o=`Could not reach Cloud Firestore backend. ${n}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ia(o),this.aa=!1):zt("OnlineStateTracker",o)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gc="RemoteStore";class sM{constructor(n,o,h,g,w){this.localStore=n,this.datastore=o,this.asyncQueue=h,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=w,this.Aa.Oo((x=>{h.enqueueAndForget((async()=>{Tc(this)&&(zt(gc,"Restarting streams for network reachability change."),await(async function(k){const O=En(k);O.Ea.add(4),await Sd(O),O.Ra.set("Unknown"),O.Ea.delete(4),await tm(O)})(this))}))})),this.Ra=new iM(h,g)}}async function tm(a){if(Tc(a))for(const n of a.da)await n(!0)}async function Sd(a){for(const n of a.da)await n(!1)}function cw(a,n){const o=En(a);o.Ia.has(n.targetId)||(o.Ia.set(n.targetId,n),ey(o)?J_(o):Gu(o).O_()&&Q_(o,n))}function Y_(a,n){const o=En(a),h=Gu(o);o.Ia.delete(n),h.O_()&&uw(o,n),o.Ia.size===0&&(h.O_()?h.L_():Tc(o)&&o.Ra.set("Unknown"))}function Q_(a,n){if(a.Va.Ue(n.targetId),n.resumeToken.approximateByteSize()>0||n.snapshotVersion.compareTo(yn.min())>0){const o=a.remoteSyncer.getRemoteKeysForTarget(n.targetId).size;n=n.withExpectedCount(o)}Gu(a).Y_(n)}function uw(a,n){a.Va.Ue(n),Gu(a).Z_(n)}function J_(a){a.Va=new JP({getRemoteKeysForTarget:n=>a.remoteSyncer.getRemoteKeysForTarget(n),At:n=>a.Ia.get(n)||null,ht:()=>a.datastore.serializer.databaseId}),Gu(a).start(),a.Ra.ua()}function ey(a){return Tc(a)&&!Gu(a).x_()&&a.Ia.size>0}function Tc(a){return En(a).Ea.size===0}function hw(a){a.Va=void 0}async function oM(a){a.Ra.set("Online")}async function aM(a){a.Ia.forEach(((n,o)=>{Q_(a,n)}))}async function lM(a,n){hw(a),ey(a)?(a.Ra.ha(n),J_(a)):a.Ra.set("Unknown")}async function cM(a,n,o){if(a.Ra.set("Online"),n instanceof K1&&n.state===2&&n.cause)try{await(async function(g,w){const x=w.cause;for(const c of w.targetIds)g.Ia.has(c)&&(await g.remoteSyncer.rejectListen(c,x),g.Ia.delete(c),g.Va.removeTarget(c))})(a,n)}catch(h){zt(gc,"Failed to remove targets %s: %s ",n.targetIds.join(","),h),await Cf(a,h)}else if(n instanceof uf?a.Va.Ze(n):n instanceof Z1?a.Va.st(n):a.Va.tt(n),!o.isEqual(yn.min()))try{const h=await ow(a.localStore);o.compareTo(h)>=0&&await(function(w,x){const c=w.Va.Tt(x);return c.targetChanges.forEach(((k,O)=>{if(k.resumeToken.approximateByteSize()>0){const U=w.Ia.get(O);U&&w.Ia.set(O,U.withResumeToken(k.resumeToken,x))}})),c.targetMismatches.forEach(((k,O)=>{const U=w.Ia.get(k);if(!U)return;w.Ia.set(k,U.withResumeToken(Ri.EMPTY_BYTE_STRING,U.snapshotVersion)),uw(w,k);const Y=new sl(U.target,k,O,U.sequenceNumber);Q_(w,Y)})),w.remoteSyncer.applyRemoteEvent(c)})(a,o)}catch(h){zt(gc,"Failed to raise snapshot:",h),await Cf(a,h)}}async function Cf(a,n,o){if(!qu(n))throw n;a.Ea.add(1),await Sd(a),a.Ra.set("Offline"),o||(o=()=>ow(a.localStore)),a.asyncQueue.enqueueRetryable((async()=>{zt(gc,"Retrying IndexedDB access"),await o(),a.Ea.delete(1),await tm(a)}))}function dw(a,n){return n().catch((o=>Cf(a,o,n)))}async function nm(a){const n=En(a),o=ml(n);let h=n.Ta.length>0?n.Ta[n.Ta.length-1].batchId:F_;for(;uM(n);)try{const g=await GC(n.localStore,h);if(g===null){n.Ta.length===0&&o.L_();break}h=g.batchId,hM(n,g)}catch(g){await Cf(n,g)}pw(n)&&fw(n)}function uM(a){return Tc(a)&&a.Ta.length<10}function hM(a,n){a.Ta.push(n);const o=ml(a);o.O_()&&o.X_&&o.ea(n.mutations)}function pw(a){return Tc(a)&&!ml(a).x_()&&a.Ta.length>0}function fw(a){ml(a).start()}async function dM(a){ml(a).ra()}async function pM(a){const n=ml(a);for(const o of a.Ta)n.ea(o.mutations)}async function fM(a,n,o){const h=a.Ta.shift(),g=q_.from(h,n,o);await dw(a,(()=>a.remoteSyncer.applySuccessfulWrite(g))),await nm(a)}async function mM(a,n){n&&ml(a).X_&&await(async function(h,g){if((function(x){return XP(x)&&x!==ut.ABORTED})(g.code)){const w=h.Ta.shift();ml(h).B_(),await dw(h,(()=>h.remoteSyncer.rejectFailedWrite(w.batchId,g))),await nm(h)}})(a,n),pw(a)&&fw(a)}async function $x(a,n){const o=En(a);o.asyncQueue.verifyOperationInProgress(),zt(gc,"RemoteStore received new credentials");const h=Tc(o);o.Ea.add(3),await Sd(o),h&&o.Ra.set("Unknown"),await o.remoteSyncer.handleCredentialChange(n),o.Ea.delete(3),await tm(o)}async function gM(a,n){const o=En(a);n?(o.Ea.delete(2),await tm(o)):n||(o.Ea.add(2),await Sd(o),o.Ra.set("Unknown"))}function Gu(a){return a.ma||(a.ma=(function(o,h,g){const w=En(o);return w.sa(),new eM(h,w.connection,w.authCredentials,w.appCheckCredentials,w.serializer,g)})(a.datastore,a.asyncQueue,{Xo:oM.bind(null,a),t_:aM.bind(null,a),r_:lM.bind(null,a),H_:cM.bind(null,a)}),a.da.push((async n=>{n?(a.ma.B_(),ey(a)?J_(a):a.Ra.set("Unknown")):(await a.ma.stop(),hw(a))}))),a.ma}function ml(a){return a.fa||(a.fa=(function(o,h,g){const w=En(o);return w.sa(),new tM(h,w.connection,w.authCredentials,w.appCheckCredentials,w.serializer,g)})(a.datastore,a.asyncQueue,{Xo:()=>Promise.resolve(),t_:dM.bind(null,a),r_:mM.bind(null,a),ta:pM.bind(null,a),na:fM.bind(null,a)}),a.da.push((async n=>{n?(a.fa.B_(),await nm(a)):(await a.fa.stop(),a.Ta.length>0&&(zt(gc,`Stopping write stream with ${a.Ta.length} pending writes`),a.Ta=[]))}))),a.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty{constructor(n,o,h,g,w){this.asyncQueue=n,this.timerId=o,this.targetTimeMs=h,this.op=g,this.removalCallback=w,this.deferred=new hc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((x=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(n,o,h,g,w){const x=Date.now()+h,c=new ty(n,o,x,g,w);return c.start(h),c}start(n){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),n)}skipDelay(){return this.handleDelayElapsed()}cancel(n){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Gt(ut.CANCELLED,"Operation cancelled"+(n?": "+n:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((n=>this.deferred.resolve(n)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ny(a,n){if(Ia("AsyncQueue",`${n}: ${a}`),qu(a))return new Gt(ut.UNAVAILABLE,`${n}: ${a}`);throw a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{static emptySet(n){return new Cu(n.comparator)}constructor(n){this.comparator=n?(o,h)=>n(o,h)||en.comparator(o.key,h.key):(o,h)=>en.comparator(o.key,h.key),this.keyedMap=td(),this.sortedSet=new Br(this.comparator)}has(n){return this.keyedMap.get(n)!=null}get(n){return this.keyedMap.get(n)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(n){const o=this.keyedMap.get(n);return o?this.sortedSet.indexOf(o):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal(((o,h)=>(n(o),!1)))}add(n){const o=this.delete(n.key);return o.copy(o.keyedMap.insert(n.key,n),o.sortedSet.insert(n,null))}delete(n){const o=this.get(n);return o?this.copy(this.keyedMap.remove(n),this.sortedSet.remove(o)):this}isEqual(n){if(!(n instanceof Cu)||this.size!==n.size)return!1;const o=this.sortedSet.getIterator(),h=n.sortedSet.getIterator();for(;o.hasNext();){const g=o.getNext().key,w=h.getNext().key;if(!g.isEqual(w))return!1}return!0}toString(){const n=[];return this.forEach((o=>{n.push(o.toString())})),n.length===0?"DocumentSet ()":`DocumentSet (
  `+n.join(`  
`)+`
)`}copy(n,o){const h=new Cu;return h.comparator=this.comparator,h.keyedMap=n,h.sortedSet=o,h}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qx{constructor(){this.ga=new Br(en.comparator)}track(n){const o=n.doc.key,h=this.ga.get(o);h?n.type!==0&&h.type===3?this.ga=this.ga.insert(o,n):n.type===3&&h.type!==1?this.ga=this.ga.insert(o,{type:h.type,doc:n.doc}):n.type===2&&h.type===2?this.ga=this.ga.insert(o,{type:2,doc:n.doc}):n.type===2&&h.type===0?this.ga=this.ga.insert(o,{type:0,doc:n.doc}):n.type===1&&h.type===0?this.ga=this.ga.remove(o):n.type===1&&h.type===2?this.ga=this.ga.insert(o,{type:1,doc:h.doc}):n.type===0&&h.type===1?this.ga=this.ga.insert(o,{type:2,doc:n.doc}):un(63341,{Rt:n,pa:h}):this.ga=this.ga.insert(o,n)}ya(){const n=[];return this.ga.inorderTraversal(((o,h)=>{n.push(h)})),n}}class Bu{constructor(n,o,h,g,w,x,c,k,O){this.query=n,this.docs=o,this.oldDocs=h,this.docChanges=g,this.mutatedKeys=w,this.fromCache=x,this.syncStateChanged=c,this.excludesMetadataChanges=k,this.hasCachedResults=O}static fromInitialDocuments(n,o,h,g,w){const x=[];return o.forEach((c=>{x.push({type:0,doc:c})})),new Bu(n,o,Cu.emptySet(o),x,h,g,!0,!1,w)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(n){if(!(this.fromCache===n.fromCache&&this.hasCachedResults===n.hasCachedResults&&this.syncStateChanged===n.syncStateChanged&&this.mutatedKeys.isEqual(n.mutatedKeys)&&Kf(this.query,n.query)&&this.docs.isEqual(n.docs)&&this.oldDocs.isEqual(n.oldDocs)))return!1;const o=this.docChanges,h=n.docChanges;if(o.length!==h.length)return!1;for(let g=0;g<o.length;g++)if(o[g].type!==h[g].type||!o[g].doc.isEqual(h[g].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _M{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((n=>n.Da()))}}class yM{constructor(){this.queries=Gx(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(o,h){const g=En(o),w=g.queries;g.queries=Gx(),w.forEach(((x,c)=>{for(const k of c.Sa)k.onError(h)}))})(this,new Gt(ut.ABORTED,"Firestore shutting down"))}}function Gx(){return new wc((a=>L1(a)),Kf)}async function vM(a,n){const o=En(a);let h=3;const g=n.query;let w=o.queries.get(g);w?!w.ba()&&n.Da()&&(h=2):(w=new _M,h=n.Da()?0:1);try{switch(h){case 0:w.wa=await o.onListen(g,!0);break;case 1:w.wa=await o.onListen(g,!1);break;case 2:await o.onFirstRemoteStoreListen(g)}}catch(x){const c=ny(x,`Initialization of query '${Iu(n.query)}' failed`);return void n.onError(c)}o.queries.set(g,w),w.Sa.push(n),n.va(o.onlineState),w.wa&&n.Fa(w.wa)&&ry(o)}async function xM(a,n){const o=En(a),h=n.query;let g=3;const w=o.queries.get(h);if(w){const x=w.Sa.indexOf(n);x>=0&&(w.Sa.splice(x,1),w.Sa.length===0?g=n.Da()?0:1:!w.ba()&&n.Da()&&(g=2))}switch(g){case 0:return o.queries.delete(h),o.onUnlisten(h,!0);case 1:return o.queries.delete(h),o.onUnlisten(h,!1);case 2:return o.onLastRemoteStoreUnlisten(h);default:return}}function bM(a,n){const o=En(a);let h=!1;for(const g of n){const w=g.query,x=o.queries.get(w);if(x){for(const c of x.Sa)c.Fa(g)&&(h=!0);x.wa=g}}h&&ry(o)}function wM(a,n,o){const h=En(a),g=h.queries.get(n);if(g)for(const w of g.Sa)w.onError(o);h.queries.delete(n)}function ry(a){a.Ca.forEach((n=>{n.next()}))}var m_,Hx;(Hx=m_||(m_={})).Ma="default",Hx.Cache="cache";class TM{constructor(n,o,h){this.query=n,this.xa=o,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=h||{}}Fa(n){if(!this.options.includeMetadataChanges){const h=[];for(const g of n.docChanges)g.type!==3&&h.push(g);n=new Bu(n.query,n.docs,n.oldDocs,h,n.mutatedKeys,n.fromCache,n.syncStateChanged,!0,n.hasCachedResults)}let o=!1;return this.Oa?this.Ba(n)&&(this.xa.next(n),o=!0):this.La(n,this.onlineState)&&(this.ka(n),o=!0),this.Na=n,o}onError(n){this.xa.error(n)}va(n){this.onlineState=n;let o=!1;return this.Na&&!this.Oa&&this.La(this.Na,n)&&(this.ka(this.Na),o=!0),o}La(n,o){if(!n.fromCache||!this.Da())return!0;const h=o!=="Offline";return(!this.options.qa||!h)&&(!n.docs.isEmpty()||n.hasCachedResults||o==="Offline")}Ba(n){if(n.docChanges.length>0)return!0;const o=this.Na&&this.Na.hasPendingWrites!==n.hasPendingWrites;return!(!n.syncStateChanged&&!o)&&this.options.includeMetadataChanges===!0}ka(n){n=Bu.fromInitialDocuments(n.query,n.docs,n.mutatedKeys,n.fromCache,n.hasCachedResults),this.Oa=!0,this.xa.next(n)}Da(){return this.options.source!==m_.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{constructor(n){this.key=n}}class gw{constructor(n){this.key=n}}class EM{constructor(n,o){this.query=n,this.Ya=o,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Un(),this.mutatedKeys=Un(),this.eu=z1(n),this.tu=new Cu(this.eu)}get nu(){return this.Ya}ru(n,o){const h=o?o.iu:new qx,g=o?o.tu:this.tu;let w=o?o.mutatedKeys:this.mutatedKeys,x=g,c=!1;const k=this.query.limitType==="F"&&g.size===this.query.limit?g.last():null,O=this.query.limitType==="L"&&g.size===this.query.limit?g.first():null;if(n.inorderTraversal(((U,Y)=>{const se=g.get(U),xe=Xf(this.query,Y)?Y:null,$e=!!se&&this.mutatedKeys.has(se.key),Ce=!!xe&&(xe.hasLocalMutations||this.mutatedKeys.has(xe.key)&&xe.hasCommittedMutations);let J=!1;se&&xe?se.data.isEqual(xe.data)?$e!==Ce&&(h.track({type:3,doc:xe}),J=!0):this.su(se,xe)||(h.track({type:2,doc:xe}),J=!0,(k&&this.eu(xe,k)>0||O&&this.eu(xe,O)<0)&&(c=!0)):!se&&xe?(h.track({type:0,doc:xe}),J=!0):se&&!xe&&(h.track({type:1,doc:se}),J=!0,(k||O)&&(c=!0)),J&&(xe?(x=x.add(xe),w=Ce?w.add(U):w.delete(U)):(x=x.delete(U),w=w.delete(U)))})),this.query.limit!==null)for(;x.size>this.query.limit;){const U=this.query.limitType==="F"?x.last():x.first();x=x.delete(U.key),w=w.delete(U.key),h.track({type:1,doc:U})}return{tu:x,iu:h,Cs:c,mutatedKeys:w}}su(n,o){return n.hasLocalMutations&&o.hasCommittedMutations&&!o.hasLocalMutations}applyChanges(n,o,h,g){const w=this.tu;this.tu=n.tu,this.mutatedKeys=n.mutatedKeys;const x=n.iu.ya();x.sort(((U,Y)=>(function(xe,$e){const Ce=J=>{switch(J){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return un(20277,{Rt:J})}};return Ce(xe)-Ce($e)})(U.type,Y.type)||this.eu(U.doc,Y.doc))),this.ou(h),g=g??!1;const c=o&&!g?this._u():[],k=this.Xa.size===0&&this.current&&!g?1:0,O=k!==this.Za;return this.Za=k,x.length!==0||O?{snapshot:new Bu(this.query,n.tu,w,x,n.mutatedKeys,k===0,O,!1,!!h&&h.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(n){return this.current&&n==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new qx,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(n){return!this.Ya.has(n)&&!!this.tu.has(n)&&!this.tu.get(n).hasLocalMutations}ou(n){n&&(n.addedDocuments.forEach((o=>this.Ya=this.Ya.add(o))),n.modifiedDocuments.forEach((o=>{})),n.removedDocuments.forEach((o=>this.Ya=this.Ya.delete(o))),this.current=n.current)}_u(){if(!this.current)return[];const n=this.Xa;this.Xa=Un(),this.tu.forEach((h=>{this.uu(h.key)&&(this.Xa=this.Xa.add(h.key))}));const o=[];return n.forEach((h=>{this.Xa.has(h)||o.push(new gw(h))})),this.Xa.forEach((h=>{n.has(h)||o.push(new mw(h))})),o}cu(n){this.Ya=n.Qs,this.Xa=Un();const o=this.ru(n.documents);return this.applyChanges(o,!0)}lu(){return Bu.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const iy="SyncEngine";class IM{constructor(n,o,h){this.query=n,this.targetId=o,this.view=h}}class SM{constructor(n){this.key=n,this.hu=!1}}class AM{constructor(n,o,h,g,w,x){this.localStore=n,this.remoteStore=o,this.eventManager=h,this.sharedClientState=g,this.currentUser=w,this.maxConcurrentLimboResolutions=x,this.Pu={},this.Tu=new wc((c=>L1(c)),Kf),this.Iu=new Map,this.Eu=new Set,this.du=new Br(en.comparator),this.Au=new Map,this.Ru=new W_,this.Vu={},this.mu=new Map,this.fu=Vu.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function PM(a,n,o=!0){const h=ww(a);let g;const w=h.Tu.get(n);return w?(h.sharedClientState.addLocalQueryTarget(w.targetId),g=w.view.lu()):g=await _w(h,n,o,!0),g}async function CM(a,n){const o=ww(a);await _w(o,n,!0,!1)}async function _w(a,n,o,h){const g=await HC(a.localStore,Vo(n)),w=g.targetId,x=a.sharedClientState.addLocalQueryTarget(w,o);let c;return h&&(c=await MM(a,n,w,x==="current",g.resumeToken)),a.isPrimaryClient&&o&&cw(a.remoteStore,g),c}async function MM(a,n,o,h,g){a.pu=(Y,se,xe)=>(async function(Ce,J,Ye,qe){let He=J.view.ru(Ye);He.Cs&&(He=await Nx(Ce.localStore,J.query,!1).then((({documents:he})=>J.view.ru(he,He))));const et=qe&&qe.targetChanges.get(J.targetId),at=qe&&qe.targetMismatches.get(J.targetId)!=null,Qe=J.view.applyChanges(He,Ce.isPrimaryClient,et,at);return Zx(Ce,J.targetId,Qe.au),Qe.snapshot})(a,Y,se,xe);const w=await Nx(a.localStore,n,!0),x=new EM(n,w.Qs),c=x.ru(w.documents),k=Id.createSynthesizedTargetChangeForCurrentChange(o,h&&a.onlineState!=="Offline",g),O=x.applyChanges(c,a.isPrimaryClient,k);Zx(a,o,O.au);const U=new IM(n,o,x);return a.Tu.set(n,U),a.Iu.has(o)?a.Iu.get(o).push(n):a.Iu.set(o,[n]),O.snapshot}async function kM(a,n,o){const h=En(a),g=h.Tu.get(n),w=h.Iu.get(g.targetId);if(w.length>1)return h.Iu.set(g.targetId,w.filter((x=>!Kf(x,n)))),void h.Tu.delete(n);h.isPrimaryClient?(h.sharedClientState.removeLocalQueryTarget(g.targetId),h.sharedClientState.isActiveQueryTarget(g.targetId)||await p_(h.localStore,g.targetId,!1).then((()=>{h.sharedClientState.clearQueryState(g.targetId),o&&Y_(h.remoteStore,g.targetId),g_(h,g.targetId)})).catch($u)):(g_(h,g.targetId),await p_(h.localStore,g.targetId,!0))}async function RM(a,n){const o=En(a),h=o.Tu.get(n),g=o.Iu.get(h.targetId);o.isPrimaryClient&&g.length===1&&(o.sharedClientState.removeLocalQueryTarget(h.targetId),Y_(o.remoteStore,h.targetId))}async function DM(a,n,o){const h=BM(a);try{const g=await(function(x,c){const k=En(x),O=Pr.now(),U=c.reduce(((xe,$e)=>xe.add($e.key)),Un());let Y,se;return k.persistence.runTransaction("Locally write mutations","readwrite",(xe=>{let $e=Sa(),Ce=Un();return k.Ns.getEntries(xe,U).next((J=>{$e=J,$e.forEach(((Ye,qe)=>{qe.isValidDocument()||(Ce=Ce.add(Ye))}))})).next((()=>k.localDocuments.getOverlayedDocuments(xe,$e))).next((J=>{Y=J;const Ye=[];for(const qe of c){const He=GP(qe,Y.get(qe.key).overlayedDocument);He!=null&&Ye.push(new yl(qe.key,He,A1(He.value.mapValue),Bo.exists(!0)))}return k.mutationQueue.addMutationBatch(xe,O,Ye,c)})).next((J=>{se=J;const Ye=J.applyToLocalDocumentSet(Y,Ce);return k.documentOverlayCache.saveOverlays(xe,J.batchId,Ye)}))})).then((()=>({batchId:se.batchId,changes:F1(Y)})))})(h.localStore,n);h.sharedClientState.addPendingMutation(g.batchId),(function(x,c,k){let O=x.Vu[x.currentUser.toKey()];O||(O=new Br(Bn)),O=O.insert(c,k),x.Vu[x.currentUser.toKey()]=O})(h,g.batchId,o),await Ad(h,g.changes),await nm(h.remoteStore)}catch(g){const w=ny(g,"Failed to persist write");o.reject(w)}}async function yw(a,n){const o=En(a);try{const h=await $C(o.localStore,n);n.targetChanges.forEach(((g,w)=>{const x=o.Au.get(w);x&&(ar(g.addedDocuments.size+g.modifiedDocuments.size+g.removedDocuments.size<=1,22616),g.addedDocuments.size>0?x.hu=!0:g.modifiedDocuments.size>0?ar(x.hu,14607):g.removedDocuments.size>0&&(ar(x.hu,42227),x.hu=!1))})),await Ad(o,h,n)}catch(h){await $u(h)}}function Wx(a,n,o){const h=En(a);if(h.isPrimaryClient&&o===0||!h.isPrimaryClient&&o===1){const g=[];h.Tu.forEach(((w,x)=>{const c=x.view.va(n);c.snapshot&&g.push(c.snapshot)})),(function(x,c){const k=En(x);k.onlineState=c;let O=!1;k.queries.forEach(((U,Y)=>{for(const se of Y.Sa)se.va(c)&&(O=!0)})),O&&ry(k)})(h.eventManager,n),g.length&&h.Pu.H_(g),h.onlineState=n,h.isPrimaryClient&&h.sharedClientState.setOnlineState(n)}}async function LM(a,n,o){const h=En(a);h.sharedClientState.updateQueryState(n,"rejected",o);const g=h.Au.get(n),w=g&&g.key;if(w){let x=new Br(en.comparator);x=x.insert(w,Gi.newNoDocument(w,yn.min()));const c=Un().add(w),k=new Jf(yn.min(),new Map,new Br(Bn),x,c);await yw(h,k),h.du=h.du.remove(w),h.Au.delete(n),sy(h)}else await p_(h.localStore,n,!1).then((()=>g_(h,n,o))).catch($u)}async function zM(a,n){const o=En(a),h=n.batch.batchId;try{const g=await jC(o.localStore,n);xw(o,h,null),vw(o,h),o.sharedClientState.updateMutationState(h,"acknowledged"),await Ad(o,g)}catch(g){await $u(g)}}async function OM(a,n,o){const h=En(a);try{const g=await(function(x,c){const k=En(x);return k.persistence.runTransaction("Reject batch","readwrite-primary",(O=>{let U;return k.mutationQueue.lookupMutationBatch(O,c).next((Y=>(ar(Y!==null,37113),U=Y.keys(),k.mutationQueue.removeMutationBatch(O,Y)))).next((()=>k.mutationQueue.performConsistencyCheck(O))).next((()=>k.documentOverlayCache.removeOverlaysForBatchId(O,U,c))).next((()=>k.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(O,U))).next((()=>k.localDocuments.getDocuments(O,U)))}))})(h.localStore,n);xw(h,n,o),vw(h,n),h.sharedClientState.updateMutationState(n,"rejected",o),await Ad(h,g)}catch(g){await $u(g)}}function vw(a,n){(a.mu.get(n)||[]).forEach((o=>{o.resolve()})),a.mu.delete(n)}function xw(a,n,o){const h=En(a);let g=h.Vu[h.currentUser.toKey()];if(g){const w=g.get(n);w&&(o?w.reject(o):w.resolve(),g=g.remove(n)),h.Vu[h.currentUser.toKey()]=g}}function g_(a,n,o=null){a.sharedClientState.removeLocalQueryTarget(n);for(const h of a.Iu.get(n))a.Tu.delete(h),o&&a.Pu.yu(h,o);a.Iu.delete(n),a.isPrimaryClient&&a.Ru.jr(n).forEach((h=>{a.Ru.containsKey(h)||bw(a,h)}))}function bw(a,n){a.Eu.delete(n.path.canonicalString());const o=a.du.get(n);o!==null&&(Y_(a.remoteStore,o),a.du=a.du.remove(n),a.Au.delete(o),sy(a))}function Zx(a,n,o){for(const h of o)h instanceof mw?(a.Ru.addReference(h.key,n),FM(a,h)):h instanceof gw?(zt(iy,"Document no longer in limbo: "+h.key),a.Ru.removeReference(h.key,n),a.Ru.containsKey(h.key)||bw(a,h.key)):un(19791,{wu:h})}function FM(a,n){const o=n.key,h=o.path.canonicalString();a.du.get(o)||a.Eu.has(h)||(zt(iy,"New document in limbo: "+o),a.Eu.add(h),sy(a))}function sy(a){for(;a.Eu.size>0&&a.du.size<a.maxConcurrentLimboResolutions;){const n=a.Eu.values().next().value;a.Eu.delete(n);const o=new en(Vr.fromString(n)),h=a.fu.next();a.Au.set(h,new SM(o)),a.du=a.du.insert(o,h),cw(a.remoteStore,new sl(Vo(j_(o.path)),h,"TargetPurposeLimboResolution",Gf.ce))}}async function Ad(a,n,o){const h=En(a),g=[],w=[],x=[];h.Tu.isEmpty()||(h.Tu.forEach(((c,k)=>{x.push(h.pu(k,n,o).then((O=>{var U;if((O||o)&&h.isPrimaryClient){const Y=O?!O.fromCache:(U=o==null?void 0:o.targetChanges.get(k.targetId))==null?void 0:U.current;h.sharedClientState.updateQueryState(k.targetId,Y?"current":"not-current")}if(O){g.push(O);const Y=K_.As(k.targetId,O);w.push(Y)}})))})),await Promise.all(x),h.Pu.H_(g),await(async function(k,O){const U=En(k);try{await U.persistence.runTransaction("notifyLocalViewChanges","readwrite",(Y=>st.forEach(O,(se=>st.forEach(se.Es,(xe=>U.persistence.referenceDelegate.addReference(Y,se.targetId,xe))).next((()=>st.forEach(se.ds,(xe=>U.persistence.referenceDelegate.removeReference(Y,se.targetId,xe)))))))))}catch(Y){if(!qu(Y))throw Y;zt(X_,"Failed to update sequence numbers: "+Y)}for(const Y of O){const se=Y.targetId;if(!Y.fromCache){const xe=U.Ms.get(se),$e=xe.snapshotVersion,Ce=xe.withLastLimboFreeSnapshotVersion($e);U.Ms=U.Ms.insert(se,Ce)}}})(h.localStore,w))}async function NM(a,n){const o=En(a);if(!o.currentUser.isEqual(n)){zt(iy,"User change. New user:",n.toKey());const h=await sw(o.localStore,n);o.currentUser=n,(function(w,x){w.mu.forEach((c=>{c.forEach((k=>{k.reject(new Gt(ut.CANCELLED,x))}))})),w.mu.clear()})(o,"'waitForPendingWrites' promise is rejected due to a user change."),o.sharedClientState.handleUserChange(n,h.removedBatchIds,h.addedBatchIds),await Ad(o,h.Ls)}}function VM(a,n){const o=En(a),h=o.Au.get(n);if(h&&h.hu)return Un().add(h.key);{let g=Un();const w=o.Iu.get(n);if(!w)return g;for(const x of w){const c=o.Tu.get(x);g=g.unionWith(c.view.nu)}return g}}function ww(a){const n=En(a);return n.remoteStore.remoteSyncer.applyRemoteEvent=yw.bind(null,n),n.remoteStore.remoteSyncer.getRemoteKeysForTarget=VM.bind(null,n),n.remoteStore.remoteSyncer.rejectListen=LM.bind(null,n),n.Pu.H_=bM.bind(null,n.eventManager),n.Pu.yu=wM.bind(null,n.eventManager),n}function BM(a){const n=En(a);return n.remoteStore.remoteSyncer.applySuccessfulWrite=zM.bind(null,n),n.remoteStore.remoteSyncer.rejectFailedWrite=OM.bind(null,n),n}class Mf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(n){this.serializer=em(n.databaseInfo.databaseId),this.sharedClientState=this.Du(n),this.persistence=this.Cu(n),await this.persistence.start(),this.localStore=this.vu(n),this.gcScheduler=this.Fu(n,this.localStore),this.indexBackfillerScheduler=this.Mu(n,this.localStore)}Fu(n,o){return null}Mu(n,o){return null}vu(n){return UC(this.persistence,new NC,n.initialUser,this.serializer)}Cu(n){return new iw(Z_.mi,this.serializer)}Du(n){return new ZC}async terminate(){var n,o;(n=this.gcScheduler)==null||n.stop(),(o=this.indexBackfillerScheduler)==null||o.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Mf.provider={build:()=>new Mf};class UM extends Mf{constructor(n){super(),this.cacheSizeBytes=n}Fu(n,o){ar(this.persistence.referenceDelegate instanceof Pf,46915);const h=this.persistence.referenceDelegate.garbageCollector;return new TC(h,n.asyncQueue,o)}Cu(n){const o=this.cacheSizeBytes!==void 0?bs.withCacheSize(this.cacheSizeBytes):bs.DEFAULT;return new iw((h=>Pf.mi(h,o)),this.serializer)}}class __{async initialize(n,o){this.localStore||(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(o),this.remoteStore=this.createRemoteStore(o),this.eventManager=this.createEventManager(o),this.syncEngine=this.createSyncEngine(o,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=h=>Wx(this.syncEngine,h,1),this.remoteStore.remoteSyncer.handleCredentialChange=NM.bind(null,this.syncEngine),await gM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(n){return(function(){return new yM})()}createDatastore(n){const o=em(n.databaseInfo.databaseId),h=(function(w){return new JC(w)})(n.databaseInfo);return(function(w,x,c,k){return new rM(w,x,c,k)})(n.authCredentials,n.appCheckCredentials,h,o)}createRemoteStore(n){return(function(h,g,w,x,c){return new sM(h,g,w,x,c)})(this.localStore,this.datastore,n.asyncQueue,(o=>Wx(this.syncEngine,o,0)),(function(){return Ux.v()?new Ux:new KC})())}createSyncEngine(n,o){return(function(g,w,x,c,k,O,U){const Y=new AM(g,w,x,c,k,O);return U&&(Y.gu=!0),Y})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,n.initialUser,n.maxConcurrentLimboResolutions,o)}async terminate(){var n,o;await(async function(g){const w=En(g);zt(gc,"RemoteStore shutting down."),w.Ea.add(5),await Sd(w),w.Aa.shutdown(),w.Ra.set("Unknown")})(this.remoteStore),(n=this.datastore)==null||n.terminate(),(o=this.eventManager)==null||o.terminate()}}__.provider={build:()=>new __};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jM{constructor(n){this.observer=n,this.muted=!1}next(n){this.muted||this.observer.next&&this.Ou(this.observer.next,n)}error(n){this.muted||(this.observer.error?this.Ou(this.observer.error,n):Ia("Uncaught Error in snapshot listener:",n.toString()))}Nu(){this.muted=!0}Ou(n,o){setTimeout((()=>{this.muted||n(o)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gl="FirestoreClient";class $M{constructor(n,o,h,g,w){this.authCredentials=n,this.appCheckCredentials=o,this.asyncQueue=h,this.databaseInfo=g,this.user=qi.UNAUTHENTICATED,this.clientId=z_.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=w,this.authCredentials.start(h,(async x=>{zt(gl,"Received user=",x.uid),await this.authCredentialListener(x),this.user=x})),this.appCheckCredentials.start(h,(x=>(zt(gl,"Received new app check token=",x),this.appCheckCredentialListener(x,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(n){this.authCredentialListener=n}setAppCheckTokenChangeListener(n){this.appCheckCredentialListener=n}terminate(){this.asyncQueue.enterRestrictedMode();const n=new hc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(o){const h=ny(o,"Failed to shutdown persistence");n.reject(h)}})),n.promise}}async function jg(a,n){a.asyncQueue.verifyOperationInProgress(),zt(gl,"Initializing OfflineComponentProvider");const o=a.configuration;await n.initialize(o);let h=o.initialUser;a.setCredentialChangeListener((async g=>{h.isEqual(g)||(await sw(n.localStore,g),h=g)})),n.persistence.setDatabaseDeletedListener((()=>a.terminate())),a._offlineComponents=n}async function Kx(a,n){a.asyncQueue.verifyOperationInProgress();const o=await qM(a);zt(gl,"Initializing OnlineComponentProvider"),await n.initialize(o,a.configuration),a.setCredentialChangeListener((h=>$x(n.remoteStore,h))),a.setAppCheckTokenChangeListener(((h,g)=>$x(n.remoteStore,g))),a._onlineComponents=n}async function qM(a){if(!a._offlineComponents)if(a._uninitializedComponentsProvider){zt(gl,"Using user provided OfflineComponentProvider");try{await jg(a,a._uninitializedComponentsProvider._offline)}catch(n){const o=n;if(!(function(g){return g.name==="FirebaseError"?g.code===ut.FAILED_PRECONDITION||g.code===ut.UNIMPLEMENTED:!(typeof DOMException<"u"&&g instanceof DOMException)||g.code===22||g.code===20||g.code===11})(o))throw o;zu("Error using user provided cache. Falling back to memory cache: "+o),await jg(a,new Mf)}}else zt(gl,"Using default OfflineComponentProvider"),await jg(a,new UM(void 0));return a._offlineComponents}async function Tw(a){return a._onlineComponents||(a._uninitializedComponentsProvider?(zt(gl,"Using user provided OnlineComponentProvider"),await Kx(a,a._uninitializedComponentsProvider._online)):(zt(gl,"Using default OnlineComponentProvider"),await Kx(a,new __))),a._onlineComponents}function GM(a){return Tw(a).then((n=>n.syncEngine))}async function Xx(a){const n=await Tw(a),o=n.eventManager;return o.onListen=PM.bind(null,n.syncEngine),o.onUnlisten=kM.bind(null,n.syncEngine),o.onFirstRemoteStoreListen=CM.bind(null,n.syncEngine),o.onLastRemoteStoreUnlisten=RM.bind(null,n.syncEngine),o}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ew(a){const n={};return a.timeoutSeconds!==void 0&&(n.timeoutSeconds=a.timeoutSeconds),n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yx=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iw="firestore.googleapis.com",Qx=!0;class Jx{constructor(n){if(n.host===void 0){if(n.ssl!==void 0)throw new Gt(ut.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Iw,this.ssl=Qx}else this.host=n.host,this.ssl=n.ssl??Qx;if(this.isUsingEmulator=n.emulatorOptions!==void 0,this.credentials=n.credentials,this.ignoreUndefinedProperties=!!n.ignoreUndefinedProperties,this.localCache=n.localCache,n.cacheSizeBytes===void 0)this.cacheSizeBytes=rw;else{if(n.cacheSizeBytes!==-1&&n.cacheSizeBytes<bC)throw new Gt(ut.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=n.cacheSizeBytes}iP("experimentalForceLongPolling",n.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",n.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!n.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:n.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!n.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ew(n.experimentalLongPollingOptions??{}),(function(h){if(h.timeoutSeconds!==void 0){if(isNaN(h.timeoutSeconds))throw new Gt(ut.INVALID_ARGUMENT,`invalid long polling timeout: ${h.timeoutSeconds} (must not be NaN)`);if(h.timeoutSeconds<5)throw new Gt(ut.INVALID_ARGUMENT,`invalid long polling timeout: ${h.timeoutSeconds} (minimum allowed value is 5)`);if(h.timeoutSeconds>30)throw new Gt(ut.INVALID_ARGUMENT,`invalid long polling timeout: ${h.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!n.useFetchStreams}isEqual(n){return this.host===n.host&&this.ssl===n.ssl&&this.credentials===n.credentials&&this.cacheSizeBytes===n.cacheSizeBytes&&this.experimentalForceLongPolling===n.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===n.experimentalAutoDetectLongPolling&&(function(h,g){return h.timeoutSeconds===g.timeoutSeconds})(this.experimentalLongPollingOptions,n.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===n.ignoreUndefinedProperties&&this.useFetchStreams===n.useFetchStreams}}class oy{constructor(n,o,h,g){this._authCredentials=n,this._appCheckCredentials=o,this._databaseId=h,this._app=g,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jx({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Gt(ut.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(n){if(this._settingsFrozen)throw new Gt(ut.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jx(n),this._emulatorOptions=n.emulatorOptions||{},n.credentials!==void 0&&(this._authCredentials=(function(h){if(!h)return new WA;switch(h.type){case"firstParty":return new YA(h.sessionIndex||"0",h.iamToken||null,h.authTokenFactory||null);case"provider":return h.client;default:throw new Gt(ut.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(n.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(o){const h=Yx.get(o);h&&(zt("ComponentProvider","Removing Datastore"),Yx.delete(o),h.terminate())})(this),Promise.resolve()}}function HM(a,n,o,h={}){var O;a=cl(a,oy);const g=xc(n),w=a._getSettings(),x={...w,emulatorOptions:a._getEmulatorOptions()},c=`${n}:${o}`;g&&(C_(`https://${c}`),M_("Firestore",!0)),w.host!==Iw&&w.host!==c&&zu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const k={...w,host:c,ssl:g,emulatorOptions:h};if(!pc(k,x)&&(a._setSettings(k),h.mockUserToken)){let U,Y;if(typeof h.mockUserToken=="string")U=h.mockUserToken,Y=qi.MOCK_USER;else{U=r1(h.mockUserToken,(O=a._app)==null?void 0:O.options.projectId);const se=h.mockUserToken.sub||h.mockUserToken.user_id;if(!se)throw new Gt(ut.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");Y=new qi(se)}a._authCredentials=new ZA(new g1(U,Y))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(n,o,h){this.converter=o,this._query=h,this.type="query",this.firestore=n}withConverter(n){return new rm(this.firestore,n,this._query)}}class mi{constructor(n,o,h){this.converter=o,this._key=h,this.type="document",this.firestore=n}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yd(this.firestore,this.converter,this._key.path.popLast())}withConverter(n){return new mi(this.firestore,n,this._key)}toJSON(){return{type:mi._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(n,o,h){if(Td(o,mi._jsonSchema))return new mi(n,h||null,new en(Vr.fromString(o.referencePath)))}}mi._jsonSchemaVersion="firestore/documentReference/1.0",mi._jsonSchema={type:li("string",mi._jsonSchemaVersion),referencePath:li("string")};class yd extends rm{constructor(n,o,h){super(n,o,j_(h)),this._path=h,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const n=this._path.popLast();return n.isEmpty()?null:new mi(this.firestore,null,new en(n))}withConverter(n){return new yd(this.firestore,n,this._path)}}function ay(a,n,...o){if(a=_i(a),arguments.length===1&&(n=z_.newId()),rP("doc","path",n),a instanceof oy){const h=Vr.fromString(n,...o);return dx(h),new mi(a,null,new en(h))}{if(!(a instanceof mi||a instanceof yd))throw new Gt(ut.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const h=a._path.child(Vr.fromString(n,...o));return dx(h),new mi(a.firestore,a instanceof yd?a.converter:null,new en(h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eb="AsyncQueue";class tb{constructor(n=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new aw(this,"async_queue_retry"),this._c=()=>{const h=Ug();h&&zt(eb,"Visibility state changed to "+h.visibilityState),this.M_.w_()},this.ac=n;const o=Ug();o&&typeof o.addEventListener=="function"&&o.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(n){this.enqueue(n)}enqueueAndForgetEvenWhileRestricted(n){this.uc(),this.cc(n)}enterRestrictedMode(n){if(!this.ec){this.ec=!0,this.sc=n||!1;const o=Ug();o&&typeof o.removeEventListener=="function"&&o.removeEventListener("visibilitychange",this._c)}}enqueue(n){if(this.uc(),this.ec)return new Promise((()=>{}));const o=new hc;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(n().then(o.resolve,o.reject),o.promise))).then((()=>o.promise))}enqueueRetryable(n){this.enqueueAndForget((()=>(this.Xu.push(n),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(n){if(!qu(n))throw n;zt(eb,"Operation failed with retryable error: "+n)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(n){const o=this.ac.then((()=>(this.rc=!0,n().catch((h=>{throw this.nc=h,this.rc=!1,Ia("INTERNAL UNHANDLED ERROR: ",nb(h)),h})).then((h=>(this.rc=!1,h))))));return this.ac=o,o}enqueueAfterDelay(n,o,h){this.uc(),this.oc.indexOf(n)>-1&&(o=0);const g=ty.createAndSchedule(this,n,o,h,(w=>this.hc(w)));return this.tc.push(g),g}uc(){this.nc&&un(47125,{Pc:nb(this.nc)})}verifyOperationInProgress(){}async Tc(){let n;do n=this.ac,await n;while(n!==this.ac)}Ic(n){for(const o of this.tc)if(o.timerId===n)return!0;return!1}Ec(n){return this.Tc().then((()=>{this.tc.sort(((o,h)=>o.targetTimeMs-h.targetTimeMs));for(const o of this.tc)if(o.skipDelay(),n!=="all"&&o.timerId===n)break;return this.Tc()}))}dc(n){this.oc.push(n)}hc(n){const o=this.tc.indexOf(n);this.tc.splice(o,1)}}function nb(a){let n=a.message||"";return a.stack&&(n=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rb(a){return(function(o,h){if(typeof o!="object"||o===null)return!1;const g=o;for(const w of h)if(w in g&&typeof g[w]=="function")return!0;return!1})(a,["next","error","complete"])}class vd extends oy{constructor(n,o,h,g){super(n,o,h,g),this.type="firestore",this._queue=new tb,this._persistenceKey=(g==null?void 0:g.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const n=this._firestoreClient.terminate();this._queue=new tb(n),this._firestoreClient=void 0,await n}}}function WM(a,n){const o=typeof a=="object"?a:D_(),h=typeof a=="string"?a:bf,g=qf(o,"firestore").getImmediate({identifier:h});if(!g._initialized){const w=e1("firestore");w&&HM(g,...w)}return g}function Sw(a){if(a._terminated)throw new Gt(ut.FAILED_PRECONDITION,"The client has already been terminated.");return a._firestoreClient||ZM(a),a._firestoreClient}function ZM(a){var h,g,w;const n=a._freezeSettings(),o=(function(c,k,O,U){return new mP(c,k,O,U.host,U.ssl,U.experimentalForceLongPolling,U.experimentalAutoDetectLongPolling,Ew(U.experimentalLongPollingOptions),U.useFetchStreams,U.isUsingEmulator)})(a._databaseId,((h=a._app)==null?void 0:h.options.appId)||"",a._persistenceKey,n);a._componentsProvider||(g=n.localCache)!=null&&g._offlineComponentProvider&&((w=n.localCache)!=null&&w._onlineComponentProvider)&&(a._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),a._firestoreClient=new $M(a._authCredentials,a._appCheckCredentials,a._queue,o,a._componentsProvider&&(function(c){const k=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(k),_online:k}})(a._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(n){this._byteString=n}static fromBase64String(n){try{return new Js(Ri.fromBase64String(n))}catch(o){throw new Gt(ut.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+o)}}static fromUint8Array(n){return new Js(Ri.fromUint8Array(n))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(n){return this._byteString.isEqual(n._byteString)}toJSON(){return{type:Js._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(n){if(Td(n,Js._jsonSchema))return Js.fromBase64String(n.bytes)}}Js._jsonSchemaVersion="firestore/bytes/1.0",Js._jsonSchema={type:li("string",Js._jsonSchemaVersion),bytes:li("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class im{constructor(...n){for(let o=0;o<n.length;++o)if(n[o].length===0)throw new Gt(ut.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Mi(n)}isEqual(n){return this._internalPath.isEqual(n._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(n){this._methodName=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(n,o){if(!isFinite(n)||n<-90||n>90)throw new Gt(ut.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+n);if(!isFinite(o)||o<-180||o>180)throw new Gt(ut.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+o);this._lat=n,this._long=o}get latitude(){return this._lat}get longitude(){return this._long}isEqual(n){return this._lat===n._lat&&this._long===n._long}_compareTo(n){return Bn(this._lat,n._lat)||Bn(this._long,n._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:jo._jsonSchemaVersion}}static fromJSON(n){if(Td(n,jo._jsonSchema))return new jo(n.latitude,n.longitude)}}jo._jsonSchemaVersion="firestore/geoPoint/1.0",jo._jsonSchema={type:li("string",jo._jsonSchemaVersion),latitude:li("number"),longitude:li("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(n){this._values=(n||[]).map((o=>o))}toArray(){return this._values.map((n=>n))}isEqual(n){return(function(h,g){if(h.length!==g.length)return!1;for(let w=0;w<h.length;++w)if(h[w]!==g[w])return!1;return!0})(this._values,n._values)}toJSON(){return{type:$o._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(n){if(Td(n,$o._jsonSchema)){if(Array.isArray(n.vectorValues)&&n.vectorValues.every((o=>typeof o=="number")))return new $o(n.vectorValues);throw new Gt(ut.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$o._jsonSchemaVersion="firestore/vectorValue/1.0",$o._jsonSchema={type:li("string",$o._jsonSchemaVersion),vectorValues:li("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KM=/^__.*__$/;class XM{constructor(n,o,h){this.data=n,this.fieldMask=o,this.fieldTransforms=h}toMutation(n,o){return this.fieldMask!==null?new yl(n,this.data,this.fieldMask,o,this.fieldTransforms):new Ed(n,this.data,o,this.fieldTransforms)}}class Aw{constructor(n,o,h){this.data=n,this.fieldMask=o,this.fieldTransforms=h}toMutation(n,o){return new yl(n,this.data,this.fieldMask,o,this.fieldTransforms)}}function Pw(a){switch(a){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw un(40011,{Ac:a})}}class cy{constructor(n,o,h,g,w,x){this.settings=n,this.databaseId=o,this.serializer=h,this.ignoreUndefinedProperties=g,w===void 0&&this.Rc(),this.fieldTransforms=w||[],this.fieldMask=x||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(n){return new cy({...this.settings,...n},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(n){var g;const o=(g=this.path)==null?void 0:g.child(n),h=this.Vc({path:o,fc:!1});return h.gc(n),h}yc(n){var g;const o=(g=this.path)==null?void 0:g.child(n),h=this.Vc({path:o,fc:!1});return h.Rc(),h}wc(n){return this.Vc({path:void 0,fc:!0})}Sc(n){return kf(n,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(n){return this.fieldMask.find((o=>n.isPrefixOf(o)))!==void 0||this.fieldTransforms.find((o=>n.isPrefixOf(o.field)))!==void 0}Rc(){if(this.path)for(let n=0;n<this.path.length;n++)this.gc(this.path.get(n))}gc(n){if(n.length===0)throw this.Sc("Document fields must not be empty");if(Pw(this.Ac)&&KM.test(n))throw this.Sc('Document fields cannot begin and end with "__"')}}class YM{constructor(n,o,h){this.databaseId=n,this.ignoreUndefinedProperties=o,this.serializer=h||em(n)}Cc(n,o,h,g=!1){return new cy({Ac:n,methodName:o,Dc:h,path:Mi.emptyPath(),fc:!1,bc:g},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Cw(a){const n=a._freezeSettings(),o=em(a._databaseId);return new YM(a._databaseId,!!n.ignoreUndefinedProperties,o)}function QM(a,n,o,h,g,w={}){const x=a.Cc(w.merge||w.mergeFields?2:0,n,o,g);uy("Data must be an object, but it was:",x,h);const c=Mw(h,x);let k,O;if(w.merge)k=new Ns(x.fieldMask),O=x.fieldTransforms;else if(w.mergeFields){const U=[];for(const Y of w.mergeFields){const se=y_(n,Y,o);if(!x.contains(se))throw new Gt(ut.INVALID_ARGUMENT,`Field '${se}' is specified in your field mask but missing from your input data.`);Rw(U,se)||U.push(se)}k=new Ns(U),O=x.fieldTransforms.filter((Y=>k.covers(Y.field)))}else k=null,O=x.fieldTransforms;return new XM(new Ts(c),k,O)}class sm extends ly{_toFieldTransform(n){if(n.Ac!==2)throw n.Ac===1?n.Sc(`${this._methodName}() can only appear at the top level of your update data`):n.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return n.fieldMask.push(n.path),null}isEqual(n){return n instanceof sm}}function JM(a,n,o,h){const g=a.Cc(1,n,o);uy("Data must be an object, but it was:",g,h);const w=[],x=Ts.empty();_l(h,((k,O)=>{const U=hy(n,k,o);O=_i(O);const Y=g.yc(U);if(O instanceof sm)w.push(U);else{const se=om(O,Y);se!=null&&(w.push(U),x.set(U,se))}}));const c=new Ns(w);return new Aw(x,c,g.fieldTransforms)}function ek(a,n,o,h,g,w){const x=a.Cc(1,n,o),c=[y_(n,h,o)],k=[g];if(w.length%2!=0)throw new Gt(ut.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let se=0;se<w.length;se+=2)c.push(y_(n,w[se])),k.push(w[se+1]);const O=[],U=Ts.empty();for(let se=c.length-1;se>=0;--se)if(!Rw(O,c[se])){const xe=c[se];let $e=k[se];$e=_i($e);const Ce=x.yc(xe);if($e instanceof sm)O.push(xe);else{const J=om($e,Ce);J!=null&&(O.push(xe),U.set(xe,J))}}const Y=new Ns(O);return new Aw(U,Y,x.fieldTransforms)}function om(a,n){if(kw(a=_i(a)))return uy("Unsupported field value:",n,a),Mw(a,n);if(a instanceof ly)return(function(h,g){if(!Pw(g.Ac))throw g.Sc(`${h._methodName}() can only be used with update() and set()`);if(!g.path)throw g.Sc(`${h._methodName}() is not currently supported inside arrays`);const w=h._toFieldTransform(g);w&&g.fieldTransforms.push(w)})(a,n),null;if(a===void 0&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),a instanceof Array){if(n.settings.fc&&n.Ac!==4)throw n.Sc("Nested arrays are not supported");return(function(h,g){const w=[];let x=0;for(const c of h){let k=om(c,g.wc(x));k==null&&(k={nullValue:"NULL_VALUE"}),w.push(k),x++}return{arrayValue:{values:w}}})(a,n)}return(function(h,g){if((h=_i(h))===null)return{nullValue:"NULL_VALUE"};if(typeof h=="number")return VP(g.serializer,h);if(typeof h=="boolean")return{booleanValue:h};if(typeof h=="string")return{stringValue:h};if(h instanceof Date){const w=Pr.fromDate(h);return{timestampValue:Af(g.serializer,w)}}if(h instanceof Pr){const w=new Pr(h.seconds,1e3*Math.floor(h.nanoseconds/1e3));return{timestampValue:Af(g.serializer,w)}}if(h instanceof jo)return{geoPointValue:{latitude:h.latitude,longitude:h.longitude}};if(h instanceof Js)return{bytesValue:X1(g.serializer,h._byteString)};if(h instanceof mi){const w=g.databaseId,x=h.firestore._databaseId;if(!x.isEqual(w))throw g.Sc(`Document reference is for database ${x.projectId}/${x.database} but should be for database ${w.projectId}/${w.database}`);return{referenceValue:H_(h.firestore._databaseId||g.databaseId,h._key.path)}}if(h instanceof $o)return(function(x,c){return{mapValue:{fields:{[I1]:{stringValue:S1},[wf]:{arrayValue:{values:x.toArray().map((O=>{if(typeof O!="number")throw c.Sc("VectorValues must only contain numeric values.");return $_(c.serializer,O)}))}}}}}})(h,g);throw g.Sc(`Unsupported field value: ${O_(h)}`)})(a,n)}function Mw(a,n){const o={};return v1(a)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):_l(a,((h,g)=>{const w=om(g,n.mc(h));w!=null&&(o[h]=w)})),{mapValue:{fields:o}}}function kw(a){return!(typeof a!="object"||a===null||a instanceof Array||a instanceof Date||a instanceof Pr||a instanceof jo||a instanceof Js||a instanceof mi||a instanceof ly||a instanceof $o)}function uy(a,n,o){if(!kw(o)||!_1(o)){const h=O_(o);throw h==="an object"?n.Sc(a+" a custom object"):n.Sc(a+" "+h)}}function y_(a,n,o){if((n=_i(n))instanceof im)return n._internalPath;if(typeof n=="string")return hy(a,n);throw kf("Field path arguments must be of type string or ",a,!1,void 0,o)}const tk=new RegExp("[~\\*/\\[\\]]");function hy(a,n,o){if(n.search(tk)>=0)throw kf(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,a,!1,void 0,o);try{return new im(...n.split("."))._internalPath}catch{throw kf(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,a,!1,void 0,o)}}function kf(a,n,o,h,g){const w=h&&!h.isEmpty(),x=g!==void 0;let c=`Function ${n}() called with invalid data`;o&&(c+=" (via `toFirestore()`)"),c+=". ";let k="";return(w||x)&&(k+=" (found",w&&(k+=` in field ${h}`),x&&(k+=` in document ${g}`),k+=")"),new Gt(ut.INVALID_ARGUMENT,c+a+k)}function Rw(a,n){return a.some((o=>o.isEqual(n)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw{constructor(n,o,h,g,w){this._firestore=n,this._userDataWriter=o,this._key=h,this._document=g,this._converter=w}get id(){return this._key.path.lastSegment()}get ref(){return new mi(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const n=new nk(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(n)}return this._userDataWriter.convertValue(this._document.data.value)}}get(n){if(this._document){const o=this._document.data.field(Lw("DocumentSnapshot.get",n));if(o!==null)return this._userDataWriter.convertValue(o)}}}class nk extends Dw{data(){return super.data()}}function Lw(a,n){return typeof n=="string"?hy(a,n):n instanceof im?n._internalPath:n._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rk(a){if(a.limitType==="L"&&a.explicitOrderBy.length===0)throw new Gt(ut.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ik{convertValue(n,o="none"){switch(fl(n)){case 0:return null;case 1:return n.booleanValue;case 2:return Zr(n.integerValue||n.doubleValue);case 3:return this.convertTimestamp(n.timestampValue);case 4:return this.convertServerTimestamp(n,o);case 5:return n.stringValue;case 6:return this.convertBytes(pl(n.bytesValue));case 7:return this.convertReference(n.referenceValue);case 8:return this.convertGeoPoint(n.geoPointValue);case 9:return this.convertArray(n.arrayValue,o);case 11:return this.convertObject(n.mapValue,o);case 10:return this.convertVectorValue(n.mapValue);default:throw un(62114,{value:n})}}convertObject(n,o){return this.convertObjectMap(n.fields,o)}convertObjectMap(n,o="none"){const h={};return _l(n,((g,w)=>{h[g]=this.convertValue(w,o)})),h}convertVectorValue(n){var h,g,w;const o=(w=(g=(h=n.fields)==null?void 0:h[wf].arrayValue)==null?void 0:g.values)==null?void 0:w.map((x=>Zr(x.doubleValue)));return new $o(o)}convertGeoPoint(n){return new jo(Zr(n.latitude),Zr(n.longitude))}convertArray(n,o){return(n.values||[]).map((h=>this.convertValue(h,o)))}convertServerTimestamp(n,o){switch(o){case"previous":const h=Wf(n);return h==null?null:this.convertValue(h,o);case"estimate":return this.convertTimestamp(pd(n));default:return null}}convertTimestamp(n){const o=dl(n);return new Pr(o.seconds,o.nanos)}convertDocumentKey(n,o){const h=Vr.fromString(n);ar(nw(h),9688,{name:n});const g=new fd(h.get(1),h.get(3)),w=new en(h.popFirst(5));return g.isEqual(o)||Ia(`Document ${w} contains a document reference within a different database (${g.projectId}/${g.database}) which is not supported. It will be treated as a reference in the current database (${o.projectId}/${o.database}) instead.`),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sk(a,n,o){let h;return h=a?o&&(o.merge||o.mergeFields)?a.toFirestore(n,o):a.toFirestore(n):n,h}class rd{constructor(n,o){this.hasPendingWrites=n,this.fromCache=o}isEqual(n){return this.hasPendingWrites===n.hasPendingWrites&&this.fromCache===n.fromCache}}class dc extends Dw{constructor(n,o,h,g,w,x){super(n,o,h,g,x),this._firestore=n,this._firestoreImpl=n,this.metadata=w}exists(){return super.exists()}data(n={}){if(this._document){if(this._converter){const o=new hf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(o,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}}get(n,o={}){if(this._document){const h=this._document.data.field(Lw("DocumentSnapshot.get",n));if(h!==null)return this._userDataWriter.convertValue(h,o.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Gt(ut.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const n=this._document,o={};return o.type=dc._jsonSchemaVersion,o.bundle="",o.bundleSource="DocumentSnapshot",o.bundleName=this._key.toString(),!n||!n.isValidDocument()||!n.isFoundDocument()?o:(this._userDataWriter.convertObjectMap(n.data.value.mapValue.fields,"previous"),o.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),o)}}dc._jsonSchemaVersion="firestore/documentSnapshot/1.0",dc._jsonSchema={type:li("string",dc._jsonSchemaVersion),bundleSource:li("string","DocumentSnapshot"),bundleName:li("string"),bundle:li("string")};class hf extends dc{data(n={}){return super.data(n)}}class Mu{constructor(n,o,h,g){this._firestore=n,this._userDataWriter=o,this._snapshot=g,this.metadata=new rd(g.hasPendingWrites,g.fromCache),this.query=h}get docs(){const n=[];return this.forEach((o=>n.push(o))),n}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(n,o){this._snapshot.docs.forEach((h=>{n.call(o,new hf(this._firestore,this._userDataWriter,h.key,h,new rd(this._snapshot.mutatedKeys.has(h.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(n={}){const o=!!n.includeMetadataChanges;if(o&&this._snapshot.excludesMetadataChanges)throw new Gt(ut.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===o||(this._cachedChanges=(function(g,w){if(g._snapshot.oldDocs.isEmpty()){let x=0;return g._snapshot.docChanges.map((c=>{const k=new hf(g._firestore,g._userDataWriter,c.doc.key,c.doc,new rd(g._snapshot.mutatedKeys.has(c.doc.key),g._snapshot.fromCache),g.query.converter);return c.doc,{type:"added",doc:k,oldIndex:-1,newIndex:x++}}))}{let x=g._snapshot.oldDocs;return g._snapshot.docChanges.filter((c=>w||c.type!==3)).map((c=>{const k=new hf(g._firestore,g._userDataWriter,c.doc.key,c.doc,new rd(g._snapshot.mutatedKeys.has(c.doc.key),g._snapshot.fromCache),g.query.converter);let O=-1,U=-1;return c.type!==0&&(O=x.indexOf(c.doc.key),x=x.delete(c.doc.key)),c.type!==1&&(x=x.add(c.doc),U=x.indexOf(c.doc.key)),{type:ok(c.type),doc:k,oldIndex:O,newIndex:U}}))}})(this,o),this._cachedChangesIncludeMetadataChanges=o),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Gt(ut.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const n={};n.type=Mu._jsonSchemaVersion,n.bundleSource="QuerySnapshot",n.bundleName=z_.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const o=[],h=[],g=[];return this.docs.forEach((w=>{w._document!==null&&(o.push(w._document),h.push(this._userDataWriter.convertObjectMap(w._document.data.value.mapValue.fields,"previous")),g.push(w.ref.path))})),n.bundle=(this._firestore,this.query._query,n.bundleName,"NOT SUPPORTED"),n}}function ok(a){switch(a){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return un(61501,{type:a})}}Mu._jsonSchemaVersion="firestore/querySnapshot/1.0",Mu._jsonSchema={type:li("string",Mu._jsonSchemaVersion),bundleSource:li("string","QuerySnapshot"),bundleName:li("string"),bundle:li("string")};class zw extends ik{constructor(n){super(),this.firestore=n}convertBytes(n){return new Js(n)}convertReference(n){const o=this.convertDocumentKey(n,this.firestore._databaseId);return new mi(this.firestore,null,o)}}function ak(a,n,o){a=cl(a,mi);const h=cl(a.firestore,vd),g=sk(a.converter,n,o);return Ow(h,[QM(Cw(h),"setDoc",a._key,g,a.converter!==null,o).toMutation(a._key,Bo.none())])}function lk(a,n,o,...h){a=cl(a,mi);const g=cl(a.firestore,vd),w=Cw(g);let x;return x=typeof(n=_i(n))=="string"||n instanceof im?ek(w,"updateDoc",a._key,n,o,h):JM(w,"updateDoc",a._key,n),Ow(g,[x.toMutation(a._key,Bo.exists(!0))])}function ck(a,...n){var k,O,U;a=_i(a);let o={includeMetadataChanges:!1,source:"default"},h=0;typeof n[h]!="object"||rb(n[h])||(o=n[h++]);const g={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(rb(n[h])){const Y=n[h];n[h]=(k=Y.next)==null?void 0:k.bind(Y),n[h+1]=(O=Y.error)==null?void 0:O.bind(Y),n[h+2]=(U=Y.complete)==null?void 0:U.bind(Y)}let w,x,c;if(a instanceof mi)x=cl(a.firestore,vd),c=j_(a._key.path),w={next:Y=>{n[h]&&n[h](uk(x,a,Y))},error:n[h+1],complete:n[h+2]};else{const Y=cl(a,rm);x=cl(Y.firestore,vd),c=Y._query;const se=new zw(x);w={next:xe=>{n[h]&&n[h](new Mu(x,se,Y,xe))},error:n[h+1],complete:n[h+2]},rk(a._query)}return(function(se,xe,$e,Ce){const J=new jM(Ce),Ye=new TM(xe,J,$e);return se.asyncQueue.enqueueAndForget((async()=>vM(await Xx(se),Ye))),()=>{J.Nu(),se.asyncQueue.enqueueAndForget((async()=>xM(await Xx(se),Ye)))}})(Sw(x),c,g,w)}function Ow(a,n){return(function(h,g){const w=new hc;return h.asyncQueue.enqueueAndForget((async()=>DM(await GM(h),g,w))),w.promise})(Sw(a),n)}function uk(a,n,o){const h=o.docs.get(n._key),g=new zw(a);return new dc(a,g,n._key,h,new rd(o.hasPendingWrites,o.fromCache),n.converter)}(function(n,o=!0){(function(g){ju=g})(bc),fc(new ul("firestore",((h,{instanceIdentifier:g,options:w})=>{const x=h.getProvider("app").getImmediate(),c=new vd(new KA(h.getProvider("auth-internal")),new QA(x,h.getProvider("app-check-internal")),(function(O,U){if(!Object.prototype.hasOwnProperty.apply(O.options,["projectId"]))throw new Gt(ut.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new fd(O.options.projectId,U)})(x,g),x);return w={useFetchStreams:o,...w},c._setSettings(w),c}),"PUBLIC").setMultipleInstances(!0)),No(lx,cx,n),No(lx,cx,"esm2020")})();var hk="firebase",dk="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */No(hk,dk,"app");function Fw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const pk=Fw,Nw=new bd("auth","Firebase",Fw());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rf=new k_("@firebase/auth");function fk(a,...n){Rf.logLevel<=Vn.WARN&&Rf.warn(`Auth (${bc}): ${a}`,...n)}function df(a,...n){Rf.logLevel<=Vn.ERROR&&Rf.error(`Auth (${bc}): ${a}`,...n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eo(a,...n){throw py(a,...n)}function yo(a,...n){return py(a,...n)}function dy(a,n,o){const h={...pk(),[n]:o};return new bd("auth","Firebase",h).create(n,{appName:a.name})}function Ta(a){return dy(a,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function mk(a,n,o){const h=o;if(!(n instanceof h))throw h.name!==n.constructor.name&&eo(a,"argument-error"),dy(a,"argument-error",`Type of ${n.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function py(a,...n){if(typeof a!="string"){const o=n[0],h=[...n.slice(1)];return h[0]&&(h[0].appName=a.name),a._errorFactory.create(o,...h)}return Nw.create(a,...n)}function cn(a,n,...o){if(!a)throw py(n,...o)}function ba(a){const n="INTERNAL ASSERTION FAILED: "+a;throw df(n),new Error(n)}function Aa(a,n){a||ba(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v_(){var a;return typeof self<"u"&&((a=self.location)==null?void 0:a.href)||""}function gk(){return ib()==="http:"||ib()==="https:"}function ib(){var a;return typeof self<"u"&&((a=self.location)==null?void 0:a.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _k(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(gk()||SS()||"connection"in navigator)?navigator.onLine:!0}function yk(){if(typeof navigator>"u")return null;const a=navigator;return a.languages&&a.languages[0]||a.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(n,o){this.shortDelay=n,this.longDelay=o,Aa(o>n,"Short delay should be less than long delay!"),this.isMobile=TS()||AS()}get(){return _k()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fy(a,n){Aa(a.emulator,"Emulator should always be set here");const{url:o}=a.emulator;return n?`${o}${n.startsWith("/")?n.slice(1):n}`:o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{static initialize(n,o,h){this.fetchImpl=n,o&&(this.headersImpl=o),h&&(this.responseImpl=h)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ba("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ba("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ba("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xk=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],bk=new Pd(3e4,6e4);function Pa(a,n){return a.tenantId&&!n.tenantId?{...n,tenantId:a.tenantId}:n}async function Ko(a,n,o,h,g={}){return Bw(a,g,async()=>{let w={},x={};h&&(n==="GET"?x=h:w={body:JSON.stringify(h)});const c=wd({key:a.config.apiKey,...x}).slice(1),k=await a._getAdditionalHeaders();k["Content-Type"]="application/json",a.languageCode&&(k["X-Firebase-Locale"]=a.languageCode);const O={method:n,headers:k,...w};return IS()||(O.referrerPolicy="no-referrer"),a.emulatorConfig&&xc(a.emulatorConfig.host)&&(O.credentials="include"),Vw.fetch()(await Uw(a,a.config.apiHost,o,c),O)})}async function Bw(a,n,o){a._canInitEmulator=!1;const h={...vk,...n};try{const g=new Tk(a),w=await Promise.race([o(),g.promise]);g.clearNetworkTimeout();const x=await w.json();if("needConfirmation"in x)throw Jp(a,"account-exists-with-different-credential",x);if(w.ok&&!("errorMessage"in x))return x;{const c=w.ok?x.errorMessage:x.error.message,[k,O]=c.split(" : ");if(k==="FEDERATED_USER_ID_ALREADY_LINKED")throw Jp(a,"credential-already-in-use",x);if(k==="EMAIL_EXISTS")throw Jp(a,"email-already-in-use",x);if(k==="USER_DISABLED")throw Jp(a,"user-disabled",x);const U=h[k]||k.toLowerCase().replace(/[_\s]+/g,"-");if(O)throw dy(a,U,O);eo(a,U)}}catch(g){if(g instanceof Zo)throw g;eo(a,"network-request-failed",{message:String(g)})}}async function Cd(a,n,o,h,g={}){const w=await Ko(a,n,o,h,g);return"mfaPendingCredential"in w&&eo(a,"multi-factor-auth-required",{_serverResponse:w}),w}async function Uw(a,n,o,h){const g=`${n}${o}?${h}`,w=a,x=w.config.emulator?fy(a.config,g):`${a.config.apiScheme}://${g}`;return xk.includes(o)&&(await w._persistenceManagerAvailable,w._getPersistenceType()==="COOKIE")?w._getPersistence()._getFinalTarget(x).toString():x}function wk(a){switch(a){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Tk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(n){this.auth=n,this.timer=null,this.promise=new Promise((o,h)=>{this.timer=setTimeout(()=>h(yo(this.auth,"network-request-failed")),bk.get())})}}function Jp(a,n,o){const h={appName:a.name};o.email&&(h.email=o.email),o.phoneNumber&&(h.phoneNumber=o.phoneNumber);const g=yo(a,n,h);return g.customData._tokenResponse=o,g}function sb(a){return a!==void 0&&a.enterprise!==void 0}class Ek{constructor(n){if(this.siteKey="",this.recaptchaEnforcementState=[],n.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=n.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=n.recaptchaEnforcementState}getProviderEnforcementState(n){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const o of this.recaptchaEnforcementState)if(o.provider&&o.provider===n)return wk(o.enforcementState);return null}isProviderEnabled(n){return this.getProviderEnforcementState(n)==="ENFORCE"||this.getProviderEnforcementState(n)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Ik(a,n){return Ko(a,"GET","/v2/recaptchaConfig",Pa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sk(a,n){return Ko(a,"POST","/v1/accounts:delete",n)}async function Df(a,n){return Ko(a,"POST","/v1/accounts:lookup",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cd(a){if(a)try{const n=new Date(Number(a));if(!isNaN(n.getTime()))return n.toUTCString()}catch{}}async function Ak(a,n=!1){const o=_i(a),h=await o.getIdToken(n),g=my(h);cn(g&&g.exp&&g.auth_time&&g.iat,o.auth,"internal-error");const w=typeof g.firebase=="object"?g.firebase:void 0,x=w==null?void 0:w.sign_in_provider;return{claims:g,token:h,authTime:cd($g(g.auth_time)),issuedAtTime:cd($g(g.iat)),expirationTime:cd($g(g.exp)),signInProvider:x||null,signInSecondFactor:(w==null?void 0:w.sign_in_second_factor)||null}}function $g(a){return Number(a)*1e3}function my(a){const[n,o,h]=a.split(".");if(n===void 0||o===void 0||h===void 0)return df("JWT malformed, contained fewer than 3 sections"),null;try{const g=Qb(o);return g?JSON.parse(g):(df("Failed to decode base64 JWT payload"),null)}catch(g){return df("Caught error parsing JWT payload as JSON",g==null?void 0:g.toString()),null}}function ob(a){const n=my(a);return cn(n,"internal-error"),cn(typeof n.exp<"u","internal-error"),cn(typeof n.iat<"u","internal-error"),Number(n.exp)-Number(n.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uu(a,n,o=!1){if(o)return n;try{return await n}catch(h){throw h instanceof Zo&&Pk(h)&&a.auth.currentUser===a&&await a.auth.signOut(),h}}function Pk({code:a}){return a==="auth/user-disabled"||a==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(n){this.user=n,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(n){if(n){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const h=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,h)}}schedule(n=!1){if(!this.isRunning)return;const o=this.getInterval(n);this.timerId=setTimeout(async()=>{await this.iteration()},o)}async iteration(){try{await this.user.getIdToken(!0)}catch(n){(n==null?void 0:n.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(n,o){this.createdAt=n,this.lastLoginAt=o,this._initializeTime()}_initializeTime(){this.lastSignInTime=cd(this.lastLoginAt),this.creationTime=cd(this.createdAt)}_copy(n){this.createdAt=n.createdAt,this.lastLoginAt=n.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lf(a){var Y;const n=a.auth,o=await a.getIdToken(),h=await Uu(a,Df(n,{idToken:o}));cn(h==null?void 0:h.users.length,n,"internal-error");const g=h.users[0];a._notifyReloadListener(g);const w=(Y=g.providerUserInfo)!=null&&Y.length?jw(g.providerUserInfo):[],x=kk(a.providerData,w),c=a.isAnonymous,k=!(a.email&&g.passwordHash)&&!(x!=null&&x.length),O=c?k:!1,U={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:x,metadata:new x_(g.createdAt,g.lastLoginAt),isAnonymous:O};Object.assign(a,U)}async function Mk(a){const n=_i(a);await Lf(n),await n.auth._persistUserIfCurrent(n),n.auth._notifyListenersIfCurrent(n)}function kk(a,n){return[...a.filter(h=>!n.some(g=>g.providerId===h.providerId)),...n]}function jw(a){return a.map(({providerId:n,...o})=>({providerId:n,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rk(a,n){const o=await Bw(a,{},async()=>{const h=wd({grant_type:"refresh_token",refresh_token:n}).slice(1),{tokenApiHost:g,apiKey:w}=a.config,x=await Uw(a,g,"/v1/token",`key=${w}`),c=await a._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";const k={method:"POST",headers:c,body:h};return a.emulatorConfig&&xc(a.emulatorConfig.host)&&(k.credentials="include"),Vw.fetch()(x,k)});return{accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token}}async function Dk(a,n){return Ko(a,"POST","/v2/accounts:revokeToken",Pa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(n){cn(n.idToken,"internal-error"),cn(typeof n.idToken<"u","internal-error"),cn(typeof n.refreshToken<"u","internal-error");const o="expiresIn"in n&&typeof n.expiresIn<"u"?Number(n.expiresIn):ob(n.idToken);this.updateTokensAndExpiration(n.idToken,n.refreshToken,o)}updateFromIdToken(n){cn(n.length!==0,"internal-error");const o=ob(n);this.updateTokensAndExpiration(n,null,o)}async getToken(n,o=!1){return!o&&this.accessToken&&!this.isExpired?this.accessToken:(cn(this.refreshToken,n,"user-token-expired"),this.refreshToken?(await this.refresh(n,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(n,o){const{accessToken:h,refreshToken:g,expiresIn:w}=await Rk(n,o);this.updateTokensAndExpiration(h,g,Number(w))}updateTokensAndExpiration(n,o,h){this.refreshToken=o||null,this.accessToken=n||null,this.expirationTime=Date.now()+h*1e3}static fromJSON(n,o){const{refreshToken:h,accessToken:g,expirationTime:w}=o,x=new ku;return h&&(cn(typeof h=="string","internal-error",{appName:n}),x.refreshToken=h),g&&(cn(typeof g=="string","internal-error",{appName:n}),x.accessToken=g),w&&(cn(typeof w=="number","internal-error",{appName:n}),x.expirationTime=w),x}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(n){this.accessToken=n.accessToken,this.refreshToken=n.refreshToken,this.expirationTime=n.expirationTime}_clone(){return Object.assign(new ku,this.toJSON())}_performRefresh(){return ba("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ya(a,n){cn(typeof a=="string"||typeof a>"u","internal-error",{appName:n})}class mo{constructor({uid:n,auth:o,stsTokenManager:h,...g}){this.providerId="firebase",this.proactiveRefresh=new Ck(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=o,this.stsTokenManager=h,this.accessToken=h.accessToken,this.displayName=g.displayName||null,this.email=g.email||null,this.emailVerified=g.emailVerified||!1,this.phoneNumber=g.phoneNumber||null,this.photoURL=g.photoURL||null,this.isAnonymous=g.isAnonymous||!1,this.tenantId=g.tenantId||null,this.providerData=g.providerData?[...g.providerData]:[],this.metadata=new x_(g.createdAt||void 0,g.lastLoginAt||void 0)}async getIdToken(n){const o=await Uu(this,this.stsTokenManager.getToken(this.auth,n));return cn(o,this.auth,"internal-error"),this.accessToken!==o&&(this.accessToken=o,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),o}getIdTokenResult(n){return Ak(this,n)}reload(){return Mk(this)}_assign(n){this!==n&&(cn(this.uid===n.uid,this.auth,"internal-error"),this.displayName=n.displayName,this.photoURL=n.photoURL,this.email=n.email,this.emailVerified=n.emailVerified,this.phoneNumber=n.phoneNumber,this.isAnonymous=n.isAnonymous,this.tenantId=n.tenantId,this.providerData=n.providerData.map(o=>({...o})),this.metadata._copy(n.metadata),this.stsTokenManager._assign(n.stsTokenManager))}_clone(n){const o=new mo({...this,auth:n,stsTokenManager:this.stsTokenManager._clone()});return o.metadata._copy(this.metadata),o}_onReload(n){cn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=n,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(n){this.reloadListener?this.reloadListener(n):this.reloadUserInfo=n}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(n,o=!1){let h=!1;n.idToken&&n.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(n),h=!0),o&&await Lf(this),await this.auth._persistUserIfCurrent(this),h&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ws(this.auth.app))return Promise.reject(Ta(this.auth));const n=await this.getIdToken();return await Uu(this,Sk(this.auth,{idToken:n})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(n=>({...n})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(n,o){const h=o.displayName??void 0,g=o.email??void 0,w=o.phoneNumber??void 0,x=o.photoURL??void 0,c=o.tenantId??void 0,k=o._redirectEventId??void 0,O=o.createdAt??void 0,U=o.lastLoginAt??void 0,{uid:Y,emailVerified:se,isAnonymous:xe,providerData:$e,stsTokenManager:Ce}=o;cn(Y&&Ce,n,"internal-error");const J=ku.fromJSON(this.name,Ce);cn(typeof Y=="string",n,"internal-error"),Ya(h,n.name),Ya(g,n.name),cn(typeof se=="boolean",n,"internal-error"),cn(typeof xe=="boolean",n,"internal-error"),Ya(w,n.name),Ya(x,n.name),Ya(c,n.name),Ya(k,n.name),Ya(O,n.name),Ya(U,n.name);const Ye=new mo({uid:Y,auth:n,email:g,emailVerified:se,displayName:h,isAnonymous:xe,photoURL:x,phoneNumber:w,tenantId:c,stsTokenManager:J,createdAt:O,lastLoginAt:U});return $e&&Array.isArray($e)&&(Ye.providerData=$e.map(qe=>({...qe}))),k&&(Ye._redirectEventId=k),Ye}static async _fromIdTokenResponse(n,o,h=!1){const g=new ku;g.updateFromServerResponse(o);const w=new mo({uid:o.localId,auth:n,stsTokenManager:g,isAnonymous:h});return await Lf(w),w}static async _fromGetAccountInfoResponse(n,o,h){const g=o.users[0];cn(g.localId!==void 0,"internal-error");const w=g.providerUserInfo!==void 0?jw(g.providerUserInfo):[],x=!(g.email&&g.passwordHash)&&!(w!=null&&w.length),c=new ku;c.updateFromIdToken(h);const k=new mo({uid:g.localId,auth:n,stsTokenManager:c,isAnonymous:x}),O={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:w,metadata:new x_(g.createdAt,g.lastLoginAt),isAnonymous:!(g.email&&g.passwordHash)&&!(w!=null&&w.length)};return Object.assign(k,O),k}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ab=new Map;function wa(a){Aa(a instanceof Function,"Expected a class definition");let n=ab.get(a);return n?(Aa(n instanceof a,"Instance stored in cache mismatched with class"),n):(n=new a,ab.set(a,n),n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(n,o){this.storage[n]=o}async _get(n){const o=this.storage[n];return o===void 0?null:o}async _remove(n){delete this.storage[n]}_addListener(n,o){}_removeListener(n,o){}}$w.type="NONE";const lb=$w;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pf(a,n,o){return`firebase:${a}:${n}:${o}`}class Ru{constructor(n,o,h){this.persistence=n,this.auth=o,this.userKey=h;const{config:g,name:w}=this.auth;this.fullUserKey=pf(this.userKey,g.apiKey,w),this.fullPersistenceKey=pf("persistence",g.apiKey,w),this.boundEventHandler=o._onStorageEvent.bind(o),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(n){return this.persistence._set(this.fullUserKey,n.toJSON())}async getCurrentUser(){const n=await this.persistence._get(this.fullUserKey);if(!n)return null;if(typeof n=="string"){const o=await Df(this.auth,{idToken:n}).catch(()=>{});return o?mo._fromGetAccountInfoResponse(this.auth,o,n):null}return mo._fromJSON(this.auth,n)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(n){if(this.persistence===n)return;const o=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=n,o)return this.setCurrentUser(o)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(n,o,h="authUser"){if(!o.length)return new Ru(wa(lb),n,h);const g=(await Promise.all(o.map(async O=>{if(await O._isAvailable())return O}))).filter(O=>O);let w=g[0]||wa(lb);const x=pf(h,n.config.apiKey,n.name);let c=null;for(const O of o)try{const U=await O._get(x);if(U){let Y;if(typeof U=="string"){const se=await Df(n,{idToken:U}).catch(()=>{});if(!se)break;Y=await mo._fromGetAccountInfoResponse(n,se,U)}else Y=mo._fromJSON(n,U);O!==w&&(c=Y),w=O;break}}catch{}const k=g.filter(O=>O._shouldAllowMigration);return!w._shouldAllowMigration||!k.length?new Ru(w,n,h):(w=k[0],c&&await w._set(x,c.toJSON()),await Promise.all(o.map(async O=>{if(O!==w)try{await O._remove(x)}catch{}})),new Ru(w,n,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cb(a){const n=a.toLowerCase();if(n.includes("opera/")||n.includes("opr/")||n.includes("opios/"))return"Opera";if(Ww(n))return"IEMobile";if(n.includes("msie")||n.includes("trident/"))return"IE";if(n.includes("edge/"))return"Edge";if(qw(n))return"Firefox";if(n.includes("silk/"))return"Silk";if(Kw(n))return"Blackberry";if(Xw(n))return"Webos";if(Gw(n))return"Safari";if((n.includes("chrome/")||Hw(n))&&!n.includes("edge/"))return"Chrome";if(Zw(n))return"Android";{const o=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,h=a.match(o);if((h==null?void 0:h.length)===2)return h[1]}return"Other"}function qw(a=Hi()){return/firefox\//i.test(a)}function Gw(a=Hi()){const n=a.toLowerCase();return n.includes("safari/")&&!n.includes("chrome/")&&!n.includes("crios/")&&!n.includes("android")}function Hw(a=Hi()){return/crios\//i.test(a)}function Ww(a=Hi()){return/iemobile/i.test(a)}function Zw(a=Hi()){return/android/i.test(a)}function Kw(a=Hi()){return/blackberry/i.test(a)}function Xw(a=Hi()){return/webos/i.test(a)}function gy(a=Hi()){return/iphone|ipad|ipod/i.test(a)||/macintosh/i.test(a)&&/mobile/i.test(a)}function Lk(a=Hi()){var n;return gy(a)&&!!((n=window.navigator)!=null&&n.standalone)}function zk(){return PS()&&document.documentMode===10}function Yw(a=Hi()){return gy(a)||Zw(a)||Xw(a)||Kw(a)||/windows phone/i.test(a)||Ww(a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qw(a,n=[]){let o;switch(a){case"Browser":o=cb(Hi());break;case"Worker":o=`${cb(Hi())}-${a}`;break;default:o=a}const h=n.length?n.join(","):"FirebaseCore-web";return`${o}/JsCore/${bc}/${h}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ok{constructor(n){this.auth=n,this.queue=[]}pushCallback(n,o){const h=w=>new Promise((x,c)=>{try{const k=n(w);x(k)}catch(k){c(k)}});h.onAbort=o,this.queue.push(h);const g=this.queue.length-1;return()=>{this.queue[g]=()=>Promise.resolve()}}async runMiddleware(n){if(this.auth.currentUser===n)return;const o=[];try{for(const h of this.queue)await h(n),h.onAbort&&o.push(h.onAbort)}catch(h){o.reverse();for(const g of o)try{g()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:h==null?void 0:h.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fk(a,n={}){return Ko(a,"GET","/v2/passwordPolicy",Pa(a,n))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk=6;class Vk{constructor(n){var h;const o=n.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=o.minPasswordLength??Nk,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=n.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((h=n.allowedNonAlphanumericCharacters)==null?void 0:h.join(""))??"",this.forceUpgradeOnSignin=n.forceUpgradeOnSignin??!1,this.schemaVersion=n.schemaVersion}validatePassword(n){const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(n,o),this.validatePasswordCharacterOptions(n,o),o.isValid&&(o.isValid=o.meetsMinPasswordLength??!0),o.isValid&&(o.isValid=o.meetsMaxPasswordLength??!0),o.isValid&&(o.isValid=o.containsLowercaseLetter??!0),o.isValid&&(o.isValid=o.containsUppercaseLetter??!0),o.isValid&&(o.isValid=o.containsNumericCharacter??!0),o.isValid&&(o.isValid=o.containsNonAlphanumericCharacter??!0),o}validatePasswordLengthOptions(n,o){const h=this.customStrengthOptions.minPasswordLength,g=this.customStrengthOptions.maxPasswordLength;h&&(o.meetsMinPasswordLength=n.length>=h),g&&(o.meetsMaxPasswordLength=n.length<=g)}validatePasswordCharacterOptions(n,o){this.updatePasswordCharacterOptionsStatuses(o,!1,!1,!1,!1);let h;for(let g=0;g<n.length;g++)h=n.charAt(g),this.updatePasswordCharacterOptionsStatuses(o,h>="a"&&h<="z",h>="A"&&h<="Z",h>="0"&&h<="9",this.allowedNonAlphanumericCharacters.includes(h))}updatePasswordCharacterOptionsStatuses(n,o,h,g,w){this.customStrengthOptions.containsLowercaseLetter&&(n.containsLowercaseLetter||(n.containsLowercaseLetter=o)),this.customStrengthOptions.containsUppercaseLetter&&(n.containsUppercaseLetter||(n.containsUppercaseLetter=h)),this.customStrengthOptions.containsNumericCharacter&&(n.containsNumericCharacter||(n.containsNumericCharacter=g)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(n.containsNonAlphanumericCharacter||(n.containsNonAlphanumericCharacter=w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk{constructor(n,o,h,g){this.app=n,this.heartbeatServiceProvider=o,this.appCheckServiceProvider=h,this.config=g,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ub(this),this.idTokenSubscription=new ub(this),this.beforeStateQueue=new Ok(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Nw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=n.name,this.clientVersion=g.sdkClientVersion,this._persistenceManagerAvailable=new Promise(w=>this._resolvePersistenceManagerAvailable=w)}_initializeWithPersistence(n,o){return o&&(this._popupRedirectResolver=wa(o)),this._initializationPromise=this.queue(async()=>{var h,g,w;if(!this._deleted&&(this.persistenceManager=await Ru.create(this,n),(h=this._resolvePersistenceManagerAvailable)==null||h.call(this),!this._deleted)){if((g=this._popupRedirectResolver)!=null&&g._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(o),this.lastNotifiedUid=((w=this.currentUser)==null?void 0:w.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const n=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!n)){if(this.currentUser&&n&&this.currentUser.uid===n.uid){this._currentUser._assign(n),await this.currentUser.getIdToken();return}await this._updateCurrentUser(n,!0)}}async initializeCurrentUserFromIdToken(n){try{const o=await Df(this,{idToken:n}),h=await mo._fromGetAccountInfoResponse(this,o,n);await this.directlySetCurrentUser(h)}catch(o){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",o),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(n){var w;if(ws(this.app)){const x=this.app.settings.authIdToken;return x?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(x).then(c,c))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let h=o,g=!1;if(n&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const x=(w=this.redirectUser)==null?void 0:w._redirectEventId,c=h==null?void 0:h._redirectEventId,k=await this.tryRedirectSignIn(n);(!x||x===c)&&(k!=null&&k.user)&&(h=k.user,g=!0)}if(!h)return this.directlySetCurrentUser(null);if(!h._redirectEventId){if(g)try{await this.beforeStateQueue.runMiddleware(h)}catch(x){h=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(x))}return h?this.reloadAndSetCurrentUserOrClear(h):this.directlySetCurrentUser(null)}return cn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===h._redirectEventId?this.directlySetCurrentUser(h):this.reloadAndSetCurrentUserOrClear(h)}async tryRedirectSignIn(n){let o=null;try{o=await this._popupRedirectResolver._completeRedirectFn(this,n,!0)}catch{await this._setRedirectUser(null)}return o}async reloadAndSetCurrentUserOrClear(n){try{await Lf(n)}catch(o){if((o==null?void 0:o.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(n)}useDeviceLanguage(){this.languageCode=yk()}async _delete(){this._deleted=!0}async updateCurrentUser(n){if(ws(this.app))return Promise.reject(Ta(this));const o=n?_i(n):null;return o&&cn(o.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(o&&o._clone(this))}async _updateCurrentUser(n,o=!1){if(!this._deleted)return n&&cn(this.tenantId===n.tenantId,this,"tenant-id-mismatch"),o||await this.beforeStateQueue.runMiddleware(n),this.queue(async()=>{await this.directlySetCurrentUser(n),this.notifyAuthListeners()})}async signOut(){return ws(this.app)?Promise.reject(Ta(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(n){return ws(this.app)?Promise.reject(Ta(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(wa(n))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(n){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const o=this._getPasswordPolicyInternal();return o.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):o.validatePassword(n)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const n=await Fk(this),o=new Vk(n);this.tenantId===null?this._projectPasswordPolicy=o:this._tenantPasswordPolicies[this.tenantId]=o}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(n){this._errorFactory=new bd("auth","Firebase",n())}onAuthStateChanged(n,o,h){return this.registerStateListener(this.authStateSubscription,n,o,h)}beforeAuthStateChanged(n,o){return this.beforeStateQueue.pushCallback(n,o)}onIdTokenChanged(n,o,h){return this.registerStateListener(this.idTokenSubscription,n,o,h)}authStateReady(){return new Promise((n,o)=>{if(this.currentUser)n();else{const h=this.onAuthStateChanged(()=>{h(),n()},o)}})}async revokeAccessToken(n){if(this.currentUser){const o=await this.currentUser.getIdToken(),h={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:n,idToken:o};this.tenantId!=null&&(h.tenantId=this.tenantId),await Dk(this,h)}}toJSON(){var n;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(n=this._currentUser)==null?void 0:n.toJSON()}}async _setRedirectUser(n,o){const h=await this.getOrInitRedirectPersistenceManager(o);return n===null?h.removeCurrentUser():h.setCurrentUser(n)}async getOrInitRedirectPersistenceManager(n){if(!this.redirectPersistenceManager){const o=n&&wa(n)||this._popupRedirectResolver;cn(o,this,"argument-error"),this.redirectPersistenceManager=await Ru.create(this,[wa(o._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(n){var o,h;return this._isInitialized&&await this.queue(async()=>{}),((o=this._currentUser)==null?void 0:o._redirectEventId)===n?this._currentUser:((h=this.redirectUser)==null?void 0:h._redirectEventId)===n?this.redirectUser:null}async _persistUserIfCurrent(n){if(n===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(n))}_notifyListenersIfCurrent(n){n===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=((o=this.currentUser)==null?void 0:o.uid)??null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(n,o,h,g){if(this._deleted)return()=>{};const w=typeof o=="function"?o:o.next.bind(o);let x=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(cn(c,this,"internal-error"),c.then(()=>{x||w(this.currentUser)}),typeof o=="function"){const k=n.addObserver(o,h,g);return()=>{x=!0,k()}}else{const k=n.addObserver(o);return()=>{x=!0,k()}}}async directlySetCurrentUser(n){this.currentUser&&this.currentUser!==n&&this._currentUser._stopProactiveRefresh(),n&&this.isProactiveRefreshEnabled&&n._startProactiveRefresh(),this.currentUser=n,n?await this.assertedPersistence.setCurrentUser(n):await this.assertedPersistence.removeCurrentUser()}queue(n){return this.operations=this.operations.then(n,n),this.operations}get assertedPersistence(){return cn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(n){!n||this.frameworks.includes(n)||(this.frameworks.push(n),this.frameworks.sort(),this.clientVersion=Qw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var g;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const o=await((g=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:g.getHeartbeatsHeader());o&&(n["X-Firebase-Client"]=o);const h=await this._getAppCheckToken();return h&&(n["X-Firebase-AppCheck"]=h),n}async _getAppCheckToken(){var o;if(ws(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((o=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:o.getToken());return n!=null&&n.error&&fk(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Ca(a){return _i(a)}class ub{constructor(n){this.auth=n,this.observer=null,this.addObserver=OS(o=>this.observer=o)}get next(){return cn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let am={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Uk(a){am=a}function Jw(a){return am.loadJS(a)}function jk(){return am.recaptchaEnterpriseScript}function $k(){return am.gapiScript}function qk(a){return`__${a}${Math.floor(Math.random()*1e6)}`}class Gk{constructor(){this.enterprise=new Hk}ready(n){n()}execute(n,o){return Promise.resolve("token")}render(n,o){return""}}class Hk{ready(n){n()}execute(n,o){return Promise.resolve("token")}render(n,o){return""}}const Wk="recaptcha-enterprise",eT="NO_RECAPTCHA";class Zk{constructor(n){this.type=Wk,this.auth=Ca(n)}async verify(n="verify",o=!1){async function h(w){if(!o){if(w.tenantId==null&&w._agentRecaptchaConfig!=null)return w._agentRecaptchaConfig.siteKey;if(w.tenantId!=null&&w._tenantRecaptchaConfigs[w.tenantId]!==void 0)return w._tenantRecaptchaConfigs[w.tenantId].siteKey}return new Promise(async(x,c)=>{Ik(w,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(k=>{if(k.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const O=new Ek(k);return w.tenantId==null?w._agentRecaptchaConfig=O:w._tenantRecaptchaConfigs[w.tenantId]=O,x(O.siteKey)}}).catch(k=>{c(k)})})}function g(w,x,c){const k=window.grecaptcha;sb(k)?k.enterprise.ready(()=>{k.enterprise.execute(w,{action:n}).then(O=>{x(O)}).catch(()=>{x(eT)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Gk().execute("siteKey",{action:"verify"}):new Promise((w,x)=>{h(this.auth).then(c=>{if(!o&&sb(window.grecaptcha))g(c,w,x);else{if(typeof window>"u"){x(new Error("RecaptchaVerifier is only supported in browser"));return}let k=jk();k.length!==0&&(k+=c),Jw(k).then(()=>{g(c,w,x)}).catch(O=>{x(O)})}}).catch(c=>{x(c)})})}}async function hb(a,n,o,h=!1,g=!1){const w=new Zk(a);let x;if(g)x=eT;else try{x=await w.verify(o)}catch{x=await w.verify(o,!0)}const c={...n};if(o==="mfaSmsEnrollment"||o==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in c){const k=c.phoneEnrollmentInfo.phoneNumber,O=c.phoneEnrollmentInfo.recaptchaToken;Object.assign(c,{phoneEnrollmentInfo:{phoneNumber:k,recaptchaToken:O,captchaResponse:x,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in c){const k=c.phoneSignInInfo.recaptchaToken;Object.assign(c,{phoneSignInInfo:{recaptchaToken:k,captchaResponse:x,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return c}return h?Object.assign(c,{captchaResp:x}):Object.assign(c,{captchaResponse:x}),Object.assign(c,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(c,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),c}async function zf(a,n,o,h,g){var w;if((w=a._getRecaptchaConfig())!=null&&w.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const x=await hb(a,n,o,o==="getOobCode");return h(a,x)}else return h(a,n).catch(async x=>{if(x.code==="auth/missing-recaptcha-token"){console.log(`${o} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await hb(a,n,o,o==="getOobCode");return h(a,c)}else return Promise.reject(x)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kk(a,n){const o=qf(a,"auth");if(o.isInitialized()){const g=o.getImmediate(),w=o.getOptions();if(pc(w,n??{}))return g;eo(g,"already-initialized")}return o.initialize({options:n})}function Xk(a,n){const o=(n==null?void 0:n.persistence)||[],h=(Array.isArray(o)?o:[o]).map(wa);n!=null&&n.errorMap&&a._updateErrorMap(n.errorMap),a._initializeWithPersistence(h,n==null?void 0:n.popupRedirectResolver)}function Yk(a,n,o){const h=Ca(a);cn(/^https?:\/\//.test(n),h,"invalid-emulator-scheme");const g=!1,w=tT(n),{host:x,port:c}=Qk(n),k=c===null?"":`:${c}`,O={url:`${w}//${x}${k}/`},U=Object.freeze({host:x,port:c,protocol:w.replace(":",""),options:Object.freeze({disableWarnings:g})});if(!h._canInitEmulator){cn(h.config.emulator&&h.emulatorConfig,h,"emulator-config-failed"),cn(pc(O,h.config.emulator)&&pc(U,h.emulatorConfig),h,"emulator-config-failed");return}h.config.emulator=O,h.emulatorConfig=U,h.settings.appVerificationDisabledForTesting=!0,xc(x)?(C_(`${w}//${x}${k}`),M_("Auth",!0)):Jk()}function tT(a){const n=a.indexOf(":");return n<0?"":a.substr(0,n+1)}function Qk(a){const n=tT(a),o=/(\/\/)?([^?#/]+)/.exec(a.substr(n.length));if(!o)return{host:"",port:null};const h=o[2].split("@").pop()||"",g=/^(\[[^\]]+\])(:|$)/.exec(h);if(g){const w=g[1];return{host:w,port:db(h.substr(w.length+1))}}else{const[w,x]=h.split(":");return{host:w,port:db(x)}}}function db(a){if(!a)return null;const n=Number(a);return isNaN(n)?null:n}function Jk(){function a(){const n=document.createElement("p"),o=n.style;n.innerText="Running in emulator mode. Do not use with production credentials.",o.position="fixed",o.width="100%",o.backgroundColor="#ffffff",o.border=".1em solid #000000",o.color="#b50000",o.bottom="0px",o.left="0px",o.margin="0px",o.zIndex="10000",o.textAlign="center",n.classList.add("firebase-emulator-warning"),document.body.appendChild(n)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",a):a())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _y{constructor(n,o){this.providerId=n,this.signInMethod=o}toJSON(){return ba("not implemented")}_getIdTokenResponse(n){return ba("not implemented")}_linkToIdToken(n,o){return ba("not implemented")}_getReauthenticationResolver(n){return ba("not implemented")}}async function eR(a,n){return Ko(a,"POST","/v1/accounts:signUp",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tR(a,n){return Cd(a,"POST","/v1/accounts:signInWithPassword",Pa(a,n))}async function nR(a,n){return Ko(a,"POST","/v1/accounts:sendOobCode",Pa(a,n))}async function rR(a,n){return nR(a,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iR(a,n){return Cd(a,"POST","/v1/accounts:signInWithEmailLink",Pa(a,n))}async function sR(a,n){return Cd(a,"POST","/v1/accounts:signInWithEmailLink",Pa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xd extends _y{constructor(n,o,h,g=null){super("password",h),this._email=n,this._password=o,this._tenantId=g}static _fromEmailAndPassword(n,o){return new xd(n,o,"password")}static _fromEmailAndCode(n,o,h=null){return new xd(n,o,"emailLink",h)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(n){const o=typeof n=="string"?JSON.parse(n):n;if(o!=null&&o.email&&(o!=null&&o.password)){if(o.signInMethod==="password")return this._fromEmailAndPassword(o.email,o.password);if(o.signInMethod==="emailLink")return this._fromEmailAndCode(o.email,o.password,o.tenantId)}return null}async _getIdTokenResponse(n){switch(this.signInMethod){case"password":const o={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return zf(n,o,"signInWithPassword",tR);case"emailLink":return iR(n,{email:this._email,oobCode:this._password});default:eo(n,"internal-error")}}async _linkToIdToken(n,o){switch(this.signInMethod){case"password":const h={idToken:o,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return zf(n,h,"signUpPassword",eR);case"emailLink":return sR(n,{idToken:o,email:this._email,oobCode:this._password});default:eo(n,"internal-error")}}_getReauthenticationResolver(n){return this._getIdTokenResponse(n)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Du(a,n){return Cd(a,"POST","/v1/accounts:signInWithIdp",Pa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oR="http://localhost";class _c extends _y{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(n){const o=new _c(n.providerId,n.signInMethod);return n.idToken||n.accessToken?(n.idToken&&(o.idToken=n.idToken),n.accessToken&&(o.accessToken=n.accessToken),n.nonce&&!n.pendingToken&&(o.nonce=n.nonce),n.pendingToken&&(o.pendingToken=n.pendingToken)):n.oauthToken&&n.oauthTokenSecret?(o.accessToken=n.oauthToken,o.secret=n.oauthTokenSecret):eo("argument-error"),o}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(n){const o=typeof n=="string"?JSON.parse(n):n,{providerId:h,signInMethod:g,...w}=o;if(!h||!g)return null;const x=new _c(h,g);return x.idToken=w.idToken||void 0,x.accessToken=w.accessToken||void 0,x.secret=w.secret,x.nonce=w.nonce,x.pendingToken=w.pendingToken||null,x}_getIdTokenResponse(n){const o=this.buildRequest();return Du(n,o)}_linkToIdToken(n,o){const h=this.buildRequest();return h.idToken=o,Du(n,h)}_getReauthenticationResolver(n){const o=this.buildRequest();return o.autoCreate=!1,Du(n,o)}buildRequest(){const n={requestUri:oR,returnSecureToken:!0};if(this.pendingToken)n.pendingToken=this.pendingToken;else{const o={};this.idToken&&(o.id_token=this.idToken),this.accessToken&&(o.access_token=this.accessToken),this.secret&&(o.oauth_token_secret=this.secret),o.providerId=this.providerId,this.nonce&&!this.pendingToken&&(o.nonce=this.nonce),n.postBody=wd(o)}return n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aR(a){switch(a){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function lR(a){const n=Qh(Jh(a)).link,o=n?Qh(Jh(n)).deep_link_id:null,h=Qh(Jh(a)).deep_link_id;return(h?Qh(Jh(h)).link:null)||h||o||n||a}class yy{constructor(n){const o=Qh(Jh(n)),h=o.apiKey??null,g=o.oobCode??null,w=aR(o.mode??null);cn(h&&g&&w,"argument-error"),this.apiKey=h,this.operation=w,this.code=g,this.continueUrl=o.continueUrl??null,this.languageCode=o.lang??null,this.tenantId=o.tenantId??null}static parseLink(n){const o=lR(n);try{return new yy(o)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(){this.providerId=Hu.PROVIDER_ID}static credential(n,o){return xd._fromEmailAndPassword(n,o)}static credentialWithLink(n,o){const h=yy.parseLink(o);return cn(h,"argument-error"),xd._fromEmailAndCode(n,h.code,h.tenantId)}}Hu.PROVIDER_ID="password";Hu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Hu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vy{constructor(n){this.providerId=n,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(n){this.defaultLanguageCode=n}setCustomParameters(n){return this.customParameters=n,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Md extends vy{constructor(){super(...arguments),this.scopes=[]}addScope(n){return this.scopes.includes(n)||this.scopes.push(n),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl extends Md{constructor(){super("facebook.com")}static credential(n){return _c._fromParams({providerId:tl.PROVIDER_ID,signInMethod:tl.FACEBOOK_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return tl.credentialFromTaggedObject(n)}static credentialFromError(n){return tl.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return tl.credential(n.oauthAccessToken)}catch{return null}}}tl.FACEBOOK_SIGN_IN_METHOD="facebook.com";tl.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va extends Md{constructor(){super("google.com"),this.addScope("profile")}static credential(n,o){return _c._fromParams({providerId:va.PROVIDER_ID,signInMethod:va.GOOGLE_SIGN_IN_METHOD,idToken:n,accessToken:o})}static credentialFromResult(n){return va.credentialFromTaggedObject(n)}static credentialFromError(n){return va.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthIdToken:o,oauthAccessToken:h}=n;if(!o&&!h)return null;try{return va.credential(o,h)}catch{return null}}}va.GOOGLE_SIGN_IN_METHOD="google.com";va.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl extends Md{constructor(){super("github.com")}static credential(n){return _c._fromParams({providerId:nl.PROVIDER_ID,signInMethod:nl.GITHUB_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return nl.credentialFromTaggedObject(n)}static credentialFromError(n){return nl.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return nl.credential(n.oauthAccessToken)}catch{return null}}}nl.GITHUB_SIGN_IN_METHOD="github.com";nl.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl extends Md{constructor(){super("twitter.com")}static credential(n,o){return _c._fromParams({providerId:rl.PROVIDER_ID,signInMethod:rl.TWITTER_SIGN_IN_METHOD,oauthToken:n,oauthTokenSecret:o})}static credentialFromResult(n){return rl.credentialFromTaggedObject(n)}static credentialFromError(n){return rl.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthAccessToken:o,oauthTokenSecret:h}=n;if(!o||!h)return null;try{return rl.credential(o,h)}catch{return null}}}rl.TWITTER_SIGN_IN_METHOD="twitter.com";rl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cR(a,n){return Cd(a,"POST","/v1/accounts:signUp",Pa(a,n))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yc{constructor(n){this.user=n.user,this.providerId=n.providerId,this._tokenResponse=n._tokenResponse,this.operationType=n.operationType}static async _fromIdTokenResponse(n,o,h,g=!1){const w=await mo._fromIdTokenResponse(n,h,g),x=pb(h);return new yc({user:w,providerId:x,_tokenResponse:h,operationType:o})}static async _forOperation(n,o,h){await n._updateTokensIfNecessary(h,!0);const g=pb(h);return new yc({user:n,providerId:g,_tokenResponse:h,operationType:o})}}function pb(a){return a.providerId?a.providerId:"phoneNumber"in a?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of extends Zo{constructor(n,o,h,g){super(o.code,o.message),this.operationType=h,this.user=g,Object.setPrototypeOf(this,Of.prototype),this.customData={appName:n.name,tenantId:n.tenantId??void 0,_serverResponse:o.customData._serverResponse,operationType:h}}static _fromErrorAndOperation(n,o,h,g){return new Of(n,o,h,g)}}function nT(a,n,o,h){return(n==="reauthenticate"?o._getReauthenticationResolver(a):o._getIdTokenResponse(a)).catch(w=>{throw w.code==="auth/multi-factor-auth-required"?Of._fromErrorAndOperation(a,w,n,h):w})}async function uR(a,n,o=!1){const h=await Uu(a,n._linkToIdToken(a.auth,await a.getIdToken()),o);return yc._forOperation(a,"link",h)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hR(a,n,o=!1){const{auth:h}=a;if(ws(h.app))return Promise.reject(Ta(h));const g="reauthenticate";try{const w=await Uu(a,nT(h,g,n,a),o);cn(w.idToken,h,"internal-error");const x=my(w.idToken);cn(x,h,"internal-error");const{sub:c}=x;return cn(a.uid===c,h,"user-mismatch"),yc._forOperation(a,g,w)}catch(w){throw(w==null?void 0:w.code)==="auth/user-not-found"&&eo(h,"user-mismatch"),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rT(a,n,o=!1){if(ws(a.app))return Promise.reject(Ta(a));const h="signIn",g=await nT(a,h,n),w=await yc._fromIdTokenResponse(a,h,g);return o||await a._updateCurrentUser(w.user),w}async function dR(a,n){return rT(Ca(a),n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iT(a){const n=Ca(a);n._getPasswordPolicyInternal()&&await n._updatePasswordPolicy()}async function pR(a,n,o){const h=Ca(a);await zf(h,{requestType:"PASSWORD_RESET",email:n,clientType:"CLIENT_TYPE_WEB"},"getOobCode",rR)}async function fR(a,n,o){if(ws(a.app))return Promise.reject(Ta(a));const h=Ca(a),x=await zf(h,{returnSecureToken:!0,email:n,password:o,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",cR).catch(k=>{throw k.code==="auth/password-does-not-meet-requirements"&&iT(a),k}),c=await yc._fromIdTokenResponse(h,"signIn",x);return await h._updateCurrentUser(c.user),c}function mR(a,n,o){return ws(a.app)?Promise.reject(Ta(a)):dR(_i(a),Hu.credential(n,o)).catch(async h=>{throw h.code==="auth/password-does-not-meet-requirements"&&iT(a),h})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gR(a,n){return Ko(a,"POST","/v1/accounts:update",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _R(a,{displayName:n,photoURL:o}){if(n===void 0&&o===void 0)return;const h=_i(a),w={idToken:await h.getIdToken(),displayName:n,photoUrl:o,returnSecureToken:!0},x=await Uu(h,gR(h.auth,w));h.displayName=x.displayName||null,h.photoURL=x.photoUrl||null;const c=h.providerData.find(({providerId:k})=>k==="password");c&&(c.displayName=h.displayName,c.photoURL=h.photoURL),await h._updateTokensIfNecessary(x)}function yR(a,n,o,h){return _i(a).onIdTokenChanged(n,o,h)}function vR(a,n,o){return _i(a).beforeAuthStateChanged(n,o)}function xR(a,n,o,h){return _i(a).onAuthStateChanged(n,o,h)}function bR(a){return _i(a).signOut()}const Ff="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT{constructor(n,o){this.storageRetriever=n,this.type=o}_isAvailable(){try{return this.storage?(this.storage.setItem(Ff,"1"),this.storage.removeItem(Ff),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(n,o){return this.storage.setItem(n,JSON.stringify(o)),Promise.resolve()}_get(n){const o=this.storage.getItem(n);return Promise.resolve(o?JSON.parse(o):null)}_remove(n){return this.storage.removeItem(n),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wR=1e3,TR=10;class oT extends sT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(n,o)=>this.onStorageEvent(n,o),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Yw(),this._shouldAllowMigration=!0}forAllChangedKeys(n){for(const o of Object.keys(this.listeners)){const h=this.storage.getItem(o),g=this.localCache[o];h!==g&&n(o,g,h)}}onStorageEvent(n,o=!1){if(!n.key){this.forAllChangedKeys((x,c,k)=>{this.notifyListeners(x,k)});return}const h=n.key;o?this.detachListener():this.stopPolling();const g=()=>{const x=this.storage.getItem(h);!o&&this.localCache[h]===x||this.notifyListeners(h,x)},w=this.storage.getItem(h);zk()&&w!==n.newValue&&n.newValue!==n.oldValue?setTimeout(g,TR):g()}notifyListeners(n,o){this.localCache[n]=o;const h=this.listeners[n];if(h)for(const g of Array.from(h))g(o&&JSON.parse(o))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((n,o,h)=>{this.onStorageEvent(new StorageEvent("storage",{key:n,oldValue:o,newValue:h}),!0)})},wR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(n,o){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[n]||(this.listeners[n]=new Set,this.localCache[n]=this.storage.getItem(n)),this.listeners[n].add(o)}_removeListener(n,o){this.listeners[n]&&(this.listeners[n].delete(o),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(n,o){await super._set(n,o),this.localCache[n]=JSON.stringify(o)}async _get(n){const o=await super._get(n);return this.localCache[n]=JSON.stringify(o),o}async _remove(n){await super._remove(n),delete this.localCache[n]}}oT.type="LOCAL";const ER=oT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aT extends sT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(n,o){}_removeListener(n,o){}}aT.type="SESSION";const lT=aT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IR(a){return Promise.all(a.map(async n=>{try{return{fulfilled:!0,value:await n}}catch(o){return{fulfilled:!1,reason:o}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm{constructor(n){this.eventTarget=n,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(n){const o=this.receivers.find(g=>g.isListeningto(n));if(o)return o;const h=new lm(n);return this.receivers.push(h),h}isListeningto(n){return this.eventTarget===n}async handleEvent(n){const o=n,{eventId:h,eventType:g,data:w}=o.data,x=this.handlersMap[g];if(!(x!=null&&x.size))return;o.ports[0].postMessage({status:"ack",eventId:h,eventType:g});const c=Array.from(x).map(async O=>O(o.origin,w)),k=await IR(c);o.ports[0].postMessage({status:"done",eventId:h,eventType:g,response:k})}_subscribe(n,o){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[n]||(this.handlersMap[n]=new Set),this.handlersMap[n].add(o)}_unsubscribe(n,o){this.handlersMap[n]&&o&&this.handlersMap[n].delete(o),(!o||this.handlersMap[n].size===0)&&delete this.handlersMap[n],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}lm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xy(a="",n=10){let o="";for(let h=0;h<n;h++)o+=Math.floor(Math.random()*10);return a+o}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(n){this.target=n,this.handlers=new Set}removeMessageHandler(n){n.messageChannel&&(n.messageChannel.port1.removeEventListener("message",n.onMessage),n.messageChannel.port1.close()),this.handlers.delete(n)}async _send(n,o,h=50){const g=typeof MessageChannel<"u"?new MessageChannel:null;if(!g)throw new Error("connection_unavailable");let w,x;return new Promise((c,k)=>{const O=xy("",20);g.port1.start();const U=setTimeout(()=>{k(new Error("unsupported_event"))},h);x={messageChannel:g,onMessage(Y){const se=Y;if(se.data.eventId===O)switch(se.data.status){case"ack":clearTimeout(U),w=setTimeout(()=>{k(new Error("timeout"))},3e3);break;case"done":clearTimeout(w),c(se.data.response);break;default:clearTimeout(U),clearTimeout(w),k(new Error("invalid_response"));break}}},this.handlers.add(x),g.port1.addEventListener("message",x.onMessage),this.target.postMessage({eventType:n,eventId:O,data:o},[g.port2])}).finally(()=>{x&&this.removeMessageHandler(x)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qo(){return window}function AR(a){qo().location.href=a}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cT(){return typeof qo().WorkerGlobalScope<"u"&&typeof qo().importScripts=="function"}async function PR(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function CR(){var a;return((a=navigator==null?void 0:navigator.serviceWorker)==null?void 0:a.controller)||null}function MR(){return cT()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uT="firebaseLocalStorageDb",kR=1,Nf="firebaseLocalStorage",hT="fbase_key";class kd{constructor(n){this.request=n}toPromise(){return new Promise((n,o)=>{this.request.addEventListener("success",()=>{n(this.request.result)}),this.request.addEventListener("error",()=>{o(this.request.error)})})}}function cm(a,n){return a.transaction([Nf],n?"readwrite":"readonly").objectStore(Nf)}function RR(){const a=indexedDB.deleteDatabase(uT);return new kd(a).toPromise()}function b_(){const a=indexedDB.open(uT,kR);return new Promise((n,o)=>{a.addEventListener("error",()=>{o(a.error)}),a.addEventListener("upgradeneeded",()=>{const h=a.result;try{h.createObjectStore(Nf,{keyPath:hT})}catch(g){o(g)}}),a.addEventListener("success",async()=>{const h=a.result;h.objectStoreNames.contains(Nf)?n(h):(h.close(),await RR(),n(await b_()))})})}async function fb(a,n,o){const h=cm(a,!0).put({[hT]:n,value:o});return new kd(h).toPromise()}async function DR(a,n){const o=cm(a,!1).get(n),h=await new kd(o).toPromise();return h===void 0?null:h.value}function mb(a,n){const o=cm(a,!0).delete(n);return new kd(o).toPromise()}const LR=800,zR=3;class dT{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await b_(),this.db)}async _withRetries(n){let o=0;for(;;)try{const h=await this._openDb();return await n(h)}catch(h){if(o++>zR)throw h;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return cT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=lm._getInstance(MR()),this.receiver._subscribe("keyChanged",async(n,o)=>({keyProcessed:(await this._poll()).includes(o.key)})),this.receiver._subscribe("ping",async(n,o)=>["keyChanged"])}async initializeSender(){var o,h;if(this.activeServiceWorker=await PR(),!this.activeServiceWorker)return;this.sender=new SR(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(o=n[0])!=null&&o.fulfilled&&(h=n[0])!=null&&h.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(n){if(!(!this.sender||!this.activeServiceWorker||CR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:n},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const n=await b_();return await fb(n,Ff,"1"),await mb(n,Ff),!0}catch{}return!1}async _withPendingWrite(n){this.pendingWrites++;try{await n()}finally{this.pendingWrites--}}async _set(n,o){return this._withPendingWrite(async()=>(await this._withRetries(h=>fb(h,n,o)),this.localCache[n]=o,this.notifyServiceWorker(n)))}async _get(n){const o=await this._withRetries(h=>DR(h,n));return this.localCache[n]=o,o}async _remove(n){return this._withPendingWrite(async()=>(await this._withRetries(o=>mb(o,n)),delete this.localCache[n],this.notifyServiceWorker(n)))}async _poll(){const n=await this._withRetries(g=>{const w=cm(g,!1).getAll();return new kd(w).toPromise()});if(!n)return[];if(this.pendingWrites!==0)return[];const o=[],h=new Set;if(n.length!==0)for(const{fbase_key:g,value:w}of n)h.add(g),JSON.stringify(this.localCache[g])!==JSON.stringify(w)&&(this.notifyListeners(g,w),o.push(g));for(const g of Object.keys(this.localCache))this.localCache[g]&&!h.has(g)&&(this.notifyListeners(g,null),o.push(g));return o}notifyListeners(n,o){this.localCache[n]=o;const h=this.listeners[n];if(h)for(const g of Array.from(h))g(o)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),LR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(n,o){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[n]||(this.listeners[n]=new Set,this._get(n)),this.listeners[n].add(o)}_removeListener(n,o){this.listeners[n]&&(this.listeners[n].delete(o),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&this.stopPolling()}}dT.type="LOCAL";const OR=dT;new Pd(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pT(a,n){return n?wa(n):(cn(a._popupRedirectResolver,a,"argument-error"),a._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by extends _y{constructor(n){super("custom","custom"),this.params=n}_getIdTokenResponse(n){return Du(n,this._buildIdpRequest())}_linkToIdToken(n,o){return Du(n,this._buildIdpRequest(o))}_getReauthenticationResolver(n){return Du(n,this._buildIdpRequest())}_buildIdpRequest(n){const o={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return n&&(o.idToken=n),o}}function FR(a){return rT(a.auth,new by(a),a.bypassAuthState)}function NR(a){const{auth:n,user:o}=a;return cn(o,n,"internal-error"),hR(o,new by(a),a.bypassAuthState)}async function VR(a){const{auth:n,user:o}=a;return cn(o,n,"internal-error"),uR(o,new by(a),a.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fT{constructor(n,o,h,g,w=!1){this.auth=n,this.resolver=h,this.user=g,this.bypassAuthState=w,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(o)?o:[o]}execute(){return new Promise(async(n,o)=>{this.pendingPromise={resolve:n,reject:o};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(h){this.reject(h)}})}async onAuthEvent(n){const{urlResponse:o,sessionId:h,postBody:g,tenantId:w,error:x,type:c}=n;if(x){this.reject(x);return}const k={auth:this.auth,requestUri:o,sessionId:h,tenantId:w||void 0,postBody:g||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(k))}catch(O){this.reject(O)}}onError(n){this.reject(n)}getIdpTask(n){switch(n){case"signInViaPopup":case"signInViaRedirect":return FR;case"linkViaPopup":case"linkViaRedirect":return VR;case"reauthViaPopup":case"reauthViaRedirect":return NR;default:eo(this.auth,"internal-error")}}resolve(n){Aa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(n),this.unregisterAndCleanUp()}reject(n){Aa(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(n),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BR=new Pd(2e3,1e4);async function UR(a,n,o){if(ws(a.app))return Promise.reject(yo(a,"operation-not-supported-in-this-environment"));const h=Ca(a);mk(a,n,vy);const g=pT(h,o);return new uc(h,"signInViaPopup",n,g).executeNotNull()}class uc extends fT{constructor(n,o,h,g,w){super(n,o,g,w),this.provider=h,this.authWindow=null,this.pollId=null,uc.currentPopupAction&&uc.currentPopupAction.cancel(),uc.currentPopupAction=this}async executeNotNull(){const n=await this.execute();return cn(n,this.auth,"internal-error"),n}async onExecution(){Aa(this.filter.length===1,"Popup operations only handle one event");const n=xy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(o=>{this.reject(o)}),this.resolver._isIframeWebStorageSupported(this.auth,o=>{o||this.reject(yo(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var n;return((n=this.authWindow)==null?void 0:n.associatedEvent)||null}cancel(){this.reject(yo(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,uc.currentPopupAction=null}pollUserCancellation(){const n=()=>{var o,h;if((h=(o=this.authWindow)==null?void 0:o.window)!=null&&h.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(yo(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(n,BR.get())};n()}}uc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR="pendingRedirect",ff=new Map;class $R extends fT{constructor(n,o,h=!1){super(n,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],o,void 0,h),this.eventId=null}async execute(){let n=ff.get(this.auth._key());if(!n){try{const h=await qR(this.resolver,this.auth)?await super.execute():null;n=()=>Promise.resolve(h)}catch(o){n=()=>Promise.reject(o)}ff.set(this.auth._key(),n)}return this.bypassAuthState||ff.set(this.auth._key(),()=>Promise.resolve(null)),n()}async onAuthEvent(n){if(n.type==="signInViaRedirect")return super.onAuthEvent(n);if(n.type==="unknown"){this.resolve(null);return}if(n.eventId){const o=await this.auth._redirectUserForId(n.eventId);if(o)return this.user=o,super.onAuthEvent(n);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function qR(a,n){const o=WR(n),h=HR(a);if(!await h._isAvailable())return!1;const g=await h._get(o)==="true";return await h._remove(o),g}function GR(a,n){ff.set(a._key(),n)}function HR(a){return wa(a._redirectPersistence)}function WR(a){return pf(jR,a.config.apiKey,a.name)}async function ZR(a,n,o=!1){if(ws(a.app))return Promise.reject(Ta(a));const h=Ca(a),g=pT(h,n),x=await new $R(h,g,o).execute();return x&&!o&&(delete x.user._redirectEventId,await h._persistUserIfCurrent(x.user),await h._setRedirectUser(null,n)),x}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KR=600*1e3;class XR{constructor(n){this.auth=n,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(n){this.consumers.add(n),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,n)&&(this.sendToConsumer(this.queuedRedirectEvent,n),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(n){this.consumers.delete(n)}onEvent(n){if(this.hasEventBeenHandled(n))return!1;let o=!1;return this.consumers.forEach(h=>{this.isEventForConsumer(n,h)&&(o=!0,this.sendToConsumer(n,h),this.saveEventToCache(n))}),this.hasHandledPotentialRedirect||!YR(n)||(this.hasHandledPotentialRedirect=!0,o||(this.queuedRedirectEvent=n,o=!0)),o}sendToConsumer(n,o){var h;if(n.error&&!mT(n)){const g=((h=n.error.code)==null?void 0:h.split("auth/")[1])||"internal-error";o.onError(yo(this.auth,g))}else o.onAuthEvent(n)}isEventForConsumer(n,o){const h=o.eventId===null||!!n.eventId&&n.eventId===o.eventId;return o.filter.includes(n.type)&&h}hasEventBeenHandled(n){return Date.now()-this.lastProcessedEventTime>=KR&&this.cachedEventUids.clear(),this.cachedEventUids.has(gb(n))}saveEventToCache(n){this.cachedEventUids.add(gb(n)),this.lastProcessedEventTime=Date.now()}}function gb(a){return[a.type,a.eventId,a.sessionId,a.tenantId].filter(n=>n).join("-")}function mT({type:a,error:n}){return a==="unknown"&&(n==null?void 0:n.code)==="auth/no-auth-event"}function YR(a){switch(a.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return mT(a);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QR(a,n={}){return Ko(a,"GET","/v1/projects",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,eD=/^https?/;async function tD(a){if(a.config.emulator)return;const{authorizedDomains:n}=await QR(a);for(const o of n)try{if(nD(o))return}catch{}eo(a,"unauthorized-domain")}function nD(a){const n=v_(),{protocol:o,hostname:h}=new URL(n);if(a.startsWith("chrome-extension://")){const x=new URL(a);return x.hostname===""&&h===""?o==="chrome-extension:"&&a.replace("chrome-extension://","")===n.replace("chrome-extension://",""):o==="chrome-extension:"&&x.hostname===h}if(!eD.test(o))return!1;if(JR.test(a))return h===a;const g=a.replace(/\./g,"\\.");return new RegExp("^(.+\\."+g+"|"+g+")$","i").test(h)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rD=new Pd(3e4,6e4);function _b(){const a=qo().___jsl;if(a!=null&&a.H){for(const n of Object.keys(a.H))if(a.H[n].r=a.H[n].r||[],a.H[n].L=a.H[n].L||[],a.H[n].r=[...a.H[n].L],a.CP)for(let o=0;o<a.CP.length;o++)a.CP[o]=null}}function iD(a){return new Promise((n,o)=>{var g,w,x;function h(){_b(),gapi.load("gapi.iframes",{callback:()=>{n(gapi.iframes.getContext())},ontimeout:()=>{_b(),o(yo(a,"network-request-failed"))},timeout:rD.get()})}if((w=(g=qo().gapi)==null?void 0:g.iframes)!=null&&w.Iframe)n(gapi.iframes.getContext());else if((x=qo().gapi)!=null&&x.load)h();else{const c=qk("iframefcb");return qo()[c]=()=>{gapi.load?h():o(yo(a,"network-request-failed"))},Jw(`${$k()}?onload=${c}`).catch(k=>o(k))}}).catch(n=>{throw mf=null,n})}let mf=null;function sD(a){return mf=mf||iD(a),mf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD=new Pd(5e3,15e3),aD="__/auth/iframe",lD="emulator/auth/iframe",cD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},uD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function hD(a){const n=a.config;cn(n.authDomain,a,"auth-domain-config-required");const o=n.emulator?fy(n,lD):`https://${a.config.authDomain}/${aD}`,h={apiKey:n.apiKey,appName:a.name,v:bc},g=uD.get(a.config.apiHost);g&&(h.eid=g);const w=a._getFrameworks();return w.length&&(h.fw=w.join(",")),`${o}?${wd(h).slice(1)}`}async function dD(a){const n=await sD(a),o=qo().gapi;return cn(o,a,"internal-error"),n.open({where:document.body,url:hD(a),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:cD,dontclear:!0},h=>new Promise(async(g,w)=>{await h.restyle({setHideOnLeave:!1});const x=yo(a,"network-request-failed"),c=qo().setTimeout(()=>{w(x)},oD.get());function k(){qo().clearTimeout(c),g(h)}h.ping(k).then(k,()=>{w(x)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},fD=500,mD=600,gD="_blank",_D="http://localhost";class yb{constructor(n){this.window=n,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function yD(a,n,o,h=fD,g=mD){const w=Math.max((window.screen.availHeight-g)/2,0).toString(),x=Math.max((window.screen.availWidth-h)/2,0).toString();let c="";const k={...pD,width:h.toString(),height:g.toString(),top:w,left:x},O=Hi().toLowerCase();o&&(c=Hw(O)?gD:o),qw(O)&&(n=n||_D,k.scrollbars="yes");const U=Object.entries(k).reduce((se,[xe,$e])=>`${se}${xe}=${$e},`,"");if(Lk(O)&&c!=="_self")return vD(n||"",c),new yb(null);const Y=window.open(n||"",c,U);cn(Y,a,"popup-blocked");try{Y.focus()}catch{}return new yb(Y)}function vD(a,n){const o=document.createElement("a");o.href=a,o.target=n;const h=document.createEvent("MouseEvent");h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),o.dispatchEvent(h)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xD="__/auth/handler",bD="emulator/auth/handler",wD=encodeURIComponent("fac");async function vb(a,n,o,h,g,w){cn(a.config.authDomain,a,"auth-domain-config-required"),cn(a.config.apiKey,a,"invalid-api-key");const x={apiKey:a.config.apiKey,appName:a.name,authType:o,redirectUrl:h,v:bc,eventId:g};if(n instanceof vy){n.setDefaultLanguage(a.languageCode),x.providerId=n.providerId||"",zS(n.getCustomParameters())||(x.customParameters=JSON.stringify(n.getCustomParameters()));for(const[U,Y]of Object.entries({}))x[U]=Y}if(n instanceof Md){const U=n.getScopes().filter(Y=>Y!=="");U.length>0&&(x.scopes=U.join(","))}a.tenantId&&(x.tid=a.tenantId);const c=x;for(const U of Object.keys(c))c[U]===void 0&&delete c[U];const k=await a._getAppCheckToken(),O=k?`#${wD}=${encodeURIComponent(k)}`:"";return`${TD(a)}?${wd(c).slice(1)}${O}`}function TD({config:a}){return a.emulator?fy(a,bD):`https://${a.authDomain}/${xD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qg="webStorageSupport";class ED{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=lT,this._completeRedirectFn=ZR,this._overrideRedirectResult=GR}async _openPopup(n,o,h,g){var x;Aa((x=this.eventManagers[n._key()])==null?void 0:x.manager,"_initialize() not called before _openPopup()");const w=await vb(n,o,h,v_(),g);return yD(n,w,xy())}async _openRedirect(n,o,h,g){await this._originValidation(n);const w=await vb(n,o,h,v_(),g);return AR(w),new Promise(()=>{})}_initialize(n){const o=n._key();if(this.eventManagers[o]){const{manager:g,promise:w}=this.eventManagers[o];return g?Promise.resolve(g):(Aa(w,"If manager is not set, promise should be"),w)}const h=this.initAndGetManager(n);return this.eventManagers[o]={promise:h},h.catch(()=>{delete this.eventManagers[o]}),h}async initAndGetManager(n){const o=await dD(n),h=new XR(n);return o.register("authEvent",g=>(cn(g==null?void 0:g.authEvent,n,"invalid-auth-event"),{status:h.onEvent(g.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[n._key()]={manager:h},this.iframes[n._key()]=o,h}_isIframeWebStorageSupported(n,o){this.iframes[n._key()].send(qg,{type:qg},g=>{var x;const w=(x=g==null?void 0:g[0])==null?void 0:x[qg];w!==void 0&&o(!!w),eo(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(n){const o=n._key();return this.originValidationPromises[o]||(this.originValidationPromises[o]=tD(n)),this.originValidationPromises[o]}get _shouldInitProactively(){return Yw()||Gw()||gy()}}const ID=ED;var xb="@firebase/auth",bb="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD{constructor(n){this.auth=n,this.internalListeners=new Map}getUid(){var n;return this.assertAuthConfigured(),((n=this.auth.currentUser)==null?void 0:n.uid)||null}async getToken(n){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(n)}:null}addAuthTokenListener(n){if(this.assertAuthConfigured(),this.internalListeners.has(n))return;const o=this.auth.onIdTokenChanged(h=>{n((h==null?void 0:h.stsTokenManager.accessToken)||null)});this.internalListeners.set(n,o),this.updateProactiveRefresh()}removeAuthTokenListener(n){this.assertAuthConfigured();const o=this.internalListeners.get(n);o&&(this.internalListeners.delete(n),o(),this.updateProactiveRefresh())}assertAuthConfigured(){cn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AD(a){switch(a){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function PD(a){fc(new ul("auth",(n,{options:o})=>{const h=n.getProvider("app").getImmediate(),g=n.getProvider("heartbeat"),w=n.getProvider("app-check-internal"),{apiKey:x,authDomain:c}=h.options;cn(x&&!x.includes(":"),"invalid-api-key",{appName:h.name});const k={apiKey:x,authDomain:c,clientPlatform:a,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Qw(a)},O=new Bk(h,g,w,k);return Xk(O,o),O},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,o,h)=>{n.getProvider("auth-internal").initialize()})),fc(new ul("auth-internal",n=>{const o=Ca(n.getProvider("auth").getImmediate());return(h=>new SD(h))(o)},"PRIVATE").setInstantiationMode("EXPLICIT")),No(xb,bb,AD(a)),No(xb,bb,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CD=300,MD=n1("authIdTokenMaxAge")||CD;let wb=null;const kD=a=>async n=>{const o=n&&await n.getIdTokenResult(),h=o&&(new Date().getTime()-Date.parse(o.issuedAtTime))/1e3;if(h&&h>MD)return;const g=o==null?void 0:o.token;wb!==g&&(wb=g,await fetch(a,{method:g?"POST":"DELETE",headers:g?{Authorization:`Bearer ${g}`}:{}}))};function RD(a=D_()){const n=qf(a,"auth");if(n.isInitialized())return n.getImmediate();const o=Kk(a,{popupRedirectResolver:ID,persistence:[OR,ER,lT]}),h=n1("authTokenSyncURL");if(h&&typeof isSecureContext=="boolean"&&isSecureContext){const w=new URL(h,location.origin);if(location.origin===w.origin){const x=kD(w.toString());vR(o,x,()=>x(o.currentUser)),yR(o,c=>x(c))}}const g=Jb("auth");return g&&Yk(o,`http://${g}`),o}function DD(){var a;return((a=document.getElementsByTagName("head"))==null?void 0:a[0])??document}Uk({loadJS(a){return new Promise((n,o)=>{const h=document.createElement("script");h.setAttribute("src",a),h.onload=n,h.onerror=g=>{const w=yo("internal-error");w.customData=g,o(w)},h.type="text/javascript",h.charset="UTF-8",DD().appendChild(h)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});PD("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gT="firebasestorage.googleapis.com",LD="storageBucket",zD=120*1e3,OD=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo extends Zo{constructor(n,o,h=0){super(Gg(n),`Firebase Storage: ${o} (${Gg(n)})`),this.status_=h,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Xo.prototype)}get status(){return this.status_}set status(n){this.status_=n}_codeEquals(n){return Gg(n)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(n){this.customData.serverResponse=n,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Wo;(function(a){a.UNKNOWN="unknown",a.OBJECT_NOT_FOUND="object-not-found",a.BUCKET_NOT_FOUND="bucket-not-found",a.PROJECT_NOT_FOUND="project-not-found",a.QUOTA_EXCEEDED="quota-exceeded",a.UNAUTHENTICATED="unauthenticated",a.UNAUTHORIZED="unauthorized",a.UNAUTHORIZED_APP="unauthorized-app",a.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",a.INVALID_CHECKSUM="invalid-checksum",a.CANCELED="canceled",a.INVALID_EVENT_NAME="invalid-event-name",a.INVALID_URL="invalid-url",a.INVALID_DEFAULT_BUCKET="invalid-default-bucket",a.NO_DEFAULT_BUCKET="no-default-bucket",a.CANNOT_SLICE_BLOB="cannot-slice-blob",a.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",a.NO_DOWNLOAD_URL="no-download-url",a.INVALID_ARGUMENT="invalid-argument",a.INVALID_ARGUMENT_COUNT="invalid-argument-count",a.APP_DELETED="app-deleted",a.INVALID_ROOT_OPERATION="invalid-root-operation",a.INVALID_FORMAT="invalid-format",a.INTERNAL_ERROR="internal-error",a.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Wo||(Wo={}));function Gg(a){return"storage/"+a}function FD(){const a="An unknown error occurred, please check the error payload for server response.";return new Xo(Wo.UNKNOWN,a)}function ND(){return new Xo(Wo.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function VD(){return new Xo(Wo.CANCELED,"User canceled the upload/download.")}function BD(a){return new Xo(Wo.INVALID_URL,"Invalid URL '"+a+"'.")}function UD(a){return new Xo(Wo.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+a+"'.")}function Tb(a){return new Xo(Wo.INVALID_ARGUMENT,a)}function _T(){return new Xo(Wo.APP_DELETED,"The Firebase app was deleted.")}function jD(a){return new Xo(Wo.INVALID_ROOT_OPERATION,"The operation '"+a+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(n,o){this.bucket=n,this.path_=o}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const n=encodeURIComponent;return"/b/"+n(this.bucket)+"/o/"+n(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(n,o){let h;try{h=go.makeFromUrl(n,o)}catch{return new go(n,"")}if(h.path==="")return h;throw UD(n)}static makeFromUrl(n,o){let h=null;const g="([A-Za-z0-9.\\-_]+)";function w(et){et.path.charAt(et.path.length-1)==="/"&&(et.path_=et.path_.slice(0,-1))}const x="(/(.*))?$",c=new RegExp("^gs://"+g+x,"i"),k={bucket:1,path:3};function O(et){et.path_=decodeURIComponent(et.path)}const U="v[A-Za-z0-9_]+",Y=o.replace(/[.]/g,"\\."),se="(/([^?#]*).*)?$",xe=new RegExp(`^https?://${Y}/${U}/b/${g}/o${se}`,"i"),$e={bucket:1,path:3},Ce=o===gT?"(?:storage.googleapis.com|storage.cloud.google.com)":o,J="([^?#]*)",Ye=new RegExp(`^https?://${Ce}/${g}/${J}`,"i"),He=[{regex:c,indices:k,postModify:w},{regex:xe,indices:$e,postModify:O},{regex:Ye,indices:{bucket:1,path:2},postModify:O}];for(let et=0;et<He.length;et++){const at=He[et],Qe=at.regex.exec(n);if(Qe){const he=Qe[at.indices.bucket];let oe=Qe[at.indices.path];oe||(oe=""),h=new go(he,oe),at.postModify(h);break}}if(h==null)throw BD(n);return h}}class $D{constructor(n){this.promise_=Promise.reject(n)}getPromise(){return this.promise_}cancel(n=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qD(a,n,o){let h=1,g=null,w=null,x=!1,c=0;function k(){return c===2}let O=!1;function U(...J){O||(O=!0,n.apply(null,J))}function Y(J){g=setTimeout(()=>{g=null,a(xe,k())},J)}function se(){w&&clearTimeout(w)}function xe(J,...Ye){if(O){se();return}if(J){se(),U.call(null,J,...Ye);return}if(k()||x){se(),U.call(null,J,...Ye);return}h<64&&(h*=2);let He;c===1?(c=2,He=0):He=(h+Math.random())*1e3,Y(He)}let $e=!1;function Ce(J){$e||($e=!0,se(),!O&&(g!==null?(J||(c=2),clearTimeout(g),Y(0)):J||(c=1)))}return Y(0),w=setTimeout(()=>{x=!0,Ce(!0)},o),Ce}function GD(a){a(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HD(a){return a!==void 0}function Eb(a,n,o,h){if(h<n)throw Tb(`Invalid value for '${a}'. Expected ${n} or greater.`);if(h>o)throw Tb(`Invalid value for '${a}'. Expected ${o} or less.`)}function WD(a){const n=encodeURIComponent;let o="?";for(const h in a)if(a.hasOwnProperty(h)){const g=n(h)+"="+n(a[h]);o=o+g+"&"}return o=o.slice(0,-1),o}var Vf;(function(a){a[a.NO_ERROR=0]="NO_ERROR",a[a.NETWORK_ERROR=1]="NETWORK_ERROR",a[a.ABORT=2]="ABORT"})(Vf||(Vf={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZD(a,n){const o=a>=500&&a<600,g=[408,429].indexOf(a)!==-1,w=n.indexOf(a)!==-1;return o||g||w}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(n,o,h,g,w,x,c,k,O,U,Y,se=!0,xe=!1){this.url_=n,this.method_=o,this.headers_=h,this.body_=g,this.successCodes_=w,this.additionalRetryCodes_=x,this.callback_=c,this.errorCallback_=k,this.timeout_=O,this.progressCallback_=U,this.connectionFactory_=Y,this.retry=se,this.isUsingEmulator=xe,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(($e,Ce)=>{this.resolve_=$e,this.reject_=Ce,this.start_()})}start_(){const n=(h,g)=>{if(g){h(!1,new ef(!1,null,!0));return}const w=this.connectionFactory_();this.pendingConnection_=w;const x=c=>{const k=c.loaded,O=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(k,O)};this.progressCallback_!==null&&w.addUploadProgressListener(x),w.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&w.removeUploadProgressListener(x),this.pendingConnection_=null;const c=w.getErrorCode()===Vf.NO_ERROR,k=w.getStatus();if(!c||ZD(k,this.additionalRetryCodes_)&&this.retry){const U=w.getErrorCode()===Vf.ABORT;h(!1,new ef(!1,null,U));return}const O=this.successCodes_.indexOf(k)!==-1;h(!0,new ef(O,w))})},o=(h,g)=>{const w=this.resolve_,x=this.reject_,c=g.connection;if(g.wasSuccessCode)try{const k=this.callback_(c,c.getResponse());HD(k)?w(k):w()}catch(k){x(k)}else if(c!==null){const k=FD();k.serverResponse=c.getErrorText(),this.errorCallback_?x(this.errorCallback_(c,k)):x(k)}else if(g.canceled){const k=this.appDelete_?_T():VD();x(k)}else{const k=ND();x(k)}};this.canceled_?o(!1,new ef(!1,null,!0)):this.backoffId_=qD(n,o,this.timeout_)}getPromise(){return this.promise_}cancel(n){this.canceled_=!0,this.appDelete_=n||!1,this.backoffId_!==null&&GD(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class ef{constructor(n,o,h){this.wasSuccessCode=n,this.connection=o,this.canceled=!!h}}function XD(a,n){n!==null&&n.length>0&&(a.Authorization="Firebase "+n)}function YD(a,n){a["X-Firebase-Storage-Version"]="webjs/"+(n??"AppManager")}function QD(a,n){n&&(a["X-Firebase-GMPID"]=n)}function JD(a,n){n!==null&&(a["X-Firebase-AppCheck"]=n)}function e3(a,n,o,h,g,w,x=!0,c=!1){const k=WD(a.urlParams),O=a.url+k,U=Object.assign({},a.headers);return QD(U,n),XD(U,o),YD(U,w),JD(U,h),new KD(O,a.method,U,a.body,a.successCodes,a.additionalRetryCodes,a.handler,a.errorHandler,a.timeout,a.progressCallback,g,x,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t3(a){if(a.length===0)return null;const n=a.lastIndexOf("/");return n===-1?"":a.slice(0,n)}function n3(a){const n=a.lastIndexOf("/",a.length-2);return n===-1?a:a.slice(n+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(n,o){this._service=n,o instanceof go?this._location=o:this._location=go.makeFromUrl(o,n.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(n,o){return new Bf(n,o)}get root(){const n=new go(this._location.bucket,"");return this._newRef(this._service,n)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return n3(this._location.path)}get storage(){return this._service}get parent(){const n=t3(this._location.path);if(n===null)return null;const o=new go(this._location.bucket,n);return new Bf(this._service,o)}_throwIfRoot(n){if(this._location.path==="")throw jD(n)}}function Ib(a,n){const o=n==null?void 0:n[LD];return o==null?null:go.makeFromBucketSpec(o,a)}function r3(a,n,o,h={}){a.host=`${n}:${o}`;const g=xc(n);g&&(C_(`https://${a.host}/b`),M_("Storage",!0)),a._isUsingEmulator=!0,a._protocol=g?"https":"http";const{mockUserToken:w}=h;w&&(a._overrideAuthToken=typeof w=="string"?w:r1(w,a.app.options.projectId))}class i3{constructor(n,o,h,g,w,x=!1){this.app=n,this._authProvider=o,this._appCheckProvider=h,this._url=g,this._firebaseVersion=w,this._isUsingEmulator=x,this._bucket=null,this._host=gT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=zD,this._maxUploadRetryTime=OD,this._requests=new Set,g!=null?this._bucket=go.makeFromBucketSpec(g,this._host):this._bucket=Ib(this._host,this.app.options)}get host(){return this._host}set host(n){this._host=n,this._url!=null?this._bucket=go.makeFromBucketSpec(this._url,n):this._bucket=Ib(n,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(n){Eb("time",0,Number.POSITIVE_INFINITY,n),this._maxUploadRetryTime=n}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(n){Eb("time",0,Number.POSITIVE_INFINITY,n),this._maxOperationRetryTime=n}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const n=this._authProvider.getImmediate({optional:!0});if(n){const o=await n.getToken();if(o!==null)return o.accessToken}return null}async _getAppCheckToken(){if(ws(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=this._appCheckProvider.getImmediate({optional:!0});return n?(await n.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(n=>n.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(n){return new Bf(this,n)}_makeRequest(n,o,h,g,w=!0){if(this._deleted)return new $D(_T());{const x=e3(n,this._appId,h,g,o,this._firebaseVersion,w,this._isUsingEmulator);return this._requests.add(x),x.getPromise().then(()=>this._requests.delete(x),()=>this._requests.delete(x)),x}}async makeRequestWithTokens(n,o){const[h,g]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(n,o,h,g).getPromise()}}const Sb="@firebase/storage",Ab="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yT="storage";function s3(a=D_(),n){a=_i(a);const h=qf(a,yT).getImmediate({identifier:n}),g=e1("storage");return g&&o3(h,...g),h}function o3(a,n,o,h={}){r3(a,n,o,h)}function a3(a,{instanceIdentifier:n}){const o=a.getProvider("app").getImmediate(),h=a.getProvider("auth-internal"),g=a.getProvider("app-check-internal");return new i3(o,h,g,n,bc)}function l3(){fc(new ul(yT,a3,"PUBLIC").setMultipleInstances(!0)),No(Sb,Ab,""),No(Sb,Ab,"esm2020")}l3();const c3={apiKey:"AIzaSyCYPLxlqnPO7neX3ovWYdLR8dScB_A2hjg",authDomain:"iss-tracker-hub.firebaseapp.com",projectId:"iss-tracker-hub",storageBucket:"iss-tracker-hub.firebasestorage.app",messagingSenderId:"851736073236",appId:"1:851736073236:web:0d481bdae81bf2a26d8301"};let tf=null,Vs=null,vc=null,u3=null;try{tf=o1(c3),Vs=RD(tf),vc=WM(tf),u3=s3(tf),console.log("[Firebase] Initialized successfully")}catch(a){console.warn("[Firebase] Initialization failed:",a.message),console.warn("[Firebase] Running in offline mode - auth features disabled")}const gf=[];let wy=null;const Pb={"auth/email-already-in-use":{tr:"Bu e-posta zaten kullanmda",en:"This email is already in use"},"auth/invalid-email":{tr:"Geersiz e-posta adresi",en:"Invalid email address"},"auth/weak-password":{tr:"ifre en az 6 karakter olmal",en:"Password should be at least 6 characters"},"auth/user-not-found":{tr:"Bu e-posta ile kaytl kullanc yok",en:"No user found with this email"},"auth/wrong-password":{tr:"ifre hatal",en:"Wrong password"},"auth/too-many-requests":{tr:"ok fazla deneme. Ltfen bekleyin.",en:"Too many attempts. Please wait."},"auth/network-request-failed":{tr:"nternet balants yok",en:"No internet connection"},default:{tr:"Bir hata olutu",en:"An error occurred"}};function um(a,n="tr"){const o=Pb[a]||Pb.default;return o[n]||o.en}function h3(){if(!Vs){console.warn("[AuthService] Firebase auth not initialized");return}xR(Vs,a=>{wy=a,_3(a),a?console.log("[AuthService] User signed in:",a.email):console.log("[AuthService] User signed out")})}async function d3(a,n,o=null){if(!Vs)throw new Error("Firebase not initialized");try{const h=await fR(Vs,a,n);return o&&h.user&&await _R(h.user,{displayName:o}),{success:!0,user:h.user}}catch(h){return{success:!1,error:um(h.code),code:h.code}}}async function p3(a,n){if(!Vs)throw new Error("Firebase not initialized");try{return{success:!0,user:(await mR(Vs,a,n)).user}}catch(o){return{success:!1,error:um(o.code),code:o.code}}}async function f3(){if(!Vs)throw new Error("Firebase not initialized");try{const a=new va;return{success:!0,user:(await UR(Vs,a)).user}}catch(a){return{success:!1,error:um(a.code),code:a.code}}}async function m3(){if(!Vs)return{success:!0};try{return await bR(Vs),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function g3(a){if(!Vs)throw new Error("Firebase not initialized");try{return await pR(Vs,a),{success:!0}}catch(n){return{success:!1,error:um(n.code),code:n.code}}}function Ty(){return wy}function vT(a){return gf.push(a),a(wy),()=>{const n=gf.indexOf(a);n>-1&&gf.splice(n,1)}}function _3(a){gf.forEach(n=>{try{n(a)}catch(o){console.error("[AuthService] Listener error:",o)}})}h3();const w_={theme:"dark",colorPalette:"CYAN",language:"tr",units:"metric",location:{lat:null,lon:null,name:null},notifications:{passAlerts:!1,emailAlerts:!1},savedImages:[]};let il=null,_f=null;const y3=[];vT(a=>{a?v3(a.uid):(_f&&(_f(),_f=null),il=null,xT(null))});function v3(a){if(!vc){console.warn("[UserPrefs] Firestore not available");return}const n=ay(vc,"users",a,"settings","preferences");_f=ck(n,o=>{o.exists()?il={...w_,...o.data()}:(il={...w_},Iy(il)),xT(il),console.log("[UserPrefs] Preferences loaded:",il)},o=>{console.error("[UserPrefs] Snapshot error:",o)})}function Ey(){return il||{...w_}}async function Iy(a){const n=Ty();if(!n||!vc){try{localStorage.setItem("isshub:preferences",JSON.stringify(a))}catch{}return{success:!0,local:!0}}try{const o=ay(vc,"users",n.uid,"settings","preferences");return await ak(o,{...a,updatedAt:new Date().toISOString()},{merge:!0}),il=a,{success:!0}}catch(o){return console.error("[UserPrefs] Save failed:",o),{success:!1,error:o.message}}}async function x3(a,n){const h={...Ey(),[a]:n};return Iy(h)}async function b3(a,n){const o=Ty();if(!o||!vc){const h=Ey(),g=a.split(".");let w=h;for(let x=0;x<g.length-1;x++)w[g[x]]||(w[g[x]]={}),w=w[g[x]];return w[g[g.length-1]]=n,Iy(h)}try{const h=ay(vc,"users",o.uid,"settings","preferences");return await lk(h,{[a]:n,updatedAt:new Date().toISOString()}),{success:!0}}catch(h){return console.error("[UserPrefs] Update failed:",h),{success:!1,error:h.message}}}async function w3(a){return x3("colorPalette",a)}async function T3(a){return b3("notifications.passAlerts",a)}function xT(a){y3.forEach(n=>{try{n(a)}catch(o){console.error("[UserPrefs] Listener error:",o)}})}function E3(a={}){const n=document.createElement("div");n.className="hub-modal-overlay hidden";const o=["tr","en"],h=[{code:"en",label:"English",flag:""},{code:"tr",label:"Trke",flag:""},{code:"de",label:"Deutsch",flag:""},{code:"fr",label:"Franais",flag:""},{code:"es",label:"Espaol",flag:""},{code:"it",label:"Italiano",flag:""},{code:"ru",label:"",flag:""},{code:"ja",label:"",flag:""},{code:"zh",label:"",flag:""},{code:"pt",label:"Portugus",flag:""},{code:"hi",label:"",flag:""},{code:"ar",label:"",flag:""},{code:"bn",label:"",flag:""},{code:"ko",label:"",flag:""},{code:"nl",label:"Nederlands",flag:""},{code:"pl",label:"Polski",flag:""},{code:"ro",label:"Romn",flag:""},{code:"sv",label:"Svenska",flag:""}];n.innerHTML=`
    <div class="hub-modal settings-modal">
      <div class="hub-modal-header">
        <div class="hub-modal-title" style="display:flex; gap:8px; align-items:center;">
            ${as.settings} <span>${rt("settings")}</span>
        </div>
        <button class="hub-modal-close" aria-label="${rt("close")}">${as.close}</button>
      </div>
      <div class="hub-modal-body">
      
        <!-- Tools Section (Location Restoration) -->
        <div class="settings-group">
            <div class="settings-label">${rt("tools")} & ${rt("location")}</div>
            <div class="settings-controls">
                <button class="settings-btn" id="btn-location">
                    <span style="display:flex; gap:6px; justify-content:center; align-items:center;">
                        ${as.map} ${rt("changeLocation")}
                    </span>
                </button>
            </div>
            <div class="settings-hint">${rt("passDepend")}</div>
        </div>

        <!-- Language Section -->
        <div class="settings-group">
          <div class="settings-label">${rt("language")}</div>
          <div class="settings-controls" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;">
            ${h.map(qe=>{const He=o.includes(qe.code),et=He?"":"",at=He?"":"opacity: 0.5; cursor: not-allowed;",Qe=He?qe.label:_o()==="tr"?"Yaknda gelecek":"Coming soon";return`
                <button class="settings-btn ${He?"":"locked"}" 
                        data-lang="${qe.code}" 
                        aria-label="${qe.label}" 
                        title="${Qe}"
                        ${He?"":"disabled"}
                        style="font-size:11px; padding:6px; ${at}">
                    ${qe.flag} ${qe.code.toUpperCase()} ${et}
                </button>
              `}).join("")}
          </div>
          <div class="settings-hint" style="font-size:10px; opacity:0.6; margin-top:6px;">
             = ${_o()==="tr"?"Yaknda eklenecek":"Coming soon"}
          </div>
        </div>

        <!-- Theme Section -->
        <div class="settings-group">
          <div class="settings-label">${rt("theme")}</div>
          <div class="settings-controls" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;">
              <button class="settings-btn" data-theme="light" aria-label="Light theme" style="font-size:11px; padding:6px;"> Light</button>
              <button class="settings-btn active" data-theme="dark" aria-label="Dark theme" style="font-size:11px; padding:6px;"> Dark</button>
              <button class="settings-btn" data-theme="system" aria-label="System theme" style="font-size:11px; padding:6px;"> System</button>
          </div>
        </div>

        <!-- Accent Color Section -->
        <div class="settings-group">
            <div class="settings-label">Color</div>
            <div class="settings-controls" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px;">
                <button class="settings-btn color-btn" data-color="cyan" style="background:#00f3ff; height:24px; border-radius:4px;"></button>
                <button class="settings-btn color-btn" data-color="pink" style="background:#ff00ff; height:24px; border-radius:4px;"></button>
                <button class="settings-btn color-btn" data-color="green" style="background:#0aff00; height:24px; border-radius:4px;"></button>
                <button class="settings-btn color-btn" data-color="orange" style="background:#ffaa00; height:24px; border-radius:4px;"></button>
                <button class="settings-btn color-btn" data-color="purple" style="background:#bd00ff; height:24px; border-radius:4px;"></button>
            </div>
        </div>

        <!-- Meta Info -->
        <div class="settings-meta">
          ISS Tracker HUB ${dn.VERSION}<br>
          <span style="opacity:0.6; font-size:10px;">${dn.VERSION_CODENAME||"Orbital"} Edition</span>
        </div>
      </div>
    </div>
  `;const g=n.querySelector(".hub-modal-close"),w=n.querySelectorAll("[data-lang]"),x=n.querySelector(".hub-modal-title span"),c=n.querySelector(".settings-group:nth-child(2) .settings-label"),k=n.querySelector(".settings-group:nth-child(3) .settings-label"),O=n.querySelector("#btn-location"),U=()=>{n.classList.add("hidden"),document.removeEventListener("keydown",Y)},Y=qe=>{qe.key==="Escape"&&!n.classList.contains("hidden")&&U()};g.addEventListener("click",U),n.addEventListener("click",qe=>{qe.target===n&&U()}),O.addEventListener("click",()=>{U(),a.onOpenLocation&&a.onOpenLocation()});const se=()=>{const qe=_o();w.forEach(He=>{He.dataset.lang===qe?He.classList.add("active"):He.classList.remove("active")}),x.textContent=rt("settings"),c.textContent=rt("language"),k.textContent=rt("theme")};w.forEach(qe=>{qe.addEventListener("click",()=>{const He=qe.dataset.lang;ZI(He),se()})});const xe=n.querySelectorAll("[data-theme]"),$e=localStorage.getItem("issThemeMode")||"system";xe.forEach(qe=>{qe.dataset.theme===$e&&qe.classList.add("active"),qe.addEventListener("click",()=>{const He=qe.dataset.theme,et=He==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":He;document.documentElement.setAttribute("data-theme",et),localStorage.setItem("issThemeMode",He),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{theme:et,type:"mode"}})),xe.forEach(at=>at.classList.remove("active")),qe.classList.add("active")})});const Ce=n.querySelectorAll("[data-color]"),J={cyan:"#00f3ff",pink:"#ff00ff",green:"#0aff00",orange:"#ffaa00",purple:"#bd00ff"};Ce.forEach(qe=>{qe.addEventListener("click",()=>{const He=qe.dataset.color,et=J[He],at=document.documentElement;at.style.setProperty("--accent",et),at.style.setProperty("--neon-cyan",et),at.style.setProperty("--border",`rgba(${Ye(et)}, 0.3)`),localStorage.setItem("issAccentColor",He),w3(He.toUpperCase()),Ce.forEach(Qe=>Qe.style.outline="none"),qe.style.outline="2px solid #fff"})});function Ye(qe){const He=parseInt(qe.replace("#",""),16),et=He>>16&255,at=He>>8&255,Qe=He&255;return`${et}, ${at}, ${Qe}`}return{el:n,open:()=>{se();const qe=localStorage.getItem("issThemeMode")||"system";xe.forEach(He=>{He.dataset.theme===qe?He.classList.add("active"):He.classList.remove("active")}),document.addEventListener("keydown",Y),n.classList.remove("hidden")}}}function I3(){const a=document.createElement("div");a.className="network-status-bar",a.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(239, 68, 68, 0.95);
    color: white;
    padding: 8px 16px;
    text-align: center;
    font-size: 13px;
    font-weight: 600;
    z-index: 9999;
    display: none;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
  `.trim();const n=document.createElement("span");a.appendChild(n);let o=navigator.onLine;function h(){o?a.style.display="none":(a.style.background="rgba(239, 68, 68, 0.95)",n.textContent=" "+rt("offline"),a.style.display="block")}return window.addEventListener("online",()=>{o=!0,console.log("[Network] Online"),h()}),window.addEventListener("offline",()=>{o=!1,console.log("[Network] Offline"),h()}),setInterval(h,5e3),{el:a,markDataReceived:()=>{h()},update:h}}const Cb="isshub:landingHeroDismissed",nf=typeof window<"u"&&window.localStorage?window.localStorage:null;function S3({onShowPass:a,onLiveTrack:n,getPassState:o}){if(nf&&nf.getItem(Cb)==="true")return{el:null,update:()=>{},dismiss:()=>{}};const h=document.createElement("div");h.className="landing-hero-overlay",h.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 20px;
  `;const g=document.createElement("div");g.className="landing-hero-card glass",g.style.cssText=`
    max-width: 500px;
    width: 100%;
    padding: 40px 32px;
    border-radius: 24px;
    text-align: center;
    position: relative;
  `;const w=document.createElement("button");w.className="btn landing-hero-close",w.type="button",w.innerHTML="",w.title=rt("close"),w.style.cssText=`
    position: absolute;
    top: 16px;
    right: 16px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    font-size: 24px;
    line-height: 1;
    padding: 0;
    opacity: 0.7;
  `;const x=document.createElement("h1");x.className="landing-hero-headline",x.textContent=rt("hero.headline"),x.style.cssText=`
    font-size: clamp(24px, 5vw, 28px);
    font-weight: 700;
    margin: 0 0 16px 0;
    line-height: 1.2;
  `;const c=document.createElement("p");c.className="landing-hero-subline",c.textContent=rt("hero.subline.loading"),c.style.cssText=`
    font-size: clamp(14px, 3.5vw, 16px);
    opacity: 0.9;
    margin: 0 0 32px 0;
    line-height: 1.5;
    min-height: 48px;
  `;const k=document.createElement("div");k.style.cssText=`
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  `;const O=document.createElement("button");O.className="btn btn-primary",O.type="button",O.textContent=rt("hero.cta.showPass"),O.style.cssText=`
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 600;
  `;const U=document.createElement("button");U.className="btn btn-ghost",U.type="button",U.textContent=rt("hero.cta.liveTrack"),U.style.cssText=`
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 600;
  `;const Y=document.createElement("div");Y.style.cssText=`
    margin-top: 16px;
    font-size: 13px;
    opacity: 0.7;
    display: none;
  `,Y.textContent=rt("hero.passCardComing"),k.append(O,U),g.append(w,x,c,k,Y),h.appendChild(g);function se(){nf&&nf.setItem(Cb,"true"),h.remove()}w.addEventListener("click",se),O.addEventListener("click",()=>{Y.style.display="block",setTimeout(()=>{se(),a&&a()},1500)}),U.addEventListener("click",()=>{se(),n&&n()});function xe(){if(!o){c.textContent=rt("hero.subline.loading");return}const J=o();if(J.loading||J.calculating){c.textContent=rt("hero.subline.loading");return}if(J.pass&&J.pass.aosMs){const Ye=Date.now(),qe=Math.max(1,Math.round((J.pass.aosMs-Ye)/6e4));c.textContent=rt("hero.subline.pass").replace("{minutes}",qe);return}if(!J.hasLocation){c.textContent=rt("hero.subline.permission");return}if(J.error){c.textContent=rt("hero.subline.unavailable");return}c.textContent=rt("hero.subline.loading")}xe();const $e=setInterval(xe,1e4),Ce=se;return se=()=>{clearInterval($e),Ce()},{el:h,update:xe,dismiss:se}}function A3(a){if(!a||!a.startTime)return null;const n=O=>new Date(O).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),o=new Date(a.startTime),h=new Date(o.getTime()+(a.duration||5)*60*1e3),g=new Date,w=_o(),x=rt("notify.title")||"ISS Tracker Hub",c=w==="tr"?`Uluslararas Uzay stasyonu konumunuzdan grnr olacak. Maksimum ykseklik: ${a.maxElevation||"--"}`:`The International Space Station will be visible from your location. Max elevation: ${a.maxElevation||"--"}`;return`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//ISS Tracker Hub//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:iss-pass-${o.getTime()}@isstrackhub.app
DTSTAMP:${n(g)}
DTSTART:${n(o)}
DTEND:${n(h)}
SUMMARY: ${x}
DESCRIPTION:${c}
LOCATION:Sky above your location
STATUS:CONFIRMED
TRANSP:OPAQUE
BEGIN:VALARM
ACTION:DISPLAY
DESCRIPTION:${x} - ${w==="tr"?"10 dakika sonra!":"10 minutes!"}
TRIGGER:-PT10M
END:VALARM
END:VEVENT
END:VCALENDAR`}function P3(a){const n=A3(a);if(!n)return console.warn("[PassNotification] Cannot generate ICS: invalid pass data"),!1;const o=new Blob([n],{type:"text/calendar;charset=utf-8"}),h=URL.createObjectURL(o),g=document.createElement("a");return g.href=h,g.download=`iss-pass-${new Date(a.startTime).toISOString().slice(0,10)}.ics`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(h),!0}async function C3(){return"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.warn("[PassNotification] Browser does not support notifications"),!1)}function M3(a,n,o="iss-pass"){if(Notification.permission!=="granted"){console.warn("[PassNotification] Notification permission not granted");return}const h={body:n,icon:"/iss-tracker-hub/iss-icon.png",badge:"/iss-tracker-hub/iss-badge.png",tag:o,requireInteraction:!0,vibrate:[200,100,200]},g=new Notification(a,h);return g.onclick=()=>{window.focus(),g.close()},g}function k3(a){if(!a||!a.startTime)return[];const n=new Date(a.startTime).getTime(),o=Date.now(),h=[];return[30,10].forEach(w=>{const x=n-w*60*1e3;if(x>o){const c=x-o,k=setTimeout(()=>{const O=rt("notify.title")||"ISS Tracker Hub",Y=rt(w===30?"notify.body30m":"notify.body10m")||`ISS pass in ${w} minutes.`;M3(O,Y)},c);h.push(k),console.log(`[PassNotification] Scheduled ${w}m alert in ${Math.round(c/6e4)}m`)}}),h}async function Mb(a){return a&&!await C3()?(console.warn("[PassNotification] Permission denied"),{success:!1,error:"permission_denied"}):(await T3(a),{success:!0})}function T_(){var n;const a=Ey();return((n=a==null?void 0:a.notifications)==null?void 0:n.passAlerts)===!0}function Lu(a,n="info",o=4e3){let h=document.getElementById("hub-toast-container");h||(h=document.createElement("div"),h.id="hub-toast-container",h.style.cssText=`
            position: fixed;
            bottom: 100px; /* Above bottom nav */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 9999;
            pointer-events: none; /* Allow clicks through gaps */
            width: 90%;
            max-width: 400px;
        `,document.body.appendChild(h));const g=document.createElement("div");g.className=`hub-toast hub-toast-${n}`,g.setAttribute("role","status"),g.setAttribute("aria-live","polite");const w=n==="error"?"#ef4444":"#fcd34d",x="#000000",c=n==="error"?"":"";g.style.cssText=`
        background: ${w};
        color: ${x};
        font-size: 18px; /* Strict 18px */
        font-weight: 700;
        padding: 16px 24px;
        border-radius: 99px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        gap: 12px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        pointer-events: auto;
        cursor: pointer;
        text-align: center;
        justify-content: center;
    `,g.innerHTML=`<span>${c}</span> <span>${a}</span>`,h.appendChild(g),requestAnimationFrame(()=>{g.style.opacity="1",g.style.transform="translateY(0)"});const k=()=>{g.style.opacity="0",g.style.transform="translateY(10px)",setTimeout(()=>{g.parentElement&&g.remove()},300)};g.onclick=k,setTimeout(k,o)}window.showHubToast=Lu;function ss(a,n){const o=document.createElement(a);return n&&(o.className=n),o}function kb(a){const n=String(a);return n.length===1?"0"+n:n}function Hg(a){if(!a||typeof a!="number")return"";const n=new Date(a);return`${kb(n.getHours())}:${kb(n.getMinutes())}`}function R3(){const a=ss("div","pass-card glass"),n=document.createElement("style");n.textContent=`
    .pass-title { font-size: 20px !important; font-weight: 800; letter-spacing: 0.5px; }
    .btn-mini { font-size: 18px !important; padding: 8px 16px; }
    .pass-countdown { 
        font-size: 32px !important; 
        font-family: 'Courier New', monospace; 
        font-weight: 900; 
        letter-spacing: 2px;
        color: var(--accent);
        text-shadow: 0 0 10px rgba(0,243,255,0.4);
    }
    .pass-label { font-size: 18px !important; font-weight: 600; opacity: 0.9; }
    .pass-meta { font-size: 18px !important; color: var(--muted); margin-top: 8px; }
    .pass-extra-line { font-size: 18px !important; color: #ddd; margin-bottom: 6px; }
    .btn-calendar { font-size: 18px !important; min-height: 44px; }
    .btn-notify { font-size: 18px !important; min-height: 44px; }
    .notify-warning { font-size: 18px !important; font-weight: 600; }
  `,a.appendChild(n);const o=ss("div","pass-head"),h=ss("div","pass-title");h.textContent=rt("passCardTitle");const g=ss("button","btn btn-ghost btn-mini pass-details-btn");g.type="button",g.textContent=rt("passDetails"),o.append(h,g);const w=ss("div","pass-countdown");w.textContent="--:--:--",w.style.minHeight="40px";const x=ss("div","pass-label-row"),c=ss("span","pass-dot"),k=ss("span","pass-label");k.textContent="",x.append(c,k);const O=ss("div","pass-meta");O.textContent="";const U=ss("div","pass-extra");U.style.display="none";const Y=ss("div","pass-extra-line"),se=ss("div","pass-extra-line"),xe=ss("button","btn btn-calendar");xe.type="button";const $e=_o();xe.innerHTML=` ${$e==="tr"?"Takvime Ekle":"Add to Calendar"}`,xe.style.cssText=`
    margin-top: 8px;
    padding: 8px 12px;
    font-size: 11px;
    background: rgba(0,243,255,0.2);
    border: 1px solid var(--accent);
    border-radius: 6px;
    color: var(--accent);
    cursor: pointer;
    width: 100%;
    transition: 0.2s;
  `,xe.onmouseenter=()=>xe.style.background="rgba(0,243,255,0.4)",xe.onmouseleave=()=>xe.style.background="rgba(0,243,255,0.2)";const Ce=ss("button","btn btn-notify");Ce.type="button",Ce.style.cssText=`
    margin-top: 8px;
    padding: 8px 12px;
    font-size: 11px;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    cursor: pointer;
    width: 100%;
    transition: 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 6px;
  `;const J=ss("div","notify-warning");J.textContent=rt("notify.keepOpen"),J.style.cssText=`
    font-size: 10px; color: var(--warning); margin-top: 6px; text-align: center; display: none;
  `,U.append(Y,se,xe,Ce,J);const Ye=()=>{T_()?(Ce.innerHTML=rt("notify.btnAlertOn"),Ce.style.background="rgba(255, 215, 0, 0.1)",Ce.style.borderColor="var(--accent)",Ce.style.color="var(--accent)",J.style.display="block"):(Ce.innerHTML=rt("notify.btnAlertOff"),Ce.style.background="rgba(255,255,255,0.05)",Ce.style.borderColor="var(--border)",Ce.style.color="var(--muted)",J.style.display="none")};Ye(),Ce.addEventListener("click",async he=>{if(he.preventDefault(),he.stopPropagation(),T_())await Mb(!1),Ye();else{if(Notification.permission==="denied"){Lu(rt("notify.permDenied"),"error");return}const ae=await Mb(!0);ae.success?(Ye(),Lu(rt("notify.btnAlertOn"),"success")):ae.error==="permission_denied"&&Lu(rt("notify.permDenied"),"error")}}),a.append(o,w,x,O,U);let qe=null,He=!1;function et(he){He=!!he,U.style.display=He?"block":"none",a.classList.toggle("open",He),g.textContent=rt(He?"passClose":"passDetails")}g.addEventListener("click",he=>{he.preventDefault(),et(!He)}),xe.addEventListener("click",he=>{he.preventDefault(),he.stopPropagation(),qe&&P3({startTime:qe.aosMs,duration:Math.round((qe.durationSec||300)/60),maxElevation:qe.maxElevDeg})&&(xe.innerHTML=" "+(_o()==="tr"?"ndirildi!":"Downloaded!"),setTimeout(()=>{xe.innerHTML=" "+(_o()==="tr"?"Takvime Ekle":"Add to Calendar")},2e3))}),a.addEventListener("click",he=>{const oe=he.target;oe&&oe.closest&&(oe.closest(".pass-details-btn")||oe.closest(".btn-calendar"))||et(!He)});function at({visible:he,reason:oe,maxElev:ae}){if(he){c.style.background="#16a34a",k.textContent=rt("passVisible");return}if(c.style.background="#ef4444",oe==="lowAngle"&&typeof ae=="number"){const Ee=rt("passPoorAngle").replace("{deg}",String(Math.round(ae)));k.textContent=Ee;return}k.textContent=rt("passInvisible")}function Qe({nextPass:he,nextVisiblePass:oe,countdownText:ae}){if(w.textContent=ae||"--:--:--",qe=he,!he){at({visible:!1,reason:"invisible",maxElev:null}),O.textContent=rt("passNone"),Y.textContent="",se.textContent="",xe.style.display="none";return}xe.style.display="block";const Ee=Hg(he.aosMs),be=Hg(he.losMs),Se=typeof he.maxElevDeg=="number"?Math.round(he.maxElevDeg):null;O.textContent=`AOS ${Ee}  LOS ${be}  MAX ${Se??""}`;const de=!!he.isVisible,Qt=he.isLowAngle?"lowAngle":de?null:"invisible";at({visible:de,reason:Qt,maxElev:he.maxElevDeg});function mn(In){if(In==null)return"?";const jt=["N","NE","E","SE","S","SW","W","NW"],Ht=Math.round(In/45)%8;return jt[Ht]}const gt=typeof he.durationSec=="number"?he.durationSec:null,vn=gt==null?"":Math.max(1,Math.round(gt/60)),gn=gt==null?"":rt("passMinutes").replace("{min}",vn);let St="";if(he.aosAz!=null&&he.losAz!=null&&(St=`   ${mn(he.aosAz)}  ${mn(he.losAz)}`),Y.textContent=`AOS: ${Ee}  LOS: ${be}  ${rt("passDuration")}: ${gn}${St}`,oe&&typeof oe.aosMs=="number"){const In=Math.max(0,Math.floor((oe.aosMs-Date.now())/1e3)),jt=Math.floor(In/3600),Ht=Math.floor(In%3600/60),Qn=Hg(oe.aosMs);se.textContent=`${rt("passFirstVisible")}: ${rt("passHoursMinutes").replace("{h}",jt).replace("{m}",Ht).replace("{time}",Qn)}`}else se.textContent=`${rt("passFirstVisible")}: ${rt("passNotFoundDetails")}`}return{el:a,setState:Qe,setOpen:et}}function D3(a){const n=document.createElement("div");n.className="mobile-nav glass-panel";const o=document.createElement("style");o.textContent=`
        .mobile-nav { 
            height: 80px !important; /* Large Touch Area */
            padding-bottom: 20px !important; /* Safe Area for modern phones */
            display: flex;
            align-items: center;
            justify-content: space-around;
            background: rgba(10, 10, 20, 0.95);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .nav-item {
            flex: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            background: transparent;
            border: none;
            color: var(--muted);
            transition: 0.2s;
        }
        .nav-icon { font-size: 24px !important; margin-bottom: 4px; }
        .nav-label { 
            font-size: 18px !important; /* Strict 18px */
            font-weight: 600;
        }
        .nav-item.active {
            color: var(--accent);
            background: linear-gradient(to top, rgba(0,243,255,0.1), transparent);
            border-top: 3px solid var(--accent);
        }
        .nav-item.active .nav-label { font-weight: 800; }
    `,n.appendChild(o);const h=[{id:"map",icon:as.map,label:rt("navMap")||"Harita"},{id:"telemetry",icon:as.activity,label:rt("navTelemetry")||"Bilgi"},{id:"nasa",icon:as.video,label:"NASA"},{id:"passes",icon:as.globe,label:rt("navPasses")||"Gei"}];let g="map";function w(){n.innerHTML="",h.forEach(c=>{const k=document.createElement("button");k.className=`nav-item ${g===c.id?"active":""}`,k.innerHTML=`
        <div class="nav-icon">${c.icon}</div>
        <span class="nav-label">${c.label}</span>
      `,k.onclick=()=>x(c.id),n.appendChild(k)})}function x(c){if(!(g===c&&c!=="settings")){if(c==="settings"){a.onSettings&&a.onSettings();return}g=c,w(),a.onChange&&a.onChange(c)}}return w(),{el:n,setActive:x}}function L3(){const a=document.createElement("div");a.className="nasa-card hub-glass",a.style.cssText=`
    width: 100%;
    margin-bottom: 24px;
    border-radius: 16px;
    overflow: hidden;
    position: relative;
    border: 1px solid var(--border);
    background: #000;
  `;const n=document.createElement("div");n.style.cssText=`
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0,243,255,0.05);
    border-bottom: 1px solid var(--border);
  `;const o=document.createElement("div"),h='<span style="display:inline-block; width:10px; height:10px; background:var(--danger); border-radius:50%; margin-right:8px; box-shadow:0 0 8px var(--danger);"></span>';o.innerHTML=h+(rt("nasaTitle")||"NASA Live"),o.style.cssText="font-size: 20px; font-weight: 800; color: var(--accent); display: flex; align-items: center;",n.appendChild(o);const g=document.createElement("div");g.style.cssText=`
    position: relative;
    padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
    height: 0;
    overflow: hidden;
    background: #111;
  `;const w=document.createElement("iframe");w.style.cssText="position:absolute; top:0; left:0; width:100%; height:100%; border:none;",g.appendChild(w);const x=document.createElement("div");x.style.cssText=`
    position: absolute; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 20;
    backdrop-filter: blur(4px);
  `;const c=document.createElement("button");c.className="btn",c.innerHTML=rt("nasaStart")||"Start Stream",c.style.cssText=`
    font-size: 20px; /* Large Text */
    padding: 16px 32px;
    min-height: 60px; /* Large Target */
    border-radius: 99px;
    background: var(--accent);
    color: #000;
    border: none;
    font-weight: 900;
    cursor: pointer;
    box-shadow: 0 0 20px var(--neon-glow);
  `,x.appendChild(c),g.appendChild(x);const k=[{id:"hd",labelKey:"streamCam1",embedUrl:"https://www.youtube.com/embed/xRPjKQtRXR8?autoplay=1&mute=1"},{id:"std",labelKey:"streamTv",embedUrl:"https://www.youtube.com/embed/21X5lGlDOfg?autoplay=1&mute=1"},{id:"media",labelKey:"streamMedia",embedUrl:"https://www.youtube.com/embed/SGP6Y0Pnhe4?autoplay=1&mute=1"}];let O=k[0],U=!1;const Y=document.createElement("div");Y.style.cssText=`
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    border-top: 1px solid var(--border);
    background: rgba(255,255,255,0.02);
  `;const se=()=>{Y.innerHTML="",k.forEach($e=>{const Ce=rt($e.labelKey)||$e.id,J=$e.id===O.id,Ye=document.createElement("button");Ye.style.cssText=`
        background: ${J?"rgba(0,243,255,0.15)":"transparent"};
        border: none;
        border-right: 1px solid var(--border);
        color: ${J?"var(--accent)":"var(--muted)"};
        font-size: 18px; /* Strict 18px */
        font-weight: ${J?"700":"400"};
        padding: 16px 8px;
        min-height: 64px; /* Large Touch Target */
        cursor: pointer;
        transition: 0.2s;
      `,Ye.textContent=Ce,Ye.onclick=()=>{O=$e,se(),U&&xe()},Y.appendChild(Ye)})},xe=()=>{const $e=O.embedUrl;w.src!==$e&&(w.src=$e),x.style.display="none",U=!0};return c.onclick=xe,a.appendChild(n),a.appendChild(g),a.appendChild(Y),se(),{el:a}}function z3(){const a=document.createElement("div");a.className="auth-overlay",a.style.cssText=`
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(8px);
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
  `;const n=document.createElement("div");n.className="auth-modal hub-glass",n.style.cssText=`
    width: 100%;
    max-width: 400px;
    border-radius: 16px;
    padding: 24px;
    background: var(--panel);
    border: 1px solid var(--border);
    box-shadow: 0 0 40px var(--neon-glow);
  `;let o="login";function h(){const x=_o(),c={login:x==="tr"?"Giri Yap":"Sign In",signup:x==="tr"?"Kayt Ol":"Sign Up",reset:x==="tr"?"ifre Sfrla":"Reset Password",email:x==="tr"?"E-posta":"Email",password:x==="tr"?"ifre":"Password",name:x==="tr"?"Ad Soyad":"Full Name",submit:o==="login"?x==="tr"?"Giri":"Login":o==="signup"?x==="tr"?"Kayt Ol":"Sign Up":x==="tr"?"Gnder":"Send",switchToSignup:x==="tr"?"Hesabnz yok mu? Kayt olun":"Don't have an account? Sign up",switchToLogin:x==="tr"?"Zaten hesabnz var m? Giri yapn":"Already have an account? Sign in",forgotPassword:x==="tr"?"ifremi unuttum":"Forgot password",backToLogin:x==="tr"?" Giri ekranna dn":" Back to login",googleSignIn:x==="tr"?"Google ile devam et":"Continue with Google",or:x==="tr"?"veya":"or"};n.innerHTML=`
      <div class="auth-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 class="cyber-glitch-text" data-text="${c[o]}" style="margin: 0; color: var(--accent); font-size: 20px;">
          ${c[o]}
        </h2>
        <button class="auth-close btn" style="font-size: 24px; background: transparent; border: none; color: var(--muted); cursor: pointer;"></button>
      </div>

      <form class="auth-form" style="display: flex; flex-direction: column; gap: 12px;">
        ${o==="signup"?`
          <input type="text" name="name" placeholder="${c.name}" 
            style="padding: 12px 16px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: var(--text); font-size: 14px;"
          />
        `:""}
        
        <input type="email" name="email" placeholder="${c.email}" required
          style="padding: 12px 16px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: var(--text); font-size: 14px;"
        />
        
        ${o!=="reset"?`
          <input type="password" name="password" placeholder="${c.password}" required minlength="6"
            style="padding: 12px 16px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: var(--text); font-size: 14px;"
          />
        `:""}
        
        <div class="auth-error" style="color: #ff4444; font-size: 12px; min-height: 18px;"></div>
        
        <button type="submit" class="btn-primary" style="
          padding: 14px;
          border-radius: 8px;
          background: linear-gradient(135deg, var(--accent), var(--accent-secondary));
          color: #000;
          font-weight: bold;
          font-size: 14px;
          border: none;
          cursor: pointer;
          transition: 0.3s;
        ">${c.submit}</button>
      </form>

      ${o!=="reset"?`
        <div style="text-align: center; margin: 16px 0; color: var(--muted); font-size: 12px;">
           ${c.or} 
        </div>
        
        <button class="btn-google" style="
          width: 100%;
          padding: 12px;
          border-radius: 8px;
          background: #fff;
          color: #333;
          font-size: 13px;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        ">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          ${c.googleSignIn}
        </button>
      `:""}

      <div style="margin-top: 16px; text-align: center; font-size: 12px;">
        ${o==="login"?`
          <a href="#" class="auth-switch" data-mode="signup" style="color: var(--accent); text-decoration: none;">
            ${c.switchToSignup}
          </a>
          <br><br>
          <a href="#" class="auth-switch" data-mode="reset" style="color: var(--muted); text-decoration: none;">
            ${c.forgotPassword}
          </a>
        `:o==="signup"?`
          <a href="#" class="auth-switch" data-mode="login" style="color: var(--accent); text-decoration: none;">
            ${c.switchToLogin}
          </a>
        `:`
          <a href="#" class="auth-switch" data-mode="login" style="color: var(--accent); text-decoration: none;">
            ${c.backToLogin}
          </a>
        `}
      </div>
    `,n.querySelector(".auth-close").onclick=w,n.querySelectorAll(".auth-switch").forEach(Y=>{Y.onclick=se=>{se.preventDefault(),o=Y.dataset.mode,h()}});const k=n.querySelector(".auth-form"),O=n.querySelector(".auth-error");k.onsubmit=async Y=>{var J,Ye,qe;Y.preventDefault(),O.textContent="",O.style.color="#ff4444";const se=k.email.value.trim(),xe=((J=k.password)==null?void 0:J.value)||"",$e=((qe=(Ye=k.name)==null?void 0:Ye.value)==null?void 0:qe.trim())||null;let Ce;try{if(o==="login")Ce=await p3(se,xe);else if(o==="signup")Ce=await d3(se,xe,$e);else if(o==="reset"&&(Ce=await g3(se),Ce.success)){O.style.color="#00ff00",O.textContent=_o()==="tr"?"ifre sfrlama e-postas gnderildi":"Password reset email sent";return}Ce.success?w():(O.textContent=Ce.error||"Authentication error",O.classList.remove("show"),O.offsetWidth,O.classList.add("show"))}catch(He){console.error("[AuthModal] Error:",He),O.textContent=He.message||(_o()==="tr"?"Bir hata olutu":"An error occurred"),O.classList.remove("show"),O.offsetWidth,O.classList.add("show")}};const U=n.querySelector(".btn-google");U&&(U.onclick=async()=>{O.textContent="";try{const Y=await f3();Y.success?w():(O.textContent=Y.error||"Google sign-in failed",O.classList.remove("show"),O.offsetWidth,O.classList.add("show"))}catch(Y){console.error("[AuthModal] Google Error:",Y),O.textContent=Y.message||"Login error",O.classList.remove("show"),O.offsetWidth,O.classList.add("show")}})}function g(x="login"){o=x,h(),a.style.display="flex"}function w(){a.style.display="none"}return a.onclick=x=>{x.target===a&&w()},a.appendChild(n),{el:a,open:g,close:w}}function O3(){const a=document.createElement("div");a.className="user-button-container",a.style.cssText="position: relative;";const n=document.createElement("button");n.className="btn user-btn",n.style.cssText=`
    font-size: 18px; /* Strict 18px */
    padding: 8px 16px;
    min-height: 44px;
    display: flex;
    align-items: center;
    gap: 8px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    cursor: pointer;
  `;function o(h){if(h){const g=h.displayName||h.email.split("@")[0];n.innerHTML=`
        <span style="width: 28px; height: 28px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 14px; color: #000; font-weight: bold;">
          ${g.charAt(0).toUpperCase()}
        </span>
        <span style="max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 700;">${g}</span>
      `}else{const g=_o();n.innerHTML=`
        ${as.user}
        <span style="font-weight: 700;">${g==="tr"?"Giri":"Login"}</span>
      `}}return vT(o),a.appendChild(n),{el:a,button:n}}function F3(){const a=document.createElement("div");a.className="help-overlay",a.style.cssText=`
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.8);
        backdrop-filter: blur(8px);
        z-index: 9999;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
    `;const n=document.createElement("div");n.className="help-modal hub-glass",n.style.cssText=`
        width: 100%;
        max-width: 600px;
        max-height: 80vh;
        border-radius: 16px;
        background: var(--panel);
        border: 1px solid var(--border);
        box-shadow: 0 0 40px var(--neon-glow);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    `;let o="about";function h(){const O=rt("help");O&&(n.innerHTML=`
            <!-- Header -->
            <div class="help-header" style="padding: 16px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 24px; color: var(--accent); font-weight: 900; letter-spacing: 0.5px;">
                    ${as.settings} ${rt("help").tabAbout.split(" ")[0]} 
                </h2>
                <button class="help-close btn" style="font-size: 24px; background: transparent; border: none; color: var(--muted); cursor: pointer; min-width: 44px; min-height: 44px; display: flex; align-items: center; justify-content: center;"></button>
            </div>

            <!-- Tabs (Mandatory Tabbed Interface) -->
            <div class="help-tabs" style="display: flex; border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.2);">
                ${g("about",(O==null?void 0:O.tabAbout)||"About",o==="about")}
                ${g("glossary",(O==null?void 0:O.tabGlossary)||"Glossary",o==="glossary")}
                ${g("tips",(O==null?void 0:O.tabTips)||"Tips",o==="tips")}
                ${g("apis","APIs",o==="apis")}
            </div>

            <!-- Content Area (Scrollable) -->
            <div class="help-content" style="flex: 1; overflow-y: auto; padding: 24px;">
                ${w(o,O)}
            </div>
        `,n.querySelector(".help-close").onclick=k,n.querySelectorAll(".help-tab-btn").forEach(U=>{U.onclick=()=>{o=U.dataset.tab,h()}}))}function g(O,U,Y){return`
            <button class="help-tab-btn" data-tab="${O}" style="
                flex: 1;
                padding: 16px; 
                min-height: 54px; /* >44px */
                background: transparent;
                border: none;
                font-size: 18px; /* Strict 18px */
                font-weight: 800;
                cursor: pointer;
                transition: all 0.2s;
                ${Y?"border-bottom: 3px solid var(--accent); color: var(--accent); background: rgba(255,255,255,0.05);":"border-bottom: 3px solid transparent; color: var(--muted);"}
            ">
                ${U}
            </button>
        `}function w(O,U){const Y="font-size: 18px; line-height: 1.6; margin-bottom: 16px; color: var(--text);",se="font-size: 20px; font-weight: 800; color: var(--accent); margin-bottom: 8px; margin-top: 24px;";if(O==="about")return`
                <h3 style="${se} margin-top: 0;">${(U==null?void 0:U.aboutTitle)||"About ISS"}</h3>
                <p style="${Y}">${(U==null?void 0:U.aboutText1)||""}</p>
                <p style="${Y}">${(U==null?void 0:U.aboutText2)||""}</p>
                
                <div style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 12px; margin-top: 24px;">
                    <div style="${Y} font-weight: 700;"> ${(U==null?void 0:U.aboutSize)||""}</div>
                    <div style="${Y} font-weight: 700;"> ${(U==null?void 0:U.aboutSpeed)||""}</div>
                </div>
            `;if(O==="glossary")return`
                ${x((U==null?void 0:U.termAos)||"AOS",(U==null?void 0:U.defAos)||"",se,Y)}
                ${x((U==null?void 0:U.termLos)||"LOS",(U==null?void 0:U.defLos)||"",se,Y)}
                ${x((U==null?void 0:U.termAlt)||"Altitude",(U==null?void 0:U.defAlt)||"",se,Y)}
                ${x((U==null?void 0:U.termMag)||"Brightness",(U==null?void 0:U.defMag)||"",se,Y)}
            `;if(O==="tips")return`
                 ${x((U==null?void 0:U.tip1Title)||"Tip 1",(U==null?void 0:U.tip1Text)||"",se,Y)}
                 ${x((U==null?void 0:U.tip2Title)||"Tip 2",(U==null?void 0:U.tip2Text)||"",se,Y)}
                 ${x((U==null?void 0:U.tip3Title)||"Tip 3",(U==null?void 0:U.tip3Text)||"",se,Y)}
            `;if(O==="apis")return`
                <h3 style="${se} margin-top: 0;">Data Sources & APIs</h3>
                ${x("Where The ISS At?","Real-time telemetry and coordinate data.",se,Y)}
                ${x("Open Notify","Current crew information provided by NASA.",se,Y)}
                ${x("Open-Meteo","Real-time weather data for ground locations.",se,Y)}
                ${x("Nominatim (OSM)","Reverse geocoding to find city names.",se,Y)}
                ${x("MapTiler Cloud","High-performance map tiles (Dark Matter).",se,Y)}
                ${x("NASA YouTube","Official live video streams from the station.",se,Y)}
            `}function x(O,U,Y,se,xe=""){return`
            <div style="margin-bottom: 24px; border-bottom: 1px solid var(--ring); padding-bottom: 16px;">
                <div style="${Y} margin-top: 0;">${xe} ${O}</div>
                <div style="${se} margin-bottom: 0;">${U}</div>
            </div>
        `}function c(){h(),a.style.display="flex"}function k(){a.style.display="none"}return a.onclick=O=>{O.target===a&&k()},a.appendChild(n),{el:a,open:c,close:k}}function N3(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}const bT="isshub:intro-seen";function V3(){const a=localStorage.getItem(bT);if(a){const n=Date.now()-36e5;if(parseInt(a)>n)return!0}return!!N3()}function B3(a){if(V3())return a&&setTimeout(a,0),null;localStorage.setItem(bT,Date.now().toString());const n=document.createElement("div");n.id="intro-overlay",n.className="intro-overlay",n.innerHTML=`
    <div class="intro-container">
      <div class="intro-iss-icon">
        <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="50" cy="50" r="45" stroke="var(--accent)" stroke-width="1" opacity="0.3"/>
          <circle cx="50" cy="50" r="35" stroke="var(--accent)" stroke-width="1" opacity="0.5"/>
          <circle cx="50" cy="50" r="25" stroke="var(--accent)" stroke-width="2"/>
          <!-- ISS Icon -->
          <rect x="35" y="45" width="30" height="10" fill="var(--accent)" rx="2"/>
          <rect x="25" y="42" width="10" height="16" fill="var(--accent)" opacity="0.8"/>
          <rect x="65" y="42" width="10" height="16" fill="var(--accent)" opacity="0.8"/>
          <rect x="18" y="38" width="7" height="24" fill="var(--accent)" opacity="0.6"/>
          <rect x="75" y="38" width="7" height="24" fill="var(--accent)" opacity="0.6"/>
          <!-- Blinking dot -->
          <circle class="intro-blink" cx="50" cy="50" r="3" fill="#ff0000"/>
        </svg>
      </div>
      <h1 class="intro-title">ISS Tracker HUB</h1>
      <p class="intro-subtitle">Real-time Space Station Tracking</p>
      <div class="intro-loader">
        <div class="intro-loader-bar"></div>
      </div>
      <p class="intro-status">Loading orbit data...</p>
    </div>
  `;const o=document.createElement("style");o.textContent=`
    .intro-overlay {
      position: fixed;
      inset: 0;
      z-index: 99999;
      background: var(--bg, #0a0a12);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 1;
      transition: opacity 0.6s ease;
    }
    
    .intro-overlay.fade-out {
      opacity: 0;
      pointer-events: none;
    }
    
    .intro-container {
      text-align: center;
      animation: intro-fade-in 0.8s ease;
    }
    
    .intro-iss-icon {
      width: 120px;
      height: 120px;
      margin: 0 auto 24px;
      animation: intro-pulse 2s infinite ease-in-out;
    }
    
    .intro-iss-icon svg {
      width: 100%;
      height: 100%;
    }
    
    .intro-blink {
      animation: intro-blink 1s infinite;
    }
    
    .intro-title {
      font-family: 'Orbitron', monospace;
      font-size: 28px;
      font-weight: 700;
      color: var(--accent, #00f3ff);
      margin: 0 0 8px;
      letter-spacing: 4px;
      text-transform: uppercase;
      animation: intro-slide-up 0.8s ease 0.2s both;
    }
    
    .intro-subtitle {
      font-size: 14px;
      color: var(--muted, rgba(255,255,255,0.6));
      margin: 0 0 32px;
      letter-spacing: 2px;
      animation: intro-slide-up 0.8s ease 0.4s both;
    }
    
    .intro-loader {
      width: 200px;
      height: 3px;
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
      margin: 0 auto 16px;
      overflow: hidden;
      animation: intro-slide-up 0.8s ease 0.5s both;
    }
    
    .intro-loader-bar {
      width: 0;
      height: 100%;
      background: var(--accent, #00f3ff);
      border-radius: 2px;
      animation: intro-load 2s ease-out forwards;
    }
    
    .intro-status {
      font-size: 11px;
      color: var(--muted, rgba(255,255,255,0.5));
      margin: 0;
      animation: intro-slide-up 0.8s ease 0.6s both;
    }
    
    @keyframes intro-fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes intro-slide-up {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes intro-pulse {
      0%, 100% {
        transform: scale(1);
        filter: drop-shadow(0 0 10px var(--accent));
      }
      50% {
        transform: scale(1.05);
        filter: drop-shadow(0 0 20px var(--accent));
      }
    }
    
    @keyframes intro-blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.2; }
    }
    
    @keyframes intro-load {
      0% { width: 0; }
      20% { width: 20%; }
      50% { width: 60%; }
      80% { width: 85%; }
      100% { width: 100%; }
    }
  `,document.head.appendChild(o),document.body.appendChild(n);const h=n.querySelector(".intro-status"),g=["Loading orbit data...","Calculating trajectory...","Connecting to telemetry...","Almost ready..."];let w=0;const x=setInterval(()=>{w++,w<g.length&&(h.textContent=g[w])},500);return setTimeout(()=>{clearInterval(x),n.classList.add("fade-out"),setTimeout(()=>{n.remove(),o.remove(),a&&a()},600)},2500),n}const wT=[{key:"wheretheiss",name:"Where The ISS At",url:"api.wheretheiss.at",icon:""},{key:"opennotify",name:"Open Notify",url:"api.open-notify.org",icon:""},{key:"celestrak",name:"CelesTrak TLE",url:"celestrak.org",icon:""},{key:"openmeteo",name:"Open-Meteo",url:"api.open-meteo.com",icon:""},{key:"nominatim",name:"Nominatim/OSM",url:"nominatim.openstreetmap.org",icon:""},{key:"wikipedia",name:"Wikipedia",url:"en.wikipedia.org",icon:""}];let os=null;function U3(a,n){if(os)return os;os=document.createElement("div"),os.id="api-status-widget",os.className="api-status-widget",os.innerHTML=`
    <div class="api-status-header">
      <span class="api-status-icon"></span>
      <span class="api-status-title">API Durumlar</span>
      <button class="api-status-toggle" aria-label="Collapse"></button>
    </div>
    <div class="api-status-body">
      <div class="api-status-list"></div>
      <div class="api-status-footer">
        <span class="api-call-count">0 ar</span>
        <span class="session-time">0dk</span>
      </div>
    </div>
  `;const o=os.querySelector(".api-status-toggle"),h=os.querySelector(".api-status-body");h.classList.add("collapsed"),o.textContent="",o.addEventListener("click",()=>{h.classList.toggle("collapsed"),o.textContent=h.classList.contains("collapsed")?"":""});const g=os.querySelector(".api-status-list");return wT.forEach(w=>{const x=document.createElement("div");x.className="api-status-item",x.dataset.api=w.key,x.innerHTML=`
      <span class="api-icon">${w.icon}</span>
      <span class="api-name">${w.name}</span>
      <span class="api-indicator" data-status="idle"></span>
      <span class="api-response-time"></span>
    `,g.appendChild(x)}),n&&n.subscribe(w=>{j3(w)}),a.appendChild(os),os}function j3(a){if(!os)return;const n=a.apis||{},o=a.session||{};wT.forEach(w=>{const x=os.querySelector(`[data-api="${w.key}"]`);if(!x)return;const c=n[w.key]||{},k=x.querySelector(".api-indicator"),O=x.querySelector(".api-response-time");k.dataset.status=c.status||"idle",c.responseTime?O.textContent=`${c.responseTime}ms`:c.status==="error"?O.textContent="":O.textContent=""});const h=os.querySelector(".api-call-count"),g=os.querySelector(".session-time");if(h&&(h.textContent=`${o.apiCallCount||0} ar`),g&&o.startedAt){const w=Math.floor((Date.now()-o.startedAt)/6e4);g.textContent=`${w}dk`}}function sc(a,n=2){return typeof a!="number"||Number.isNaN(a)?"--":a.toFixed(n)}function Wg(a){const n=Math.max(0,Math.floor(a));return n<10?`0${n}`:`${n}`}function Rb(a){return Math.max(-85,Math.min(85,a))}function Db(a){let n=a;for(;n>180;)n-=360;for(;n<-180;)n+=360;return n}const Sy={getItem:a=>{try{return window.localStorage?window.localStorage.getItem(a):null}catch(n){return console.warn("[Storage] getItem failed:",n),null}},setItem:(a,n)=>{try{window.localStorage&&window.localStorage.setItem(a,n)}catch(o){console.warn("[Storage] setItem failed:",o)}}};function Wn(a,n,o){const h=document.createElement(a);return n&&(h.className=n),o&&o.appendChild(h),h}const $3="isshub:skin";function q3(){const a=Sy.getItem($3);return a==="cyberpunk"||a==="liquid"||a==="realistic"?a:"realistic"}function G3(a){var h,g,w,x,c,k,O,U,Y,se,xe,$e,Ce,J,Ye,qe,He,et,at,Qe,he,oe,ae,Ee,be,Se,de;document.documentElement.setAttribute("data-skin",a);const o=window.issLights;if(o)try{a==="cyberpunk"?((w=(g=(h=o.sun)==null?void 0:h.color)==null?void 0:g.set)==null||w.call(g,16738047),(k=(c=(x=o.ambient)==null?void 0:x.color)==null?void 0:c.set)==null||k.call(c,65518),o.sun&&(o.sun.intensity=.6),o.ambient&&(o.ambient.intensity=.18),(Y=(U=(O=o.starsMat)==null?void 0:O.color)==null?void 0:U.set)==null||Y.call(U,16738047)):a==="liquid"?(($e=(xe=(se=o.sun)==null?void 0:se.color)==null?void 0:xe.set)==null||$e.call(xe,16777215),(Ye=(J=(Ce=o.ambient)==null?void 0:Ce.color)==null?void 0:J.set)==null||Ye.call(J,16777215),o.sun&&(o.sun.intensity=.85),o.ambient&&(o.ambient.intensity=.32),(et=(He=(qe=o.starsMat)==null?void 0:qe.color)==null?void 0:He.set)==null||et.call(He,16777215)):((he=(Qe=(at=o.sun)==null?void 0:at.color)==null?void 0:Qe.set)==null||he.call(Qe,16774629),(Ee=(ae=(oe=o.ambient)==null?void 0:oe.color)==null?void 0:ae.set)==null||Ee.call(ae,16777215),o.sun&&(o.sun.intensity=.55),o.ambient&&(o.ambient.intensity=.14),(de=(Se=(be=o.starsMat)==null?void 0:be.color)==null?void 0:Se.set)==null||de.call(Se,16777215))}catch{}}const TT="isshub:place_v2";function H3(){try{const a=Sy.getItem(TT);if(!a)return null;const n=JSON.parse(a);return!n||typeof n!="object"?null:{cityName:typeof n.cityName=="string"?n.cityName:null,districtName:typeof n.districtName=="string"?n.districtName:null,neighborhoodName:typeof n.neighborhoodName=="string"?n.neighborhoodName:null,displayName:typeof n.displayName=="string"?n.displayName:null,osmType:typeof n.osmType=="string"?n.osmType:null,osmId:typeof n.osmId=="string"?n.osmId:null,lat:typeof n.lat=="number"?n.lat:null,lon:typeof n.lon=="number"?n.lon:null}}catch{return null}}function W3(a){try{Sy.setItem(TT,JSON.stringify(a))}catch{}}function rf(a){if(!a)return"Konumum";const n=[];return a.cityName&&n.push(a.cityName),a.districtName&&n.push(a.districtName),a.neighborhoodName&&n.push(a.neighborhoodName),n.join(" / ")||"Konumum"}function Z3(){const a=((dn==null?void 0:dn.NOMINATIM_PROXY_URL)||"").trim();return a?a.replace(/\/+$/,""):"https://nominatim.openstreetmap.org"}async function Lb(a,n){const o=Z3(),h=new URL(o+a),g=new URLSearchParams({format:"jsonv2",addressdetails:"1",...n});dn!=null&&dn.NOMINATIM_EMAIL&&g.set("email",String(dn.NOMINATIM_EMAIL)),h.search=g.toString();const w=await fetch(h.toString(),{cache:"no-store"});if(!w.ok)throw new Error(`nominatim http ${w.status}`);return await w.json()}function zb(a){const n=(a==null?void 0:a.address)||{},o=n.city||n.town||n.village||n.municipality||n.county||n.state||null,h=n.city_district||n.district||n.borough||n.county||n.state_district||null,g=n.neighbourhood||n.suburb||n.quarter||n.hamlet||null,w=(a==null?void 0:a.lat)!=null?Number(a.lat):null,x=(a==null?void 0:a.lon)!=null?Number(a.lon):null,c=a!=null&&a.osm_type?String(a.osm_type):null,k=(a==null?void 0:a.osm_id)!=null?String(a.osm_id):null;return{cityName:o,districtName:h,neighborhoodName:g,displayName:a!=null&&a.display_name?String(a.display_name):null,osmType:c,osmId:k,lat:Number.isFinite(w)?w:null,lon:Number.isFinite(x)?x:null}}async function K3({timeoutMs:a=9e3}={}){if(!navigator.geolocation)throw new Error("geolocation not supported");return await new Promise((n,o)=>{const h=setTimeout(()=>o(new Error("timeout")),a);navigator.geolocation.getCurrentPosition(g=>{clearTimeout(h),n({lat:Number(g.coords.latitude),lon:Number(g.coords.longitude),accuracy:Number(g.coords.accuracy)})},g=>{clearTimeout(h),o(g||new Error("geolocation error"))},{enableHighAccuracy:!0,maximumAge:15e3,timeout:a})})}async function X3(a,n){if(!n)throw new Error("rootEl missing");B3(()=>{console.log("[boot] Intro complete")});try{const je=await WI();console.log(`[boot] Language initialized: ${je}`)}catch(je){console.warn("[boot] i18n initialization failed:",je)}n.innerHTML="";const o=Wn("div","hub",n),h=Wn("div","hub-map",o);h.id="map";const g=Wn("div","hub-overlay",o),w=Wn("div","hub-topbar hub-glass",g),x=Wn("div","hub-brand",w);Wn("div","hub-logo",x).setAttribute("aria-hidden","true");const k=Wn("div","hub-title",x),O=Wn("div","t",k);O.textContent="ISS Tracker HUB";const U=Wn("div","s",k);U.textContent="beta";const Y=Wn("div","hub-actions",w),se=Wn("button","btn hub-pill",Y),xe=Wn("div","hub-dot",se),$e=Wn("div","",se),Ce=rt("follow")==="Takip"?"Modu":"Mode";$e.innerHTML=`<span style="font-weight:400; opacity:0.8">ISS ${Ce}:</span> <strong>${rt("on")}</strong>`,se.setAttribute("aria-label",rt("follow")),se.style.minHeight="44px";const J=Wn("button","btn settings-btn",Y);J.type="button",J.innerHTML=`${as.settings} <span>${rt("settings")}</span>`,J.title=rt("settings"),J.setAttribute("aria-label",rt("settings")),J.style.cssText="font-size: 18px; padding: 8px 16px; min-height: 44px;";const Ye=E3({onOpenLocation:()=>we()});n.appendChild(Ye.el),J.addEventListener("click",()=>{Ye.open()});const qe=z3();n.appendChild(qe.el);const He=F3();n.appendChild(He.el);const et=Wn("button","btn help-btn",Y);et.type="button";const at='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>';et.innerHTML=`${at} <span>${rt("helpTitle").split(" ")[0]}</span>`,et.title=rt("helpTitle"),et.setAttribute("aria-label",rt("helpTitle")),et.style.cssText="font-size: 18px; padding: 8px 16px; min-height: 44px;",et.addEventListener("click",()=>{He.open()});const Qe=O3();Y.insertBefore(Qe.el,J),Qe.button.addEventListener("click",()=>{Ty()?confirm(rt("authLogout")+"?")&&m3():qe.open("login")});const he=hS();n.appendChild(he.el);const oe=I3();n.appendChild(oe.el),U3(n,a);const ae=he.getLogFn(),Ee=Wn("div","hub-ver",g),be=Wn("div","pass-section",g);be.id="pass-section",be.style.cssText=`
    position: fixed;
    bottom: 20px;
    right: 20px;
    max-width: 320px;
    width: calc(100% - 40px);
    z-index: 200;
    display: block;
  `;const Se=R3();be.appendChild(Se.el),Ee.textContent=(dn==null?void 0:dn.VERSION)||"v0.2.2";const de=Wn("div","nasa-section",g);de.id="nasa-section",de.style.cssText=`
    position: fixed;
    top: 80px;
    right: 20px;
    max-width: 360px;
    width: calc(40% - 20px);
    min-width: 280px;
    z-index: 150;
    display: block;
  `;const Qt=L3();de.appendChild(Qt.el);const mn=Wn("div","nasa-note",de);mn.style.cssText=`
    font-size: 10px;
    color: var(--muted);
    text-align: center;
    padding: 8px;
    opacity: 0.7;
  `,mn.textContent=rt("nasaNote")||" Stream may have interruptions based on ISS signal status.";const gt={cityName:"Konumum",districtName:null,neighborhoodName:null,obsLat:null,obsLon:null,prediction:null,lastPredictionRefresh:0,predictionBusy:!1,lastTelemetryLogAt:0,lastTelemetryAt:0,lastIssLat:null,lastIssLon:null};function vn(je){if(!je){gt.prediction=null;return}const dt=Number(je.maxElev),Fe=!!je.visible,wt=Number((dn==null?void 0:dn.MIN_ELEVATION)??15);gt.prediction={aosMs:Number(je.aosMs),losMs:Number(je.losMs),maxElevDeg:Number.isFinite(dt)?dt:0,visible:Fe,reason:Fe?"":`MAX ${Math.round(dt)} < ${wt}`,hint:""}}const gn=S3({getPassState:()=>({loading:gt.predictionBusy,calculating:gt.predictionBusy,pass:gt.prediction,hasLocation:Number.isFinite(gt.obsLat)&&Number.isFinite(gt.obsLon),error:!1}),onShowPass:()=>{const je=document.getElementById("pass-section");je&&je.style.display!=="none"&&(je.scrollIntoView({behavior:"smooth",block:"start"}),je.classList.add("highlight"),setTimeout(()=>je.classList.remove("highlight"),2e3))},onLiveTrack:()=>{Zt(!0)}});gn.el&&n.appendChild(gn.el);async function St({forceLog:je=!1}={}){const dt=gt.obsLat,Fe=gt.obsLon;if(!Number.isFinite(dt)||!Number.isFinite(Fe)){je&&ae(rt("passNoLocation"));return}if(!gt.predictionBusy){gt.predictionBusy=!0;try{ae(rt("passCalculating")+` (obs=${sc(dt,3)},${sc(Fe,3)})`);const wt=await RI({obsLat:dt,obsLon:Fe}),Nt=(wt==null?void 0:wt.nextPass)||null;vn(Nt),Nt&&T_()&&k3({startTime:Nt.aosMs,maxElevation:Nt.maxElev}),gt.lastPredictionRefresh=Date.now(),ae(Nt?`pass> bulundu: AOS=${new Date(Nt.aosMs).toLocaleTimeString()} LOS=${new Date(Nt.losMs).toLocaleTimeString()} MAX=${Math.round(Nt.maxElev)} ${Nt.visible?"":""}`:rt("passNotFound"))}catch(wt){ae(rt("passError")+`: ${String((wt==null?void 0:wt.message)||wt)}`),gt.prediction=null}finally{gt.predictionBusy=!1}}}function In(){const je=gt.prediction;if(window.innerWidth>768&&(be.style.display="block"),je&&je.aosMs){const dt=Date.now(),Fe=je.aosMs-dt,wt=Math.max(0,Math.floor(Fe/1e3)),Nt=Math.floor(wt/3600),jn=Math.floor(wt%3600/60),Ue=wt%60,$n=`${String(Nt).padStart(2,"0")}:${String(jn).padStart(2,"0")}:${String(Ue).padStart(2,"0")}`;Se.setState({nextPass:je,nextVisiblePass:je.visible?je:null,countdownText:$n})}else Se.setState({nextPass:null,nextVisiblePass:null,countdownText:gt.predictionBusy?rt("passCalculating"):"--:--:--"})}const jt=sI(h,{center:(dn==null?void 0:dn.DEFAULT_CENTER)||[35,39],zoom:(dn==null?void 0:dn.DEFAULT_ZOOM)||4,onUserInteraction:()=>{Zt(!1)}}),{map:Ht,issMarker:Qn}=jt;let kn=!0,Et=0,xt=qI(),At=null,Wt=!1,pn=null;function Zt(je){if(kn=!!je,xe.style.opacity=je?"1":"0.35",$e.textContent=rt(je?"followActive":"followInactive"),se.style.opacity=je?"1":"0.85",xt==="3d"&&At)try{je?At.startFollow():At.stopFollow()}catch(dt){console.warn("Globe follow control error:",dt)}}Zt(!0),se.style.cursor="pointer",se.addEventListener("click",()=>Zt(!kn));async function ur(){if(At||Wt)return At;Wt=!0;try{const dt=(await eI(()=>import("./globeView-C714DAHl.js").then(Fe=>Fe.dq),[])).globeActions;return At=await dt.createGlobe(n),At=dt,G3(q3()),At}catch(je){ae(rt("globeLoadFailed")+`: ${(je==null?void 0:je.message)||je}`);try{At==null||At.setVisible(!1)}catch{}return At=null,null}finally{Wt=!1}}function Sn(je){xt=je==="3d"?"3d":"2d";const dt=400;if(xt==="3d")h.style.transition=`opacity ${dt}ms ease`,h.style.opacity="0",setTimeout(()=>{h.style.display="none",h.style.opacity="1"},dt),ur().then(Fe=>{if(!Fe){h.style.display="block";try{pn==null||pn.setMode("2d")}catch{}return}if(Fe.setVisible(!0),Number.isFinite(gt.lastIssLat)&&Number.isFinite(gt.lastIssLon))try{Fe.setIssPosition(gt.lastIssLat,gt.lastIssLon)}catch{}if(kn)try{Fe.startFollow()}catch{}try{window._applyTrajectoryToGlobe&&window._applyTrajectoryToGlobe()}catch{}}).catch(Fe=>{ae(rt("globeError")+`: ${(Fe==null?void 0:Fe.message)||Fe}`),h.style.display="block";try{pn==null||pn.setMode("2d")}catch{}});else{const Fe=document.getElementById("globe-3d-canvas-container");if(Fe)Fe.style.transition=`opacity ${dt}ms ease`,Fe.style.opacity="0",setTimeout(()=>{try{At==null||At.setVisible(!1)}catch{}Fe.style.opacity="1"},dt);else try{At==null||At.setVisible(!1)}catch{}h.style.opacity="0",h.style.display="block",setTimeout(()=>{h.style.transition=`opacity ${dt}ms ease`,h.style.opacity="1"},50);try{At==null||At.stopFollow()}catch{}}}const Fn=HI({initialMode:xt,onChange:je=>Sn(je),onFocusChange:je=>{if(At&&At.setFocusMode)try{At.setFocusMode(je),ae(`[3D] Focus mode: ${je==="iss"?"ISS takibi":"Dnya grnm"}`)}catch(dt){console.warn("Globe focus mode error:",dt)}}});pn=Fn,n.appendChild(Fn.el),Sn(xt);const Vt=XI();n.appendChild(Vt.el);let Jt=0;async function Cn(je,dt){const Fe=Date.now(),wt=Number((dn==null?void 0:dn.INTERVAL_WEATHER_REFRESH_MS)??45e3);if(!(Fe-Jt<wt)){Jt=Fe;try{const Nt=await QI({lat:je,lon:dt}),jn=JI(Nt.code),Ue=Nt.timeIso?Nt.timeIso.replace("T"," "):null;Vt.setState({placeLabel:`ISS alt (${sc(je,1)}, ${sc(dt,1)})`,tempC:Nt.tempC,windKmh:Nt.windKmh,codeLabel:jn,timeLabel:Ue,code:Nt.code})}catch{Vt.setState({placeLabel:"ISS alt",tempC:NaN,windKmh:NaN,codeLabel:"Hava alnamad",timeLabel:null})}}}a&&typeof a=="object"&&(a.actions||(a.actions={}),a.actions.openCityPicker=()=>we());const Mt=Wn("div","loc-overlay",n),Kt=Wn("div","loc-card hub-glass",Mt),$t=Wn("div","loc-top",Kt),Ot=Wn("div","loc-title",$t);Ot.textContent=rt("locationModalTitle");const tn=Wn("button","btn",$t);tn.type="button",tn.textContent=rt("close");const nn=Wn("div","loc-body",Kt),Rn=Wn("div","",nn);Rn.style.fontWeight="900",Rn.style.opacity="0.9",Rn.textContent=rt("locationModalDesc");const xn=Wn("div","loc-row",nn),Xt=Wn("button","btn",xn);Xt.type="button",Xt.textContent=rt("useMyLocation");const Pe=Wn("button","btn",xn);Pe.type="button",Pe.textContent=rt("searchLocation");const W=Wn("input","loc-search",nn);W.type="search",W.placeholder=rt("searchPlaceholder"),W.disabled=!0;const H=Wn("div","loc-list",nn);H.style.opacity="0.6";const X=Wn("div","loc-picked",nn);X.textContent=rt("selection")+": ";const fe=Wn("span","small",X);fe.textContent="";const ge=Wn("div","loc-row",nn),V=Wn("button","btn",ge);V.type="button",V.textContent=rt("save"),V.disabled=!0;let Ie=null;function we(){Mt.style.display="flex"}function ke(){Mt.style.display="none"}tn.addEventListener("click",ke),Mt.addEventListener("click",je=>{je.target===Mt&&ke()});function Ge(je){if(Ie=je,!je){X.firstChild.textContent=`${rt("selection")}: `,fe.textContent="",V.disabled=!0;return}X.firstChild.textContent=`${rt("selection")}: ${rf(je)||""}`,fe.textContent=je.displayName?je.displayName:"",V.disabled=!(je.lat!=null&&je.lon!=null)}function Be(je){H.innerHTML="",H.style.opacity="1";const dt=(je||"").trim().toLowerCase(),Fe=oI.filter(wt=>dt?wt.name.toLowerCase().includes(dt):!0).slice(0,40);for(const wt of Fe){const Nt=document.createElement("button");Nt.type="button",Nt.className="btn",Nt.style.textAlign="left",Nt.style.padding="10px 12px",Nt.style.borderRadius="14px",Nt.textContent=wt.name,Nt.addEventListener("click",()=>{Ge({cityName:wt.name,districtName:null,neighborhoodName:null,displayName:wt.name,osmType:"fallback",osmId:`tr-city:${wt.name}`,lat:Number(wt.lat),lon:Number(wt.lon)})}),H.appendChild(Nt)}}function it(je){if(H.innerHTML="",H.style.opacity="1",!Array.isArray(je)||je.length===0){const dt=document.createElement("div");dt.style.opacity="0.85",dt.style.fontWeight="900",dt.style.fontSize="13px",dt.textContent=rt("noResults"),H.appendChild(dt);return}for(const dt of je){const Fe=zb(dt),wt=document.createElement("button");wt.type="button",wt.className="btn",wt.style.textAlign="left",wt.style.padding="10px 12px",wt.style.borderRadius="14px",wt.textContent=Fe.displayName||rf(Fe)||"",wt.addEventListener("click",()=>Ge(Fe)),H.appendChild(wt)}}let ft=null;async function It(je){try{const dt=await Lb("/search",{q:je,limit:"12"});it(dt)}catch(dt){ae(rt("locSearchFailed")+`: ${String((dt==null?void 0:dt.message)||dt)}`),Be(je)}}W.addEventListener("input",()=>{const je=(W.value||"").trim();if(ft&&clearTimeout(ft),je.length<3){H.innerHTML="",H.style.opacity="0.6",Ge(null);return}ft=setTimeout(()=>It(je),250)}),Pe.addEventListener("click",()=>{W.disabled=!1,W.focus(),H.innerHTML="",H.style.opacity="0.6",Ge(null)}),Xt.addEventListener("click",async()=>{try{ae(rt("locGpsRequesting"));const je=await K3({timeoutMs:9e3}),dt=await Lb("/reverse",{lat:String(je.lat),lon:String(je.lon),zoom:"18"}),Fe=zb(dt);if(!Fe||Fe.lat==null||Fe.lon==null)throw new Error("reverse empty");Ge(Fe),V.disabled=!1,ae(rt("locGpsSuccess")+`: ${rf(Fe)}`)}catch(je){ae(rt("locGpsFailed")+` (${String((je==null?void 0:je.message)||je)})`),W.disabled=!1,W.focus()}}),V.addEventListener("click",async()=>{Ie&&(W3({cityName:Ie.cityName||null,districtName:Ie.districtName||null,neighborhoodName:Ie.neighborhoodName||null,displayName:Ie.displayName||null,osmType:Ie.osmType||null,osmId:Ie.osmId||null,lat:Ie.lat,lon:Ie.lon}),gt.cityName=Ie.cityName||"Konumum",gt.districtName=Ie.districtName||null,gt.neighborhoodName=Ie.neighborhoodName||null,gt.obsLat=Number(Ie.lat),gt.obsLon=Number(Ie.lon),ae(rt("locSaved")+`: ${rf(Ie)}`),Lu(rt("locSaved")||"Location Saved","success"),ke(),await St({forceLog:!0}),In())});const kt=H3();(kt!=null&&kt.cityName||kt!=null&&kt.displayName)&&(gt.cityName=kt.cityName||"Konumum",gt.districtName=kt.districtName||null,gt.neighborhoodName=kt.neighborhoodName||null,gt.obsLat=Number.isFinite(kt.lat)?kt.lat:null,gt.obsLon=Number.isFinite(kt.lon)?kt.lon:null);let Ft=null;function Me(){Ft&&clearInterval(Ft),Ft=setInterval(()=>{In();const je=Date.now(),dt=Number((dn==null?void 0:dn.INTERVAL_PREDICTION_REFRESH)??6e4);je-gt.lastPredictionRefresh>dt&&!gt.predictionBusy&&St().then(()=>In())},Number((dn==null?void 0:dn.INTERVAL_UI_TICK)??1e3))}In(),Me();let rn=0,An=null;async function Ct(){var je,dt,Fe,wt;try{const Nt=Date.now();if(Nt-rn<45*1e3)return;rn=Nt,ae("[Trajectory] Hesaplanyor...");const jn=await DI({pastMinutes:45,futureMinutes:90,stepSeconds:30});console.log("[Trajectory] Raw data:",jn),An=jn;const Ue=q0(jn.past),$n=q0(jn.future);console.log("[Trajectory] Past GeoJSON features:",((dt=(je=Ue==null?void 0:Ue.geometry)==null?void 0:je.coordinates)==null?void 0:dt.length)||0),console.log("[Trajectory] Future GeoJSON features:",((wt=(Fe=$n==null?void 0:$n.geometry)==null?void 0:Fe.coordinates)==null?void 0:wt.length)||0),jt&&jt.updateTrajectory?jt.updateTrajectory(Ue,$n):console.warn("[Trajectory] mapView or updateTrajectory not available"),At&&At.updateTrajectory&&At.updateTrajectory(jn.past,jn.future),ae(`[Trajectory]  ${jn.past.length} gemi + ${jn.future.length} gelecek nokta`)}catch(Nt){console.error("[Trajectory] Error:",Nt),ae(rt("trajectoryError")+`: ${(Nt==null?void 0:Nt.message)||Nt}`)}}function Yt(){An&&At&&At.updateTrajectory&&At.updateTrajectory(An.past,An.future)}window._applyTrajectoryToGlobe=Yt,jt&&jt.map&&(jt.map.loaded()?Ct():jt.map.once("load",()=>{Ct()})),setInterval(()=>{Ct()},60*1e3),$I({onPosition:je=>{const dt=Rb(je.lat),Fe=Db(je.lng);if(xt==="3d"&&At)try{At.setIssPosition(dt,Fe)}catch{}gt.lastIssLat=dt,gt.lastIssLon=Fe},onData:je=>{if(!je)return;const dt=Rb(je.lat),Fe=Db(je.lon);xt==="2d"&&jt.updateISSPosition(dt,Fe),he.update({altitude:je.altKm,velocity:je.velKmh||27580,latitude:je.lat,longitude:je.lon,visibility:"daylight"});const wt=new Date;`${Wg(wt.getHours())}${Wg(wt.getMinutes())}${Wg(wt.getSeconds())}${je.source}`;const Nt=Number((dn==null?void 0:dn.TERMINAL_TELEMETRY_LOG_INTERVAL_MS)??1e4),jn=Date.now();if(jn-gt.lastTelemetryLogAt>=Nt&&(gt.lastTelemetryLogAt=jn,ae(`ISS lat=${sc(je.lat,2)} lon=${sc(je.lon,2)} alt=${sc(je.altKm,1)}km [${je.source}]`)),Cn(je.lat,je.lon),kn&&xt==="2d"){const Ue=Date.now(),$n=Number((dn==null?void 0:dn.FOLLOW_PAN_INTERVAL_MS)??4e3);Ue-Et>=$n&&(Et=Ue,jt.panTo(je.lat,je.lon,4))}}}),ae("[Motion]  Motion system started (2D: native sticky, 3D: 60fps lerp)");const _n=D3({onChange:je=>{document.body.setAttribute("data-mobile-view",je),de.style.display=je==="nasa"?"block":"none",be.style.display=je==="passes"?"block":"none",he.el.style.display=je==="telemetry"?"flex":"none"},onSettings:()=>Ye.open()});n.appendChild(_n.el),document.body.classList.add("mobile-mode"),document.body.setAttribute("data-mobile-view","map"),ae(rt("bootReady")),setTimeout(()=>{aS(je=>{ae(rt("locationSet")+`: ${je.displayName}`),je.lat&&je.lon},()=>{we()})},1e3),window.addEventListener("offline",()=>{oe.setOffline(!0)}),window.addEventListener("online",()=>{Lu(rt("connectionRestored")||" Connection Restored","success"),oe.setOffline(!1)})}const Qa={LIGHT:"light",DARK:"dark",SYSTEM:"system"},Tu={CYAN:{name:"Neon Cyan",accent:"#00f3ff",accentSecondary:"#00b4d8",glow:"rgba(0, 243, 255, 0.5)"},PINK:{name:"Neon Pink",accent:"#ff00ff",accentSecondary:"#ff69b4",glow:"rgba(255, 0, 255, 0.5)"},GREEN:{name:"Matrix Green",accent:"#0aff00",accentSecondary:"#00cc00",glow:"rgba(10, 255, 0, 0.5)"},PURPLE:{name:"Cyber Purple",accent:"#bd00ff",accentSecondary:"#9933ff",glow:"rgba(189, 0, 255, 0.5)"},ORANGE:{name:"Sunset Orange",accent:"#ff6b00",accentSecondary:"#ff9500",glow:"rgba(255, 107, 0, 0.5)"}};class Y3{constructor(){this.currentMode=Qa.DARK,this.currentPalette="CYAN",this.listeners=[]}init(){const n=localStorage.getItem("iss-theme-mode"),o=localStorage.getItem("iss-color-palette");n&&Object.values(Qa).includes(n)&&(this.currentMode=n),o&&Tu[o]&&(this.currentPalette=o),this.applyTheme(),this.applyPalette(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",h=>{this.currentMode===Qa.SYSTEM&&this.applyTheme()}),console.log("[ThemeManager] Initialized:",this.currentMode,this.currentPalette)}setMode(n){Object.values(Qa).includes(n)&&(this.currentMode=n,localStorage.setItem("iss-theme-mode",n),this.applyTheme(),this.notifyListeners())}setPalette(n){Tu[n]&&(this.currentPalette=n,localStorage.setItem("iss-color-palette",n),this.applyPalette(),this.notifyListeners())}getEffectiveTheme(){var n;return this.currentMode===Qa.SYSTEM?(n=window.matchMedia)!=null&&n.call(window,"(prefers-color-scheme: dark)").matches?Qa.DARK:Qa.LIGHT:this.currentMode}applyTheme(){const n=this.getEffectiveTheme();document.documentElement.setAttribute("data-theme",n),document.body.classList.add("theme-transitioning"),setTimeout(()=>{document.body.classList.remove("theme-transitioning")},300)}applyPalette(){const n=Tu[this.currentPalette];if(!n)return;const o=document.documentElement;o.style.setProperty("--accent",n.accent),o.style.setProperty("--accent-secondary",n.accentSecondary),o.style.setProperty("--neon-glow",n.glow),o.style.setProperty("--border",`${n.accent}40`),o.style.setProperty("--ring",`${n.accent}26`)}onThemeChange(n){return this.listeners.push(n),()=>{this.listeners=this.listeners.filter(o=>o!==n)}}notifyListeners(){this.listeners.forEach(n=>n({mode:this.currentMode,effectiveTheme:this.getEffectiveTheme(),palette:this.currentPalette,paletteData:Tu[this.currentPalette]}))}getAvailablePalettes(){return Object.entries(Tu).map(([n,o])=>({key:n,...o}))}getAvailableModes(){return Object.values(Qa)}getCurrentTheme(){return{mode:this.currentMode,effectiveTheme:this.getEffectiveTheme(),palette:this.currentPalette,paletteData:Tu[this.currentPalette]}}}const ET=new Y3;ET.init();console.log("[ISS Tracker] Theme initialized:",ET.getCurrentTheme());const Q3=YE(),J3=document.getElementById("app");X3(Q3,J3);export{eI as _,tI as g};
